:!UTF-8
{TITLE:A. Wydruk etykiet towarowych - kody kreskowe}
{PRINTER: 'kody',,,,,'Q','B',,,,,,1,15,15,15,15,0,1}
{BEGIN:
   materean:="VAR_DEL.delete('temp','font','wybierz','dalej','wyjscie','etykieta')";
   materean();
   temp:='';
   font:='';
   wybierz:='';
   dalej:=0;
   VAR_DEL.delete('BARCODE_TYPE','BARCODE_H');
   BARCODE_TYPE:=exec('barcode_type','kody_kresk');
   BARCODE_H:=exec('barcode_height','kody_kresk');
   etykieta:=PAR_WYDR.URZ_LAB;
   PAR_WYDR.URZ_LAB:=exec('wyb_etykiety','kody_kresk');
   wyjscie:={? PAR_WYDR.TYPDR<>null || PAR_WYDR.URZ_LAB=null ?};
   {? wyjscie=0 & PAR_WYDR.TYPDR=null & PAR_WYDR.KODKRESK=''
   || FUN.info('Brak parametryzacji drukowania kodów kreskowych.'@);
      wyjscie:=1
   ?};
   {? ~wyjscie
   || exec('drukmatr','material');
      {? ~__mdkc.size()
      || FUN.info('Brak kodów identyfikujących zestawy atrybutów dostaw.'@);
         wyjscie:=1
      ?}
   ?}
}
{END:
   VAR_DEL.delete('__mdkc');
   VAR_DEL.delete('BARCODE_TYPE','BARCODE_H');
   PAR_WYDR.URZ_LAB:=etykieta;
   materean(); VAR_DEL.delete('materean','__mdkc')
}
{EXIT: wyjscie=1}
{ wyjscie:=1;~~}
{DEFINEFONT: 'courier=TexGyreCursor,,,8'}
{FONT: 'courier'}
{MACRO:'stan'}
   {ENTIRE}
   {__mdkc.KTM}
   {__mdkc.OPI}

    {IF: __mdkc.SCE<>''}
     {BARCODE: __mdkc.SCE;50;BARCODE_H;BARCODE_TYPE}


     {FONT: 'courier'}{SPACE: 'B'}
      {__mdkc.SCE}
   {FI}
  ─────────────────────────────────────
   {ENTIRE-}
{MACRO-}
{MACRO:'etykiety'}
{IF: __mdkc.SCE<>''}
   { wyjscie:=0;~~}
   {IF: PAR_WYDR.TYPDR<>null}
      { wyjscie:=exec('druk','kody_kresk')=0;~~}
   {ELSE}
      {SUBSTITUTE: 'stan'}
   {FI}
{FI}
{MACRO-}
{EXIT: wybierz:=FUN.choice('Wydruk etykiet dla cech dostawy'@,,'Wszystkich'@,'W&ybranych'@);
 {? wybierz <> 0
 || {? wybierz=1
    || wybierz:='W'
    |? wybierz=2
    || wybierz:='Y'
    ?};0
  || "# koniec #"; 1
 ?}
}
{IF:wybierz='Y'}
   {
   _wer:=__mdkc.mk_sel('Cechy dostaw',,0,'ldffddppsdsadf');
   __mdkc.win_fld(_wer,,'KTM',,,50,,,'Indeks'@);
   __mdkc.win_fld(_wer,,'OPI',,,50,,,'Cecha'@);
   __mdkc.win_fld(_wer,,'SCE',,,30,,,'Kod kreskowy'@);
   _fbg:="
      VAR_DEL.delete('__Sel');
      __Sel:=__mdkc.sel_aget; __mdkc.sel_adel;
      {? __Sel.first=0
      || __Sel.REF:=#__mdkc.ref;
         __Sel.add
      ?};
      sel_exit
   ";
   __mdkc.win_act(_wer,,'Formuła','Akceptuj'@,,'Akceptacja wybranych pozycji'@,"",,0,1,_fbg);

   __mdkc.clear();
   __mdkc.first();
   __mdkc.win_sel(_wer);

   {? __mdkc.select=0
   || VAR_DEL.delete('__Sel');
      __Sel:=__mdkc.sel_aget; __mdkc.sel_adel
   ?};
   __mdkc.clear();
   ~~}
   {FOR: __Sel}
   {DO}
      {IF: __mdkc.seek(__Sel.REF,)}
         {SUBSTITUTE: 'etykiety'}
      {FI}
   {OD}
   {
   VAR_DEL.delete('__Sel');
   ~~}
{ELIF:wybierz='W'}
   {FOR: __mdkc}
   {DO}
      {SUBSTITUTE: 'etykiety'}
   {OD}
{FI}
{EXIT: wyjscie=1}
{EXIT: PAR_WYDR.TYPDR<>null}
