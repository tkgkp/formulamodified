:!UTF-8
{TITLE:PIT-8C (11) formularz obowiązujący od 2022 roku}
{PRINTER: exec('prt','param_wydr','v',KST),,,,,'Q','C',,,,,,1,5,5,5,5,1,1,'A4'}
{BEGIN:
   VAR_DEL.delete('pit','__ord','y','x','w','__P_UPR');
   pit:=obj_new(38);
   {! _nx:=1..22 |! pit[_nx]:='' !};
   {! _nx:=23..obj_len(pit) |! pit[_nx]:=0 !};

   exec('czytaj','#stalesys',date(),KST);

   pit[1]:=KST.NIP;
   pit[7]:='N';

   {! _nx:=1..9 |! pit[_nx]:=~(-pit[_nx]) !};

   __ord:=obj_new(13);
   {! _nx:=1..obj_len(__ord) |! __ord[_nx]:='' !};

   VAT_POZ.cntx_psh();
   exec('rpm_as_pdf_ini','rpm_pdf');
   y:=0;
   x:=obj_new(4);
   w:=obj_new(4);
   __P_UPR:=exec('dostepne_p','schemat','PPL',P_FILTER.F_ZATR().KOD,'*');
   __P_UPR.prefix()
}
{END:
   VAT_POZ.cntx_pop();
   exec('rpm_as_pdf_end','rpm_pdf');
   exec('stalesys','#stalesys');
   VAR_DEL.delete('pit','__ord','y','x','w','__P_UPR')
}
{COMMENT}OLD: deg8c11.rpm{COMMENT-}
{COMMENT}OLD: dkw8c11g.rpi{COMMENT-}
{COMMENT}OLD: ord_zu3g.rpi{COMMENT-}
{MACRO: 'PIT'}
{  {! _nx:=10..22 |! pit[_nx]:='' !};
   {! _nx:=23..obj_len(pit) |! pit[_nx]:=0 !};

   VAT_POZ.index('NR_NRK');
   VAT_POZ.prefix(VAT_DEK.ref());
   {? VAT_POZ.first()
   || {!
      |? {! _ind:=1..4
         |! _kw:=($('VAT_POZ.KW'+$_ind))();
            _poz:=($('VAT_POZ.P'+$_ind))();
            {? _poz>=1 & _poz<=obj_len(pit) || pit[_poz]:=_kw ?}
         !};
         VAT_POZ.next()
      !}
   ?};
   pit[2]:=exec('upo_id','xml');
   pit[4]:=VAT_DEK.OKRES;
   pit[5]:=VAT_DEK.US().NU+{? +US.UU || ', '+US.UU || '' ?}+
           {? +US.UK & +US.MU || ', '+(6+US.UK)+' '+US.MU || '' ?};
   pit[5]:=~-pit[5];
   pit[6]:=VAT_DEK.KOR;
   pit[7]:='N';
   {? VAT_DEK.POD=1 || pit[7]:='T' ?};
   {? pit[7]='N'
   || pit[8]:=KST.NAZWA;    'Platnik niebedacy osoba fizyczna'
   || pit[9]:=KST.PODNAZ+', '+KST.PODIME+', '+STR.gsub(KST.PODURDAT$4,'.','-'); 'Platnik bedacy osoba fizyczna'
   ?};
   pit[8]:=~-pit[8];
   pit[9]:=~-pit[9];
   {? pit[7]='T'
   || __ord[1]:=KST.NIP;
      __ord[5]:=KST.PODNAZ;
      __ord[6]:=KST.PODIME;
      __ord[7]:=STR.gsub(KST.PODURDAT$4,'.','-')
   || __ord[1]:=KST.NIP;
      __ord[5]:=KST.NAZWA;
      __ord[6]:=KST.SKROT
   ?};
   pit[10]:={? VAT_DEK.PESEL='' || VAT_DEK.NIP || VAT_DEK.PESEL ?};
   pit[11]:=VAT_DEK.NAZWISKO;
   pit[12]:=VAT_DEK.PIERWSZE;
   pit[13]:=VAT_DEK.DATA_UR$4;
   pit[14]:={? VAT_DEK.KRAJ || VAT_DEK.KRAJ().NAZ || '' ?};
   pit[15]:=VAT_DEK.WOJEWODZ;
   pit[16]:=VAT_DEK.POWIAT;
   pit[17]:=VAT_DEK.GMINA;
   pit[18]:=VAT_DEK.ULICA;
   pit[19]:=VAT_DEK.DOM;
   pit[20]:=VAT_DEK.LOKAL;
   pit[21]:=VAT_DEK.MIASTO;
   pit[22]:=VAT_DEK.KOD;
   {! _nx:=10..22 |! pit[_nx]:=~-pit[_nx] !};
   pit[38]:=~-(VAT_DEK.IMIE+' '+VAT_DEK.NAZ+{? VAT_DEK.STN<>'' || ', '+VAT_DEK.STN || '' ?});

   {? VAT_DEK.KOR='T'
   || __ord[2]:={? VAT_DEK.PESEL='' || VAT_DEK.NIP || VAT_DEK.PESEL ?};
      __ord[9]:=VAT_DEK.NAZWISKO;
      __ord[10]:=VAT_DEK.PIERWSZE;
      __ord[11]:=STR.gsub(VAT_DEK.DATA_UR$4,'.','-');
      __ord[12]:='';
      __ord[13]:=exec('opis_korekty','edeklar');
      {! _nx:=1..obj_len(__ord) |! __ord[_nx]:=~(-__ord[_nx]) !};
      __ord[3]:=pit[2]
   ?};
   ~~
}
{MACRO-}
{FOR: VAT_DEK}
{INDEX: 'VAT_PITG'}
{PREFIX: PIT_GRUP.ref}
{DO}
{IF: __P_UPR.find_key($VAT_DEK.P)}
{SUBSTITUTE: 'PIT'}
{REP:'{INCLUDE: ppl_dkw8c11g.rpi}'}
{IF: VAT_DEK.KOR='T' & __ord[13]<>''}
{REP: '{INCLUDE: ppl_ord_zu3g.rpi}'}
{FI}
{FI}
{OD}