:!UTF-8
{TITLE:A. Zestawienie dokumentów źródłowych}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
   PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   PRN:=obj_new(@.CLASS.PRINT,35); PRN.sl_frame(); w:=obj_new(36);
   PRNF:=obj_new(@.CLASS.PRINT,4); PRNF.sl_frame();
   okr:=odd:=sorto:=us:=str_sql:=sql_war1:=sql_war2:=sql_war3:=sql_war4:='';
   sql_war5:=sql_ind:=refr:=''; ext_ansyn:=0;
   vr:=sumwn:=summa:=vs1:=vs2:=vl:=x:=dc:=0;v:=1;
   vu:=USERS.ref;
   color:=prn1:=prn2:='';
   lm:=ll:=vp:=lmt:=rsep:=0;
   tuser:=tm_form(TMPVAT.tm_stamp);
   SA:='A'
}
{END:
   {? var_pres('TAB_SQL')>0 || obj_del(TAB_SQL)
   |? var_pres('TAB_SQL')=0 || &TAB_SQL
   ?};
   obj_del(w); obj_del(PRN); obj_del(PRNF);
   &okr; &odd; &sorto; &us; &str_sql; &sql_war1; &sql_war2; &sql_war3;
   &sql_war4; &sql_war5; &sql_ind; &refr; &tuser; &SA;
   &vr; &sumwn; &summa; &v; &vs1; &vs2; &vl; &x; &dc; &ext_ansyn;
   USERS.seek(vu); &vu;
   &color; &prn1; &prn2;
   &lm; &ll; &vp; &lmt; &rsep
}
{COMMENT}
vr - znacznik raportu (czy są rekordy do drukowania)
vp - znacznik nowej strony
v - wskaźnik anulowania
vs1, vs2 - znaczniki sumy (czy wybrano kolumnę kwot do sumowania)
vl - wskaźnik drukowania linii
x - współrzędna pozioma wydruku (dla parametrów)
dc - zmiana dokumentu
{COMMENT-}
{FONT: 'T8G'}
{  PAR_WYDR.win_edit('DZWDOKZE');
   PAR_WYDR.PAR1:=1;
   PAR_WYDR.IPAR1:=PAR_WYDR.IPAR2:=PAR_WYDR.IPAR3:=PAR_WYDR.IPAR4:=PAR_WYDR.SPAR1:=
   PAR_WYDR.SPAR2:=PAR_WYDR.SPAR3:=PAR_WYDR.SPAR4:=PAR_WYDR.ZAKR:=PAR_WYDR.POCH:=
   PAR_WYDR.ZAR:=PAR_WYDR.KH:=PAR_WYDR.NIP:='';
   PAR_WYDR.PAR2:=PAR_WYDR.PAR3:=PAR_WYDR.PAR4:=PAR_WYDR.PAR5:=PAR_WYDR.PAR6:=
   PAR_WYDR.RPAR2:=PAR_WYDR.RPAR3:=PAR_WYDR.REJ:=PAR_WYDR.TYPDOK:=0;
   PAR_WYDR.RPAR4:=PAR_WYDR.RPAR5:=PAR_WYDR.RPAR6:=PAR_WYDR.RPAR7:=PAR_WYDR.WAL:=PAR_WYDR.RPAR1:=0;
   PAR_WYDR.DPAR1:=PAR_WYDR.DPAR2:=PAR_WYDR.DPAR5:=PAR_WYDR.DPAR6:=PAR_WYDR.DPAR7:=PAR_WYDR.DPAR8:=date(0,0,0);
   PAR_WYDR.DPAR15:=PAR_WYDR.DPAR16:=date(0,0,0);
   SSTALE.AO();
   PAR_WYDR.DPAR3:=exec('get_date','okresy',SSTALE.AR,0,SSTALE.AO);
   PAR_WYDR.DPAR4:=exec('get_date','okresy',SSTALE.AR,1,SSTALE.AO);
   WYDRUKIN.DLKON:=35;
   PAR_WYDR.MAXKOL:=charleft()-1;
   {? rep_export=1 || PAR_WYDR.MAXKOL:=1000000 ?};
   ROZNE.MASKA:=35*'?';
   PAR_WYDR.ODD:=OPERATOR.DEPT;
   ROZNE.UT_ROKOD:=ROZNE.UT_ROKDO:=SSTALE.AR; ROZNE.UT_OKROD:=ROZNE.UT_OKRDO:=SSTALE.AO;
   ROZNE.KODREJ:=ROZNE.TYPDOK:='';
   WAL.win_dict('WALUTYF3');
   {? OPERATOR.DEPT || REJ.win_dict('SLO1') || REJ.win_dict('SLO1_ODD') ?};
   ODD.f_clear(); ~~}
{EXIT: ~PAR_WYDR.edit("exec('chk_pardz','!fks_dks_zrdk')")}
{  KOL_WYDR.first();
   _ks1:=_ks2:=0; _ikl:=0;
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[1]",KOL_WYDR.SZER-1,'Rejestr'@); _ks1+=KOL_WYDR.SZER; str_sql+='REJ.KOD as F1' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[2]",KOL_WYDR.SZER-1,'  Nr'@,1); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.NR as F2' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[3]",KOL_WYDR.SZER-1,'        Typ dokumentu'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK_REJ.NAZ as F3' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[4]",KOL_WYDR.SZER-1,'  Symbol dokumentu'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.NK as F4' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[5]",KOL_WYDR.SZER-1,'Data wyst.'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.DTO as F5' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[6]",KOL_WYDR.SZER-1,'   Data# operacji'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.DOP as F6' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[7]",KOL_WYDR.SZER-1,'   Data# zapisu'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.DTW as F7' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[8]",KOL_WYDR.SZER-1,'Data#otrz./potw'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.D4 as F8' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[9]",KOL_WYDR.SZER-1,'   Data#akceptacji'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.DAKC as F9' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[10]",KOL_WYDR.SZER-1,'  Termin#płatności'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.D3 as F10' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[11]",KOL_WYDR.SZER-1,'Data odpr.#  celnej'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.DTO as F11' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[12]",KOL_WYDR.SZER-1,' Wystawca (słownik)'@); _ks1+=KOL_WYDR.SZER; str_sql+=',SLUWYS.NAZ as F12' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[13]",KOL_WYDR.SZER-1,'Wystawca'@); _ks1+=KOL_WYDR.SZER; str_sql+=',SLOWYS.KOD as F13' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[14]",KOL_WYDR.SZER-1,11*' '+'Wystawca'@); _ks1+=KOL_WYDR.SZER; str_sql+=',SLOWYS.TR as F14' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[15]",KOL_WYDR.SZER-1,'Rejestr#  VAT'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',VAT_REJ.SYM as F15' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[16]",KOL_WYDR.SZER-1,'Kontrahent'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.KH as F16' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[17]",KOL_WYDR.SZER-1,'     NIP'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.NIP as F17' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[18]",KOL_WYDR.SZER-1,'     Okres VAT'@); _ks1+=KOL_WYDR.SZER; str_sql+=',OKRO_F.NAZ as F18' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[19]",KOL_WYDR.SZER-1,'        Opis dokumentu'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.TR as F19' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[20]",KOL_WYDR.SZER-1,' Dodatkowy słownik'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DODSLU.NAZ as F20' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[21]",KOL_WYDR.SZER-1,'  Kod'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DODSLO.KOD as F21' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[22]",KOL_WYDR.SZER-1,'   Dokument#   źródłowy'@,,'#'); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.DOKZRODL as F22' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[23]",KOL_WYDR.SZER-1,'Jedn.# księgowa'@,,'#'); _ks1+=KOL_WYDR.SZER ?}; str_sql+=',ODD.OD as F23'; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[24]",KOL_WYDR.SZER-1,'   Zarejestrował'@); _ks1+=KOL_WYDR.SZER; str_sql+=',DOK.ZAR as F24' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[25]",KOL_WYDR.SZER-1,'  Lp.'@,1); _ks1+=KOL_WYDR.SZER ?}; str_sql+=',POZ.POZ as F25'; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || _ikl+=1; PRN.add("w[26]",KOL_WYDR.SZER-1,7*' '+'Konto'@); _ks1+=KOL_WYDR.SZER; str_sql+=',POZ.KON as F26' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("{? w[27]=0 || '' || form(w[27],,2,' ,') ?}",KOL_WYDR.SZER-1,'     Kwota Wn'@,1); vs1:=1; str_sql+=',POZ.SUM as F27' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("{? w[28]=0 || '' || form(w[28],,2,' ,') ?}",KOL_WYDR.SZER-1,'     Kwota Ma'@,1); vs2:=1; str_sql+=',POZ.SUM as F28' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("w[29]",KOL_WYDR.SZER-1,'Wal.'); _ks2+=KOL_WYDR.SZER; str_sql+=',SLOWAL.KOD as F29' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("{? w[30]=0 || '' || form(w[30],,4,' ,') ?}",KOL_WYDR.SZER-1,' Kurs',1); _ks2+=KOL_WYDR.SZER; str_sql+=',POZ.KURS as F30' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("{? w[31]=0 || '' || form(w[31],,2,' ,') ?}",KOL_WYDR.SZER-1,' Kwota w walucie'@,1); _ks2+=KOL_WYDR.SZER; str_sql+=',POZ.SUMW as F31' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("w[32]",KOL_WYDR.SZER-1,9*' '+'Treść zapisu'@); _ks2+=KOL_WYDR.SZER; str_sql+=',POZ.OP as F32' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("w[33]",KOL_WYDR.SZER-1,'   Identyfikator'@); _ks2+=KOL_WYDR.SZER; str_sql+=',POZ.ID as F33' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("w[34]",KOL_WYDR.SZER-1,'Typ'@); _ks2+=KOL_WYDR.SZER; str_sql+=',POZ.TID as F34' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("w[35]",KOL_WYDR.SZER-1,'   Data# otwarcia'@,,'#'); _ks2+=KOL_WYDR.SZER; str_sql+=',POZ.DO as F35' ?}; KOL_WYDR.next();
   {? KOL_WYDR.WSK_DRUK='X' || PRN.add("w[36]",KOL_WYDR.SZER-1,'  Termin#płatności'@,,'#'); _ks2+=KOL_WYDR.SZER; str_sql+=',POZ.TP as F36' ?}; KOL_WYDR.next();
   {? _ks1-1>1 || PRNF.add("w[1]",_ks1-1,'',,,,,,,,_ikl) ?};
   {? vs1=1
   || KOL_WYDR.find_key(27);
      PRNF.add("form(w[2],,2,' ,')",KOL_WYDR.SZER-1,'',1)
   ?};
   {? vs2=1
   || KOL_WYDR.find_key(28);
      PRNF.add("form(w[3],,2,' ,')",KOL_WYDR.SZER-1,'',1)
   ?};
   {? _ks2-1>1 || PRNF.add("w[4]",_ks2-1,'') ?};
   {! _a:=1..36 |!
      w[_a]:=''
   !};
   w[27]:=w[28]:=w[30]:=w[31]:=0;
   okr:=SSTALE.AO().NAZ+' '+SSTALE.AO().ROK().NAZ;
   {? SSTALE.AO().ZAM='T'
      || okr+=' - okres zamknięty'@
      || okr+=' - okres otwarty'@
   ?};
   {? OPERATOR.DEPT
      || odd:='Jednostka księgowa: %1'@[OPERATOR.DEPT().OD]
      || {? PAR_WYDR.ODD=null
            || odd:='Wszystkie jednostki księgowe'@
            || odd:='Jednostka księgowa: %1'@[PAR_WYDR.ODD().OD]
         ?}
   ?};
   WYDRUKI.MASKA:= ROZNE.MASKA;
   {! |?
      {? ROZNE.MASKA+1='?' || ROZNE.MASKA:=ROZNE.MASKA-1 ?};
      ROZNE.MASKA+1='?'
   !};
   ROZNE.MASKA:=ROZNE.MASKA+'%';
   ROZNE.MASKA:=STR.gsub( ROZNE.MASKA,'?','_');
   PAR_WYDR.TITLE:='ZESTAWIENIE DOKUMENTÓW ŹRÓDŁOWYCH'@;
   prn1:='PRN'; prn2:='PRNF'; ~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: rep_export=0}{SUBSTITUTE: 'FOOT'}{FI}
{EXIT: ~v}
{  KOL_WYDR.index('USER'); KOL_WYDR.prefix(@.OPERATOR.USER,'DZWDOKZE');
   {? PAR_WYDR.PAR1=1
   || {? (KOL_WYDR.find_key(1) & KOL_WYDR.WSK_DRUK='X')
         & (KOL_WYDR.find_key(2) & KOL_WYDR.WSK_DRUK='X')
      || sql_ind:='F23,F1,F2,F25'
      || v:=0
      ?}
   |? PAR_WYDR.PAR1=2
   || {? (KOL_WYDR.find_key(1) & KOL_WYDR.WSK_DRUK='X')
         & (KOL_WYDR.find_key(2) & KOL_WYDR.WSK_DRUK='X')
         & (KOL_WYDR.find_key(7) & KOL_WYDR.WSK_DRUK='X')
      || sql_ind:='F7,F23,F1,F2,F25'
      || v:=0
      ?}
   |? PAR_WYDR.PAR1=3 ||
      sql_ind:='';
      {? PAR_WYDR.IPAR1<>''
      || _v:=exec('par_ind','!fks_dks_zrdk',PAR_WYDR.IPAR1);
         {? _v<>'' || sql_ind:=_v || v:=0 ?};
         {? PAR_WYDR.IPAR2<>''
         || _v:=exec('par_ind','!fks_dks_zrdk',PAR_WYDR.IPAR2);
            {? _v<>'' || sql_ind+=','+_v || v:=0 ?};
            {? PAR_WYDR.IPAR3<>''
            || _v:=exec('par_ind','!fks_dks_zrdk',PAR_WYDR.IPAR3);
               {? _v<>'' || sql_ind+=','+_v || v:=0 ?};
               {? PAR_WYDR.IPAR4<>''
               || _v:=exec('par_ind','!fks_dks_zrdk',PAR_WYDR.IPAR4);
                  {? _v<>'' || sql_ind+=','+_v || v:=0 ?}
               ?}
            ?}
         ?}
      ?}
   ?};
   {? ~v
   || FUN.info('W skład indeksu wchodzą pola, niewystępujące na wydruku!\n Sprawozdanie zostanie przerwane.'@)
   ?}; ~~}
{EXIT: ~v}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<1 'PARAMETRY WYDRUKU:'@}
{  x:=1; ~~}
{DIRECT}
{<1 'Data zapisu księgowania od: %1 do: %2'@[$PAR_WYDR.DPAR3,$PAR_WYDR.DPAR4]}{sql_war2+='and DOK.DTW between to_date(\''+$PAR_WYDR.DPAR3+'\') and to_date(\''+$PAR_WYDR.DPAR4+'\') '; ~~}
{<1 'Data zapisu księgowania od: %1 do: %2'@[$PAR_WYDR.DPAR3,$PAR_WYDR.DPAR4]}{sql_war2+='and DOK.DTW between to_date(\''+$PAR_WYDR.DPAR3+'\') and to_date(\''+$PAR_WYDR.DPAR4+'\') '; ~~}
{IF: PAR_WYDR.WAL<>null}{<1 'Waluta: %1 - %2'@[PAR_WYDR.WAL().SYM,PAR_WYDR.WAL().NAZ]}{sql_war1+='and SLOWAL.KOD=\''+PAR_WYDR.WAL().SYM+'\' '; ~~}{ELSE}{<1 'Waluta: %1 - %2'@[SSTALE.WAL().KOD,SSTALE.WAL().TR]}{FI}
{<1 odd}{IF: 1+odd='J'}{sql_war1+='and ODD.OD=\''+PAR_WYDR.ODD().OD+'\' '; ~~}{FI}
{IF: ROZNE.KODREJ<>''}{<1 'Rejestr: %1'@[ROZNE.KODREJ]}{sql_war1+='and REJ.KOD=\''+ROZNE.KODREJ+'\' '; ~~}{FI}
{IF: PAR_WYDR.PAR3<>null | PAR_WYDR.PAR4<>null}{<1 'Nr w rejestrze od: %1 do: %2'@[$PAR_WYDR.PAR3,$PAR_WYDR.PAR4]}{sql_war1+='and DOK.NR between '+$PAR_WYDR.PAR3+' and '+$PAR_WYDR.PAR4+' '; ~~}{FI}
{IF: ROZNE.TYPDOK<>''}{<1 'Typ dokumentu: %1'@[ROZNE.TYPDOK]}{sql_war1+='and DOK_REJ.NAZ=\''+ROZNE.TYPDOK+'\' '; ~~}{FI}
{IF: PAR_WYDR.SPAR1<>''}{<1 'Symbol dokumentu: %1'@[PAR_WYDR.SPAR1]}{sql_war1+='and DOK.NK like \''+PAR_WYDR.SPAR1+'%\' '; ~~}{FI}
{IF: PAR_WYDR.SPAR4<>''}{<1 'Korekta: %1'@[PAR_WYDR.SPAR4]}{sql_war1+='and DOK.KOR like \''+PAR_WYDR.SPAR4+'%\' '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: ROZNE.UT_OKROD}{<{x} 'Okresy obrachunkowe od: %1 do: %2'@[ROZNE.UT_OKROD().NAZ,ROZNE.UT_OKRDO().NAZ]}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.DPAR15<>date(0,0,0)}{<{x} 'Data operacji od: %1 do: %2'@[$PAR_WYDR.DPAR15,$PAR_WYDR.DPAR16]}{sql_war2+='and DOK.DOP between to_date(\''+$PAR_WYDR.DPAR15+'\') and to_date(\''+$PAR_WYDR.DPAR16+'\') '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.DPAR1<>date(0,0,0)}{<{x} 'Data wystawienia od: %1 do: %2'@[$PAR_WYDR.DPAR1,$PAR_WYDR.DPAR2]}{sql_war2+='and DOK.DTO between to_date(\''+$PAR_WYDR.DPAR1+'\') and to_date(\''+$PAR_WYDR.DPAR2+'\') '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.DPAR5<>date(0,0,0)}{<{x} 'Data akceptacji od: %1 do: %2'@[$PAR_WYDR.DPAR5,$PAR_WYDR.DPAR6]}{sql_war2+='and DOK.DAKC between to_date(\''+$PAR_WYDR.DPAR5+'\') and to_date(\''+$PAR_WYDR.DPAR6+'\') '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.KH<>''}{<{x} 'Kontrahent: %1'@[PAR_WYDR.KH]}{sql_war2+='and DOK.KH = \''+PAR_WYDR.KH+'\' '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.NIP<>''}{<{x} 'NIP: %1'@[PAR_WYDR.NIP]}{sql_war3+='and DOK.NIP like \''+PAR_WYDR.NIP+'%\' '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.ZAR<>''}{<{x} 'Zarejestrował: %1'@[PAR_WYDR.ZAR]}{sql_war3+='and DOK.ZAR like \'%: '+PAR_WYDR.ZAR+'\' '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.POCH<>''}{IF: PAR_WYDR.POCH='FKS'}{<{x} 'Pochodzenie dokumentów: Finanse i księgowość'@
}{ELIF: PAR_WYDR.POCH='LSP'}{<{x} 'Pochodzenie dokumentów: Sprzedaż'@
}{ELIF: PAR_WYDR.POCH='LZK'}{<{x} 'Pochodzenie dokumentów: Zakupy'@
}{ELIF: PAR_WYDR.POCH='PKD'}{<{x} 'Pochodzenie dokumentów: Kadry i płace'@
}{ELIF: PAR_WYDR.POCH='FST'}{<{x} 'Pochodzenie dokumentów: Środki trwałe'@
}{ELIF: PAR_WYDR.POCH='KAS'}{<{x} 'Pochodzenie dokumentów: Kasa'@
}{FI}{ sql_war3+='and DOK.ZAR like \''+PAR_WYDR.POCH+'%\' '; ~~}{FI}
{IF: line()=9}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.ZAKR<>''}{IF: PAR_WYDR.ZAKR='N'}{<{x} 'Zakres dokumentów: Niezaakceptowane'@}{sql_war3+='and DOK.A<>\'T\' '; ~~}{ELIF: PAR_WYDR.ZAKR='A'}{<{x} 'Zakres dokumentów: Zaakceptowane'}{sql_war3+='and DOK.A=\'T\' '; ~~}{ELIF: PAR_WYDR.ZAKR='P'}{<{x} 'Zakres dokumentów: Zaksięgowane próbnie'}{sql_war3+='and DOK.ZP=\'T\' '; ~~}{ELIF: PAR_WYDR.ZAKR='K'}{<{x} 'Zakres dokumentów: Zaksięgowane końcowo'}{sql_war3+='and DOK.ZK=\'T\' '; ~~}{FI}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.PAR5<>null}{<{x} 'Lp. od: %1 do: %2'@[$PAR_WYDR.PAR5,$PAR_WYDR.PAR6]}{sql_war3+='and POZ.POZ between '+$PAR_WYDR.PAR5+' and '+$PAR_WYDR.PAR6+' '; ~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: ROZNE.PAR4 = 2}{<{x} 'Maska konta: %1'@[WYDRUKI.MASKA]}{sql_war3+='and POZ.KON like\''+ROZNE.MASKA+'%\' '; ~~}
{ELIF: ROZNE.PAR4 = 0}{<{x} 'Prefix konta: %1'@[ROZNE.PREFIX]}{sql_war3+='and POZ.KON like\''+ROZNE.PREFIX+'%\' '; ~~}
{ELIF: ROZNE.PAR4 = 3}{<{x} 'Wybrane konta syntetyczne'}{ _okn:=KS.win_sel('?');
                                                  ext_ansyn:=0;
                                                  no_msg(0);
                                                  TMPSIK.cntx_psh();
                                                  exec('initmpks','dok_fks_zest');
                                                  KS.select();
                                                  KS.win_sel(_okn);
                                                  {? TMPSIK.first()
                                                  || sql_war3+='and POZ.KON like\''+TMPSIK.T2+'%\'';
                                                     {!|? TMPSIK.next()
                                                     |! sql_war3+=' or POZ.KON like\''+TMPSIK.T2+'%\''
                                                     !}
                                                  || ext_ansyn:=1; no_msg(1)
                                                  ?};
                                                  TMPSIK.cntx_pop();~~
                                                }
{EXIT: ext_ansyn}
{ELIF: ROZNE.PAR4 = 6}{<{x} 'Wybrane konta analityczne'}{ _okn:=AN.win_sel('?');
                                                  ext_ansyn:=0;
                                                  no_msg(0);
                                                  TMPSIK.cntx_psh();
                                                  exec('initmpan','dok_fks_zest');
                                                  AN.select();
                                                  AN.win_sel(_okn);
                                                  {? TMPSIK.first()
                                                  || sql_war3+='and POZ.KON like\''+TMPSIK.T2+'%\'';
                                                     {!|? TMPSIK.next()
                                                     |! sql_war3+=' or POZ.KON like\''+TMPSIK.T2+'%\''
                                                     !}
                                                  || ext_ansyn:=1; no_msg(1)
                                                  ?};
                                                   TMPSIK.cntx_pop();~~
                                                  }
{EXIT: ext_ansyn}
{ELIF: ROZNE.PAR4 = 4}{<{x} 'Zakres kont od: %1 do: %2'@[ROZNE.KS_OD().SYM,ROZNE.KS_DO().SYM]}{sql_war3+='and POZ.KON between \''+ROZNE.KS_OD().SYM+'\' and \''+ROZNE.KS_DO().SYM+%255+'\''; ~~}
{ELIF: ROZNE.PAR4 = 5}{<{x} 'Zestaw kont: %1'@[ROZNE.KON_WYDR().KOD]}{
                                                                     KON_SCH.cntx_psh();
                                                                     KON_SCH.index('IND_LP');
                                                                     KON_SCH.prefix(ROZNE.KON_WYDR);
                                                                     {? KON_SCH.first()
                                                                     || {? KON_SCH.MZ = 'M'
                                                                        || {! |?
                                                                           {? KON_SCH.MASKA+1='?' || KON_SCH.MASKA:=KON_SCH.MASKA-1 ?};
                                                                              KON_SCH.MASKA+1='?'
                                                                           !};
                                                                           KON_SCH.MASKA:=KON_SCH.MASKA+'%';
                                                                           KON_SCH.MASKA:=STR.gsub( KON_SCH.MASKA,'?','_');
                                                                           sql_war3+='and (POZ.KON like \''+KON_SCH.MASKA+'\''
                                                                        || sql_war3+='and (POZ.KON between \''+KON_SCH.ZOD+'\' and \''+KON_SCH.ZDO+%255+'\''
                                                                        ?};
                                                                        {!|? KON_SCH.next()
                                                                        |! {? KON_SCH.MZ = 'M'
                                                                           || {! |?
                                                                              {? KON_SCH.MASKA+1='?' || KON_SCH.MASKA:=KON_SCH.MASKA-1 ?};
                                                                                 KON_SCH.MASKA+1='?'
                                                                              !};
                                                                              KON_SCH.MASKA:=KON_SCH.MASKA+'%';
                                                                              KON_SCH.MASKA:=STR.gsub( KON_SCH.MASKA,'?','_');
                                                                              sql_war3+=' or POZ.KON like \''+KON_SCH.MASKA+'\''
                                                                           || sql_war3+=' or POZ.KON between \''+KON_SCH.ZOD+'\' and \''+KON_SCH.ZDO+%255+'\''
                                                                           ?}
                                                                        !};
                                                                      sql_war3+=')'
                                                                      ?};
                                                                      KON_SCH.cntx_pop();~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.RPAR2<>null | PAR_WYDR.RPAR3<>null}{<{x} 'Kwota Wn od: %1 do: %2'@[form(PAR_WYDR.RPAR2,,2,' ,'),form(PAR_WYDR.RPAR3,,2,' ,')]}{sql_war3+='and POZ.STR=\'Wn\' and POZ.SUM between '+form(PAR_WYDR.RPAR2,,2,'9.')+' and '+form(PAR_WYDR.RPAR3,,2,'9.')+' '; ~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.RPAR4<>null | PAR_WYDR.RPAR5<>null}{<{x} 'Kwota Ma od: %1 do: %2'@[form(PAR_WYDR.RPAR4,,2,' ,'),form(PAR_WYDR.RPAR5,,2,' ,')]}{sql_war4+='and POZ.STR=\'Ma\' and POZ.SUM between '+form(PAR_WYDR.RPAR4,,2,'9.')+' and '+form(PAR_WYDR.RPAR5,,2,'9.')+' '; ~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.RPAR1<>null}{<{x} 'Kurs waluty: '+form(PAR_WYDR.RPAR1,,4,' ,')}{sql_war5+='and POZ.KURS='+form(PAR_WYDR.RPAR1,,4,'9.')+' '; ~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.RPAR6<>null | PAR_WYDR.RPAR7<>null}{<{x} 'Kwota w walucie od: %1 do: %2'@[form(PAR_WYDR.RPAR6,,2,' ,'),form(PAR_WYDR.RPAR7,,2,' ,')]}{sql_war5+='and POZ.SUMW between '+form(PAR_WYDR.RPAR6,,2,'9.')+' and '+form(PAR_WYDR.RPAR7,,2,'9.')+' '; ~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.SPAR2<>''}{<{x} 'Treść zapisu: %1'@[PAR_WYDR.SPAR2]}{sql_war4+='and POZ.OP like \''+PAR_WYDR.SPAR2+'%\' '; ~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.SPAR3<>''}{<{x} 'Identyfikator rozrachunku: %1'@[PAR_WYDR.SPAR3]}{sql_war4+='and POZ.ID like \''+PAR_WYDR.SPAR3+'%\' '; ~~}{FI}
{IF: line()=9 & x=70}{ x:=140; line(1); ~~}{ELIF: line()=9 & x=1}{ x:=70; line(1); ~~}{FI}
{IF: PAR_WYDR.DPAR7<>date(0,0,0)}{<{x} 'Termin płatności od: %1 do: %2'@[$PAR_WYDR.DPAR7,$PAR_WYDR.DPAR8]}{sql_war4+='and POZ.TP between to_date(\''+$PAR_WYDR.DPAR7+'\') and to_date(\''+$PAR_WYDR.DPAR8+'\') '; ~~}{FI}
{DIRECT-}
{ {? PAR_WYDR.PAR1=1 || sorto:='Rejestr, numer'@
  |? PAR_WYDR.PAR1=2 || sorto:='Data zapisu, rejestr, numer'@
  |? PAR_WYDR.PAR1=3 ||
     {? PAR_WYDR.IPAR1<>'' ||
        sorto:=PAR_WYDR.IPAR1;
        {? PAR_WYDR.IPAR2<>'' ||
           sorto+=', '+PAR_WYDR.IPAR2;
           {? PAR_WYDR.IPAR3<>'' ||
              sorto+=', '+PAR_WYDR.IPAR3;
              {? PAR_WYDR.IPAR4<>'' ||
                 sorto+=', '+PAR_WYDR.IPAR4
              ?}
           ?}
        ?}
     ?}
  ?}; ~~}
{<1 'Kolejność sortowania: %1'@[sorto]}
{LINE: 1}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{~~}
{FOOTER-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{  rsep:=PAR_WYDR.RSEP;
   {? 1+str_sql=',' || str_sql:=1-str_sql ?};
   {? 3+sql_war1='and' || sql_war1:=4-sql_war1 ?};
   {? (sql_war1='' & 3+sql_war2='and') || sql_war2:=4-sql_war2 ?};
   {? (sql_war1='' & sql_war2='' & 3+sql_war3='and') || sql_war3:=4-sql_war3 ?};
   {? (sql_war1='' & sql_war2='' & sql_war3='' & 3+sql_war4='and') || sql_war4:=4-sql_war4 ?};
   {? (sql_war1='' & sql_war2='' & sql_war3='' & sql_war4='' & 3+sql_war5='and') || sql_war5:=4-sql_war5 ?};
   OKRO_F.cntx_psh(); OKRO_F.index('ROK'); OKRO_F.prefix(SSTALE.AR);
   {? ROZNE.UT_OKROD
   || _vod:=ROZNE.UT_OKROD().NR; _vdo:=ROZNE.UT_OKRDO().NR;
      {? OKRO_F.find_key(_vod)
      || _v:=1;
         {! |? _v & _vdo>=OKRO_F.NR |!
            {? _vod=OKRO_F.NR
            || _sqlmfd:='\'doku'+SSTALE.AR().KOD+form(OKRO_F.NR,-2)+'\'';
               _sqlmfp:='\'pozy'+SSTALE.AR().KOD+form(OKRO_F.NR,-2)+'\''
            || _sqlmfd+=',\'doku'+SSTALE.AR().KOD+form(OKRO_F.NR,-2)+'\'';
               _sqlmfp+=',\'pozy'+SSTALE.AR().KOD+form(OKRO_F.NR,-2)+'\''
            ?}; _v:=OKRO_F.next()
         !}
      ?}
   || {? OKRO_F.first()
      || {! |?
            {? PAR_WYDR.DPAR3>OKRO_F.KON || OKRO_F.next() || 0 ?}
         !};
         _sqlmfd:='\'doku'+OKRO_F.ROK().KOD+form(OKRO_F.NR,-2)+'\'';
         _sqlmfp:='\'pozy'+OKRO_F.ROK().KOD+form(OKRO_F.NR,-2)+'\'';
         {? OKRO_F.next()
         || {! |?
               {? PAR_WYDR.DPAR4>=OKRO_F.POCZ
               || _sqlmfd+=',\'doku'+OKRO_F.ROK().KOD+form(OKRO_F.NR,-2)+'\'';
                  _sqlmfp+=',\'pozy'+OKRO_F.ROK().KOD+form(OKRO_F.NR,-2)+'\''
               ?};
               OKRO_F.next() & PAR_WYDR.DPAR4>=OKRO_F.KON & OKRO_F.KON<>date(0,0,0)
            !}
         ?}
      ?}
   ?};
   OKRO_F.cntx_pop();
   TAB_SQL:=sql('select /*+MASK_FILTER(DOK,:_f) MASK_FILTER(POZ,:_g) */ '
   +'POZ.DOK as F0,'+str_sql+',POZ.STR as F27_0, \'N\' as WVR from @POZ '
   +'join @DOK using (POZ.DOK,DOK.REFERENCE) '
   +'join REJ using (DOK.REJ,REJ.REFERENCE) '
   +'join DOK_REJ using (DOK.DOK_REJ,DOK_REJ.REFERENCE) '
   +'left join VAT_REJ using (DOK.RVAT,VAT_REJ.REFERENCE) '
   +'left join SLO as SLOWYS using (DOK.WYS,SLOWYS.REFERENCE) '
   +'left join SLU as SLUWYS using (SLOWYS.SLU,SLUWYS.REFERENCE) '
   +'left join OKRO_F using (DOK.OKRVAT,OKRO_F.REFERENCE) '
   +'left join SLU as DODSLU using (DOK.DODSLU,DODSLU.REFERENCE) '
   +'left join SLO as DODSLO using (DOK.DODSLO,DODSLO.REFERENCE) '
   +'join ODD using (DOK.ODD,ODD.REFERENCE) '
   +'left join SLO as SLOWAL using (POZ.WAL,SLOWAL.REFERENCE) '
   +{? (sql_war1<>'' | sql_war2<>'' | sql_war3<>'' | sql_war4<>'' | sql_war5<>'')
    || 'where :_a :_b :_c :_d :_e '
    || ''
    ?}
   +' order by '+sql_ind,sql_war1,sql_war2,sql_war3,sql_war4,sql_war5,_sqlmfd,_sqlmfp);
   {? str_sql*',VAT_REJ.SYM' || exec('wyp_wvr','dok_fks_zest') ?}; ~~}
{IF: type_of(TAB_SQL)>100}
   {FOR: TAB_SQL}
   {DO}
      {  {? TAB_SQL.F0<>refr | rep_export=1
         || {? var_pres('F1',TAB_SQL)>=0 || w[1]:=TAB_SQL.F1 ?};
            {? var_pres('F2',TAB_SQL)>=0 || w[2]:=TAB_SQL.F2 ?};
            {? var_pres('F3',TAB_SQL)>=0 || w[3]:=TAB_SQL.F3 ?};
            {? var_pres('F4',TAB_SQL)>=0 || w[4]:=TAB_SQL.F4 ?};
            {? var_pres('F5',TAB_SQL)>=0 || w[5]:=$TAB_SQL.F5 ?};
            {? var_pres('F6',TAB_SQL)>=0 || w[6]:=$TAB_SQL.F6 ?};
            {? var_pres('F7',TAB_SQL)>=0 || w[7]:=$TAB_SQL.F7 ?};
            {? var_pres('F8',TAB_SQL)>=0 || w[8]:=$TAB_SQL.F8 ?};
            {? var_pres('F9',TAB_SQL)>=0 || w[9]:=$TAB_SQL.F9 ?};
            {? var_pres('F10',TAB_SQL)>=0 || w[10]:=$TAB_SQL.F10 ?};
            {? var_pres('F11',TAB_SQL)>=0 || w[11]:=TAB_SQL.F11 ?};
            {? var_pres('F12',TAB_SQL)>=0 || w[12]:=TAB_SQL.F12 ?};
            {? var_pres('F13',TAB_SQL)>=0 || w[13]:=TAB_SQL.F13 ?};
            {? var_pres('F14',TAB_SQL)>=0 || w[14]:=TAB_SQL.F14 ?};
            {? var_pres('F15',TAB_SQL)>=0
            || {? var_pres('WVR',TAB_SQL)>=0 & TAB_SQL.WVR='T'
               || w[15]:='wiele'
               || w[15]:=TAB_SQL.F15
               ?}
            ?};
            {? var_pres('F16',TAB_SQL)>=0 || w[16]:=TAB_SQL.F16 ?};
            {? var_pres('F17',TAB_SQL)>=0 || w[17]:=TAB_SQL.F17 ?};
            {? var_pres('F18',TAB_SQL)>=0 || w[18]:=TAB_SQL.F18 ?};
            {? var_pres('F19',TAB_SQL)>=0 || w[19]:=TAB_SQL.F19 ?};
            {? var_pres('F20',TAB_SQL)>=0 || w[20]:=TAB_SQL.F20 ?};
            {? var_pres('F21',TAB_SQL)>=0 || w[21]:=TAB_SQL.F21 ?};
            {? var_pres('F22',TAB_SQL)>=0 || w[22]:=TAB_SQL.F22 ?};
            {? var_pres('F23',TAB_SQL)>=0 || w[23]:=TAB_SQL.F23 ?};
            {? var_pres('F24',TAB_SQL)>=0
            || w[24]:=exec('nsystem','dok_fks_zest',TAB_SQL.F24)+': '+exec('zarej','dok_fks',TAB_SQL.F24)
            ?};
            refr:=TAB_SQL.F0;
            rsep:=PAR_WYDR.RSEP
         || {! _i:=1..24 |! w[_i]:='' !};
            rsep:=0
         ?};
         {? var_pres('F25',TAB_SQL)>=0 || w[25]:=TAB_SQL.F25 ?};
         {? var_pres('F26',TAB_SQL)>=0 || w[26]:=TAB_SQL.F26 ?};
         {? var_pres('F27',TAB_SQL)>=0
         || {? TAB_SQL.F27_0='Wn'
            || w[27]:=TAB_SQL.F27; sumwn+=TAB_SQL.F27
            || w[27]:=0
            ?}
         ?};
         {? var_pres('F28',TAB_SQL)>=0
         || {? TAB_SQL.F27_0='Ma'
            || w[28]:=TAB_SQL.F28;
               summa+=TAB_SQL.F28
            || w[28]:=0
            ?}
         ?};
         {? var_pres('F29',TAB_SQL)>=0 || w[29]:=TAB_SQL.F29 ?};
         {? var_pres('F30',TAB_SQL)>=0 || w[30]:=TAB_SQL.F30 ?};
         {? var_pres('F31',TAB_SQL)>=0 || w[31]:=TAB_SQL.F31 ?};
         {? var_pres('F32',TAB_SQL)>=0 || w[32]:=TAB_SQL.F32 ?};
         {? var_pres('F33',TAB_SQL)>=0 || w[33]:=TAB_SQL.F33 ?};
         {? var_pres('F34',TAB_SQL)>=0 || w[34]:=TAB_SQL.F34 ?};
         {? var_pres('F35',TAB_SQL)>=0 || w[35]:=$TAB_SQL.F35 ?};
         {? var_pres('F36',TAB_SQL)>=0 || w[36]:=$TAB_SQL.F36 ?}; ~~}
      {SUBSTITUTE: 'LINIA0'}
   {OD}
{FI}
{COMMENT}------------------------------FOOTER-LAST------------------{COMMENT-}
{IF: lineleft()<>0 & lineleft()<6}{PAGE}{FI}
{FOOTER}{FOOTER-}
{  w[1]:='OBROTY'@;
   w[2]:=sumwn;
   w[3]:=summa;
   w[4]:='';
   rsep:=1; ~~}
{SUBSTITUTE: 'LINIA02'}
{  w[1]:='SALDO';
   w[2]:=F.SWn(sumwn,summa);
   w[3]:=F.SMa(sumwn,summa);
   w[4]:='';
   prn1:='PRNF'; ~~}
{SUBSTITUTE: 'LINIAFS'}
{IF: type_of(TAB_SQL)<100}
{<1>{charleft()} 'Brak rekordów z powodu przerwania wykonywania zapytania SQL'@}
{FI}
