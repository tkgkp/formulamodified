:!UTF-8
{TITLE:C. Wydruk zadań dla kierowcy}
{PRINTER: exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1}
{BEGIN:

   ZLP.cntx_psh();
   TR_NZL.cntx_psh();
   _ilekol:=7;
   VAR_DEL.delete('BARCODE_TYPE','BARCODE_H');
   BARCODE_TYPE:=exec('barcode_type','kody_kresk');
   BARCODE_H:=exec('barcode_height','kody_kresk');
    VAR_DEL.delete('__todo','__poj');
   {? var_pres('PRN')>100  || obj_del(PRN)  ?}; PRN:=obj_new(@.CLASS.PRINT,_ilekol);  PRN.s_frame();
   {? var_pres('PRNP')>100  || obj_del(PRNP)  ?}; PRNP:=obj_new(@.CLASS.PRINT,_ilekol);  PRNP.s_frame();
   {? var_pres('PRNS')>100 || obj_del(PRNS) ?}; PRNS:=obj_new(@.CLASS.PRINT,2); PRNS.s_frame();

   {? var_pres('w')>100    || obj_del(w)    ?}; w:=obj_new(_ilekol);

   {! _i:=1..._ilekol |! w[_i]:='' !};
   __poj:=tab_tmp(1,'POJ','STRING[10]','Pojemnik',
                       'IL','INTEGER','Ilość');

   'zmienne pomocnicze do wydrukow graficznych';
   color:='';
   prn1:='PRN'; prn2:='PRNS';lp:=0;
   lm:=ll:=vp:=lmt:=0; rsep:=PAR_WYDR.RSEP;
    _tyg:=((TR_NAG.WYJ_D$7*',')-1)+TR_NAG.WYJ_D$7;
   PAR_WYDR.TITLE:='Lista zadań '+TR_NAG.POJAZD().NRREJ+' [dzień:'+$TR_NAG.WYJ_D+' '+_tyg+']'
;~~}
{END:
   ZLP.cntx_pop();
   TR_NZL.cntx_pop();
   VAR_DEL.delete('BARCODE_TYPE','BARCODE_H');
   VAR_DEL.delete('PRN','PRNS','w','PRNP');
   VAR_DEL.delete('__todo','__poj','color','prn1','prn2','lp','lm','ll','vp','lmt','rsep','__getZLP');
~~}
{
   PRN.add("w[1]",5,'Lp.',1);
   PRN.add("w[2]",40,'Adres');
   PRN.add("w[6]",2,'Op');
   PRN.add("w[3]",33,'Opis');
   PRN.add("w[4]",3,'Il');
   PRN.add("w[5]",20,'Pojemnik');
   PRN.add("w[7]",18,'Odpad / WAGA');
~~}
{COMMENT}
   {? QPLTRA.R='B'
   || PRN.add("w[7]",18,'UWAGI')
   || PRN.add("w[7]",18,'Odpad / WAGA')
   ?}
{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{HEADER-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{MACRO: 'LINIA0B'}
{  ll:=lineleft(); ~~}
{IF:  _f:=prn1+'.length()'; _v:=($(_f))();
      ll<(2+_v) & ll<>0}{PAGE}{FI}
{ENTIRE}
{ _f:=prn1+'.ini_line()'; ($(_f))()}
{WHILE: _f:=prn1+'.next()'; ($(_f))()}
{DO}
   {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
{OD}
{IF: var_pres('fun')>=0 & fun<>''}
{  $fun(); ~~}
{FI}
{ENTIRE-}
{MACRO-}
{FONT: 'T8G'}{SPACE: 'C'}
{<{lmt+5}'Samochód : '+TR_NAG.POJAZD().NRREJ+'   plan na dzień '+$TR_NAG.WYJ_D}
{<{lmt+5}'Kierowca : '+TR_NAG.KIER().NAZWISKO + ' '+ TR_NAG.KIER().PIERWSZE}{<{charleft()-36} 'Z- Zabranie, P-Podstawienie, W - Wymiania'}
{ lmt:=int((charleft()-PRN.width())/2);
  lmt:=0;
  vp:=0;~~}
{FONT: 'T10B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}
{FONT: 'T10B'}{SPACE: 'C'}
{ lp:=0; __jest:=0; ~~}
{SUBSTITUTE: 'LINIAF'}
{FOOTER:0}
{SUBSTITUTE: 'LINIAF'}
{FOOTER-}
{FOR: 'TR_NZL'}
{INDEX: 'TR_NAG'}
{PREFIX: TR_NAG.ref(),'no'}
{DO}
{IF:lineleft<=7}{PAGE}{FI}
{LINE:1}
{<{lmt+7}}{ lp+=1; lp }{<{lmt+10}}{BARCODE: TR_NZL.SYM;30;1;'Code 128'}
{FONT: 'T10B'}{SPACE: 'C'}
{<{lmt+14}}{ TR_NZL.SYM }
{ w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[6]:=w[7]:='';~~}
{SUBSTITUTE: 'LINIA01'}
{ w[1]:=lp;
  __getZLP:={? TR_NZL.WHERE='ZLP' || ZLP.use(ref_name(TR_NZL.DOK_REF)); ZLP.seek(TR_NZL.DOK_REF) || 0 ?};
  w[2]:=TR_NZL.MIASTO+' '+TR_NZL.UL+' '+form(exec('trnzl_dom_lokal','transport_wspolne'));
   {? __getZLP
   ||
   VAR_DEL.delete('__memo');
   __memo:=TR_NZL.memo_get('r','OPIS'); _t1:='';
   {? __memo.is_open
   ||
     {!|?
      _t:=fread(__memo);
      _t1+=form(_t);
      _t<>'\n'
     !}
   ?};
   _t1+={? ZLP.GW_OD<>time(0,0,0) | ZLP.GW_DO<>time(0,0,0)
        || 'Godz. '+(ZLP.GW_OD$1)+' - '+(ZLP.GW_DO$1)
        || ''
        ?};
   w[3]:=form(_t1);
   VAR_DEL.delete('__memo');
      w[4]:=ZLP.IL;
      w[5]:=((ZLP.MJ().KTM+'                                  ')+20)+ZLP.MJ().N;
      w[6]:=ZLP.RODZ;
      w[7]:=ZLP.ODP().KOD+'   waga______________';
      {? ZLP.IDBIG<>0
      ||
         w[7]:=$ZLP.IDBIG
      ?}
   || w[3]:='';
      w[4]:=TR_NZL.IL_SZT;
      w[5]:={? TR_NZL.KTM<>''
            || TR_NZL.KTM+' '+exec('FindInSet','#table','M','MATKTM',TR_NZL.KTM,,"@.M.N",1,,'')
            || ''
            ?};
      w[6]:=TR_NZL.RODZ;
      w[7]:=''
   ?};
   color:='';
   ~~}
{SUBSTITUTE: 'LINIA0B'}
{ {! _i:=1..7 |! w[_i]:='' !};
   {? __getZLP
   ||
     w[1]:=ZLP.POS().DZI().KOD;
     w[5]:='Nr ewid:';
     {? ZLP.RODZ='W' || w[5]+=ZLP.POJ().KOD
     |? ZLP.RODZ='Z' || w[5]+=ZLP.POJ().KOD
     ?};
     {? ZLP.MJ().KTM*'BB' || w[5]:=ZLP.POS().DZI().NAZ ?}
   ?};
~~}
{ w[2]:={? TR_NZL.KH_ODB<>null || TR_NZL.KH_ODB().NAZ || '' ?} + {? TR_NZL.TEL<>'' || ' tel.'+TR_NZL.TEL || '' ?};~~}
{SUBSTITUTE: 'LINIA0B'}
{SUBSTITUTE: 'LINIAF'}
{OD}
{FOOTER:0}
{FOOTER-}
{LINE:5}
{FONT: 'T8G'}{SPACE: 'C'}
{'Kierowca Imię i Nazwisko '}{lmt:=60;~~}{<{lmt+5}'Data i podpis kierowcy'}{lmt:=160;~~}{<{lmt+5}'Zakończył Dyspozytor'}
{LINE:3}
{'_________________________'}{lmt:=60;~~}{<{lmt+5}'_______________'}{lmt:=160;~~}{<{lmt+5}'_______________'}