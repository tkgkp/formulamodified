:!UTF-8
{TITLE:E1. Zestawienie pracy pojazdów + zbiornik dodatkowy (kierowcy)}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,5,
   5,5,5,0,1,,'enable'}
{BEGIN:
   VAR_DEL.delete('tryb','kier');
   VAR_DEL.delete('w','wd,''s','k','PRN','PRN2','PRNS','s_tran','sd_tran','TMP_KIER','IDX_KIER','tmp_licz','tmp_kier');
   k :=obj_new(16); "--szerokosci kolumn--";
   w :=obj_new(16); "--wartosci kolumn--";
   wd :=obj_new(16); "--wartosci kolumn dla zb. dodatkowego--";
   s_tran:=obj_new(16); "--podsumowania--";
   sd_tran:=obj_new(16); "--podsumowania dla zb. dodatkowego--";

   {! _i:=1..16 |! s_tran[_i]:=0 !};
   {! _i:=1..16 |! sd_tran[_i]:=0 !};
   {! _i:=1..16 |! w[_i]:=0 !};
   {! _i:=1..16 |! wd[_i]:=0 !};
   {! _i:=1..16 |! k[_i]:=0 !};

   dokl :=2; "--dokladnosc--";
   PRN := obj_new(@.CLASS.PRINT,16); PRN.s_frame();
   PRNS := obj_new(@.CLASS.PRINT,16); PRNS.s_frame();
   tryb:=rep_export();
   kier:='';

   TMP_KIER:=tab_tmp(1,'REF_KIER','INTEGER','Ref kierowcy',
                      'NAZW','STRING[50]','Imię i nazwisko',
                      'JAZDY','REAL','Jazdy',
                      'POBRANO','REAL','Pobrano',
                      'WG_NORMY','REAL','Wg normy',
                      'RZECZYW','REAL','Rzeczywiste',
                      'PRZEPAL','REAL','Przepal',
                      'OSZCZ','REAL','Oszczędność',
                      'D_JAZD','REAL','Jazdy',
                      'D_POBRAN','REAL','Pobrano',
                      'D_WG_NOR','REAL','Wg normy',
                      'D_RZECZY','REAL','Rzeczywiste',
                      'D_PRZEPA','REAL','Przepal',
                      'D_OSZCZ','REAL','Oszczędność');
   IDX_KIER:=TMP_KIER.ndx_tmp(,,'NAZW',,);

   color:=prn1:=prn2:='';
   lm:=ll:=vp:=lmt:=0;rsep:=1;

   k[1]:=5;
   k[2]:=15;
   k[3]:=10;
   k[4]:=10;
   k[5]:=10;
   k[6]:=10;
   k[7]:=10;
   k[8]:=10;
   k[9]:=10;
   k[10]:=10;
   k[11]:=10;
   k[12]:=10;
   k[13]:=10;
   k[14]:=10;
   k[15]:=10;
   k[16]:=13;

   POJAZDY.win_sel('WER');
   ODDZ.index('KOD2');
   ODDZ.prefix();
   oddz:=KARTDROG.ODDZ;

   KARTDROG.WYBKART:='Z';
   KARTDROG.KARTY_OD:=date(KARTDROG.AR,KARTDROG.AM,1);
   KARTDROG.KARTY_DO:=date(KARTDROG.AR,KARTDROG.AM,0);
   KARTDROG.WYB_STAT:='W';
   KARTDROG.win_edit('DRUK');
   {? KARTDROG.edit("{? KARTDROG.WYBKART='Z' & KARTDROG.KARTY_DO<KARTDROG.KARTY_OD
                     || FUN.info('Błędny zakres dat.');
                        'KARTY_DO'
                     || ''
                     ?}")
   || wyjscie:=0
   || wyjscie:=1
   ?}
}
{END:
   VAR_DEL.delete('tryb','kier');
   VAR_DEL.delete('w','wd','s','k','PRN','PRN2','PRNS','s_tran','s_tran','TMP_KIER','IDX_KIER','tmp_licz','tmp_kier');
   VAR_DEL.delete('wyjscie','dokl','oddz');
   VAR_DEL.delete('color','prn1');
   VAR_DEL.delete('lm','ll','vp','lmt','rsep')
}
{IF: wyjscie=1}{EXIT}{FI}
{
{? tryb<>1
|| PRN.add("form(w[1])",k[1],'Lp.')
|| PRN.add("form(kier)",20,'Kierowca')
?};
PRN.add("form(w[2])",k[2],{? tryb<>1 || 'Samochód/ kierowca' || 'Samochód' ?});
{? tryb<>1
|| PRN.add("form(w[3])",k[3],'Licz. pocz.',1);
   PRN.add("form(w[4])",k[4],'Licz. koń.',1)
?};
PRN.add("form(w[5])",k[5],'Zbiornik');
PRN.add("form(w[6],,dokl,'.,')",k[6],'Jazdy',1);
{? tryb<>1
|| PRN.add("form(w[7])",k[7],'Załadunków',1);
   PRN.add("form(w[8],,dokl,'.,')",k[8],'Stan pal. pocz.',1);
   PRN.add("form(w[9],,dokl,'.,')",k[9],'Stan pal. koń.',1);
   PRN.add("form(w[10])",k[10],'Licz. pal. pocz.',1);
   PRN.add("form(w[11])",k[11],'Licz. pal. koń.',1)
?};
PRN.add("form(w[12],,dokl,'.,')",k[12],'Pobrano',1);
PRN.add("form(w[13],,dokl,'.,')",k[13],'Wg normy',1);
PRN.add("form(w[14],,dokl,'.,')",k[14],'Rzeczyw.',1);
PRN.add("form(w[15],,dokl,'.,')",k[15],'Przepał',1);
PRN.add("form(w[16],,dokl,'.,')",k[16],'Oszczędność',1);

PRNS.add("form(s_tran[1])",49,'Razem:');
PRNS.add("form(s_tran[5])",10,'Zbiornik');
PRNS.add("form(s_tran[6],,dokl,'.,')",k[6],'Jazdy',1);
PRNS.add("form(s_tran[7])",k[7],'Załadunków',1);
PRNS.add("form(s_tran[8])",k[8],'Stan pal. pocz.',1);
PRNS.add("form(s_tran[9])",k[9],'Stan pal. koń.',1);
PRNS.add("form(s_tran[10])",k[10],'Licz. pal. pocz.',1);
PRNS.add("form(s_tran[11])",k[11],'Licz. pal. koń.',1);
PRNS.add("form(s_tran[12])",k[12],'Pobrano',1);
PRNS.add("form(s_tran[13],,dokl,'.,')",k[13],'Wg normy',1);
PRNS.add("form(s_tran[14],,dokl,'.,')",k[14],'Rzeczywiste',1);
PRNS.add("form(s_tran[15],,dokl,'.,')",k[15],'Przepał',1);
PRNS.add("form(s_tran[16],,dokl,'.,')",k[16],'Oszczędność',1);

{? KARTDROG.WYBKART='Z'
|| PAR_WYDR.TITLE:='Zestawienie pracy pojazdów (+ zb. dodatkowy)\nza okres od: '+$KARTDROG.KARTY_OD+' do: '+$KARTDROG.KARTY_DO+' (kierowcy)'
|? KARTDROG.WYBKART='M'
|| PAR_WYDR.TITLE:='Zestawienie pracy pojazdów (+ zb. dodatkowy)\nza okres: '+date(KARTDROG.AR,KARTDROG.AM,1)$8+' (kierowcy)'
|| _od:=date(KARTDROG.AR,KARTDROG.AM,1);
   _do:=date(KARTDROG.AR,KARTDROG.AM,0);
   SAMK.index('D2');
   SAMK.prefix();
   {? SAMK.first()
   || _od:=SAMK.D;
      SAMK.last();
      _do:=SAMK.D
   ?};
   PAR_WYDR.TITLE:='Zestawienie pracy pojazdów (+ zb. dodatkowy)\nza okres od: '+$_od+' do: '+$_do+' (kierowcy)'
?};
prn1:='PRN';prn2:='PRN'
;~~}
{IF: POJAZDY.index('NRREJ'); POJAZDY.prefix(REF.FIRMA); POJAZDY.first()=0}{ FUN.info('Brak danych spełniających kryteria.');~~}{EXIT}{FI}
{INCLUDE: wsp_pw.rpi}
{COMMENT}   SIGNATURE                                                {COMMENT-}
{IF: tryb<>1}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}   REPORT-HEADER                                            {COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<{lmt+1}}{'Parametry wydruku:'}
{<{lmt+1}}{'Oddział '+(ODDZ.index('KOD2'); ODDZ.prefix(oddz,oddz); {? ODDZ.first() || ODDZ.NAZ ?})}{<70}{'Status kart drogowych: '}{{? KARTDROG.WYB_STAT='W' || 'wszystkie' |? KARTDROG.WYB_STAT='T' || 'zaakceptowane' |? KARTDROG.WYB_STAT='N' || 'niezaakceptowane' ?}}
{FONT: 'T8GB'}
{SUBSTITUTE: 'TABHEAD'}
{FONT: 'T8G'}{ vp:=1;~~}
{COMMENT}   HEADER                                                   {COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}   FOOTER                                                   {COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{FOOTER-}
{COMMENT}   pozycje wydruku                                          {COMMENT-}
{
rsep:=PAR_WYDR.RSEP;
POJAZDY.win_edit('RED');
w[1]:=0;
prn1:='PRN';prn2:='PRN'
;~~}
{FOR:'POJAZDY'}
{INDEX:'NRREJ'}
{PREFIX: REF.FIRMA}
{DO}
   {
   {? KARTDROG.WYBKART='Z'
   || _od:=KARTDROG.KARTY_OD;
      _do:=KARTDROG.KARTY_DO
   |? KARTDROG.WYBKART='M'
   || _od:=date(KARTDROG.AR,KARTDROG.AM,1);
      _do:=date(KARTDROG.AR,KARTDROG.AM,0)
   || _od:=date(KARTDROG.AR,KARTDROG.AM,1);
      _do:=date(KARTDROG.AR,KARTDROG.AM,0);
      SAMK.index('D2');
      SAMK.prefix();
      {? SAMK.first()
      || _od:=SAMK.D;
         SAMK.last();
        _do:=SAMK.D
      ?}
   ?};
   kier:='';
   w[1] +=1;
   wd[1]:='';
   w[2] :=POJAZDY.NRREJ+'  '+POJAZDY.MAR().NAZ;
   wd[2]:={? tryb=1 || w[2] || '' ?};
   SAMK.index('D');
   SAMK.prefix(POJAZDY.ref());
   _ref_f:=_ref_l:=null;
   _tmp_df:=_tmp_dl:=date(0,0,0);
   _licznip:=0;
   {? SAMK.first()
   || {! |?
         {? _ref_f=null
         || {? (SAMK.D>=_od & SAMK.D<=_do) & (KARTDROG.WYB_STAT='W' | SAMK.STATUS=KARTDROG.WYB_STAT ) & SAMK.STATUS<>'S'
            || _ref_f:=_ref_l:=SAMK.ref();
               _tmp_df:=_tmp_dl:=SAMK.D;
               _licznip:=SAMK.SP
            ?}
         ?};
         {? (SAMK.D>=_od & SAMK.D<=_do) & (SAMK.D>_tmp_dl) & (KARTDROG.WYB_STAT='W' | SAMK.STATUS=KARTDROG.WYB_STAT ) & SAMK.STATUS<>'S'
         || {? SAMK.D=_tmp_df & SAMK.SP<_licznip
            || _licznip:=SAMK.SP;
               _ref_f:=SAMK.ref()
            ?}; 
            _ref_l:=SAMK.ref();
            _tmp_dl:=SAMK.D
         ?};
         SAMK.next()
      !};
      {? _ref_l=null & _ref_f<>null || _ref_l:=_ref_f ?};
      {? _ref_f=null & _ref_l<>null || _ref_l:=null ?}
   ?};
   w[3]:=w[4]:=w[7]:=w[8]:=0;
   w[5]:='Podstawowy';
   wd[5]:='Dodatkowy';
   wd[3]:='';
   wd[4]:='';
   {? _ref_f<>null & SAMK.seek(_ref_f)
   || w[3]:=SAMK.SP;
      w[8]:=SAMK.SPP;
      w[10]:=SAMK.LPP;
      wd[8]:=SAMK.SPP2;
      wd[10]:=SAMK.LPP2
   ?};
   {? _ref_l<>null & SAMK.seek(_ref_l)
   || w[4]:=SAMK.SK;
      w[9]:=SAMK.SKP;
      w[11]:=SAMK.LPK;
      wd[9]:=SAMK.SKP2;
      wd[11]:=SAMK.LPK2
   ?};
   'przebieg na zb. podstawowym';
   w[6]:=exec('oblicz_prz','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'P');
   'przebieg na zb. dodatkowym';
   wd[6]:=exec('oblicz_prz','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'D');
   'zaladunki na zb.podstawowym';
   w[7] :=exec('oblicz_zal','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'P');
   'zaladunki na zb. dodatkowym';
   wd[7] :=exec('oblicz_zal','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'D');
   'pobrano dla zb. podstawowego';
   w[12] :=exec('i_palz_m','karty_drog',POJAZDY.ref(),'P',_od,_do,KARTDROG.WYB_STAT);
   'pobrano dla zb. dodatkowego';
   wd[12] :=exec('i_palz_m','karty_drog',POJAZDY.ref(),'D',_od,_do,KARTDROG.WYB_STAT);
   'wg normy dla zb. podstawowego';
   w[13]:=exec('i_paln_m','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'P');
   'wg normy dla zb. dodatkowego';
   wd[13]:=exec('i_paln_m','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'D');
   'rzeczywiste dla zb. podstawowego';
   w[14]:=exec('oblicz_rzecz','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'P');
   'rzeczywiste dla zb. dodatkowego';
   wd[14]:=exec('oblicz_rzecz','karty_drog',POJAZDY.ref(),_od,_do,KARTDROG.WYB_STAT,'D');
   'Przepal/oszczednosc dla zb. podstawowego';
   _zu:=w[14]-w[13];
   w[15]:=w[16]:=0;
   {? _zu>0 || w[15]:=|(_zu)
   |? _zu<0 || w[16]:=|(_zu)
   ?};
   'Przepal/oszczednosc dla zb. dodatkowego';
   _zu:=wd[14]-wd[13];
   wd[15]:=wd[16]:=0;
   {? _zu>0 || wd[15]:=|(_zu)
   |? _zu<0 || wd[16]:=|(_zu)
   ?};

   SAMK.cntx_psh();
   SAMK.index('D');
   SAMK.prefix(POJAZDY.ref());
   P_KAP.index('K');
   {? SAMK.first()
   || {! |?
         {? (SAMK.D>=_od & SAMK.D<=_do) & (KARTDROG.WYB_STAT='W' | KARTDROG.WYB_STAT=SAMK.STATUS) & SAMK.STATUS<>'S'
         || P_KAP.prefix(SAMK.ref(),'T');
            {? P_KAP.first()
            || _temp:=0;
               {! |?
                  _temp+=P_KAP.PRZEBIEG;
                  P_KAP.next()
               !};
               P_KAP.first();
               {! |?
                  {? ~TMP_KIER.find_key(#P_KAP.OSOBA)
                  || _new:=1;
                     TMP_KIER.blank();
                     TMP_KIER.REF_KIER:=#P_KAP.OSOBA;
                     TMP_KIER.NAZW:='   '+P_KAP.OSOBA().NAZWISKO+' '+P_KAP.OSOBA().PIERWSZE
                  || _new:=0
                  ?};
                  'jesli podano przebiegi dla kierowcow to wg nich jesli nie to proporcjonalnie do liczby kierowcow';
                  {? _temp<>0
                  || {? (SAMK.SK-SAMK.SP)>0
                     || _udzial:=P_KAP.PRZEBIEG/(SAMK.SK-SAMK.SP)
                     || _udzial:=0
                     ?}
                  || _udzial:=1/P_KAP.size()
                  ?};
                  TMP_KIER.JAZDY+=((SAMK.SK-SAMK.SP)*_udzial);
                  _pobrano:=exec('i_palz','karty_drog',POJAZDY.ref(),'P');
                  TMP_KIER.POBRANO+=_pobrano*_udzial;
                  TMP_KIER.WG_NORMY+=SAMK.Z_NORMA*_udzial;
                  TMP_KIER.RZECZYW+=SAMK.Z_RZECZ*_udzial;

                  TMP_KIER.D_JAZD+=((SAMK.PRZ2)*_udzial);
                  _pobrano:=exec('i_palz','karty_drog',POJAZDY.ref(),'D');
                  TMP_KIER.D_POBRAN+=_pobrano*_udzial;
                  TMP_KIER.D_WG_NOR+=SAMK.ZD_NORMA*_udzial;
                  TMP_KIER.D_RZECZY+=SAMK.ZD_RZECZ*_udzial;

                  {? _new || TMP_KIER.add() || TMP_KIER.put() ?};
                  P_KAP.next()
               !}
            ?}
         ?};
         SAMK.next()
      !}
   ?};
   SAMK.cntx_pop();

   TMP_KIER.for_each("_zu:=(TMP_KIER.RZECZYW-TMP_KIER.WG_NORMY);
                      {? _zu>0 || TMP_KIER.PRZEPAL:=|(_zu)
                      |? _zu<0 || TMP_KIER.OSZCZ:=|(_zu)
                      ?};
                      _zu:=(TMP_KIER.D_RZECZY-TMP_KIER.D_WG_NOR);
                      {? _zu>0 || TMP_KIER.D_PRZEPA:=|(_zu)
                      |? _zu<0 || TMP_KIER.D_OSZCZ:=|(_zu)
                      ?};
                      TMP_KIER.put()");

   s_tran[6]+=w[6];
   s_tran[7]+=w[7];
   s_tran[12]+=w[12];
   s_tran[13]+=w[13];
   s_tran[14]+=w[14];
   s_tran[15]+=w[15];
   s_tran[16]+=w[16];

   sd_tran[6]+=wd[6];
   sd_tran[7]+=wd[7];
   sd_tran[12]+=wd[12];
   sd_tran[13]+=wd[13];
   sd_tran[14]+=wd[14];
   sd_tran[15]+=wd[15];
   sd_tran[16]+=wd[16]
   ;~~}
   {FONT: 'T8GB'}{SPACE: 'C'}
   {IF: tryb<>1 | TMP_KIER.size()<=0}
   {SUBSTITUTE:'LINIA0'}
   {FI}
   {FONT: 'T8G'}{SPACE: 'C'}
   {tmp_licz:=w[1];~~}
   {
   w[1]:='';
   w[2]:=wd[2];
   w[3]:=wd[3];
   w[4]:=wd[4];
   w[5]:=wd[5];
   w[6]:=wd[6];
   w[7]:=wd[7];
   w[8]:=wd[8];
   w[9]:=wd[9];
   w[10]:=wd[10];
   w[11]:=wd[11];
   w[12]:=wd[12];
   w[13]:=wd[13];
   w[14]:=wd[14];
   w[15]:=wd[15];
   w[16]:=wd[16];
   kier:='';
   ~~}
   {IF: tryb<>1 | TMP_KIER.size()<=0}{SUBSTITUTE:'LINIA0'}{FI}
   {IF: TMP_KIER.size()>0}
       {tmp_kier:=0;~~}
       {FOR: 'TMP_KIER'}{INDEX: IDX_KIER}
       {DO}
          {IF: tryb<>1}
         {tmp_kier+=1;
          w[1]:=$tmp_licz+'.'+$tmp_kier;
          w[2]:=TMP_KIER.NAZW;
          w[3]:='';
          w[4]:='';
          w[5]:='Podstawowy';
          w[6]:=TMP_KIER.JAZDY;
          w[7]:='';
          w[8]:='';
          w[9]:='';
          w[10]:='';
          w[11]:='';
          w[12]:=TMP_KIER.POBRANO;
          w[13]:=TMP_KIER.WG_NORMY;
          w[14]:=TMP_KIER.RZECZYW;
          w[15]:=TMP_KIER.PRZEPAL;
          w[16]:=TMP_KIER.OSZCZ
          ;~~}
         {SUBSTITUTE:'LINIA0'}
         {
          w[1]:='';
          w[2]:='';
          w[3]:='';
          w[4]:='';
          w[5]:='Dodatkowy';
          w[6]:=TMP_KIER.D_JAZD;
          w[7]:='';
          w[8]:='';
          w[9]:='';
          w[10]:='';
          w[11]:='';
          w[12]:=TMP_KIER.D_POBRAN;
          w[13]:=TMP_KIER.D_WG_NOR;
          w[14]:=TMP_KIER.D_RZECZY;
          w[15]:=TMP_KIER.D_PRZEPA;
          w[16]:=TMP_KIER.D_OSZCZ
         ;~~}
         {SUBSTITUTE:'LINIA0'}
          {ELSE}
         {kier:=TMP_KIER.NAZW;
          tmp_kier+=1;
          w[1]:=$tmp_licz+'.'+$tmp_kier;
          w[3]:='';
          w[4]:='';
          w[5]:='Podstawowy';
          w[6]:=TMP_KIER.JAZDY;
          w[7]:='';
          w[8]:='';
          w[9]:='';
          w[10]:='';
          w[11]:='';
          w[12]:=TMP_KIER.POBRANO;
          w[13]:=TMP_KIER.WG_NORMY;
          w[14]:=TMP_KIER.RZECZYW;
          w[15]:=TMP_KIER.PRZEPAL;
          w[16]:=TMP_KIER.OSZCZ
          ;~~}
         {SUBSTITUTE:'LINIA0'}
         {
          w[1]:='';
          w[3]:='';
          w[4]:='';
          w[5]:='Dodatkowy';
          w[6]:=TMP_KIER.D_JAZD;
          w[7]:='';
          w[8]:='';
          w[9]:='';
          w[10]:='';
          w[11]:='';
          w[12]:=TMP_KIER.D_POBRAN;
          w[13]:=TMP_KIER.D_WG_NOR;
          w[14]:=TMP_KIER.D_RZECZY;
          w[15]:=TMP_KIER.D_PRZEPA;
          w[16]:=TMP_KIER.D_OSZCZ
         ;~~}
         {SUBSTITUTE:'LINIA0'}
          {FI}
       {OD}
       {TMP_KIER.erase();{! _i:=2..16 |! w[_i]:=0; wd[_i]:=0 !};~~}
   {FI}
   {w[1]:=tmp_licz;~~}
{OD}
{COMMENT}------------------------------Podsumowanie------------------{COMMENT-}
{IF: tryb<>1}
{IF: lineleft()<>0 & lineleft()<6}{PAGE}{FI}
{FOOTER}{FOOTER-}
{FONT: 'T8GB'}{SPACE: 'C'}
{prn1:='PRN';prn2:='PRNS';
 s_tran[1]:='Razem:';
 s_tran[2]:='';
 s_tran[3]:='';
 s_tran[4]:='';
 s_tran[5]:='Podstawowy';
 s_tran[8]:='';
 s_tran[9]:='';
 s_tran[10]:='';
 s_tran[11]:=''
; ~~}
{SUBSTITUTE: 'LINIA02'}
{
 s_tran[1]:='';
 s_tran[2]:='';
 s_tran[3]:='';
 s_tran[4]:='';
 s_tran[5]:='Dodatkowy';
 s_tran[6]:=sd_tran[6];
 s_tran[7]:=sd_tran[7];
 s_tran[8]:='';
 s_tran[8]:='';
 s_tran[10]:='';
 s_tran[11]:='';
 s_tran[12]:=sd_tran[12];
 s_tran[13]:=sd_tran[13];
 s_tran[14]:=sd_tran[14];
 s_tran[15]:=sd_tran[15];
 s_tran[16]:=sd_tran[16];
 prn1:='PRNS';prn2:='PRNS'; vp:=0; ~~}
{SUBSTITUTE: 'LINIA02'}
{prn1:='PRNS';prn2:='PRN'; vp:=0; ~~}
{REP: _f:=prn1+'.flbar(lmt)'; ($(_f))()}
{FI}