:!UTF-8
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vatrej7.rpi
Utworzony:   2021-09-23 [IFZ]
==================================================
Zawartosc: Plik wykorzystywany w wydruku Rejestr dostaw towarów i świadczenia usług w ramach UE
tryb=4 - 'Rejestr sprzedazy VAT'
{COMMENT-}
{ {? var_press('WAL',VAT7)<0 || exec('par_1','!fks_vat_zrej') || exec('par_6','!fks_vat_zrej') ?};~~}
{ {? VAT7.WYD_TECH || PAR_WYDR.HEAD:=PAR_WYDR.LOGO:=0 ?}; colspan:=0;~~}
{ szer[1]:=4; szer[2]:=4; szer[3]:=szer[4]:=1; szer[5]:=13;
  szer[6]:=20; szer[7]:=11; szer[8]:=16; szer[9]:=50;
  szer[10]:=5; szer[11]:=7; szer[12]:=szer[14]:=18; szer[16]:=szer[18]:=18;
  szer[13]:=14; szer[17]:=14;
  szer[15]:=64;
  {? +param8>0
  || _szer:={? +param8>0 || 8 || 0 ?}
  || _szer:=0
  ?};
  szer[5]-=_szer;
  {? ~rep_expo()
  || PRN.add("w[1]",szer[1],' Lp.',1); colspan:=colspan+1
  ?}; w[18]:='';
  PRN.add("w[2]",szer[2],'Kraj opodatk.');
  PRN.add("w[3]",szer[3],'WDT');
  PRN.add("w[4]",szer[4],'WDU');
  {? rep_expo()
  || PRN.add("w[43]",12,'Rej. VAT');colspan:=colspan+1;
     PRN.add("w[33]",12,'Pozycja',,'#');colspan:=colspan+1;
     PRN.add("w[42]",12,'Symbol dokumentu',,'#');colspan:=colspan+1;
     PRN.add("w[26]",12,'Termin płatności',,'#');colspan:=colspan+1
  || PRN.add("w[5]",szer[5],'Rej. VAT/ pozycja');
     PRN.add("w[6]",szer[6],'Symbol dokumentu/#Termin płatności',,'#')
  ?};
  {? VAT7.PAR2=2
  || {? rep_expo()
     || PRN.add("w[27]",13,'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[28]",13,'Data wystawienia',,'#');colspan:=colspan+1
     || PRN.add("w[7]",szer[7],'D. zapisu/#wystawienia',,'#')
     ?}
  || {? rep_expo()
     || PRN.add("w[27]",13,'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[28]",13,'Data wystawienia',,'#');colspan:=colspan+1
     || PRN.add("w[7]",szer[7],'D. zapisu/#wystawienia',,'#')
     ?}
   ?};

{? rep_expo()
|| {? OPERATOR.DEPT=null|| PRN.add("w[30]",szer[8],'Jednostka księgowa',,'#');colspan:=colspan+1?};
   PRN.add("w[31]",13,' Rej. księg.',,'#');colspan:=colspan+1;
   PRN.add("w[32]",13,'Pozycja',,'#');colspan:=colspan+1
|| PRN.add("w[8]",szer[8],{? OPERATOR.DEPT=null||'Jednostka.Ks#'||''?}+'Rej. księg./#'+' pozycja',,'#')
?};
{? rep_expo()
|| PRN.add("w[41]",szer[9],'Kontrahent - nazwa, siedziba, numer identyfikacyjny'+{? grupa_vat='SprPKWSU' | grupa_vat='SprPozKr' ||', nazwa usługi'||''?});colspan:=colspan+1
|| PRN.add("w[9]",szer[9], 'Kontrahent - nazwa, siedziba, numer identyfikacyjny'+{? grupa_vat='SprPKWSU' | grupa_vat='SprPozKr' ||', nazwa usługi'||''?})
?};

{? param7<>''
|| PRN.add("w[51]",13,'Procedury',)
?};
PRN.add("w[10]",szer[10],'Wal. opod.',,'#');
PRN.add("w[11]",8,'Kurs EUR',1);

PRN.add("w[12]",szer[12],'       Netto',1);
PRN.add("w[13]",szer[13],'VAT',1);
PRN.add("w[14]",szer[14],'       Brutto',1);
PRN.add("w[15]",szer[11],'% VAT',1);
PRN.add("w[16]",szer[16],'   Netto EUR',1);
PRN.add("w[17]",szer[17],'VAT EUR',1);
 PRN1.add("ww[1]",szer[1]+szer[2]+szer[3]+szer[4]+szer[5]+szer[6]+szer[7]+szer[8]+szer[9]+szer[10]+szer[11]+szer[12]+szer[13]++szer[14]+14+_szer,'',,,,,,,,colspan);
 PRN1.add("ww[2]",szer[11],'',1);
 PRN1.add("ww[3]",szer[16],'',1);
 PRN1.add("ww[4]",szer[17],'',1);~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}{IF: ~VAT7.WYD_TECH}{LINE: 1}{FI}
{SUBSTITUTE: 'HEAD'}{FONT: 'W8'}{SPACE: 'C'}{IF: page=1}
{<3 'Parametry wydruku:'}
{<6 'Jednostka księgowa: '+{? OPERATOR.DEPT || OPERATOR.DEPT().OD || 'wszystkie jednostki księgowe' ?}+{? VAT7.TYPOKR='M' || '   Rodzaj okresu: '+{? SSTALE.AO().ZAM='T'||'zamknięty'||'otwarty'?} || '' ?}}
{IF: ~VAT7.WYD_TECH}{IF: dokvpoch<>''}{<6 dokvpoch}{FI}
{IF: kraj<>' ' & wal_op=' '}
{<6 'Kraj opodatkowania: '+kraj+{? wal_op<>'' || '   Waluta opodatkowania: wszystkie waluty' || '' ?}}
{ELIF: kraj=' ' & wal_op<>' '}
{<6 'Kraj opodatkowania: wszystkie kraje oprócz PL'+{? wal_op<>'' || '   Waluta opodatkowania: '+wal_op || '' ?}}
{ELIF: kraj=' ' & wal_op=' '}
{<6 'Kraj opodatkowania: wszystkie kraje oprócz PL'+ '   Waluta opodatkowania: wszystkie waluty'}
{ELSE}
{<6 'Kraj opodatkowania: '+kraj+{? wal_op<>'' || '   Waluta opodatkowania: '+wal_op || '' ?}}
{FI}
{IF: param1<>''}{<6 param1}{FI}
{IF: param2<>''}{<6 param2}{FI}
{IF: param3<>''}{<6 param3}{FI}
{IF: param4<>''}{<6 param4}{FI}
{IF: param7<>''}{<6 param7}{FI}
{FI}{FI}
{LINE: 1}{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{IF: page=1}{REP: PRN.fbar()}{FI}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------MACRO-LINIA------------------{COMMENT-}
{MACRO: 'LINIA'}
{IF: ~font_gr}{IF: s2c}{FONT: 'T8U'}{ELSE}{FONT: 'T8G'}{FI}{ELSE}{FONT: 'T8GB'}{FI}{ PRN.setcolor('255:255:255');~~}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{ vp:=0; PRN.setcolor('255:255:255'); ~~}
{REP: PRN.fline()}
{OD}{ vp:=0; PRN.setcolor(color); ~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINIA1------------------{COMMENT-}
{MACRO: 'LINIA1'}
{IF: ~font_gr}{FONT: 'T8G'}{ELSE}{FONT: 'T8GB'}{FI}{ PRN1.setcolor('255:255:255');~~}
{PRN1.ini_line()}
{WHILE: PRN1.next()}
{DO}
{REP: PRN1.fline()}
{OD}{ vp:=0; PRN1.setcolor(color); ~~}
{MACRO-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{SPACE: 'C'}
{IF: VAT7.WY3}
{FOOTER: 0}{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{REP: PRN1.fhbar()}{ww[1]:='   SUMA STRONY'; ww[2]:=''; ww[3]:= form(sstr8,,2,' ,'); ww[4]:= form(sstr9,,2,' ,');  ww[5]:= form(sstr10,,2,' ,');  ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{IF: page>1}{ww[1]:='   Z PRZENIESIENIA';  ww[2]:=''; ww[3]:=form((suma8-sstr8),,2,' ,'); ww[4]:=form((suma9-sstr9),,2,' ,'); ww[5]:=form((suma10-sstr10),,2,' ,');  ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{FI}{ww[1]:='   DO PRZENIESIENIA';  ww[2]:=''; ww[3]:=form(suma8,,2,' ,'); ww[4]:=form(suma9,,2,' ,');  ww[5]:=form(suma10,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.flbar()}{ELSE}{PRN1.lbar()}{FI}{ sstr7:=sstr8:=sstr9:=sstr10:=0; vp:=1;~~}
{FOOTER-}
{ELSE}
{FOOTER: 0}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}{ vp:=1;~~}
{FOOTER-}
{FI}
{COMMENT}------------------------------MACRO-SUMASTR----------------{COMMENT-}
{MACRO: 'SUMASTR'}
{  {? DVAT.USUNIETY
   || is_us:=1;
      {! _a:=1 ..sizeslo
      |! su[_a][1]+=tne[_a]; su[_a][2]+=tve[_a]; su[_a][3]+=tv1e[_a]; su[_a][4]+=tbe[_a];
         ssu[1]+=tne[_a]; ssu[2]+=tve[_a]; ssu[3]+=tv1e[_a]; ssu[4]+=tbe[_a]
      !}
   || {! _a:=1 ..sizeslo
      |! sstr8+=tne[_a]; suma8+=tne[_a]; sstr9+=tve[_a]; suma9+=tve[_a]; sstr10+=tbe[_a]; suma10+=tbe[_a]
      !}
   ?}; ~~}
{MACRO-}
{COMMENT}------------------------------MACRO-PETLA------------------{COMMENT-}
{MACRO: 'PETLA'}
{IF: 6+DVAT.RVAT().KVAT().SYM='_WWspD' & DVAT.KRAJ().KOD<>'PL'}
{ dat_zapl:=date(0,0,0);
  _a:=DVAT.DOKOKRO().ROK().KOD+form(DVAT.DOKOKRO().NR,-2);
  DOK.use('doku'+_a); POZ.use('pozy'+_a); POW.use('pow_'+_a); VPOZ.use('pozv'+_a); VPOZ_ROZ.use('pozr'+_a);
  DOK.prefix(); DVAT.DOK();~~
}
{IF: (VAT7.WY4<>0 & (VAT7.WY4=1 & {? VAT7.JPK_GTU='' || 1
                                  |? VAT7.JPK_GTU*'BRAK'>0 & DVAT.DOK().JPK_GTU='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_GTU,DVAT.DOK().JPK_GTU)
                                  ?})) |
     (VAT7.WY5<>0 & (VAT7.WY5=1 & {? VAT7.JPK_PROC='' || 1
                                  |? VAT7.JPK_PROC*'BRAK'>0 & DVAT.DOK().JPK_PROC='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_PROC,DVAT.DOK().JPK_PROC)
                                  ?})) |
     (VAT7.WY6<>0 & (VAT7.WY6=1 & {? VAT7.JPK_TD='' || 1
                                  |? VAT7.JPK_TD*'BRAK'>0 & DVAT.DOK().JPK_V_T='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_TD,DVAT.DOK().JPK_V_T)
                                  ?})) |
     (VAT7.WY4=0 & VAT7.WY5=0 & VAT7.WY6=0)
                                  }
{IF: tryb<>3 | ~VAT7.TYLKOZAP | (VAT7.TYLKOZAP & dat_zapl<>date(0,0,0) & dat_zapl<=VAT7.DAT_ZAPL)}
{IF: exec('chk_okr_vat','!fks_vat_zrej')}
    {IF: ((VAT7.PAR2=2) & (-DOK.DOK_REJ().KOR='n')) |
           ((VAT7.PAR2=1) & (-DOK.DOK_REJ().KOR='t')) |
           (VAT7.PAR2=3)}
   { kor:=DOK.DOK_REJ().KOR='T'; lp+=1;
     w[1]:=$lp;
     w[2]:=DVAT.KRAJ().KOD;
     w[5]:=w[43]:=DVAT.RVAT().SYM;
     w[6]:=DVAT.SYM1;
     w[7]:=DVAT.DAT1$1;
     DVAT.DOK().REJ();
     w[8]:={? OPERATOR.DEPT=null
           || REJ.ODD().OD
           || REJ.KOD+(8-(+REJ.KOD))*' '+form(DVAT.DOK().NR,szer[8]-8,,'99')
           ?};
     w[10]:=DVAT.WAL().KOD;
     w[25]:=$DVAT.NR;
     w[26]:='';

     w[27]:=DVAT.DAT1$1;
     w[28]:=DVAT.DAT2$1;
     w[29]:=DVAT.DAT4$1;
     w[30]:=REJ.ODD().OD;
     w[31]:=REJ.KOD;
     w[32]:=$DVAT.DOK().NR;
     w[33]:=$DVAT.NR;
     w55:=w[41]:=exec('szukkh','!fks_vat_zrej');
     w[42]:=DVAT.SYM1;
     w[50]:='';
     {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
     {? param7<>'' || w[51]:=DVAT.DOK().JPK_PROC;  w[51]:=STR2.gsub(w[51],',',', ') || w[51]:='' ?};
     w[52]:='';
     ok:=0;~~
    }
    {FOR: 'PVAT'}
    {INDEX: 'DVAT_ST'}
    {PREFIX: DVAT.ref}
    {DO}
      {IF: exec('typ_okr_vat','!fks_vat_zrej',2) & (VAT7.ZERO | PVAT.VAT<>0)}
       { ok:=1; _grupa:=PVAT.GRVAT().KOD;
        {? DVAT.WAL().KOD<>'EUR'
        || _wal:=exec('FindInSet','#table','SLO','SL',DVAT.WAL().KOD,FINFO.SLWAL().SLU,,1);
           KRS.cntx_psh();
           KRS.index('KRS_WAL'); KRS.prefix(VAT7.TKRS,_wal);
           _kurs:={? KRS.first() & KRS.SR || KRS.SR || 1 ?};
           KRS.cntx_pop()
        || _kurs:=1
        ?};
        {! _a:=1 ..sizeslo
        |! {? PVAT.STVAT().KOD=tvat[_a]
           ||
' oznaczenie w tabeli tymczasowej stawek, dla których są wartości ';
              {?  VAT7.KRAJ=null() & var_pres('TmpStVat')>0 & TmpStVat.find_key(tvat[_a]) || TmpStVat.USE:=1; TmpStVat.put() ?};
              tv[_a]+=PVAT.VAT; _net_odl:=PVAT.SUM2; {? DVAT.USUNIETY=0 || sv[_a]+=PVAT.VAT ?};
              tn[_a]+=_net_odl;  tb[_a]+=PVAT.SUM1;
              {? DVAT.USUNIETY=0 || sn[_a]+=_net_odl;  sb[_a]+=PVAT.SUM1 ?};
' kwoty w EUR ';
              tve[_a]+=(PVAT.VAT/_kurs)$2;
              _net_odl:=(PVAT.SUM2/_kurs)$2; {? DVAT.USUNIETY=0 || sve[_a]+=(PVAT.VAT/_kurs)$2 ?};
              tne[_a]+=_net_odl;
              tbe[_a]+=(PVAT.SUM2/_kurs)$2+(PVAT.VAT/_kurs)$2;
              {? DVAT.USUNIETY=0 || sne[_a]+=_net_odl;  sbe[_a]+=(PVAT.SUM2/_kurs)$2+(PVAT.VAT/_kurs)$2 ?};
              _co:=exec('pvat_towar_usluga','fks_ved');
              tt[_a]:={? _co='T' || 'T' || 'N' ?};
              tu[_a]:={? _co='U' || 'T' || 'N' ?};
              tk[_a]:=_kurs
           ?}
        !};
        {? DVAT.USUNIETY=0 & VAT7.WY2 & dat_zapl<>date(0,0,0) & dat_zapl<=VAT7.DAT_ZAPL
        || w[22]+=PVAT.VAT; w[21]+=PVAT.SUM2;
            w[23]+=PVAT.SUM1
        ?};~~
        }
      {FI}
    {OD}
{COMMENT}----------------------WYDRUK-------------------------------------------------{COMMENT-}
{IF: ok}
{{? ~rep_expo()
 || STR2.split(w[50]);
    STR3.split(w[51]) ?}; _pom:=1;
  ile_l:=exec('ilelinii','rozrach',w55,szer[9]);
  {! _i:=1..sizeslo |!  {? tn[_i]$2<>0 | tv[_i]$2<>0 | tv1[_i]$2<>0 | tb[_i]$2<>0 || _pom+=1 ?} !};
  {? (tryb<>4 | kor | ile_l>=3) &  _pom<4
  || _pom:=4
  |?  ~(tryb<>4 | kor | ile_l>=3)
  || _pom:=3
  ?}; {? _pom>lineleft() || vp:=1 || vp:=0 ?};
  STR.split(w55); w[9]:=STR.line(szer[9]);~~}
{ENTIRE}{pom:=1; ~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0)}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
   ||  w[4]:=tt[pom]; w[3]:=tu[pom]; w[15]:=form(tvat[pom],,2,' ,'); w[12]:=form(tn[pom],,2,' ,'); w[13]:=form(tv[pom],,2,' ,');  w[14]:=form(tb[pom],,2,' ,');
       w[11]:=form(tk[pom],,4,' ,'); w[16]:=form(tne[pom],,2,' ,'); w[17]:=form(tve[pom],,2,' ,');
       {? rep_expo()
        || w[1]:=w[43]:=DVAT.RVAT().SYM;
           w[25]:=$DVAT.NR;
           w[42]:=DVAT.SYM1;
           w[26]:=$DOK.D3;
           w[27]:=DVAT.DAT1$1;
           w[28]:=DVAT.DAT2$1;
           w[29]:=DVAT.DAT4$1;
           w[30]:=REJ.ODD().OD;
           w[31]:=REJ.KOD;
           w[32]:=$DVAT.DOK().NR;
           w[33]:=$DVAT.NR;
           w[51]:=DVAT.DOK().JPK_PROC;
           w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
        ?};
       pom+=1
   ||  w[10]:=w[41]:=''; w[11]:=''; w[15]:=form(0,,4,' ,');w[12]:=w[13]:=w[14]:=w[15]:=w[16]:=w[17]:=form(0,,2,' ,')
   ?};~~}
{IF: linijka}{IF: vp | rep_expo()}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}{FI}{ linijka:=1;numer+=1;s2c:=DVAT.USUNIETY;~~}
{IF: ~rep_expo()}{w[50]:=STR2.line(6); w[51]:=STR3.line(szer[8]);~~}{FI}
{SUBSTITUTE: 'LINIA'}{ dru_rej:=1; w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:=w[50]:=w[51]:=w[52]:='';~~}
{  w[5]:=$DVAT.NR; w[1]:=w[2]:=w[3]:=w[4]:=w[6]:='';
   w[8]:={? OPERATOR.DEPT=null || DVAT.DOK().REJ().KOD+(8-(+DVAT.DOK().REJ().KOD))*' '+form(DVAT.DOK().NR,szer[8]-8,,'99') || ''?};
   w[7]:=''; w[9]:=STR.line(szer[9]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[8]); ile_l-=1; ~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0)}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
   ||   w[4]:=tt[pom]; w[3]:=tu[pom]; w[15]:=form(tvat[pom],,2,' ,');
        w[12]:=form(tn[pom],,2,' ,'); w[13]:=form(tv[pom],,2,' ,'); w[14]:=form(tb[pom],,2,' ,');
        w[16]:=form(tne[pom],,2,' ,'); w[17]:=form(tve[pom],,2,' ,');
        {? rep_expo()
        || w[1]:=w[43]:=DVAT.RVAT().SYM;
           w[2]:=DVAT.KRAJ().KOD;
           w[25]:=$DVAT.NR;
           w[42]:=DVAT.SYM1;
           w[26]:=$DOK.D3;
           w[27]:=DVAT.DAT1$1;
           w[28]:=DVAT.DAT2$1;
           w[29]:=DVAT.DAT4$1;
           w[30]:=REJ.ODD().OD;
           w[31]:=REJ.KOD;
           w[32]:=$DVAT.DOK().NR;
           w[33]:=$DVAT.NR;
           w[51]:=DVAT.DOK().JPK_PROC;
           w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
        ?};
        pom+=1
   ||   w[10]:=w[41]:=w[11]:=w[12]:=w[13]:=w[14]:=w[15]:=w[16]:=w[17]:=''
   ?};~~
}
{ {? DOK.D3<>date(0,0,0) || w[6]:={? ~rep_expo() || $DOK.D3 ?} ?} ; w[7]:={? ~rep_expo() || DVAT.DAT2$1 ?};~~}
{SUBSTITUTE: 'LINIA'}
{ w[50]:=STR2.line(6); w[51]:=STR3.line(szer[8]); w[52]:='';~~ }
 {w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[6]:=w[7]:=w[8]:=w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:='';
 {? kor || w[3]:=w[14]?};w[9]:=STR.line(szer[9]); ile_l-=1; ~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0)}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
   ||   w[4]:=tt[pom]; w[3]:=tu[pom]; w[15]:=form(tvat[pom],,2,' ,');  w[12]:=form(tn[pom],,2,' ,'); w[13]:=form(tv[pom],,2,' ,'); w[14]:=form(tb[pom],,2,' ,');
        w[16]:=form(tne[pom],,2,' ,'); w[17]:=form(tve[pom],,2,' ,');
        {? rep_expo()
        || w[1]:=w[43]:=DVAT.RVAT().SYM;
           w[25]:=$DVAT.NR;
           w[42]:=DVAT.SYM1;
           w[26]:=$DOK.D3;
           w[27]:=DVAT.DAT1$1;
           w[28]:=DVAT.DAT2$1;
           w[29]:=DVAT.DAT4$1;
           w[30]:=REJ.ODD().OD;
           w[31]:=REJ.KOD;
           w[32]:=$DVAT.DOK().NR;
           w[33]:=$DVAT.NR;
           w[51]:=DVAT.DOK().JPK_PROC;
           w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
        ?};
        pom+=1
   ||   w[10]:=w[11]:=w[41]:=w[12]:=w[13]:=w[14]:=w[15]:=w[16]:=w[17]:=w[19]:=''
   ?};~~
}
{SUBSTITUTE: 'LINIA'}{ w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[6]:=w[7]:=w[8]:=w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:=w[50]:=w[51]:=w[52]:=''; ~~}
 {WHILE: pom<=sizeslo}
  {DO}
    {IF: ((tn[pom]$2)<>0)|((tv[pom]$2)<>0)|((tv1[pom]$2)<>0)|((tb[pom]$2)<>0)}
          { w[4]:=tt[pom]; w[3]:=tu[pom]; w[9]:=STR.line(szer[9]); w[15]:=form(tvat[pom],,2,' ,'); w[12]:=form(tn[pom],,2,' ,'); w[13]:=form(tv[pom],,2,' ,'); w[14]:=form(tb[pom],,2,' ,');
            w[16]:=form(tne[pom],,2,' ,'); w[17]:=form(tve[pom],,2,' ,');
           w[51]:=STR3.line(szer[8]); w[50]:=STR2.line(6); ile_l-=1;
           {? rep_expo()
           || w[1]:=w[43]:=DVAT.RVAT().SYM;
              w[25]:=$DVAT.NR;
              w[42]:=DVAT.SYM1;
              w[26]:=$DOK.D3;
              w[27]:=DVAT.DAT1$1;
              w[28]:=DVAT.DAT2$1;
              w[29]:=DVAT.DAT4$1;
              w[30]:=REJ.ODD().OD;
              w[31]:=REJ.KOD;
              w[32]:=$DVAT.DOK().NR;
              w[33]:=$DVAT.NR;
              w[51]:=DVAT.DOK().JPK_PROC;
              w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
           ?};~~}
{SUBSTITUTE: 'LINIA'}
    {FI}
    {w[9]:=''; pom+=1; ~~}
  {OD}
{w[9]:=''; w[10]:=w[41]:=w[11]:=w[12]:=w[13]:=w[14]:=w[15]:=w[16]:=w[17]:=''; w[50]:=STR2.line(6); w[51]:=STR3.line(szer[8]);~~}
 {WHILE: ile_l>0 | (w[50]<>'' | w[51]<>'')}
  {DO}
    {IF: w[9]<>'' | (w[50]<>'' | w[51]<>'')}
{SUBSTITUTE: 'LINIA'}
    {FI}
    {w[9]:=STR.line(szer[9]);w[50]:=STR2.line(6); w[51]:=STR3.line(szer[8]);~~}
    { ile_l-=1; ~~}
  {OD}
  {SUBSTITUTE: 'SUMASTR'}
{ENTIRE-}
{FI}
    {FI}
  {FI}
{FI}
{FI}{FI}
{ {! _a:=1 ..sizeslo |!  tn[_a]:=tv[_a]:=tv1[_a]:=tb[_a]:=tne[_a]:=tve[_a]:=tv1e[_a]:=tbe[_a]:=0 !}; ~~}
{MACRO-}
{COMMENT}----------------------PRZYGOTOWANIE WYDRUKU-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}{ RS.index('RS'); RS.prefix(); ~~}
{FOR: 'RVAT'}
{INDEX: 'RVAT_ESY'}
{PREFIX: REF.FIRMA,'_WWspD'}
{DO}
{IF: {? var_pres('rvat_sym')>0 || RVAT.SYM=rvat_sym || 1 ?}}
{'******************** bez kraju i bez waluty ************************';~~}
   {IF: VAT7.WAL=null() & VAT7.KRAJ=null()}
      {IF: ~OPERATOR.DEPT}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'OSS'}
               {PREFIX: okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {okrVatNr+=1;~~}
         {OD}
      {ELSE}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'OSS_ODD' }
               {PREFIX: OPERATOR.DEPT,okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
               {okrVatNr+=1;~~}
          {OD}
      {FI}
{'******************** bez kraju i z walutą ************************';~~}
{ELIF: VAT7.WAL<>null() & VAT7.KRAJ=null()}
      {IF: ~OPERATOR.DEPT}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'NRWK1'}
               {PREFIX: VAT7.WAL,okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {okrVatNr+=1;~~}
         {OD}
      {ELSE}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'NRW2_O1' }
               {PREFIX: OPERATOR.DEPT,VAT7.WAL,okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
               {okrVatNr+=1;~~}
          {OD}
      {FI}
{'******************** z krajem i bez waluty ************************';~~}
{ELIF: VAT7.WAL=null() & VAT7.KRAJ<>null()}
      {IF: ~OPERATOR.DEPT}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'NR'}
               {PREFIX: VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {okrVatNr+=1;~~}
         {OD}
      {ELSE}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'NRW3_O1' }
               {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
               {okrVatNr+=1;~~}
          {OD}
      {FI}
{'******************** ALL z krajem i walutą ************************';~~}
   {ELSE}
        {IF: ~OPERATOR.DEPT}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'NRW'}
               {PREFIX: VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {okrVatNr+=1;~~}
         {OD}
      {ELSE}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
               {FOR: 'DVAT'}
               {INDEX: 'NR_OW'}
               {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref() }
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {okrVatNr+=1;~~}
         {OD}
      {FI}
   {FI}
{FI}
{IF: dru_rej}
{IF: lineleft<2}{IF: lineleft<>0}{PAGE}{FI}{ vp:=1;~~}{ELSE}{ vp:=0;~~}{FI}{ {! _i:=1..41 |! w[_i]:='' !};~~}
{{? ~rep_expo() || w[50]:=''; w[51]:='' ?};~~}
{FI}
{OD}   {'.... FOR RVAT';~~}
{COMMENT}----------------------------------------FOOTER-LAST----------------------------{COMMENT-}
{linecnt:=lineleft();
{? VAT7.KRAJ=null() || TmpStVat.index(TmpStVat.ndx_tmp(,1,'USE',,0)); TmpStVat.prefix(1); sizeslo:=TmpStVat.size ?};
~~}
{IF: ((page>1 & linecnt<(11+sizeslo)) | (page=1 & linecnt<(7+sizeslo))) & linecnt<>0}
{PAGE}
{FI}
{ _pom:=6+sizeslo;
  {? page>1 & VAT7.WY3 || _pom+=4 ?};
  {? VAT7.WY2 || _pom+=2 ?};
 {? _pom>lineleft() || vp:=1 || vp:=0 ?};~~}
{IF: lineleft=0}{FOOTER}{FOOTER-}{FI}
{DIRECT}{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{REP: PRN1.fhbar()}
{IF: page>1 & VAT7.WY3}
{ww[1]:='   SUMA STRONY'; ww[2]:=''; ww[3]:=form(sstr8,,2,' ,');   ww[4]:=form(sstr9,,2,' ,'); ww[5]:=form(sstr10,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{ww[1]:='   Z PRZENIESIENIA'; ww[2]:=''; ww[3]:=form((suma8-sstr8),,2,' ,'); ww[4]:=form((suma9-sstr9),,2,' ,'); ww[5]:=form((suma10-sstr10),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{FI}
{ww[1]:='   RAZEM'; ww[2]:=''; ww[3]:=form(suma8,,2,' ,');  ww[4]:=form(suma9,,2,' ,'); ww[5]:=form(suma10,,2,' ,');  ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI} {pom:=1; ~~}
{IF: VAT7.KRAJ<>null()}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{ww[1]:='   W TYM:'; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:= form(sve[pom],,2,' ,'); ww[4]:= form(sne[pom],,2,' ,');
  ww[5]:=form(sbe[pom],,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI} {pom+=1; ~~}
{WHILE: pom<=sizeslo}
  {DO}
{ww[1]:=''; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:= form(sne[pom],,2,' ,'); ww[4]:= form(sve[pom],,2,' ,'); ww[5]:=form(sbe[pom]);  ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI}
{pom+=1; ~~}
  {OD}
{FI}
{IF: vp | rep_expo()}{REP: PRN1.flbar()}{ELSE}{PRN1.lbar()}{FI}
{IF: ~rep_expo()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'}
{FI}
{DIRECT-}
{FOOTER}{FOOTER-}