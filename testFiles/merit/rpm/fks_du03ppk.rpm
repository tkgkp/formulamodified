:!UTF-8
{TITLE: Korekta informacji VAT-UE}
{PRINTER: 'port_std',,,,,'Q','C',,,,,,1,0,0,0,0,1,1,'A4'}
{BEGIN:
   sd:=obj_new(12); nd:=obj_new(12); kd:=obj_new(12); td:=obj_new(12);
   sn:=obj_new(12); nn:=obj_new(12); kn:=obj_new(12); tn:=obj_new(12);
   su:=obj_new(12); nu:=obj_new(12); ku:=obj_new(12);
   l:=-1; STR.split(XINFO.NAZ+', '+XINFO.REGON); {! |? l+=1; STR.line(71); STR.next() !};
   us:=-1; STR.split(XINFO.URZAD().NU+', '+XINFO.URZAD().UK+' '+XINFO.URZAD().MU+', '+XINFO.URZAD().UU);
   {! |? us+=1; STR.line(71); STR.next() !};
   i:=j:=ld:=0; fc:=fd:=fe:='';
   NIPY.index('SNIP_F'); NIPY.prefix(REF.S_FIRMA,'PL');
   nipuelic:={? NIPY.first() || 2-NIPY.SNIP || XINFO.NIP ?};
   exec('rpm_as_pdf_ini','rpm_pdf')
}
{END:
   exec('rpm_as_pdf_end','rpm_pdf');
   VAR_DEL.delete('sd','nd','kd','td','sn','nn','kn','tn','su','nu','ku');
   VAR_DEL.delete('nipuelic','i','j','ld','l','us','fc','fd','fe')
}
{  VAT_POZ.index('VAT_POZ'); VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK C');
   ld:=VAT_POZ.size();
   {? VAT_POZ.first || fc:=1+(11-VAT_POZ.LP) ?};
   VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK D');
   _v:=VAT_POZ.size();
   {? VAT_POZ.first || fd:=1+(11-VAT_POZ.LP) ?};
   {? _v>ld || ld:=_v ?};
   VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK E');
   _v:=VAT_POZ.size();
   {? VAT_POZ.first || fe:=1+(11-VAT_POZ.LP) ?};
   {? _v>ld || ld:=_v ?};
   ld:=ceil(ld/12); ~~}
{WHILE: j<ld}
{DO}
{  {! i:=1..12
   |! sd[i]:=nd[i]:=td[i]:=sn[i]:=nn[i]:=tn[i]:=su[i]:=nu[i]:='';
      kd[i]:=kn[i]:=ku[i]:=0
   !};
   i:=1; j+=1; ~~}
{FOR: VAT_POZ}
{INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK C. '+{? #fc || $j || form((j),-2,0,'9.') ?}+' '}
{DO}
{     kd[i]:=VAT_POZ.NETTO$0;
      {? kd[i]
      || nd[i]:=VAT_POZ.OP;  td[i]:=VAT_POZ.Z;
         {? exec('kod_pl','slo_slu',2+nd[i])
         || sd[i]:=2+nd[i]; nd[i]:=2-nd[i]
         ?}
      ?};
      i+=1;
      ~~}
{OD}
{ i:=1; ~~}
{FOR: VAT_POZ}
{INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK D. '+{? #fd || $j || form((j),-2,0,'9.') ?}+' '}
{DO}
{     kn[i]:=VAT_POZ.NETTO$0;
      {? kn[i]
      || nn[i]:=VAT_POZ.OP;  tn[i]:=VAT_POZ.Z;
         {? exec('kod_pl','slo_slu',2+nn[i])
         || sn[i]:=2+nn[i]; nn[i]:=2-nn[i]
         ?}
      ?};
      i+=1;
      ~~}
{OD}
{ i:=1; ~~}
{FOR: VAT_POZ}
{INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK E. '+{? #fe || $j || form((j),-2,0,'9.') ?}+' '}
{DO}
{     ku[i]:=VAT_POZ.NETTO$0;
      {? ku[i]
      || nu[i]:=VAT_POZ.OP;
         {? exec('kod_pl','slo_slu',2+nu[i])
         || su[i]:=2+nu[i]; nu[i]:=2-nu[i]
         ?}
      ?};
      i+=1;
      ~~}
{OD}
{REP: '{INCLUDE: fks_du03ppk1.rpi}'}
{REP: '{INCLUDE: fks_du03ppk2.rpi}'}
{OD}