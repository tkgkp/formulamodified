:!UTF-8
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: korhead.rpi
Utworzony:   2004-04-29[AMK] Artur Makos
==================================================
Zawartosc: Naglowek (adresat i nadawca) dla korespondencji seryjnej
{COMMENT-}
{COMMENT}--------------------------------ADRES Z LEWEJ STRONY--------------------{COMMENT-}
{MACRO: 'KORHEADL'}
{SUBSTITUTE: 'UST_HED'}
{FONT: 'W8B'}{SPACE: 'C'}
{LINE: 3}
{ ilel:=0;~~}
{<3 tab_adr1[1]}{<15 tab_adr[7]}{ licz:=7; licz1:=13;~~}{<60 tab_adr1[2]+' '}{<71 tab_adr[13]}
{WHILE: licz<12 | licz1<15}
{DO}
{ licz+=1; licz1+=1; {? (licz<13 & tab_adr[licz]<>'') | (licz1<18 & tab_adr[licz1]<>'') || ilel+=1 ?};~~}
{IF: licz<13 & tab_adr[licz]<>''}{<15 tab_adr[licz]}{FI}{IF: licz1<18 & tab_adr[licz1]<>''}{<71 tab_adr[licz1]}{FI}
{OD}
{WHILE: ilel<4}
{DO}
{LINE: 1}{ ilel+=1;~~}
{OD}
{ licz:=1; kon:=1; ilel:=0;~~}
{IF: tab_adr[22]<>''}{<3 tab_adr1[3]}{<15 tab_adr[22]}{<60 tab_adr1[3]+' '}{<71 tab_adr[18]}
{ELSE}{<3 tab_adr1[3]}{WHILE: kon & licz<5}{DO}{IF: type_of(tab_adr[licz])=2 & tab_adr[licz]<>''}{<15 tab_adr[licz]}{FI}{ kon:=0;~~}{ licz+=1;~~}{OD}{<60 tab_adr1[3]+' '}{<71 tab_adr[18]}{FI}
{ kon:=1;~~}
{IF: tab_adr[22]=''}
{WHILE: licz<=10}
{DO}
{ {? (licz<3 & (tab_adr[licz]<>'' | ((tab_adr[licz]<>'' | licz=3) & kon=1))) | (licz>=3 & tab_adr[licz+20]<>'')
  || ilel+=1 ?};~~}
{IF: (licz=1 & type_of(tab_adr[licz])=2 & tab_adr[licz]<>'') | (licz=2 & tab_adr[3]<>'')}{<15 tab_adr[licz]}{FI}{IF:
 licz>=3 & type_of(tab_adr[licz+20])=2 & tab_adr[20+licz]<>'' & tab_adr[3]<>''}{<15 tab_adr[licz+20]}{FI}{IF:
 tab_adr[3]='' & licz>=2 & licz<>10 & type_of(tab_adr[licz+21])=2 & tab_adr[21+licz]<>'' }{<15 tab_adr[licz+21]}{FI}{IF:
 licz=2 & tab_adr[19]<>'' & tab_adr[20]<>''}{<71 tab_adr[19]}{ELIF: licz>=2 & licz<=9 & tab_adr[19]<>'' & tab_adr[20]=''
}{<71 tab_adr[licz+29]}{ELIF: licz>=3 & licz<=10 & tab_adr[19]<>'' & tab_adr[20]<>''
}{<71 tab_adr[licz+28]}{ kon:=0;~~}{FI}
{ licz+=1;~~}
{OD}
{WHILE: ilel<8}
{DO}
{LINE: 1}{ ilel+=1;~~}
{OD}
{ELSE}
{WHILE: licz<=10}
{DO}
{ {? (licz<3 & (tab_adr[licz]<>'' | ((tab_adr[licz]<>'' | licz=3) & kon=1))) | (licz>=3 & tab_adr[licz+20]<>'')
  || ilel+=1 ?};~~}
{IF: (licz=1 & type_of(tab_adr[licz])=2 & tab_adr[licz]<>'') | (licz=2 & tab_adr[3]<>'')}{<15 tab_adr[licz]}{FI}{IF:
 licz>=3 & type_of(tab_adr[licz+20])=2 & tab_adr[20+licz]<>'' & tab_adr[3]<>''}{<15 tab_adr[licz+20]}{FI}{IF:
 tab_adr[3]='' & licz>=2 & licz<>10 & type_of(tab_adr[licz+21])=2 & tab_adr[21+licz]<>'' }{<15 tab_adr[licz+21]}{FI}{IF:
 licz=1 & tab_adr[19]<>'' & tab_adr[20]<>''}{<71 tab_adr[19]}{ELIF: licz>=1 & licz<=8 & tab_adr[19]<>'' & tab_adr[20]=''
}{<71 tab_adr[licz+30]}{ELIF: licz>=2 & licz<=9 & tab_adr[19]<>'' & tab_adr[20]<>''
}{<71 tab_adr[licz+29]}{ kon:=0;~~}{FI}
{ licz+=1;~~}
{OD}
{WHILE: ilel<9}
{DO}
{LINE: 1}{ ilel+=1;~~}
{OD}
{FI}
{FONT: 'W8'}
{LINE: 1}
{IF: SER_KOR.TYP<>'I'}{<3 tab_adr1[4]}{<20 KH.KOD}{FI}
{MACRO-}
{COMMENT}--------------------------------ADRES Z PRAWEJ STRONY--------------------{COMMENT-}
{MACRO: 'KORHEADP'}
{SUBSTITUTE: 'UST_HED'}
{FONT: 'W8B'}{SPACE: 'C'}
{LINE: 3}{ ilel:=0;~~}
{<3 tab_adr1[2]}{<15 tab_adr[13]}{ licz:=7; licz1:=13;~~}{<67 tab_adr1[1]+' '}{<78 tab_adr[7]}
{WHILE: licz<12 | licz1<15}
{DO}
{ licz+=1; licz1+=1; {? (licz1<18 & tab_adr[licz1]<>'') | (licz<13 & tab_adr[licz]<>'') || ilel+=1 ?};~~}
{IF: licz1<18 & tab_adr[licz1]<>''}{<15 tab_adr[licz1]}{FI}{IF: licz<13 & tab_adr[licz]<>''}{<78 tab_adr[licz]}{FI}
{OD}{ licz:=1; kon:=1;~~}
{WHILE: ilel<4}
{DO}
{LINE: 1}{ ilel+=1;~~}
{OD}
{IF: tab_adr[22]<>''}{<3 tab_adr1[3]+' '}{<13 tab_adr[18]}{<67 tab_adr1[3]+' '}{<78 tab_adr[22]}
{ELSE}{<3 tab_adr1[3]+' '}{<13 tab_adr[18]}{WHILE: kon & licz<5}{DO}{IF: type_of(tab_adr[licz])=2 & tab_adr[licz]<>''}{<67 tab_adr1[3]+' '}{<78 tab_adr[licz]}{FI}{ kon:=0;~~}{ licz+=1;~~}{OD}{FI}
{ kon:=1; ilel:=0;modyf:=0;~~}
{IF: tab_adr[22]=''}
{WHILE: licz<=10}
{DO}
{ {? (licz<3 & type_of(tab_adr[licz])=2 & (((tab_adr[licz]<>'' | licz=3) & kon=1) | (tab_adr[licz]<>''))) | (licz>=3 & type_of(tab_adr[licz+20])=2 & tab_adr[licz+20]<>'') || ilel+=1 ?};~~}
{ {? modyf=0 & licz=3 & tab_adr[19]<>'' || licz:=2; modyf:=1 ?};~~}
{IF: licz=2 & tab_adr[19]<>'' & tab_adr[20]<>''
}{<13 tab_adr[19]}{ELIF: licz>=2 & licz<=9 & tab_adr[19]<>'' & tab_adr[20]=''
}{<13 tab_adr[licz+29]}{ELIF: licz>=3 & licz<=10 & tab_adr[19]<>'' & tab_adr[20]<>''
}{<13 tab_adr[licz+28]
}{ kon:=0;~~}{FI}{IF: modyf<>1 & ((licz=1 & type_of(tab_adr[licz])=2 & tab_adr[licz]<>'') | (licz=2 & tab_adr[3]<>''))
}{<78 tab_adr[licz]}{FI}{IF: licz>=3 & type_of(tab_adr[licz+20])=2 & tab_adr[20+licz]<>'' & tab_adr[3]<>''
}{<78 tab_adr[licz+20]}{FI}{IF: tab_adr[3]='' & licz>=2 & licz<>10 & type_of(tab_adr[licz+21])=2 & tab_adr[21+licz]<>''
}{<78 tab_adr[licz+21]}{FI}
{ licz+=1;modyf:=2;~~}
{OD}
{WHILE: ilel<8}
{DO}
{LINE: 1}{ ilel+=1;~~}
{OD}
{ELSE}
{WHILE: licz<=10}
{DO}
{ {? (licz<3 & type_of(tab_adr[licz])=2 & (((tab_adr[licz]<>'' | licz=3) & kon=1) | (tab_adr[licz]<>''))) | (licz>=3 & type_of(tab_adr[licz+20])=2 & tab_adr[licz+20]<>'') || ilel+=1 ?};~~}
{ {? modyf=0 & licz=3 & tab_adr[19]<>'' || licz:=2; modyf:=1 ?};~~}
{IF: licz=1 & tab_adr[19]<>'' & tab_adr[20]<>''
}{<13 tab_adr[19]}{ELIF: licz>=1 & licz<=8 & tab_adr[19]<>'' & tab_adr[20]=''
}{<13 tab_adr[licz+30]}{ELIF: licz>=2 & licz<=9 & tab_adr[19]<>'' & tab_adr[20]<>''
}{<13 tab_adr[licz+29]
}{ kon:=0;~~}{FI}{IF: modyf<>1 & ((licz=1 & type_of(tab_adr[licz])=2 & tab_adr[licz]<>'') | (licz=2 & tab_adr[3]<>''))
}{<78 tab_adr[licz]}{FI}{IF: licz>=3 & type_of(tab_adr[licz+20])=2 & tab_adr[20+licz]<>'' & tab_adr[3]<>''
}{<78 tab_adr[licz+20]}{FI}{IF: tab_adr[3]='' & licz>=2 & licz<>10 & type_of(tab_adr[licz+21])=2 & tab_adr[21+licz]<>''
}{<78 tab_adr[licz+21]}{FI}
{ licz+=1;modyf:=2;~~}
{OD}
{WHILE: ilel<9}
{DO}
{LINE: 1}{ ilel+=1;~~}
{OD}
{FI}
{FONT: 'W8'}
{LINE: 1}
{IF: SER_KOR.TYP<>'I'}{<3 tab_adr1[4]}{<20 KH.KOD}{FI}
{MACRO-}
{COMMENT}--------------------------------USTAWIANIE ZMIENNYCH--------------------{COMMENT-}
{MACRO: 'UST_HED'}
{ SER_NAG.KH();
  tab_adr[4]:=tab_adr[5]:=tab_adr[6]:=0; _dru_nr:=0;
  {? OS_ADRES.index('RODZAJ1'); OS_ADRES.prefix(KH.ref(),'H'); OS_ADRES.last()
  || tab_adr[2]:={? +OS_ADRES.MIASTO & |OS_ADRES.MIASTO<>|OS_ADRES.POCZTA
                 || {? (~(+OS_ADRES.POCZTA)) & +OS_ADRES.KOD || OS_ADRES.KOD+' ' || '' ?}+OS_ADRES.MIASTO
                 || ''
                 ?};
     tab_adr[1]:={? +OS_ADRES.POCZTA
                 || {? +OS_ADRES.KOD || OS_ADRES.KOD+' ' || '' ?}+OS_ADRES.POCZTA
                 || ''
                 ?};
     tab_adr[22]:={? +OS_ADRES.NAZ_P || 36+OS_ADRES.NAZ_P || '' ?};
     tab_adr[3]:={? +OS_ADRES.ULICA
                 || 'ul. '+OS_ADRES.ULICA+
                    ' '+{? +OS_ADRES.DOM || OS_ADRES.DOM || '' ?}+
                    {? +OS_ADRES.LOKAL || '/'+OS_ADRES.LOKAL || '' ?}
                 || ''
                 ?};
     tab_adr[4]:=''
  || tab_adr[1]:={? +KH.POCZ & |KH.POCZ<>|KH.MIASTO
                 || tab_adr[4]:=1; {? +KH.KPOCZ || KH.KPOCZ+' ' || '' ?}+KH.POCZ
                 |? +KH.POCZ=0 | |KH.POCZ=|KH.MIASTO
                 || tab_adr[4]:=1; {? +KH.KPOCZ || KH.KPOCZ+' ' || '' ?}+KH.MIASTO
                 |? +KH.MIASTO & +KH.POCZ & |KH.POCZ<>|KH.MIASTO
                 || tab_adr[4]:=tab_adr[5]:=1; {? +KH.KPOCZ || KH.KPOCZ+' ' || '' ?}+KH.MIASTO
                 || ''
                 ?};
     tab_adr[2]:={? tab_adr[4] & ~tab_adr[5] & ~(|KH.POCZ=|KH.MIASTO) & ~(|KH.POCZ='')
                 || KH.MIASTO
                 || ''
                 ?};
     tab_adr[3]:={? +KH.UL
                 || 'ul. '+KH.UL+{? var_press('DOM',KH)>0
                                 || ' '+{? +KH.DOM || KH.DOM || '' ?}+
                                    {? +KH.LOKAL || '/'+KH.LOKAL || '' ?}
                                 || ''
                                 ?}
                 || ''
                 ?};
     tab_adr[22]:=''
  ?};~~}
  { {? |tab_adr[1]='' || tab_adr[1]:=tab_adr[2]; tab_adr[2]:='' ?};
    {? |tab_adr[2]='' || tab_adr[2]:=tab_adr[3]; tab_adr[3]:='' ?};
    {? |tab_adr[3]='' & type_of(tab_adr[4])=2 || tab_adr[3]:=tab_adr[4]; tab_adr[4]:='' ?}
  ;~~}
{ {? tab_adr[3]<>'' || STR.split(tab_adr[3]) || STR.split(tab_adr[2]) ?};
  {! _i:=23..30 |! tab_adr[_i]:='' !};
  tab_adr[23]:=STR.line(36); licz:=24;
  {! |? STR.next() |! tab_adr[licz]:=STR.line(36); licz+=1 !};~~}
{ STR.split(KH.NAZ_P); {! _i:=7..18 |! tab_adr[_i]:='' !};
  tab_adr[7]:=STR.line(36); licz:=8;~~}
{WHILE:STR.next()}{DO}{ tab_adr[licz]:=STR.line(34); licz+=1;~~}{OD}
{ _a:=XINFO.NAZ;
  STR.split(_a);
  tab_adr[13]:=STR.line(42);
  tab_adr[14]:=STR.line(42);
  tab_adr[15]:=STR.line(42);
  tab_adr[16]:=STR.line(42);
  tab_adr[17]:=STR.line(42);
  tab_adr[18]:=XINFO.KOD_P+{? +XINFO.POCZ
                           || ' '+XINFO.POCZ
                           || ' '+XINFO.MIA
                           ?};
  tab_adr[19]:={? +XINFO.POCZ & XINFO.POCZ<>XINFO.MIA || XINFO.MIA || '' ?};
  tab_adr[20]:={? +XINFO.UL || 'ul. '+XINFO.UL || '' ?};
  tab_adr[20]+=' '+XINFO.NR_D+{? +XINFO.NR_L
                                 || '/'+XINFO.NR_L
                                 || ''
                                 ?};
  tab_adr[21]:='';
  {? |tab_adr[18]='' || tab_adr[18]:=tab_adr[19]; tab_adr[19]:='' ?};
  {? |tab_adr[19]='' || tab_adr[19]:=tab_adr[20]; tab_adr[20]:='' ?};
  {? |tab_adr[20]='' || tab_adr[20]:=tab_adr[21]; tab_adr[21]:='' ?};~~}
{ {? tab_adr[20]<>'' || STR.split(tab_adr[20]) || STR.split(tab_adr[19]) ?};
  {! _i:=31..38 |! tab_adr[_i]:='' !};
  tab_adr[31]:=STR.line(38); licz:=32;
  {! |? STR.next() |! tab_adr[licz]:=STR.line(38); licz+=1 !};~~}
{MACRO-}