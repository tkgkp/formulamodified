:!UTF-8
{TITLE: Definicje formuły rejestrującej}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT}
{BEGIN: PRN := obj_new(@.CLASS.PRINT,16);
        PRN.sl_frame();
        PRN2 := obj_new(@.CLASS.PRINT,16);
        PRN2.sl_frame();
        {? var_pres('ML',@)<=0 || ML:=obj_new(@.CLASS.MEMO) ?};
        w:=obj_new(8);
        pierwszy:=1; ref_w:=ref_m:=null; f:=''; dalej:=0;
        wyr:=PAR_SKID.get(35)='T';
        SKID_WYR.index('SKID_WYR'); mdc:='';lm:=0}
{END: VAR_DEL.delete('PRN','PRN2','ML','w','pierwszy','ref_w','ref_m','f','dalej','wyr','mdc','lm')}
{  {? wyr & AUTOKSIE.TYP<>'K'
   || PRN2.add("''",60,'');
      PRN2.add("''",64,'%1 Konto Wn'@[32*' ']);
      PRN2.add("''",64,'%1 Konto Ma'@[32*' '])
   ?};
   PRN.add("{? pierwszy||FORM.POZ||''?}",3,'Lp',1);
   {? AUTOKSIE.TYP='D'
   || PRN.add("{? pierwszy||FORM.SKID_MB().KOD||''?}",8,'Model'@);
      PRN.add("{? pierwszy||FORM.PBUD().SYMBOL||''?}",16,'Pozycja budżetowa'@);
      PRN.add("{? pierwszy||f||''?}",{?wyr||30||55?},'Formuła'@)
   |? AUTOKSIE.TYP='K'
   || PRN.add("{? pierwszy||FORM.MASKA||''?}",35,'Maska konta'@);
      PRN.add("{? pierwszy||FORM.SKID_MB().KOD||''?}",8,'Model'@);
      PRN.add("{? pierwszy||{?FORM.PBUD_SF='S'||FORM.PBUD_S||FORM.PBUD_F ?} ||''?}",28,'Pozycja budźetowa'@);
      PRN.add("{? pierwszy||{?FORM.JORG_SF='S'||FORM.JORG_S||FORM.JORG_F ?} ||''?}",28,'Wymiar 2'@);
      PRN.add("{? pierwszy||{?FORM.OKOSZ_SF='S'||FORM.OKOSZ_S||FORM.OKOSZ_F ?} ||''?}",28,'Wymiar 3'@);
      PRN.add("{? pierwszy||{?FORM.WYM4_SF='S'||FORM.WYM4_S||FORM.WYM4_F ?} ||''?}",28,'Wymiar 4'@);
      PRN.add("{? pierwszy||{?FORM.WYM5_SF='S'||FORM.WYM5_S||FORM.WYM5_F ?} ||''?}",28,'Wymiar 5'@)
   || PRN.add("{? pierwszy||FORM.KARTOTEK||''?}",8,' Tabela#źródłowa'@,,'#');
      PRN.add("{? pierwszy||FORM.INDEKS||''?}",8,' Indeks'@);
      PRN.add("{? pierwszy||FORM.MASKA||''?}",{?wyr||11||20?},{?wyr||3*' '||8*' '?}+'Maska'@);
      PRN.add("{? pierwszy||f||''?}",{?wyr||26||55?},{?wyr||10*' '||24*' '?}+'Formuła'@)
   ?};
   {? AUTOKSIE.TYP<>'K'
   || PRN.add("{? pierwszy||FORM.KWN||''?}",15,'Symbol konta Wn'@)
   ?};
   {? wyr & AUTOKSIE.TYP<>'K'
   || PRN.add("w[1]",3,'Lp');
      PRN.add("w[2]",12,'  Wyróżnik#  (słownik)'@,,'#');
      PRN.add("w[3]",15,'    Wyróżnik#     (kod)'@,,'#');
      PRN.add("w[4]",15,'    Wyróżnik# (wyznacz. kw.)'@,,'#')
   ?};
   {? AUTOKSIE.TYP<>'K'
   || PRN.add("{? pierwszy||FORM.KMA||''?}",15,'Symbol konta Ma'@)
   ?};
   {? wyr & AUTOKSIE.TYP<>'K'
   || PRN.add("w[5]",3,'Lp');
      PRN.add("w[6]",12,'  Wyróżnik#  (słownik)'@,,'#');
      PRN.add("w[7]",15,'    Wyróżnik#     (kod)'@,,'#');
      PRN.add("w[8]",15,'    Wyróżnik# (wyznacz. kw.)'@,,'#')
   ?};
~~}
{INCLUDE: wsp_pw3.rpi}
{PAR_WYDR.TITLE:='DEFINICJE FORMUŁY "%1" %2 z roku %3'@[AUTOKSIE.NAZ,AUTOKSIE.OP,AUTOKSIE.ROK_F().NAZ]; ~~}
{HEADER}
{SUBSTITUTE: 'CHARHEAD'}
{LINE:2}
{FONT: 'Q'}{SPACE: 'C'}
{<3 ''+
   {? AUTOKSIE.TYP='N' || 'Miejsce wywołania: Nagłówki dokumentów'@
   |? AUTOKSIE.TYP='P' || 'Miejsce wywołania: Pozycje dokumentów'@
   |? AUTOKSIE.TYP='D' || 'Miejsce wywołania: Podziały dla controllingu - dekretowanie'@
   |? AUTOKSIE.TYP='K' || 'Miejsce wywołania: Podziały dla controllingu - tworzenie'@
   ?}
}
{<3'Zaakceptowana: '@+{? AUTOKSIE.A='T' || 'tak'@ || 'nie'@ ?}}
{ STR.split(AUTOKSIE.FORMPOCZ); ~~}
{<3'Formuła początkowa: '@+STR.line(140)}
{<23STR.line(140)}
{FONT: 'R'}
{IF: wyr & AUTOKSIE.TYP<>'K'}
{PRN2.hbar()}
{PRN2.ini_head()}
{WHILE: PRN2.h_next()}{DO}
{PRN2.h_line()}
{OD}
{PRN2.jbar(PRN)}
{ELSE}
{PRN.hbar()}
{FI}
{PRN.ini_head()}
{WHILE: PRN.h_next()}{DO}
{PRN.h_line()}
{OD}
{FONT: 'Q'}
{PRN.bar()}
{HEADER-}
{FOOTER}
{SUBSTITUTE: 'CHARFOOT'}
{~~}
{FOOTER-}
{MACRO: 'wyp_w'}
{ w[i+1]:=$SKID_WYR.LP;
  w[i+2]:=SKID_WYR.SLU().SLU().NAZ;
  w[i+3]:={? SKID_WYR.KOD<>null || 'stały: %1-%2'@[SKID_WYR.KOD().KOD,SKID_WYR.KOD().TR]
  |? SKID_WYR.FORMULA<>null || 'formuła: %1-%2'@[SKID_WYR.FORMULA().SKROT,SKID_WYR.FORMULA().NAZWA]
  || 'wszystkie ze   słownika'@
  ?};
  w[i+4]:={? SKID_WYR.PROC || '%1%% dekret.'@[$SKID_WYR.PROC]
  |? SKID_WYR.KWOTA<>null || 'formuła: %1-%2'@[SKID_WYR.KWOTA().SKROT,SKID_WYR.KWOTA().NAZWA]
  || 'brak'@
  ?};
  ~~
}
{MACRO-}
{MACRO: 'wyrozn'}
{ {! _i:=1..8 |! w[_i]:='' !};~~}
{IF: pierwszy | ref_w<>null}
{ SKID_WYR.prefix(REF.FIRMA,'FORM',FORM.name(),#FORM.ref,'W');~~}
{IF: {? pierwszy || SKID_WYR.first() || SKID_WYR.seek(ref_w); SKID_WYR.next()?}}
{ ref_w:=SKID_WYR.ref();i:=0;~~}
{SUBSTITUTE: 'wyp_w'}
{ELSE}
{ ref_w:=null;~~}
{FI}
{FI}
{IF: pierwszy | ref_m<>null}
{ SKID_WYR.prefix(REF.FIRMA,'FORM',FORM.name(),#FORM.ref,'M');~~}
{IF: {? pierwszy || SKID_WYR.first() || SKID_WYR.seek(ref_m); SKID_WYR.next()?}}
{ ref_m:=SKID_WYR.ref();i:=4;~~}
{SUBSTITUTE: 'wyp_w'}
{ELSE}
{ ref_m:=null;~~}
{FI}
{FI}
{IF: ref_w<>null | ref_m<>null | pierwszy}
{SUBSTITUTE:'linia'}
{FI}
{MACRO-}
{MACRO: 'linia'}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{IF:_l:=lineleft(); _l=1}
{PRN.lbar()}
{ELSE}
{<1 PRN.line()}
{FI}
{OD}
{MACRO-}
{FOR:'FORM'}
{INDEX:'AUTOKSIE'}
{PREFIX:AUTOKSIE.ref()}
{DO}
{ pierwszy:=1; ref_w:=ref_m:=null; f:='';
  f:=FORM.memo_txt(0,1,'FML');
~~}
{SUBSTITUTE:'wyrozn'}
{pierwszy:=0;~~}
{WHILE: ref_w<>null | ref_m<>null}
{DO}
{SUBSTITUTE:'wyrozn'}
{OD}
{ FORM.cntx_psh(); dalej:=FORM.next(); FORM.cntx_pop();~~}
{IF: (lineleft()>=3) | (lineleft=2 & ~dalej)}
{IF: dalej}
{PRN.bar()}
{ELSE}
{ENTIRE}
{PRN.lbar()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'@}
{ENTIRE-}
{FI}
{ELIF: ~dalej}
{IF: lineleft()=2}
{ENTIRE}
{PRN.lbar()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'@}
{ENTIRE-}
{ELSE}
{PRN.lbar()}
{IF: lineleft()=1}{PAGE}{FI}
{ENTIRE}
{PRN.lbar()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'@}
{ENTIRE-}
{FI}
{ELSE}
{PRN.lbar()}
{IF: lineleft()<>0}{PAGE}{FI}
{FI}
{OD}
