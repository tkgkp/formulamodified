:!UTF-8
{TITLE:H. Zestawienie odsetek od należności/zobowiązań wg kwot odsetek}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:  i:=0;           "pomocnicza do pętli";
         max_per:=6;     "maksymalna liczba przedziałów + 1";
         il:=0;          "ostatnia kolumna w wierszu";
         tab_kol:=0;     "liczba kolumn tabeli";
         stan_na:=date;  "stan na wybrany dzień - odsetki będą liczone do danego dnia włącznie";
         pr:=pierwszy:=licznik:=0;
                         "zmienne pomocnicze - pierwszy rozrachunek, licznik rozrachunków ";
         suma:=0;        "saldo aktualnego rozrachunku";
         q:=obj_new(max_per+3); "wartości dla pojedynczego rozrachunku";
         s:=obj_new(max_per+3); "suma kolumn dla kontrahenta ";
         t:=obj_new(max_per+3); "totale kolumn dla całego wydruku";
         {! i:=1..max_per+3 |! q[i]:=s[i]:=t[i]:=0 !};
         per:=obj_new(max_per+1); "szerokości przedziałów";
         szer_kol:=obj_new(20); "szerokości kolumn";
         w:=obj_new(max_per+3); "wartosci dla macra linia i suma";
         p:=obj_new(20);        "pozycje kolumn tabelki";
         petla:=licznik1:=kwota:=kwota1:=vk:=0;
         data1:=data2:=data4:=0;
         druk:=vp:=kanc:=g1:=lm:=0; PAR_WYDR.OMASKA:=1;
         own:=0; oma:=0; prz:=0; p_odd:=indtym:=kan:=mdc:='';
         wybor2:='';    'zobowiązania/należności'@;
         STR.split(''); KH.win_sel('WER_RPM');
         exec('tmp_ods','rozrach_ods')
      }
{END:    &wybor2; &mdc; &lm;
         &il; &tab_kol; &stan_na; &pr; &i; &max_per; &suma; &petla; &vk;
         &kan; &kanc; &g1;
         &pierwszy; &licznik; &licznik1; &kwota; &kwota1; &data1; &data2; &data4;
         obj_del(szer_kol); obj_del(w); obj_del(p); obj_del(s); obj_del(q);&own; &oma; &druk;
         obj_del(t); obj_del(per); &indtym; OP.ndx_drop; &prz; &p_odd; &vp;
         {? ODS_TMP1.first() || exec('pyt_pok','rozrach_ods') ?};
         exec('del_tmp','rozrach_ods')
      }
{  UNPAR.P1:=1;
   KONTO.K1:=KONTO.K2:='';
   KONTO.K1_WYM:=KONTO.K2_WYM:=0;
   KONTO.K1_SYNT:=KONTO.K2_SYNT:=0;
   KONTO.K1_RODZ:=2; KONTO.K2_RODZ:=3;
   KONTO.K1_BE:='{? UNPAR.P1=1 || 1 || 0 ?}';
   KONTO.K2_BE:='{? UNPAR.P1=2 || 1 || 0 ?}';
   KONTO.K1_AE:=KONTO.K2_AE:='';
   UNPAR.P1_BE:='';
   UNPAR.P1_AE:='{? UNPAR.P1=1 || KONTO.K2:=\'\''
               +'|? UNPAR.P1=2 || KONTO.K1:=\'\''
               +'?}';
   PAR_WYDR.win_edit('RWODSETK');
   PAR_WYDR.PAR1:=max_per;
   PAR_WYDR.PAR2:=100;
   PAR_WYDR.PAR3:=500;
   PAR_WYDR.PAR4:=1000;
   PAR_WYDR.PAR5:=2000;
   PAR_WYDR.PAR6:=3000;
   PAR_WYDR.PAR7:=4000;
   PAR_WYDR.DPAR1:=date(date~1,date~2,0);
   PAR_WYDR.S1PAR1:='N';
   PAR_WYDR.PAR8:=1;
   PAR_WYDR.PAR9:=2;
   {? OPERATOR.DEPT
   || p_odd:='Jednostka księgowa: %1'@[OPERATOR.DEPT().OD]
   || p_odd:='Wszystkie jednostki księgowe'@
   ?}; ~~}
{EXIT: ~PAR_WYDR.edit("
             PAR_WYDR.S1PAR1:=~-PAR_WYDR.S1PAR1; _p:=0; _zwrot:=1;
             {? PAR_WYDR.DPAR1=date(0,0,0)
             || FUN.info('Niewypełnione pole daty (stan na dzień).'@); _zwrot:='DPAR1'
             |? PAR_WYDR.PAR1>max_per | PAR_WYDR.PAR1<1
             || _p:=1;_zwrot:='PAR1'
             |? PAR_WYDR.PAR2>=PAR_WYDR.PAR3 & PAR_WYDR.PAR1>1
             || _p:=1;_zwrot:='PAR2'
             |? PAR_WYDR.PAR3>=PAR_WYDR.PAR4 & PAR_WYDR.PAR1>2
             || _p:=1;_zwrot:='PAR3'
             |? PAR_WYDR.PAR4>=PAR_WYDR.PAR5 & PAR_WYDR.PAR1>3
             || _p:=1;_zwrot:='PAR4'
             |? PAR_WYDR.PAR5>=PAR_WYDR.PAR6 & PAR_WYDR.PAR1>4
             || _p:=1;_zwrot:='PAR5'
             |? PAR_WYDR.PAR6>=PAR_WYDR.PAR7 & PAR_WYDR.PAR1>5
             || _p:=1;_zwrot:='PAR6'
             ?};
             {? _p || FUN.info('Nieprawidłowa Liczba przedziałów.'@) ?};_zwrot")}
{EXIT: ~exec('sprtdods','rozrach_ods',PAR_WYDR.DPAR1)}
{  _prefix:=exec('maska2prefix','konto',KONTO.K1);
   {? _prefix<>'?'
   || UNPAR.P1:=2;
      KONTO.K2:=_prefix;
      KONTO.K1:=''
   ?};
   WYDRUKIN.DLKON:=35;
   WYDRUKI.MASKA:=KONTO.K1;
   {? WYDRUKI.MASKA=''
   || WYDRUKI.MASKA:=35*'?'
   || {? +WYDRUKI.MASKA<WYDRUKIN.DLKON
      || WYDRUKI.MASKA+=(WYDRUKIN.DLKON-+WYDRUKI.MASKA)*'?'
      ?}
   ?};
   {? OPERATOR.DEPT
   || indtym:=OP.ndx_tmp('',1,'TYP',,0,'WAL',,0,'KH',,0,'ODD',,0,'AN',,0,'TZ',,)
   || indtym:=OP.ndx_tmp('',1,'TYP',,0,'WAL',,0,'KH',,0,'AN',,0,'TZ',,)
   ?};
   wybor2:=PAR_WYDR.S1PAR1; ~~}
{INCLUDE: wsp_pw1.rpi}
{INCLUDE: wsp_pw3.rpi}
{INCLUDE: fks_rwodskw.rpi}
