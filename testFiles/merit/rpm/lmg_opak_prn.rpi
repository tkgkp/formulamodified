:!UTF-8
{
   'kontrola czy istnieja opakowania zwiazane z dokumentem';
   opak_n:=0;
   POMOC.OPAK_N:=null;
   _tab:=type_of(cur_tab(1))>=118;
   {? _tab & (5+cur_tab(1).name='faktu' | 5+cur_tab(1).name='fakpo')
   ||
      {? FAKS.SZ='S' & FAKS.WHERE='P' & FAKS.T().PAR='N' & FAKS.SYMF=''
      ||
         OPAK_N.index('FAKS');
         OPAK_N.prefix($FAKS.ref());
         {? OPAK_N.first()
         || POMOC.OPAK_N:=OPAK_N.ref()
         ?}
      ?}
   |? _tab
    & (5+cur_tab(1).name='nagdo' | 5+cur_tab(1).name='zknag'
      | 5+cur_tab(1).name='dokma' | 5+cur_tab(1).name='zkpoz')
   ||
      OPAK_N.index('ND');
      OPAK_N.prefix($ND.ref());
      {? OPAK_N.first()
      || POMOC.OPAK_N:=OPAK_N.ref()
      ?}
   |? OPAK_N.get()
   ||
      opak_n:=1;
      POMOC.OPAK_N:=OPAK_N.ref
   ?}
;~~}
{IF: POMOC.OPAK_N<>null}
{
   VAR_DEL.delete('PRN_OP','PRN_OP_S','__do_wpl','__do_zwr','k','p','w');

   _graf:=exec('get','#params',1121,2,OPERATOR.USER)<>'T';

   PRN_OP:=obj_new(@.CLASS.PRINT,8); {? __ods || {? _graf || PRN_OP.s_frame() || PRN_OP.t_frame() ?} || {? _graf || PRN_OP.sl_frame() || PRN_OP.tl_frame() ?} ?};

   k:=obj_new(7);
   p:=obj_new(7);
   w:=obj_new(1);

   {! _i..7 |! k[_i]:=0  !};
   {! _i..7 |! p[_i]:='' !};

   __do_wpl:=__do_zwr:=0;

   PRN_OP.add("w[1]",4,exec('tr','tlumaczenia','5000001'),1);
   PRN_OP.add("{? OPAK_P.ZWROT='T' || 'ZWROT' || '' ?}",8,exec('tr','tlumaczenia','5000036'));
   PRN_OP.add("OPAK_P.M().KTM+' - '+OPAK_P.M().N",50,exec('tr','tlumaczenia','5000037'));
   PRN_OP.add("OPAK_P.M().J().KOD",5,exec('tr','tlumaczenia','5000007'));
   PRN_OP.add("form(OPAK_P.IL,,3)",12,exec('tr','tlumaczenia','5000008'),1);
   {? czy_war=2 | czy_war=3 || PRN_OP.add("form(OPAK_P.WAR,,2)",14,exec('tr','tlumaczenia','5000038'),1) ?};
   PRN_OP.add("{? OPAK_P.DATA_ZWR<>date(0,0,0) || form(OPAK_P.DATA_ZWR) || '' ?}",11,exec('tr','tlumaczenia','5000039'));

   'zmienne pomocnicze do wydrukow graficznych';
   color:='';
   prn1:=prn2:='PRN_OP';
   lm:=ll:=vp:=lmt:=0; rsep:=PAR_WYDR.RSEP;
   _v:=$int((100-PAR_WYDR.SHAD)*2.55);
   color:=_v+':'+_v+':'+_v;

   ND.cntx_psh;
   PAR_WYDR.TITLE:=
      {? POMOC.OPAK_N().ND<>''
      || ND.use(8+OPAK_N.ND);
         {? ND.seek(BB.sqlint(OPAK_N.ND),)
         || exec('tr','tlumaczenia','5000034')+' '+OPAK_N.SYM+
            ' '+exec('tr','tlumaczenia','5000035')+'\n'+ND.TYP().T+' '+exec('tr','tlumaczenia','5000009')+' '+$ND.NR+' - '
            +ND.TYP().NAZ+' '+exec('tr','tlumaczenia','5000011')+' '+ND.MAG().SYM
         || exec('tr','tlumaczenia','5000034')+' '+OPAK_N.SYM
         ?}
      || exec('tr','tlumaczenia','5000034')+' '+OPAK_N.SYM
      ?};
   ND.cntx_pop;

   w[1]:=0

;~~}
{FOOTER}{FOOTER-}
{FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
{ vp:=1; ~~}
{ lmt:=int((charleft()-PRN_OP.width())/2); ~~}
{IF: opak_n=1}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{FOOTER-}
{FONT: exec('font','param_wydr','tabhead_poz')}{SPACE: exec('space','param_wydr')}
{SUBSTITUTE: 'TABHEAD'}
{ lmt:=int((charleft()-PRN_OP.width())/2); ~~}
{FI}
{HEADER}
{IF: opak_n=0}{SUBSTITUTE: 'HEADF'}{FI}
{FONT: exec('font','param_wydr','tabhead_poz')}{SPACE: exec('space','param_wydr')}
{SUBSTITUTE: 'TABHEAD'}{ vp:=1; ~~}
{ lmt:=int((charleft()-PRN_OP.width())/2); ~~}
{HEADER-}
   {IF: OPAK_P.index('OPAK_N'); OPAK_P.prefix(POMOC.OPAK_N); OPAK_P.first()}
      {IF: lineleft>0 & opak_n=0}
         {PAGE}
         {FOOTER: 0}
         {SUBSTITUTE: 'LINIAF'}
         {FOOTER-}
      {FI}
{COMMENT}   wydruk pozycji dokumentu                                 {COMMENT-}
      {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
      {FOR: 'OPAK_P'}
      {INDEX: 'OPAK_N'}
      {PREFIX: POMOC.OPAK_N}
      {DO}
         {
            w[1]+=1;

            {? OPAK_P.OPAK_N().PLUS='T' & OPAK_P.ZWROT='T' || __do_zwr+=OPAK_P.WAR ?};
            {? OPAK_P.OPAK_N().PLUS='T' & OPAK_P.ZWROT='N' & OPAK_P.CZY_KAUC='T'  || __do_wpl+=OPAK_P.WAR ?};

            {? OPAK_P.OPAK_N().PLUS='N' & OPAK_P.ZWROT='T' || __do_zwr+=OPAK_P.WAR ?};
            {? OPAK_P.OPAK_N().PLUS='N' & OPAK_P.ZWROT='N' & OPAK_P.CZY_KAUC='T'  || __do_wpl+=OPAK_P.WAR ?}
         ;~~}
         {SUBSTITUTE: 'LINIA0'}
      {OD}
      {SUBSTITUTE: 'LINIAF'}
      {FOOTER}{FOOTER-}
      {IF: czy_war=2 | czy_war=3}
         {IF: __do_wpl>0}
            {IF: ND.TYP().P='T'}
               {<{lmt}exec('tr','tlumaczenia','5000040')}{>{lmt+40}form(__do_wpl,,2)+' '+INFO.NAROD().KOD}
            {ELSE}
               {<{lmt}exec('tr','tlumaczenia','5000041')}{>{lmt+40}form(__do_wpl,,2)+' '+INFO.NAROD().KOD}
            {FI}
         {FI}
         {IF: __do_zwr>0}
            {IF: ND.TYP().P='T'}
               {<{lmt}exec('tr','tlumaczenia','5000042')}{>{lmt+40}form(__do_zwr,,2)+' '+INFO.NAROD().KOD}
            {ELSE}
               {<{lmt}exec('tr','tlumaczenia','5000043')}{>{lmt+40}form(__do_zwr,,2)+' '+INFO.NAROD().KOD}
            {FI}
         {FI}
      {FI}
   {FI}
{FI}