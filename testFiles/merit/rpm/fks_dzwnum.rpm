:!UTF-8
{TITLE:B. Nieciągłość numeracji dokumentów źródłowych}
{PRINTER: FINFO.W_PRN,,,,,'E','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT}
{BEGIN:
   PRN:=obj_new(@.CLASS.PRINT,3); PRN.s_frame(); w:=obj_new(3);
   nast:=nr:=od:=lm:=0; mdc:=''}
{END:
   obj_del(w); obj_del(PRN);
   &nast; &nr; &od; &lm; &mdc}
{ {? OPERATOR.DEPT=null || PRN.add("w[3]",19,'Jednostka księgowa'@) ?};
PRN.add("w[1]",12,'  Rejestr'@);
PRN.add("w[2]",26,'     Nr niezapełniony'@);
w[1]:=w[2]:=''; ~~}
{INCLUDE: wsp_pw3.rpi}
{COMMENT}------------------------------MACRO-LINIA------------------{COMMENT-}
{MACRO: 'LINIA'}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{<1 PRN.line()}
{OD}
{MACRO-}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{PAR_WYDR.TITLE:='NIECIĄGŁOŚĆ NUMERACJI DOKUMENTÓW ŹRÓDŁOWYCH'@;~~}
{SUBSTITUTE: 'CHARHEAD'}
{FONT: 'E'}{SPACE: 'B'}
{LINE: 1}
{<1 'PARAMETRY WYDRUKU:'@}
{<1 'Rok obrotowy: %1'@[SSTALE.AR().NAZ]}
{<1 'Aktywny okres obrach.: %1 %2'@[SSTALE.AO().NAZ,SSTALE.AR().NAZ]}
{<1 'Aktywna jednostka księgowa: %1'@[{? OPERATOR.DEPT || OPERATOR.DEPT().OD || 'Wszystkie jednostki księgowe'@ ?}]}
{IF: OKRO_F.ZAM='T'}{<1 'Okres zamknięty'@}{ELSE}{<1 'Okres otwarty'@}{FI}
{FONT: 'F'}{SPACE: 'B'}
{PRN.hbar()}
{PRN.ini_head()}
{WHILE: PRN.h_next()}
{DO}
{PRN.h_line()}
{OD}
{PRN.bar()}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{PRN.lbar()}
{SUBSTITUTE: 'CHARFOOT'}
{~~}
{FOOTER-}
{COMMENT}------------------------------BODY-----------------------{COMMENT-}
{MACRO: 'BODY'}
{  DOK.prefix(REJ.ref); nast:=DOK.first; pier:=1; nr:=od:=1; ~~}
   {WHILE: (nr<=99999999999) & nast}
   {DO}
      {  {? DOK.NR>nr || od:=nr; nr:=DOK.NR ?}; w[3]:=DOK.REJ().ODD().OD; ~~}
      {IF: (nr-od)>1}
         {  w[1]:=REJ.KOD; w[2]:=$od+'...'+$(nr-1); ~~}
         {SUBSTITUTE: 'LINIA'}
      {ELIF: (nr-od)=1}
         {  w[1]:=REJ.KOD; w[2]:=$od; ~~}
         {SUBSTITUTE: 'LINIA'}
      {FI}
      {  nr+=1; od:=nr; nast:=DOK.next(); ~~}
   {OD}
{MACRO-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'E'}{SPACE: 'B'}
{ DOK.index('REJ'); ~~}
{IF: OPERATOR.DEPT}
{FOR: 'REJ'}{INDEX: 'KOD'}{PREFIX: SSTALE.AR, OPERATOR.DEPT}{DO}{SUBSTITUTE: 'BODY'}{OD}
{ELSE}
{FOR: 'REJ'}{INDEX: 'KOD'}{PREFIX: SSTALE.AR}{DO}{SUBSTITUTE: 'BODY'}{OD}
{FI}
{COMMENT}------------------------------FOOTER-LAST------------------{COMMENT-}
{FOOTER}
{SUBSTITUTE: 'CHARFOOT'}
{FOOTER-}
{PRN.lbar()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'@}
