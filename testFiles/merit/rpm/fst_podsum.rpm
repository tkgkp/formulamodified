:!UTF-8
{TITLE: Plan amortyzacji}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
   PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   PRN:=obj_new(@.CLASS.PRINT,7); PRN.sl_frame();
   PRN1:=obj_new(@.CLASS.PRINT,7); PRN1.sl_frame();
   color:=''; prn1:=prn2:='PRN'; lm:=ll:=lmt:=0;
   head:=PAR_WYDR.HEAD; vp:=1; rsep:=PAR_WYDR.RSEP;
   PAR_WYDR.TITLE:='Plan amortyzacji'@;
   w:=obj_new(7); ww:=obj_new(7);
   dalej:=0; {! _i:=1..7 |! w[_i]:=ww[_i]:='' !};
   sstr1:=sstr2:=sstr3:=suma1:=suma2:=suma3:=czy_an:=0;
   col_name:=__COL_NAME;
   {? rep_export()
   || czy_an:=FUN.ask('Czy wykonać wydruk analityczny?'@)
   ?};
   {? czy_an
   || tab_fir:=__RAZEMS;
      PAR_WYDR.TITLE:='Plan amortyzacji - wydruk analityczny'@
   || tab_fir:=TAB_WID
   ?};
   tab_fir.cntx_psh()
}
{END: obj_del(PRN); obj_del(PRN1); &color; &prn1; &prn2; &lm; &ll; &vp; &lmt; &rsep; &head;
      obj_del(w); obj_del(ww); &dalej; tab_fir.cntx_pop(); &tab_fir;
      &sstr1; &sstr2; &suma1; &suma2; &sstr3; &suma3; &czy_an; &col_name }
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzeżone
========================================================================================================================
Nazwa pliku: fst_podsum.rpm
Utworzony: 01.03.2023 [JD]
========================================================================================================================
Zawartość:
{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: ~rep_export()}{SUBSTITUTE: 'FOOT'}{FI}
{  {? czy_an
   || {? EDIT_ES.PODZ_OKR='T'
      || {? EDIT_ES.PODSUM='L'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",10,'Okres');
            PRN.add("w[3]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[4]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",10,'',1);
            PRN1.add("ww[3]",30,'',1);
            PRN1.add("ww[4]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[5]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[5]",30,'',1)
            ?}
         |? EDIT_ES.PODSUM='G'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",10,'Okres');
            PRN.add("w[3]",1,'Grupa');
            PRN.add("w[4]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[5]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",10,'',1);
            PRN1.add("ww[3]",1,'',1);
            PRN1.add("ww[4]",30,'',1);
            PRN1.add("ww[5]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[6]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[6]",30,'',1)
            ?}
         |? EDIT_ES.PODSUM='K'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",10,'Okres');
            PRN.add("w[3]",16,'Jednostka księgowa');
            PRN.add("w[4]",1,'Grupa');
            PRN.add("w[5]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[6]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",10,'',1);
            PRN1.add("ww[3]",16,'',1);
            PRN1.add("ww[4]",1,'',1);
            PRN1.add("ww[5]",30,'',1);
            PRN1.add("ww[6]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[7]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[7]",30,'',1)
            ?}
         |? EDIT_ES.PODSUM='O'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",10,'Okres');
            PRN.add("w[3]",16,'Jednostka organizacyjna');
            PRN.add("w[4]",1,'Grupa');
            PRN.add("w[5]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[6]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",10,'',1);
            PRN1.add("ww[3]",16,'',1);
            PRN1.add("ww[4]",1,'',1);
            PRN1.add("ww[5]",30,'',1);
            PRN1.add("ww[6]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[7]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[7]",30,'',1)
            ?}
         ?}
      || {? EDIT_ES.PODSUM='L'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[3]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",30,'',1);
            PRN1.add("ww[3]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[4]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[4]",30,'',1)
            ?}
         |? EDIT_ES.PODSUM='G'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",1,'Grupa');
            PRN.add("w[3]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[4]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",1,'',1);
            PRN1.add("ww[3]",30,'',1);
            PRN1.add("ww[4]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[5]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[5]",30,'',1)
            ?}
         |? EDIT_ES.PODSUM='K'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",16,'Jednostka księgowa');
            PRN.add("w[3]",1,'Grupa');
            PRN.add("w[4]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[5]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",16,'',1);
            PRN1.add("ww[3]",1,'',1);
            PRN1.add("ww[4]",30,'',1);
            PRN1.add("ww[5]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[6]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[6]",30,'',1)
            ?}
         |? EDIT_ES.PODSUM='O'
         || PRN.add("w[1]",4,'Rok');
            PRN.add("w[2]",16,'Jednostka organizacyjna');
            PRN.add("w[3]",1,'Grupa');
            PRN.add("w[4]",30,'Amortyzacja podatkowa'@,1);
            PRN.add("w[5]",30,'Amortyzacja bilansowa'@,1);

            PRN1.add("ww[1]",4,'');
            PRN1.add("ww[2]",16,'',1);
            PRN1.add("ww[3]",1,'',1);
            PRN1.add("ww[4]",30,'',1);
            PRN1.add("ww[5]",30,'',1);
            {? FINFO.TOR_D='T'
            || PRN.add("w[6]",30,'Amortyzacja dodatkowa',1);
               PRN1.add("ww[6]",30,'',1)
            ?}
         ?}
      ?}
   || PRN.add("w[1]",60, col_name);
      PRN.add("w[2]",30,'Amortyzacja podatkowa'@,1);
      PRN.add("w[3]",30,'Amortyzacja bilansowa'@,1);

      PRN1.add("ww[1]",60,'');
      PRN1.add("ww[2]",30,'',1);
      PRN1.add("ww[3]",30,'',1);
      {? FINFO.TOR_D='T'
      || PRN.add("w[4]",30,'Amortyzacja dodatkowa',1);
         PRN1.add("ww[4]",30,'',1)
      ?}
   ?};
   lmt:=int((charleft()-PRN.width())/2.85);
~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}{ prn1:=prn2:='PRN';~~}
{SUBSTITUTE: 'HEAD'}{FONT: 'T8G'}{SPACE: 'C'}
{LINE:1}
{FONT: 'T8B'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}{FONT: 'T8B'}{SPACE: 'C'}
{COMMENT}
{ prn1:=prn2:='PRN1'; ww[4]:=form(sstr3,,2,' ,');~~}
{ ww[1]:='SUMA STRONY'@; ww[2]:=form(sstr1,,2,' ,'); ww[3]:=form(sstr2,,2,' ,');~~}
{SUBSTITUTE: 'LINIA0'}{ ww[4]:=form(suma3-sstr3,,2,' ,');~~}
{IF: page>1}{ ww[1]:='Z PRZENIESIENIA'@; ww[2]:=form(suma1-sstr1,,2,' ,'); ww[3]:=form(suma2-sstr2,,2,' ,');~~}
{SUBSTITUTE: 'LINIA0'}{FI}{ ww[4]:=form(suma3,,2,' ,');~~}
{ ww[1]:='DO PRZENIESIENIA'@; ww[2]:=form(suma1,,2,' ,'); ww[3]:=form(suma2,,2,' ,');~~}
{SUBSTITUTE: 'LINIA0'}
{COMMENT-}
{SUBSTITUTE: 'LINIAF'}{ sstr1:=sstr2:=sstr3:=0; vp:=1; prn1:=prn2:='PRN';~~}
{FOOTER-}
{COMMENT}------------------------------LINIA-----------------------{COMMENT-}
{MACRO: 'LINIA1'}
{  ll:=lineleft(); ~~}
{IF:  PRN1.ini_line(); ll<(rsep+ PRN1.length()) & ll<>0}{PAGE}{FI}
{IF: vp}
 { PRN1.setcolor(color);~~}
 {REP: PRN1.fbar(lmt)}
 { PRN1.setcolor('255:255:255'); vp:=0; ~~}
{ELIF: rsep}
 {REP: PRN1.fbar(lmt)}
{FI}
{WHILE: PRN1.next()}
{DO}
   {REP: PRN1.fline(lmt)}
{OD}
{MACRO-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8'}{SPACE: 'C'}
{ dalej:=tab_fir.first(); ~~}
{IF: czy_an}
   { dalej:=tab_fir.first(); ~~}
   {IF: EDIT_ES.PODZ_OKR='T'}
      {IF: EDIT_ES.PODSUM='L'}
         {WHILE: dalej}
         {DO}
         { {? tab_fir.ROKP<>'' & tab_fir.OKR<>''
           || w[1]:=tab_fir.ROKP;
              w[2]:=exec('msc_nazwa','#convert',tab_fir.OKRES);
              w[3]:=form(tab_fir.SAMOP,,2,' ,');
              w[4]:=form(tab_fir.SAMOF,,2,' ,');
              {? FINFO.TOR_D='T'
              || w[5]:=form(tab_fir.SAMOD,,2,' ,')
              ?}
           ?};
         ~~}
         {IF: tab_fir.ROKP<>'' & tab_fir.OKR<>''}{SUBSTITUTE: 'LINIA0'}{ vp:=0; {? lineleft=0 || vp:=1 ?};~~}{FI}
         {FONT: 'T8'}
         {IF: PAR_WYDR.RSEP=1 & lineleft()=1}{PAGE}{FI}
         { dalej:=tab_fir.next();~~}
         {OD}
         {ELIF: EDIT_ES.PODSUM='G'}
         {WHILE: dalej}
         {DO}
         { {? tab_fir.ROKP<>'' & tab_fir.OKR<>'' & tab_fir.GRUPA<>''
           || w[1]:=tab_fir.ROKP;
              w[2]:=exec('msc_nazwa','#convert',tab_fir.OKRES);
              w[3]:=tab_fir.GRUPA;
              w[4]:=form(tab_fir.SAMOP,,2,' ,');
              w[5]:=form(tab_fir.SAMOF,,2,' ,');
              {? FINFO.TOR_D='T'
              || w[6]:=form(tab_fir.SAMOD,,2,' ,')
              ?}
           ?};
         ~~}
         {IF: tab_fir.ROKP<>'' & tab_fir.OKR<>'' & tab_fir.GRUPA<>''}
         {SUBSTITUTE: 'LINIA0'}{ vp:=0; {? lineleft=0 || vp:=1 ?};~~}
         {FI}
         {FONT: 'T8'}
         {IF: PAR_WYDR.RSEP=1 & lineleft()=1}{PAGE}{FI}
         { dalej:=tab_fir.next();~~}
         {OD}
         {ELIF: EDIT_ES.PODSUM='O' | EDIT_ES.PODSUM='K'}
         {WHILE: dalej}
         {DO}
         { {? tab_fir.ROKP<>'' & tab_fir.OKR<>'' & tab_fir.JKSIEG<>'' & tab_fir.GRUPA<>''
           || w[1]:=tab_fir.ROKP;
              w[2]:=exec('msc_nazwa','#convert',tab_fir.OKRES);
              w[3]:=tab_fir.JKSIEG;
              w[4]:=tab_fir.GRUPA;
              w[5]:=form(tab_fir.SAMOP,,2,' ,');
              w[6]:=form(tab_fir.SAMOF,,2,' ,');
              {? FINFO.TOR_D='T'
              || w[7]:=form(tab_fir.SAMOD,,2,' ,')
              ?}
           ?};
         ~~}
         {IF: tab_fir.ROKP<>'' & tab_fir.OKR<>'' & tab_fir.JKSIEG<>'' & tab_fir.GRUPA<>''}
         {SUBSTITUTE: 'LINIA0'}{ vp:=0; {? lineleft=0 || vp:=1 ?};~~}
         {FI}
         {FONT: 'T8'}
         {IF: PAR_WYDR.RSEP=1 & lineleft()=1}{PAGE}{FI}
         { dalej:=tab_fir.next();~~}
         {OD}
         {FI}
   {ELSE}
         {IF: EDIT_ES.PODSUM='L'}
         {WHILE: dalej}
         {DO}
         { {? tab_fir.ROKP<>'Razem'
           || w[1]:=tab_fir.ROKP;
              w[2]:=form(tab_fir.SAMOP,,2,' ,');
              w[3]:=form(tab_fir.SAMOF,,2,' ,');
              {? FINFO.TOR_D='T'
              || w[4]:=form(tab_fir.SAMOD,,2,' ,')
              ?}
           ?};
         ~~}
         {IF: tab_fir.ROKP<>'Razem'}{SUBSTITUTE: 'LINIA0'}{ vp:=0; {? lineleft=0 || vp:=1 ?};~~}{FI}
         {FONT: 'T8'}
         {IF: PAR_WYDR.RSEP=1 & lineleft()=1}{PAGE}{FI}
         { dalej:=tab_fir.next();~~}
         {OD}
         {ELIF: EDIT_ES.PODSUM='G'}
         {WHILE: dalej}
         {DO}
         { {? tab_fir.ROKP<>'' & tab_fir.GRUPA<>''
           || w[1]:=tab_fir.ROKP;
              w[2]:=tab_fir.GRUPA;
              w[3]:=form(tab_fir.SAMOP,,2,' ,');
              w[4]:=form(tab_fir.SAMOF,,2,' ,');
              {? FINFO.TOR_D='T'
              || w[5]:=form(tab_fir.SAMOD,,2,' ,')
              ?}
           ?};
         ~~}
         {IF: tab_fir.ROKP<>'' & tab_fir.GRUPA<>''}{SUBSTITUTE: 'LINIA0'}{ vp:=0; {? lineleft=0 || vp:=1 ?};~~}{FI}
         {FONT: 'T8'}
         {IF: PAR_WYDR.RSEP=1 & lineleft()=1}{PAGE}{FI}
         { dalej:=tab_fir.next();~~}
         {OD}
         {ELIF: EDIT_ES.PODSUM='O' | EDIT_ES.PODSUM='K'}
         {WHILE: dalej}
         {DO}
         { {? tab_fir.ROKP<>'' & tab_fir.JKSIEG<>'' & tab_fir.GRUPA<>''
           || w[1]:=tab_fir.ROKP;
              w[2]:=tab_fir.JKSIEG;
              w[3]:=tab_fir.GRUPA;
              w[4]:=form(tab_fir.SAMOP,,2,' ,');
              w[5]:=form(tab_fir.SAMOF,,2,' ,');
              {? FINFO.TOR_D='T'
              || w[6]:=form(tab_fir.SAMOD,,2,' ,')
              ?}
           ?};
         ~~}
         {IF: tab_fir.ROKP<>'' & tab_fir.JKSIEG<>'' & tab_fir.GRUPA<>''}
         {SUBSTITUTE: 'LINIA0'}{ vp:=0; {? lineleft=0 || vp:=1 ?};~~}
         {FI}
         {FONT: 'T8'}
         {IF: PAR_WYDR.RSEP=1 & lineleft()=1}{PAGE}{FI}
         { dalej:=tab_fir.next();~~}
         {OD}
         {FI}
    {FI}
{ELSE}
{WHILE: dalej}
{DO}
{ w[1]:=tab_fir.PODZ;
  w[2]:=form(tab_fir.SAMOP,,2,' ,');
  w[3]:=form(tab_fir.SAMOF,,2,' ,');
  {? FINFO.TOR_D='T'
  || w[4]:=form(tab_fir.SAMOD,,2,' ,')
  ?};
  {? tab_fir.POZIOM=0 & tab_fir.ROKP<>''
  ||  sstr1+=tab_fir.SAMOP; sstr2+=tab_fir.SAMOF;
      suma1+=tab_fir.SAMOP; suma2+=tab_fir.SAMOF;
      {? FINFO.TOR_D='T'
      || sstr3+=tab_fir.SAMOD; suma3+=tab_fir.SAMOD
      ?}
  ?};
~~}
{SUBSTITUTE: 'LINIA0'}{ vp:=0; {? lineleft=0 || vp:=1 ?};~~}
{FONT: 'T8'}
{IF: PAR_WYDR.RSEP=1 & lineleft()=1}{PAGE}{FI}
{ dalej:=tab_fir.next();~~}
{OD}
{FI}
{FOOTER}{FOOTER-}
{ENTIRE}
{IF: ~rep_export()}
{FONT: 'T8B'}{SPACE: 'C'}{ ww[4]:=form(sstr3,,2,' ,');~~}
{COMMENT}
{ ww[1]:='SUMA STRONY'@; ww[2]:=form(sstr1,,2,' ,'); ww[3]:=form(sstr2,,2,' ,');~~}
{SUBSTITUTE: 'LINIA1'}{ ww[4]:=form(suma3-sstr3,,2,' ,');~~}
{IF: page>1}{ ww[1]:='Z PRZENIESIENIA'@; ww[2]:=form(suma1-sstr1,,2,' ,'); ww[3]:=form(suma2-sstr2,,2,' ,');~~}
{SUBSTITUTE: 'LINIA1'}{FI}
{COMMENT-}
{ PRN.setcolor('255:255:255');~~}{ ww[4]:=form(suma3,,2,' ,');~~}
{ ww[1]:='RAZEM'@; ww[2]:=form(suma1,,2,' ,'); ww[3]:=form(suma2,,2,' ,');~~}
{FI}
{SUBSTITUTE: 'LINIA1'}
{SUBSTITUTE: 'LINIAF'}
{IF: ~rep_export()}{FONT: 'T8'}{<1>{charleft()} 'KONIEC WYDRUKU'@}{FI}
{ENTIRE-}

