:!UTF-8
{INCLUDE: wsp_pw.rpi}
{INCLUDE: wsp_pw3.rpi}
{'--------------------------------------------------------------';~~}
{'                        CZOŁÓWKA                              ';~~}
{'--------------------------------------------------------------';~~}
{HEADER}
{
{? PAR_WYDR.PAR1=2
   || PAR_WYDR.TITLE:='DOKUMENTY W REJESTRZE %1 - %2 W WYBRANCH OKRESACH'@[rejsym,rejodd]
   || PAR_WYDR.TITLE:='DOKUMENTY W REJESTRACH WEDŁUG DAT'@
?};
~~}
{FONT: 'T8G'}{SPACE: 'B'}
{SUBSTITUTE: 'HEAD' }
{FONT: 'T8G'}{SPACE: 'B'}
{LINE: 1}
{IF: page=1}
{<1 'PARAMETRY WYDRUKU:'@}
{<1 par_okr}
{<1 par_odd}
{<1 par_wal}
{<1 par_daty}
{FI}
{FONT: 'T8GB'}{SPACE: 'B'}{ PRN.setcolor(color); prn1:='PRN';~~}
{SUBSTITUTE: 'TABHEAD'}
{REP: PRN.fbar()}
{FONT: 'T8G'}{SPACE: 'B'}{ PRN.setcolor('255:255:255');~~}
{HEADER-}
{'--------------------------------------------------------------';~~}
{'                          FOOTER                              ';~~}
{'--------------------------------------------------------------';~~}
{FOOTER:0}
{FONT: 'T8GB'}{SPACE: 'B'}
{prn1:='PRN'; prn2:='PRNF'; ~~}
{f[1]:='Suma strony'; f[2]:=form(sstr4,,2,' ,'); f[3]:= form(sstr5,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA02'}
{prn1:='PRNF'; ~~}
{IF: page>1}
{f[1]:='Z przeniesienia'; f[2]:=form((suma4-sstr4),,2,' ,'); f[3]:=form((suma5-sstr5),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA0'}
{FI}
{f[1]:='Do przeniesienia'; f[2]:=form(suma4,,2,' ,'); f[3]:=form(suma5,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA0'}
{REP: PRNF.flbar()}
{SUBSTITUTE: 'CHARFOOT'}{FONT: 'T8G'}{SPACE: 'C'}{ sstr4:=sstr5:=0; ~~}
{FOOTER-}
{'---------------------------------MACRO SRODEK-----------------------------';~~}
{MACRO: 'SRODEK'}
{IF: (-(1+POZ.KOM().KS().TYP)='b') &
           POZ.DOK().DTW>=PAR_WYDR.DPAR1 &
           POZ.DOK().DTW<=PAR_WYDR.DPAR2}
        {   {? last_nr=POZ.DOK().NRDZ & last_sym=POZ.DOK().NK & ~rep_export
            || w[1]:='';
               w[3]:='';
               w[4]:=''
            || w[1]:=POZ.DOK().NRDZ;
               w[3]:=$POZ.DOK().DTW;
               w[4]:=POZ.DOK().NK
            ?};
            w[8]:=form(POZ.POZ,5);
            w[5]:=POZ.KON;
            w[6]:={? -POZ.STR='wn' || sstr4+=POZ.SUM;  suma4+=POZ.SUM; form(POZ.SUM,,2,' ,') || form(0,,2,' ,') ?};
            w[7]:={? -POZ.STR='ma' || sstr5+=POZ.SUM;  suma5+=POZ.SUM; form(POZ.SUM,,2,' ,') || form(0,,2,' ,') ?};
            {? rep_export
            || w[2]:=POZ.DOK().REJ().KOD+(8-(+REJ.KOD))*' ';
               w[9]:={? odd ||'' ||  REJ.ODD().OD+(8-(+ODD.OD))*' ' ?};
               w[10]:=form(DOK.NR,5,,'9')
            || {? last_nr=POZ.DOK().NRDZ & last_sym=POZ.DOK().NK
               || w[2]:=''
               || w[2]:=POZ.DOK().REJ().KOD+(8-(+REJ.KOD))*' '+{? odd || '' || ' / '+REJ.ODD().OD+(8-(+ODD.OD))*' ' ?}+'/'+form(DOK.NR,5,,'9')
               ?}
            ?};
            POZ.DOK(); last_nr:=DOK.NRDZ;last_sym:=DOK.NK ;~~
        }
{ PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{REP: PRN.fline()}
{OD}
{FI}
{MACRO-}
{'--------------------------------------------------------------';~~}
{'                       CIAŁO WYDRUKU                          ';~~}
{'--------------------------------------------------------------';~~}
{  DZIENNIK.OBWN:=DZIENNIK.OBMA:=0; ~~}
{ rsep:=PAR_WYDR.RSEP; ~~}
{FONT: 'T8G'}{SPACE: 'B'}
{IF: PAR_WYDR.PAR1=2}
   {FOR: 'OKRO_F'}{INDEX: 'ROK'}{FROM:SSTALE.AR, ROZNE.UT_OKROD().NR}{TO: SSTALE.AR, ROZNE.UT_OKRDO().NR}
   {DO}
      { DOK.use('doku'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
      { POZ.use('pozy'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
      {FOR: 'POZ'}{INDEX: indtym1}{PREFIX: 'T','T',rejestr}{DO}{SUBSTITUTE: 'SRODEK'}{OD}
   {OD}
{ELSE}
   {IF: odd}
      {FOR: 'REJ'}{INDEX: 'KOD'}{PREFIX: SSTALE.AR,OPERATOR.DEPT}
      {DO}
         {FOR: 'OKRO_F'}{INDEX: 'ROK'}{FROM:SSTALE.AR, ROZNE.UT_OKROD().NR}{TO: SSTALE.AR, ROZNE.UT_OKRDO().NR}
         {DO}
            { DOK.use('doku'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
            { POZ.use('pozy'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
            {FOR: 'POZ'}{INDEX: indtym1}{PREFIX: 'T','T',REJ.ref}{DO}{SUBSTITUTE: 'SRODEK'}{OD}
         {OD}
      {OD}
   {ELSE}
      {FOR: 'REJ'}{INDEX: 'KOD'}{PREFIX: SSTALE.AR}
      {DO}
         {FOR: 'OKRO_F'}{INDEX: 'ROK'}{FROM:SSTALE.AR, ROZNE.UT_OKROD().NR}{TO: SSTALE.AR, ROZNE.UT_OKRDO().NR}
         {DO}
            { DOK.use('doku'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
            { POZ.use('pozy'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
            {FOR: 'POZ'}{INDEX: indtym1}{PREFIX: 'T','T',REJ.ref}{DO}{SUBSTITUTE: 'SRODEK'}{OD}
         {OD}
      {OD}
   {FI}
{FI}
{'--------------------------------------------------------------';~~}
{  okres:=SSTALE.AO().NR;
   _m1:=SSTALE.AO().ROK().KOD;
   _m2:=form(SSTALE.AO().NR,-2);
   {? PAR_WYDR.PAR1=2
   || OKRO_F.cntx_psh;
      OKRO_F.index('ROK');
      OKRO_F.prefix(SSTALE.AR);
      OBR.cntx_psh;
      OBR.index('OKR');
      _a:=OKRO_F.first;
      {! |? _a & (OKRO_F.NR<okres) |!
            OBR.prefix(OKRO_F.NR);
           _b:=OBR.first;
           {! |? _b |!
                  {? (-(1+OBR.AN().KS().TYP)='b') & (OBR.AN().WAL=FINFO.NAROD) &
                        (OBR.ODD=OPERATOR.DEPT | ~OPERATOR.DEPT)
                     || echo('Trwają obliczenia dla konta %1'@[AN.SYM]);
                        nar4+=OBR.WN;  nar5+=OBR.MA
                  ?};
                 _b:=OBR.next
           !};
           _a:=OKRO_F.next
      !};
      OBR.cntx_pop;
      OKRO_F.cntx_pop
   || rejestr:=REJ.ref(); rejodd:=ODD.ref();
      OKRO_F.cntx_psh();
      OKRO_F.index('ROK'); OKRO_F.prefix(SSTALE.AR);
      {? OKRO_F.first() ||
         {? OKRO_F.NR<okres ||
            {! |? m1:=OKRO_F.ROK().KOD;
                  m2:=form(OKRO_F.NR,-2);
                  {? OPERATOR.DEPT=0
                     || ODD.cntx_psh(); ODD.index('ODDZIALY'); ODD.prefix(REF.FIRMA);
                        {? ODD.first() ||
                           {! |? rejodd:=ODD.ref();
                                 exec('obr_mc','!fks_ksr_zddz',m1,m2,rejestr,rejodd);
                                 ODD.next()
                           !}
                        ?};
                        ODD.cntx_pop()
                     || exec('obr_mc','!fks_ksr_zddz',m1,m2,rejestr,rejodd)
                  ?};
                  {? OKRO_F.NR=okres-1 || _a:=0 || _a:=1 ?};
                  OKRO_F.next();
                  _a
            !}
         ?}
      ?};
      OKRO_F.cntx_pop();
      nar4:=DZIENNIK.OBWN;
      nar5:=DZIENNIK.OBMA;
      AN.use('koan__'+_m1);
      DOK.use('doku'+_m1+_m2)
   ?}; ~~}
{FOOTER}{SUBSTITUTE: 'CHARFOOT'}{FOOTER-}
{IF: ~rep_export}
{IF: lineleft()<13 & lineleft()<>0}{PAGE}{FI}
{FONT: 'T8GB'}
{ENTIRE}
{REP: PRN.fjbar(PRNF)}
{prn1:='PRNF'; ~~}
{IF: page>1}
{f[1]:='Z przeniesienia'; f[2]:=form((suma4-sstr4),,2,' ,'); f[3]:=form((suma5-sstr5),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}{REP: PRNF.fbar()}
{FI}
{f[1]:='Razem'; f[2]:=form(suma4,,2,' ,'); f[3]:=form(suma5,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}{REP: PRNF.fbar()}
{f[1]:='Narastająco za przprzednie okresy'; f[2]:=form(nar4,,2,' ,'); f[3]:=form(nar5,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}{REP: PRNF.fbar()}
{f[1]:='Ogółem'; f[2]:=form((suma4+nar4),,2,' ,'); f[3]:=form((suma5+nar5),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{REP: PRNF.flbar(lmt)}
{<1>{il} 'KONIEC WYDRUKU '@}
{ENTIRE-}
{ELSE}
{REP: PRN1.flbar(lmt)}
{FI}