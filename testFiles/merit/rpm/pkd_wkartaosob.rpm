:!UTF-8
{TITLE:Kartoteka osobowa}
{PRINTER: exec('prt','param_wydr','v',KST),,,,,'Q','C',,,,,,1,
          PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   VAR_DEL.delete('zakres','tresc');
   tresc:='wkartosb';
   PAR_WYDR.TITLE:='Kartoteka osobowa'@;

   OS_SZKOL.cntx_psh();
   OS_ADRES.cntx_psh();
   PKO.cntx_psh();
   KART_DEF.cntx_psh();
   RD.cntx_psh();
   STAZ.cntx_psh();
   H.cntx_psh();
   WOJ.cntx_psh();
   UMLOJN.cntx_psh();
   OS_DNAUK.cntx_psh();
   P.cntx_psh();

   zakres:=obj_new('TAB','NDX','add','set','sz','ok');
   zakres.ok:=exec('uprawnieniawrap','pkd','danych osobowych'@,'ZWS_DOS_PPDO','ZWS_DOS_PRDO');
   {? +zakres.ok
   || FUN.emsg('Brak wymaganych uprawnień do przeglądania informacji o: %1'@[zakres.ok])
   || exec('pkd_wkartosob','!pkd_zes_orka');
      OS_SZKOL.index('OD');
      OS_ADRES.index('RODZAJ');
      params_set('P',exec('wybierz_parses','pracownik','PKD').P)
   ?}
}
{END:
   VAR_DEL.delete('zakres','tresc');
   P.cntx_pop();
   OS_DNAUK.cntx_pop();
   UMLOJN.cntx_pop();
   WOJ.cntx_pop();
   H.cntx_pop();
   STAZ.cntx_pop();
   RD.cntx_pop();
   KART_DEF.cntx_pop();
   PKO.cntx_pop();
   OS_ADRES.cntx_pop();
   OS_SZKOL.cntx_pop()
}
{COMMENT}OLD: wkartosb.rpm{COMMENT-}
{COMMENT}OLD: kartosob.rpi{COMMENT-}
{COMMENT}OLD: skid_pw.rpi{COMMENT-}
{EXIT: +zakres.ok}
{EXIT: ~params_get().P.first()}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: p_kartaosob.rpi}
{COMMENT}-----------------------------------------------------------------------------------------------------{COMMENT-}
{EXIT:
   _n:='Elementy wydruku';
   {? (_o:=exec('get','#profile',,tresc,_n))='' || _o:=zakres.TAB.size()*'1' ?};
   {! _i:=1..+_o |! zakres.set(_i,(_i+_o+1)='1') !};
   {? zakres.TAB.select()
   || _o:='';
      zakres.TAB.cntx_psh();
      zakres.TAB.index(zakres.NDX.ID);
      zakres.TAB.prefix();
      _dn:=zakres.TAB.first();
      {!
      |? _dn
      |! _o+=$zakres.TAB.STAN;
         _dn:=zakres.TAB.next()
      !};
      _dn;
      zakres.TAB.cntx_pop();
      exec('set','#profile',,tresc,_n,_o);
      0
   || 1
   ?}
}
{COMMENT}-----------------------------------------------------------------------------------------------------{COMMENT-}
{COMMENT}

   K O N F I G U R A C J A   -   N A G Ł Ó W E K,   S T O P K A

{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8'}
{SPACE: 'B'}
{LINE}
{HEADER-}
{FOOTER: 0}
{FONT: 'T8'}
{SPACE: 'B'}
{charleft()*'═'}
{FOOTER-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}
══════════════════════════════════════════════════════════════════════════════

   M A K R O D E F I N I C J E

{COMMENT-}
{MACRO: tresc}
{SUBSTITUTE: 'pracownik'}
{FOR: zakres.TAB}{INDEX:zakres.NDX.LP}
{DO}
   {IF: zakres.TAB.STAN}{SUBSTITUTE: zakres.TAB.MACRO}{FI}
{OD}
{IF: lineleft()}
   {PAGE}
{FI}
{MACRO-}
{COMMENT}
══════════════════════════════════════════════════════════════════════════════

   Z A W A R T O Ś Ć   W Y D R U K U

{COMMENT-}
{FONT: 'T8'}
{SPACE: 'B'}
{FOR: params_get().P}{DO}
   {IF: P.seek(params_get().P.SQL,,1)}
      {SUBSTITUTE: tresc}
   {FI}
{OD}