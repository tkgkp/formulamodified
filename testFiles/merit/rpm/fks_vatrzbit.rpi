:!UTF-8
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vatrzbit.rpi
==================================================
Zawartosc: Plik wykorzystywany w wydruku 'Wydruk rejestru VAT'
{COMMENT-}
{ exec('par_2','!fks_vat_zrej'); {? VAT7.WYD_TECH || PAR_WYDR.HEAD:=PAR_WYDR.LOGO:=0 ?};~~}
{ szer[1]:=9; szer[2]:=50; szer[3]:=szer[4]:=10; szer[6]:=50; szer[7]:=14; szer[8]:=14; szer[9]:=14;
  szer[10]:=8; szer[11]:=8; szer[12]:=14; szer[13]:=14; szer[14]:=14; szer[15]:=4; szer[16]:=11;szer[17]:=7;
PRN.add("w[18]",szer[15],' Lp.',1); w[18]:='';
  {? rep_expo()
  || PRN.add("w[1]",szer[1],'Rej. VAT');
     PRN.add("w[21]",szer[1],'Pozycja')
  || PRN.add("w[1]",szer[1],'Rej. VAT/ pozycja')
  ?};
  {? rep_expo()
  || PRN.add("w[2]",szer[2],'Symbol dokumentu');
     PRN.add("w[22]",szer[2],'Rej. księg.');
     PRN.add("w[23]",szer[2],'Pozycja');
     {?odd || PRN.add("w[24]",szer[2],'Jedn. ks.');colspan:=11 ?}
  || PRN.add("w[2]",szer[2],'  Symbol dokumentu Rej. księg./ pozycja'+{?odd||'  Jedn. ks.'||''?})
  ?};
  {? +param6++param7++param8>0
|| _szer:={? +param6>0 || szer[17]+1 || 0 ?} + {? +param7>0 || szer[3]+1 || 0 ?}+{? +param8>0 || szer[17]+1 || 0 ?}
|| _szer:=0
?};
  {? rep_expo()
  || PRN.add("w[25]",szer[4],'Data zapisu');
     PRN.add("w[26]",szer[4],'Data przekroczenia granicy');
     PRN.add("w[27]",szer[4],'Data odpr. cel.')
  || PRN.add("w[4]",szer[4],'D. zapisu/ przekr. granicy./ odpr. cel.')
  ?};
  PRN.add("w[6]",szer[6],'Kontrahent - nazwa, siedziba, numer identyfikacyjny');
  {? param6<>''  || PRN.add("w[50]",szer[17],'GTU')  ?};
  {? param7<>''  || PRN.add("w[51]",szer[3],'Procedury')  ?};
  {? param8<>''  || PRN.add("w[52]",szer[17],'Typ JPK')  ?};
  PRN.add("w[7]",szer[7],'Wartość celna',1);
  PRN.add("w[8]",szer[8],'     Cło',1);
  PRN.add("w[9]",szer[9],'Kwota podatku#  akcyzowego',1,'#');
  PRN.add("w[10]",szer[10],' Grupa#podatk.',,'#');
  PRN.add("w[11]",szer[11],' % VAT',1);
  PRN.add("w[12]",szer[12],'    Netto',1);
  PRN.add("w[13]",szer[13],'     VAT',1);
  PRN.add("w[14]",szer[13],'Koszty manip.',1);
  PRN1.add("ww[1]",szer[1]+szer[2]+szer[4]+szer[6]+szer[15]+4+_szer,'');
  PRN1.add("ww[2]",szer[7],'',1);
  PRN1.add("ww[3]",szer[8],'',1);
  PRN1.add("ww[4]",szer[9],'',1);
  PRN1.add("ww[5]",szer[10],'',1);
  PRN1.add("ww[6]",szer[11],'',1);
  PRN1.add("ww[7]",szer[12],'',1);
  PRN1.add("ww[8]",szer[13],'',1);
  PRN1.add("ww[9]",szer[14],'',1);~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}{IF: ~VAT7.WYD_TECH}{LINE: 1}{FI}
{SUBSTITUTE: 'HEAD'}
{FONT: 'W8'}{SPACE: 'C'}
{IF: page=1}
{<3 'Parametry wydruku:'}
{<6 'Jednostka księgowa: '+{? ~odd || OPERATOR.DEPT().OD || 'wszystkie jednostki księgowe' ?}+{? VAT7.TYPOKR='M' || '   Rodzaj okresu: '+{? SSTALE.AO().ZAM='T'||'zamknięty'||'otwarty'?} || '' ?}}
{IF: ~VAT7.WYD_TECH}{IF: dokvpoch<>''}{<6 dokvpoch}{FI}
{<6 'Kraj opodatkowania: '+kraj+{? wal_op<>'' || '   Waluta opodatkowania: '+wal_op || '' ?}}
{IF: param1<>''}
{<6 param1}{FI}{IF: param2<>''}
{<6 param2}{FI}{IF: param3<>''}
{<6 param3}{FI}{IF: param4<>''}
{<6 param4}{FI}{IF: param6<>''}
{<6 param6}{FI}{IF: param7<>''}
{<6 param7}{FI}{IF: param8<>''}
{<6 param8}{FI}{FI}{FI}
{LINE: 1}{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{IF: page=1}{REP: PRN.fbar()}{FI}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------MACRO-LINIA------------------{COMMENT-}
{MACRO: 'LINIA'}
{IF: ~font_gr}{IF: s2c}{FONT: 'T8U'}{ELSE}{FONT: 'T8G'}{FI}{ELSE}{FONT: 'T8GB'}{FI}{ PRN.setcolor('255:255:255');~~}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{REP: PRN.fline()}
{OD}{ vp:=0; PRN.setcolor(color);~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINIA1------------------{COMMENT-}
{MACRO: 'LINIA1'}
{IF: ~font_gr}{FONT: 'T8G'}{ELSE}{FONT: 'T8GB'}{FI}{ PRN1.setcolor('255:255:255');~~}
{PRN1.ini_line()}
{WHILE: PRN1.next()}
{DO}
{REP: PRN1.fline()}
{OD}{ vp:=0;  PRN1.setcolor(color); ~~}
{MACRO-}
{COMMENT}------------------------------FOOTER--------------------------{COMMENT-}
{SPACE: 'C'}
{IF: VAT7.WY3}
{FOOTER: 0}{FONT: 'T8G'}{SPACE: 'C'}
{PRN.lbar()}
{PRN1.hbar()}
{ ww[1]:='   SUMA STRONY'; ww[2]:= form(sstr7,,2,' ,'); ww[3]:= form(sstr8,,2,' ,'); ww[4]:= form(sstr9,,2,' ,'); ww[5]:='';
  ww[6]:=''; ww[7]:= form(sstr12,,2,' ,'); ww[8]:= form(sstr13,,2,' ,');  ww[9]:= form(sstr14,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{PRN1.bar()}{IF: page>1}
{ ww[1]:='   Z PRZENIESIENIA'; ww[2]:= form((suma7-sstr7),,2,' ,'); ww[3]:= form((suma8-sstr8),,2,' ,'); ww[4]:= form((suma9-sstr9),,2,' ,'); ww[5]:='';
  ww[6]:=''; ww[7]:= form((suma12-sstr12),,2,' ,'); ww[8]:= form((suma13-sstr13),,2,' ,');  ww[9]:=form((suma14-sstr14),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{PRN1.bar()}{FI}
{ ww[1]:='   DO PRZENIESIENIA'; ww[2]:= form(suma7,,2,' ,'); ww[3]:= form(suma8,,2,' ,'); ww[4]:= form(suma9,,2,' ,'); ww[5]:='';
  ww[6]:=''; ww[7]:= form(suma12,,2,' ,'); ww[8]:= form(suma13,,2,' ,');  ww[9]:= form(suma14,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{PRN1.lbar()}{ sstr7:=sstr8:=sstr9:=sstr10:=sstr11:=sstr12:=sstr13:=sstr14:=0; ~~}
{FOOTER-}
{ELSE}
{FOOTER: 0}{FONT: 'T8G'}{SPACE: 'C'}
{PRN.lbar()}{ vp:=1;~~}
{FOOTER-}
{FI}
{COMMENT}-----------------------------------------MACRO-SRODEK---------------------------------------{COMMENT-}
{MACRO: 'SRODEK'}
{IF:   (VAT7.WY4<>0 & (VAT7.WY4=1 & {? VAT7.JPK_GTU='' || 1
                                  |? VAT7.JPK_GTU*'BRAK'>0 & DVAT.DOK().JPK_GTU='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_GTU,DVAT.DOK().JPK_GTU)
                                  ?})) |
  (VAT7.WY5<>0 & (VAT7.WY5=1 & {? VAT7.JPK_PROC='' || 1
                                  |? VAT7.JPK_PROC*'BRAK'>0 & DVAT.DOK().JPK_PROC='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_PROC,DVAT.DOK().JPK_PROC)
                                  ?})) |
   (VAT7.WY6<>0 & (VAT7.WY6=1 & {? VAT7.JPK_TD='' || 1
                                  |? VAT7.JPK_TD*'BRAK'>0 & DVAT.DOK().JPK_V_T='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_TD,DVAT.DOK().JPK_V_T)
                                  ?})) |
   (VAT7.WY4=0 & VAT7.WY5=0 & VAT7.WY6=0)
                                  }
{IF: exec('chk_okr_vat','!fks_vat_zrej')}
{ _a:=DVAT.DOKOKRO().ROK().KOD+form(DVAT.DOKOKRO().NR,-2);
  DOK.use('doku'+_a);  DOK.prefix(); POZ.use('pozy'+_a);  POW.use('pow_'+_a);~~}
{IF: DOK.seek(DVAT.DOK)}
{IF: ((VAT7.PAR2=2) & (-DOK.DOK_REJ().KOR='n')) | ((VAT7.PAR2=1) & (-DOK.DOK_REJ().KOR='t')) |
       (VAT7.PAR2=3)}
{ s2c:=DVAT.USUNIETY; {? s2c || is_us:=1 ?};
  w[1]:=DVAT.RVAT().SYM;
 w[2]:=DVAT.SYM1;
 w[3]:=DVAT.DOK().REJ().KOD+(12-(+DVAT.DOK().REJ().KOD))*' '+form(DVAT.DOK().NR,8,,'99');
  w[4]:=DVAT.DAT1$1;
  w[5]:=DVAT.DAT2$1;
 w[20]:={? 6+rejestr<>'_WWspN' & 6+RVAT.KVAT().SYM<>'_WWspN'||DVAT.DAT4$1||''?};
w[21]:=$DVAT.NR;
  w[22]:= DVAT.DOK().REJ().KOD;
  w[23]:= form(DVAT.DOK().NR,8,,'99');
  w[24]:= REJ.ODD().OD;
  w[25]:= DVAT.DAT1$1;
  w[26]:= DVAT.DAT2$1;
  w[27]:= {?6+rejestr<>'_WWspN' & 6+RVAT.KVAT().SYM<>'_WWspN'||DVAT.DAT4$1||''?};
  {? param6<>'' || w[50]:=DVAT.DOK().JPK_GTU || w[50]:='' ?};
  {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
  {? param7<>'' || w[51]:=DVAT.DOK().JPK_PROC;  w[51]:=STR2.gsub(w[51],',',', ') || w[51]:='' ?};
  {? param8<>'' || w[52]:=DVAT.DOK().JPK_V_T || w[52]:='' ?};
  w66:=exec('szukkh','!fks_vat_zrej');
  w666:=''; licznik:=0;
  STR.split(w66);~~}
  { {? ~rep_expo()
  || STR2.split(w[50]);
     STR3.split(w[51])
  ?}; ~~}
{FOR: 'PVAT'}
{INDEX: 'DVAT_ST'}
{PREFIX: DVAT.ref}
{DO}
  { w7:=PVAT.SUMC; w8:=PVAT.CLO; w9:=PVAT.AKCYZA; w[10]:=PVAT.GRVAT().KOD;
    w[11]:=PVAT.STVAT().KOD; w12:=PVAT.SUM2; w13:=PVAT.VAT; w14:=PVAT.KOS; licznik+=1;
    {? s2c
    || ssu[1]+=w7; ssu[2]+=w8; ssu[3]+=w9; ssu[4]+=w12; ssu[5]+=w13; ssu[6]+=w14
    || sstr7+=w7; suma7+=w7; sstr8+=w8; suma8+=w8; sstr9+=w9; suma9+=w9; sstr12+=w12; suma12+=w12;
       sstr13+=w13; suma13+=w13; sstr14+=w14; suma14+=w14
    ?};
    ~~}
{COMMENT}-----------------------WYDRUK-------------------------------------{COMMENT-}
{ w[7]:=form(w7,,2,' ,'); w[8]:=form(w8,,2,' ,'); w[9]:=form(w9,,2,' ,'); w[12]:=form(w12,,2,' ,');
 w[13]:=form(w13,,2,' ,'); w[14]:=form(w14,,2,' ,');~~}
  {IF: licznik=1}
{IF: lineleft=1}{PAGE}{ vp:=1;~~}{ELSE}{ vp:=0;~~}{FI}
{IF: linijka}
{IF: vp}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}
{FI}{ numer+=1;w[18]:=$numer; w[6]:={? rep_expo() || w66 || STR.line(szer[6]) ?};~~}
{ {? ~rep_expo() || w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]) ?}; w[52]:=DVAT.DOK().JPK_V_T; ~~}
{SUBSTITUTE: 'LINIA'}{ linijka:=1;{? ~rep_expo() || w[18]:='' ?};~~}
{ {? rep_expo() || w[18]:='' ?};~~}
   {ELIF: licznik=2}
{IF: lineleft=0}{REP: PRN.fbar()}{FI}
{  w[4]:=w[20]; w[6]:={? rep_expo() || w66 || STR.line(53) ?}; {? ~rep_expo() || w[2]:=w[3] ?};   {? ~rep_expo() || w[1]:=$DVAT.NR ?};~~}
{{? ~rep_expo() || w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='' ?};~~}
{SUBSTITUTE: 'LINIA'}
   {ELIF: licznik=3}
{IF: lineleft=0}{REP: PRN.fbar()}{FI}
{ {? ~rep_expo() || {!_a:=1 ..3 |! w[_a]:='' !} ?}; {? odd & ~rep_expo() || w[2]:=REJ.ODD().OD?}; w[4]:=w[5]; w[6]:={? rep_expo() || w66 || STR.line(53) ?}; ~~}
{{? ~rep_expo() || w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='' ?};~~}
{SUBSTITUTE: 'LINIA'}
   {ELIF: licznik>3}
{IF: lineleft=0}{REP: PRN.fbar()}{FI}{  {!_a:=1 ..5 |! w[_a]:='' !}; w[6]:={? rep_expo() || w66 || STR.line(53) ?};~~}
{{? ~rep_expo() || w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='' ?};~~}
{SUBSTITUTE: 'LINIA'}{ w[18]:='';~~}
   {FI}
    {OD}{ {? ~rep_expo() || w[2]:=w[3]; w[1]:=$DVAT.NR ?};~~}
   {IF: ~rep_expo()}
   {IF: licznik=1}
{IF: lineleft=1}{PAGE}{REP: PRN.fbar()}{FI}
{  {!_a:=6 ..14 |! w[_a]:='' !}; w[6]:=STR.line(53); w[4]:=w[20]; ~~}
{{? ~rep_expo() || w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='' ?};~~}
{SUBSTITUTE: 'LINIA'}
{ w[1]:=w[3]:=''; {!_a:=7..14|!w[_a]:=''!}; w[2]:={? odd || REJ.ODD().OD || '' ?}; w[4]:=w[5];w[6]:=STR.line(53); ~~}
{{? ~rep_expo() || w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='' ?};~~}
{SUBSTITUTE: 'LINIA'}
   {ELIF: licznik=2}{w[1]:=w[3]:='';{!_a:=7..14|!w[_a]:=''!};w[2]:={?odd||REJ.ODD().OD||''?};w[4]:=w[5];w[6]:=STR.line(53); ~~}
     {{? ~rep_expo() || w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='' ?};~~}
{SUBSTITUTE: 'LINIA'}
   {FI}
   {FI}
  {FI}{ {! _a:=1..14 |! w[_a]:='' !};~~}
{IF: ~rep_expo()}
     { w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='';~~}
{WHILE: (w666:=STR.line(53); +w666) | (w[50]<>'' | w[51]<>'')}
{DO}
{ w[6]:=w666;~~}
{SUBSTITUTE: 'LINIA'}
     { w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:='';~~}
{OD}
{FI}
  {FI}
  {FI}
  {FI}
{MACRO-}
{COMMENT}----------------------PRZYGOTOWANIE WYDRUKU-----------------------{COMMENT-}
{FONT: 'Q'}{SPACE: 'C'}{ RS.index('RS'); RS.prefix();  ~~}
{IF: ~OPERATOR.DEPT}
   {okrVatNr:=1;~~}
   {WHILE: okrVatNr<=obj_len(okrVat)}
   {DO}
      {FOR: 'DVAT'}
      {INDEX: 'NR'}
      {PREFIX: VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref}
      {DO}
         {IF: exec('wystrokokr','!fks_vat_zrej')}{SUBSTITUTE: 'SRODEK'}{FI}
      {OD}
      {okrVatNr+=1;~~}
   {OD}
{ELSE}
   {okrVatNr:=1;~~}
   {WHILE: okrVatNr<=obj_len(okrVat)}
   {DO}
      {FOR: 'DVAT'}
      {INDEX: 'NR_O'}
      {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref}
      {DO}
         {IF: exec('wystrokokr','!fks_vat_zrej')}{SUBSTITUTE: 'SRODEK'}{FI}
      {OD}
      {okrVatNr+=1;~~}
   {OD}
{FI}
{COMMENT}----------------------------------------FOOTER-LAST----------------------------{COMMENT-}
{IF: ~rep_expo()}
{ linecnt:=lineleft();~~}
{IF: ((page>1 & ~VAT7.WY3 & linecnt<7) | page=1 & ~VAT7.WY3 & linecnt<6) & linecnt<>0}
{PAGE}{vp:=1;~~}
{ELSE}{{? linecnt=0 || vp:=1 || vp:=0 ?};~~}
{FI}{FOOTER}{FOOTER-}
{DIRECT}{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{PRN1.hbar()}{IF: page>1 & VAT7.WY3}
{ ww[1]:='   SUMA STRONY'; ww[2]:= form(sstr7,,2,' ,'); ww[3]:= form(sstr8,,2,' ,'); ww[4]:= form(sstr9,,2,' ,');  ww[5]:='';
  ww[6]:=''; ww[7]:= form(sstr12,,2,' ,'); ww[8]:= form(sstr13,,2,' ,');  ww[9]:= form(sstr14,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{PRN1.bar()}
{ ww[1]:='   Z PRZENIESIENIA'; ww[2]:= form((suma7-sstr7),,2,' ,'); ww[3]:= form((suma8-sstr8),,2,' ,'); ww[4]:= form((suma9-sstr9),,2,' ,');  ww[5]:='';
  ww[6]:=''; ww[7]:= form((suma12-sstr12),,2,' ,'); ww[8]:= form((suma13-sstr13),,2,' ,');  ww[9]:=form((suma14-sstr14),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{PRN1.bar()}{FI}
{ww[1]:='   RAZEM'; ww[2]:= form(suma7,,2,' ,'); ww[3]:= form(suma8,,2,' ,'); ww[4]:= form(suma9,,2,' ,');  ww[5]:='';
 ww[6]:=''; ww[7]:= form(suma12,,2,' ,'); ww[8]:= form(suma13,,2,' ,');  ww[9]:= form(suma14,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: s2c}
{PRN1.bar()}
{ww[1]:='   RAZEM operacje nie rozliczane w VAT'; ww[2]:= form(ssu[1],,2,' ,'); ww[3]:= form(ssu[2],,2,' ,'); ww[4]:= form(ssu[3],,2,' ,');  ww[5]:='';
 ww[6]:=''; ww[7]:= form(ssu[4],,2,' ,'); ww[8]:= form(ssu[5],,2,' ,');  ww[9]:= form(ssu[6],,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{FI}
{PRN1.lbar()}
{IF: ~rep_expo()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'}
{FI}
{ELSE}
{TABLE-}
{FI}
{DIRECT-}
{FOOTER}{FOOTER-}
