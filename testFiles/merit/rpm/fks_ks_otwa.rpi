:!UTF-8
{ kl:=18;
  PRNH.add("",94,'',,,,,,,,2);
  PRNH.add("",2*kl+1,{? ROZNE.UT_KS=0
                     || {? UNPAR.P7 || 'Bilans otwarcia - saldo' || 'Bilans otwarcia - obroty' ?}
                     || 'Obroty BO wynikające z BZ'
                     ?},,,,,,,,2);
  {? ROZNE.UT_KS
  || PRNH.add("",2*kl+1,'Obroty korekt BO'@,,,,,,,,2);
     {? UNPAR.P7
     || PRNH.add("",2*kl+1,'BO po korektach - saldo'@,,,,,,,,2)
     || PRNH.add("",2*kl+1,'BO po korektach - obroty'@,,,,,,,,2)
     ?}
  ?};
  PRN.add("form(w[1],35)",35,'Symbol konta'@);
  PRN.add("w[2]",58,'Nazwa konta'@);
  PRN.add("form(w[3],kl,2,' ,')",kl,'Wn'@,1);
  PRN.add("form(w[4],kl,2,' ,')",kl,'Ma'@,1);
  PRNF.add("w[1]",94,'',,,,,,,,2);
  PRNF.add("form(w[3],kl,2,' ,')",kl,'',1);
  PRNF.add("form(w[4],kl,2,' ,')",kl,'',1);
  {? ROZNE.UT_KS
  || PRN.add("form(w[5],kl,2,' ,')",kl,'Wn'@,1); PRNF.add("form(w[5],kl,2,' ,')",kl,'',1);
     PRN.add("form(w[6],kl,2,' ,')",kl,'Ma'@,1); PRNF.add("form(w[6],kl,2,' ,')",kl,'',1);
     PRN.add("form(w[7],kl,2,' ,')",kl,'Wn'@,1); PRNF.add("form(w[7],kl,2,' ,')",kl,'',1);
     PRN.add("form(w[8],kl,2,' ,')",kl,'Ma'@,1); PRNF.add("form(w[8],kl,2,' ,')",kl,'',1)
  ?};
  {? ROZNE.PAR1=2
  || PAR_WYDR.TITLE:='BILANS OTWARCIA ANALITYCZNIE ZA ROK %1'@[SSTALE.AR().NAZ]
  || PAR_WYDR.TITLE:='BILANS OTWARCIA SYNTETYCZNIE ZA ROK %1'@[SSTALE.AR().NAZ]
  ?};
  lmt:=int((charleft()-PRN.width())/2);~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}  --------------------------------  T A B H E A D 0  ---------------------------------------  {COMMENT-}
{MACRO: 'TABHEAD0'}
{  PRNH.setcolor(color);
   PRNH.ini_head(); ~~}
{REP: PRNH.fhbar(lmt)}
{WHILE: PRNH.h_next()}
{DO}
{REP: PRNH.h_fmline(lmt)}
{OD}
{REP: PRNH.fjbar(PRN,lmt)}
{  PRN.setcolor(color);
   PRN.ini_head();~~}
{WHILE: PRN.h_next()}
{DO}
   {REP: PRN.h_fmline(lmt)}
{OD}
{MACRO-}
{COMMENT}  -----------------------------------   HEADER  -------------------------------------------   {COMMENT-}
{HEADER}
{IF: ~rep_export()}
{LINE: 1}

{FI}
{FONT: 'HEAD'}{SPACE: 'B'}{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}

{IF: page=1}
{ param:={? ROZNE.PAR4=2 & (_a:=STR.gsub(ROZNE.MASKA,'?','');+_a) || 'Dla kont o masce: %1'@[ROZNE.MASKA]
         |? ROZNE.PAR4=0 & +ROZNE.PREFIX || 'Wydruk dla kont o prefiksie: %1'@[ROZNE.PREFIX]
         |? ROZNE.PAR4=3  || 'Wydruk wybranych kont syntetycznych'@
         |? ROZNE.PAR4=6  || 'Wydruk wybranych kont analitycznych'@
         |? ROZNE.PAR4=4  || 'Wydruk dla zakresu kont od: %1 do: %2'@[ROZNE.KS_OD().SYM,ROZNE.KS_DO().SYM]
         |? ROZNE.PAR4=5  || 'Wydruk dla kont według zestawu: %1 (%2)'@[ROZNE.KON_WYDR().KOD,ROZNE.KON_WYDR().ROK_F().NAZ]
         || 'Wydruk dla wszystkich kont'@
         ?};~~}
{IF: rep_export()}
{'Parametry wydruku:'}
{{? ROZNE.UT_DOK || 'Wydruk z pozycjami zerowymi: tak'@ || 'Wydruk z pozycjami zerowymi: nie'@ ?}}
{wal}
{{? SSTALE.AO().ZAM='T'||'Rodzaj okresu: zamknięty'@||'Rodzaj okresu: otwarty'@ ?}}
{param}
{{? UNPAR.PSLO || 'Waluta wydruku:  %1 - %2'@[UNPAR.PSLO().TR,SLO.KOD] || 'Waluta wydruku:  %1 - %2'@[SSTALE.WAL().TR,SLO.KOD] ?}}
{{? UNPAR.P25<>1 | (UNPAR.PSLO<>null & UNPAR.PSLO<>SSTALE.WAL) || 'Kurs: %1'@[$UNPAR.P25] || ~~ ?}}
{'Konta aktywno-pasywne z podwójnymi saldami: '}{IF: UNPAR.P8=0}tak{ELSE}nie{FI}
{kontotxt}
{{? +odd || odd || 'Wszystkie jednostki księgowe'@ ?}}
{'Wyszczególnienie korekt Bilansu otwarcia: '+{? ROZNE.UT_KS || 'tak'@ || 'nie'@ ?}}
{ELSE}
{<3 'Parametry wydruku:'}
{<6 {? ROZNE.UT_DOK || 'Wydruk z pozycjami zerowymi: tak'@ || 'Wydruk z pozycjami zerowymi: nie'@ ?}}{<76 wal}{<126 {? SSTALE.AO().ZAM='T'||'Rodzaj okresu: zamknięty'@||'Rodzaj okresu: otwarty'@ ?}}
{<6 param}{<76 {? UNPAR.PSLO || 'Waluta wydruku:  %1 - %2'@[UNPAR.PSLO().TR,SLO.KOD] || 'Waluta wydruku:  %1 - %2'@[SSTALE.WAL().TR,SLO.KOD] ?}}{<126 {? UNPAR.P25<>1 | (UNPAR.PSLO<>null & UNPAR.PSLO<>SSTALE.WAL) || 'Kurs: %1'@[$UNPAR.P25] || '' ?}}
{<6'Konta aktywno-pasywne z podwójnymi saldami: '}{IF: UNPAR.P8=0}tak{ELSE}nie{FI}{<76 kontotxt}
{<6 {? +odd || odd || 'Wszystkie jednostki księgowe'@ ?}}{<76 {?ROZNE.UT_KS||'Wyszczególnienie korekt Bilansu otwarcia: tak'@||'nie'@?}}
{FI}
{FI}
{LINE: 1}{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD0'}{vp:=1;~~}
{HEADER-}
{COMMENT}   -----------------------------------   FOOTER  -------------------------------------------  {COMMENT-}
{FOOTER:0}
{IF: ~rep_export()}
{FONT:'T8G'}{SPACE:'C'}
{ w[1]:=' SUMA STRONY';{! _i:=3..8|! w[_i]:=wws[_i] !};prn1:='PRNF';rsep:=0;~~}
{REP: PRN.fjbar(PRNF,lmt)}
{SUBSTITUTE: 'LINIA0'}{rsep:=1;~~}
{IF: page>1}{ w[1]:=' Z PRZENIESIENIA';{! _i:=3..8|! w[_i]:=wwp[_i]-wws[_i] !};~~}
{SUBSTITUTE: 'LINIA0'}
{FI}
{ w[1]:=' DO PRZENIESIENIA';{! _i:=3..8|! w[_i]:=wwp[_i]; wws[_i]:=0 !};~~}
{SUBSTITUTE: 'LINIA0'}
{REP: PRNF.lbar(lmt)}{vp:=1;prn1:='PRN';~~}
{FI}
{FOOTER-}
{IF: ~rep_export()}
{SUBSTITUTE: 'FOOT'}
{FI}
{COMMENT}  ---------------------------------------  WYDRUK  ----------------------------------------- {COMMENT-}
{FONT:'T8G'}{SPACE:'C'}
{IF: TABW.first()}
{FOR: TABW}
{INDEX: TABW.ndx_tmp('',0,'KONTO',,0)}
{DO}
{FIRST}
 {k:=TABW.KS;kssaldo:=TABW.KSSALDO;~~}
{FIRST-}
{IF: k<>TABW.KS & ~rep_export()}
 {IF: i>1}
  { w[1]:='Suma: '+k; w[2]:='';
    {? ROZNE.UT_KS
    || _it1:=3; _it2:=6; _it_k:=7
    || _it1:=5; _it2:=8; _it_k:=3
    ?};
    {! _i:=_it1.._it2 |! w[_i]:=ww1[_i] !};
    {? UNPAR.P7 & {? kssaldo='D' || UNPAR.P8 || 1 ?}
    || w[_it_k]:=F.SWn(ww1[_it_k],ww1[_it_k+1]);
       w[_it_k+1]:=F.SMa(ww1[_it_k],ww1[_it_k+1])
    || w[_it_k]:=ww1[_it_k]; w[_it_k+1]:=ww1[_it_k+1]
    ?};
    wwsynt[1]+=w[{? ROZNE.UT_KS || 7 || 3 ?}];
    wwsynt[2]+=w[{? ROZNE.UT_KS || 8 || 4 ?}];~~}
  {SUBSTITUTE: 'LINIA0'}
 {ELSE}
  {wwsynt[1]+=wpsynt[1];
   wwsynt[2]+=wpsynt[2];~~}
 {FI}
 {i:=0;{!_i:=3..8|!ww1[_i]:=0!}; k:=TABW.KS;~~}
{FI}
{IF: lineleft()<=(PRN.length()+rsep) & lineleft()<>0}{PAGE}{FI}
{w[1]:=TABW.KONTO;
 w[2]:={? rep_export()
       || SSTALE.AR();
          _tab:=exec('kon_fun','konto',TABW.KONTO);
          _opis:='';
          {! _i:=1..obj_len(_tab[2])
          |! _opis+=_tab[2][_i]+' / '
          !};
          &_tab;
          _opis-3
       || TABW.OPIS
       ?};
 kssaldo:=TABW.KSSALDO;
 {? TABW.REK='O'
 || {? (+w[1])>BILANSP.ASYNT || w[1]:=(+w[1]-int(TABW.BOWN)++BILANSP.ASEP)*' '+(w[1]+int(TABW.BOWN)) ?};
    w[3]:=w[4]:=w[5]:=w[6]:=w[7]:=w[8]:=''
 || w[3]:=TABW.BOWN; w[4]:=TABW.BOMA; w[5]:=TABW.KBOWN; w[6]:=TABW.KBOMA; w[7]:=TABW.BZWN; w[8]:=TABW.BZMA;
    wpsynt[1]:=w[{? ROZNE.UT_KS || 7 || 3 ?}];
    wpsynt[2]:=w[{? ROZNE.UT_KS || 8 || 4 ?}]
 ?};
 {? TABW.REK='P' & k=TABW.KS || i+=1;{!_i:=3..8|! wwp[_i]+=w[_i];wws[_i]+=w[_i];ww1[_i]+=w[_i] !} ?};~~}
 {SUBSTITUTE: 'LINIA0'}
{OD}
{IF: i>1}
 { w[1]:='Suma: '+k; w[2]:='';
   {? ROZNE.UT_KS
   || _it1:=3; _it2:=6; _it_k:=7
   || _it1:=5; _it2:=8; _it_k:=3
   ?};
   {! _i:=_it1.._it2 |! w[_i]:=ww1[_i] !};
   {? UNPAR.P7 & {? kssaldo='D' || UNPAR.P8 || 1 ?}
   || w[_it_k]:=F.SWn(ww1[_it_k],ww1[_it_k+1]);
      w[_it_k+1]:=F.SMa(ww1[_it_k],ww1[_it_k+1])
   || w[_it_k]:=ww1[_it_k]; w[_it_k+1]:=ww1[_it_k+1]
   ?};
   wwsynt[1]+=w[{? ROZNE.UT_KS || 7 || 3 ?}];
   wwsynt[2]+=w[{? ROZNE.UT_KS || 8 || 4 ?}];~~}
 {SUBSTITUTE: 'LINIA0'}
{ELSE}
 { wwsynt[1]+=wpsynt[1];
   wwsynt[2]+=wpsynt[2];~~}
{FI}
{FOOTER:0}{FOOTER-}
{FONT:'T8G'}{SPACE:'C'}
{IF: ~rep_export()}
{ w[1]:=' SUMA STRONY';{! _i:=3..8|! w[_i]:=wws[_i] !};prn1:='PRNF';rsep:=0;~~}
{REP: PRN.fjbar(PRNF,lmt)}
{SUBSTITUTE: 'LINIA0'}{rsep:=1;~~}
{IF: page>1}{ w[1]:=' Z PRZENIESIENIA'@;{! _i:=3..8|! w[_i]:=wwp[_i]-wws[_i] !};~~}
{SUBSTITUTE: 'LINIA0'}
{FI}
{ELSE}{w[2]:=''; ~~}
{FI}
{ w[1]:=' RAZEM';{! _i:=3..8|! w[_i]:=wwp[_i]; wws[_i]:=0 !};~~}
{SUBSTITUTE: 'LINIA0'}
{IF: ROZNE.PAR1=2}
{ w[1]:=' RAZEM - syntetycznie'@;
  w[{? ROZNE.UT_KS || 7 || 3 ?}]:=wwsynt[1];
  w[{? ROZNE.UT_KS || 8 || 4 ?}]:=wwsynt[2];~~}
{SUBSTITUTE: 'LINIA0'}
{FI}
{ w[1]:=' PER SALDO';w[3]:=F.SWn(wwp[3],wwp[4]); w[4]:=F.SMa(wwp[3],wwp[4]); w[5]:=F.SWn(wwp[5],wwp[6]);
                     w[6]:=F.SMa(wwp[5],wwp[6]); w[7]:=F.SWn(wwp[7],wwp[8]); w[8]:=F.SMa(wwp[7],wwp[8]);~~}
{IF: lineleft()=3 | lineleft()=2 | lineleft()=1}
{REP: PRNF.lbar(lmt)}
{PAGE}{ prn1:='PRN'; prn2:='PRNF'; vp:=1;~~}
{SUBSTITUTE: 'LINIA02'}
{ELSE}
{SUBSTITUTE: 'LINIA0'}
{FI}
{pp:=page;~~}
{IF: page=pp}{vp:=0;~~}{FI}
{REP: PRNF.flbar(lmt)}{ vp:=1; prn1:='PRN';~~}
{IF: ~rep_export()}
{<{lmt}>{PRN.width()+lmt} 'KONIEC WYDRUKU1'@}
{FI}
{ELSE}
{FOOTER:0}{FOOTER-}
{ENTIRE}
{ _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
{REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
{ _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}
{REP: _f:=prn1+'.flbar(lmt)'; ($(_f))()}
{IF: ~rep_export()}
{<{lmt}>{PRN.width()+lmt} 'KONIEC WYDRUKU2'@}
{FI}
{ENTIRE-}
{FI}