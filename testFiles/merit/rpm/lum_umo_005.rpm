:!UTF-8
{TITLE:E. Zestawienie umów wg harmonogramu}
{PRINTER: exec('set_parw','param_wydr'); exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,
   PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1,,'enable'}
{BEGIN:
   KH.cntx_psh();
   KH.win_dict('WERHOME2');
   STU.cntx_psh();
   STU.win_dict('WER1');
   STU.index('NAZ');
   UM.cntx_psh();
   UM.win_dict('WER');
   JM.cntx_psh();
   JM.win_dict('WER1');
   UP.cntx_psh();
   UP.ndx_drop();
   ind:=UP.ndx_tmp(,1,'UM',,,'H',,);
   VAR_DEL.delete('PRN','k','w','n','tryb');

   PRN:=obj_new(@.CLASS.PRINT,12);  PRN.s_frame();
   tryb:=rep_export();

   k:=obj_new(4);
   w:=obj_new(4);
   n:=obj_new(4);

   k[1] := 15;  n[1] := 'Umowa'@;
   k[2] := 7;   n[2] := 'Pozycja'@;
   k[3] := 20;  n[3] := 'Ilość'@;
   k[4] := 30;  n[4] := 'Jednostka'@;
   w[1] := w[2] := w[3] := w[4] := '';

   lp:=0;

   od_kh:='';
   do_kh:='';
   od_khk:='';
   do_khk:='';

   od_symk:='';
   do_symk:='';

   od_datyod:=date;
   do_datyod:=date;

   od_datydo:=date;
   do_datydo:=date;

   od_datywyd:=date;
   do_datywyd:=date;

   jed:='';
   stu:='';

   ok:=0;

   'zmienne pomocnicze do wydrukow graficznych';
   color:='';
   prn1:='PRN'; prn2:='PRX';
   lm:=ll:=vp:=lmt:=0; rsep:=PAR_WYDR.RSEP;

   'parametry z tabeli WYDRUKI';
   _wydr_naz:='umo_005';
   WYDRUKIL.index('WYDRUKI');
   WYDRUKIL.prefix(OPERATOR.USER().KOD,_wydr_naz,);
   {? ~WYDRUKIL.first()
   ||
      WYDRUKIL.blank();
      WYDRUKIL.USERS:=OPERATOR.USER().KOD;
      WYDRUKIL.WYDRUK:=_wydr_naz;
      WYDRUKIL.add()
   ?};
   PAR_WYDR.TITLE:='Zestawienie umów wg harmonogramów'@
;~~}
{END:
   KH.cntx_pop();
   STU.cntx_pop();
   UM.cntx_pop();
   JM.cntx_pop();
   UP.ndx_drop(ind);
   UP.cntx_pop();

   &ind;
   VAR_DEL.delete('PRN','k','w','n','tryb');
   &lp;

   &od_kh;
   &do_kh;
   &od_khk;
   &do_khk;

   &od_symk;
   &do_symk;

   &od_datyod;
   &do_datyod;

   &od_datydo;
   &do_datydo;

   &od_datywyd;
   &do_datywyd;

   &ok_dataod;
   &ok_datado;
   &ok_datawyd;

   &jed;
   &stu;

   &ok
;~~}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: lum_umo_005.rpi}
{ PRN.add("form(w[1])",k[1],n[1]); ~~}
{ PRN.add("form(w[2])",k[2],n[2],1); ~~}
{ PRN.add("form(w[3],,3)",k[3],n[3],1); ~~}
{ PRN.add("form(w[4])",k[4],n[4]); ~~}
{
   WYDRUKIL.win_edit('UMO_005');
   {? WYDRUKIL.edit()
   || ok:=WYDRUKIL.put();
      {? WYDRUKIL.HM<>null
      ||
         PAR_WYDR.TITLE:='Zestawienie umów wg harmonogramu %1'@[WYDRUKIL.HM().KOD]
      ?};
      od_kh  := WYDRUKIL.KH_OD;
      do_kh  := WYDRUKIL.KH_DO;
      od_khk := WYDRUKIL.KH_OD().KOD;
      do_khk := WYDRUKIL.KH_DO().KOD;

      od_symk := WYDRUKIL.UM_OD().SYM;
      do_symk := WYDRUKIL.UM_DO().SYM;

      od_datywyd:=WYDRUKIL.OD_DATY;
      do_datywyd:=WYDRUKIL.DO_DATY;

      od_datyod:=WYDRUKIL.OD_DATY1;
      do_datyod:=WYDRUKIL.DO_DATY1;

      od_datydo:=WYDRUKIL.OD_DATY2;
      do_datydo:=WYDRUKIL.DO_DATY2;

      jed := WYDRUKIL.JM().KOD;
      stu := WYDRUKIL.STU().KOD
   ?}
;~~}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: tryb<>1}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<{lmt+1}}{'Parametry wydruku:'@}
{IF:od_khk<>''|do_khk<>''}{<{lmt}'Kontrahenci'@}{<{lmt+20}od_khk}{<{lmt+42}do_khk}{FI}
{IF:od_symk<>''|do_symk<>''}{<{lmt}'Umowy'@}{<{lmt+20}od_symk}{<{lmt+42}do_symk}{FI}
{IF:od_datywyd<>#0|do_datywyd<>#0}{<{lmt}'Data wydania'@}{<{lmt+20}od_datywyd}{<{lmt+42}do_datywyd}{FI}
{IF:od_datyod<>#0|do_datyod<>#0}{<{lmt}'Data od'@}{<{lmt+20}od_datyod}{<{lmt+42}do_datyod}{FI}
{IF:od_datydo<>#0|do_datydo<>#0}{<{lmt}'Data do'@}{<{lmt+20}od_datydo}{<{lmt+42}do_datydo}{FI}
{IF:jed<>''|stu<>''}
   {IF:jed<>''}{<{lmt}'Jednostka'@}{<{lmt+20}jed}{FI}
   {IF:stu<>''}{<{lmt}'Status umowy'@}{<{lmt+20}stu}{FI}
{FI}
{FONT: 'T8GB'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: ok=1}
   {SUBSTITUTE:'druk'}
{FI}