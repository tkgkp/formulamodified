:!UTF-8
{TITLE:B.  Konta analityczne}
{PRINTER: exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:  {? var_pres('PRN')>0 || obj_del(PRN) ?};
         {? var_pres('PRNH')>0 || obj_del(PRNH) ?};
         {? var_pres('PRNS')>0 || obj_del(PRNS) ?};
         PRN:=obj_new(@.CLASS.PRINT,10);  PRN.sl_frame();
         PRNH:=obj_new(@.CLASS.PRINT,5);  PRNH.sl_frame();
         PRNS:=obj_new(@.CLASS.PRINT,10); PRNS.sl_frame();
         ROZNE.win_edit('KS_4'); SA:='A'; ROZNE.BZ:='N';
         KON_WYDR.actions('WER','I:I',':d');
         USERS.actions('SLO','T');USERS.win_dict('SLO');
         KON_WYDR.hdr_sel; KON_WYDR.hdr_sel(' - analityczne, użytkownika (%1)'@[@.OPERATOR.USER().KOD]);
         {? ~(var_pres('O_AN')>100) || _typwys:=ROZNE.TYP_WYS; ROZNE.blank(1); ROZNE.TYP_WYS:=_typwys; ROZNE.PAR4:=ROZNE.UT_KS:=0; ROZNE.PAR1:=ROZNE.UT_DOK:=ROZNE.UT_ROZR:=1; ROZNE.PAR3:=0; ROZNE.PAR2:=3 ?};
         ROZNE.DATA_OD:=SSTALE.AO().POCZ; ROZNE.DATA_DO:=SSTALE.AO().KON; ROZNE.UT_SCAL:=1; ROZNE.WYD_TECH:=0; ROZNE.efld_opt(ROZNE.win_edit('?'),'enable=1, editable=1',,'UT_SCAL');
         {? ~rep_export() || ROZNE.efld_opt(ROZNE.win_edit('KS_4'),'enable=0, editable=0',,'WYD_TECH') || ROZNE.efld_opt(ROZNE.win_edit('KS_4'),'enable=1, editable=1',,'WYD_TECH') ?};
         exec('ini_wal','konto');
         kontotxt:=wal:=odd:=param:=k:=o:=color:=rokr:='';
         prn1:='PRN'; prn2:='PRNH'; lm:=ll:=lmt:=i:=rsep:=kon:=0;vp:=1;
         tuser:=tm_form(TMPVAT.tm_stamp);
         {? var_pres('w')>100 || obj_del(w) ?};
         {? var_pres('ww')>100 || obj_del(ww) ?};
         {? var_pres('wws')>100 || obj_del(wws) ?};
         {? var_pres('wwp')>100 || obj_del(wwp) ?};
         {? var_pres('wss')>100 || obj_del(wss) ?};
         w:=obj_new(10); ww:=obj_new(10); wws:=obj_new(10); wwp:=obj_new(10); wss:=obj_new(4);
         {!_i:=3..10|! ww[_i]:=w[_i]:=wws[_i]:=wwp[_i]:=0!}; wss[1]:=wss[2]:=wss[3]:=wss[4]:=0;
         VAR_DEL.delete('TABW','TABK','TABK_IA','TABK_IS'); SSTALE.cntx_psh()
     }
{END: &SA; VAR_DEL.delete('PRN','PRNH','PRNS');
      &prn1; &prn2; &lm; &ll; &lmt; &rsep; &vp; &k; &i; &o; &rokr; &kon;
      &kontotxt; &wal; &odd; &param; &tuser; &color;
      obj_del(w); obj_del(ww); obj_del(wws); obj_del(wwp); obj_del(wss);
      VAR_DEL.delete('TABW','TABK','TABK_IA','TABK_IS');
      USERS.actions('SLO',''); SSTALE.cntx_pop()}
{ wal:='Waluta aktywna:  %1 - %2'@[SSTALE.WAL().TR,SSTALE.WAL().KOD];
{? WYDRUKI.ODD=0
|| odd:='Jednostka księgowa: wszystkie jednostki księgowe'@
|| odd:='Jednostka księgowa:  %1'@[WYDRUKI.ODD().OD]
?};~~}
{EXIT: ~ROZNE.edit(" _a:='';
                     {? ROZNE.PAR4=4
                     ||  _a:=__CHK.record(ROZNE,,'KS_OD','KS_DO');
                        {? _a=''
                        || {? ROZNE.KS_OD().SYM>ROZNE.KS_DO().SYM
                           || FUN.info('Błędny zakres kont.'@); _a:='KS_OD'
                           ?}
                        ?}
                     |? ROZNE.PAR4=5
                     || _a:=__CHK.record(ROZNE,,'KON_WYDR');
                        {? _a=''
                        || KON_SCH.prefix(KON_WYDR.ref);
                           _a:={? KON_SCH.first()
                               || ''
                               || FUN.info('Brak definicji kont w podanym zestawie.'@); 'KON_WYDR'
                               ?}
                        ?}
                     ?};
                     {? _a=''
                     || {? ROZNE.DATA_OD>ROZNE.DATA_DO
                        || FUN.info('Błędny zakres dat.'@); _a:='DATA_OD'
                        ?}
                     ?}; _a")}
{  {? ROZNE.PAR2=1 || kontotxt:='Konta: pozabilansowe'@
   |? ROZNE.PAR2=2 || kontotxt:='Konta: bilansowe'@
   |? ROZNE.PAR2=3 || kontotxt:='Konta: wszystkie'@
   |? ROZNE.PAR2=4 || kontotxt:='Konta: wynikowe'@
   || kontotxt:='Konta: wszystkie bez pozabilansowych'@
   ?};
~~}
{  {? ROZNE.PAR4=2
   || WYDRUKIN.DLKON:=35; WYDRUKI.MASKA:=ROZNE.MASKA;
      WYDRUKI.MASKA:=exec('usostsep','konto',WYDRUKI.MASKA);
      {? +WYDRUKI.MASKA < WYDRUKIN.DLKON
      || WYDRUKI.MASKA+=(WYDRUKIN.DLKON-+WYDRUKI.MASKA)*'?'
      ?}
   |? ROZNE.PAR4=0
   || WYDRUKI.MASKA:=ROZNE.PREFIX
   || WYDRUKI.MASKA:=''
   ?};~~}
{IF: ROZNE.PAR4=3}
 { _okn:=KS.win_sel('?'); exec('initmpks','dok_fks_zest'); KS.select; KS.win_sel(_okn);~~}
 {EXIT: ~TMPSIK.first()}
{ELIF: ROZNE.PAR4=6}
 { _okn:=AN.win_sel('?'); exec('initmpan','dok_fks_zest');
   _r:=ROZNE.SZUK; ROZNE.SZUK:=1;
   AN.select();
   ROZNE.SZUK:=_r; AN.win_sel(_okn);~~}
 {EXIT: ~TMPSIK.first()}
{FI}
{OKRO_F.index('ROK');
 OKRO_F.prefix(SSTALE.AR);
 _ilok:=0;
 _zn:='';
 _zmz:=0;
 {? OKRO_F.first()
 || {!
    |? {? OKRO_F.POCZ<>date(0,0,0)
          & ROZNE.DATA_OD<=OKRO_F.KON & ROZNE.DATA_DO>=OKRO_F.POCZ
       || _ilok+=1;
          {? _zn= ''
          || _zn:=OKRO_F.ZAM
          || {? _zn<>OKRO_F.ZAM || _zmz:=1 ?}
          ?}
       ?};
       ~_zmz & OKRO_F.next()
    !};
    {? ~_zmz || rokr:=_zn ?}
 ?};~~}
{ TABW:=proc_exec('ks_anal@ks_anal',SSTALE.AO().ROK().KOD,SSTALE.AO().ROK().NAZ,SSTALE.WAL().KOD,ROZNE.UT_SCAL,WYDRUKI.ODD().OD,
                                   {? ROZNE.UT_KS || 'T' || 'N' ?}, {? ROZNE.UT_ROZR||'S'||'O'?},ROZNE.PAR2,
                                   ROZNE.PAR4,ROZNE.PREFIX, ROZNE.MASKA,ROZNE.KS_OD().SYM,
                                   ROZNE.KS_DO().SYM,ROZNE.KON_WYDR().KOD,{?ROZNE.UT_DOK||'T'||'N'?},
                                   BILANSP.ASEP,BILANSP.ASYNT,rokr,#ROZNE.KON_WYDR,tuser,ROZNE.DATA_OD,ROZNE.DATA_DO,ROZNE.PAR1,ROZNE.PAR3,ROZNE.BZ,
                                   form(exec('kurs','konto',UNPAR.PSLO().KOD,UNPAR.P25),,,'9.'),0);
{? 0
|| _win_acr:=TABW.mk_sel(,,1);
   TABW.win_sel(_win_acr);
   TABW.win_act(_win_acr,,'Usuń');
   TABW.win_act(_win_acr,,'Popraw');
   TABW.win_act(_win_acr,,'Kolejność');
   TABW.select
?};~~}
{EXIT: var_pres('TABW')<=0}
{INCLUDE: fks_ks_anal.rpi}