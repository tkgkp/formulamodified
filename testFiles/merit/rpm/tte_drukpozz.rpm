:!UTF-8
{TITLE:Porównanie kalkulacji karty technologicznej}
{PRINTER: INFO.W_PRN,,,,,'E','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
      PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   params_set(params_get());
   delete:="VAR_DEL.delete(
      'PRNKPK','SPRNKPK','PRNKLM','SPRNKLM','PRNCONS','SPRNCONS','PRNFORM','PRNKPAR','PRNTTO',
      'PRNWRK','PRNUSL','PRNNAR','__PRNTTO','__PRNWRK','__PRNKPAR','__PRNKLM','__PRNUSL','__PRNNAR','TABEDIT')";
   delete();
   KPOZK.cntx_psh();
   __KPOZK.cntx_psh();
   KALMAT.cntx_psh();
   KKTL.cntx_psh();
   KKS.cntx_psh();
   KFORM.cntx_psh();
   dalej:=0;
   "---Obiekt wydruku porownania.";
   PRNKPK:=obj_new(@.CLASS.PRINT, 7); PRNKPK.s_frame();
   SPRNKPK:=obj_new(@.CLASS.PRINT, 4); SPRNKPK.s_frame();
   "---Obiekt wydruku stalych porownania.";
   PRNCONS:=obj_new(@.CLASS.PRINT, 7); PRNCONS.s_frame();
   "---Obiekt wydruku formul porownania.";
   PRNFORM:=obj_new(@.CLASS.PRINT, 7); PRNFORM.s_frame();
   "---Obiekt wydruku cen.";
   PRNKLM:=obj_new(@.CLASS.PRINT, 9); PRNKLM.sl_frame();
   __PRNKLM:=tab_tmp(2,'KOD','STRING[15]','Kod surowca',
                       'OPIS','STRING[60]','Opis surowca',
                       'CENA','REAL','Cena surowca',
                       'CENA1','REAL','Cena surowca',
                       'POCH','STRING[11]','Pochodzenie',
                       'POCH1','STRING[11]','Poch1',
                       'TKTLNRK','STRING[20]','tech1',
                       'TKTL1NRK','STRING[20]','tech2',
                       'TKTLWER','STRING[6]','wer1',
                       'TKTL1WER','STRING[6]','wer2'
                       );
   PRNKPAR:=obj_new(@.CLASS.PRINT, 6); PRNKPAR.sl_frame();
   __PRNKPAR:=tab_tmp(1,'NR','INTEGER','Nr',
                       'OPIS','STRING[40]','Opis',
                       'WAR','REAL','Wartość',
                       'WAR1','REAL','Wart1'
                       );
   PRNTTO:=obj_new(@.CLASS.PRINT, 6); PRNTTO.sl_frame();
   __PRNTTO:=tab_tmp(2,'KOD','STRING[10]','Kod operacji',
                       'NAZWA','STRING[50]','Nazwa operacji',
                       'STAWKA','REAL','Stawka operacji',
                       'STAWKA1','REAL','Stawka operacji');
   PRNWRK:=obj_new(@.CLASS.PRINT, 6); PRNWRK.sl_frame();
   __PRNWRK:=tab_tmp(2,'KOD','STRING[10]','Kod stanowiska',
                       'NAZWA','STRING[60]','Nazwa stanowiska',
                       'KH','REAL','Koszt godziny',
                       'KH1','REAL','Koszt godziny');
   PRNUSL:=obj_new(@.CLASS.PRINT, 6); PRNUSL.sl_frame();
   __PRNUSL:=tab_tmp(2,'KOD','STRING[10]','Kod stanowiska',
                       'NAZWA','STRING[60]','Nazwa stanowiska',
                       'WAR','REAL','Koszt godziny',
                       'WAR1','REAL','Koszt godziny');
   PRNNAR:=obj_new(@.CLASS.PRINT, 6); PRNNAR.sl_frame();
   __PRNNAR:=tab_tmp(2,'KOD','STRING[10]','Kod stanowiska',
                       'NAZWA','STRING[60]','Nazwa stanowiska',
                       'WAR','REAL','Koszt godziny',
                       'WAR1','REAL','Koszt godziny');
   prn1:='';
   prn2:='';
   color:='';
   lp:=0;
   lm:=ll:=vp:=lmt:=rsep:=0;
   pkpar:=pkalmat:=pcons:=pform:=pkalus:=pkalna:=1;
   k_param:=(KKTL.NRK().TYP().PAR='T');
   __SF1:=0;
   __SF2:=0;
   __SF3:=0
}
{END:
   KKTL.cntx_pop();
   KALMAT.cntx_pop();
   KPOZK.cntx_pop();
   __KPOZK.cntx_pop();
   KKS.cntx_pop();
   KFORM.cntx_pop();
   &dalej;
   delete();
   &delete;
   &prn1; &prn2;
   &color;
   &lp;
   &lm; &ll; &vp; &lmt; &rsep;
   &pkpar;&pcons;&pform;
   &pkalus;
   &pkalna;
   &pkalmat;
   &k_param;
   &__SF1;&__SF2;&__SF3
}
{ __KPOZK.clear();~~}
  {TABEDIT:=tab_tmp(
     ,'KFORM','STRING[1]','Formuły użyte do kalkulacji'@
     ,'KCONS','STRING[1]','Stałe kalkulacji'@
     ,'KPAR','STRING[1]','Parametry kalkulacji'@
     ,'KALMAT','STRING[1]','Cennik pobranych surowców'@
     ,'KALOPER','STRING[1]','Lista stawek operacji'@
     ,'KALUS','STRING[1]','Lista stawek usług'@
     ,'KALST','STRING[1]','Lista kosztów stanowisk'@
     ,'KALNA','STRING[1]','Lista kosztów N-P-U'@
   );
   _wydr_naz:='drukpozz';
   WYDRUKIL.index('WYDRUKI');
   WYDRUKIL.prefix(OPERATOR.USER().KOD,_wydr_naz);
   {? ~WYDRUKIL.first()
   || WYDRUKIL.blank();
      WYDRUKIL.USERS:=OPERATOR.USER().KOD;
      WYDRUKIL.WYDRUK:=_wydr_naz;
      WYDRUKIL.add();
      TABEDIT.KFORM:=TABEDIT.KCONS:=TABEDIT.KPAR:=TABEDIT.KALMAT:='T';
      TABEDIT.KALOPER:=TABEDIT.KALST:=TABEDIT.KALUS:=TABEDIT.KALNA:='T'
   || TABEDIT.KFORM:=WYDRUKIL.OD_STR;
      TABEDIT.KCONS:=WYDRUKIL.DO_STR;
      TABEDIT.KPAR:=WYDRUKIL.SORTUJ;
      TABEDIT.KALMAT:=WYDRUKIL.FAK;
      TABEDIT.KALOPER:=WYDRUKIL.RODZFAK;
      TABEDIT.KALST:=WYDRUKIL.FAKUM;
      TABEDIT.KALUS:=WYDRUKIL.SR;
      TABEDIT.KALNA:=WYDRUKIL.STANZAM
   ?};
   _red:=TABEDIT.mk_edit('Wydruk kartotek stowarzyszonych'@,0,'tabedit1');
   TABEDIT.win_efld(_red,,'KFORM',,,,,,,,,'check-box',,"'T'","'N'");
   TABEDIT.win_efld(_red,,'KCONS',,,,,,,,,'check-box',,"'T'","'N'");
   {? k_param || TABEDIT.win_efld(_red,,'KPAR',,,,,,,,,'check-box',,"'T'","'N'") ?};
   TABEDIT.win_efld(_red,,'KALMAT',,,,,,,,,'check-box',,"'T'","'N'");
   TABEDIT.win_efld(_red,,'KALOPER',,,,,,,,,'check-box',,"'T'","'N'");
   TABEDIT.win_efld(_red,,'KALUS',,,,,,,,,'check-box',,"'T'","'N'");
   TABEDIT.win_efld(_red,,'KALST',,,,,,,,,'check-box',,"'T'","'N'");
   TABEDIT.win_efld(_red,,'KALNA',,,,,,,,,'check-box',,"'T'","'N'");
   TABEDIT.win_ebtn(_red,'text=%1,btn_label_align=center,panel=bottom,align=end'['&Zapisz'@],"'key:F2'");
   TABEDIT.win_ebtn(_red,'text=%1,btn_label_align=center, panel=bottom,align=end'['&Anuluj'@],"'key:Esc'");
   TABEDIT.win_edit(_red);
   ~~}
   {IF: TABEDIT.edit()}
    { WYDRUKIL.OD_STR:=TABEDIT.KFORM;
      WYDRUKIL.DO_STR:=TABEDIT.KCONS;
      WYDRUKIL.SORTUJ:=TABEDIT.KPAR;
      WYDRUKIL.FAK:=TABEDIT.KALMAT;
      WYDRUKIL.RODZFAK:=TABEDIT.KALOPER;
      WYDRUKIL.FAKUM:=TABEDIT.KALST;
      WYDRUKIL.SR:=TABEDIT.KALUS;
      WYDRUKIL.STANZAM:=TABEDIT.KALNA;
      WYDRUKIL.put(1);
      pkpar:=k_param & (-TABEDIT.KPAR='t');
      pkalmat:=(-TABEDIT.KALMAT='t');
      pcons:=(-TABEDIT.KCONS='t');
      pform:=(-TABEDIT.KFORM='t');
      pkaloper:=(-TABEDIT.KALOPER='t');
      pkalst:=(-TABEDIT.KALST='t');
      pkalus:=(-TABEDIT.KALUS='t');
      pkalna:=(-TABEDIT.KALNA='t'); ~~}
   {ELSE}
      {EXIT}
   {FI}
{COMMENT}
  Wydruk porownujacy kalkulacje.
   [MK] - 2003/02/21 - [8.10]
   [TS] - [8.50] PR/WRT/PRODUKCJ/7.53/0002
  Wywolanie: Technologia -> Kalkulacja technologii -> Ta ->Ten->Porownanie->Ten -> drukuJ
{COMMENT-}
{COMMENT}--Definicja wiersza wydruku porownania kalkulacji.--------------------{COMMENT-}
{"---Definicja wiersza wydruku pozycji kalkulacji KPOZK.                  "; ~~}
{ PRNKPK.add("form(lp,,0,'9')",3,'Lp.'@,1);
  PRNKPK.add("form(__KPOZK.NR,,0,'9')",5,'Rubr.'@,1);
  PRNKPK.add("__KPOZK.OPIS",30,'Opis'@);
  PRNKPK.add("__SF1+=__KPOZK.WART1; form(__KPOZK.WART1,,2)",12,'Wartość stara'@,1);
  PRNKPK.add("__SF2+=__KPOZK.WART; form(__KPOZK.WART,,2)",12,'Wartość nowa'@,1);
  PRNKPK.add("__SF3+=(__KPOZK.WART1-__KPOZK.WART); form(__KPOZK.WART1-__KPOZK.WART,,2)",12,'Różnica'@,1); ~~}
{ SPRNKPK.add("''",44,'',1);
  SPRNKPK.add("form(__SF1,,2)",12,'',1);
  SPRNKPK.add("form(__SF2,,2)",12,'',1);
  SPRNKPK.add("form(__SF3,,2)",12,'',1); ~~}
{"---Definicja wiersza wydruku stalych kalkulacji KPOZK.                  "; ~~}
{ PRNCONS.add("form(__KKS.NR,,0,'9')",5,'Rubr.'@,1);
  PRNCONS.add("__KKS.OPIS",30,'Opis'@);
  PRNCONS.add("form(KKS.WAR,,2)",12,'Wartość stara'@,1);
  PRNCONS.add("form(__KKS.WAR,,2)",12,'Wartość nowa'@,1);
  PRNCONS.add("form(KKS.WAR-__KKS.WAR,,2)",12,'Różnica'@,1); ~~}
{"---Definicja wiersza wydruku formul kalkulacji KPOZK.                  "; ~~}
{ PRNFORM.add("form(__KFORM.NR,,0,'9')",5,'Rubr.'@,1);
  PRNFORM.add("KFORM.FRM",30,'Formuła stara'@);
  PRNFORM.add("__KFORM.FORM",30,'Formuła nowa'@); ~~}
{"---Definicja wiersza wydruku cennika surowcow pobranych do kalk. KALMAT."; ~~}
{ PRNKLM.add("__PRNKLM.KOD",15,'Kod surowca'@);
  PRNKLM.add("__PRNKLM.OPIS",25,'Opis'@);
  PRNKLM.add("form(__PRNKLM.CENA,,2)",8,'Cena stara'@,1);
  PRNKLM.add("form(__PRNKLM.CENA1,,2)",8,'Cena nowa'@,1);
  PRNKLM.add("form(__PRNKLM.CENA-__PRNKLM.CENA1,,2)",8,'Różnica cen'@,1);
  PRNKLM.add("__PRNKLM.POCH",5,'Poch. stara'@,1);
  PRNKLM.add("__PRNKLM.POCH1",5,'Poch. nowa'@,1);
  PRNKLM.add("__PRNKLM.TKTLNRK+' '+__PRNKLM.TKTLWER",20,'Technologia stara'@);
  PRNKLM.add("__PRNKLM.TKTL1NRK+' '+__PRNKLM.TKTL1WER",20,'Technologia nowa'@);~~}
{"---Definicja wiersza wydruku parametrow kalkulacji"; ~~}
{ PRNKPAR.add("__PRNKPAR.NR",5,'Nr'@,1);
  PRNKPAR.add("__PRNKPAR.OPIS",25,'Opis'@);
  PRNKPAR.add("form(__PRNKPAR.WAR,,10)",20,'Wartość stara'@,1);
  PRNKPAR.add("form(__PRNKPAR.WAR1,,10)",20,'Wartość nowa'@,1);
  PRNKPAR.add("form(__PRNKPAR.WAR-__PRNKPAR.WAR1,,10)",20,'Różnica'@,1);~~}
{"---Definicja wiersza wydruku stawek operacji wykorzystanych w kalkulacji"; ~~}
{ PRNTTO.add("__PRNTTO.KOD",10,'Kod operacji'@);
  PRNTTO.add("__PRNTTO.NAZWA",60,'Nazwa operacji'@);
  PRNTTO.add("form(__PRNTTO.STAWKA,,2)",15,'Stawka stara'@,1);
  PRNTTO.add("form(__PRNTTO.STAWKA1,,2)",15,'Stawka nowa'@,1);
  PRNTTO.add("form(__PRNTTO.STAWKA-__PRNTTO.STAWKA1,,2)",15,'Różnica stawek'@,1);
  ~~}
{"---Definicja wiersza kosztow stanowisk pobranych do kalkulacji"; ~~}
{ PRNWRK.add("__PRNWRK.KOD",10,'Kod operacji'@);
  PRNWRK.add("__PRNWRK.NAZWA",60,'Nazwa operacji'@);
  PRNWRK.add("form(__PRNWRK.KH,,2)",15,'Koszt godziny stary'@,1);
  PRNWRK.add("form(__PRNWRK.KH1,,2)",15,'Koszt godziny nowy'@,1);
  PRNWRK.add("form(__PRNWRK.KH-__PRNWRK.KH1,,2)",15,'Różnica kosztów godzin'@,1);
  ~~}
  {"---Definicja wiersza stawek usług pobranych do kalkulacji"; ~~}
{ PRNUSL.add("__PRNUSL.KOD",10,'Kod operacji'@);
  PRNUSL.add("__PRNUSL.NAZWA",60,'Nazwa operacji'@);
  PRNUSL.add("form(__PRNUSL.WAR,,2)",15,'Stawka stara'@,1);
  PRNUSL.add("form(__PRNUSL.WAR1,,2)",15,'Stawka nowa'@,1);
  PRNUSL.add("form(__PRNUSL.WAR-__PRNUSL.WAR1,,2)",15,'Różnica stawek'@,1);
  ~~}
  {"---Definicja wiersza kosztow NPU pobranych do kalkulacji"; ~~}
{ PRNNAR.add("__PRNNAR.KOD",10,'Kod operacji'@);
  PRNNAR.add("__PRNNAR.NAZWA",60,'Nazwa operacji'@);
  PRNNAR.add("form(__PRNNAR.WAR,,2)",15,'Koszt stary'@,1);
  PRNNAR.add("form(__PRNNAR.WAR1,,2)",15,'Koszt nowy'@,1);
  PRNNAR.add("form(__PRNNAR.WAR-__PRNNAR.WAR1,,2)",15,'Różnica kosztów'@,1);
  ~~}
  {INCLUDE: wsp_pw.rpi}
  {"---Wyswietl okienko decyzyjne, czy drukowac parametry kalkulacji      "; ~~}
  {"---oraz cennik surowcow pobranych do kalkulacji i stawek operacji.    "; ~~}
 {COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{ PAR_WYDR.TITLE:='PORÓWNANIE KALKULACJI KARTY TECHNOLOGICZNEJ'@; ~~}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8'}{SPACE: 'B'}
{prn1:='PRNKPK';~~}
{ lmt:=int((charleft()-PRNKPK.width())/2); ~~}

{<{lmt+1} 'PARAMETRY WYDRUKU:'@}
{<{lmt+1} 'Nr kalkulacji:'@} {<{lmt+25} form(KKTL.KNR)}
{<{lmt+1} 'Data kalkulacji:'@} {<{lmt+25} form(KKTL.DT)}
{<{lmt+1} 'Data ważności:'@}{<{lmt+25} form(KKTL.DW)}
{<{lmt+1} 'Ceny surowców na dzień:'@} {<{lmt+25} {? KKTL.DT_D=date(0,0,0) || form(KKTL.DT) || form(KKTL.DT_D) ?}}
{<{lmt+1} 'Stan:'@} {<{lmt+25} exec('stan_opis','!tte_tec_ktkw',KKTL.STAN)}
{<{lmt+1} 'Wariant kalkulacji:'@} {<{lmt+25} KKTL.OPC().NAZ}
{<{lmt+1} 'Typ karty:'@}{<{lmt+25} KKTL.NRK().TYP().TYP+' - '+KKTL.NRK().TYP().OPIS}
{<{lmt+1} 'Karta:'@}{<{lmt+25} KKTL.NRK().NRK+' '+'wersja:'@+' '+KKTL.NRK().WER}
                    {<{lmt+25} KKTL.NRK().OPIS}
{<{lmt+1} 'Produkt:'@} {<{lmt+25} KKTL.TKTLW().KTM().KTM+' - '+M.N}
{<{lmt+1} 'Karta kalkulowana na:'@} {<{lmt+25} form(TKTL.XJM,,2)+' '+TKTL.JM().KOD}
{FONT: 'T8B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{FOOTER-}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{MACRO: 'prnklm'}
{ KALMAT.index('KSN');
  KALMAT.prefix(VAR.A_KKTL);
  {? KALMAT.first
  || {! |?
      __PRNKLM.KOD:=KALMAT.PT().KTM;
      __PRNKLM.OPIS:=KALMAT.PT().N;
      __PRNKLM.CENA:=KALMAT.PRICE;
      __PRNKLM.CENA1:=0;
      __PRNKLM.POCH:=KALMAT.POCH;
      __PRNKLM.POCH1:='';
      __PRNKLM.TKTLNRK:={? KALMAT.TKTL<>null || KALMAT.TKTL().NRK||''?};
      __PRNKLM.TKTL1NRK:='';
      __PRNKLM.TKTLWER:={? KALMAT.TKTL<>null || KALMAT.TKTL().WER||''?};
      __PRNKLM.TKTL1WER:='';
      __PRNKLM.add;
      KALMAT.next
     !}
  ?};
  {? type_of(KL.anm.M)<>1
  ||
  M.clear();
  _il:=obj_len(KL.anm.M);
   {!_i:=1.._il |!
      {? M.seek(KL.anm.M[_i])
      ||{? KL.anm.T[_i]<>null
        || TKTL.prefix();
           {? TKTL.seek(KL.anm.T[_i])
           || _nrk:=TKTL.NRK; _wer:=TKTL.WER
           || _nrk:=_wer:=''
           ?}
         || _nrk:=_wer:=''
         ?};
         __PRNKLM.prefix(M.KTM);
         {? __PRNKLM.first
         || __PRNKLM.CENA1:=KL.anm.P[_i];
            __PRNKLM.POCH1:=KL.anm.S[_i];
            __PRNKLM.TKTL1NRK:=_nrk;
            __PRNKLM.TKTL1WER:=_wer;
              __PRNKLM.put
         || __PRNKLM.KOD:=M.KTM;
            __PRNKLM.OPIS:=M.N;
            __PRNKLM.CENA1:=KL.anm.P[_i];
            __PRNKLM.CENA:=0;
            __PRNKLM.POCH1:=KL.anm.S[_i];
            __PRNKLM.POCH:='';
            __PRNKLM.TKTL1NRK:=_nrk;
            __PRNKLM.TKTLNRK:='';
            __PRNKLM.TKTL1WER:=_wer;
            __PRNKLM.TKTLWER:='';
            __PRNKLM.add
         ?}
      ?}
   !}
   ?}
;~~}
{MACRO-}
{MACRO: 'prnpar'}
{ KPAR.index('KN');
  KPAR.prefix(VAR.A_KKTL);
  {? KPAR.first
  || {! |?
      __PRNKPAR.NR:=KPAR.NRP;
      __PRNKPAR.OPIS:=KPAR.OPIS;
      __PRNKPAR.WAR:=KPAR.DEFAULT1;
      __PRNKPAR.add;
      KPAR.next
     !}
  ?};
  {? type_of(KL.tpar.N)=1
  ||
  _il:=KL.tpar.N;
   {!_i:=1.._il |!
      __PRNKPAR.prefix(KL.tpar.P[1][_i]);
      {? __PRNKPAR.first
      || __PRNKPAR.WAR1:=KL.tpar.P[2][_i];
         __PRNKPAR.put
      || __PRNKPAR.NR:=KL.tpar.P[1][_i];
         __PRNKPAR.OPIS:=KL.tpar.P[3][_i];
         __PRNKPAR.WAR1:=KL.tpar.P[2][_i];
         __PRNKPAR.WAR:=0;
         __PRNKPAR.add
      ?};
      KPAR.next
   !}
  ?}
;~~}
{MACRO-}
{MACRO: 'prntto'}
{ KALTTO.index('KO');
  KALTTO.prefix(VAR.A_KKTL);
  {? KALTTO.first
  || {! |?
      __PRNTTO.KOD:=KALTTO.TTOPER().KOD;
      __PRNTTO.NAZWA:=KALTTO.TTOPER().NA;
      __PRNTTO.STAWKA:=KALTTO.STAWKA;
      __PRNTTO.STAWKA1:=0;
      __PRNTTO.add;
      KALTTO.next
     !}
  ?};
  {? type_of(KL.ant.M)<>1
  ||
  TTOPER.clear();
  _il:=obj_len(KL.ant.M);
   {!_i:=1.._il |!
      {? TTOPER.seek(KL.ant.M[_i])
      || __PRNTTO.prefix(TTOPER.KOD,TTOPER.NA);
        {? __PRNTTO.first
        || __PRNTTO.STAWKA1:=KL.ant.P[_i];
           __PRNTTO.put
        || __PRNTTO.KOD:=TTOPER.KOD;
           __PRNTTO.NAZWA:=TTOPER.NA;
           __PRNTTO.STAWKA1:=KL.ant.P[_i];
           __PRNTTO.STAWKA:=0;
           __PRNTTO.add
        ?}
      ?}
   !}
  ?}
;~~}
{MACRO-}
{MACRO: 'prnwrk'}
{ KALWRK.index('KP');
  KALWRK.prefix(VAR.A_KKTL);
  {? KALWRK.first
  || {! |?
      __PRNWRK.KOD:=KALWRK.PLACE().KOD;
      __PRNWRK.NAZWA:=KALWRK.PLACE().NA;
      __PRNWRK.KH:=KALWRK.KH;
      __PRNWRK.KH1:=0;
      __PRNWRK.add;
      KALWRK.next
     !}
  ?};
  {? type_of(KL.anw.M)<>1
  ||
  TWRKPLC.clear();
  _il:=obj_len(KL.anw.M);
   {!_i:=1.._il |!
      {? TWRKPLC.seek(KL.anw.M[_i])
      || __PRNWRK.prefix(TWRKPLC.KOD,TWRKPLC.NA);
         {? __PRNWRK.first
         || __PRNWRK.KH1:=KL.anw.P[_i];
            __PRNWRK.put
         || __PRNWRK.KOD:=TWRKPLC.KOD;
            __PRNWRK.NAZWA:=TWRKPLC.NA;
            __PRNWRK.KH1:=KL.anw.P[_i];
            __PRNWRK.KH:=0;
            __PRNWRK.add
         ?}
      ?}
   !}
  ?}
;~~}
{MACRO-}
{MACRO: 'prnusl'}
{ KALTOU.index('KT');
  KALTOU.prefix(VAR.A_KKTL);
  {? KALTOU.first
  || {! |?
      __PRNUSL.KOD:=KALTOU.TTOUT().KOD;
      __PRNUSL.NAZWA:=KALTOU.TTOUT().NA;
      __PRNUSL.WAR:=KALTOU.CENA;
      __PRNUSL.WAR1:=0;
      __PRNUSL.add;
      KALTOU.next
     !}
  ?};
  {? type_of(KL.ano.M)<>1
  ||
  TTOUT.clear();
  _il:=obj_len(KL.ano.M);
   {!_i:=1.._il |!
      {? TTOUT.seek(KL.ano.M[_i])
      || __PRNUSL.prefix(TTOUT.KOD,TTOUT.NA);
         {? __PRNUSL.first
         || __PRNUSL.WAR1:=KL.ano.P[_i];
            __PRNUSL.put
         || __PRNUSL.KOD:=TTOUT.KOD;
            __PRNUSL.NAZWA:=TTOUT.NA;
            __PRNUSL.WAR1:=KL.ano.P[_i];
            __PRNUSL.WAR:=0;
            __PRNUSL.add
         ?}
      ?}
   !}
  ?}
;~~}
{MACRO-}
{MACRO: 'prnnar'}
{ KALTLS.index('KT');
  KALTLS.prefix(VAR.A_KKTL);
  {? KALTLS.first
  || {! |?
      __PRNNAR.KOD:=KALTLS.M().KTM;
      __PRNNAR.NAZWA:=KALTLS.M().N;
      __PRNNAR.WAR:=KALTLS.KOSZT;
      __PRNNAR.WAR1:=0;
      __PRNNAR.add;
      KALTLS.next
     !}
  ?};
  {? type_of(KL.anu.M)<>1
  ||
  M.clear();
  _il:=obj_len(KL.anu.M);
   {!_i:=1.._il |!
      {? M.seek(KL.anu.M[_i])
      || __PRNNAR.prefix(M.KTM,M.N);
         {? __PRNNAR.first
         || __PRNNAR.WAR1:=KL.anu.P[_i];
            __PRNNAR.put
         || __PRNNAR.KOD:=M.KTM;
            __PRNNAR.NAZWA:=M.N;
            __PRNNAR.WAR1:=KL.anu.P[_i];
            __PRNNAR.WAR:=0;
            __PRNNAR.add
         ?}
      ?}
   !}
  ?}
;~~}
{MACRO-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8'}{SPACE: 'B'}
{ rsep:=PAR_WYDR.RSEP; ~~}
{"---Drukuj pozycje kalkulacji karty technologicznej.                     "; ~~}
{ __KPOZK.prefix(); ~~}
{IF: __KPOZK.first()}{ dalej:=1; ~~}
{ __SF1:=0; __SF2:=0; __SF3:=0; lp:=0; ~~}
{WHILE: dalej}
{DO}
    { lp+=1; ~~}
      {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
  { dalej:=__KPOZK.next(); ~~}
{OD}
{SUBSTITUTE: prn2:='SPRNKPK'; 'LINIA02'}
{prn1:='SPRNKPK';~~}
{SUBSTITUTE: 'LINIAF'}
{FI}
{HEADER}
{HEADER-}
{FOOTER}
{FOOTER-}
{"---Drukuj ceny surowcow pobranych do kalkulacji (jezeli tak zadecydowal "; ~~}
{"---operator).                                                           "; ~~}
{IF: pkalmat}
  {SUBSTITUTE: 'prnklm'}
  {__PRNKLM.prefix(); ~~}
  {IF: __PRNKLM.first()}
{ dalej:=1;prn1:='PRNKLM';lmt:=int((charleft()-PRNKLM.width())/2);~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
 {IF: lineleft<14}{PAGE}{FI}


 {<1>{lk}  'CENNIK SUROWCÓW POBRANYCH DO KALKULACJI KARTY TECHNOLOGICZNEJ'@}
  {FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
    {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__PRNKLM.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}
{IF: pkpar}
  {SUBSTITUTE: 'prnpar'}
  {__PRNKPAR.prefix(); ~~}
  {IF: __PRNKPAR.first()}
{ dalej:=1; prn1:='PRNKPAR';lmt:=int((charleft()-PRNKPAR.width())/2); ~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
{IF: lineleft<14}{PAGE}{FI}


{<1>{lk}  'PARAMETRY KALKULACJI KARTY TECHNOLOGICZNEJ'@}
{FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
     {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__PRNKPAR.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}
{IF: pkaloper}
  {SUBSTITUTE: 'prntto'}
  {__PRNTTO.prefix(); ~~}
  {IF: __PRNTTO.first()}

{ __SF1:=0; __SF2:=0; __SF3:=0; dalej:=1; prn1:='PRNTTO'; lmt:=int((charleft()-PRNTTO.width())/2); ~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
{IF: lineleft<14}{PAGE}{FI}


{<1>{lk}  'LISTA STAWEK OPERACJI POBRANYCH DO KALKULACJI KARTY TECHNOLOGICZNEJ'@}
{FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
     {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__PRNTTO.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}
{IF: pkalst}
  {SUBSTITUTE: 'prnwrk'}
  {__PRNWRK.prefix(); ~~}
  {IF: __PRNWRK.first()}
{ dalej:=1; prn1:='PRNWRK'; lmt:=int((charleft()-PRNWRK.width())/2); ~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
{IF: lineleft<14}{PAGE}{FI}


{<1>{lk} 'LISTA KOSZTÓW STANOWISK POBRANYCH DO KALKULACJI KARTY TECHNOLOGICZNEJ'@}
{FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
     {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__PRNWRK.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}
{IF: pkalus}
  {SUBSTITUTE: 'prnusl'}
  {__PRNUSL.prefix(); ~~}
  {IF: __PRNUSL.first()}
{ dalej:=1; prn1:='PRNUSL'; lmt:=int((charleft()-PRNUSL.width())/2); ~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
{IF: lineleft<14}{PAGE}{FI}


{<1>{lk} 'LISTA STAWEK USŁUG POBRANYCH DO KALKULACJI KARTY TECHNOLOGICZNEJ'@}
{FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
     {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__PRNUSL.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}
{IF: pkalna}
  {SUBSTITUTE: 'prnnar'}
  {__PRNNAR.prefix(); ~~}
  {IF: __PRNNAR.first()}
{ dalej:=1; prn1:='PRNNAR'; lmt:=int((charleft()-PRNNAR.width())/2); ~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
{IF: lineleft<14}{PAGE}{FI}


{<1>{lk} 'LISTA KOSZTÓW NPU POBRANYCH DO KALKULACJI KARTY TECHNOLOGICZNEJ'@}
{FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
     {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__PRNNAR.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}
{IF: pform}
  {__KFORM.prefix(); ~~}
  {IF: __KFORM.first()}
{ dalej:=1; prn1:='PRNFORM';lmt:=int((charleft()-PRNFORM.width())/2); ~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
{IF: lineleft<14}{PAGE}{FI}


{<1>{lk}  'FORMUŁY KALKULACJI KARTY TECHNOLOGICZNEJ'@}
{FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
    {KFORM.clear();{? ~KFORM.seek(__KFORM.REF,'kformsrv') || KFORM.FRM:='' ?};~~}
     {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__KFORM.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}{IF: pcons}
  {__KKS.prefix(); ~~}
  {IF: __KKS.first()}
{ dalej:=1; prn1:='PRNCONS';lmt:=int((charleft()-PRNCONS.width())/2); ~~}{FI}
{FONT: 'W10'}{SPACE: 'A'}
{<1  lk:=charleft(); ~~}
{IF: lineleft<14}{PAGE}{FI}


{<1>{lk} 'STAŁE KALKULACJI KARTY TECHNOLOGICZNEJ'@}
{FONT: 'T8B'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
  {WHILE: dalej}
  {DO}
    {KKS.clear();KKS.seek(__KKS.REF,'kkonstan');~~}
    {IF: lineleft > 10} {SUBSTITUTE: 'LINIA0'}
   {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SPACE:'B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
   {FI}
    { dalej:=__KKS.next(); ~~}
  {OD}
  {SUBSTITUTE: 'LINIAF'}
{FI}
