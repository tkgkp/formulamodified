:!UTF-8
{TITLE: Sprawozdanie}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
          PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN: PRN:=obj_new(@.CLASS.PRINT,10); PRN.sl_frame();
        color:=''; prn1:=prn2:='PRN'; lm:=ll:=lmt:=0;
        head:=PAR_WYDR.HEAD; vp:=1; rsep:=PAR_WYDR.RSEP;
        PAR_WYDR.TITLE:='SPRAWOZDANIE: '+~-SPR_NAG.NAZWA;
        tab_ana:={? var_pres('TAB_WID')>0 || TAB_WID || TABCONTR ?}; tab_ana.cntx_psh();
        w:=obj_new(10); sum_w:=obj_new(10); {! _i:=1..10 |! w[_i]:=''; sum_w[_i]:=0 !};
        dalej:=i:=licznik:=0
}
{END: tab_ana.cntx_pop(); VAR_DEL.delete('PRN','w','tab_ana','sum_w');
      &dalej; &i; &licznik; &color; &prn1; &prn2; &lm; &ll; &vp; &lmt; &rsep; &head
}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: spr_grp.rpm
Utworzony:   2005-06-29 [AMK] Artur Makos
==================================================
Zawartosc: Sprawozdanie definiowalne z menu Controlling
{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{ szer_kol:=25;
  szer_kol+={? l_kol>=6
            || 0
            || (8-l_kol)*2
            ?};
  PRN.add("w[1]",szer_kol,'Pozycja'@);
  szer_kol:=36;
  szer_kol+={? l_kol=8 || 0
            |? l_kol=7
            || 6
            |? l_kol=6
            || (8-l_kol)*5
            |? l_kol=5
            || (8-l_kol)*7
            |? l_kol=4
            || (8-l_kol)*9
            || (8-l_kol)*10
            ?};
  PRN.add("w[10]",szer_kol,'Opis pozycji'@);
  SPR_K.cntx_psh(); SPR_K.index('KOLUMNA');
  szer_kol:={? l_kol=8 || 13 |? l_kol=7 || 14 || 16 ?};
  {! _i:=2..(l_kol+1)
  |!  SPR_K.prefix(SPR_NAG.ref(),'T',_i-1);
      {? SPR_K.first()
      || SPR_K.WYZNACZN:=|SPR_K.WYZNACZN;
         _wyzn:=SPR_K.WYZNACZN;
         _opiskol:={? _wyzn<>'' || '\''+_wyzn+' '+SPR_K.STR || '\'Kol. '+$(_i-1) ?};
         ($('PRN.add("w['+$_i+']",szer_kol,'+_opiskol+'\',1)'))()
      ?}
  !};
  SPR_K.cntx_pop();
  VAR_DEL.delete('szer_kol');
  ~~
}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8'}{SPACE: 'C'}
{IF: page=1}
{<3 'PARAMETRY WYDRUKU: '@}
{ SPR_K.cntx_psh(); SPR_K.index('KOLUMNA'); SPR_K.prefix(SPR_NAG.ref(),'N');
  i:=SPR_K.first(); licznik:=1;~~}
{WHILE: i}
{DO}
{IF: licznik=1}{<6 'Filtr dla wartości: '@}{FI}{<27 SPR_K.WYZNACZN}{<50 'od <%1'@[SPR_K.OD]}{<63 '> do <%1'@[SPR_K.DO]}{<79 '> maska %1'@[SPR_K.MASKA]
}{<125 ({? SPR_K.SUMA='T' || 'Grupowanie < grupa'@ |? SPR_K.SUMA='F' || 'Grupowanie < filtr'@ || 'Grupowanie <warunek'@ ?})+'>'}
   { i:=SPR_K.next(); licznik+=1; ~~}
{OD}
{ SPR_K.cntx_pop;~~}
{<6' Okres obrachunkowy: %1 %2'@[SSTALE.AO().NAZ,SSTALE.AR().NAZ]}
{<6
{? var_pres('__KURS')>0
|| {? UNPAR.PSLO
   || ' Waluta aktualna:  %1 - %2     Waluta wydruku: %3 - %4     Kurs: %5'@[SSTALE.WAL().KOD,SLO.TR,UNPAR.PSLO().TR,SLO.KOD,form(UNPAR.P25,,6,'9,')]
   || ' Waluta aktualna:  %1 - %2     Waluta wydruku: %3 - %4     Kurs: %5'@[SSTALE.WAL().KOD,SLO.TR,SSTALE.WAL().TR,SLO.KOD,form(UNPAR.P25,,6,'9,')]
   ?}
|| ''
?} }
{<6{? OPERATOR.DEPT || ' Jednostka księgowa: %1'@[OPERATOR.DEPT().OD] || ' Jednostka księgowa: wszystkie jednostki księgowe'@ ?}}
{FI}
{FONT: 'T8B'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}{FONT: 'T8'}{SPACE: 'C'}
{SUBSTITUTE: 'LINIAF'}{ vp:=1;~~}
{FOOTER-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8'}{SPACE: 'C'}{ dalej:=tab_ana.first();~~}
{WHILE: dalej}
{DO}
{ w[1]:=tab_ana.WART;
  {! _i:=1..l_kol
  |! ($('w['+$(_i+1)+']:=form(tab_ana.KOL'+$_i+',,2,\' ,\'); {? tab_ana.POZIOM=1 || sum_w['+$(_i+1)+']+=tab_ana.KOL'+$_i+'$2 ?}'))()
  !};
  w[10]:=exec('opis_poz','!fks_ksr_zbwa');
~~}
{SUBSTITUTE: 'LINIA0'}
{ dalej:=tab_ana.next();~~}
{OD}
{ w[1]:='SUMA'; w[10]:='';
  {! _i:=1..l_kol
  |! ($('w['+$(_i+1)+']:=form(sum_w['+$(_i+1)+'],,2,\' ,\')'))()
  !};~~}
{SUBSTITUTE: 'LINIA0'}