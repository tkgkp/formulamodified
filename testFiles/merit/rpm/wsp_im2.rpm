:!UTF-8
{TITLE: Zestawienie importów}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,
   PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1}
{BEGIN:

   VAR_DEL.delete('zazn','k','w','PRN','byl','inf_mimp','Text','max_T8','word','sep','lp','pierw');

   __selimp.cntx_psh();

   zazn:=tab_tmp(3,'SYS','STRING[20]',''
          ,'SY2','STRING[20]',''
          ,'LP','INTEGER',''
          ,'SQL','STRING[16]','');

   ISTDEF.cntx_psh();
   ISTDEF.index('VER');
   ISTDEF.prefix('XPERTIS','M');
   {? ISTDEF.first()
   || {!
      |? EDI_S.index('ISTDEF');
         EDI_S.prefix(ISTDEF.ref());
         {? EDI_S.first()
         || {!
            |? zazn.blank();
               zazn.SYS:=zazn.SY2:=EDI_S.SYSTEM;
               zazn.SQL:=$ISTDEF.ref();
               zazn.LP:=ISTDEF.LP;
               zazn.add(1);
               EDI_S.next()
            !}
         || zazn.blank();
            zazn.SYS:=zazn.SY2:='XPERTIS';
            zazn.SQL:=$ISTDEF.ref();
            zazn.LP:=ISTDEF.LP;
            zazn.add(1)
         ?};
         ISTDEF.next()
      !}
   ?};
   ISTDEF.cntx_pop();

   color:=prn1:='';
   lm:=ll:=vp:=lmt:=rsep:=byl:=lp:=0;

   k:=obj_new(6); "--szerokosci kolumn--";
   w:=obj_new(6); "--wartosci kolumn--";
   PRN:=obj_new(@.CLASS.PRINT,6); PRN.s_frame();

   k[1]:=12;
   k[2]:=5;
   k[3]:=20;
   k[4]:=30;
   k[5]:=15;
   k[6]:=62;
   w[1]:=w[3]:=w[4]:=w[5]:=w[6]:='';
   w[2]:=0
}
{END:
   VAR_DEL.delete('zazn','k','w','PRN','byl','inf_mimp','Text','max_T8','word','sep','lp','pierw');
   __selimp.cntx_pop()
}
{ PRN.add("w[1]",k[1],'System'@);
  PRN.add("w[2]",k[2],'Lp'@,1);
  PRN.add("w[3]",k[3],'Kod'@);
  PRN.add("w[4]",k[4],'Nazwa'@);
  PRN.add("w[5]",k[5],'Plik'@);
  PRN.add("w[6]",k[6],'Opis'@);

PAR_WYDR.TITLE:='ZESTAWIENIE ZDEFINIOWANYCH IMPORTÓW'@;
prn1:='PRN';
~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}   SIGNATURE                                                {COMMENT-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}   REPORT-HEADER                                            {COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{ vp:=1; ~~}
{COMMENT}   HEADER                                                   {COMMENT-}
{HEADER}
   {SUBSTITUTE: 'HEAD'}
   {FONT: 'T8G'}{SPACE: 'B'}
   {SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}
{HEADER-}
{COMMENT}   FOOTER                                                   {COMMENT-}
{FOOTER: 0}
   {SUBSTITUTE: 'LINIAF'}
   {LINE: 1}
{FOOTER-}
{COMMENT}   pozycje wydruku                                          {COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{ rsep:=PAR_WYDR.RSEP;~~}
{COMMENT} Najpierw importy ogolne przypisane do XPERTIS-a {COMMENT-}
{ zazn.clear(); zazn.prefix('MERIT','MERIT'); byl:=zazn.first(); pierw:=1; ~~}
{WHILE: byl}
{DO}
   {IF: (ISTDEF.clear(); ISTDEF.seek(BB.sqlint(zazn.SQL),))}
      {
      VAR_DEL.delete('inf_mimp');
      inf_mimp:=exec('infomimp','edi_imp',ISTDEF.ref());
      w[1]:={? pierw || 'XPERTIS' || '' ?};
      w[2]:=ISTDEF.LP;
      w[3]:=form(ISTDEF.K);
      w[4]:=form(ISTDEF.N);
      w[5]:=inf_mimp[2];
      _memo:=ISTDEF.memo_get('r','OPIS');
      _text:='';
      _sep:='';
      {? _memo.is_open
      ||
         {!
         |? _txt:=fread(_memo); _txt<>'\n'
         |!
            _text+=_sep+_txt;
            _sep:=' '
         !}
      ?};
      w[6]:=_text;
      pierw:=0;
      ~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   { byl:=zazn.next(); ~~}
{OD}
{COMMENT} Teraz podzial na systemy {COMMENT-}
{FOR: __nazsys}
{DO}
   { zazn.clear(); zazn.prefix(__nazsys[1],__nazsys[1]); byl:=zazn.first(); pierw:=1; ~~}
   {WHILE: byl}
   {DO}
      {IF: (ISTDEF.clear(); ISTDEF.seek(BB.sqlint(zazn.SQL),))}
         {
         VAR_DEL.delete('inf_mimp');
         inf_mimp:=exec('infomimp','edi_imp',ISTDEF.ref());
         w[1]:={? pierw || __nazsys[1] || '' ?};
         w[2]:=ISTDEF.LP;
         w[3]:=form(ISTDEF.K);
         w[4]:=form(ISTDEF.N);
         w[5]:=inf_mimp[2];
         _memo:=ISTDEF.memo_get('r','OPIS');
         _text:='';
         _sep:='';
         {? _memo.is_open
         ||
            {!
            |? _txt:=fread(_memo); _txt<>'\n'
            |!
               _text+=_sep+_txt;
               _sep:=' '
            !}
         ?};
         w[6]:=_text;
         pierw:=0;
         ~~}
         {SUBSTITUTE: 'LINIA0'}
      {FI}
      { byl:=zazn.next(); ~~}
   {OD}
{OD}
