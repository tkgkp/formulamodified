:!UTF-8
{TITLE: Formuły kontrolne}
{PRINTER: FINFO.W_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT}
{BEGIN:  PRN := obj_new(@.CLASS.PRINT,10); PRN.s_frame(); w:=obj_new(10); pyt:=lm:=0; mdc:=''}
{END:  obj_del(PRN); obj_del(w); &pyt; &lm; &mdc}
{ pyt:=FUN.choice('Proszę wybrać wariant:'@,,'Bieżący rejestr'@,'Wszystkie'@);~~}
{EXIT: ~pyt}
{{? pyt=2 ||
   {? OPERATOR.DEPT=null || PRN.add("w[6]",19,'Jednostka księgowa'@) ?};
   PRN.add("w[5]",8,'Rejestr'@)
 ?};
 PRN.add("w[1]",40,18*' '+'Nazwa'@);
 PRN.add("w[2]",11,'  Formuła #początkowa'@,,'#');
 PRN.add("w[3]",11,'  Formuła #dla pozycji'@,,'#');
 PRN.add("w[4]",11,'Sprawdzenie#  warunku'@,,'#');~~}
{INCLUDE: wsp_pw3.rpi}
{HEADER}
{PAR_WYDR.TITLE:=
   {? pyt=1
   || 'FORMUŁY KONTROLNE REJESTR "%1", %2'@[REJ.KOD,REJ.ODD().OD]
   || 'FORMUŁY KONTROLNE - WSZYSTKIE REJESTRY'@
   ?};
~~}
{SUBSTITUTE: 'CHARHEAD'}
{LINE:1}
{FONT: 'Q'}{SPACE: 'C'}
{<3 'PARAMETRY WYDRUKU'@}
{<5 'Rok bilansowy %1'@[SSTALE.AR().NAZ]}
{<5
{?OPERATOR.DEPT ||  'Jednostka księgowa: %1'@[OPERATOR.DEPT().OD] ||  'Wszystkie jednostki księgowe'@ ?}
}
{FONT: 'R'}
{PRN.hbar()}
{PRN.ini_head()}
{WHILE: PRN.h_next()}{DO}
{PRN.h_line()}
{OD}
{FONT: 'Q'}
{HEADER-}
{FOOTER: 0}{FONT: 'Q'}{SPACE: 'C'}
{PRN.lbar()}
{SUBSTITUTE: 'CHARFOOT'}
{~~}
{FOOTER-}
{MACRO: 'LINIA'}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{<1 PRN.line()}
{OD}
{MACRO-}
{MACRO: 'SRODEK'}
{FOR: 'FOR_AKC'}
{INDEX: 'NAZ'}
{PREFIX: REJ.ref()}
{DO}
{ w[1]:=FOR_AKC.NAZ;
  w[2]:=FOR_AKC.POCZ().SKROT;
  w[3]:=FOR_AKC.POZ().SKROT;
  w[4]:=FOR_AKC.KON().SKROT;
  w[5]:=FOR_AKC.REJ().KOD;
  w[6]:=FOR_AKC.REJ().ODD().OD;~~
}
{ENTIRE}
{PRN.bar()}
{SUBSTITUTE: 'LINIA'}
{ENTIRE-}
{OD}
{MACRO-}
{FONT: 'Q'}{SPACE: 'C'}
{IF: pyt=1}
{SUBSTITUTE: 'SRODEK'}
{ELSE}
{IF: OPERATOR.DEPT=null}
{FOR: 'REJ'}
{INDEX: 'KOD'}
{PREFIX: SSTALE.AR}
{DO}
{SUBSTITUTE: 'SRODEK'}
{OD}
{ELSE}
{FOR: 'REJ'}
{INDEX: 'KOD'}
{PREFIX: SSTALE.AR, OPERATOR.DEPT}
{DO}
{SUBSTITUTE: 'SRODEK'}
{OD}
{FI}
{FI}
{FOOTER}
{SUBSTITUTE: 'CHARFOOT'}
{~~}
{FOOTER-}
{ENTIRE}
{PRN.lbar()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'@}
{ENTIRE-}