:!UTF-8
{COMMENT}

   Wydruk galezi drzewa

{COMMENT-}
{MACRO: 'branch'}
{ T_T.prefix(T_T.ref())}
{FOR: T_T}
{PREFIX: #T_T.ref()}
{DO}
{icon+='│ ';~~}
{gsub(gsub(ticon(T_T,'UPNODE'),'├─','│ '),'└─','│ ')}
{ticon(T_T,'UPNODE')+T_T.OPIS1+T_T.OPIS2}
{SUBSTITUTE: 'branch'}
{icon:=icon-(+'│ ');~~}
{OD}
{MACRO-}
{COMMENT}

   Formuly pomocnicze

{COMMENT-}
{MACRO: 'form'}
{ T_T:=_T:=tab_tmp(0,'UPNODE','TREE_REF','TREE',
                     'OPIS1','STRING[255]','Napis',
                     'OPIS2','STRING[255]','Napis');
   tdepth:="
      _a.cntx_psh();
      _a.clear();
      _tref:=($('_a.'+$_b))(_a);
      {? _tref=0
      || _ret:=0
      || _a.seek(_tref,);
         _ret:=tdepth(_a, _b)+1
      ?};
      _a.cntx_pop();
      _ret
   ";

   tlast:="
      _a.cntx_psh();
      _a.clear();
      _tref:=($('_a.'+$_b))(_a);
      _a.prefix(_tref);
      _ret:=~_a.next();
      _a.cntx_pop();
      _ret
   ";

   ticon:="
      _tdepth:=tdepth(_a, _b);
      {? _tdepth = 0
      || return('')
      ?};
      _tlast:=tlast(_a, _b);
      _a.cntx_psh();
      _a.clear();
      _tref:=($('_a.'+$_b))(_a);
      _a.seek(_tref,);
      _ticon:=ticon(_a, _b);
      _a.cntx_pop();
      _lc:=_ticon+3;
      {? _lc='├─ '
      || _ticon:=(_ticon-3)+'│  '
      |? _lc='└─ '
      || _ticon:=(_ticon-3)+'   '
      ?};
      {? tlast(_a, _b)
      || _ret:=_ticon+'└─ '
      || _ret:=_ticon+'├─ '
      ?};
      _ret
   ";

   addt:="
      T_T.UPNODE:=_a;
      T_T.OPIS1:=_b+_c;
      T_T.OPIS2:=_d;
      T_T.add();~~
  ";
  ~~}
{MACRO-}
