:!UTF-8
{TITLE:B. Korekta zbiorcza faktur - pozycje}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','v'),exec('nopanel','param_wydr','S'),,,,'Q','C',,,,,,1,
  10,10,10,10,0,exec('get','#params',2121,2,OPERATOR.USER)<>'T'}
{BEGIN:
   POLA.NAZ_WYDR:='Korekta faktury '+exec('str_to_pth','#string',FAKS.SYM)+'.pdf';
   {? exec('czy_grp_dr','faktury_wydruk_new')
   || __GRP_DR.WZ:='lsp_korzb_poz';
      exec('begin_k1','faktury_wydruk_new','korzb_poz',__GRP_DR.FIRST)
   || exec('begin_k1','faktury_wydruk_new','korzb_poz')
   ?};
   stron1:=0}
{END: exec('end_k1','faktury_wydruk_new'); VAR_DEL.delete('stron1')}
{IF: exec('upr_cs','ceny')=0}{ FUN.info('Brak uprawnień do wartości sprzedaży.'@);~~}{EXIT}{FI}
{IF: wyjscie=1}{EXIT}{FI}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: wsp_kor_new.rpi}
{INCLUDE: wsp_strony_new.rpi}
{IF: ~exec('czy_grp_dr','faktury_wydruk_new') | __GRP_DR.PDF}
   {SUBSTITUTE: 'druk'}
{ELSE}
   {
   FAKS.cntx_psh();
   __loop:=__GRP_DR.SEL.first();
   ~~}
   {WHILE: __loop}
   {DO}
      {IF: FAKS.seek(__GRP_DR.SEL.REF,)}
         {
         exec('begin_k1','faktury_wydruk_new','korzb_poz',0);
         _v:=$int((100-PAR_WYDR.SHAD)*2.55);
         color:=_v+':'+_v+':'+_v;
         pages:=page-1; stron:=stron1;
         ~~}
         {IF: wyjscie=0}{SUBSTITUTE: 'druk'}{FI}
         { stron1:=stron;~~}
      {FI}
      { __loop:=__GRP_DR.SEL.next();~~}
   {OD}
   {
   FAKS.cntx_pop();
   VAR_DEL.delete('__loop');
   ~~}
{FI}