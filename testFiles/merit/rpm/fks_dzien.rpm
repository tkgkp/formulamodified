:!UTF-8
{TITLE:A. Dzienniki częściowe}
{PRINTER: FINFO.SZ_PRN,,,,,'T8G','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   par_okr:=par_odd:=par_wal:=mdc:='';
   color:=''; prn1:=prn2:='PRN';lwc:=lwt:=r_zap:=vr:=vp:=vl:=vg:=lm:=ll:=lmt:=0;
   i:=1; wybor:=1; tytul:=foot:=j:=tyt:=0;firstRej:=0;srodek:='SRODEK';
   swnt:=smat:=swn:=sma:=snwn:=snma:=rwn:=rma:=0;
   dz:=obj_new(20); dz1:=obj_new(3); dz2:=obj_new(5);
   z:=obj_new(14); okres:=1;
   mask_a:=mask_b:=srej:=''; rej:=odd:=1; a:=0; odd_rej:='';
   czy_w:={? PAR_SKID.get(39)='T'
          || 1
          |? PAR_SKID.get(39)='N'
          || 0
          || 2
          ?};
   PRN:=obj_new(@.CLASS.PRINT,20); PRN.sl_frame(); kolnaz:=obj_new(20);
   PRN1:=obj_new(@.CLASS.PRINT,3); PRN1.sl_frame();
   PRN2:=obj_new(@.CLASS.PRINT,5); PRN2.sl_frame();
   PRN3:=obj_new(@.CLASS.PRINT,4); PRN3.sl_frame(); s:=obj_new(4);
   PRNF:=obj_new(@.CLASS.PRINT,4); PRNF.sl_frame(); w:=obj_new(4);
   UNPAR.P7:=1;
   UNPAR.P7_BE:='';
   UNPAR.P7_AE:='';
   ROZNE.UT_OKROD:=SSTALE.AO;
   ROZNE.UT_OKRDO:=SSTALE.AO;
   ROZNE.win_edit('DZIENNI3')
}
{END:
   &par_okr; &par_odd; &par_wal; &czy_w; &firstRej; &srodek;
   &color; &prn1; &prn2; &lwc; &lwt; &r_zap; &vr; &vp; &vl; &vg;
   VAR_DEL.delete('PRN','PRN1','PRN2','PRN3','dz','dz1','dz2','z','PRNF','w','s','kolnaz');
   &a; &tytul; &foot; &j; &okres; &tyt;
   &swnt; &smat; &swn; &sma; &snwn; &snma; &rwn; &rma;
   &i; &wybor; &mask_a; &mask_b; &srej; &rej; &odd; &odd_rej; &mdc; &lm
}
{EXIT: ~ROZNE.edit("exec('spr_par_wydruk','dok_fks1')")}
{ {? czy_w=2
  || czy_w:=UNPAR.P47
  ?}; ~~}
{ {? rep_export=0
  || kolnaz[1]:='Nr w#dz.'@;
     kolnaz[2]:='Data zap./# operacji'@;
     kolnaz[3]:='Data#  wystaw.'@;
     kolnaz[4]:='Rejestr/ Nr w rej.'@;
     kolnaz[5]:='Rodzaj dok./ Symbol dok.'@;
     kolnaz[7]:='  Zaksięgował/#      dnia'@;
     kolnaz[15]:='  Jedn.#księgowa'@;
     kolnaz[13]:='  Kurs# waluty'@;
     kolnaz[14]:='    Kwota#   w walucie'@
  || kolnaz[1]:='Nr w dzienniku'@;
     kolnaz[2]:='Data zapisu'@;
     kolnaz[16]:='Data operacji'@;
     kolnaz[3]:='Data wystawienia'@;
     kolnaz[4]:='Rejestr'@;
     kolnaz[17]:='Nr w rejestrze'@;
     kolnaz[5]:='Rodzaj dokumentu'@;
     kolnaz[18]:='Symbol dokumentu'@;
     kolnaz[7]:='Zaksięgował'@;
     kolnaz[19]:='Data ksiegowania'@;
     kolnaz[15]:='Jedn.księgowa'@;
     kolnaz[13]:='Kurs waluty'@;
     kolnaz[14]:='Kwota w walucie'@
   ?};
    ~~}
{
  {? rep_export
  || PRN.add("dz[1]",5,kolnaz[1],1,'#');
     PRN.add("dz[2]",10,kolnaz[2],,'#');
     PRN.add("dz[16]",10,kolnaz[16],,'#');
     PRN.add("dz[3]",10,kolnaz[3],,'#');
     PRN.add("dz[4]",9,kolnaz[4],,'#');
     PRN.add("dz[17]",9,kolnaz[17],1,'#');
     PRN.add("dz[5]",20,kolnaz[5],,'#');
     PRN.add("dz[18]",20,kolnaz[18],,'#');
     PRN.add("dz[6]",22,'Opis operacji'@,,'#');
     PRN.add("dz[7]",16,kolnaz[7],,'#');
     PRN.add("dz[19]",16,kolnaz[19],,'#');
     PRN.add("dz[15]",8,kolnaz[15],,'#');
     PRN.add("dz[8]",4,'Lp.',1,'#');
     PRN.add("dz[9]",35,'               Konto'@,,'#');
     PRN.add("dz[10]",18,'    Kwota Wn'@,1,'#');
     PRN.add("dz[11]",18,'    Kwota Ma'@,1,'#');
     {? czy_w
     || PRN.add("dz[12]",4,'Wal.'@,,'#');
        PRN.add("dz[13]",9,kolnaz[13],1,'#');
        PRN.add("dz[14]",14,kolnaz[14],1,'#')
     ?}
  || PRN.add("dz[1]",5,kolnaz[1],1,'#');
     PRN.add("dz[2]",10,kolnaz[2],,'#');
     PRN.add("dz[3]",10,kolnaz[3],,'#');
     PRN.add("dz[4]",9,kolnaz[4],,'#');
     PRN.add("dz[5]",42,kolnaz[5],,'#');
     PRN.add("dz[6]",22,'Opis operacji'@,,'#');
     PRN.add("dz[7]",16,kolnaz[7],,'#');
     PRN.add("dz[15]",8,kolnaz[15],,'#');
     PRN.add("dz[8]",4,'Lp.',1,'#');
     PRN.add("dz[9]",35,'               Konto'@,,'#');
     PRN.add("dz[10]",18,'    Kwota Wn'@,1,'#');
     PRN.add("dz[11]",18,'    Kwota Ma'@,1,'#');
     {? czy_w
     || PRN.add("dz[12]",4,'Wal.'@,,'#');
        PRN.add("dz[13]",9,kolnaz[13],1,'#');
        PRN.add("dz[14]",14,kolnaz[14],1,'#')
     ?}
  ?};
  PRN1.add("dz1[1]",33,'');
  PRN1.add("dz1[2]",41,'Konta bilansowe/wynikowe'@);
  PRN1.add("dz1[3]",41,'Konta pozabilansowe'@);
  PRN2.add("dz2[1]",33,'');
  PRN2.add("dz2[2]",20,'Winien'@,1);
  PRN2.add("dz2[3]",20,'Ma'@,1);
  PRN2.add("dz2[4]",20,'Winien'@,1);
  PRN2.add("dz2[5]",20,'Ma'@,1);
  PRN3.add("s[1]",170,'');
  PRN3.add("s[2]",18,'',1);
  PRN3.add("s[3]",18,'',1);
  {? czy_w || PRN3.add("s[4]",29,'') ?};
  PRNF.add("w[1]",170,'');
  PRNF.add("w[2]",18,'',1);
  PRNF.add("w[3]",18,'',1);
  {? czy_w || PRNF.add("w[4]",29,'') ?};
  {! _a:=1..14 |! dz[_a]:='' !};
  {! _a:=1..3 |! dz1[_a]:='' !};
  {! _a:=1..5 |! dz2[_a]:='' !};
  {! _a:=1..4 |! w[_a]:=''; s[_a]:='' !};
  w[1]:=w[2]:=w[3]:=w[4]:=s[1]:=s[2]:=s[3]:=s[4]:='';
  {? ROZNE.UT_OKROD=ROZNE.UT_OKRDO
  || par_okr:='Okres obrachunkowy: %1 %2 '@[ROZNE.UT_OKROD().NAZ, SSTALE.AR().NAZ]
  || par_okr:='Okresy obrachunkowe: %1 - %2 %3 '@[ROZNE.UT_OKROD().NAZ, ROZNE.UT_OKRDO().NAZ, SSTALE.AR().NAZ]
  ?};
  par_odd:={? OPERATOR.DEPT
           || REJ.win_sel('WYDR'); 'Jednostka księgowa: %1'@[OPERATOR.DEPT().OD]
           || REJ.win_sel('WYDR_ODD'); 'Wszystkie jednostki księgowe'@
           ?};
  par_wal:='Waluta: '+FINFO.NAROD().KOD+' - '+FINFO.NAROD().TR; ~~}
{INCLUDE: wsp_pw3.rpi}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{FONT: 'T8G'}{ prn1:=prn2:='PRN';~~}
{ vp:=1;
  {? ROZNE.UT_OKROD=ROZNE.UT_OKRDO
  || PAR_WYDR.TITLE:='DZIENNIK KSIĘGOWAŃ REJESTRU %1 - %2 za okres %3 %4'@[srej,odd_rej,ROZNE.UT_OKROD().NAZ,SSTALE.AR().NAZ]
  || PAR_WYDR.TITLE:='DZIENNIK KSIĘGOWAŃ REJESTRU %1 - %2 za okresy: %3 - %4 %5'@[srej,odd_rej,ROZNE.UT_OKROD().NAZ, ROZNE.UT_OKRDO().NAZ,SSTALE.AR().NAZ]
  ?};~~}
{SUBSTITUTE: 'HEAD'}{LINE: 1}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: page=1}
{<1 'PARAMETRY WYDRUKU:'@}
{<1 par_okr}
{<1 par_odd}
{<1 par_wal}
{<1 'Bilans otwarcia - liczone saldo: %1'@[{? UNPAR.P7 || 'tak'@ || 'nie'@ ?}] }
{FI}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
{ PRNF.setcolor('255:255:255'); PRN.setcolor('255:255:255'); PRN3.setcolor('255:255:255');~~}
{HEADER-}
{COMMENT}---------------------------MACRO-setFooter---------------------{COMMENT-}
{MACRO: 'setFooter'}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER:0}
{FONT: 'T8GB'}
{IF: foot=0}
{IF: (vl=3 & lineleft()=0)}
{REP: PRN3.fbar()}
{ELSE}
{REP: PRN.fjbar(PRNF)}
{FI}
{IF: vr}{
      w[1]:='Z przeniesienia'@;
      w[2]:=form(snwn,,2,' ,');
      w[3]:=form(snma,,2,' ,'); ~~}
{SUBSTITUTE: 'LINEF'}
{REP: PRNF.fbar()}
{FI}
{  w[1]:='Suma strony'@;
   w[2]:=form(swn,,2,' ,');
   w[3]:=form(sma,,2,' ,');
   snwn+=swn; snma+=sma; ~~}
{SUBSTITUTE: 'LINEF'}
{REP: PRNF.fbar()}
{ w[1]:='Do przeniesienia'@;
  w[2]:=form(snwn,,2,' ,');
  w[3]:=form(snma,,2,' ,');
  swn:=sma:=0; ~~}
{SUBSTITUTE: 'LINEF'}
{REP: PRNF.flbar()}
{FI}{ vp:=1; vr:=1;~~}
{SUBSTITUTE: 'CHARFOOT'}{FONT: 'T8G'}
{SPACE: 'C'}
{FOOTER-}
{MACRO-}
{COMMENT}---------------------------MACRO-linia---------------------{COMMENT-}
{MACRO: 'linia'}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: PRN.ini_line(); PRN.length(); lineleft()<(PRN.length()+1) & lineleft()<>0}{ vp:=1;~~}{PAGE}{FI}
{ {? lineleft()=0 || vp:=1 ?};~~}
{ENTIRE}
{ swn+=swnt; sma+=smat; swnt:=smat:=0; ~~}
{IF: vp}
{PRN.setcolor(color);~~}
{REP: PRN.fbar()}
{PRN.setcolor('255:255:255');~~}
{ELIF: vl=3}
{REP: PRN3.fjbar(PRN)}
{ELIF: vg}
{REP: PRN.fbar()}
{FI}
{WHILE: PRN.next()}
{DO}
{REP: PRN.fline()}
{OD}{ vp:=vg:=0; vl:=1; ~~}
{ENTIRE-}
{MACRO-}
{COMMENT}---------------------------MACRO-linia2--------------------{COMMENT-}
{MACRO: 'linia2'}
{PRN2.ini_line()}
{WHILE: PRN2.next()}
{DO}
{REP: PRN2.fline()}
{OD}
{MACRO-}
{COMMENT}---------------------------MACRO-LINE3---------------------{COMMENT-}
{MACRO: 'LINE3'}
{FONT: 'T8GB'}{SPACE: 'C'}
{IF: PRN3.ini_line(); lineleft()<(PRN3.length()+1) & lineleft()<>0}
{ vp:=1;~~}
{PAGE}
{FI}
{ {? lineleft()=0 || vp:=1 ?};~~}
{ENTIRE}
{ vl:=3;~~}
{IF: vp}
{PRN.setcolor(color);~~}
{REP: PRN.fjbar(PRN3)}
{PRN.setcolor('255:255:255');~~}
{ELSE}
{REP: PRN.fjbar(PRN3)}
{FI}
{WHILE: PRN3.next()}
{DO}
{REP: PRN3.fline()}
{OD}
{ vp:=0;~~}
{ENTIRE-}
{MACRO-}
{COMMENT}------------------------------MACRO-LINEF------------------{COMMENT-}
{MACRO: 'LINEF'}
{PRNF.ini_line()}
{WHILE: PRNF.next()}
{DO}
{REP: PRNF.fline()}
{OD}
{MACRO-}
{COMMENT}------------------------------MACRO-OBR_POP----------------{COMMENT-}
{MACRO:'obr_pop'}
{ okres:=ROZNE.UT_OKRDO().NR;
  OKRO_F.cntx_psh();
  OKRO_F.index('ROK'); OKRO_F.prefix(SSTALE.AR);
  {? OKRO_F.first()
  || {? OKRO_F.NR<okres
     || {! |?
           mask_a:=OKRO_F.ROK().KOD;
           mask_b:=form(OKRO_F.NR,-2);
           exec('obr_mc','!fks_ksr_zddz',mask_a,mask_b,rej,OPERATOR.DEPT);
           {? OKRO_F.NR=okres-1 || _a:=0 || _a:=1 ?};
           OKRO_F.next();
           _a
        !}
     ?}
  ?};
  OKRO_F.cntx_pop();
  z[1]:=DZIENNIK.OBWN;
  z[2]:=DZIENNIK.OBMA;
  z[3]:=DZIENNIK.OBWNPB;
  z[4]:=DZIENNIK.OBMAPB; ~~}
{MACRO-}
{COMMENT}----------------------------------------------------------------------------{COMMENT-}
{MACRO:'obr_akt'}
{ DZIENNIK.OBWN:=DZIENNIK.OBMA:=DZIENNIK.OBWNPB:=DZIENNIK.OBMAPB:=0;
  exec('obr_mc','!fks_ksr_zddz',OKRO_F.ROK().KOD,form(ROZNE.UT_OKROD().NR,-2),rej,OPERATOR.DEPT);
  z[5]:=DZIENNIK.OBWN;
  z[6]:=DZIENNIK.OBMA;
  z[7]:=DZIENNIK.OBWNPB;
  z[8]:=DZIENNIK.OBMAPB; ~~}
{MACRO-}
{COMMENT}----------------------------------------------------------------------------{COMMENT-}
{MACRO:'obr_rok'}
{ DZIENNIK.OBWN:=DZIENNIK.OBMA:=DZIENNIK.OBWNPB:=DZIENNIK.OBMAPB:=0;
  exec('obr_rok','!fks_ksr_zddz',rej,OPERATOR.DEPT);
  z[9]:=DZIENNIK.OBWN;
  z[10]:=DZIENNIK.OBMA;
  z[11]:=DZIENNIK.OBWNPB;
  z[12]:=DZIENNIK.OBMAPB; ~~}
{MACRO-}
{COMMENT}----------------------------------------------------------------------------{COMMENT-}
{MACRO: 'obroty'}
{ {! i:=1..4 |! z[i]:=0 !}; {! i:=9..12 |! z[i]:=0 !}; tytul:=0;~~}
{SUBSTITUTE:'obr_pop'}
{IF: UNPAR.P7}
{SUBSTITUTE:'obr_akt'}
{FI}
{SUBSTITUTE:'obr_rok'}
{ tytul:={? tyt=1 || 1 || 0 ?};~~}
{IF: lineleft()<11 & lineleft()<>0}{PAGE}{ELSE}{ vp:=0;~~}{FI}
{ENTIRE}
{IF: vp | lineleft()=0}
{REP: PRN.flbar()}{FI}
{FONT: 'T8GB'}
{REP: PRN1.fhbar()}
{PRN1.ini_head()}
{WHILE: PRN1.h_next()}{DO}
{REP: PRN1.h_fline()}
{OD}
{REP: PRN1.fjbar(PRN2)}
{PRN2.ini_head()}
{WHILE: PRN2.h_next()}{DO}
{PRN2.h_line()}
{OD}{FONT: 'T8G'}
{REP: PRN2.fbar()}
{ dz2[1]:='Obroty w okresie poprzednim'@;
  dz2[2]:=form(z[1],18,2,' ,'); dz2[3]:=form(z[2],18,2,' ,');
  dz2[4]:=form(z[3],18,2,' ,'); dz2[5]:=form(z[4],18,2,' ,');~~}
{SUBSTITUTE: 'linia2'}
{ dz2[1]:='Obroty bieżącego okresu'@;
  dz2[2]:=form(z[5],18,2,' ,'); dz2[3]:=form(z[6],18,2,' ,');
  dz2[4]:=form(z[7],18,2,' ,'); dz2[5]:=form(z[8],18,2,' ,');~~}
{SUBSTITUTE: 'linia2'}
{ dz2[1]:='Obroty od początku roku'@;
  dz2[2]:=form(z[9],18,2,' ,'); dz2[3]:=form(z[10],18,2,' ,');
  dz2[4]:=form(z[11],18,2,' ,'); dz2[5]:=form(z[12],18,2,' ,');~~}
{SUBSTITUTE: 'linia2'}
{REP: PRN2.flbar()}
{ENTIRE-}
{ foot:=1;~~}
{MACRO-}
{COMMENT}------------------------------SRODEK-----------------------{COMMENT-}
{MACRO: 'SRODEK'}
{ tyt:=1; lwt:=lwc:=1; vg:=1;
  dz[1]:=$DOK.NRDZ; dz[2]:=$DOK.DTW+'#'+$DOK.DOP;
  dz[3]:=$DOK.DTO; dz[4]:=form(DOK.REJ().KOD,11)+$DOK.NR;
  STR.split(DOK.DOK_REJ().NAZ);
  {! |? _a:=STR.line(15); dz[5]+=_a+(20-+_a)*' '+'#'; lwt+=1; STR.next() !};
  dz[5]+=DOK.NK; STR.split(DOK.TR); _l:=0;
  {! |? dz[6]+=STR.line(22)+'#'; _l+=1; STR.next() !};
  {? _l>lwt || lwt:=_l ?};
  dz[6]:=dz[6]-1; dz[7]:=form(DOK.KSIEGOWY,16)+$DOK.DKS_K;
  dz[15]:=DOK.ODD().OD;
  ~~}
{FOR: 'POZ'}{INDEX: 'DOK'}{PREFIX: DOK.ref(),}
{DO}
   {
     {? lwc<=lwt
     || dz[8]+=form(POZ.POZ,4);
        dz[9]+=form(POZ.KON,35);
        dz[10]+={? -POZ.STR='wn' || rwn+=POZ.SUM; form(POZ.SUM,18,2,' ,') ||  form(0,18,2,' ,') ?};
        dz[11]+={? -POZ.STR='ma' || rma+=POZ.SUM; form(POZ.SUM,18,2,' ,') ||  form(0,18,2,' ,') ?};
        {? POZ.WAL=null
        || dz[12]+='    ';
           dz[13]+='      ';
           dz[14]+='               '
        || dz[12]+=form(POZ.WAL().KOD,4);
           dz[13]+=form(POZ.KURS,8,6,' ,');
           dz[14]+=form(POZ.SUMW,15,2,' ,')
        ?}
     || {! i:=8..14 |! dz[i]:='' !}; dz[15]:='';
        dz[8]:=form(POZ.POZ,4);
        dz[9]:=POZ.KON;
        dz[10]+={? -POZ.STR='wn' || rwn+=POZ.SUM; form(POZ.SUM,18,2,' ,') ||  form(0,18,2,' ,') ?};
        dz[11]+={? -POZ.STR='ma' || rma+=POZ.SUM; form(POZ.SUM,18,2,' ,') ||  form(0,18,2,' ,') ?};
        {? POZ.WAL=null
        || dz[12]:=dz[13]:=dz[14]:=''
        || dz[13]:=form(POZ.KURS,8,6,' ,');
           dz[14]:=form(POZ.SUMW,15,2,' ,');
           dz[12]:=form(POZ.WAL().KOD,4)
        ?}
     ?};  lwc+=1;
     {? (-(1+POZ.KOM().KS().TYP)='b')
     || {? -POZ.STR='wn' || z[5]+=POZ.SUM || z[6]+=POZ.SUM ?}
     |? (-(1+POZ.KOM().KS().TYP)='p')
     || {? -POZ.STR='wn' || z[7]+=POZ.SUM || z[8]+=POZ.SUM ?}
     ?};
     {? -POZ.STR='wn' || swnt+=POZ.SUM ||  smat+=POZ.SUM ?};
     POZ.cntx_psh(); r_zap:=POZ.next(); POZ.cntx_pop();~~}
     {IF: (~r_zap & lwc-1<=lwt) | (r_zap & lwc-1=lwt)}
       {IF: lineleft()<4 & lineleft()<>0}{ vp:=1; ~~}{PAGE}{FI}
       {SUBSTITUTE: 'linia'}
     {ELIF: lwc>lwt}
       { dz[1]:=dz[2]:=dz[3]:=dz[4]:=dz[5]:=dz[6]:=dz[7]:=dz[15]:=''; ~~}
       {IF: lineleft()<2 & lineleft()<>0}{ vp:=1; ~~}{PAGE}{FI}
       {SUBSTITUTE: 'linia'}
     {FI}
{OD}
{
s[1]:='Razem dla dokumentu %1'@[DOK.NK];
s[2]:=form(rwn,,2,' ,');
s[3]:=form(rma,,2,' ,'); ~~}
{IF: lineleft()<2 & lineleft()<>0}{ vp:=1; ~~}{PAGE}{FI}
{SUBSTITUTE: 'LINE3'}
{  rwn:=rma:=0;
{! i:=1..15 |! dz[i]:=''!}; ~~}
{MACRO-}
{COMMENT}----------------------SRODEK-EXCEL----------------------{COMMENT-}
{MACRO: 'SRODEKEXCEL'}
{ lwt:=lwc:=1; vg:=1;
  dz[1]:=$DOK.NRDZ;
  dz[2]:=$DOK.DTW;
  dz[16]:=$DOK.DOP;
  dz[3]:=$DOK.DTO;
  dz[4]:=form(DOK.REJ().KOD,11)+$DOK.NR;
  dz[17]:=$DOK.NR;
  STR.split(DOK.DOK_REJ().NAZ);
  {!
  |? _a:=STR.line(15);
     dz[5]+=_a+(20-+_a)*' ';
     lwt+=1; STR.next()
  !};
  dz[18]:=DOK.NK;
  STR.split(DOK.TR);
  _l:=0;
  {!
  |? dz[6]+=STR.line(22);
     _l+=1;
     STR.next()
  !};
  {? _l>lwt || lwt:=_l ?};
  dz[6]:=dz[6]-1;
  dz[7]:=form(DOK.KSIEGOWY,16);
  dz[19]:=$DOK.DKS_K;
  dz[15]:=DOK.ODD().OD;
  ~~}
{FOR: 'POZ'}{INDEX: 'DOK'}{PREFIX: DOK.ref(),}
{DO}
   {
     dz[8]:=form(POZ.POZ,4);
     dz[9]:=POZ.KON;
     dz[10]:={? -POZ.STR='wn' || rwn+=POZ.SUM; form(POZ.SUM,18,2,' ,') ||  form(0,18,2,' ,') ?};
     dz[11]:={? -POZ.STR='ma' || rma+=POZ.SUM; form(POZ.SUM,18,2,' ,') ||  form(0,18,2,' ,') ?};
     {? POZ.WAL=null
     || dz[12]:=dz[13]:=dz[14]:=''
     || dz[12]:=form(POZ.WAL().KOD,4);
        dz[13]:=form(POZ.KURS,8,6,' ,');
        dz[14]:=form(POZ.SUMW,15,2,' ,')
     ?};
     {? (-(1+POZ.KOM().KS().TYP)='b')
     || {? -POZ.STR='wn' || z[5]+=POZ.SUM || z[6]+=POZ.SUM ?}
     |? (-(1+POZ.KOM().KS().TYP)='p')
     || {? -POZ.STR='wn' || z[7]+=POZ.SUM || z[8]+=POZ.SUM ?}
     ?};
     {? -POZ.STR='wn' || swnt+=POZ.SUM ||  smat+=POZ.SUM ?};
   ~~}
     {IF: lineleft()<2 & lineleft()<>0}
     { vp:=1; ~~}
     {PAGE}
     {FI}
     {SUBSTITUTE: 'linia'}
{OD}
{IF: lineleft()<2 & lineleft()<>0}{ vp:=1; ~~}{PAGE}{FI}
{  rwn:=rma:=0;
{! i:=1..15 |! dz[i]:=''!}; ~~}
{MACRO-}
{COMMENT}----------------------------MACRO PETLA------------------------------------------------{COMMENT-}
{MACRO: 'petla'}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{SUBSTITUTE: 'setFooter'}
{ PRNF.setcolor(color); PRN.setcolor(color); PRN3.setcolor(color);~~}
{FOR: 'OKRO_F'}
{INDEX: 'ROK'}
{FROM:SSTALE.AR, ROZNE.UT_OKROD().NR}
{TO: SSTALE.AR, ROZNE.UT_OKRDO().NR}
{DO}
  {DOK.use('doku'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
  {POZ.use('pozy'+SSTALE.AR().KOD+form(OKRO_F.NR,-2));~~}
  { {? rep_export || srodek:='SRODEKEXCEL' ?}; ~~}
  {IF: OPERATOR.DEPT}
  {FOR: 'DOK'}{INDEX: 'NRDZ'}{PREFIX: 'T','T',OPERATOR.DEPT,rej}
  {DO}
      {SUBSTITUTE: srodek}
  {OD}
  {ELSE}
  {FOR: 'DOK'}{INDEX: 'NRDZ2'}{PREFIX: 'T','T',rej}
  {DO}
      {SUBSTITUTE: srodek}
  {OD}
  {FI}
{OD}
{IF: lineleft()<8 & lineleft<>0}{PAGE}{FI}
{FONT: 'T8GB'}{SPACE: 'C'}
{IF: foot=0}
{IF: (vl=3 & lineleft()<>0)}
{REP: PRN3.fbar()}
{ELSE}
{PRN.setcolor(color);~~}
{REP: PRN.fjbar(PRNF)}{PRN.setcolor('255:255:255');~~}
{FI}
{IF: ~rep_export}
{IF: vr}
  { w[1]:='Z przeniesienia'@;
    w[2]:=form(snwn,,2,' ,');
    w[3]:=form(snma,,2,' ,'); ~~}
{SUBSTITUTE: 'LINEF'}
{REP: PRNF.fbar()}{FI}
  { w[1]:='Suma strony';
    w[2]:=form(swn,,2,' ,');
    w[3]:=form(sma,,2,' ,');
    snwn+=swn; snma+=sma; ~~}
{SUBSTITUTE: 'LINEF'}
{REP: PRNF.fbar()}
{ w[1]:='Razem';
  w[2]:=form(snwn,,2,' ,');
  w[3]:=form(snma,,2,' ,');
  swn:=sma:=0; ~~}
{SUBSTITUTE: 'LINEF'}
{REP: PRNF.flbar()}
{FI}
{FI}
{IF: lineleft()<>0}
{FOOTER}
{ vp:=1; vr:=1;~~}
{SUBSTITUTE: 'CHARFOOT'}{FONT: 'T8G'}{SPACE: 'C'}
{FOOTER-}
{FI}
{MACRO-}
{COMMENT}--------------------------------WSZYSTKO------------------------------------{COMMENT-}
{MACRO: 'WSZYSTKO'}
{ vr:=0; j+=1; tytul:=0;
  rej:=REJ.ref(); srej:=REJ.KOD; odd:=ODD.ref();
  ODD.cntx_psh(); odd_rej:=REJ.ODD().OD; ODD.cntx_pop();
  {! i:=1..12 |! z[i]:=0 !}; ~~}
{IF: j<>1 & lineleft()<>0}
  {PAGE}
  { foot:=vr:=swn:=sma:=snwn:=snma:=0;~~}
{FI}
{ DZIENNIK.OBWN:=DZIENNIK.OBMA:=DZIENNIK.OBWNPB:=DZIENNIK.OBMAPB:=0; ~~}
{SUBSTITUTE: 'petla'}
{IF: lineleft<12 & lineleft()<>0}{PAGE}{FI}
{IF: ~rep_export}
{SUBSTITUTE: 'obroty'}
{FI}
{MACRO-}
{COMMENT}----------------------------------------------------------------------------{COMMENT-}
{ vp:=1;
  {! i:=1..15 |! dz[i]:=''!};
  odd:=ODD.ref();
  tytul:=foot:=0;
  {! i:=1..12 |! z[i]:=0 !};
  ~~
}
{IF: OPERATOR.DEPT}
  {FOR: 'REJ'}
  {INDEX: 'KOD'}
  {PREFIX: SSTALE.AR,OPERATOR.DEPT}
  {SELECT:'Z:Z#END'}
  {DO}{SUBSTITUTE: 'WSZYSTKO'}{OD}
{ELSE}
  {FOR: 'REJ'}
  {INDEX: 'KOD'}
  {PREFIX: SSTALE.AR}
  {SELECT:'Z:Z#END'}
  {DO}{SUBSTITUTE: 'WSZYSTKO'}{OD}
{FI}
{IF: rep_export}
{REP: PRN.flbar()}
{FI}
{EXIT: ~j}
{COMMENT}------------------------------FOOTER-LAST------------------{COMMENT-}
{FOOTER}
{SUBSTITUTE: 'CHARFOOT'}{FONT: 'T8G'}{SPACE: 'C'}
{FOOTER-}
{IF: ~rep_export}
{<1>{PRN.width()} 'KONIEC WYDRUKU '@}
{FI}
