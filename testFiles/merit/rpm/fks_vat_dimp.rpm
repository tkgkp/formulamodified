:!UTF-8
{TITLE:G.  Dostawy z importu}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,10,PAR_WYDR.MTOP,
   PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   _exp:={? rep_expo() || 14 || 0 ?};
   PRN1:=obj_new(@.CLASS.PRINT,15+_exp); PRN1.s_frame(); w:=obj_new(31);
   PRN2:=obj_new(@.CLASS.PRINT,1); PRN2.s_frame();
   PRN3:=obj_new(@.CLASS.PRINT,8); PRN3.s_frame();
   PRN4:=obj_new(@.CLASS.PRINT,5); PRN4.s_frame();
   PRN5:=obj_new(@.CLASS.PRINT,6); PRN5.s_frame();
   PRN6:=obj_new(@.CLASS.PRINT,8); PRN6.s_frame();
   l:=0;
   sinop:=sivop:=sinzw:=sivzw:=sinno:=0;
   pinop:=pivop:=pinzw:=pivzw:=pinno:=0;
   spnop:=spvop:=spnzw:=spvzw:=spnno:=0;
   ppnop:=ppvop:=ppnzw:=ppvzw:=ppnno:=0;
   kinop:=kivop:=kinzw:=kivzw:=kinno:=0;
   kpnop:=kpvop:=kpnzw:=kpvzw:=kpnno:=0;
   vl:=vr:=0;
   pokr:=odd:='';
   rej_1:=rej_2:=rej_3:=rej_4:=rej_5:=rej_6:=rej_7:=rej_8:=rej_line:=dru_rej:=czy_cos:=0;
   color:=''; prn1:=prn2:='PRN1';
   lm:=ll:=lmt:=rsep:=0; vp:=1; rsep:=PAR_WYDR.RSEP; PAR_WYDR.RSEP:=1; fun:='';
   {? var_pres('imp_prfx')<0 || imp_prfx:='ImpT' ?};
   VAT7.win_edit('VAT_DIMP'); VAT7.hdr_edit();
   {? var_pres('hdr_vat')<0
   || hdr_vat:='DOSTAWY Z IMPORTU'
   || hdr_vat:=~(-hdr_vat)
   ?};
   VAT7.hdr_edit(hdr_vat);
   {? var_press('WAL',VAT7)>0 || VAT7.WAL:=exec('kod_pln','slo_slu') ?}; wal_op:='';
   VAT7.KRAJ:=exec('kod_pl','slo_slu'); kraj:='';
   VAT7.WYSTROK:=VAT7.WYSTOKRO:=null; s2c:=0; ROK_F.win_dict('WER')
}
{END: VAR_DEL.delete('hdr_vat','imp_prfx');
   obj_del(PRN1); obj_del(w); obj_del(PRN2); obj_del(PRN3); obj_del(PRN4);
   obj_del(PRN5); obj_del(PRN6);
   &l;
   &sinop; &sivop; &sinzw; &sivzw; &sinno; &dru_rej; &czy_cos;
   &pinop; &pivop; &pinzw; &pivzw; &pinno;
   &spnop; &spvop; &spnzw; &spvzw; &spnno;
   &ppnop; &ppvop; &ppnzw; &ppvzw; &ppnno;
   &kinop; &kivop; &kinzw; &kivzw; &kinno;
   &kpnop; &kpvop; &kpnzw; &kpvzw; &kpnno;
   &vl; &vr;
   &pokr; &odd;
   &rej_1; &rej_2; &rej_3; &rej_4; &rej_5; &rej_6; &rej_7; &rej_8; &rej_line;
   _a:=SSTALE.AO().ROK().KOD+form(SSTALE.AO().NR,-2);
   DOK.use('doku'+_a);
   FAK.use('fak_'+_a);
   RVAT.clear();
   &color; &prn1; &prn2;
   &lm; &ll; &vp; &lmt; PAR_WYDR.RSEP:=rsep; &rsep; &fun;
   &wal_op; &kraj; VAR_DEL.delete('dokvpoch','s2c','okrVat','okrVatNr')
}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vat_dimp.rpm
Utworzony:    2001-06-25 [AMA]
==================================================
Zawartosc: Dostawy z importu
{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: ~rep_expo()}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}
si* - suma zakupów inwestycyjnych
sp* - suma zakupów pozostałych
pi* - suma zakupów inwestycyjnych z innych miesięcy
pp* - suma zakupów pozostałcyh z innych miesięcy
ki* - suma korekt inwestycyjnych
kp* - suma korekt pozostałych
vp - znacznik nowej strony
vl - znacznik ostatnio wydrukowanej linii (jaki obiekt)
vr - znacznik raportu
{COMMENT-}
{EXIT: ~VAT7.edit()}
{ PAR_WYDR.TITLE:=hdr_vat+exec('naz_okr_vat','!fks_vat_zrej');
  okrVat:=exec('okr_vat_wydr','!fks_vat_zrej');
  dokvpoch:=exec('dokvpoch','!fks_vat_zrej');
  kraj:=VAT7.KRAJ().KOD+' '+VAT7.KRAJ().TR;
  {? var_press('WAL',VAT7)<=0
  || KVAT.cntx_psh();
     KVAT.index('SYM'); KVAT.prefix('ImpT');
     {? KVAT.first()
     || RVAT.cntx_psh(); DVAT.cntx_psh();
        RVAT.index('RVAT_ESY'); RVAT.prefix(REF.FIRMA,KVAT.SYM);
        {? RVAT.first
        || DVAT.index('NR'); DVAT.prefix(DVAT.KRAJ,SSTALE.AO,RVAT.ref());
           {? DVAT.first() || wal_op:=DVAT.WAL().KOD+' '+DVAT.WAL().TR ?}
        ?};
        RVAT.cntx_pop(); DVAT.cntx_pop()
     ?};
     KVAT.cntx_pop()
  || wal_op:=VAT7.WAL().KOD+' '+VAT7.WAL().TR
  ?};
~~}
{  {? ~rep_expo() || PRN1.add("w[1]",4,'Lp.',1) ?};
   {? rep_expo()
   || PRN1.add("w[15]",8,'Rejestr VAT',1,'#');
      PRN1.add("w[16]",8,'Pozycja',1,'#')
   || PRN1.add("w[2]",8,'Rejestr   VAT/#Pozycja',1,'#')
   ?};
   PRN1.add("w[3]",20,'  Symbol dokumentu');
   {? rep_expo()
   || PRN1.add("w[17]",8,'Rejestr księg.',1,'#');
      PRN1.add("w[18]",8,'Nr'+{? OPERATOR.DEPT=null||'Jedn. księg.'||''?},1,'#')
   || PRN1.add("w[4]",8,'Rejestr księg./#   Nr'+{? OPERATOR.DEPT=null||'#Jedn.#księg.'||''?},1,'#')
   ?};
   {? rep_expo()
   || PRN1.add("w[19]",10,'Data operac.',,'#');
      PRN1.add("w[20]",10,'Data zapisu',,'#');
      PRN1.add("w[21]",10,'Data odprawy celnej',,'#');
      PRN1.add("w[22]",10,'Data przekroczenia granicy',,'#')
   || PRN1.add("w[5]",10,'  Data:# operac./# zapisu/# odprawy# celnej/# przekr.# granicy',,'#')
   ?};
   {? rep_expo() || PRN1.add("w[30]",16,'Kontrahent - nazwa, siedziba, numer identyfikacyjny',1,'#') ?};
   PRN1.add({? rep_expo() || "w[6]" || "w[6]" ?},20,'   Symbol faktury',,'#');
   {? VAT7.TYP_VAT='Z'
   || PRN1.add("w[7]",16,'Kwota w walucie',1,'#');
      PRN1.add("w[8]",4,'Wal.',,'#');
      PRN1.add("w[9]",7,'Kurs',1,'#');
      PRN1.add("w[10]",16,'Kwota w walucie'+{? rep_expo() || ' narodowej' || '#   narodowej' ?},1,'#');
      PRN1.add("w[11]",16,' Wartość celna',{? ~rep_expo() || 1 ?},'#')
   || {? rep_expo()
      || PRN1.add("w[7]",16,'Kwota w walucie',,'#');
         PRN1.add("w[8]",4,'Wal.',,'#');
         PRN1.add("w[9]",7,'Kurs',1,'#');
         PRN1.add("w[10]",16,'Kwota w walucie narodowej',,'#');
         PRN1.add("w[11]",16,' Wartość celna',{? ~rep_expo() || 1 ?},'#')
      || PRN1.add("w[7]",4,'Wal.',,'#');
         PRN1.add("w[8]",7,'Kurs',1,'#');
         PRN1.add("w[9]",16,'Kwota w walucie'+{? rep_expo() || ' narodowej' || '#   narodowej' ?}+'/# Kwota w walucie',1,'#');
         PRN1.add("w[10]",16,' Wartość celna',{? ~rep_expo() || 1 ?},'#')
      ?}
   ?};
   {? rep_expo()
   || PRN1.add("w[23]",16,'Cło',1,'#');
      PRN1.add("w[24]",16,'Podatek akcyz.',1,'#');
      PRN1.add("w[25]",16,'Koszty manipulacyjne',1,'#');
      PRN1.add("w[26]",16,'Wartość netto',1,'#');
      PRN1.add("w[27]",16,'Stawka VAT',1,'#');
      {? VAT7.TYP_VAT='Z'
      || PRN1.add("w[28]",16,'Kwota podatku',1,'#')
      || PRN1.add("w[28]",16,'VAT do odliczenia',1,'#');
         PRN1.add("w[31]",16,'VAT nie podlegający odliczeniu',1,'#')
      ?}
   || {? VAT7.TYP_VAT='Z'
      || PRN1.add("w[12]",16,'      Cło/#Podatek akcyz./#     Koszty# manipulacyjne',1,'#');
         PRN1.add("w[13]",8,' Grupa'+{? rep_expo() || ' ' || '#' ?}+'podatk.',,'#');
         PRN1.add("w[14]",16,' Wartość netto/#   Stawka VAT/# Kwota podatku',1,'#')
      || PRN1.add("w[11]",16,'      Cło/#Podatek akcyz./#     Koszty# manipulacyjne',1,'#');
         PRN1.add("w[12]",8,' Grupa'+{? rep_expo() || ' ' || '#' ?}+'podatk.',,'#');
         PRN1.add("w[13]",16,' Wartość netto/#   Stawka VAT/#    VAT do odl.',1,'#');
         PRN1.add("w[14]",16,' VAT# nie podlegający# odliczeniu',1,'#')
      ?}
   ?};
   PRN2.add("w[1]",208,'');
   PRN3.add("w[1]",75);
   PRN3.add("w[2]",16,'',1);
   PRN3.add("w[3]",16,'',1);
   PRN3.add("w[4]",16,'',1);
   PRN3.add("w[5]",16,'',1);
   PRN3.add("w[6]",16,'',1);
   PRN3.add("w[7]",16,'',1);
   PRN3.add("w[8]",16,'',1);
   PRN4.add("w[1]",75);
   PRN4.add("w[2]",16,'',1,'#');
   PRN4.add("w[3]",16,'',1,'#');
   PRN4.add("w[4]",73,'',1,'#');
   PRN4.add("w[5]",16,'',1,'#');
   PRN5.add("w[1]",75);
   PRN5.add("w[2]",16,'',1);
   PRN5.add("w[3]",16,'',1);
   PRN5.add("w[4]",35,'',1);
   PRN5.add("w[5]",35,'',1);
   PRN5.add("w[6]",16,'',1);
   {? VAT7.TYP_VAT='Z'
   || PRN6.add("w[1]",121,'');
      PRN6.add("w[10]",16,'',1);
      PRN6.add("w[11]",16,'',1);
      PRN6.add("w[12]",16,'',1);
      PRN6.add("''",8,'');
      PRN6.add("w[14]",16,'',1)
   || PRN6.add("w[1]",102,'');
      PRN6.add("w[9]",16,'',1);
      PRN6.add("w[10]",16,'',1);
      PRN6.add("w[11]",16,'',1);
      PRN6.add("''",8,'');
      PRN6.add("w[13]",16,'',1);
      PRN6.add("w[14]",16,'',1)
   ?};
   {! _a:=1..15 |!
      w[_a]:=''
   !};
   pokr:=SSTALE.AO().NAZ+' '+SSTALE.AO().ROK().NAZ;
   {? SSTALE.AO().ZAM='T'
      || pokr+=' - okres zamknięty'
      || pokr+=' - okres otwarty'
   ?};
   {? OPERATOR.DEPT
      || odd:='Jednostka księgowa: '+OPERATOR.DEPT().OD
      || odd:='Wszystkie jednostki księgowe'
   ?}; ~~}
{COMMENT}------------------------------MACRO-LINE1------------------{COMMENT-}
{MACRO: 'LINE1'}{IF: s2c}{FONT: 'T8U'}{ELSE}{FONT: 'T8G'}{FI}
{IF: lineleft()<4 & lineleft<>0}{PAGE}{FI}
{ENTIRE}
{IF: vp}
{REP: PRN1.fbar()}
{ELIF: vl=2}
{REP: PRN2.fjbar(PRN1)}
{FI}{ PRN1.setcolor('255:255:255');~~}
{PRN1.ini_line()}
{WHILE: PRN1.next()}
{DO}
{REP: PRN1.fline()}
{OD}{ vp:=0; PRN1.setcolor(color); vl:=1; ~~}
{ENTIRE-}{FONT: 'T8G'}
{MACRO-}
{COMMENT}------------------------------MACRO-LINE2------------------{COMMENT-}
{MACRO: 'LINE2'}
{IF: lineleft()<2 & lineleft<>0}{PAGE}{FI}
{ENTIRE}
{IF: rej_line}
{IF: vp}{REP: PRN6.fjbar(PRN2)}{ELSE}{PRN6.jbar(PRN2)}{FI}
{ELSE}
{IF: vp}{REP: PRN1.fjbar(PRN2)}{ELSE}{PRN1.jbar(PRN2)}{FI}
{FI}
{PRN2.ini_line()}
{WHILE: PRN2.next()}
{DO}
{REP: PRN2.fline()}
{OD}{ vp:=0; vl:=2; rej_line:=0;~~}
{ENTIRE-}
{MACRO-}
{COMMENT}------------------------------MACRO-LINE3------------------{COMMENT-}
{MACRO: 'LINE3'}
{PRN3.ini_line()}
{WHILE: PRN3.next()}
{DO}
{REP: PRN3.fline()}
{OD}{ vp:=0; vl:=3; ~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINE4------------------{COMMENT-}
{MACRO: 'LINE4'}
{PRN4.ini_line()}
{WHILE: PRN4.next()}
{DO}
{REP: PRN4.fline()}
{OD}{ vp:=0;~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINE5------------------{COMMENT-}
{MACRO: 'LINE5'}
{PRN5.ini_line()}
{WHILE: PRN5.next()}
{DO}
{REP: PRN5.fline()}
{OD}{ vp:=0;~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINE6------------------{COMMENT-}
{MACRO: 'LINE6'}
{PRN6.ini_line()}
{WHILE: PRN6.next()}
{DO}
{REP: PRN6.fline()}
{OD}{ vp:=0;~~}
{MACRO-}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{FONT: 'HEAD'}{SPACE: 'B'}
{LINE: 1}
{SUBSTITUTE: 'HEAD'}
{FONT: 'W8'}{SPACE: 'C'}
{<1 'PARAMETRY WYDRUKU:'}
{IF: dokvpoch<>''}{<1 dokvpoch}{FI}
{<1 'Kraj opodatkowania: '+kraj+{? wal_op<>'' || '   Waluta opodatkowania: '+wal_op || '' ?}}
{<1 odd}{LINE: 1}{{? var_pres('TYP_VAT',VAT7)>0 || 'VAT: '+{? VAT7.TYP_VAT='Z'|| 'należny' || 'naliczony' ?} || '' ?}}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}{ prn1:=prn2:='PRN1';~~}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{FONT: 'T8G'}{SPACE: 'C'}
{ prn1:={? rej_line || 'PRN6' || {? vl=1 || 'PRN1' || 'PRN2' ?} ?};
   PRN1.setcolor('255:255:255'); PRN2.setcolor('255:255:255'); PRN6.setcolor('255:255:255'); ~~}
{SUBSTITUTE: 'LINIAF'}
{   vp:=1;rej_line:=0; prn1:='PRN1';~~}
{FOOTER-}
{COMMENT}------------------------------MACRO-SRODEK------------------{COMMENT-}
{MACRO: 'SRODEK'}
{  v1:=DVAT.DOKOKRO().NR; v2:=SSTALE.AO().NR;
         r1:=DVAT.DOKOKRO().ROK().POCZ_ROK; r2:=SSTALE.AO().ROK().POCZ_ROK;
         {? v1<>v2 | r1<>r2
         || _a:=DVAT.DOKOKRO().ROK().KOD+form(DVAT.DOKOKRO().NR,-2);
            DOK.use('doku'+_a); FAK.use('fak_'+_a)
         || _a:=SSTALE.AO().ROK().KOD+form(SSTALE.AO().NR,-2);
            DOK.use('doku'+_a); FAK.use('fak_'+_a)
         ?}; s2c:=DVAT.USUNIETY;
         w[1]:=w[30]:=exec('szukkh','!fks_vat_zrej');
         dru_rej:=1; czy_cos:=1;~~}
         {IF: ~rep_expo()}{SUBSTITUTE: 'LINE2'}{FI}
         {  l+=1; {? ~vr || vr:=1 ?};
            w[1]:=$l;
            w[2]:=form(DVAT.RVAT().SYM,8)+'#'+$DVAT.NR;
            w[3]:=DVAT.SYM1;
            w[4]:=form(DVAT.DOK().REJ().KOD,8)+'#'+$DVAT.DOK().NR+{? OPERATOR.DEPT=null || '#'+REJ.ODD().OD || ''?};
            w[5]:=$DVAT.DAT5+$DVAT.DAT1+$DVAT.DAT2+$DVAT.DAT4;
            w[6]:=w[7]:=w[8]:=w[9]:=w[10]:=w[11]:=w[12]:=w[13]:=w[14]:=w[15]:=w[16]:=w[17]:=w[18]:=w[19]:=w[20]:=w[21]:=w[22]:=w[23]:=w[24]:=w[25]:=w[26]:=w[27]:=w[28]:=''; ~~}
         {FOR: 'FAK'}
         {INDEX: 'FAK'}
         {PREFIX: DVAT.DOK}
         {DO}
            {  {? VAT7.TYP_VAT='Z'
               || {? ~rep_expo() || w[6]+=form(FAK.SYM,20)+'#' || w[6]:=form(FAK.SYM,20) ?};
                  {? ~rep_expo() || w[7]+=form(FAK.WARW,16,2,' ,')+'#' || w[7]:=form(FAK.WARW,16,2,' ,') ?};
                  {? ~rep_expo() || w[8]+=form(FAK.WAL().KOD,4)+'#' || w[8]:=form(FAK.WAL().KOD,4) ?};
                  {? ~rep_expo() || w[9]+=form(FAK.KRS,7,4,' ,')+'#' || w[9]:=form(FAK.KRS,7,4,' ,') ?};
                  {? ~rep_expo() || w[10]+=form(FAK.WAR,16,2,' ,')+'#' || w[10]:=form(FAK.WAR,16,2,' ,') ?}

               || {? ~rep_expo() || w[6]+=form(FAK.SYM,20)+'#' || w[6]:=form(FAK.SYM,20) ?};
                  {? ~rep_expo() || w[7]+=form(FAK.WAL().KOD,4)+'#' || w[7]:=form(FAK.WARW,16,2,' ,') ?};
                  {? ~rep_expo() || w[8]+=form(FAK.KRS,7,4,' ,')+'#' || w[8]:=form(FAK.WAL().KOD,4) ?};
                  {? ~rep_expo() || w[9]+=form(FAK.WAR,16,2,' ,')+'#'+form(FAK.WARW,16,2,' ,')
                             || w[9]:=form(FAK.KRS,7,4,' ,')
                  ?};
                  {? rep_expo() || w[10]:=form(FAK.WAR,16,2,' ,') ?}
               ?};
               {? s2c=0 || rej_1+=FAK.WAR ?}; ~~}
         {OD}
         {FOR: 'PVAT'}
         {INDEX: 'DVAT_ST'}
         {PREFIX: DVAT.ref}
         {DO}
            {IF: exec('typ_okr_vat','!fks_vat_zrej',2)}
            {  {? VAT7.TYP_VAT='Z'
               || {? ~rep_expo()
                  || w[11]+=form(PVAT.SUMC,16,2,' ,')+16*' '+'#'+16*' '+'#';
                     w[12]+=form(PVAT.CLO,16,2,' ,')+'#'
                          +form(PVAT.AKCYZA,16,2,' ,')+'#'
                          +form(PVAT.KOS,16,2,' ,');
                     w[13]+=form(PVAT.GRVAT().KOD,8)+8*' '+'#'+8*' '+'#';
                     w[14]+=form(PVAT.SUM2,16,2,' ,')+'#'
                          +PVAT.STVAT().KOD+'#'+form(PVAT.VAT,16,2,' ,')
                  || w[11]+=form(PVAT.SUMC,16,2,' ,');
                     w[13]+=form(PVAT.SUM2,16,2,' ,');
                     w[23]:=form(PVAT.CLO,16,2,' ,');
                     w[24]:=form(PVAT.AKCYZA,16,2,' ,');
                     w[25]:=form(PVAT.KOS,16,2,' ,')
                  ?}
               || {? ~rep_expo()
                  || w[10]+=form(PVAT.SUMC,16,2,' ,')+16*' '+'#'+16*' '+'#';
                     w[11]+=form(PVAT.CLO,16,2,' ,')+'#'
                          +form(PVAT.AKCYZA,16,2,' ,')+'#'
                          +form(PVAT.KOS,16,2,' ,');
                     w[12]+=form(PVAT.GRVAT().KOD,8)+8*' '+'#'+8*' '+'#'
                  || w[11]:=form(PVAT.SUMC,16,2,' ,');
                     w[12]:=PVAT.GRVAT().KOD;
                     w[23]:=form(PVAT.CLO,16,2,' ,');
                     w[24]:=form(PVAT.AKCYZA,16,2,' ,');
                     w[25]:=form(PVAT.KOS,16,2,' ,')
                  ?};
                  w[13]+=form(PVAT.SUM2,16,2,' ,')+'#'
                       +PVAT.STVAT().KOD+'#'+form(PVAT.VAT_ODL,16,2,' ,');
                  w[14]+=16*' '+'#'+16*' '+form(PVAT.VATKOSZT,16,2,' ,')
               ?};
              {? s2c=0 || rej_2+=PVAT.SUMC; rej_3+=PVAT.CLO; rej_5+=PVAT.AKCYZA; rej_6+=PVAT.KOS ?};

               w[26]:=form(PVAT.SUM2,16,2,' ,');
               w[27]:=PVAT.STVAT().KOD;
               {? VAT7.TYP_VAT='Z'
               || w[28]:=form(PVAT.VAT,16,2,' ,')
               || w[28]:=form(PVAT.VAT_ODL,16,2,' ,');
                  w[31]:=form(PVAT.VATKOSZT,16,2,' ,')
               ?};
               w[15]:=form(DVAT.RVAT().SYM,8);
               w[16]:=$DVAT.NR;
               w[17]:=form(DVAT.DOK().REJ().KOD,8);
               w[18]:=$DVAT.DOK().NR+{? OPERATOR.DEPT=null || ' '+REJ.ODD().OD || ''?};
               w[19]:=$DVAT.DAT5;
               w[20]:=$DVAT.DAT1;
               w[21]:=$DVAT.DAT2;
               w[22]:=$DVAT.DAT4;
               w[29]:=form(FAK.SYM,20);
               {? s2c=0
               || rej_4+=PVAT.SUM2;
                 {? VAT7.TYP_VAT='Z'
                 || rej_7+=PVAT.VAT
                 || rej_7+=PVAT.VAT_ODL; rej_8+=PVAT.VATKOSZT
                 ?}
               ?};
               {? s2c=0
               || {? -DVAT.DOK().DOK_REJ().KOR='n'
                  || {? v1<>v2 | r1<>r2
                     || {? -PVAT.GRVAT().KOD='zinwepod'
                        || pinop+=PVAT.SUM2; pivop+=PVAT.VAT
                        |? -PVAT.GRVAT().KOD='zinwpodz'
                        || pinzw+=PVAT.SUM2; pivzw+=PVAT.VAT
                        |? -PVAT.GRVAT().KOD='zinwpods'
                        || pinzw+=PVAT.SUM2; pivzw+=(PVAT.VAT/2)$2
                        |? -(5+PVAT.GRVAT().KOD)='zinwn'
                        || pinno+=PVAT.SUM2
                        |? -PVAT.GRVAT().KOD='zakuppod'
                        || ppnop+=PVAT.SUM2; ppvop+=PVAT.VAT
                        |? -PVAT.GRVAT().KOD='zakupodz'
                        || {? PVAT.VAT<>PVAT.VAT_ODL
                           || _netodl:=(PVAT.SUM2-(PVAT.SUM2*PVAT.VAT_ODL/PVAT.VAT)$2);
                              ppnno+=_netodl;
                              ppnzw+=PVAT.SUM2-_netodl;
                              ppvzw+=PVAT.VAT
                           || ppnzw+=PVAT.SUM2; ppvzw+=PVAT.VAT
                           ?}
                        |? -PVAT.GRVAT().KOD='zakupods'
                        || ppnzw+=PVAT.SUM2; ppvzw+=(PVAT.VAT/2)$2
                        |? -(5+PVAT.GRVAT().KOD)='zpozn'
                        || ppnno+=PVAT.SUM2
                        ?}
                     || {? -PVAT.GRVAT().KOD='zinwepod'
                        || sinop+=PVAT.SUM2; sivop+=PVAT.VAT
                        |? -PVAT.GRVAT().KOD='zinwpodz'
                        || sinzw+=PVAT.SUM2; sivzw+=PVAT.VAT
                        |? -PVAT.GRVAT().KOD='zinwpods'
                        || sinzw+=PVAT.SUM2; sivzw+=(PVAT.VAT/2)$2
                        |? -(5+PVAT.GRVAT().KOD)='zinwn'
                        || sinno+=PVAT.SUM2
                        |? -PVAT.GRVAT().KOD='zakuppod'
                        || spnop+=PVAT.SUM2; spvop+=PVAT.VAT
                        |? -PVAT.GRVAT().KOD='zakupodz'
                        || {? PVAT.VAT<>PVAT.VAT_ODL
                           || _netodl:=(PVAT.SUM2-(PVAT.SUM2*PVAT.VAT_ODL/PVAT.VAT)$2);
                              spnno+=_netodl;
                              spnzw+=PVAT.SUM2-_netodl;
                              spvzw+=PVAT.VAT
                           || spnzw+=PVAT.SUM2; spvzw+=PVAT.VAT
                           ?}
                        |? -PVAT.GRVAT().KOD='zakupods'
                        || spnzw+=PVAT.SUM2; spvzw+=(PVAT.VAT/2)$2
                        |? -(5+PVAT.GRVAT().KOD)='zpozn'
                        || spnno+=PVAT.SUM2
                        ?}
                     ?}
                  || {? -PVAT.GRVAT().KOD='zinwepod'
                     || kinop+=PVAT.SUM2; kivop+=PVAT.VAT
                     |? -PVAT.GRVAT().KOD='zinwpodz'
                     || kinzw+=PVAT.SUM2; kivzw+=PVAT.VAT
                     |? -PVAT.GRVAT().KOD='zinwpods'
                     || kinzw+=PVAT.SUM2; kivzw+=(PVAT.VAT/2)$2
                     |? -(5+PVAT.GRVAT().KOD)='zinwn'
                     || kinno+=PVAT.SUM2
                     |? -PVAT.GRVAT().KOD='zakuppod'
                     || kpnop+=PVAT.SUM2; kpvop+=PVAT.VAT
                     |? -PVAT.GRVAT().KOD='zakupodz'
                     || kpnzw+=PVAT.SUM2; kpvzw+=PVAT.VAT
                     |? -PVAT.GRVAT().KOD='zakupods'
                     || kpnzw+=PVAT.SUM2; kpvzw+=(PVAT.VAT/2)$2
                     |? -(5+PVAT.GRVAT().KOD)='zpozn'
                     || kpnno+=PVAT.SUM2
                     ?}
                  ?}
               ?}; ~~}
               {IF: rep_expo()}
               {SUBSTITUTE: 'LINE1'}
               {FI}
            {FI}
         {OD}
         {IF: ~rep_expo()}
         {SUBSTITUTE: 'LINE1'}
         {FI}
{MACRO-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{FOR: 'RVAT'}
{INDEX: 'RVAT_ESY'}
{PREFIX: REF.FIRMA,imp_prfx}
{DO}
   {IF: OPERATOR.DEPT}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR_O' }
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}
                  {SUBSTITUTE: 'SRODEK'}
               {FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NR_OW'}
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}
                  {SUBSTITUTE: 'SRODEK'}
               {FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
   {ELSE}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR'}
            {PREFIX: VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}
               {SUBSTITUTE: 'SRODEK'}
               {FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NRW'}
            {PREFIX: VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}
               {SUBSTITUTE: 'SRODEK'}
               {FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
   {FI}
{IF: dru_rej}
{ {! _i:=1..14 |! w[_i]:='' !};~~}
{ w[1]:='   Suma: '+RVAT.SYM;
  {? VAT7.TYP_VAT='Z'
  || w[10]:=form(rej_1,,2,' ,'); w[11]:=form(rej_2,,2,' ,');
     w[12]:=form(rej_3,,2,' ,'); w[14]:=form(rej_4,,2,' ,')
  || w[9]:=form(rej_1,,2,' ,');  w[10]:=form(rej_2,,2,' ,');
     w[11]:=form(rej_3,,2,' ,'); w[13]:=form(rej_4,,2,' ,')
  ?}; ~~}
{IF: lineleft<4 & lineleft<>0}{PAGE}{ PRN1.setcolor(color);~~}{ vp:=1;~~}{FI}
{ENTIRE}
{IF: ~rep_expo()}{IF: vp}{REP: PRN1.fjbar(PRN6)}{ELSE}{PRN1.jbar(PRN6)}{FI}{FI}
{IF: VAT7.TYP_VAT='Z'}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINE6'}{FI}{ {! _i:=1..14 |! w[_i]:='' !};  w[12]:=form(rej_5,,2,' ,');  ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINE6'}{FI}{ {! _i:=1..14 |! w[_i]:='' !};  w[12]:=form(rej_6,,2,' ,');
w[14]:=form(rej_7,,2,' ,');~~}
{ELSE}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINE6'}{FI}{ {! _i:=1..14 |! w[_i]:='' !};  w[11]:=form(rej_5,,2,' ,');  ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINE6'}{FI}{ {! _i:=1..14 |! w[_i]:='' !};  w[11]:=form(rej_6,,2,' ,');   w[13]:=form(rej_7,,2,' ,');
w[14]:=form(rej_8,,2,' ,');~~}
{FI}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINE6'}{FI}{ dru_rej:=rej_1:=rej_2:=rej_3:=rej_4:=rej_5:=rej_6:=rej_7:=0; rej_line:=1;~~}
{ENTIRE-}
{FI}
{OD}
{COMMENT}------------------------------FOOTER-LAST------------------{COMMENT-}
{IF: ~rep_expo()}
{FOOTER}{FOOTER-}
{IF: lineleft()<=20 & lineleft<>0}
{IF: rej_line}{REP: PRN6.flbar()}{ rej_line:=0;~~}{ELSE}{<1 PRN1.lbar()}{FI}
{PAGE}{ PRN1.setcolor(color);PRN6.setcolor(color); vp:=1;~~}
{FI}
{IF: lineleft=0}{ vp:=1;PRN1.setcolor(color);PRN6.setcolor(color);~~}{FI}
{ENTIRE}
{IF: rej_line}
{IF: vp | rep_expo()}{REP: PRN6.flbar()}{ELSE}{PRN6.lbar()}{FI}
{ELSE}{IF: vl=1 | vp}{IF: vp | rep_expo()}{REP: PRN1.flbar()}{ELSE}{PRN1.lbar()}{FI}{ELIF: vl=2}{FI}
{FI}
{IF: vr}
{REP: PRN4.fhbar()}
{  w[1]:='';
   w[2]:='Ogólna wartość ';
   w[3]:='Inwestycyjne  ';
   w[4]:='Zakupy opodatkowane służące sprzedaży'+19*' ';
   w[5]:='Zakupy, za które'; ~~}
{SUBSTITUTE: 'LINE4'}
{'│'+77*' '+'│'+18*' '+'│'+18*' '+'├'+37*'─'+'┬'+37*'─'+'┤'
   +' nie przysługuje  '+'│'}
{  w[1]:='';
   w[2]:='zakupu     ';
   w[3]:='Pozostałe   ';
   w[4]:='opodatkowanej'+11*' ';
   w[5]:='opodatkowanej i zwolnionej    ';
   w[6]:='odliczenie VAT, '; ~~}
{SUBSTITUTE: 'LINE5'}
{'│'+77*' '+'│'+18*' '+'│'+18*' '+'├'+18*'─'+'┬'+18*'─'+'┼'+18*'─'+'┬'
   +18*'─'+'┤'+' nieopodatkowane  '+'│'}
{  w[1]:='';
   w[2]:='Kwota brutto  ';
   w[3]:='';
   w[4]:=w[6]:='wartość netto ';
   w[5]:=w[7]:='VAT      ';
   w[8]:='oraz objęte 0%  '; ~~}
{SUBSTITUTE: 'LINE3'}
{REP: PRN3.fbar()}
{  w[1]:='Razem dostawy z importu w okresie '+SSTALE.AO().NAZ+' '
         +SSTALE.AO().ROK().NAZ;
   w[2]:=form(sinop+sivop+sinzw+sivzw+sinno
               +pinop+pivop+pinzw+pivzw+pinno
               +kinop+kivop+kinzw+kivzw+kinno,16,2,' ,');
   w[3]:='Inwestycyjne';
   w[4]:=form(sinop+pinop+kinop,16,2,' ,');
   w[5]:=form(sivop+pivop+kivop,16,2,' ,');
   w[6]:=form(sinzw+pinzw+kinzw,16,2,' ,');
   w[7]:=form(sivzw+pivzw+kivzw,16,2,' ,');
   w[8]:=form(sinno+pinno+kinno,16,2,' ,'); ~~}
{SUBSTITUTE: 'LINE3'}
{  w[1]:='';
   w[2]:=form(spnop+spvop+spnzw+spvzw+spnno
               +ppnop+ppvop+ppnzw+ppvzw+ppnno
               +kpnop+kpvop+kpnzw+kpvzw+kpnno,16,2,' ,');
   w[3]:='Pozostałe';
   w[4]:=form(spnop+ppnop+kpnop,16,2,' ,');
   w[5]:=form(spvop+ppvop+kpvop,16,2,' ,');
   w[6]:=form(spnzw+ppnzw+kpnzw,16,2,' ,');
   w[7]:=form(spvzw+ppvzw+kpvzw,16,2,' ,');
   w[8]:=form(spnno+ppnno+kpnno,16,2,' ,'); ~~}
{SUBSTITUTE: 'LINE3'}
{  w[1]:='W tym: zakupy ewidencjonowane w innych miesiącach';
   w[2]:=form(pinop+pivop+pinzw+pivzw+pinno,16,2,' ,');
   w[3]:='Inwestycyjne';
   w[4]:=form(pinop,16,2,' ,');
   w[5]:=form(pivop,16,2,' ,');
   w[6]:=form(pinzw,16,2,' ,');
   w[7]:=form(pivzw,16,2,' ,');
   w[8]:=form(pinno,16,2,' ,'); ~~}
{REP: PRN3.fbar()}
{SUBSTITUTE: 'LINE3'}
{  w[1]:='';
   w[2]:=form(ppnop+ppvop+ppnzw+ppvzw+ppnno,16,2,' ,');
   w[3]:='Pozostałe';
   w[4]:=form(ppnop,16,2,' ,');
   w[5]:=form(ppvop,16,2,' ,');
   w[6]:=form(ppnzw,16,2,' ,');
   w[7]:=form(ppvzw,16,2,' ,');
   w[8]:=form(ppnno,16,2,' ,'); ~~}
{SUBSTITUTE: 'LINE3'}
{REP: PRN3.fbar()}
{  w[1]:='       zakupy ewidencjonowane w bieżącym miesiącu';
   w[2]:=form(sinop+sivop+sinzw+sivzw+sinno,16,2,' ,');
   w[3]:='Inwestycyjne';
   w[4]:=form(sinop,16,2,' ,');
   w[5]:=form(sivop,16,2,' ,');
   w[6]:=form(sinzw,16,2,' ,');
   w[7]:=form(sivzw,16,2,' ,');
   w[8]:=form(sinno,16,2,' ,'); ~~}
{SUBSTITUTE: 'LINE3'}
{  w[1]:='';
   w[2]:=form(spnop+spvop+spnzw+spvzw+spnno,16,2,' ,');
   w[3]:='Pozostałe';
   w[4]:=form(spnop,16,2,' ,');
   w[5]:=form(spvop,16,2,' ,');
   w[6]:=form(spnzw,16,2,' ,');
   w[7]:=form(spvzw,16,2,' ,');
   w[8]:=form(spnno,16,2,' ,'); ~~}
{SUBSTITUTE: 'LINE3'}
{  w[1]:='       korekty wynikające z faktur korygujących';
   w[2]:=form(kinop+kivop+kinzw+kivzw+kinno,16,2,' ,');
   w[3]:='Inwestycyjne';
   w[4]:=form(kinop,16,2,' ,');
   w[5]:=form(kivop,16,2,' ,');
   w[6]:=form(kinzw,16,2,' ,');
   w[7]:=form(kivzw,16,2,' ,');
   w[8]:=form(kinno,16,2,' ,'); ~~}
{REP: PRN3.fbar()}
{SUBSTITUTE: 'LINE3'}
{  w[1]:='';
   w[2]:=form(kpnop+kpvop+kpnzw+kpvzw+kpnno,16,2,' ,');
   w[3]:='Pozostałe';
   w[4]:=form(kpnop,16,2,' ,');
   w[5]:=form(kpvop,16,2,' ,');
   w[6]:=form(kpnzw,16,2,' ,');
   w[7]:=form(kpvzw,16,2,' ,');
   w[8]:=form(kpnno,16,2,' ,'); ~~}
{SUBSTITUTE: 'LINE3'}
{FI}{IF: czy_cos}
{REP: PRN3.flbar()}{FI}
{<1>{PRN1.width()} 'KONIEC WYDRUKU'}
{FI}
{ENTIRE-}