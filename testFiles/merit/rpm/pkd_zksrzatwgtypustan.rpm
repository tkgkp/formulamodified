:!UTF-8
{TITLE:Średnie zatrudnienie wg typów stanowisk}
{PRINTER: exec('prt','param_wydr','h',KST),,,,,'Q','C',,,,,,1,
          PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   PAR_WYDR.TITLE:='Średnie zatrudnienie wg typów stanowisk'@;
   VAR_DEL.delete('par','vp','lmt','rsep','char_prac');
   par:=obj_new(13);

   par[1]:=0;        'dalej/przerwij';
   'par[2]           posrednia tabela wynikowa stanowiska w JORG - deklarowana pozniej';
   par[3]:=obj_new('PAR','TYP');   'tabela z parametrami';
   exec('wg_typów_stan','!pkd_zes_orze',PAR_WYDR.TITLE,par[3]);
   par[4]:=sql('select distinct 0 as LPSTN, \'        \' as TYP_STN from SYSLOG where 2=1');
   par[5]:=sql('select distinct \''+(16*' ')+'\' as JORG from SYSLOG where 2=1');
   par[6]:=obj_new(@.CLASS.PRINT,4);
   par[7]:=1;        'Drukowanie parametrow sprawozdania';
   par[8]:=0;        'Techniczny licznik wierszy';
   par[9]:='';       'Techniczna zmienna wiersza do druku - uzupelnienie tabeli danymi';
   par[10]:=0;       'Techniczny licznik kolumn tabeli wyswietlanej';
   par[11]:=0;       'Techniczny licznik wierszy tabeli wyswietlanej';
   par[12]:=0;       'Techniczny znacznik stronicowania';

   {? par[3].PAR.size() || par[1]:=1 ?};
   {? par[1]
   || PAR_WYDR.TITLE+=' '+{? par[3].PAR.ASK=1 || '(w etatach)'@ || '(w osobach)'@ ?};

      _inne:={? par[3].TYP.find_tab(0,'NAZ',,'=','POZOSTAŁE') || 'POZOSTAŁE' || '' ?};

      _ZATR:=tab_tmp(2,
         'P','INTEGER','Pracownik - #P.ref',
         'DATA','DATE','Data',
         'MP','REAL','Mężczyzna zatrudnioniony na pełny etat',
         'OMN','REAL','Os - Mężczyzna zatrudnioniony na niepełny etat',
         'EMN','REAL','Et - Mężczyzna zatrudnioniony na niepełny etat',
         'KP','REAL','Kobieta zatrudnioniona na pełny etat',
         'OKN','REAL','Os - Kobieta zatrudnioniona na niepełny etat',
         'EKN','REAL','Et - Kobieta zatrudnioniona na niepełny etat',
         'JORG','STRING[16]','Jednostka organizacyjn\a',
         'TYP_STN','STRING[20]','Typ stanowiska',
         'DR','INTEGER','Dzien roboczy',
         'LPSTN','INTEGER','Kolejność'
      );
      {? var_pres('_ZATR')>100
      || _ndx_ex:=_ZATR.ndx_tmp('Domyślny',0,'P',,,'DATA',,);
         _ZATR.index(_ndx_ex);
         1
      || FUN.emsg('%1\n%2'['Utworzenie pomocniczej tabeli do przetwarzania informacji zakończone niepowodzeniem.'@,
            'Działanie funkcji zostanie przerwane.'@]
         );
         return(0)
      ?};
      H.cntx_psh();
      H.index('_HISTKOD');
      P.cntx_psh();
      P.index('PRACONAZ');
      P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P);
      _ilP:=P.size();
      _Plicz:=0;
      par[1]:=FUN.prg_start(12*_ilP);
      {? P.first()
      || {!
         |? {? P.DZA<=date(par[3].PAR.ROK,par[3].PAR.MDO,0)
               &
               (P.DZ=#0 | P.DZ>=date(par[3].PAR.ROK,par[3].PAR.MOD,1))
            || _plec:=P.OSOBA().PLEC;
               H.prefix(P.ref(),'Z');
               {! _mie:=par[3].PAR.MOD..par[3].PAR.MDO
               |! {! _dzien:=1..(date(par[3].PAR.ROK,_mie,0)~3)
                  |! {? ((P.DZ~1)=0 | P.DZ>=date(par[3].PAR.ROK,_mie,_dzien)) & P.DZA<=date(par[3].PAR.ROK,_mie,_dzien)
                     || {? H.find_le(date(par[3].PAR.ROK,_mie,_dzien))
                        || _ZATR.blank(1);
                           _ZATR.P:=#P.ref();
                           _ZATR.DATA:=date(par[3].PAR.ROK,_mie,_dzien);
                           _ZATR.DR:=1;
                           {? H.RWY=1
                           || {? _plec='K' || _ZATR.KP:=1 || _ZATR.MP:=1 ?}
                           || {? _plec='K' || _ZATR.OKN:=1; _ZATR.EKN:=H.RWY || _ZATR.OMN:=1; _ZATR.EMN:=H.RWY ?}
                           ?};
                           _ZATR.JORG:=H.WYDZIAL().SYMBOL;
                           _ZATR.TYP_STN:=
                              {? par[3].TYP.find_tab(0,'NAZ',,'=',~-(H.ST().SLO_KOD().NAZWA))
                              || _ZATR.LPSTN:=par[3].TYP.LP; par[3].TYP.NAZ
                              || _ZATR.LPSTN:={? par[3].TYP.find_tab(0,'NAZ',,'=','POZOSTAŁE')
                                              || par[3].TYP.LP
                                              || par[3].TYP.size()+1
                                              ?};
                                              _inne
                              ?};
                           {? +_ZATR.TYP_STN
                           || _ZATR.add()
                           ?}
                        ?}
                     || _ZATR.blank(1);
                        _ZATR.P:=#P.ref();
                        _ZATR.DATA:=date(par[3].PAR.ROK,_mie,_dzien);
                        _ZATR.DR:=1;
                        _ZATR.add(1)
                     ?}
                  !};
                  par[1] & (par[1]:=FUN.prg_next(); par[1])
               !}
            ?};
            par[1] & P.next()
         !}
      ?};
      P.cntx_pop();
      FUN.prg_stop();
      VAR_DEL.delete('par[2]');
      _par2:=sql('select distinct :_a.JORG, '+
                        ':_a.TYP_STN, '+
                        ':_a.LPSTN, '+
                        ':_a.P, '+
                        '(sum(:_a.MP)) as MP, '+
                        '(sum(:_a.KP)) as KP, '+
                        '(sum(:_a.OMN)) as OMN, '+
                        '(sum(:_a.OKN)) as OKN, '+
                        '(sum(:_a.EMN)) as EMN, '+
                        '(sum(:_a.EKN)) as EKN '+
                  'from :_a '+
                  'group by :_a.P, :_a.JORG, :_a.TYP_STN, :_a.LPSTN',
                  _ZATR
      );
      _ldr:=sql('select P, sum(DR) as DR from :_a group by P order by 1',_ZATR);
      {? _par2.first()
      || {!
         |? _ldr.prefix(_par2.P);
            {? _ldr.first() & _ldr.DR>0
            || _par2.MP:=_par2.MP/_ldr.DR;
               _par2.KP:=_par2.KP/_ldr.DR;
               _par2.OMN:=_par2.OMN/_ldr.DR;
               _par2.OKN:=_par2.OKN/_ldr.DR;
               _par2.EMN:=_par2.EMN/_ldr.DR;
               _par2.EKN:=_par2.EKN/_ldr.DR;
               _par2.put(1)
            || _par2.MP:=_par2.KP:=_par2.OMN:=_par2.OKN:=_par2.EMN:=_par2.EKN:=0;
               _par2.put(1)
            ?};
            _par2.next()
         !}
      ?};
      par[2]:=sql('select distinct :_a.JORG, '+
                        ':_a.TYP_STN, '+
                        ':_a.LPSTN, '+
                        '(sum(:_a.MP)) as MP, '+
                        '(sum(:_a.KP)) as KP, '+
                        '(sum(:_a.OMN)) as OMN, '+
                        '(sum(:_a.OKN)) as OKN, '+
                        '(sum(:_a.EMN)) as EMN, '+
                        '(sum(:_a.EKN)) as EKN '+
                  'from :_a where :_a.TYP_STN<>\'\' '+
                  'group by :_a.JORG, :_a.TYP_STN, :_a.LPSTN',
                  _par2
      );
      H.cntx_pop()
   || par[1]:=0;
      return(0)
   ?};
   prn1:='par[6]';
   lmt:=rsep:=0;
   vp:=1
}
{END:
   VAR_DEL.delete('par','vp','lmt','rsep','prn1','char_prac')
}
{EXIT: ~par[1]}
{COMMENT}OLD: zk_srzat.rpm{COMMENT-}
{COMMENT}OLD: std_info.rpi{COMMENT-}
{COMMENT}OLD: skid_pw.rpi{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}
::----------------------------------------------------------------------------------------------------------------------

   K O N F I G U R A C J A   -   N A G Ł Ó W E K,   S T O P K A

{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{IF: par[7]}
   { par[7]:=0; ~~ }
   {FONT: 'T8G'}
   {SPACE: 'C'}
   {LINE}
   {<{lmt+1}'Parametry sprawozdania'@}
   {<{lmt+1}'Data kontroli:'@} {date()}
   {<{lmt+1}'Zakres: od %1 do %2'[$par[3].PAR.ROK+'-'+(('00'+$par[3].PAR.MOD)+2),$par[3].PAR.ROK+'-'+(('00'+$par[3].PAR.MDO)+2)]}
   {<{lmt+1}'Typy stanowisk:'@} {
      _wybrane:=sql('select distinct :_a.LPSTN, :_a.TYP_STN from :_a order by 1',par[2]);
      _wybrane.first();
      _wyn:='';
      {! |? _wyn+=_wybrane.TYP_STN+', '; _wybrane.next() !};
      {? +_wyn || _wyn:=_wyn-2 ?};
      -_wyn
   }
   {<{lmt+1}'OBJAŚNIENIA: O - ogółem, K - kobiety, P - pełnozatrudnieni, N - niepełnozatrudnieni.'@}
{FI}
{HEADER-}
{FOOTER: 0}
{FONT: 'T8G'}
{SPACE: 'C'}
{SUBSTITUTE: 'FOOT'}
{FOOTER-}
{FONT: 'T8GB'}
{SPACE: 'C'}
{par[1]:=0; ~~ }
{IF: par[2].size()}
{  VAR_DEL.delete('par[13]','par[8]','par[9]');
   {? type_of(par[5])=var_pres('SYSLOG') || obj_del(par[5]) ?};
   {? type_of(par[4])=var_pres('SYSLOG') || obj_del(par[4]) ?};
   par[4]:=sql('select distinct :_a.LPSTN, :_a.TYP_STN from :_a order by 1',par[2]);
   par[5]:=sql('select distinct :_a.JORG from :_a order by 1',par[2]);
   _lkox:=((par[4].size()*2)+2)/20;
   _lkol:={? _lkox<>_lkox$0 || ((_lkox$0)+1)*20 || ((par[4].size()*2)+2) ?};

   _newtab:='tab_tmp(3,\'LP\',\'INTEGER\',\'Liczba porządkowa\','+
                 '\'JORG\',\'STRING[16]\',\'Jedn.organizacyjna\','+
                 '\'OK\',\'STRING[1]\',\'Ogółem/kobiet\'';
   {! _ix:=1.._lkol
   |! _ilex:=_ix;
      _newtab+=',\''+('K'+(('0'+($_ix))+2))+'\',\'REAL\',\'kolumna '+$_ix+'\''
   !};
   _newtab+=')';
   par[13]:=($_newtab)();

   par[13].blank(1);
   par[13].JORG:='RAZEM:';
   par[13].OK:='O';
   par[13].LP:=501;
   par[13].add(1);
   par[13].blank(1);
   par[13].JORG:='RAZEM:';
   par[13].OK:='K';
   par[13].LP:=502;
   par[13].add(1);

   {? par[5].first() & par[4].first()
   || _lp:=0;
      {!
      |? _lp+=1;
         par[13].blank(1);
         par[13].LP:=_lp;
         par[13].JORG:=par[5].JORG;
         par[13].OK:='O';
         {? par[4].first()
         || _ix:=0;
            {!
            |? _jest:=0;
               'pelnozatrudnieni ogolem';
               _ix+=1;
               {? par[2].find_tab(1,'JORG',,'=',par[13].JORG,'TYP_STN',,'=',par[4].TYP_STN)
               || ($('par[13].K'+(('0'+$_ix)+2)))():=(par[2].MP+par[2].KP)$2;
                  _jest:=1
               ?};
               'niepelnozatrudnieni ogolem';
               _ix+=1;
               {? _jest
               || {? par[3].PAR.ASK=1
                  || ($('par[13].K'+(('0'+$_ix)+2)))():=(par[2].EMN+par[2].EKN)$2
                  || ($('par[13].K'+(('0'+$_ix)+2)))():=(par[2].OMN+par[2].OKN)$2
                  ?}
               ?};
               par[4].next()
            !}
         ?};
         par[13].add(1);
         _lp+=1;
         par[13].blank(1);
         par[13].LP:=_lp;
         par[13].JORG:=par[5].JORG;
         par[13].OK:='K';
         {? par[4].first()
         || _ix:=0;
            {!
            |? _jest:=0;
               'pelnozatrudnieni kobiety';
               _ix+=1;
               {? par[2].find_tab(1,'JORG',,'=',par[13].JORG,'TYP_STN',,'=',par[4].TYP_STN)
               || ($('par[13].K'+(('0'+$_ix)+2)))():=par[2].KP$2;
                  _jest:=1
               ?};
               'niepelnozatrudnieni kobiety';
               _ix+=1;
               {? _jest
               || {? par[3].PAR.ASK=1
                  || ($('par[13].K'+(('0'+$_ix)+2)))():=par[2].EKN$2
                  || ($('par[13].K'+(('0'+$_ix)+2)))():=par[2].OKN$2
                  ?}
               ?};
               par[4].next()
            !}
         ?};
         par[13].add(1);
         par[5].next()
      !}
   ?};
   'Sumowanie wierszy i kolumn';
   {? par[13].first()
   ||
      {!
      |? _niep:=_parz:=0;
         {! _ix:=1..(par[4].size()*2)
         |! _pobierz:=($('par[13].K'+(('0'+$_ix)+2)))();
            {? (_ix%*2)<>0
            || _niep+=_pobierz
            || _parz+=_pobierz
            ?};
            {? par[13].LP<=500
            || par[13].cntx_psh();
               {? par[13].LP%*2=0
               || par[13].last();
                  ($('par[13].K'+(('0'+$_ix)+2)))()+=_pobierz;
                  par[13].put()
               || par[13].last();
                  par[13].prev();
                  ($('par[13].K'+(('0'+$_ix)+2)))()+=_pobierz;
                  par[13].put()
               ?};
               par[13].cntx_pop()
            ?}
         !};
         ($('par[13].K'+(('0'+$((par[4].size()*2)+1))+2)))():=_niep;
         ($('par[13].K'+(('0'+$((par[4].size()*2)+2))+2)))():=_parz;
         par[13].put();
         par[13].next()
      !}
   ?};
   par[13].last();
   par[13].LP:=par[13].size();
   par[13].put();
   par[13].last();
   par[13].LP:=par[13].size()-1;
   par[13].put();

   _ix:=1;
   par[4].first();
   {! |? par[4].LPSTN:=_ix; par[4].put(); _ix+=1; par[4].next() !};
   par[4].blank(1);
   par[4].LPSTN:=par[4].size()+1;
   par[4].TYP_STN:='RAZEM';
   par[4].add(1);
   par[8]:=2;
   par[1]:=par[13].first(); ~~
}
{FI}
{IF: ~par[1]}
{FUN.info('%1\n%2'['Brak informacji do prezentacji.'@,'Sprawozdanie zostało przerwane.'@]);~~}
{EXIT: ~par[1]}
{FI}
{par[12]:=0; par[11]:=par[10]:=1; ~~}
{WHILE: par[11]>0 & par[10]>0}
{DO}
{par[8]:=2;~~}
{DIRECT}
{FONT: 'T8GB'}
{SPACE: 'C'}
┌──────────────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────┐
│       JEDNOSTKA          │                   │                   │                   │                   │                   │                   │                   │                   │                   │                   │
│     ORGANIZACYJNA        ├─────────┬─────────┼─────────┬─────────┼─────────┬─────────┼─────────┬─────────┼─────────┬─────────┼─────────┬─────────┼─────────┬─────────┼─────────┬─────────┼─────────┬─────────┼─────────┬─────────┤
│                          │    P    │    N    │    P    │    N    │    P    │   N     │    P    │   N     │    P    │   N     │    P    │   N     │    P    │   N     │    P    │   N     │    P    │   N     │    P    │   N     │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
├──────────────────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
│                          ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│                          │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │         │
└──────────────────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
{line(par[8]);~~}{29*' '}{FOR: par[4]}{FROM: par[10]}{TO: par[10]+9}{DO}{20+((14+par[4].TYP_STN)+(20*' '))}{OD}
{FONT: 'q'}
{par[8]+=2; ~~ }
{FOR: par[13]}
{FROM: par[11]}
{TO: par[11]+19}
{DO}
{  {? par[12]=1 || par[10]+=10 ?};
   par[8]+=2;
   par[9]:='';
   par[9]+=(5*' ')+form({? par[13].OK='O' || par[13].JORG || '' ?},19);
   par[9]+=' '+form({? par[13].OK='O' || 'O' || 'K' ?},2);
   {! _ix:=par[10]..par[10]+19
   |! _liczba:=($('par[13].K'+(('0'+$_ix)+2)))();
      _ix+=1;
     par[9]+=(1*' ')+form({? _liczba>0 || _liczba || ' ' ?},9,2,'9,')
   !};
   {? par[12]=1 || par[10]-=10 ?}; ~~
}
{line(par[8]);~~}{par[9]}
{OD}
{DIRECT-}
{
   par[11]:={? par[13].find_tab(,'LP',,'=',par[11]+20) || par[11]+20 || par[13].first(); 1 ?};
   {? par[11]=1
   || par[10]:={? par[4].find_tab(,'LPSTN',,'=',par[10]+10) || par[10]+10 || 0 ?};
      par[12]:=1
   ?}; ~~
}
{OD}