:!UTF-8
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vatrej5.rpi
==================================================
Zawartosc: Plik wykorzystywany w wydruku 'Wydruk rejestru VAT',
                 'Grupy podatkowe VAT', 'Uslugi z importu', 'Rejestr sprzedazy VAT'
rejestry VAT - zak=1 - import uslug, zak=0 - sprzedaz
grupy VAT    - zak=2
usl. z imp.  - zak=3
rej. sprzed. - zak=4
{COMMENT-}
{ {? VAT7.WYD_TECH || PAR_WYDR.HEAD:=PAR_WYDR.LOGO:=0 ?};
  {? var_press('WAL',VAT7)<=0 || exec('par_4','!fks_vat_zrej') || exec('par_6','!fks_vat_zrej') ?};colspan:=4;
  SLU.index('NAZ'); SLU.prefix(); VAT7.win_edit('STAWKI');~~}
{IF: ~SLU.find_key('~STAWKI VAT '+VAT7.KRAJ().KOD)}
{ FUN.info('Nie znaleziono w systemie słownika "~STAWKI VAT '+VAT7.KRAJ().KOD+'".');~~}{EXIT}
{FI}
{ SLO.index('SL'); SLO.prefix(SLU.ref());
  {? SLO.first() || _i:=0; {! |? _i+=1; ($('VAT7.ST_VAT'+$_i+':=SLO.ref()'))(); _i<7 & SLO.next() !} ?};~~}
{EXIT: ~VAT7.edit()}
{ {! _i:=1..7 |! ($('stawka['+$_i+']:=VAT7.ST_VAT'+$_i+'().KOD'))() !};
  text[1]:="ww[1]:='   SUMA STRONY'; ww[2]:= form(sstr6,,2,' ,'); ww[3]:= form(sstr8,,2,' ,');
            ww[4]:= form(sstr10,,2,' ,'); ww[5]:= form(sstr12,,2,' ,')";
  text[2]:="ww[6]:= form(sstr14,,2,' ,'); ww[7]:= form(sstr16,,2,' ,'); ww[8]:= form(sstr18,,2,' ,');
            ww[9]:=form(sstr20,,2,' ,');  ww[10]:=form(sstr22,,2,' ,')";
  text[3]:="ww[1]:=''; ww[2]:=form(sstr7,,2,' ,'); ww[3]:={? (-stawka[1])*'zwol.'=0 || form(sstr9,,2,' ,') || '' ?};
            ww[4]:={? (-stawka[2])*'zwol.'=0 || form(sstr11,,2,' ,') || '' ?}";
  text[4]:="ww[5]:={? (-stawka[3])*'zwol.'=0 || form(sstr13,,2,' ,') || '' ?};
            ww[6]:={? (-stawka[4])*'zwol.'=0 || form(sstr15,,2,' ,') || '' ?}";
  text[5]:="ww[7]:={? (-stawka[5])*'zwol.'=0 || form(sstr17,,2,' ,') || '' ?};
            ww[8]:={? (-stawka[6])*'zwol.'=0 || form(sstr19,,2,' ,') || '' ?}";
  text[6]:="ww[9]:={? (-stawka[7])*'zwol.'=0 || form(sstr21,,2,' ,') || '' ?}; ww[10]:=form(sstr23,,2,' ,')";
  text[7]:="ww[1]:='   Z PRZENIESIENIA'; ww[2]:= form((suma6-sstr6),,2,' ,'); ww[3]:= form((suma8-sstr8),,2,' ,');
            ww[4]:= form((suma10-sstr10),,2,' ,'); ww[5]:= form((suma12-sstr12),,2,' ,')";
  text[8]:="ww[6]:= form((suma14-sstr14),,2,' ,'); ww[7]:= form((suma16-sstr16),,2,' ,');
            ww[8]:= form((suma18-sstr18),,2,' ,'); ww[9]:=form((suma20-sstr20),,2,' ,'); ww[10]:=form((suma22-sstr22),,2,' ,')";
  text[9]:="ww[1]:=''; ww[2]:=form((suma7-sstr7),,2,' ,'); ww[3]:={? (-stawka[1])*'zwol.'=0 || form((suma9-sstr9),,2,' ,') || '' ?};
            ww[4]:={? (-stawka[2])*'zwol.'=0 || form((suma11-sstr11),,2,' ,') || '' ?}";
  text[10]:="ww[5]:={? (-stawka[3])*'zwol.'=0 || form((suma13-sstr13),,2,' ,') || '' ?};
             ww[6]:={? (-stawka[4])*'zwol.'=0 || form((suma15-sstr15),,2,' ,') || '' ?}";
  text[11]:="ww[7]:={? (-stawka[5])*'zwol.'=0 || form((suma17-sstr17),,2,' ,') || '' ?};
             ww[8]:={? (-stawka[6])*'zwol.'=0 || form((suma19-sstr19),,2,' ,') || '' ?}";
  text[12]:="ww[9]:={? (-stawka[7])*'zwol.'=0 || form((suma21-sstr21),,2,' ,') || '' ?}; ww[10]:=form((suma23-sstr23),,2,' ,')";
  text[13]:="ww[2]:= form(suma6,,2,' ,');  ww[3]:=form(suma8,,2,' ,');  ww[4]:= form(suma10,,2,' ,');  ww[5]:= form(suma12,,2,' ,')";
  text[14]:="ww[6]:= form(suma14,,2,' ,'); ww[7]:=form(suma16,,2,' ,'); ww[8]:= form(suma18,,2,' ,');
             ww[9]:=form(suma20,,2,' ,');  ww[10]:=form(suma22,,2,' ,')";
  text[15]:="ww[1]:=''; ww[2]:=form(suma7,,2,' ,'); ww[3]:={? (-stawka[1])*'zwol.'=0 || form(suma9,,2,' ,') || '' ?};
             ww[4]:={? (-stawka[2])*'zwol.'=0 || form(suma11,,2,' ,') || '' ?}";
  text[16]:="ww[5]:={? (-stawka[3])*'zwol.'=0 || form(suma13,,2,' ,') || '' ?};
             ww[6]:={? (-stawka[4])*'zwol.'=0 || form(suma15,,2,' ,') || '' ?}";
  text[17]:="ww[7]:={? (-stawka[5])*'zwol.'=0 || form(suma17,,2,' ,') || '' ?};
             ww[8]:={? (-stawka[6])*'zwol.'=0 || form(suma19,,2,' ,') || '' ?}";
  text[18]:="ww[9]:={? (-stawka[7])*'zwol.'=0 || form(suma21,,2,' ,') || '' ?};  ww[10]:=form(suma23,,2,' ,')";
  szer[1]:=9; szer[3]:=11; szer[4]:=13; szer[6]:=14;
  {? OPERATOR.DEPT
  || szer[2]:=51; szer[5]:=25; szer[7]:=szer[8]:=szer[9]:=szer[10]:=szer[11]:=szer[12]:=szer[13]:=14
  || szer[2]:=51; szer[5]:=27; szer[7]:=szer[8]:=szer[9]:=szer[10]:=szer[11]:=szer[12]:=szer[13]:=13
  ?}; szer[14]:=14; szer[15]:=4;szer[16]:=10;szer[17]:=7;
  PRN.add("w[18]",szer[15],' Lp.',1); w[18]:='';
  {? rep_expo()
  || PRN.add("w[29]",szer[1],'Rej. VAT',,'#');
     PRN.add("w[30]",szer[1],'Pozycja',,'#')
  || PRN.add("w[1]",szer[1],'Rej. VAT/#pozycja',,'#')
  ?};
  {? rep_expo()
  || PRN.add("w[31]",szer[2],'Symbol dokumentu',,'#');
     {?odd||PRN.add("w[32]",szer[1],'Jed.ks.',,'#');colspan:=colspan+1?};
     PRN.add("w[33]",szer[2],'Rej.księg.',,'#');colspan:=colspan+1;
     PRN.add("w[34]",szer[2],'Pozycja',,'#');colspan:=colspan+1;
     {? zak=0 | zak=4 || PRN.add("w[35]",szer[2],'Termin płatności',,'#');colspan:=colspan+1 ?}
  || PRN.add("w[2]",szer[2],'Symbol dokumentu/'+{?odd||'Jed.ks./'||''?}+'Rej.księg./pozycja'+{? zak=0 | zak=4 || '#Termin płatności' || '' ?},,'#')
  ?};
  {? zak=1 & 4+RVAT.KVAT().SYM='ImpU' | zak=3
  || {? rep_expo()
     || PRN.add("w[36]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[37]",szer[3],'Data wystaw.',,'#');colspan:=colspan+1
     || PRN.add("w[3]",szer[16],'D. zapisu/#wystaw.',,'#')
     ?}
  |? zak=4 & rejestr='SprzEksp'
  || {? rep_expo()
     || PRN.add("w[36]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[37]",szer[3],'Data wystawawienia',,'#');colspan:=colspan+1;
        PRN.add("w[38]",szer[3],'Data odpr. cel.',,'#');colspan:=colspan+1
     || PRN.add("w[3]",szer[16],'D. zapisu/#wystaw./#odpr. cel.',,'#')
     ?}
  |? (zak=0 | zak=4) & VAT7.PAR2<>2
  || {? (zak=0 & var_pres('eksport')>0 & eksport=1)
     || {? rep_expo()
        || PRN.add("w[36]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
           PRN.add("w[37]",szer[3],'Data wystaw.',,'#');colspan:=colspan+1;
           PRN.add("w[38]",szer[3],'Data odpr. cel.',,'#');colspan:=colspan+1
        || PRN.add("w[3]",szer[16],'D. zapisu/#wystaw./#odpr. cel.',,'#')
        ?}
     || {? rep_expo()
        || PRN.add("w[36]",szer[1],'Data zapisu',,'#');colspan:=colspan+1;
           PRN.add("w[37]",szer[1],'Data wystawienia',,'#');colspan:=colspan+1;
           PRN.add("w[38]",szer[1],'Data potwierdzenia odbioru',,'#'); colspan:=colspan+1
        || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia/#potw. odb.',,'#')
        ?}
     ?}
  || {? rep_expo()
     || PRN.add("w[36]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[37]",szer[3],'Data wystaw.',,'#');colspan:=colspan+1
     || PRN.add("w[3]",szer[16],'D. zapisu/# wystaw.',,'#')
     ?}
  ?};_a:= 'St. zwolniona#  od podatku';
   {? +param6++param7++param8>0
  || _szer:={? +param6>0 || szer[17]+1 || 0 ?} + {? +param7>0 || szer[3]+1 || 0 ?}+{? +param8>0 || szer[17]+1 || 0 ?}
  || _szer:=0
  ?};
  {? rep_expo()
  || PRN.add("w[41]",szer[5],'  Kontrahent - nazwa, siedziba, numer identyfikacyjny'+{? grupa_vat='SprPKWSU' | grupa_vat='SprPozKr' ||', nazwa usługi'||''?});colspan:=colspan+1
  || PRN.add("w[5]",szer[5],'  Kontrahent - nazwa, siedziba, numer identyfikacyjny'+{? grupa_vat='SprPKWSU' | grupa_vat='SprPozKr' ||', nazwa usługi'||''?})
  ?};
  {? param6<>''
  || PRN.add("w[50]",szer[17],'GTU',)
  ?};
  {? param7<>''
  || PRN.add("w[51]",szer[3],'Procedury',)
  ?};
  {? param8<>''
  || PRN.add("w[52]",szer[17],'Typ JPK',)
  ?};
  {? rep_expo()
  || PRN.add("w[39]",szer[1],'Wart. brutto',1,'#');
     PRN.add("w[40]",szer[1],'Podatek VAT',1,'#')
  || PRN.add("w[6]",szer[6],'Wart. brutto/# Podatek VAT',1,'#')
  ?};
  {? rep_expo()
  || {? stawka[1]<>'' || PRN.add("w[7]",szer[7],{? (-stawka[1])*'zwol.'<>0 || _a || stawka[1] +' net.' ?},1,'#') ?};
     {? stawka[1]<>'' || PRN.add("w[43]",szer[7],'VAT',1,'#') ?}
  || {? stawka[1]<>'' || PRN.add("w[7]",szer[7],{? (-stawka[1])*'zwol.'<>0 || _a || stawka[1] +' net./VAT' ?},1,'#') ?}
  ?};
  {? rep_expo()
  || {? stawka[2]<>'' || PRN.add("w[8]",szer[8],{? (-stawka[2])*'zwol.'<>0 || _a || stawka[2] +' net.' ?},1,'#') ?};
     {? stawka[2]<>'' || PRN.add("w[44]",szer[8],'VAT',1,'#') ?}
  || {? stawka[2]<>'' || PRN.add("w[8]",szer[8],{? (-stawka[2])*'zwol.'<>0 || _a || stawka[2] +' net./VAT' ?},1,'#') ?}
  ?};
  {? rep_expo()
  || {? stawka[3]<>'' || PRN.add("w[9]",szer[9],{? (-stawka[3])*'zwol.'<>0 || _a || stawka[3] +' net.' ?},1,'#') ?};
     {? stawka[3]<>'' || PRN.add("w[45]",szer[9],'VAT',1,'#') ?}
  || {? stawka[3]<>'' || PRN.add("w[9]",szer[9],{? (-stawka[3])*'zwol.'<>0 || _a || stawka[3] +' net./VAT' ?},1,'#') ?}
  ?};
  {? rep_expo()
  || {? stawka[4]<>'' || PRN.add("w[10]",szer[10],{? (-stawka[4])*'zwol.'<>0 || _a || stawka[4] +' net.' ?},1,'#') ?};
     {? stawka[4]<>'' || PRN.add("w[46]",szer[10],'VAT',1,'#') ?}
  || {? stawka[4]<>'' || PRN.add("w[10]",szer[10],{? (-stawka[4])*'zwol.'<>0 || _a || stawka[4] +' net./VAT' ?},1,'#') ?}
  ?};
  {? rep_expo()
  || {? stawka[5]<>'' || PRN.add("w[11]",szer[11],{? (-stawka[5])*'zwol.'<>0 || _a || stawka[5] +' net.' ?},1,'#') ?};
     {? stawka[5]<>'' || PRN.add("w[47]",szer[11],'VAT',1,'#') ?}
  || {? stawka[5]<>'' || PRN.add("w[11]",szer[11],{? (-stawka[5])*'zwol.'<>0 || _a || stawka[5] +' net./VAT' ?},1,'#') ?}
  ?};
  {? rep_expo()
  || {? stawka[6]<>'' || PRN.add("w[12]",szer[12],{? (-stawka[6])*'zwol.'<>0 || _a || stawka[6] +' net.' ?},1,'#') ?};
     {? stawka[6]<>'' || PRN.add("w[48]",szer[12],'VAT',1,'#') ?}
  || {? stawka[6]<>'' || PRN.add("w[12]",szer[12],{? (-stawka[6])*'zwol.'<>0 || _a || stawka[6] +' net./VAT' ?},1,'#') ?}
  ?};
  {? rep_expo()
  || {? stawka[7]<>'' || PRN.add("w[13]",szer[13],{? (-stawka[7])*'zwol.'<>0 || _a || stawka[7] +' net.' ?},1,'#') ?};
     {? stawka[7]<>'' || PRN.add("w[49]",szer[13],'VAT',1,'#') ?}
  || {? stawka[7]<>'' || PRN.add("w[13]",szer[13],{? (-stawka[7])*'zwol.'<>0 || _a || stawka[7] +' net./VAT' ?},1,'#') ?}
  ?};
  {? rep_expo()
  || PRN.add("w[14]",szer[14],'Pozost. stawki netto',1,'#');
     PRN.add("w[42]",szer[14],'VAT',1,'#')
  || PRN.add("w[14]",szer[14],'Pozost. stawki#  netto/VAT',1,'#')
  ?};
  {? +param6++param7++param8>0
  || _szer:={? +param6>0 || szer[17]+1 || 0 ?} + {? +param7>0 || szer[3]+1 || 0 ?}+{? +param8>0 || szer[17]+1 || 0 ?}
  || _szer:=0
  ?};
  PRN1.add("ww[1]",szer[1]+szer[2]+szer[16]+szer[5]+szer[15]+4+_szer,'',,,,,,,,colspan);
  {? rep_expo()
  || PRN1.add("ww[2]",szer[6],'',1);
     PRN1.add("ww[31]",szer[6],'',1)
  || PRN1.add("ww[2]",szer[6],'',1)
  ?};~~}{
  {? stawka[1]<>''
  || {? rep_expo() || PRN1.add("ww[3]",szer[7],'',1); PRN1.add("ww[32]",szer[7],'',1) || PRN1.add("ww[3]",szer[7],'',1) ?}
  ?};
  {? stawka[2]<>''
  || {? rep_expo() || PRN1.add("ww[4]",szer[8],'',1); PRN1.add("ww[33]",szer[8],'',1) || PRN1.add("ww[4]",szer[8],'',1) ?}
  ?};
  {? stawka[3]<>''
  || {? rep_expo() || PRN1.add("ww[5]",szer[9],'',1); PRN1.add("ww[34]",szer[9],'',1) || PRN1.add("ww[5]",szer[9],'',1) ?}
  ?};
  {? stawka[4]<>''
  || {? rep_expo() || PRN1.add("ww[6]",szer[10],'',1); PRN1.add("ww[35]",szer[10],'',1) || PRN1.add("ww[6]",szer[10],'',1) ?}
  ?};
  {? stawka[5]<>''
  || {? rep_expo() || PRN1.add("ww[7]",szer[11],'',1); PRN1.add("ww[36]",szer[11],'',1) || PRN1.add("ww[7]",szer[11],'',1) ?}
  ?};
  {? stawka[6]<>''
  || {? rep_expo() || PRN1.add("ww[8]",szer[12],'',1); PRN1.add("ww[37]",szer[12],'',1) || PRN1.add("ww[8]",szer[12],'',1) ?}
  ?};
  {? stawka[7]<>''
  || {? rep_expo() || PRN1.add("ww[9]",szer[13],'',1); PRN1.add("ww[38]",szer[13],'',1) || PRN1.add("ww[9]",szer[13],'',1) ?}
  ?};
{? rep_expo()
||PRN1.add("ww[10]",szer[14],'',1);
  PRN1.add("ww[39]",szer[14],'',1)
||PRN1.add("ww[10]",szer[14],'',1)
?};
~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}{IF: ~VAT7.WYD_TECH}{LINE: 1}{FI}
{SUBSTITUTE: 'HEAD'}
{FONT: 'W8'}{SPACE: 'C'}{IF: page=1}
{<3 'Parametry wydruku:'}
{<6 'Jednostka księgowa: '+{? OPERATOR.DEPT || OPERATOR.DEPT().OD || 'wszystkie jednostki księgowe' ?}+{? VAT7.TYPOKR='M' || '   Rodzaj okresu: '+{? SSTALE.AO().ZAM='T'||'zamknięty'||'otwarty'?} || '' ?}}
{IF: ~VAT7.WYD_TECH}
{IF: dokvpoch<>''}{<6 dokvpoch}{FI}
{<6 'Kraj opodatkowania: '+kraj+{? wal_op<>'' || '   Waluta opodatkowania: '+wal_op || '' ?}}
{IF: param1<>''}
{<6 param1}{FI}{IF: param2<>''}
{<6 param2}{FI}{IF: param3<>''}
{<6 param3}{FI}{IF: param4<>''}
{<6 param4}{FI}{IF: param6<>''}
{<6 param6}{FI}{IF: param7<>''}
{<6 param7}{FI}{IF: param8<>''}
{<6 param8}{FI}{FI}{FI}
{LINE: 1}{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{IF: page=1}{REP: PRN.fbar()}{FI}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------MACRO-LINIA------------------{COMMENT-}
{MACRO: 'LINIA'}
{IF: ~font_gr}{IF: s2c}{FONT: 'T8G'}{ELSE}{FONT: 'T8G'}{FI}{ELSE}{FONT: 'T8GB'}{FI}{ PRN.setcolor('255:255:255');~~}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{ PRN.setcolor('255:255:255');~~}
{REP: PRN.fline()}
{OD}{FONT: 'T8G'}{ vp:=0; PRN.setcolor(color);~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINIA1------------------{COMMENT-}
{MACRO: 'LINIA1'}
{IF: ~font_gr}{FONT: 'T8G'}{ELSE}{FONT: 'T8GB'}{FI}{ PRN1.setcolor('255:255:255');~~}
{FONT: 'T8G'}
{PRN1.ini_line()}
{WHILE: PRN1.next()}
{DO}
{REP: PRN1.fline()}
{OD}{FONT: 'T8G'}{ vp:=0; PRN1.setcolor(color);~~}
{MACRO-}
{COMMENT}------------------------------FOOTER--------------------------{COMMENT-}
{SPACE: 'C'}
{IF: VAT7.WY3 & ~rep_expo()}
{FOOTER: 0}{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{REP: PRN1.fhbar()}                  { $text[1](); $text[2]();~~}
{SUBSTITUTE: 'LINIA1'}{ $text[3](); $text[4](); $text[5](); $text[6]();~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{IF: page>1}{ $text[7](); $text[8]();~~}
{SUBSTITUTE: 'LINIA1'}{ $text[9](); $text[10](); $text[11](); $text[12]();~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{FI}{ ww[1]:='   DO PRZENIESIENIA';~~}{ $text[13](); $text[14]();~~}
{SUBSTITUTE: 'LINIA1'}{ $text[15](); $text[16](); $text[17](); $text[18]();~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.flbar()}{ELSE}{PRN1.lbar()}{FI}{ sstr6:=sstr7:=sstr8:=sstr9:=sstr10:=sstr11:=sstr12:=sstr13:=sstr14:=sstr15:=sstr16:=sstr17:=sstr18:=sstr19:=sstr20:=sstr21:=sstr22:=sstr23:=0; vp:=1;~~ }
{FOOTER-}
{ELSE}
{FOOTER: 0}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}{ vp:=1;~~}
{FOOTER-}
{FI}
{COMMENT}------------------------------MACRO-SRODEK-------------------------------------------{COMMENT-}
{MACRO: 'SRODEK'}
{IF: 6+rejestr<>'_WWspN' | DVAT.RVAT().KVAT().SYM<>'_WWspNus'}
{IF: ((zak=1 | zak=3) & exec('vat_nal','!fks_vat_zrej',VAT7.PAR4)) | zak=0 | zak=2 | zak=4}
{IF: exec('chk_okr_vat','!fks_vat_zrej')}
    { _a:=DVAT.DOKOKRO().ROK().KOD+form(DVAT.DOKOKRO().NR,-2);
      DOK.use('doku'+_a); POZ.use('pozy'+_a); POW.use('pow_'+_a); DVAT.DOK(); licznik:=0;~~}
    {IF: ((VAT7.PAR2=2) & (-DOK.DOK_REJ().KOR='n')) | ((VAT7.PAR2=1) & (-DOK.DOK_REJ().KOR='t')) |
             (VAT7.PAR2=3)}
{IF:   (VAT7.WY4<>0 & (VAT7.WY4=1 & {? VAT7.JPK_GTU='' || 1
                                  |? VAT7.JPK_GTU*'BRAK'>0 & DVAT.DOK().JPK_GTU='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_GTU,DVAT.DOK().JPK_GTU)
                                  ?})) |
  (VAT7.WY5<>0 & (VAT7.WY5=1 & {? VAT7.JPK_PROC='' || 1
                                  |? VAT7.JPK_PROC*'BRAK'>0 & DVAT.DOK().JPK_PROC='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_PROC,DVAT.DOK().JPK_PROC)
                                  ?})) |
   (VAT7.WY6<>0 & (VAT7.WY6=1 & {? VAT7.JPK_TD='' || 1
                                  |? VAT7.JPK_TD*'BRAK'>0 & DVAT.DOK().JPK_V_T='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_TD,DVAT.DOK().JPK_V_T)
                                  ?})) |
   (VAT7.WY4=0 & VAT7.WY5=0 & VAT7.WY6=0)
                                  }
    { kor:=DOK.DOK_REJ().KOR='T'; s2c:=DVAT.USUNIETY; {? s2c || is_us:=1 ?};
      w[1]:=DVAT.RVAT().SYM; w[2]:=DVAT.SYM1; w[3]:=DVAT.DAT1$1; w[19]:=DVAT.DAT2$1;  w[20]:=DVAT.DAT4$1;
      DVAT.DOK().REJ();
      w[4]:={?odd||REJ.ODD().OD+'-'||''?}+REJ.KOD+(8-(+REJ.KOD))*' '
         +'-'+form(DVAT.DOK().NR,,,'99');
      w[29]:=DVAT.RVAT().SYM;
      w[30]:=DVAT.NR;
      w[31]:=DVAT.SYM1;
      w[36]:={?odd||DVAT.DOK().REJ().ODD().OD||''?};
      w[33]:=DVAT.DOK().REJ().KOD;
      w[34]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
      w[32]:={?odd||DVAT.DOK().REJ().ODD().OD||''?};
      w[35]:=$DOK.D3;
      w[36]:=DVAT.DAT1$1;
      w[37]:=DVAT.DAT2$1;
      w[38]:={? 6+RVAT.KVAT().SYM<>'_WWspN'||DVAT.DAT4$1||''?};
      {? param6<>'' || w[50]:=DVAT.DOK().JPK_GTU || w[50]:='' ?};
      {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
      {? param7<>'' || w[51]:=DVAT.DOK().JPK_PROC;  w[51]:=STR2.gsub(w[51],',',', ') || w[51]:='' ?};
      {? param8<>'' || w[52]:=DVAT.DOK().JPK_V_T || w[52]:='' ?};
      pom_7:=$DVAT.NR;
      w55:=w[41]:=exec('szukkh','!fks_vat_zrej')+{? (grupa_vat='SprPKWSU' | grupa_vat='SprPozKr') & DOK.TR<>'' || ', '+DOK.TR || '' ?};
      STR.split(w55); ile_l:=0; {! |? _tekst:=STR.line(szer[5]); {? _tekst<>'' || ile_l+=1; 1 || 0 ?} !}; licznik:=0;  ~~}
    {FOR: 'PVAT'}
    {INDEX: 'NR'}
    {PREFIX: DVAT.ref}
    {DO}
    {IF: (grupa_vat<>'SprPKWSU' & grupa_vat<>'SprPozKr') | exec('wsu_p','!fks_vat_zrej')}
    {IF: zak=0 | zak=4 |
         ((zak=1 | zak=3) & ((VAT7.PAR4=1 & (1+PVAT.GRVAT().KOD='Z')) | VAT7.PAR4=2)) | (zak=2 & PVAT.GRVAT().KOD=rejestr)}
      {IF: (menu_txt<>'C. Eksport towarów' & 3+menu_txt<>'N.1') | (menu_txt='C. Eksport towarów' & PVAT.STVAT().KOD=' 0 %') | (3+menu_txt='N.1' & PVAT.STVAT().KOD=' -')}
      {IF: exec('typ_okr_vat','!fks_vat_zrej',2)}
      {IF: (rejestr<>'SprzNOp' | exec('czy_sprznop','!fks_vat_zrej') )
           | (menu_txt='L. Czynności nieopodatkowane na terytorium kraju' & PVAT.GRVAT().KOD='SprPozKr' & VAT7.PAR10=3)}
      {  www[6]+=PVAT.SUM1;  www[7]+=PVAT.VAT; licznik+=1;~~}
      {IF: PVAT.STVAT().KOD=stawka[1]}
        { www[8]+=PVAT.SUM2; www[9]+=PVAT.VAT;~~}
      {ELIF: PVAT.STVAT().KOD=stawka[2]}
        { www[10]+=PVAT.SUM2; www[11]+=PVAT.VAT;~~}
      {ELIF: PVAT.STVAT().KOD=stawka[3]}
        { www[12]+=PVAT.SUM2; www[13]+=PVAT.VAT;~~}
      {ELIF:PVAT.STVAT().KOD=stawka[4]}
        { www[14]+=PVAT.SUM2;  www[15]+=PVAT.VAT;~~}
      {ELIF: PVAT.STVAT().KOD=stawka[5]}
        { www[16]+=PVAT.SUM2;  www[17]+=PVAT.VAT;~~}
      {ELIF:PVAT.STVAT().KOD=stawka[6]}
        { www[18]+=PVAT.SUM2;  www[19]+=PVAT.VAT;~~}
      {ELIF:PVAT.STVAT().KOD=stawka[7]}
        { www[20]+=PVAT.SUM2;  www[21]+=PVAT.VAT;~~}
      {ELSE}{'reszta stawek';~~}
        { www[22]+=PVAT.SUM2;  www[23]+=PVAT.VAT;~~}
      {FI}
      {FI}
      {FI}
    {FI}
    {FI}
    {FI}
    {OD}{FI}
{COMMENT}----------------------------WYDRUK------------------------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: licznik}{ {? lineleft<4 || vp:=1 || vp:=0 ?};~~}
{ENTIRE}
{IF: (rej_naz<>DVAT.RVAT().SYM & ~pierwszy) & zak=2}
{  pom_1:=w[1]; pom_2:=w[2]; pom_3:=w[3]; pom_4:=w[4]; pom_5:=w[5]; pom_6:=w[18];
   w[6]:=form(rej_1,,2,' ,'); w[7]:=form(rej_3,,2,' ,'); w[8]:=form(rej_5,,2,' ,'); w[9]:=form(rej_7,,2,' ,');
   w[10]:=form(rej_9,,2,' ,'); w[11]:=form(rej_11,,2,' ,'); w[12]:=form(rej_13,,2,' ,'); w[13]:=form(rej_15,,2,' ,');
   w[14]:=form(rej_17,,2,' ,'); w[1]:=rej_naz; w[2]:=w[3]:=w[4]:=w[5]:=w[18]:='';~~}
{IF: vp>1 | rep_expo()}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}
{ font_gr:=1;~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA'}{FI}
{ w[6]:=form(rej_2,,2,' ,'); w[7]:=form(rej_4,,2,' ,'); w[8]:=form(rej_6,,2,' ,'); w[9]:=form(rej_8,,2,' ,');
  w[10]:=form(rej_10,,2,' ,'); w[11]:=form(rej_12,,2,' ,'); w[12]:=form(rej_14,,2,' ,'); w[13]:=form(rej_16,,2,' ,');
  w[14]:=form(rej_18,,2,' ,');  {! _i:=1..7 |! {? (-stawka[_i])*'zwol.'=1 || w[_i+6]:='' ?} !}; w[1]:=''; w[18]:='';
   ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA'}{FI}{font_gr:=0;~~}
{ rej_1:=rej_2:=rej_3:=rej_4:=rej_5:=rej_6:=rej_7:=rej_8:=rej_9:=rej_10:=rej_11:=rej_12:=0;
  rej_13:=rej_14:=rej_15:=rej_16:=rej_17:=rej_18:=0; rej_naz:=DVAT.RVAT().SYM;
  w[1]:=pom_1; w[2]:=pom_2; w[3]:=pom_3; w[4]:=pom_4; w[5]:=pom_5; w[18]:=pom_6;~~}
{FI}
{ENTIRE-}
{ {? ((ile_l>=3 | zak=1 | zak=3) & lineleft<4) | (~(ile_l>=3 | zak=1 | zak=3) & lineleft<3)  || vp:=1 || vp:=0 ?};
  STR.split(w55); w[5]:=STR.line(szer[5]);
  {? ~rep_expo()
  || STR2.split(w[50]); w[50]:=STR2.line(6);
     STR3.split(w[51]); w[51]:=STR3.line(szer[3]) ?}; ~~}
{ENTIRE}
{ w[6]:=w[39]:= form(www[6],,2,' ,'); w[7]:=form(www[8],,2,' ,'); w[8]:=form(www[10],,2,' ,'); w[9]:=form(www[12],,2,' ,'); w[10]:=form(www[14],,2,' ,');
  w[11]:=form(www[16],,2,' ,'); w[12]:=form(www[18],,2,' ,'); w[13]:=form(www[20],,2,' ,'); w[14]:=form(www[22],,2,' ,'); w[40]:=form(www[7],,2,' ,'); w[42]:=form(www[23],,2,' ,');
  w[43]:={? (-stawka[1])*'zwol.'=0 ||form(www[9],,2,' ,')  || '' ?};
  w[44]:={? (-stawka[2])*'zwol.'=0 ||form(www[11],,2,' ,')|| '' ?};
  w[45]:={? (-stawka[3])*'zwol.'=0 ||form(www[13],,2,' ,')|| '' ?};
  w[46]:={? (-stawka[4])*'zwol.'=0 ||form(www[15],,2,' ,')|| ''?};
  w[47]:={? (-stawka[5])*'zwol.'=0 ||form(www[17],,2,' ,')|| ''?};
  w[48]:={? (-stawka[6])*'zwol.'=0 ||form(www[19],,2,' ,')|| ''?};
  w[49]:={? (-stawka[7])*'zwol.'=0 ||form(www[21],,2,' ,')|| ''?};
  ~~}
{IF: linijka}
{IF: vp>1 | rep_expo() | (lineleft()>=0 & lineleft()<=3)}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}
{FI}{ linijka:=1; numer+=1; w[18]:=$numer; dru_rej:=1;~~}{ {? pierwszy || rej_naz:=DVAT.RVAT().SYM; pierwszy:=0 ?};~~}
{SUBSTITUTE: 'LINIA'}{ w[18]:=w[40]:=w[39]:=w[41]:=w[38]:=w[37]:=w[36]:=w[35]:=w[32]:=w[34]:=w[33]:=w[36]:=w[31]:=w[30]:=w[29]:=w[42]:=w[14]:=w[43]:=w[44]:=w[45]:=w[46]:=w[47]:=w[48]:=w[49]:=w[50]:=w[51]:=w[52]:='';~~}
{ w[1]:=pom_7;  w[2]:=w[4]; w[3]:=w[19]; STR.split(+w[5]-w55); w[5]:=STR.line(szer[5]); w[6]:=form(www[7],,2,' ,');
 w[50]:=STR2.line(6); w[51]:=STR3.line(szer[1]);w[52]:='';
  w[7]:={? (-stawka[1])*'zwol.'=0 ||form(www[9],,2,' ,') || '' ?};
  w[8]:={? (-stawka[2])*'zwol.'=0 ||form(www[11],,2,' ,')|| '' ?};
  w[9]:={? (-stawka[3])*'zwol.'=0 ||form(www[13],,2,' ,')|| '' ?};
  w[10]:={? (-stawka[4])*'zwol.'=0 ||form(www[15],,2,' ,')|| ''?};
  w[11]:={? (-stawka[5])*'zwol.'=0 ||form(www[17],,2,' ,')|| ''?};
  w[12]:={? (-stawka[6])*'zwol.'=0 ||form(www[19],,2,' ,')|| ''?};
  w[13]:={? (-stawka[7])*'zwol.'=0 ||form(www[21],,2,' ,')|| ''?};
  w[14]:=form(www[23],,2,' ,'); {? rep_expo() || w[7]:=w[8]:=w[9]:=w[10]:=w[11]:=w[12]:=w[13]:=w[14]:=w[29]:='';  w[50]:=w[51]:=w[52]:='' ?};~~}
{SUBSTITUTE: 'LINIA'}
{ w[50]:=STR2.line(6); w[51]:=STR3.line(szer[1]);~~}
{IF: (w555:=STR.line(szer[5]); +w555) | zak=1 | zak=3  | (zak=0 & var_pres('eksport')>0 & eksport=1) | ((zak=0 | zak=4) & DOK.D3<>date(0,0,0))}
{ {! _a:=1..19 |! w[_a]:='' !}; {? zak=1 | zak=3 | kor | (zak=0 & var_pres('eksport')>0 & eksport=1) | rejestr='SprzEksp' || w[3]:=w[20]?};
  {? (zak=0 | zak=4) & DOK.D3<>date(0,0,0) || w[2]:=$DOK.D3 ?}; w[5]:=w555;~~}
{SUBSTITUTE: 'LINIA'}
{FI}
{  {? rep_expo()
   || pdrukuj:=0
   || w[50]:=STR2.line(6);
      w[51]:=STR3.line(szer[1]);
      pdrukuj:={? +w[50] | +w[51] || 1 || 0 ?}
   ?};~~}
{WHILE:  w555:=STR.line(szer[5]); +w555 | pdrukuj}
{DO}{ {! _a:=1..19 |! w[_a]:='' !}; w[5]:=w555;~~}
{SUBSTITUTE: 'LINIA'}
{ {? rep_expo()
  || pdrukuj:=0
  || w[50]:=STR2.line(6);
     w[51]:=STR3.line(szer[3]);
     pdrukuj:={? +w[50] | +w[51] || 1 || 0 ?}
  ?};~~}
{OD}
{ &pdrukuj; w[50]:=w[51]:=w[52]:=''; ~~}
    { {? s2c=0
      || sstr6+=www[6]; sstr7+=www[7]; sstr8+=www[8]; sstr9+=www[9]; sstr10+=www[10]; sstr11+=www[11]; sstr12+=www[12];
         sstr13+=www[13]; sstr14+=www[14]; sstr15+=www[15]; sstr16+=www[16];sstr17+=www[17];sstr18+=www[18];
         sstr19+=www[19]; sstr20+=www[20]; sstr21+=www[21]; sstr22+=www[22]; sstr23+=www[23];
         suma6+=www[6];   suma7+=www[7];   suma8+=www[8];   suma9+=www[9];   suma10+=www[10]; suma11+=www[11];
         suma12+=www[12]; suma13+=www[13]; suma14+=www[14]; suma15+=www[15]; suma16+=www[16]; suma17+=www[17];
         suma18+=www[18]; suma19+=www[19]; suma20+=www[20]; suma21+=www[21]; suma22+=www[22]; suma23+=www[23];
         rej_1+=www[6]; rej_2+=www[7]; rej_3+=www[8]; rej_4+=www[9]; rej_5+=www[10]; rej_6+=www[11];
         rej_7+=www[12]; rej_8+=www[13];  rej_9+=www[14]; rej_10+=www[15]; rej_11+=www[16]; rej_12+=www[17];
         rej_13+=www[18]; rej_14+=www[19]; rej_15+=www[20]; rej_16+=www[21];  rej_17+=www[22]; rej_18+=www[23]
      || {! _i:=1..9
         |! su[_i][1]+=www[4+2*_i];
            su[_i][2]+=www[5+2*_i]
         !}
      ?};
      {! _i:=6..23 |! www[_i]:=0 !};~~}
{ENTIRE-}
{FI}
    {FI}
{FI}
{FI}
{FI}
{MACRO-}
{COMMENT}----------------------PRZYGOTOWANIE WYDRUKU-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}{ RS.index('RS'); RS.prefix();~~}
{IF: rep_expo()}''{FI}
{IF: zak=2}
   {IF: odd}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR' }
            {PREFIX: VAT7.KRAJ,okrVat[okrVatNr]}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NRW'}
            {PREFIX: VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr]}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
   {ELSE}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR_O' }
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr]}
            {DO}
              {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NR_OW'}
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr]}
            {DO}
              {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
  {FI}
{ {? lineleft<3 || vp:=1 || vp:=0 ?};~~}
{ENTIRE}
{IF: rej_1}
{ pom_1:=w[1]; pom_2:=w[2]; pom_3:=w[3]; pom_4:=w[4]; pom_5:=w[5]; pom_6:=w[18];~~}
{  w[6]:=form(rej_1,,2,' ,'); w[7]:=form(rej_3,,2,' ,'); w[8]:=form(rej_5,,2,' ,'); w[9]:=form(rej_7,,2,' ,');
   w[10]:=form(rej_9,,2,' ,'); w[11]:=form(rej_11,,2,' ,'); w[12]:=form(rej_13,,2,' ,'); w[13]:=form(rej_15,,2,' ,');
   w[14]:=form(rej_17,,2,' ,'); w[1]:=rej_naz; w[2]:=w[3]:=w[4]:=w[5]:=''; w[18]:='Suma';~~}
{IF: vp | rep_expo()}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}
{ font_gr:=1;~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA'}{FI}
{w[6]:=form(rej_2,,2,' ,'); w[7]:=form(rej_4,,2,' ,'); w[8]:=form(rej_6,,2,' ,'); w[9]:=form(rej_8,,2,' ,');
 w[10]:=form(rej_10,,2,' ,'); w[11]:=form(rej_12,,2,' ,'); w[12]:=form(rej_14,,2,' ,'); w[13]:=form(rej_16,,2,' ,');
 w[14]:=form(rej_18,,2,' ,');  {! _i:=1..7 |! {? (-stawka[_i])*'zwol.'=1 || w[_i+6]:='' ?} !}; w[1]:=w[18]:=w[29]:=w[30]:='';~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA'}{FI}{ font_gr:=0;~~}
{  rej_1:=rej_2:=rej_3:=rej_4:=rej_5:=rej_6:=rej_7:=rej_8:=rej_9:=rej_10:=rej_11:=rej_12:=0;
    rej_13:=rej_14:=rej_15:=rej_16:=rej_17:=rej_18:=0; rej_naz:=DVAT.RVAT().SYM;
    w[1]:=pom_1; w[2]:=pom_2; w[3]:=pom_3; w[4]:=pom_4; w[5]:=pom_5; w[18]:=pom_6; ~~}
{FI}
{ENTIRE-}
{ELIF: zak=3 | zak=4}
   {FOR: 'RVAT'}
   {INDEX: 'RVAT_ESY'}
   {PREFIX: REF.FIRMA,rejestr}
   {DO}
     {IF: ~OPERATOR.DEPT}
        {okrVatNr:=1;~~}
        {WHILE: okrVatNr<=obj_len(okrVat)}
        {DO}
            {IF: var_press('WAL',VAT7)<=0}
              {FOR: 'DVAT'}
              {INDEX: 'NR'}
              {PREFIX: VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref() }
              {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
              {OD}
           {ELSE}
              {FOR: 'DVAT'}
              {INDEX: 'NRW'}
              {PREFIX: VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
              {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
              {OD}
           {FI}
           {okrVatNr+=1;~~}
        {OD}
     {ELSE}
        {okrVatNr:=1;~~}
        {WHILE: okrVatNr<=obj_len(okrVat)}
        {DO}
           {IF: var_press('WAL',VAT7)>0}
              {FOR: 'DVAT'}
              {INDEX: 'NR_OW'}
              {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
              {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
              {OD}
           {ELSE}
              {FOR: 'DVAT'}
              {INDEX: 'NR_O'}
              {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
              {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
              {OD}
           {FI}
           {okrVatNr+=1;~~}
        {OD}
     {FI}
{IF: dru_rej}
{ {! _i:=1..18 |! w[_i]:='' !}; w[1]:=w[29]:=RVAT.SYM; w[18]:='Suma';
  w[6]:=w[39]:=form(rej_1,,2,' ,'); w[7]:=form(rej_3,,2,' ,'); w[8]:=form(rej_5,,2,' ,'); w[9]:=form(rej_7,,2,' ,'); w[10]:=form(rej_9,,2,' ,');
  w[11]:=form(rej_11,,2,' ,'); w[12]:=form(rej_13,,2,' ,'); w[13]:=form(rej_15,,2,' ,'); w[14]:=form(rej_17,,2,' ,');
  w[42]:=form(rej_18,,2,' ,');
  w[49]:=form(rej_16,,2,' ,');
  w[48]:=form(rej_14,,2,' ,');
  w[47]:=form(rej_12,,2,' ,');
  w[46]:=form(rej_10,,2,' ,');
  w[45]:=form(rej_8,,2,' ,');
  w[44]:=form(rej_6,,2,' ,');
  w[43]:=form(rej_4,,2,' ,');
  w[40]:=form(rej_2,,2,' ,');
  ~~}
{ {? lineleft<3 || vp:=1 || vp:=0 ?};~~}
{ENTIRE}
{IF: vp | rep_expo()}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}{ font_gr:=1;~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA'}{FI}
{ w[1]:=''; w[18]:=w[29]:=w[30]:='';
  w[6]:=form(rej_2,,2,' ,'); w[7]:=form(rej_4,,2,' ,'); w[8]:=form(rej_6,,2,' ,'); w[9]:=form(rej_8,,2,' ,'); w[10]:=form(rej_10,,2,' ,');
  w[11]:=form(rej_12,,2,' ,'); w[12]:=form(rej_14,,2,' ,'); w[13]:=form(rej_16,,2,' ,'); w[14]:=form(rej_18,,2,' ,'); w[42]:=w[49]:=w[48]:=w[47]:=w[46]:=w[45]:=w[44]:=w[43]:=w[50]:=w[51]:=w[52]:='';~~}
{ {! _i:=1..7 |! {? (-stawka[_i])*'zwol.'=1 || w[_i+6]:='' ?} !};~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA'}{FI}{ font_gr:=0;~~}
{ENTIRE-}
{ dru_rej:=0;  rej_1:=rej_2:=rej_3:=rej_4:=rej_5:=rej_6:=rej_7:=rej_8:=0;
  rej_9:=rej_10:=rej_11:=rej_12:=rej_13:=rej_14:=rej_15:=rej_16:=rej_17:=rej_18:=0;~~}
{FI}
   {OD}
{ELSE}
   {IF: odd}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR'}
            {PREFIX:  VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NRW'}
            {PREFIX: VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
   {ELSE}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR_O' }
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NR_OW'}
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'SRODEK'}{FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
   {FI}
{FI}
{COMMENT}------------------------------FOOTER--------------------------{COMMENT-}
{linecnt:=lineleft();~~}
{IF: ((page>1 & linecnt<4+is_us*2) | (page=1 & linecnt<7+is_us*2)) & linecnt<>0}
{PAGE}{FOOTER}{FOOTER-}{ vp:=1;~~}
{ELSE}
{ vp:=0;~~}{FOOTER}{FOOTER-}
{FI}{ {? lineleft()=0 ||  vp:=1 ?};~~}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{IF: ~rep_expo()}
{DIRECT}
{REP: PRN1.fhbar()}
{IF: page>1 & VAT7.WY3}                      { $text[1](); $text[2]();~~}
{SUBSTITUTE: 'LINIA1'}{ $text[3](); $text[4](); $text[5](); $text[6]();~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}                    { $text[7](); $text[8]();~~}
{SUBSTITUTE: 'LINIA1'}{ $text[9](); $text[10](); $text[11](); $text[12]();~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{FI}{ ww[1]:='   RAZEM';~~}
{  $text[13](); $text[14]();~~}
{SUBSTITUTE: 'LINIA1'}
{ $text[15](); $text[16](); $text[17](); $text[18]();~~}
{SUBSTITUTE: 'LINIA1'}
{IF: is_us}
{IF: vp}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{ww[1]:='   RAZEM operacje nie rozliczane w VAT';{! _i:=1..9 |! ww[_i+1]:=form(su[_i][1],,2,' ,') !};
                  ww[31]:=form(su[1][2],,2,' ,');
                  ww[32]:=form(su[2][2],,2,' ,');
                  ww[33]:=form(su[3][2],,2,' ,');
                  ww[34]:=form(su[4][2],,2,' ,');
                  ww[35]:=form(su[5][2],,2,' ,');
                  ww[36]:=form(su[6][2],,2,' ,');
                  ww[37]:=form(su[7][2],,2,' ,');
                  ww[38]:=form(su[8][2],,2,' ,');
                  ww[39]:=form(su[9][2],,2,' ,');~~}
{SUBSTITUTE: 'LINIA1'}
{ww[1]:='';{! _i:=1..9 |! ww[_i+1]:=form(su[_i][2],,2,' ,') !};~~}
{SUBSTITUTE: 'LINIA1'}
{FI}
{IF: vp}{REP: PRN1.flbar()}{ELSE}{PRN1.lbar()}{FI}
{<1>{PRN.width()} 'KONIEC WYDRUKU'}
{DIRECT-}
{FI}