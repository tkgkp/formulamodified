:!UTF-8
{TITLE:G.  Skrócony rachunek wyników}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   PRN:=obj_new(@.CLASS.PRINT,6); PRN.sl_frame();
   PRN2:=obj_new(@.CLASS.PRINT,6); PRN.sl_frame();
   PRNF:=obj_new(@.CLASS.PRINT,4); PRNF.sl_frame();
   PRNH:=obj_new(@.CLASS.PRINT,5); PRNH.sl_frame();
   w:=ww:=www:=obj_new(7); srw:=1;
   pierwsza:=0; color:=prn1:=prn2:='';
   lm:=ll:=vp:=lmt:=rsep:=lp:=suma3:=suma4:=suma5:=wynik3:=wynik4:=wynik5:=0;
   indtym:=KS.ndx_tmp('',1,'ROK',,0,'TYP',,0,'SALDO',,0,'SYM',,0);
   OKRESY.CZYOPOP:=OKRESY.CZYONAR:='N';
   OKRO_F.cntx_psh()
}
{END:
   VAR_DEL.delete('PRN','PRN2','PRNF','PRNH','w','ww','www'); &srw;
   &color; &prn1; &prn2; &pierwsza; &suma3; &suma4; &suma5; &wynik3; &wynik4; &wynik5;
   &lm; &ll; &vp; &lmt; &rsep; &lp; exec('end_msg','dok_fks_zest'); &indtym; KS.ndx_drop();
   OKRO_F.cntx_pop()
}
{IF: -SSTALE.AO().NAZ='bilans otwarcia'@}
{ FUN.info('Wydruku nie można wykonywać w okresie Bilans otwarcia.'@);~~}{EXIT}
{FI}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: ks_rzis.rpm
Utworzony:   ??-??-2007 [IF] Izabela Fialkowska
==================================================
Zawartosc: Skrocony rachunek wynikow
{COMMENT-}
{ OKRESY.win_edit('OKRODDO');
  OKRESY.ROK1:=SSTALE.AO().ROK; OKRESY.OKRES_OD:=OKRESY.OKRES_DO:=SSTALE.AO;~~}
{EXIT: ~OKRESY.edit("exec('okr_od_a','sprfin')")}
{ PRN.add("w[1]",5,'Lp.',1);
  {? rep_export() || PRN.add("w[6]",15,'Rodzaj'@) ?};
  PRN.add("w[2]",70,'Konto'@);
  {? OKRESY.CZYOPOP='T' || PRN.add("form(w[3],,2,' ,')",26,'Okres poprzedni'@,1) ?};
  PRN.add("form(w[4],,2,' ,')",26,'Okres bieżący'@,1);
  {? OKRESY.CZYONAR='T'
  || _data:={? SSTALE.AO().KON<>date(0,0,0)
            || $OKRO_F.KON
            || OKRO_F.index('ROK'); OKRO_F.prefix(ROK_F.ref());
               {? OKRO_F.prev() & OKRO_F.KON<>date(0,0,0) || $OKRO_F.KON || 'koniec okresu'@ ?}
            ?};
     PRN.add("form(w[5],,2,' ,')",26,'Stan na '+_data,1)
  ?};
  {? ~rep_export()
  || PRNF.add("ww[1]",76);
     {? OKRESY.CZYOPOP='T' || PRNF.add("form(ww[3],,2,' ,')",26,'Okres poprzedni'@,1) ?};
     PRNF.add("form(ww[4],,2,' ,')",26,'Okres bieżący'@,1);
     {? OKRESY.CZYONAR='T' || PRNF.add("form(ww[5],,2,' ,')",26,'Narastająco'@,1) ?};
     PRNH.add("www[1]",103+{? OKRESY.CZYOPOP='T' || 27 ?} +{? OKRESY.CZYONAR='T' || 27 ?})
  || PRN2.add("ww[1]",76,,,,,,,,,3);
     {? OKRESY.CZYOPOP='T' || PRN2.add("form(ww[3],,2,' ,')",26,'Okres poprzedni'@,1) ?};
     PRN2.add("form(ww[4],,2,' ,')",26,'Okres bieżący'@,1);
     {? OKRESY.CZYONAR='T' || PRN2.add("form(ww[5],,2,' ,')",26,'Stan na '+_data,1) ?}
  ?};
  w[3]:=w[4]:=w[5]:=ww[3]:=ww[4]:=ww[5]:=0; www[1]:='';~~
}
{INCLUDE: wsp_pw.rpi}
{SPACE: 'C'}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: ~rep_export()}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}------------------------------MACRO-TABHEADX---------------{COMMENT-}
{MACRO: 'TABHEADX'}
{REP: PRN.fhbar(lmt)}
{ PRN.setcolor(color); PRN.ini_head();~~}
{WHILE: PRN.h_next()}
{DO}
   {REP: PRN.h_fmline(lmt)}
{OD}
{MACRO-}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{PAR_WYDR.TITLE:='SKRÓCONY RACHUNEK WYNIKÓW'@;~~}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: rep_export()}
{'PARAMETRY WYDRUKU: '@}
{{? WYDRUKI.ODD || 'Jednostka księgowa: %1'@[WYDRUKI.ODD().OD] || 'Jednostka księgowa: wszystkie jednostki księgowe'@ ?}}
{'Okres bieżący: od %1 %2 do %3 %4'@[OKRESY.OKRES_OD().NAZ
                                             ,SSTALE.AR().NAZ
                                       ,OKRESY.OKRES_DO().NAZ
                                             ,SSTALE.AR().NAZ]}
{{? OKRESY.CZYONAR='T' || 'Wartości narastająco: tak'@ || 'Wartości narastająco: nie'@ ?}}
{{? OKRESY.CZYOPOP='T' || 'Okres poprzedni: tak'@ || 'Okres poprzedni: nie'@ ?}}
{LINE: 1}
{ELSE}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<2 'PARAMETRY WYDRUKU: '@}
{<2 {? WYDRUKI.ODD || 'Jednostka księgowa: %1'@[WYDRUKI.ODD().OD] || 'Jednostka księgowa: wszystkie jednostki księgowe'@ ?}}
{<2 'Okres bieżący: od %1 %2 do %3 %4'@[OKRESY.OKRES_OD().NAZ
                                             ,SSTALE.AR().NAZ
                                       ,OKRESY.OKRES_DO().NAZ
                                             ,SSTALE.AR().NAZ]}
{<2 {? OKRESY.CZYONAR='T' || 'Wartości narastająco: tak'@ || 'Wartości narastająco: nie'@ ?}}
{<2 {? OKRESY.CZYOPOP='T' || 'Okres poprzedni: tak'@ || 'Okres poprzedni: nie'@ ?}}
{FI}
{FONT: 'T8GB'}
{SUBSTITUTE: 'TABHEADX'}{FONT: 'T8G'}{ vp:=1; ~~}
{COMMENT}------------------------------MACRO-LINIA------------------{COMMENT-}
{MACRO: 'LINIA'}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{REP: PRN.fline()}
{OD}
{MACRO-}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEADX'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{prn1:=prn2;~~}
{SUBSTITUTE: 'LINIAF'}{prn1:='PRN';~~}
{FOOTER-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: rep_export()}
{ rsep:=1;prn1:='PRN';prn2:='PRNH';~~}
{FOR: 'KS'}
{INDEX: indtym}
{PREFIX: SSTALE.AR,'BW','A'}
{DO}
{ w[6]:='KOSZTY';
  w[2]:=KS.SYM+' - '+KS.NAZ;
  w[3]:={? OKRESY.CZYOPOP='T'
        || F.Kw(KS.SYM,1,OKRESY.OKRES_OD().NR-1)-F.Km(KS.SYM,1,OKRESY.OKRES_OD().NR-1)
        || 0
        ?};
  w[4]:=F.Kw(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR)-F.Km(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR);
  w[5]:={? OKRESY.CZYONAR='T'
        || F.Kw(KS.SYM,1,OKRESY.OKRES_DO().NR)-F.Km(KS.SYM,1,OKRESY.OKRES_DO().NR)
        || 0
        ?};
  {? (1+KS.SYM='4' | 1+KS.SYM='7') & (3+KS.SYM)<>'490'
  || suma3+=w[3]; suma4+=w[4]; suma5+=w[5]; wynik3-=w[3]; wynik4-=w[4]; wynik5-=w[5]
  ?};
  {? w[3]<>0 | w[4]<>0 | w[5]<>0 || lp+=1; w[1]:=lp ?};
~~}
{rsep:=PAR_WYDR.RSEP; prn1:='PRN';~~}{IF: (w[3]<>0 | w[4]<>0 | w[5]<>0)<>0}{SUBSTITUTE: 'LINIA0'}{FI}
{OD}
{ rsep:=1; ~~}
{ suma:=0; rsep:=1; prn2:='PRNH';~~}
{ prn1:='PRN'; ww[2]:=0 ;suma3:=suma4:=suma5:=0;~~}
{FOR: 'KS'}
{INDEX: indtym}
{PREFIX: SSTALE.AR,'BW','P'}
{DO}
{ w[6]:='PRZYCHODY';
  w[2]:=KS.SYM+' - '+KS.NAZ;
  {? OKRESY.CZYOPOP='T'
  || w[3]:=F.Km(KS.SYM,1,OKRESY.OKRES_OD().NR-1)-F.Kw(KS.SYM,1,OKRESY.OKRES_OD().NR-1);
     suma3+=w[3]; wynik3+=w[3]
  || w[3]:=0
  ?};
  w[4]:=F.Km(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR)-F.Kw(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR);
  suma4+=w[4]; wynik4+=w[4];
  {? OKRESY.CZYONAR='T'
  || w[5]:=F.Km(KS.SYM,1,OKRESY.OKRES_DO().NR)-F.Kw(KS.SYM,1,OKRESY.OKRES_DO().NR);
     suma5+=w[5]; wynik5+=w[5]
  || w[5]:=0
  ?};
  {? w[3]<>0 | w[4]<>0 | w[5]<>0 || lp+=1; w[1]:=lp ?};
~~}
{ rsep:=PAR_WYDR.RSEP; prn1:='PRN';~~}{IF: (w[3]<>0 | w[4]<>0 | w[5]<>0)}{SUBSTITUTE: 'LINIA0'}{FI}
{OD}
{COMMENT}




{COMMENT-}
{ELSE}
{ www[1]:=11*' '+'KOSZTY'@; pierwsza:=1; rsep:=1;prn1:='PRN';prn2:='PRNH';~~}
{SUBSTITUTE: 'LINIA02'}
{FOR: 'KS'}
{INDEX: indtym}
{PREFIX: SSTALE.AR,'BW','A'}
{DO}
{ w[2]:=KS.SYM+' - '+KS.NAZ;
  w[3]:={? OKRESY.CZYOPOP='T'
        || F.Kw(KS.SYM,1,OKRESY.OKRES_OD().NR-1)-F.Km(KS.SYM,1,OKRESY.OKRES_OD().NR-1)
        || 0
        ?};
  w[4]:=F.Kw(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR)-F.Km(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR);
  w[5]:={? OKRESY.CZYONAR='T'
        || F.Kw(KS.SYM,1,OKRESY.OKRES_DO().NR)-F.Km(KS.SYM,1,OKRESY.OKRES_DO().NR)
        || 0
        ?};
  {? (1+KS.SYM='4' | 1+KS.SYM='7') & (3+KS.SYM)<>'490'
  || suma3+=w[3]; suma4+=w[4]; suma5+=w[5]; wynik3-=w[3]; wynik4-=w[4]; wynik5-=w[5]
  ?};
  {? w[3]<>0 | w[4]<>0 | w[5]<>0 || lp+=1; w[1]:=lp ?};
~~}
{IF: pierwsza=1 & (w[3]<>0 | w[4]<>0 | w[5]<>0)}{prn1:='PRNH';prn2:='PRN';~~}{SUBSTITUTE: 'LINIA02'}{pierwsza:=0;~~}
{ELSE}{rsep:=PAR_WYDR.RSEP; prn1:='PRN';~~}{IF: (w[3]<>0 | w[4]<>0 | w[5]<>0)<>0}{SUBSTITUTE: 'LINIA0'}{FI}
{FI}
{OD}
{ rsep:=1; ww[1]:=11*' '+'Razem koszty:'; ww[3]:=suma3; ww[4]:=suma4; ww[5]:=suma5;~~}
{IF: lineleft()=2 | lineleft()=1}{PAGE}{ vp:=1;~~}{FI}
{IF: pierwsza=0 | vp=1}
  { prn1:='PRN'; prn2:='PRNF'; ~~}{SUBSTITUTE: 'LINIA02'}
{ELSE}
  { prn1:='PRNH'; prn2:='PRNF';~~}{SUBSTITUTE: 'LINIA02'}
{FI}
{IF: lineleft()=2 | lineleft()=1}{PAGE}{prn1:='PRN';~~}{ELSE}{prn1:='PRNF';~~}{FI}
{ www[1]:='%1PRZYCHODY'@[11*' ']; pierwsza:=1; suma:=0; rsep:=1; prn2:='PRNH';~~}
{SUBSTITUTE: 'LINIA02'}
{ prn1:='PRN'; ww[2]:=0; suma3:=suma4:=suma5:=0;~~}
{FOR: 'KS'}
{INDEX: indtym}
{PREFIX: SSTALE.AR,'BW','P'}
{DO}
{ w[2]:=KS.SYM+' - '+KS.NAZ;
  {? OKRESY.CZYOPOP='T'
  || w[3]:=F.Km(KS.SYM,1,OKRESY.OKRES_OD().NR-1)-F.Kw(KS.SYM,1,OKRESY.OKRES_OD().NR-1);
     suma3+=w[3]; wynik3+=w[3]
  || w[3]:=0
  ?};
  w[4]:=F.Km(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR)-F.Kw(KS.SYM,OKRESY.OKRES_OD().NR,OKRESY.OKRES_DO().NR);
  suma4+=w[4]; wynik4+=w[4];
  {? OKRESY.CZYONAR='T'
  || w[5]:=F.Km(KS.SYM,1,OKRESY.OKRES_DO().NR)-F.Kw(KS.SYM,1,OKRESY.OKRES_DO().NR);
     suma5+=w[5]; wynik5+=w[5]
  || w[5]:=0
  ?};
  {? w[3]<>0 | w[4]<>0 | w[5]<>0 || lp+=1; w[1]:=lp ?};
~~}
{IF: pierwsza=1 & (w[3]<>0 | w[4]<>0 | w[5]<>0)}{ prn1:='PRNH'; prn2:='PRN';~~}{SUBSTITUTE: 'LINIA02'}{ pierwsza:=0;~~}
{ELSE}{ rsep:=PAR_WYDR.RSEP; prn1:='PRN';~~}{IF: (w[3]<>0 | w[4]<>0 | w[5]<>0)}{SUBSTITUTE: 'LINIA0'}{FI}
{FI}
{OD}
{ rsep:=1; ww[1]:='%1Razem przychody:'@[11*' '];ww[3]:=suma3; ww[4]:=suma4; ww[5]:=suma5;~~}
{FI}
{IF: rep_export()}
{ w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[6]:=''; ~~}
{SUBSTITUTE: 'LINIA'}
{SUBSTITUTE: 'LINIA'}
{ELSE}
{IF: lineleft()<>0 & lineleft<4}{PAGE}{ vp:=1;~~}{FI}
{IF: pierwsza=0 | vp=1}
  { prn1:='PRN';prn2:='PRNF';~~}{SUBSTITUTE: 'LINIA02'}
{ELSE}
  { prn1:='PRNH'; prn2:='PRNF';~~}{SUBSTITUTE: 'LINIA02'}
{FI}
{FI}
{COMMENT}------------------------------FOOTER-LAST------------------{COMMENT-}
{FOOTER}{FOOTER-}
{IF: rep_export()}
{ rsep:=1; ww[1]:='ZYSK / STRATA'@; ww[3]:=wynik3; ww[4]:=wynik4; ww[5]:=wynik5; prn1:=prn2:='PRNF';~~}
{ELSE}
{ rsep:=1; ww[1]:='%1 ZYSK/ STRATA'@[11*' ']; ww[3]:=wynik3; ww[4]:=wynik4; ww[5]:=wynik5; prn1:=prn2:='PRNF';~~}
{FI}
{SUBSTITUTE: 'LINIAFS'}
{IF: rep_export()}
{LINE:4}
{REP: PRN2.fhbar()}
{PRN2.ini_head()}
{WHILE: PRN2.h_next ()}{DO}{REP: PRN2.h_fmline()}{OD}
{REP: PRN2.fbar()}
{PRN2.ini_line()}
{WHILE: PRN2.next()}{DO}{REP: PRN2.fline()}{OD}
{REP: PRN2.flbar()}
{FI}