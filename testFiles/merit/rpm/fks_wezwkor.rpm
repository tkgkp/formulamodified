:!UTF-8
{TITLE:A.  Wezwanie do zapłaty - korespondencja seryjna}
{PRINTER: FINFO.W_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
   PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,1,1}
{BEGIN:
   VAR_DEL.delete('czy_szablon');
   exec('czytaj','#stalesys',,FINFO,'SLWAL');
   exec('czytaj','#stalesys',,XINFO,'SLJEZYK');
   new_poz:=0; ref_defw:=null; liczwal:=ilel:=0;
   czy_szablon:=exec('rep_set','rap_zew','FKS_KORROZ',1)='T';
   SLUAPPL.cntx_psh(); SLU.cntx_psh(); SLO.cntx_psh();
   SLU.prefix(); SLO.prefix(); SLUAPPL.prefix();
   {? XINFO.SLJEZYK<>null
   || XINFO.SLJEZYK();
      SER_KOR.JEZYK:={? SLO.find_key(SLU.ref(),'POL')
                     || SLO.ref()
                     || null
                     ?}
   ?}; PAR_WYDR.PAR15:=0;
   SER_KOR.WYB_WAL:={? SER_NAG.WAL=null || 2 || SER_KOR.WAL:=SER_NAG.WAL; 0 ?};
   SER_NAGS.cntx_psh(); SER_NAGS.win_sel('SERNAGWW');
   SER_NAG.cntx_psh(); SER_NAG.prefix(); wz_wyd:=''; exec('ind_pref','rozrach_kor'); l_wal:=0;
   color:=prn1:=prn2:='';  w:=obj_new(12); del_wal:=gen_wyd:=0; kon:=0;
   lm:=ll:=vp:=lmt:=wdt:=0; rsep:=1;
   head:=PAR_WYDR.HEAD;
   SLO.prefix; ROZNE.UT_DOK:=1;
   {? var_pres('ML',@)<=100 || ML:=obj_new(@.CLASS.MEMO) ?};
   wybor:=sumafakt:=sumawpl:=pierwszy:=sumapf:=nast:=kwp:=sumaods:=sumaods1:=sumaods2:=sumaods3:=0;
   tekst:=dokument:=''; licz_wal:=0;
   SLUAPPL.prefix(); SLU.prefix();
   FINFO.SLWAL().SLU();
   SLO.index('SL'); SLO.prefix(SLU.ref);
   {? SLO.first() || licz_wal:=SLO.size() ?};
   {? licz_wal
   || sumy:=obj_new(licz_wal);
      {! _i:=1..licz_wal
      |! sumy[_i]:=obj_new(5); sumy[_i][1]:=SLO.KOD; sumy[_i][2]:=sumy[_i][3]:=sumy[_i][4]:=sumy[_i][5]:=0;
         SLO.next()
      !}
   ?};
   SLUAPPL.cntx_pop(); SLU.cntx_pop(); SLO.cntx_pop(); licznik:=1; naz_str:='';
   ROZNE.UT_KOM:=1; tab_adr:=obj_new(38); licz:=licz1:=0; tab_adr1:=obj_new(17);
   {! _i:=1..21 |!  tab_adr[_i]:='' !}; tp:=date(0,0,0); kontosp:='';
   ind_spoz:=SER_POZ.ndx_tmp('',1,'REF','FIRMA',0,'REF',,0,'ODD','OD',0,'WAL','KOD',0,'DATA',,0,'SYM_ROK',,0,'KON',,0,'PRZEDPO',,0);
   SER_POZ.index(ind_spoz); SSTALE.cntx_psh();
   ODD.cntx_psh(); ODD.index('ODDZIALY'); ODD.prefix(REF.FIRMA); oddzial:=''; wyd_kor:=1; kontbank:=''
}
{END:
   SER_NAGS.cntx_pop(); SER_NAG.cntx_pop(); ODD.cntx_pop(); SSTALE.cntx_pop(); &wz_wyd; &new_poz; &ref_defw; &licz_wal; &ilel; &liczwal; &licznik;
   {? SER_KOR.WYB_WAL=1 & del_wal=1 || exec('del_wal','rozrach_kor') ?};  &kon; &tp;
   &l_wal; &gen_wyd; &del_wal; &color; &prn1; &prn2; &lm; &ll; &vp; &lmt; &rsep; &wdt;
   PAR_WYDR.HEAD:=head; &head; &wybor; &sumafakt; &sumawpl; &pierwszy; &sumapf; &nast; &kwp;
   &tekst; &dokument; &sumaods; &sumaods1; &sumaods2; &sumaods3;  &naz_str;
   &licz; &licz1; &ind_spoz; SER_POZ.ndx_drop(); &kontosp; &oddzial; &wyd_kor;
   VAR_DEL.delete('sumy','PRN','w','tab_adr','tab_adr1','kontbank','czy_szablon',{? ~(menu_txt()='Akceptuj' | menu_txt()='Rozpocznij' | menu_txt()='Załączniki') || 'ObjForMerge' ?})
}
{IF: var_press('ToPDF')<=0}
{EXIT: ~exec('par_j','rozrach')}
{  PAR_WYDR.win_edit('WEZWKOR'); PAR_WYDR.PAR1:=1; SSTALE.WAL:=SER_NAG.WAL; PAR_WYDR.TABAKR:=REF.INFO;
   RACHBANK.KB_1R:='';
   SKID_RBK.index('TAB'); SKID_RBK.prefix(null,REF.INFO,REF.INFO);
   {? SKID_RBK.first
   || _il:=1;
      {!
      |? {? SKID_RBK.WAL=SER_NAG.WAL & SKID_RBK.RD='T'|| _il:=0; RACHBANK.KB_1R:=SKID_RBK.N ?};
         _il & SKID_RBK.next()
      !}
   ?};
   RACHBANK.KB_1R_BE:='exec(\'set_kbr1\',\'rozrach_przel\')';
   RACHBANK.KB_1R_BD:='RACHBANK.KB_1R:=RB.get_rbtx(2,RACHBANK.KB_1R,\'\')';
   RACHBANK.KB_1R_AE:='exec(\'ae_kb\',\'rachunki\')';
   RACHBANK.KB_1R_F3:='exec(\'f3_vrbup\',\'rachunki\',\'RACHBANK\',\'KB_1R\',REF.INFO,0)';
 ~~}
{EXIT: ~PAR_WYDR.edit("
  {? SER_KOR.JEZYK=null
  || FUN.info('Nie wybrano języka.'); 'JEZYK'
  |? SER_KOR.JEZYK<>null & ~exec('sprwzwyd','rozrach','fks_wezw',SER_KOR.JEZYK().KOD,1)
  || 'JEZYK'
  || {? RACHBANK.KB_1R=''
     || FUN.info('Nie podano numeru konta bankowego.'@); 'KB_1R'
     || ''
     ?}
  ?}")}
{ELSE}
{  PAR_WYDR.PAR1:=1;
   {? var_press('ToPDF1')>0 || ROZNE.UT_DOK:=ToPDF1 ?};
   {? var_press('ToPDF2')>0 || PAR_WYDR.PAR15:=ToPDF2 ?};
   {? SER_NAG.KH().JEZYK || SER_KOR.JEZYK:=SER_NAG.KH().JEZYK ?};
   SSTALE.WAL:=SER_NAG.WAL;
   {? RACHBANK.KB_1R='' & var_pres('licz_gr')<=0
   || FUN.info('Brak domyślnego konta bankowego dla waluty %1.'@[SER_NAG.WAL().KOD])
   ?};
~~}
{EXIT: SER_KOR.JEZYK=null | ~exec('sprwzwyd','rozrach','fks_wezw',SER_KOR.JEZYK().KOD,0) | RACHBANK.KB_1R=''}
{FI}
{  {? PAR_WYDR.PAR1=1 || wybor:=1
   |? PAR_WYDR.PAR1=2 || wybor:=2
   |? PAR_WYDR.PAR1=3 || wybor:=3
   ?}; ~~}
{IF: wybor=3}
   { WYDRUKIN.win_edit({? kh_all || 'SER_NAG4' || 'SER_NAG5' ?});
     WYDRUKIN.hdr_edit('Wezwania do zapłaty - zakres');
     WYDRUKIN.SER_DEF:=WYDRUKIN.SER_DEF2:=SER_NAG.KOD;
     SER_DEF.win_dict('SERWZW'); KH.win_dict('WERHOME2');
     WYDRUKIN.DATAOD:=WYDRUKIN.DATADO:=date();
     WYDRUKIN.KH:=WYDRUKIN.KH2:=SER_NAG.KH;
     SER_KOR.ID_OD:=SER_KOR.ID_DO:=SER_NAG.ID;~~}
   {EXIT: ~WYDRUKIN.edit("{? SER_KOR.WYB_WAL=0 & SER_KOR.WAL=null
                          || FUN.info('Nie wybrano żadnej waluty.'@); 'WYB_WAL'
                          || ''
                          ?}")}
    {IF: SER_KOR.WYB_WAL=1}
     { exec('wyb_wal','rozrach_kor'); del_wal:=1;~~}
     {IF: l_wal=0}{ FUN.info('Nie wybrano żadnej waluty.'@);~~}{EXIT}{FI}
    {FI}
{FI}
{IF: czy_szablon}
   {IF: ROZNE.UT_KOM}
      {IF: wybor=1}
         {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
            {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJZ',,{? (menu_txt()='Akceptuj' | menu_txt()='Rozpocznij' | menu_txt()='Załączniki') || -4 ?},,,1);pierwszy:=1;~~}
         {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
            {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJJ',,,);pierwszy:=1;~~}
         {ELSE}
            {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPZZ',,{? (menu_txt()='Akceptuj' | menu_txt()='Załączniki') || -4 ?},,,1);pierwszy:=1;~~}
         {FI}
      {ELIF: wybor=2 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W'}
         {SELECT}
         {DO}
            {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJZ',,,);pierwszy:=1;~~}
            {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJJ',,,);pierwszy:=1;~~}
            {ELSE}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPZZ',,{? (menu_txt()='Akceptuj' | menu_txt()='Załączniki') || -4 ?},,,1);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=2 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {SELECT}
         {DO}
            {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJZ',,,);pierwszy:=1;~~}

            {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJJ',,,);pierwszy:=1;~~}
            {ELSE}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPZZ',,{? (menu_txt()='Akceptuj' | menu_txt()='Załączniki') || -4 ?},,,1);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=3 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W'}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
               (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
               {IF:  (~WYDRUKIN.SER_DEF  | (WYDRUKIN.SER_DEF  & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))  &
                        ( ~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
                        ( ~#WYDRUKIN.DATAOD  | (#WYDRUKIN.DATAOD  & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
                        ( ~#WYDRUKIN.DATADO  | (#WYDRUKIN.DATADO  & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
                        ( ~WYDRUKIN.KH  | (WYDRUKIN.KH  & SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))  &
                        ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 & SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD)) &
                        ( |SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD<=SER_NAG.ID)) &
                        ( |SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO>=SER_NAG.ID))
               }
                  {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJZ',,-4,,,1);pierwszy:=1;~~}
                  {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJJ',,-4,,,1);pierwszy:=1;~~}
                  {ELSE}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPZZ',,-4,,,1);pierwszy:=1;~~}
                  {FI}
               {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {ELIF: wybor=3 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
               {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD)) &
                     (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
                     (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
                     (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
                     (|SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD<=SER_NAG.ID)) &
                     (|SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO>=SER_NAG.ID))
               }
                  {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJZ',,-4,,,1);pierwszy:=1;~~}
                  {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPJJ',,-4,,,1);pierwszy:=1;~~}
                  {ELSE}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSPZZ',,-4,,,1);pierwszy:=1;~~}
                  {FI}
               {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {FI}
   {ELSE}
      {IF: wybor=1}
         {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
            {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJZ',,{? menu_txt()='Akceptuj' || -4 ?},,,1);pierwszy:=1;~~}
         {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
            {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJJ',,,);pierwszy:=1;~~}
         {ELSE}
            {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLZZ',,,);pierwszy:=1;~~}
         {FI}
      {ELIF: wybor=2 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W'}
         {SELECT}
         {DO}
            {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJZ',,,);pierwszy:=1;~~}
            {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJJ',,,);pierwszy:=1;~~}
            {ELSE}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLZZ',,,);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=2 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {SELECT}
         {DO}
            {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJZ',,,);pierwszy:=1;~~}
            {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJJ',,,);pierwszy:=1;~~}
            {ELSE}
               {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLZZ',,,);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=3 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W'}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
               (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
               {IF:  (~WYDRUKIN.SER_DEF  | (WYDRUKIN.SER_DEF  & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))  &
                        ( ~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
                        ( ~#WYDRUKIN.DATAOD  | (#WYDRUKIN.DATAOD  & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
                        ( ~#WYDRUKIN.DATADO  | (#WYDRUKIN.DATADO  & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
                        ( ~WYDRUKIN.KH  | (WYDRUKIN.KH  & SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))  &
                        ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 & SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD)) &
                        ( |SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD<=SER_NAG.ID)) &
                        ( |SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO>=SER_NAG.ID))
               }
                  {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJZ',,-4,,,1);pierwszy:=1;~~}
                  {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJJ',,-4,,,1);pierwszy:=1;~~}
                  {ELSE}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLZZ',,-4,,,1);pierwszy:=1;~~}
                  {FI}
               {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {ELIF: wybor=3 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
               {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD)) &
                     (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
                     (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
                     (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
                     (|SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD<=SER_NAG.ID)) &
                     (|SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO>=SER_NAG.ID))
               }
                  {IF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & ~PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJZ',,-4,,,1);pierwszy:=1;~~}
                  {ELIF: ROZNE.UT_DOK & SER_NAG.TTAB_ODS<>null & PAR_WYDR.PAR15}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLJJ',,-4,,,1);pierwszy:=1;~~}
                  {ELSE}
                     {SER_NAGS.SER_NAG();exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_WDZPDSLZZ',,-4,,,1);pierwszy:=1;~~}
                  {FI}
               {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {FI}
   {FI}
   {IF: ~pierwszy}
      {FUN.info('Brak danych spełniających zadane kryteria \nlub nie zdefiniowano poprawnie odpowiednich wzorców wydruków.'@);~~}
      {EXIT}
   {FI}
   {EXIT}
{FI}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: wsp_lic.rpi}
{INCLUDE: fks_kor_head.rpi}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}
{>{charleft()} XINFO.MIA+', '+$SER_NAG.DATA}
{SUBSTITUTE: 'HEAD'}{FONT: 'W8'}{SPACE: 'C'}
{LINE: 3}
{HEADER-}
{IF: _a:=PAR_SKID.get(34); _a='Z' | _a='A'}
{FOOTER}
{SUBSTITUTE: 'FOOT_LIC'}
{~~}
{~~}
{~~}
{~~}
{FONT: '@'}{SPACE: '@'}{>{charleft()} naz_str+$page}
{FOOTER-}
{ELSE}
{FOOTER}
{FONT: '@'}{SPACE: '@'}{>{charleft()} naz_str+$page}
{FOOTER-}
{FI}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{IF: wybor=1}
   { {? var_press('ToPDF')<=0 || SER_NAGS.SER_NAG() ?}; new_poz:=0;~~}{REP: '{INCLUDE: '+wz_wyd+'.rpi}'}{ pierwszy:=1;~~}
{ELIF: wybor=2 & ROZRACH.KONTR=null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'SER_NAG'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W'}
   {SELECT}
   {DO}
      {SER_NAGS.SER_NAG();~~}
      {IF: pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
      {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
      { pierwszy:=1; ~~}
   {OD}
{ELIF: wybor=2 & ROZRACH.KONTR<>null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'TYPKH'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
   {SELECT}
   {DO}
      {SER_NAGS.SER_NAG();~~}
      {IF: pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
      {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
      { pierwszy:=1; ~~}
   {OD}
{ELIF: wybor=3 & ROZRACH.KONTR=null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'SER_NAG'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W'}
   {DO}
      {SER_NAGS.SER_NAG();~~}
      {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
          (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
      {IF:  ( ~WYDRUKIN.SER_DEF  | (WYDRUKIN.SER_DEF  & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))  &
            ( ~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
            ( ~#WYDRUKIN.DATAOD  | (#WYDRUKIN.DATAOD  & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
            ( ~#WYDRUKIN.DATADO  | (#WYDRUKIN.DATADO  & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
            ( ~WYDRUKIN.KH  | (WYDRUKIN.KH  & SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))  &
            ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 & SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD)) &
            ( |SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD<=SER_NAG.ID)) &
            ( |SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO>=SER_NAG.ID))
      }
         {IF: pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
         {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
         { pierwszy:=1; ~~}
      {FI}
      {FI}
   {OD}
{ELIF: wybor=3 & ROZRACH.KONTR<>null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'TYPKH'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'W',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
   {DO}
      {SER_NAGS.SER_NAG();~~}
      {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
          (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
      {IF:  ( ~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD)) &
            ( ~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
            ( ~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
            ( ~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
            ( |SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD<=SER_NAG.ID)) &
            ( |SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO>=SER_NAG.ID))

      }
         {IF: pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
         {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
         { pierwszy:=1; ~~}
      {FI}
      {FI}
   {OD}
{FI}
{IF: ~pierwszy}
{ FUN.info('Brak danych spełniających zadane kryteria \nlub nie zdefiniowano poprawnie odpowiednich wzorców wydruków.'@);~~}
{EXIT}
{FI}