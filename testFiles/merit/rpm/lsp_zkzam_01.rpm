:!UTF-8
{TITLE:A. Wydruk zamówienia}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','v'),,,,,'Q','C',,,,,,1,
   10,10,10,10,0,1}
{BEGIN:
   {? exec('czy_grp_dr','faktury_wydruk')
   || __GRP_DR.WZ:='lsp_zkzam_01'
   ?};
   POLA.NAZ_WYDR:='Zamowienie klienta '+exec('str_to_pth','#string',ZK_N.SYM)+'.pdf';
   zkzam_01:="
      VAR_DEL.delete('PRN','PRNS','NAG','w','s','k','p','na','szer','head','PAGELANG','NOMAXP','ns');
      VAR_DEL.delete('dokl','ddokl','doklw');
      VAR_DEL.delete('color','prn1','prn2');
      VAR_DEL.delete('lm','ll','vp','lmt','rsep');
      VAR_DEL.delete('il_lin','dokl','doklw','cdokl','lp');
      VAR_DEL.delete('zakoncz','proforma');
      VAR_DEL.delete('oddzial');
      VAR_DEL.delete('byl','wsk');
      VAR_DEL.delete('M_GD','S_GD');
      VAR_DEL.delete('zero_na','print5','op_1','op_2','op_3','op_4');
      VAR_DEL.delete('max_T8','max_T8G','max_T10B');
      VAR_DEL.delete('wyjscie','ilwar','wal','ilk');
      VAR_DEL.delete('__tab_sel');
      VAR_DEL.delete('color_oo','color_bw','color_bg','color_gw','color_wo','color_ww','color_frame_g','color_frame_w','color_gg','color_glg','color_g','color_w','color_wg','color_dgg');
      VAR_DEL.delete('zkn_date_head','zkn_date_val');
      VAR_DEL.delete('__empty_char')
      ";
   zkzam_01();
   exec('czytaj','#stalesys',,XINFO); KSTE.get();

   color_oo:='245:120:10,245:120:10';
   color_bw:='0:0:0,255:255:255';
   color_bg:='0:0:0,247:247:247';
   color_gw:='102:102:102,255:255:255';
   color_wo:='255:255:255,245:120:10';
   color_ww:='255:255:255,255:255:255';
   color_frame:='\'204:204:204\'';
   color_frame_g:='204:204:204';
   color_frame_w:='255:255:255';
   color_gg:='102:102:102,247:247:247';
   color_glg:='196:196:196,247:247:247';
   color_g:='247:247:247';
   color_w:='255:255:255';
   color_wg:='255:255:255,114:114:114';
   color_dgg:='114:114:114,114:114:114';

   __empty_char:={? exec('get','#params', 100236, 2)='N' || ^160 || ' ' ?};

   ilk:=10;
   PRN:=obj_new(@.CLASS.PRINT,ilk,__empty_char*3,'  ' ,'  ', '───' ,'  ' ,'──','─',' ');
   PRN.framecol(color_frame_g);
   PRNS:=obj_new(@.CLASS.PRINT,2,__empty_char*3,'  ' ,'  ', '───' ,'  ' ,'──','─',' ');
   PRNS.framecol(color_frame_g);
   NAG:=obj_new(@.CLASS.PRINT,2,__empty_char*3,'  ' ,'  ', '───' ,'  ' ,'──','─',' ');
   NAG.framecol(color_frame_g);
   w:=obj_new(ilk);  {! _i..ilk |! w[_i]:='' !}; "--wartosci kolumn--";
   s:=obj_new(1); "--razem--";
   k:=obj_new(ilk);  {! _i..ilk |! k[_i]:=0  !}; "--szerokosc kolumn--";
   p:=obj_new(ilk);  {! _i..ilk |! p[_i]:='' !}; "--tymczasowa do szacowania szerokosci kolumn--";
   dokl:=3; "--dokladnosc ilosci--";
   ddokl:=0; "--najwieksza drukowana dokladnosc ilosci--";
   doklw:=2; "--dokladnosc wartosc--";
   cdokl:=0; "--najwieksza drukowana dokladnosc ceny--";

   color:=prn1:=prn2:='';
   lm:=ll:=vp:=lmt:=rsep:=0;
   il_lin:=0;
   zakoncz:=1;
   oddzial:=KSTE.NAZ<>'';
   byl:=wsk:=0;
   proforma:=0;
   ns:=0;

   ilwar:=2;
   wal:=0;
   head:=PAR_WYDR.HEAD;
   PAR_WYDR.HEAD:=0;
   PARAM_W.JEZYK:=0;

   _wydr_naz:='zkzam_01';
   _wydr_edi:='ZKZAM_01';

   WYDRUKIL.index('WYDRUKI');
   WYDRUKIL.prefix(OPERATOR.USER().KOD,_wydr_naz);
   {? ~WYDRUKIL.first()
   || WYDRUKIL.blank();
      WYDRUKIL.USERS:=OPERATOR.USER().KOD;
      WYDRUKIL.WYDRUK:=_wydr_naz;
      WYDRUKIL.add()
   ?};
   {? WYDRUKIL.CHKBOX01
   || {? WYDRUKIL.CHKBOX01=1 & ZK_N.WAL=exec('bl_nwal','ustawienia') || WYDRUKIL.CHKBOX01:=0 ?}
   || WYDRUKIL.CHKBOX01:=ZK_N.WAL<>INFO.NAROD
   ?};
   {? exec('upr_cs','ceny')=0 || WYDRUKIL.RADIOB_1:=1 ?};
   PARAM_W.JEZYK:=WYDRUKIL.JEZYK;
   _djezyk:={? ZK_N.KH<>null() || exec('kh_jezyk','tlumaczenia',ZK_N.KH) || null() ?};
   PARAM_W.JEZYK:={? _djezyk || _djezyk || WYDRUKIL.JEZYK ?};
   PARAM_W.JEZYK_KH:={? _djezyk & _djezyk=PARAM_W.JEZYK || 'T' || 'N' ?};
   wyjscie:=1;
   WYDRUKIL.win_edit(_wydr_edi);
   {? exec('upr_cs','ceny')=0 | exec('noparam','param_wydr','S')=1 | WYDRUKIL.edit()
   || {? PARAM_W.JEZYK_KH='T' & _djezyk || PARAM_W.JEZYK:=_djezyk ?};
      WYDRUKIL.JEZYK:=PARAM_W.JEZYK;
      NOMAXP:=1;
      {? PARAM_W.JEZYK<>null() & PARAM_W.JEZYK().KOD<>'POL'
      || PAGELANG:=1;
         SKID.LANG_SLO:=PARAM_W.JEZYK
      || PAGELANG:=0;
         SKID.LANG_SLO:=null()
      ?};
      {? WYDRUKIL.put()
      || wyjscie:=0;
         ilwar:=WYDRUKIL.RADIOB_1>1;
         wal:=WYDRUKIL.RADIOB_1=3 & ZK_N.WAL<>exec('bl_nwal','ustawienia')
      ?}
   ?};
   ZK_P.cntx_psh;
~~}
{END:
   ZK_P.cntx_pop;
   PAR_WYDR.HEAD:=head;
   zkzam_01(); VAR_DEL.delete('zkzam_01')
;~~}
{EXIT: wyjscie=1}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: wsp_lic.rpi}
{INCLUDE: wsp_strony_new.rpi}
{IF:ZK_N.sel_size()>0 & __GRP_DR.PDF=0}
   {
        ZK_N.cntx_psh();
      __tab_sel:=ZK_N.sel_aget()
   ;~~}
{FOR: __tab_sel}
   {DO}
      {IF: ZK_N.seek(__tab_sel.REF,)}
      {
      VAR_DEL.delete('PRN','PRNS','NAG','w','s','k','p');
      ilk:=10;
      PRN:=obj_new(@.CLASS.PRINT,ilk,__empty_char*3,'  ' ,'  ', '───' ,'  ' ,'──','─',' ');
      PRN.framecol(color_frame_g);
      PRNS:=obj_new(@.CLASS.PRINT,2,__empty_char*3,'  ' ,'  ', '───' ,'  ' ,'──','─',' ');
      PRNS.framecol(color_frame_g);
      NAG:=obj_new(@.CLASS.PRINT,2,__empty_char*3,'  ' ,'  ', '───' ,'  ' ,'──','─',' ');
      NAG.framecol(color_frame_g);
      w:=obj_new(ilk);  {! _i..ilk |! w[_i]:='' !}; "--wartosci kolumn--";
      s:=obj_new(1); "--razem--";
      k:=obj_new(ilk);  {! _i..ilk |! k[_i]:=0  !}; "--szerokosc kolumn--";
      p:=obj_new(ilk);  {! _i..ilk |! p[_i]:='' !}; "--tymczasowa do szacowania szerokosci kolumn--";
      zakoncz:=1;
      ~~}
         {INCLUDE: lsp_zkzam_01.rpi}
         {IF: lineleft()>0}{PAGE}{ns:=1;page(1);~~}{FI}
      {FI}
   {OD}
   {
      ZK_N.cntx_pop()
   ;~~}
{ELSE}
   {INCLUDE: lsp_zkzam_01.rpi}
{FI}