:!UTF-8
{TITLE:Karta Przekazania odpadu 2020}
{PRINTER: exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1,'A4 landscape'}
{BEGIN:
    {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
    split:=w1:=w2:=w3:='';
    x1:=x2:=x3:=z1:=z2:=z3:=z4:=z5:=0;
    type:=0;
    adres1:=adres2:=adres3:='';
    kh1:=kh2:=kh3:='';
    _params:=WYDRUKIL.mk_edit('Parametry drukowania'@,,'kpo_print_par');
    WYDRUKIL.win_efld(_params,WYDRUKIL,'RADIOB_1',,,,,,'Zakres wydruku'@,,,'radio-buttons',,'Karta bieżąca'@,"1",'Karty wybrane'@,"0");
    WYDRUKIL.win_efld(_params,AH,'H',,,,,,'');
    WYDRUKIL.win_efld(_params,WYDRUKIL,'RADIOB_2',,,,,,'Nazwy kontrahentów'@,,,'radio-buttons',,'Stosuj nazwy pełne'@,"1",'Stosuj nazwy skrócone'@,"0");
    WYDRUKIL.RADIOB_1:=1;
    WYDRUKIL.RADIOB_2:=1;
    exec('ok_esc','#window',WYDRUKIL,_params);
    WYDRUKIL.win_edit(_params);
    WYDRUKIL.edit();
    KPO.cntx_psh();
    KPO.win_sel('WER');
~~}
{END:
    {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
    &split;&w1;&w2;&w3;&type;&x1;&x2;&x3;&adres1;&adres2;&adres3;&z1;&z2;&z3;&z4;&z5;&kh1;&kh2;&kh3;
    KPO.cntx_pop();
~~}
{COMMENT}------------------------------wydruk------------------------{COMMENT-}
{MACRO: 'drukuj'}
   {IF: KPO.TYP=exec('typ_kpo','odpady')}
      {GRAPHIC: 'kpo.pdf'; 1; 8; 8; 8; 8 }
      {type:=1;x1:=54;x2:=148;x3:=251;z1:=103;z2:=92;z3:=90;z4:=51;z5:=43;~~}
      {ELIF: KPO.TYP=exec('typ_kpok_tra','odpady')}
      {GRAPHIC: 'kpok_tra.pdf'; 1; 8; 8; 8; 8 }
      {type:=2;x1:=54;x2:=148;x3:=251;z1:=96;z2:=92;z3:=90;z4:=45;z5:=43;~~}
      {ELIF: KPO.TYP=exec('typ_kpok_rec','odpady')}
      {GRAPHIC: 'kpok_rec.pdf'; 1; 8; 8; 8; 8 }
      {type:=3;x1:=37;x2:=148;x3:=248;z1:=94;z2:=94;z3:=90;z4:=50;z5:=44;~~}
   {FI}
   {GRAPHICFONT: 'Arial'; 8; ''; '0:0:0'}
   {GRAPHICTEXT: KPO.SYM; x1;{? type=1 || 9.1 |? type=2 || 10 || 11.7  ?};40 }
   {GRAPHICTEXT: KPO.KPO_STAT().NAZ;  x2;{? type=1 || 9.1 |? type=2 || 10 || 11.7 ?};35 }
   {GRAPHICTEXT: $KPO.AR; x3;{? type=1 || 9.1 |? type=2 || 10 || 11.7 ?};30 }
   { {? WYDRUKIL.RADIOB_2
     || kh1:=KPO.KH().NAZ_P;
        kh2:=KPO.KH_2().NAZ_P;
        kh3:=KPO.KH_3().NAZ_P
     || kh1:=KPO.KH().NAZ;
        kh2:=KPO.KH_2().NAZ;
        kh3:=KPO.KH_3().NAZ
     ?};
     ~~}
   {IF: type=3 & +kh1>75}
      { split:=exec('podziel_string_x','#string',kh1,(+kh1/2));
        {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
        tab_split:=spli_str(split,'\n');
        w1:=tab_split[1];
        w2:=tab_split[2];
        ~~}
      {GRAPHICTEXT: w1; {? type<>3 || 3 || 4 ?}; 28.2;z1 }
      {GRAPHICTEXT: w2; {? type<>3 || 3 || 4 ?}; 31.2;z1 }
      {ELSE}
      {GRAPHICTEXT: kh1; {? type<>3 || 3 || 4 ?};{? type=1 || 20.7 |? type=2 || 23.7 || 29.7 ?};z1 }
   {FI}
   {IF: +kh3>75}
      { split:=exec('podziel_string_x','#string',kh3,(+kh3/2));
        {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
        tab_split:=spli_str(split,'\n');
        w1:=tab_split[1];
        w2:=tab_split[2];
        ~~}
      {GRAPHICTEXT: w1;  {? type=1 || 109 || 101 ?};{? type=1 || 37.2 |? type=2 || 26.5 || 27.5 ?};z3 }
      {GRAPHICTEXT: w2;  {? type=1 || 109 || 101 ?};{? type=1 || 40.2 |? type=2 || 29.5 || 30.5 ?};z3 }
      {ELSE}
      {GRAPHICTEXT: kh3;  {? type=1 || 109 || 101 ?};{? type=1 || 38.7 |? type=2 || 28 || 29 ?};z3 }
   {FI}
   {GRAPHICTEXT: kh2; {? type<>3 || 202 || 198 ?};{? type=1 || 20.7 |? type=2 || 23.7 || 24.7 ?};z2 }
   { adres1:=KPO.KH().MIASTO+' '+KPO.KH().UL+{? +KPO.KH().KPOCZ>0 || ', '+KPO.KH().KPOCZ || '' ?};
     adres2:=KPO.KH_2().MIASTO+' '+KPO.KH_2().UL+{? +KPO.KH_2().KPOCZ>0 || ', '+KPO.KH_2().KPOCZ || '' ?};
     adres3:=KPO.KH_3().MIASTO+' '+KPO.KH_3().UL+{? +KPO.KH_3().KPOCZ>0 || ', '+KPO.KH_3().KPOCZ || '' ?};
     ~~}
   {IF: type<>3}
      {GRAPHICTEXT: adres1; {? type<>3 || 3 || 4 ?};{? type=1 || 29.7 |? type=2 || 32.5 ?};z1 }
   {ELSE}
      {IF: +adres1>60}
         { split:=exec('podziel_string_x','#string',adres1,(+adres1/2));
           {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
           tab_split:=spli_str(split,'\n');
           w1:=tab_split[1];
           w2:=tab_split[2];
           ~~}
         {GRAPHICTEXT: w1;4;49.7 ;z1 }
         {GRAPHICTEXT: w2; 4; 53.7 ;z1 }
         {ELSE}
         {GRAPHICTEXT: adres1;4;51.2 ;z1 }
      {FI}
   {FI}
   {IF: +adres3>60}
      { split:=exec('podziel_string_x','#string',adres3,(+adres3/2));
        {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
        tab_split:=spli_str(split,'\n');
        w1:=tab_split[1];
        w2:=tab_split[2];
        ~~}
      {GRAPHICTEXT: w1; {? type=1 || 109 || 101 ?};{? type=1 || 75.7 |? type=2 || 51.2 || 49.7 ?};z3 }
      {GRAPHICTEXT: w2; {? type=1 || 109 || 101 ?};{? type=1 || 79.7 |? type=2 || 55.2 || 53.7 ?};z3 }
      {ELSE}
      {GRAPHICTEXT: adres3; {? type=1 || 109 || 101 ?};{? type=1 || 77.7 |? type=2 || 53.2 || 51.7 ?};z3 }
   {FI}
   {IF: type=1}
      {IF: +adres2>60}
         {  split:=exec('podziel_string_x','#string',adres2,(+adres2/2));
           {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
           tab_split:=spli_str(split,'\n');
           w1:=tab_split[1];
           w2:=tab_split[2];
           ~~}
         {GRAPHICTEXT: w1;202;41.7;z2 }
         {GRAPHICTEXT: w2;202;46  ;z2 }
         {ELSE}
         {GRAPHICTEXT: adres2;202;43.8;z2 }
      {FI}
   {ELSE}
      {GRAPHICTEXT: adres2; {? type<>3 || 202 || 198 ?};{? type<>3 || 32.5 || 34.5 ?};z2 }
   {FI}
   { adres1:=KPO.KH_ODB().MIASTO+' '+KPO.KH_ODB().UL+{? +KPO.KH_ODB().KPOCZ>0 || ', '+KPO.KH_ODB().KPOCZ || '' ?};
     adres2:=KPO.KH_ODB_2().MIASTO+' '+KPO.KH_ODB_2().UL+{? +KPO.KH_ODB_2().KPOCZ>0 || ', '+KPO.KH_ODB_2().KPOCZ || '' ?};
     ~~}
   {IF: type<>3}
      {GRAPHICTEXT: KPO.KH_MPD; x1;{? type=1 || 68 |? type=2 || 43.5 ?};z4 }
      {IF: +KPO.KH_ODB().NAZ>75}
         { split:=exec('podziel_string_x','#string',KPO.KH_ODB().NAZ,(+KPO.KH_ODB().NAZ/2));
           {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
           tab_split:=spli_str(split,'\n');
           w1:=tab_split[1];
           w2:=tab_split[2];
           ~~}
         {GRAPHICTEXT: w1; x1;{? type=1 || 74.5 |? type=2 || 50 ?};z4}
         {GRAPHICTEXT: w2; x1;{? type=1 || 77.5 |? type=2 || 53 ?};z4}
      {ELSE}
         {GRAPHICTEXT: KPO.KH_ODB().NAZ; x1;{? type=1 || 76 |? type=2 || 51.5 ?};z4 }
      {FI}
      {IF: +adres1>60}
         { split:=exec('podziel_string_x','#string',adres1,(+adres1/2));
           {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
           tab_split:=spli_str(split,'\n');
           w1:=tab_split[1];
           w2:=tab_split[2];
          ~~}
         {GRAPHICTEXT: w1; x1;{? type=1 || 82.5 |? type=2 || 58.5 ?};z4 }
         {GRAPHICTEXT: w2; x1;{? type=1 || 85.5 |? type=2 || 61.5 ?};z4 }
         {ELSE}
         {GRAPHICTEXT: adres1; x1;{? type=1 || 84 |? type=2 || 60 ?};z4 }
      {FI}
   {FI}
   {GRAPHICTEXT: KPO.KH_2_MPD; x3;{? type=1 || 68 |? type=2 || 43.5 || 45 ?};z5 }
   {IF: +KPO.KH_ODB_2().NAZ>75}
      { split:=exec('podziel_string_x','#string',KPO.KH_ODB_2().NAZ,(+KPO.KH_ODB_2().NAZ/2));
        {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
        tab_split:=spli_str(split,'\n');
        w1:=tab_split[1];
        w2:=tab_split[2];
        ~~}
      {GRAPHICTEXT: w1; x3;{? type=1 || 74.5 |? type=2 || 50 || 51.5 ?};z5 }
      {GRAPHICTEXT: w2; x3;{? type=1 || 77.5 |? type=2 || 53 || 54.5 ?};z5 }
      {ELSE}
      {GRAPHICTEXT: KPO.KH_ODB_2().NAZ; x3;{? type=1 || 76 |? type=2 || 51.5 || 53 ?};z5 }
   {FI}
   {IF: +adres2>60}
      { split:=exec('podziel_string_x','#string',adres2,(+adres2/2));
        {? var_pres('tab_split')>=100 || obj_del(tab_split) ?};
        tab_split:=spli_str(split,'\n');
        w1:=tab_split[1];
        w2:=tab_split[2];
        ~~}
      {GRAPHICTEXT: w1; x3;{? type=1 || 82.5 |? type=2 || 58.5 || 59 ?};z5 }
      {GRAPHICTEXT: w2; x3;{? type=1 || 85.5 |? type=2 || 61.5 || 62 ?};z5 }
      {ELSE}
      {GRAPHICTEXT: adres2; x3;{? type=1 || 84 |? type=2 || 60 || 60.5 ?};z5 }
   {FI}
   {GRAPHICTEXT: KPO.KH().NRREJDBO; x1;{? type=1 || 90  || 66.5 ?};50 }
   {GRAPHICTEXT: KPO.KH().NIP; x1;{? type=1 || 94.5 || 71 ?};50 }
   {GRAPHICTEXT: exec('FindInSet','#table','NIPY','SNIP',KPO.KH,,"NIPY.SNIP",,,''); x1;{? type=1 || 99 || 75.5 ?};50 }
   {GRAPHICTEXT: KPO.KH_3().NRREJDBO; x2;{? type=1 || 90 || 66.5 ?};40 }
   {GRAPHICTEXT: KPO.KH_3().NIP; x2;{? type=1 || 94.5  || 71 ?};40 }
   {GRAPHICTEXT: exec('FindInSet','#table','NIPY','SNIP',KPO.KH_3,,"NIPY.SNIP",,,''); x2;{? type=1 || 99 || 75.5 ?};40 }
   {GRAPHICTEXT: KPO.KH_2().NRREJDBO; x3;{? type=1 || 90 || 66.5 ?};40 }
   {GRAPHICTEXT: KPO.KH_2().NIP; x3;{? type=1 || 94.5  || 71 ?};40 }
   {GRAPHICTEXT: exec('FindInSet','#table','NIPY','SNIP',KPO.KH_2,,"NIPY.SNIP",,,''); x3;{? type=1 || 99  || 75.5 ?};40 }
   {IF: type=1}
      {GRAPHICTEXT: KPO.ODPR().KOD+{? +KPO.ODPR().KOD>0 & +KPO.ODPR().NAZ>0 || ' - ' || '' ?}+KPO.ODPR().NAZ; 81;109; 210 }
   {ELSE}
      {GRAPHICTEXT: KPO.NAZ_G; x1;84.4;80 }
      {GRAPHICTEXT: KPO.OB_G; {? type<>3 || 202 || 198 ?};84.4;80 }
   {FI}
   {GRAPHICTEXT: KPO.ODP().KOD+{? +KPO.ODP().KOD>0 & +KPO.ODP().NAZ>0 || ' - ' || '' ?}+KPO.ODP().NAZ; {? type<>3 || 81 || 69 ?};{? type=1 || 118.7 || 88.7 ?};210 }
   {GRAPHICTEXT: form(KPO.IL,,4);  {? type<>3 || 81 || 69 ?};{? type=1 || 132.5 |? type=2 || 92.7 || 93.2 ?};210 }
   {GRAPHICTEXT: KPO.NRREJ;  {? type<>3 || 81 || 101 ?};{? type=1 || 142.5 || 117.7 ?};210 }
   {IF: type<>3}
      { _date:=KPO.DTR$1;
        w3:=gsub(_date,'/','-');
        w1:=KPO.GTR$1;
        ~~}
      {GRAPHICTEXT: w3;3;{? type=1 || 152.5 |? type=2 || 128.3 ?};30 }
      {GRAPHICTEXT: w1;75;{? type=1 || 152.5 |? type=2 || 128.3 ?};30 }
   {FI}
   {GRAPHIC-}
{MACRO-}
{IF: WYDRUKIL.RADIOB_1=0 & KPO.OB='N'}
   {FOR: KPO}
      {INDEX: 'R'}
      {PREFIX: 'K','N'}
      {SELECT: 'K'}
   {DO}
      {SUBSTITUTE: 'drukuj'}
   {OD}
{ELIF: WYDRUKIL.RADIOB_1=0 & KPO.OB='T'}
{FOR: KPO}
   {INDEX: 'R'}
   {PREFIX: 'K','T'}
   {SELECT: 'K'}
{DO}
   {SUBSTITUTE: 'drukuj'}
{OD}
{ELSE}
   {SUBSTITUTE: 'drukuj'}
{FI}