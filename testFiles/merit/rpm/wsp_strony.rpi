:!UTF-8
{MACRO: 'stronyf'}
{COMMENT}   ustalenie maksymalnych szerokosci strony dla fontow      {COMMENT-}
{
exec('czytaj','#stalesys',__STRDAT,XINFO,INFO); KSTE.get;
strony:="
   VAR_DEL.delete('zero_na','szer','print5');
   VAR_DEL.delete('op_1','op_2','op_3','op_4');
   VAR_DEL.delete('oddzial');
   VAR_DEL.delete('__dane1','__dane2','__dane3','__dane4','__ul','__ur','__dl','__dr')
   ";
strony()
;~~}
{SPACE: exec('space','param_wydr')}
{FONT: exec('font','param_wydr','strony')}{max_T10B:=charleft;~~}
{
__dane1:=obj_new(20); {! _ii:=1..obj_len(__dane1)|! __dane1[_ii]:='' !};
__dane2:=obj_new(20); {! _ii:=1..obj_len(__dane2)|! __dane2[_ii]:='' !};
__dane3:=obj_new(20); {! _ii:=1..obj_len(__dane3)|! __dane3[_ii]:='' !};
__dane4:=obj_new(20); {! _ii:=1..obj_len(__dane4)|! __dane4[_ii]:='' !};

__ul:=__dane1;
__ur:=__dane3;
__dl:=__dane2;
__dr:=__dane4;

op_1:=op_2:=op_3:=op_4:='';

print5:="
   prn1:='PRN5';
   op_1:=op_2:=op_3:=op_4:='';
   VAR_DEL.delete('PRN5');
   PRN5:=obj_new(@.CLASS.PRINT,5);
   PRN5.n_frame();
   PRN5.add($('form('''',)'),_a,'',1);
   PRN5.add($('form(op_1,)'),_b,'');
   PRN5.add($('form(op_2,)'),_c,'',1);
   PRN5.add($('form(op_3,)'),_d,'');
   PRN5.add($('form(op_4,)'),_e,'',1)
";

szer:=obj_new(5);
szer[1]:=1;
szer[3]:=3;
szer[4]:=1;
szer[5]:=
   {? exec('get','#params',300250,2)<>''
      & (__STRTAB='ND' & ND.TYP().Z='T' | __STRTAB='FAKS' | __STRTAB='ZK_N' | __STRTAB='OFE')
   || 3
   || 1
   ?};
szer[2]:=(max_T10B-(szer[1]+szer[3]+szer[5]+16))/2$0;
print5(szer[1],szer[2],szer[3],szer[4],szer[5]);
szer[4]+=charleft-PRN5.width();
print5(szer[1],szer[2],szer[3],szer[4],szer[5]);
vp:=0;
lmt:=0;
~~}
{COMMENT}   DATA WYSTAIENIA, SPRZEDAZY, ZWROTU                       {COMMENT-}
{FONT: exec('font','param_wydr','daty')}
{IF: __STRTAB='FAKS' & FAKS.SZ='S'}
   {IF: FAKS.KZ=''}
      {<1}{>{charleft}exec('tr','tlumaczenia','1000110')+' '+form(FAKS.DW)}
   {FI}
   {IF: FAKS.WHERE='K'}
      {LINE: 2}
   {FI}
   {IF: FAKS.WHERE<>'K'}
      {<1}{>{charleft}{? FAKS.T().HIS='T'
                      || exec('tr','tlumaczenia','1000112')+' '
                      || _txt_ds:=
                           {? FAKS.WHERE='L'
                           || {? FAKS.DO_NA_DR<>date(0,0,0) || '1000111' || '' ?}
                           |? PAR_SKID.get(308)='T' & FAKS.DW>=date(2014,1,1)
                           || {? FAKS.DO_NA_DR<>date(0,0,0)
                              || exec('kod_aktualny','tlumaczenia','1000112')
                              |? FAKS.T().KOR='T' & exec('FindAndGet','#table',FAKS,FAKS.FKSQL,,"D",date(2014,1,1))<date(2014,1,1)
                              || '1000112'
                              || ''
                              ?}
                           || exec('kod_aktualny','tlumaczenia','1000112')
                           ?};
                         exec('tr','tlumaczenia',_txt_ds)+' ' ?}+
         {? FAKS.WHERE<>'L'
               |
            FAKS.T().HIS<>'T' & PAR_SKID.get(308)='T' & FAKS.DW>=date(2014,1,1)
         || {? FAKS.DO_NA_DR<>date(0,0,0)
            || {? PARAM_W.MC='T'
               || {? PARAM_W.JEZYK=null || form(FAKS.DO_NA_DR,,8) || 7+form(FAKS.DO_NA_DR,,1) ?}
               || form(FAKS.DO_NA_DR,,1)
               ?}
            |? FAKS.T().KOR='T' & exec('FindAndGet','#table',FAKS,FAKS.FKSQL,,"D",date(2014,1,1))<date(2014,1,1)
            || {? PARAM_W.MC='T'
               || {? PARAM_W.JEZYK=null || form(FAKS.D,,8) || 7+form(FAKS.D,,1) ?}
               || form(FAKS.D,,1)
               ?}
            || ''
            ?}
         || {? PARAM_W.MC='T'
            || {? PARAM_W.JEZYK=null || form(FAKS.D,,8) || 7+form(FAKS.D,,1) ?}
            || form(FAKS.D,,1)
            ?}
         ?}}
   {FI}
   {IF: FAKS.WHERE<>'K' & FAKS.KZ=''}
      {<1}{>{charleft}{? FAKS.T().KOR='N'
                         | FAKS.T().KOR='T' & FAKS.DZ=date(0,0,0) & exec('czy_zwrot','faktury_nag',FAKS.ref())='N'
                      || ''
                      || exec('tr','tlumaczenia','1000153')+' '+form(FAKS.DZ)
                      ?}}
   {FI}
{ELIF: __STRTAB='ZK_N' & proforma=1}
   {<1}{>{charleft}exec('tr','tlumaczenia','1000110')+' '+form(ZK_N.DP)}
   {LINE: 2}
{ELIF: __STRTAB='FAKS' & FAKS.SZ='Z'}
   {<1}{>{charleft}exec('tr','tlumaczenia','1000110')+' '+form(FAKS.DW)}
   {<1}{>{charleft}
      _txt_ds:={? FAKS.WHERE='L' || '1000111' || exec('kod_aktualny','tlumaczenia','1000112') ?};
      exec('tr','tlumaczenia',_txt_ds)+' '+
      {? PARAM_W.MC='T'
      || {?  PARAM_W.JEZYK=null || form(FAKS.D,,8) || 7+form(FAKS.D,,1) ?}
      || form(FAKS.D,,1)
      ?}}
   {LINE}
{ELIF: __STRTAB='REK_N'}
   {<1}{>{charleft}exec('tr','tlumaczenia','1000110')+' '+form(REK_N.DP)}
   {LINE: 2}
{FI}
{COMMENT}   LICENCJOBIORCA                                           {COMMENT-}
{
{? exec('get','#params',100227,2)='T' || _kpocz:=3; _ul:=4 || _kpocz:=4; _ul:=3 ?};
{? __STRTAB='ND'
|| {? ND.TYP().P='N' | ND.TYP().DN='K'
   || __dane3[1]:=exec('tr','tlumaczenia','5000027'); "--Sprzedawca--"
   || __dane3[1]:=exec('tr','tlumaczenia','5000028'); "--Nabywca--"
   ?}
||
   {? __STRTAB='ZD_NAG'
   || __dane3[1]:=exec('tr','tlumaczenia','6000107'); "--Zamawiający--"
   |? __STRTAB='REK_N'
   || {? REK_N.SZ='S'
      || __dane3[1]:=exec('tr','tlumaczenia','5000027'); "--Sprzedawca--"
      || __dane3[1]:='Reklamujący:'; "--Reklamujący--"
      ?}
   |? __STRTAB='OPAK_N'
   || {? OPAK_N.PLUS='T'
      || __dane3[1]:='Przyjmujący:'
      || __dane3[1]:='Wydający:'
      ?}
   || {? __STRTAB='FAKS' & FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
      || __dane3[1]:=exec('tr','tlumaczenia','1000107'); "--Sprzedawca--"
      || __dane3[1]:=exec('tr','tlumaczenia','1000120'); "--Nabywca--"
      ?}
   ?}
?};
KSTE.index('KST'); KSTE.prefix();
{? KSTE.first() & +KSTE.NAZ || oddzial:=1 || oddzial:=0 ?};
{? oddzial
|| __dane3[2]:=KSTE.NAZ;
   __dane3[_kpocz]:=exec('kpocz','faktury_wydruk',KSTE.KOD_P,KSTE.POCZ,KSTE.MIA,KSTE.UL);
   __dane3[_ul]:=exec('adr','faktury_wydruk',KSTE.UL,KSTE.NR_D,KSTE.NR_L,KSTE.MIA,KSTE.POCZ);
   __dane3[6]:={? +KSTE.TEL || exec('tr','tlumaczenia','1000106')+' '+KSTE.TEL || '' ?}; "--tel:--";
   __dane3[12]:=KSTE.KRAJ().TR
|| __dane3[2]:=XINFO.NAZ;
   __dane3[_kpocz]:=exec('kpocz','faktury_wydruk',XINFO.KOD_P,XINFO.POCZ,XINFO.MIA,XINFO.UL);
   __dane3[_ul]:=exec('adr','faktury_wydruk',XINFO.UL,XINFO.NR_D,XINFO.NR_L,XINFO.MIA,XINFO.POCZ);
   __dane3[6]:={? +XINFO.TEL || exec('tr','tlumaczenia','1000106')+' '+XINFO.TEL || '' ?}; "--tel:--";
   __dane3[12]:=XINFO.KRAJ().NAZ
?};
_nip_ue:='';
{? exec('get','#params',100231)='T'
   | __STRTAB='FAKS' & {? exec('get','#params',100221,2)='T' || FAKS.T().UE='T' || FAKS.NIP_UE<>'' ?}
   | __STRTAB='ND' & {? exec('get','#params',100221,2)='T' || ND.TYP().UE='T' || ND.NIP_UE<>'' ?}
   | __STRTAB='ZK_N' & {? exec('get','#params',100221,2)='T' || 0 || ZK_N.NIP_UE<>'' ?}
|| NIPY.index('SNIP_F');NIPY.prefix(REF.S_FIRMA);
   {? NIPY.find_key('PL') || _nip_ue:=form(NIPY.KRAJ().KOD+' '+NIPY.NIP) ?}
?};
__dane3[5]:=
   {? _nip_ue<>''
   || exec('tr','tlumaczenia','1000113')+' '+_nip_ue
   || exec('tr','tlumaczenia','1000108')+' '+form(XINFO.NIP)
   ?}; "--NIP--";
{? __STRTAB='FAKS' & FAKS.SZ='S'
||
   {? exec('rbkvat_drukuj','faktury_wydruk')
   ||
      __dane3[7]:='';
      __dane3[8]:='';
      __dane3[9]:='';
      __dane3[10]:='';
      __dane3[11]:='';
      __dane3[14]:='';
      __dane3[15]:=''
   ||
      __dane3[7]:={?  +FAKS.NB || exec('tr','tlumaczenia','1000109') ?};
      __dane3[8]:=FAKS.NB; "--Numer rachunku--";
      __dane3[9]:=exec('rb_prefix','faktury_wydruk')+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO);
      __dane3[10]:='';
      __dane3[11]:='';
      {? (FAKS.T().EXPORT='T' | FAKS.T().UE='T' )
      || __dane3[11]:=exec('tr','tlumaczenia','1000114')+' '+FAKS.SKID_RBK().BANK().SWIFT
      || __dane3[10]:=FAKS.SKID_RBK().BANK().SWIFT
      ?};
      {? exec('get','#params',100228,2)='T'
      ||
         __dane3[14]:=FAKS.SKID_RBK().BANK().UL;
         _kod:=FAKS.SKID_RBK().BANK().K;
         __dane3[15]:={? _kod='' || '' || _kod+' '?}+FAKS.SKID_RBK().BANK().M
      ?}
   ?}
?};
{? __STRTAB='ZK_N' & proforma=1
||
   __dane3[7]:={? +bank1 || exec('tr','tlumaczenia','1000109') || '' ?}; "--Numer rachunku--";
   __dane3[8]:=bank1;
   __dane3[9]:=bank2;
   __dane3[10]:=bank3;
   __dane3[14]:=bank4;
   __dane3[15]:=bank5
?};
__dane3[13]:=
   {? KST.BDO=''
   || ''
   || _tr:=exec('tr','tlumaczenia','1000216');
      {? _tr='' || '' || _tr+' '?}+KST.BDO
   ?};
~~}
{COMMENT}   KONTRAHENT, ODBIORCA                                     {COMMENT-}
{
{? exec('get','#params',100227,2)='T' || _kpocz:=3; _ul:=4 || _kpocz:=4; _ul:=3 ?};
{? exec('get','#params',100222,2)='T'
||
   {? __STRTAB='FAKS' & FAKS.KH_ODB().ROZ_NAL='T'
   || FAKS.KH_ODB().KH_LNK()
   || ($(__STRTAB+'.KH()'))()
   ?};

   _ak:=exec('tr','tlumaczenia','1000159');  "--Adres korespondencyjny--";
   _id:=KH.LOTUSUID;
   _adr:=exec('adrK','wzorce'); _plug:=0; _nf:=''; _fn:=''; _dom:=''; _lokal:='';
   {? __STRTAB='FAKS' & Plugin.run('ADRES_KORESP_001',FAKS.KH,FAKS.KH_ODB,_adr)
   || _nf:=_adr.NAZ_P; _kp:=_adr.KPOCZ; _po:=_adr.POCZ; _mi:=_adr.MIASTO; _um:=_adr.UL; _kr:=_adr.KRAJ; _plug:=1
   |? __STRTAB='FAKS' & +FAKS.NAZ  & FAKS.KH_ODB().ROZ_NAL='N'
   || _nf:=FAKS.NAZ; _kr:=FAKS.KH_KRAJ; _fn:=KH.NAZ
   || _fn:=KH.NAZ; _kr:=KH.KRAJ
   ?};
   {? ~_plug
   || OS_ADRES.cntx_psh();
      OS_ADRES.index('RODZAJ1'); OS_ADRES.prefix(KH.ref(),'H');
      SKID.AD_KOR:={? OS_ADRES.find_le(date()) & (OS_ADRES.DO=date(0,0,0) | OS_ADRES.DO>=date()) || OS_ADRES.ref() || null() ?};
      OS_ADRES.cntx_pop();
      {? SKID.AD_KOR().KOD<>'' & SKID.AD_KOR().MIASTO<>'' & SKID.AD_KOR().ULICA<>''
      || _kp:=SKID.AD_KOR().KOD; _po:=SKID.AD_KOR().POCZTA; _mi:=SKID.AD_KOR().MIASTO;
         _um:=SKID.AD_KOR().ULICA+' '+SKID.AD_KOR().DOM+{? SKID.AD_KOR().LOKAL='' || '' || '/'+SKID.AD_KOR().LOKAL ?};
         {? SKID.AD_KOR().NAZ_P<>'' || _nf:=SKID.AD_KOR().NAZ_P ?}; _kr:=SKID.AD_KOR().KRAJ().NAZ
      |? _nf<>''
      || _kp:=''; _po:=FAKS.POCZ; _mi:=FAKS.MIASTO; _um:=FAKS.UL; _dom:=FAKS.DOM; _lokal:=FAKS.LOKAL
      || _kp:=KH.KPOCZ; _po:=KH.POCZ; _mi:=KH.MIASTO; _um:=KH.UL; _dom:=KH.DOM; _lokal:=KH.LOKAL
      ?}
   ?};
   obj_del(_adr);
   __dane1[1]:=_ak;
   __dane1[2]:={? _nf<>'' || _nf || exec('kontrahent_naz_lotusuid','abstore_fun',_fn,_id) ?};
   __dane1[_kpocz]:=exec('kpocz','faktury_wydruk',_kp,_po,_mi,_um);
   __dane1[_ul]:=exec('adr','faktury_wydruk',_um,_dom,_lokal,_mi,_po);
   __dane1[12]:=_kr;

   {? __STRTAB='ND'
   || {? ND.TYP().P='N' | ND.TYP().DN='K'
      || __dane2[1]:=exec('tr','tlumaczenia','5000028'); "--Nabywca--"
      || __dane2[1]:=exec('tr','tlumaczenia','5000027'); "--Sprzedawca--"
      ?}
   || {? __STRTAB='ZD_NAG'
      || __dane2[1]:=exec('tr','tlumaczenia','6000106'); "--Dostawca--"
      |? __STRTAB='REK_N'
      || {? REK_N.SZ='S'
         || __dane2[1]:='Reklamujący:'; "--Reklamujący--"
         || __dane2[1]:=exec('tr','tlumaczenia','6000106'); "--Dostawca--"
         ?}
      |? __STRTAB='OPAK_N'
      || __dane2[1]:='Kontrahent:'
      || {? __STRTAB='FAKS' & FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
         || __dane2[1]:=exec('tr','tlumaczenia','1000120'); "--Nabywca--"
         || __dane2[1]:=exec('tr','tlumaczenia','1000107'); "--Sprzedawca--"
         ?}
      ?}
   ?};
   {? __STRTAB='FAKS' & +FAKS.NAZ
   ||
      __dane2[1]+=' '+FAKS.KH().KOD;
      __dane2[2]:=exec('kontrahent_naz_lotusuid','abstore_fun',FAKS.NAZ,KH.LOTUSUID);
      __dane2[_kpocz]:=exec('kpocz','faktury_wydruk',FAKS.KPOCZ,FAKS.POCZ,FAKS.MIASTO,FAKS.UL);
      __dane2[_ul]:=exec('adr','faktury_wydruk',FAKS.UL,FAKS.DOM,FAKS.LOKAL,FAKS.MIASTO,FAKS.POCZ);
      __dane2[12]:=FAKS.KH_KRAJ
   ||
      ($(__STRTAB+'.KH()'))();
      __dane2[1]+=' '+KH.KOD;
      __dane2[2]:=exec('kontrahent_naz_lotusuid','abstore_fun',KH.NAZ_P,KH.LOTUSUID);
      __dane2[_kpocz]:=exec('kpocz','faktury_wydruk',KH.KPOCZ,KH.POCZ,KH.MIASTO,KH.UL);
      __dane2[_ul]:=exec('adr','faktury_wydruk',KH.UL,KH.DOM,KH.LOKAL,KH.MIASTO,KH.POCZ);
      __dane2[12]:=KH.KRAJ
   ?};
   FAKS.cntx_psh;
   {? __STRTAB='ND' & ND.FAKS || FAKS.use(ref_name(ND.FAKS)) ?};
   {? (KH.TYP='I' | KH.TYP='R') & KH.PESEL<>'' & WYDRUKIL.WYDRUK<>'zak_rr' & WYDRUKIL.WYDRUK<>'kor_rr'
   || __dane1[5]:=''
   |? __STRTAB='FAKS'
    & {? exec('get','#params',100221,2)='T'
      || FAKS.T().UE='T' | FAKS.NDVAT='O' & FAKS.NIP_UE<>''
      || FAKS.NIP_UE<>''
      ?}
   || __dane2[5]:=exec('tr','tlumaczenia','1000113')+' '+FAKS.NIP_UE; "--NIP UE--"
   |? __STRTAB='ND'
    & {? exec('get','#params',100221,2)='T'
      || ND.TYP().UE='T'  | ND.FAKS_REF<>'' & ND.FAKS().NDVAT='O' & ND.NIP_UE<>''
      || ND.NIP_UE<>''
      ?}
   || __dane2[5]:=exec('tr','tlumaczenia','1000113')+' '+ND.NIP_UE; "--NIP UE--"
   |? __STRTAB='ZK_N' & ZK_N.NIP_UE<>''
   || __dane2[5]:=exec('tr','tlumaczenia','1000113')+' '+ZK_N.NIP_UE; "--NIP UE--"
   || _nipfld:={? __STRTAB='FAKS' || '.NIP' || '.KH().NIP' ?};
      {? +($(__STRTAB+_nipfld))()
      || __dane2[5]:=exec('tr','tlumaczenia','1000108')+' '+($(__STRTAB+_nipfld))(); "--NIP--"
      || ''
      ?}
   ?};
   FAKS.cntx_pop;
   {? __STRTAB='FAKS' & FAKS.SZ='Z'
   ||
      __dane2[7]:={? +FAKS.NB || exec('tr','tlumaczenia','1000109') || '' ?}; "--Numer rachunku--";
      __dane2[8]:=FAKS.NB;
      __dane2[9]:=exec('rb_prefix','faktury_wydruk')+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO)
   ?};
   {? __STRODB<>'' & ($__STRODB)()<>null
   ||
      ($(__STRODB+'()'))();
      {? __STRTAB='FAKS'  & FAKS.SZ='Z'
      || __dane4[1]:=exec('tr','tlumaczenia','6000118')+' '+KH_ODB.KOD; "--Wystawca faktury:--"
      || __dane4[1]:=exec('tr','tlumaczenia','1000119')+' '+KH_ODB.KOD; "--Odbiorca--"
      ?};
      {? __STRTAB='FAKS'
      ||
         __dane4[2]:=FAKS.O_NAZ;
         __dane4[_kpocz]:=exec('kpocz','faktury_wydruk',FAKS.O_KPOCZ,FAKS.O_POCZ,FAKS.O_MIASTO,FAKS.O_UL);
         __dane4[_ul]:=exec('adr','faktury_wydruk',FAKS.O_UL,FAKS.O_DOM,FAKS.O_LOKAL,FAKS.O_MIASTO,FAKS.O_POCZ);
         __dane4[5]:={? +FAKS.O_NIP || exec('tr','tlumaczenia','1000108')+' '+FAKS.O_NIP || '' ?}; "--NIP--";
         __dane4[12]:=FAKS.O_KRAJ
      ||
         __dane4[2]:=KH_ODB.NAZ;
         __dane4[_kpocz]:=exec('kpocz','faktury_wydruk',KH_ODB.KPOCZ,KH_ODB.POCZ,KH_ODB.MIASTO,KH_ODB.UL);
         __dane4[_ul]:=exec('adr','faktury_wydruk',KH_ODB.UL,KH_ODB.DOM,KH_ODB.LOKAL,KH_ODB.MIASTO,KH_ODB.POCZ);
         __dane4[5]:={? +KH_ODB.NIP || exec('tr','tlumaczenia','1000108')+' '+KH_ODB.NIP || '' ?}; "--NIP--";
         __dane4[12]:=KH_ODB.KRAJ
      ?}
   |? __STRTAB='FAKS' & (WYDRUKIL.WYDRUK='zak_rr' | WYDRUKIL.WYDRUK='kor_rr')
   ||
      __dane4[1]:=exec('tr','tlumaczenia','1000107')+' '+FAKS.KH().KOD; "--Sprzedawca--";
      __dane4[3]:='PESEL: '+KH.PESEL;
      __dane4[4]:='';
      __dane4[5]:='';
      __dane4[6]:='';
      __dane4[7]:=''
   ?}
?}
;~~
}
{
{? exec('get','#params',100227,2)='T' || _kpocz:=3; _ul:=4 || _kpocz:=4; _ul:=3 ?};
{? exec('get','#params',100222,2)='N'
||
   {? __STRTAB='ND'
   || {? ND.TYP().P='N' | ND.TYP().DN='K'
      || __dane1[1]:=exec('tr','tlumaczenia','5000028'); "--Nabywca--"
      || __dane1[1]:=exec('tr','tlumaczenia','5000027'); "--Sprzedawca--"
      ?}
   || {? __STRTAB='ZD_NAG'
      || __dane1[1]:=exec('tr','tlumaczenia','6000106'); "--Dostawca--"
      |? __STRTAB='REK_N'
      || {? REK_N.SZ='S'
         || __dane1[1]:='Reklamujący:'; "--Reklamujący--"
         || __dane1[1]:=exec('tr','tlumaczenia','6000106'); "--Dostawca--"
         ?}
      |? __STRTAB='OPAK_N'
      || __dane1[1]:='Kontrahent:'
      || {? __STRTAB='FAKS' & FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
         || __dane1[1]:=exec('tr','tlumaczenia','1000120'); "--Nabywca--"
         || __dane1[1]:=exec('tr','tlumaczenia','1000107'); "--Sprzedawca--"
         ?}
      ?}
   ?};
   {? __STRTAB='FAKS' & +FAKS.NAZ
   ||
      __dane1[1]+=' '+FAKS.KH().KOD;
      __dane1[2]:=exec('kontrahent_naz_lotusuid','abstore_fun',FAKS.NAZ,KH.LOTUSUID);
      __dane1[_kpocz]:=exec('kpocz','faktury_wydruk',FAKS.KPOCZ,FAKS.POCZ,FAKS.MIASTO,FAKS.UL);
      __dane1[_ul]:=exec('adr','faktury_wydruk',FAKS.UL,FAKS.DOM,FAKS.LOKAL,FAKS.MIASTO,FAKS.POCZ);
      __dane1[12]:=FAKS.KH_KRAJ
   ||
      ($(__STRTAB+'.KH()'))();
      __dane1[1]+=' '+KH.KOD;
      __dane1[2]:=exec('kontrahent_naz_lotusuid','abstore_fun',KH.NAZ_P,KH.LOTUSUID);
      __dane1[_kpocz]:=exec('kpocz','faktury_wydruk',KH.KPOCZ,KH.POCZ,KH.MIASTO,KH.UL);
      __dane1[_ul]:=exec('adr','faktury_wydruk',KH.UL,KH.DOM,KH.LOKAL,KH.MIASTO,KH.POCZ);
      __dane1[12]:=KH.KRAJ
   ?};
   FAKS.cntx_psh;
   {? __STRTAB='ND' & ND.FAKS || FAKS.use(ref_name(ND.FAKS)) ?};
   {? __STRTAB='FAKS'
    & {? exec('get','#params',100221,2)='T'
      || FAKS.T().UE='T' | FAKS.NDVAT='O' & FAKS.NIP_UE<>''
      || FAKS.NIP_UE<>''
      ?}
   || __dane1[5]:=exec('tr','tlumaczenia','1000113')+' '+FAKS.NIP_UE; "--NIP UE--"
   |? __STRTAB='ND'
    & {? exec('get','#params',100221,2)='T'
      || ND.TYP().UE='T'  | ND.FAKS_REF<>'' & ND.FAKS().NDVAT='O' & ND.NIP_UE<>''
      || ND.NIP_UE<>''
      ?}
   || __dane1[5]:=exec('tr','tlumaczenia','1000113')+' '+ND.NIP_UE; "--NIP UE--"
   |? __STRTAB='ZK_N' & ZK_N.NIP_UE<>''
   || __dane1[5]:=exec('tr','tlumaczenia','1000113')+' '+ZK_N.NIP_UE; "--NIP UE--"
   || _nipfld:={? __STRTAB='FAKS' || '.NIP' || '.KH().NIP' ?};
      {? +($(__STRTAB+_nipfld))()
      || __dane1[5]:=exec('tr','tlumaczenia','1000108')+' '+($(__STRTAB+_nipfld))(); "--NIP--"
      || ''
      ?}
   ?};
   FAKS.cntx_pop;
   {? __STRTAB='FAKS' & FAKS.SZ='Z'
   ||
      __dane1[7]:={? +FAKS.NB || exec('tr','tlumaczenia','1000109') || '' ?}; "--Numer rachunku--";
      __dane1[8]:=FAKS.NB;
      __dane1[9]:=
         {? {? exec('get','#params',100221,2)='T' || FAKS.T().UE='T' || FAKS.NIP_UE<>'' ?}
         || FAKS.SKID_RBK().BANK().KODISO().KODISO+' '
         || ''
         ?}+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO)
   ?};
   {? __STRODB<>'' & ($__STRODB)()<>null
   ||
      ($(__STRODB+'()'))();
      {? __STRTAB='FAKS'  & FAKS.SZ='Z'
      || __dane2[1]:=exec('tr','tlumaczenia','6000118')+' '+KH_ODB.KOD; "--Wystawca faktury:--"
      || __dane2[1]:=exec('tr','tlumaczenia','1000119')+' '+KH_ODB.KOD; "--Odbiorca--"
      ?};
      {? __STRTAB='FAKS'
      ||
         __dane2[2]:=FAKS.O_NAZ;
         __dane2[_kpocz]:=exec('kpocz','faktury_wydruk',FAKS.O_KPOCZ,FAKS.O_POCZ,FAKS.O_MIASTO,FAKS.O_UL);
         __dane2[_ul]:=exec('adr','faktury_wydruk',FAKS.O_UL,FAKS.O_DOM,FAKS.O_LOKAL,FAKS.O_MIASTO,FAKS.O_POCZ);
         __dane2[5]:={? +FAKS.O_NIP || exec('tr','tlumaczenia','1000108')+' '+FAKS.O_NIP || '' ?}; "--NIP--";
         __dane2[12]:=FAKS.O_KRAJ
      ||
         __dane2[2]:=KH_ODB.NAZ;
         __dane2[_kpocz]:=exec('kpocz','faktury_wydruk',KH_ODB.KPOCZ,KH_ODB.POCZ,KH_ODB.MIASTO,KH_ODB.UL);
         __dane2[_ul]:=exec('adr','faktury_wydruk',KH_ODB.UL,KH_ODB.DOM,KH_ODB.LOKAL,KH_ODB.MIASTO,KH_ODB.POCZ);
         __dane2[5]:={? +KH_ODB.NIP || exec('tr','tlumaczenia','1000108')+' '+KH_ODB.NIP || '' ?}; "--NIP--";
         __dane2[12]:=KH_ODB.KRAJ
      ?}
   |? __STRTAB='FAKS' & (WYDRUKIL.WYDRUK='zak_rr' | WYDRUKIL.WYDRUK='kor_rr')
   ||
      __dane2[5]:='PESEL: '+KH.PESEL;
      __dane2[6]:=''; "--Nazwa dowodu tożsamości:--";
      __dane2[7]:='';    "--Seria i numer DT:--";
      __dane2[8]:='';  "--Wydany przez:--";
      __dane2[9]:='';"--Data wydania:--"
   ?}
?}
;~~
}
{
op_1:=op3:='';
{? __STRTAB='FAKS' & FAKS.SZ='S' & __wydrfa.uproszcz
||
   __ul[2]:=__ul[3]:=__ul[4]:=''
?}
;~~}
{FONT: exec('font','param_wydr','strony')}
{IF: lineleft()-(62+18)>0}{LINE: lineleft()-(62+18)}{FI}
{FONT: exec('font','param_wydr','strony_s1_l01')}
{IF: exec('get','#params',300250,2)<>''
   & (__STRTAB='ND' & ND.TYP().Z='T' | __STRTAB='FAKS' | __STRTAB='ZK_N' | __STRTAB='OFE')}
   {<1}{>{charleft-15}}{IMAGE: barcode('QRCode',exec('get','#params',300250,2));15}
   {LINE:2}
{FI}
{COMMENT}   LINIA 1: __ul,__ur;   100222='N'                      {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Sprzedaż: Nabywca/Sprzedawca    {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Zakup: Sprzedawca/Nabywca       {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   100222='T'                                  {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Sprzedaż: Adres korespondencyjny/Sprzedawca {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Zakup: Adres korespondencyjny/Nabywca       {COMMENT-}
{seller_first:=
{? exec('get','#params',100229)='T'
&
((__ul[1]*exec('tr','tlumaczenia','1000120')& __ur[1]*exec('tr','tlumaczenia','1000107'))
|
(__ul[1]*exec('tr','tlumaczenia','1000159')& __ur[1]*exec('tr','tlumaczenia','1000107')))
|| 1
|| 0
?}
;~~}
{IF: +__ul[1] | +__ur[1]} {{? seller_first || op_1:=__ur[1]; op_3:=__ul[1] || op_1:=__ul[1]; op_3:=__ur[1] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{LINE}
{COMMENT}   LINIA 2: __ul,__ur;   Nazwa                            {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l02')}
{IF: +__ul[2] | +__ur[2]} {{? seller_first || op_1:=__ur[2]; op_3:=__ul[2] || op_1:=__ul[2]; op_3:=__ur[2] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 3: __ul,__ur;   KOD, MIASTO                      {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l03')}
{IF: +__ul[3] | +__ur[3]} {{? seller_first || op_1:=__ur[3]; op_3:=__ul[3] || op_1:=__ul[3]; op_3:=__ur[3] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 4: __ul,__ur;   UL .KDP                          {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l04')}
{IF: +__ul[4] | +__ur[4]} {{? seller_first || op_1:=__ur[4]; op_3:=__ul[4] || op_1:=__ul[4]; op_3:=__ur[4] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 12: __ul,__ur;  KRAJ                             {COMMENT-}
{IF: exec('get','#params',100226,2)='T'}
{FONT: exec('font','param_wydr','strony_s1_l12')}
{IF: +__ul[12] | +__ur[12]} {{? seller_first || op_1:=__ur[12]; op_3:=__ul[12] || op_1:=__ul[12]; op_3:=__ur[12] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{FI}
{COMMENT}   LINIA 5: __ul,__ur;   TEL                              {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l05')}
{IF: +__ul[5] | +__ur[5]} {{? seller_first || op_1:=__ur[5]; op_3:=__ul[5] || op_1:=__ul[5]; op_3:=__ur[5] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 6: __ul,__ur;   NIPY                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l06')}
{IF: +__ul[6] | +__ur[6]} {{? seller_first || op_1:=__ur[6]; op_3:=__ul[6] || op_1:=__ul[6]; op_3:=__ur[6] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 13: __ul,__ur;   BDO                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l13')}
{IF: +__ul[13] | +__ur[13]} {{? seller_first || op_1:=__ur[13]; op_3:=__ul[13] || op_1:=__ul[13]; op_3:=__ur[13] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 7: __ul,__ur;   ETYKIETA RACHUNKU BANKOWEGO      {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l07')}
{IF: +__ul[7] | +__ur[7]} {{? seller_first || op_1:=__ur[7]; op_3:=__ul[7] || op_1:=__ul[7]; op_3:=__ur[7] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 8: __ul,__ur;   NAZWA BANKU                      {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l08')}
{IF: +__ul[8] | +__ur[8]} {{? seller_first || op_1:=__ur[8]; op_3:=__ul[8] || op_1:=__ul[8]; op_3:=__ur[8] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 9: __ul,__ur;   RACHUNEK BANKOWY                 {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l09')}
{IF: +__ul[9] | +__ur[9]} {{? seller_first || op_1:=__ur[9]; op_3:=__ul[9] || op_1:=__ul[9]; op_3:=__ur[9] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 10: __ul,__ur;   ...                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l10')}
{IF: +__ul[10] | +__ur[10]} {{? seller_first || op_1:=__ur[10]; op_3:=__ul[10] || op_1:=__ul[10]; op_3:=__ur[10] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 11: __ul,__ur;   ...                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l11')}
{IF: +__ul[11] | +__ur[11]} {{? seller_first || op_1:=__ur[11]; op_3:=__ul[11] || op_1:=__ul[11]; op_3:=__ur[11] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 14: __ul,__ur;   ...                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l14')}
{IF: +__ul[14] | +__ur[14]} {{? seller_first || op_1:=__ur[14]; op_3:=__ul[14] || op_1:=__ul[14]; op_3:=__ur[14] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 15: __ul,__ur;   ...                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s1_l15')}
{IF: +__ul[15] | +__ur[15]} {{? seller_first || op_1:=__ur[15]; op_3:=__ul[15] || op_1:=__ul[15]; op_3:=__ur[15] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   odkreslenie                                              {COMMENT-}
{IF: lineleft()-62>0}{LINE: lineleft()-62}{FI}
{LINE}
{ op1:=op3:='';~~}
{COMMENT}   LINIA 1: __ul,__ur;   100222='N'                      {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Sprzedaż: Odbiorca/--           {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Zakup RR: RR/--                 {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   100222='T'                      {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Sprzedaż: Nabywca/Odbiorca      {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Zakup: Sprzedawca/--            {COMMENT-}
{COMMENT}   LINIA 1: __ul,__ur;   Zakup RR: Sprzedawca/RR         {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l01')}
{IF: +__dl[1] | +__dr[1]}   {{? seller_first || op_1:=__dr[1]; op_3:=__dl[1] || op_1:=__dl[1]; op_3:=__dr[1] ?};~~}    {SUBSTITUTE: 'LINIA0'}{FI}
{LINE}
{COMMENT}   LINIA 2: __dl,__dr;   Nazwa                            {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l02')}
{IF: +__dl[2] | +__dr[2]}   {{? seller_first || op_1:=__dr[2]; op_3:=__dl[2] || op_1:=__dl[2]; op_3:=__dr[2] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{FONT: exec('font','param_wydr','T10')}
{COMMENT}   LINIA 3: __dl,__dr;   KOD, MIASTO                      {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l03')}
{IF: +__dl[3] | +__dr[3]}   {{? seller_first || op_1:=__dr[3]; op_3:=__dl[3] || op_1:=__dl[3]; op_3:=__dr[3] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 4: __dl,__dr;   UL                               {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l04')}
{IF: +__dl[4] | +__dr[4]}   {{? seller_first || op_1:=__dr[4]; op_3:=__dl[4] || op_1:=__dl[4]; op_3:=__dr[4] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 12: __dl,__dr;  KRAJ                             {COMMENT-}
{IF: exec('get','#params',100226,2)='T'}
{FONT: exec('font','param_wydr','strony_s2_l12')}
{IF: +__dl[12] | +__dr[12]} {{? seller_first || op_1:=__dr[12]; op_3:=__dl[12] || op_1:=__dl[12]; op_3:=__dr[12] ?};~~}   {SUBSTITUTE: 'LINIA0'}{FI}
{FI}
{COMMENT}   LINIA 5: __dl,__dr;   TEL                              {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l05')}
{IF: +__dl[5] | +__dr[5]}   {{? seller_first || op_1:=__dr[5]; op_3:=__dl[5] || op_1:=__dl[5]; op_3:=__dr[5] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 6: __dl,__dr;   NIPY                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l06')}
{IF: +__dl[6] | +__dr[6]}   {{? seller_first || op_1:=__dr[6]; op_3:=__dl[6] || op_1:=__dl[6]; op_3:=__dr[6] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 7: __dl,__dr;   ETYKIETA RACHUNKU BANKOWEGO      {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l07')}
{IF: +__dl[7] | +__dr[7]}   {{? seller_first || op_1:=__dr[7]; op_3:=__dl[7] || op_1:=__dl[7]; op_3:=__dr[7] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 8: __dl,__dr;   NAZWA BANKU                      {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l08')}
{IF: +__dl[8] | +__dr[8]}   {{? seller_first || op_1:=__dr[8]; op_3:=__dl[8] || op_1:=__dl[8]; op_3:=__dr[8] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 9: __dl,__dr;   RACHUNEK BANKOWY                 {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l09')}
{IF: +__dl[9] | +__dr[9]}   {{? seller_first || op_1:=__dr[9]; op_3:=__dl[9] || op_1:=__dl[9]; op_3:=__dr[9] ?};~~}     {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 10: __dl,__dr;   ...                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l10')}
{IF: +__dl[10] | +__dr[10]}   {{? seller_first || op_1:=__dr[10]; op_3:=__dl[10] || op_1:=__dl[10]; op_3:=__dr[10] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{COMMENT}   LINIA 11: __dl,__dr;   ...                             {COMMENT-}
{FONT: exec('font','param_wydr','strony_s2_l11')}
{IF: +__dl[11] | +__dr[11]}   {{? seller_first || op_1:=__dr[11]; op_3:=__dl[11] || op_1:=__dl[11]; op_3:=__dr[11] ?};~~} {SUBSTITUTE: 'LINIA0'}{FI}
{VAR_DEL.delete('seller_first');~~}
{IF: __STRTAB<>'REK_N'}{LINE: 2}{FI}
{FONT: exec('font','param_wydr','T8G')}{max_T8G:=charleft;~~}
{FONT: exec('font','param_wydr','T10B')}{max_T10B:=charleft;~~}
{ exec('czytaj','#stalesys',,XINFO,INFO); KSTE.get; strony(); VAR_DEL.delete('strony');~~}
{MACRO-}
{MACRO: 'inf_dod'}
{COMMENT}   informacje dodatkowe na wydrukach      {COMMENT-}
{  {? var_pres('oo')>0  || obj_del(oo) ?};{? var_pres('oo')=0  || &oo ?};
   {? var_pres('OPIK')>0 || obj_del(OPIK) ?};{? var_pres('OPIK')=0 || &OPIK ?};
   _rozm:=(charleft-7-(S_GD.LK-1)*3)/S_GD.LK $0; oo:=obj_new(S_GD.LK); {! _i..S_GD.LK |! oo[_i]:='' !};
   OPIK:=obj_new(@.CLASS.PRINT,S_GD.LK);
   {! _i..S_GD.LK |! OPIK.add($('oo['+$_i+']'),_rozm,'') !};
   wsk:=0; prn1:='OPIK'; OPIK.n_frame(); byl:=0; rsep:=0;~~}
{FOR: M_GD}
{PREFIX: S_GD.GD}
{DO}
   {IF: S_GD.LK=M_GD.LK}
      { wsk+=1; oo[wsk]:=M_GD.OP; byl+=1;~~}
      {IF: wsk=S_GD.LK}
         {SUBSTITUTE: 'LINIA0'}
         {{! _i:=1..wsk |! oo[_i]:='' !};
          wsk:=0; ~~}
      {FI}
   {FI}
{OD}
{IF: byl & wsk & wsk<S_GD.LK}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{ obj_del(OPIK); obj_del(oo); ~~}
{MACRO-}
{COMMENT}   MACRO - prn_txt                                          {COMMENT-}
{COMMENT}   Makro uzywane do drukowania tekstow                      {COMMENT-}
{MACRO: 'prn_txt'}
{ STR.split(Text);~~}
{WHILE: +(Text:=STR.line(Text_dl))}
{DO}
   {<{lmt}Text}
{OD}
{MACRO-}
{COMMENT}   MACRO - razem                                            {COMMENT-}
{COMMENT}   Makro drukuje razem przed tabelka                        {COMMENT-}
{MACRO: 'razem'}
{ __next:=0; ll:=lineleft();~~}
{IF:  _f:=prn1+'.ini_line()'; _v:=($(_f))();
      _f:=prn1+'.length()'; _v:=($(_f))();
      ll<(rsep+_v) & ll<>0}{PAGE}{FI}
{ENTIRE}
{REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
{WHILE: _f:=prn1+'.next()'; ($(_f))()}
{DO}
   {FIRST}
   {<{lmt-(+exec('tr','tlumaczenia','1000115')+2)}}{exec('tr','tlumaczenia','1000115')}{REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
   {FIRST-}
   {IF: __next}
      {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
   {ELSE}
      { __next:=1;~~}
   {FI}
{OD}
{ENTIRE-}
{ VAR_DEL.delete('__next','skipline');~~}
{MACRO-}
{MACRO: 'HEADF'}
{SPACE: 'A'}
{IF: PAR_WYDR.LOGO}
   {IF: exec('get_logo','img_blob')}
{<1}  {LINE:1}{IMAGE: exec('get_logo','img_blob');0;2}
   {ELSE}
{<1}  {LINE:1}{BITMAP:'"logo.bmp",,2'}
   {FI}
{FI}
{IF: PAR_WYDR.TITLE<>''}
{SPACE: 'B'}{FONT: exec('font','param_wydr','head')}
{  lm:=charleft(); head_title:=PAR_WYDR.TITLE; ~~}
   {WHILE: head_title<>''}
   {DO}
      {
         _wsk:=head_title*'\n';
         line_title:={? _wsk || (_wsk-1)+head_title || head_title ?};
         head_title:={? _wsk || _wsk-head_title || '' ?};
      ~~}
      {<1>{lm}line_title}
   {TOTAL}
      {  VAR_DEL.delete('line_title','head_title'); ~~}
   {OD}
{FI}
{MACRO-}
{MACRO: 'Text'}
{<{lmt+1}}{
max_T8:=charleft;
STR.split(Text);
~~}
{IF: Line & +Text}{LINE}{FI}
{WHILE: +(Text:=STR.line(max_T8-4-2))}
{DO}
   {IF: +Text>=(max_T8-4-8)}
      {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-5}Text}
   {ELSE}
      {<{lmt+1}}{Text}
   {FI}
{OD}
{MACRO-}