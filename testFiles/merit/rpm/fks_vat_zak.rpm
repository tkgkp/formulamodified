:!UTF-8
{TITLE:Wydruk ewidencji VAT}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
 opcja:=0; ue:=exec('czy_ue','fks_vat'); ile_l:=0;
 sstr5:=sstr6:=sstr7:=sstr8:=sstr9:=sstr10:=sstr11:=sstr12:=sstr13:=0;
 sstr14:=sstr15:=sstr16:=sstr17:=sstr18:=0; sklej:='';
 suma5:=suma6:=suma7:=suma8:=suma9:=suma10:=suma11:=suma12:=suma13:=0;
 suma14:=suma15:=suma16:=suma17:=suma18:=0;
 pom:=1; {? var_pres('rejestr')<=0 || rejestr:='Z' ?};
 w55:=w555:=''; w44:=''; pom_1:=pom_2:='';
 inwest0:=inwest1:=inwest2:=inwest3:=inwest4:=inwestv1:=inwestv2:=0;
 pozost0:=pozost1:=pozost2:=pozost3:=pozost4:=pozostv1:=pozostv2:=0; ok:=rek:=0;
 rycz1:=ryczv1:=rycz2:=ryczv2:=rycz3:=rycz4:=rycz5:=ryczv5:=0;
 wart7:=obj_new(3); wart8:=obj_new(3); wart9:=obj_new(3); wart10:=obj_new(3); wart11:=obj_new(3);
 wart12:=obj_new(3); wart15:=obj_new(3); wart16:=obj_new(3); in_w:=po_z:=ryc_z:=0;
 s:=obj_new(20); n:=obj_new(20); v:=obj_new(20); vwe:=obj_new(20); br:=obj_new(20); np:=obj_new(20);vp1:=obj_new(20);
 svat:=obj_new(20); snetto:=obj_new(20); param1:=param2:=param3:=param4:=param5:=param6:=param7:=param8:='';
 VAT7.PAR1:=VAT7.PAR3:=VAT7.PAR4:=0; rejspr:=0; VAT7.PAR2:=3; UNPAR.P1:=0;
 PRN:=obj_new(@.CLASS.PRINT,33); PRN.sl_frame();
 PRN1:=obj_new(@.CLASS.PRINT,20); PRN1.sl_frame();
 linijka:=numer:=0; d_sum1:=d_sum2:=d_sum3:=linecnt:=0;
 w:=obj_new(52); ww:=obj_new(39); szer:=obj_new(17); stawka:=obj_new(7);
 {!_a:=1..20 |! w[_a]:='' !}; {!_a:=21..28 |! w[_a]:=0 !};w6:=w7:=w8:=w9:=w10:=w11:=w12:=w13:=w14:=0;
 PRN2:=obj_new(@.CLASS.PRINT,7); PRN2.sl_frame(); STR2:=obj_new(@.CLASS.STRING); STR3:=obj_new(@.CLASS.STRING);
 w2:=''; w15:=sstr20:=suma20:=inwest5:=pozost5:=0;
 inwestv5:=pozostv5:=w16:=sstr21:=suma21:=0;
 dru_rej:=rej_1:=rej_2:=rej_3:=rej_4:=rej_5:=rej_6:=rej_7:=rej_8:=rej_9:=0; kor:=0;
 VAT7.DAT_ZAPL:=date(0,0,0); VAT7.TYLKOZAP:=0; {! _a:=1..30 |! ww[_a]:=0 !};
 font_gr:=0; color:=''; prn1:=prn2:='PRN';
 lm:=ll:=lmt:=rsep:=0; vp:=1; rsep1:=PAR_WYDR.RSEP; PAR_WYDR.RSEP:=1; fun:='';
 {? var_press('WAL',VAT7)>0 || VAT7.WAL:=exec('kod_pln','slo_slu') ?};
 wal_op:=''; VAT7.KRAJ:=exec('kod_pl','slo_slu'); kraj:='';
 VAT7.WY1:=VAT7.WY2:=0;
 par84:=PAR_SKID.get(84)='T'; par83:=PAR_SKID.get(83)='T';
 prewsk:=SSTALE.AR().PREWSK; procst:=SSTALE.AR().PROC_VAT;
 {? 1+rejestr='_'
 || VAT7.win_edit('REJZAKUE'); UNPAR.P1_BE:=UNPAR.P1_AE:=UNPAR.P1_BV:=''
 |? rejestr='ZakOpod'
 || VAT7.win_edit('REJZAK4'); UNPAR.P1_BE:='VAT7.PAR1=0'; UNPAR.P1_AE:=UNPAR.P1_BV:=''; VAT7.PAR10:=3
 || VAT7.win_edit('REJZAK'); UNPAR.P1_BE:=UNPAR.P1_AE:=UNPAR.P1_BV:=''
 ?};
 exec('vat7_p','!fks_vat_zrej');
 {? var_pres('hdr_vat')<0 || hdr_vat:=~(-'Rejestr zakupów VAT')  || hdr_vat:=~(-hdr_vat) ?};
 VAT7.hdr_edit(hdr_vat); VAT7.WY3:=1; VAT7.WYD_TECH:=0;
 OKRO_F.win_dict('SLO'); VAT7.WYSTROK:=VAT7.WYSTOKRO:=null;
 edycja:=VAT7.edit("{? VAT7.WY2 & VAT7.DAT_ZAPL=date(0,0,0)
                    || FUN.info('Nie wypełnione pole określające\ndo jakiego dnia mają być uwzględniane zapłaty.'); 'DAT_ZAPL'
                    |? rejestr='_WWspNus' & VAT7.PAR1=1 & VAT7.TYP_VAT='Z'
                    || FUN.info('Wydruk niedostępny w tym wariancie.'); VAT7.PAR1:=0; 'PAR1'
                    || {? (1+rejestr='_') & VAT7.PAR1=4 || VAT7.PAR3:=1 ?}; 1
                    ?}");
 {? rejestr='ZakOpod'
 || rejestr:={? VAT7.PAR10=1 || 'ZakOpod' |? VAT7.PAR10=2 || 'ZakOpoZ' || 'ZakOpo' ?}
 ?};
 dokvpoch:=exec('dokvpoch','!fks_vat_zrej');
 PAR_WYDR.TITLE:=hdr_vat+exec('naz_okr_vat','!fks_vat_zrej'); zakup:=1;
{? rejestr='_WWspNus'
|| tryb:=2;
   {? exec('typ_vat','!fks_vat_zrej')='Z' || rejspr:=1 ?}
|? rejestr='_WWspN' & exec('typ_vat','!fks_vat_zrej')='Z'
|| tryb:=4
|| tryb:=3
?};
 okrVat:=exec('okr_vat_wydr','!fks_vat_zrej');
 SLU.cntx_psh(); SLU.index('NAZ'); SLU.prefix(); dat_zapl:=date(0,0,0);
 {? SLU.find_key('~STAWKI VAT '+VAT7.KRAJ().KOD)
 || SLO.cntx_psh(); SLO.index('SL'); SLO.prefix(SLU.ref()); sizeslo:=SLO.size; tvat:=obj_new(sizeslo);
    tn:=obj_new(sizeslo); tv:=obj_new(sizeslo); tb:=obj_new(sizeslo);
    sn:=obj_new(sizeslo); sv:=obj_new(sizeslo); sb:=obj_new(sizeslo);
    tv1:=obj_new(sizeslo); sv1:=obj_new(sizeslo);
    _ile:={? sizeslo<8 || 8 || sizeslo ?}+(VAT7.PAR1=2);
    su:=obj_new(_ile); ssu:=obj_new(8); {! _i:=1..8 |! ssu[_i]:=0 !}; is_us:=0;
    {? SLO.first()
    || {! _a:=1..sizeslo
       |! tvat[_a]:=SLO.KOD; tn[_a]:=tv[_a]:=tb[_a]:=sn[_a]:=sv[_a]:=sb[_a]:=tv1[_a]:=sv1[_a]:=0; SLO.next()
       !};
       {! _a:=1.._ile
       |! su[_a]:=obj_new(4); su[_a][1]:=su[_a][2]:=su[_a][3]:=su[_a][4]:=0
       !}
    ?}; SLO.cntx_pop()
 ?}; SLU.cntx_pop();
 head:=PAR_WYDR.HEAD; logo:=PAR_WYDR.LOGO; odd:=OPERATOR.DEPT=null; separat:=1; s2c:=0; ROK_F.win_dict('WER')
}
{END:
 PAR_WYDR.HEAD:=head; &head; PAR_WYDR.LOGO:=logo; &logo; &hdr_vat; &ue; &ile_l; &separat;
 obj_del(PRN); obj_del(PRN1); obj_del(szer); obj_del(w); obj_del(ww); obj_del(stawka);  &zakup;
 obj_del(wart7); obj_del(wart8); obj_del(wart9); obj_del(wart10); &in_w; &po_z; &ryc_z;
 obj_del(wart11); obj_del(wart12); obj_del(wart15); obj_del(wart16); &opcja;
 &w6; &w7; &w8; &w9; &w10; &w11; &w12; &w13; &w14; &rejspr; &tryb;
 &sstr5; &sstr6; &sstr7; &sstr8; &sstr9; &sstr10; &sstr11; &sstr12;
 &sstr13; &sstr14; &sstr15; &sstr16; &sstr17; &sstr18;&linijka; &numer;
 &suma5; &suma6; &suma7; &suma8; &suma9; &suma10; &suma11; &suma12;
 &suma13; &suma14; &suma15; &suma16; &suma17; &suma18; &linecnt; &pom_1; &pom_2;
 &w55; &w555; &w44; &sizeslo; &ok; &rek;&sklej; &d_sum1; &d_sum2; &d_sum3;
 &rejestr;  &pom;  &inwest0; &inwest1; &inwest2; &inwest3; &inwest4; &inwestv1; &inwestv2;
 &pozost0; &pozost1; &pozost2; &pozost3; &pozost4; &pozostv1; &pozostv2;
 &rycz1; &ryczv1; &rycz2; &ryczv2; &rycz3; &rycz4; &rycz5; &ryczv5;
 VAR_DEL.delete('par84','par83','prewsk','procst');
 obj_del(tvat); obj_del(np);obj_del(vp1);
 obj_del(tn); obj_del(tv); obj_del(tb); obj_del(sn); obj_del(sv); obj_del(sb);
 obj_del(tv1); obj_del(sv1);
 obj_del(s); obj_del(v); obj_del(vwe); obj_del(n); obj_del(br); obj_del(svat); obj_del(snetto);
 _a:=SSTALE.AR().KOD+form(SSTALE.AO().NR,-2); DOK.use('doku'+_a); POZ.use('pozy'+_a); VPOZ.use('pozv'+_a); VPOZ_ROZ.use('pozr'+_a);
 POW.use('pow_'+_a); &param1; &param2; &param3; &param4; &param5; &param6; &param7; &param8;
 obj_del(PRN2);&w2; &w15; &sstr20; &suma20; &inwest5; &pozost5;
 &inwestv5; &pozostv5; &w16; &sstr21; &suma21; &dat_zapl; &kor;
 &dru_rej; &rej_1; &rej_2; &rej_3; &rej_4; &rej_5; &rej_6; &rej_7; &rej_8; &rej_9;
 font_gr:=1; &color; &prn1; &prn2;
 &lm; &ll; &vp; &lmt; PAR_WYDR.RSEP:=rsep1; &rsep; &rsep1; &fun;
 &wal_op; &kraj; &edycja; &odd; VAR_DEL.delete('dokvpoch','s2c','su','ssu','is_us','okrVat','okrVatNr','STR2','STR3')
}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vat_zak.rpm
Utworzony:   ???? - ??- ?? [?????] ???????????
Modyfikacje: 2001-03-20 [AMK] Artur Makos
==================================================
Zawartosc: Wydruk zestawienia zbiorczego VAT
{COMMENT-}
{EXIT: ~edycja}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: ~rep_expo()}{SUBSTITUTE: 'FOOT'}{FI}
 { param1:='Wydruk w podziale na: '+{? VAT7.PAR1=0 || 'wszystkie stawki' |? VAT7.PAR1=1 || 'grupy podatkowe' |? VAT7.PAR1=2 || 'wybrane stawki' || 'wg NIP UE' ?};
   param2:='Uwzględniono: '+{? VAT7.PAR2=1 || 'korekty zakupów' |? VAT7.PAR2=2 || 'zakup' || 'zakup i korekty zakupów'?};
   param3:={? (1+rejestr='_') & VAT7.PAR1=4  || '' || 'Wydruk dokumentów: '+exec('vat7par3','!fks_vat_zrej') ?};
   param3+={? param3='' || '' || '   ' ?}+{? 6+rejestr='ZakOpo' || 'Rodzaj rozliczenia: '+{? VAT7.PAR10=1 || 'Odwrotne obciążenie' |? VAT7.PAR10=2 || 'Zagraniczny dostawca' || 'Wszystkie' ?} || ''?};
   param4:={? UNPAR.P1 || 'Kwoty podatku VAT do odliczenia zgodnie z ustawą' || 'Kwoty podatku VAT z faktury' ?}+exec('typ_vat_str','!fks_vat_zrej');~~}
{IF: VAT7.PAR1=1}
  {INCLUDE: fks_vatzbzak.rpi}
{ELIF: ~VAT7.PAR1}
  {INCLUDE: fks_vatrej2.rpi}
{ELIF: VAT7.PAR1=2}
  {INCLUDE: fks_vatrejs1.rpi}
{ELIF: VAT7.PAR1=4}
  {INCLUDE: fks_vatrej6.rpi}
{FI}