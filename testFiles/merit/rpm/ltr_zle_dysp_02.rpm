:!UTF-8
{TITLE:B. Dowód dostawy}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','v'),,,,,'Q','C',,,,,,1,
   PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1,,'enable'}
{BEGIN:
   {? exec('czy_grp_dr','faktury_wydruk')
   || __GRP_DR.WZ:='ltr_zle_dysp_02'
   ?};
   tra_dysp:="
      VAR_DEL.delete('ww','ww1','kk','kk1','ss','doklw','lp','PRN','PRN1','tryb');
      VAR_DEL.delete('wydr_naz','wydr_edi');
      VAR_DEL.delete('wyjscie','X_Xw1','X_Xw2');
      VAR_DEL.delete('lmt','vp','rsep');
      VAR_DEL.delete('wb','il');
      VAR_DEL.delete('__tab_sel','ns','NOMAXP');
      VAR_DEL.delete('rul','lul','STRR','STRL')
   ";
   tra_dysp();

   "--tabela dla pozycji dokumentu--";
      _ilk:=7;
      PRN:=obj_new(@.CLASS.PRINT,_ilk); PRN.s_frame();
      kk:=obj_new(_ilk);   "--szerokosc kolumn--";
      ww:=obj_new(_ilk);   "--wartosci kolumn--";
      doklw:=3;            "--dokladnosc wartosci--";
      max_dokl:=0;         "--maksymalna dokładność--";
      ss:=obj_new(4);      "--sumator--";
      {! _i:=1..4 |! ss[_i]:=0 !};

      kk[1]:=3;          "--Lp.--";
      kk[2]:=88;         "--Opis1--";
      kk[3]:=8;          "--Ilość op.--";
      kk[5]:=9;          "--Jedn. miary--";
      kk[4]:=9;          "--Całkowita ilość--";
      kk[6]:=10;         "--Waga netto (t)--";
      kk[7]:=11;         "--Waga brutto (t)--";
   "--koniec tabeli--";

   "--tabela dla danych kontrahentów--";
      _ilk1:=2;
      PRN1:=obj_new(@.CLASS.PRINT,_ilk1); PRN1.s_frame();
      kk1:=obj_new(_ilk1); "--szerokosc kolumn--";
      ww1:=obj_new(_ilk1); "--wartosci kolumn--";

      kk1[1]:=76;          "--Adresat--";
      kk1[2]:=76;          "--Odbiorca--";
   "--koniec tabeli--";

   tryb:=rep_export();

   rul:=lul:='';
   STRR:=obj_new(@.CLASS.STRING);
   STRL:=obj_new(@.CLASS.STRING);
   lmt:=0;
   vp:=0;
   wyjscie:=0;
   lp:=0
}
{END:
   tra_dysp(); VAR_DEL.delete('tra_dysp')
}
{IF: wyjscie=1}{EXIT}{FI}
{
   {? tryb<>1 || PRN.add("ww[1]",kk[1],'Lp.'@,1) ?};
   PRN.add("ww[2]",kk[2],'Opis'@);
   PRN.add("ww[3]",kk[3],'Ilość opakowań'@,1);
   PRN.add("ww[4]",kk[4],'Ilość całkowita'@,1);
   PRN.add("ww[5]",kk[5],'jm'@);
   PRN.add("ww[6]",kk[6],'Waga netto (t)'@,1);
   PRN.add("ww[7]",kk[7],'Waga brutto (t)'@,1);

   PRN1.add("ww1[1]",kk1[1],'Dostawa od'@);
   PRN1.add("ww1[2]",kk1[2],'Dostawa do / Kupujący'@);

   "--tabela dla pozycji zamówienia--";
      VAR_DEL.delete('X_Xw1');
      X_Xw1:=tab_tmp(1,
         'POZ'   ,'INTEGER'     ,'Nr pozycji',
         'IND'   ,'STRING[50]'  ,'Indeks',
         'NAZ'   ,'STRING[100]' ,'Nazwa',
         'IL'    ,'REAL'        ,'Ilość opakowań',
         'IC'    ,'REAL'        ,'Ilość całkowita',
         'JM'    ,'STRING[10]'  ,'Jednostka miary',
         'WN'    ,'REAL'        ,'Waga netto (t)',
         'WB'    ,'REAL'        ,'Waga brutto (t)'
      );

      X_Xw1.index(X_Xw1.ndx_tmp(,,{? 1=1 || 'POZ' ?},,));

   "--tabela dla danych nagłówka--";
      VAR_DEL.delete('X_Xw2');
      X_Xw2:=tab_tmp(1,
         'ZNAZ'    ,'STRING[150]'       ,'Nazwa z',
         'ZPAN'    ,'STRING[20]'        ,'Panstwo z',
         'ZKPO'    ,'STRING[6]'         ,'Kod pocztowy z',
         'ZMIA'    ,'STRING[30]'        ,'Miasto z',
         'ZULI'    ,'STRING[150]'       ,'Ulica z',
         'ZNUM'    ,'STRING[40]'        ,'Numer posesji z',

         'DNAZ'    ,'STRING[150]'       ,'Nazwa do',
         'DPAN'    ,'STRING[20]'        ,'Panstwo do',
         'DKPO'    ,'STRING[6]'         ,'Kod pocztowy do',
         'DMIA'    ,'STRING[30]'        ,'Miasto do',
         'DULI'    ,'STRING[150]'       ,'Ulica do',
         'DNUM'    ,'STRING[40]'        ,'Numer posesji do',

         'KNAZ'    ,'STRING[150]'       ,'Nazwa kupującego',
         'KPAN'    ,'STRING[20]'        ,'Panstwo kupującego',
         'KKPO'    ,'STRING[6]'         ,'Kod pocztowy kupującego',
         'KMIA'    ,'STRING[30]'        ,'Miasto kupującego',
         'KULI'    ,'STRING[150]'       ,'Ulica kupującego',
         'KNUM'    ,'STRING[40]'        ,'Numer posesji kupującego',

         'ZNIP'    ,'STRING[30]'        ,'NIP z',
         'ZREG'    ,'STRING[45]'        ,'REGON z',
         'ZKRS'    ,'STRING[40]'        ,'KRS z',

         'DODE'    ,'DATE'              ,'Data odebrania',
         'DDOS'    ,'DATE'              ,'Data dostarczenia'
      )
;~~}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: ltr_zle_dys.rpi}
{COMMENT} -- WYDRUK POZYCJI W PĘTLI JEŚLI GRUPOWE DRUKOWANIE -- {COMMENT-}
{IF:TR_NZL.sel_size()>0 & __GRP_DR.PDF=0}
{
   TR_NAG.cntx_psh();
   TR_NZL.cntx_psh();
   __tab_sel:=TR_NZL.sel_aget()
   ;~~}
{FOR: __tab_sel}
   {DO}
      {IF: TR_NZL.seek(__tab_sel.REF,)}
      {
         exec('czytaj','#stalesys',,XINFO); KSTE.get();
         NOMAXP:=1;
         ~~}
         {INCLUDE: ltr_zle_dysp_02.rpi}
         {IF: lineleft()>0}{PAGE}{ns:=1;page(1);~~}{FI}
      {FI}
   {OD}
   {
      TR_NAG.cntx_pop();
      TR_NZL.cntx_pop()
   ;~~}
{ELSE}
   {INCLUDE: ltr_zle_dysp_02.rpi}
{FI}