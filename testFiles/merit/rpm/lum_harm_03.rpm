:!UTF-8
{TITLE: Harmonogram uproszczony}
{PRINTER: exec('set_parw','param_wydr'); exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,
   PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1,,'enable'}
{BEGIN:
   {? var_pres('PRN',@)<=100 || PRN:=obj_new(@.CLASS.PRINT,20) ?}; PRN.s_frame();
   {? var_pres('PRNS',@)<=100 || PRNS:=obj_new(@.CLASS.PRINT,20) ?}; PRNS.s_frame();

   w:=obj_new(20);
   s:=obj_new(20);

   i:=0;
   color:=prn1:=prn2:='';
   lm:=ll:=vp:=lmt:=rsep:=0
;~~}
{END:
   obj_del(PRN); obj_del(PRNS); obj_del(w); obj_del(s);
   &i;
   &color; &prn1; &prn2;
   &lm; &ll; &vp; &lmt; &rsep
;~~}
{PRN.add("w[1]",charleft()-4,'Daty wywozów'@,,',');~~}
{COMMENT}
color, prn1, lm, ll, vp, lmt, rsep - zmienne pomocnicze do wydrukow graficzn.
{COMMENT-}
{  PAR_WYDR.TITLE:='Harmonogram %1 uproszczony na rok %2'@[HN.KOD,$HARMON.ROK];
   prn1:='PRN'; prn2:='PRNS'; ~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{FONT: 'T8GB'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{ rsep:=PAR_WYDR.RSEP; w[1]:='';w[2]:=''; ~~}
{ HARMON.cntx_psh();~~}
{FOR:'HARMON'}
{INDEX:'HN'}
{PREFIX: HN.ODDZ, HN.KOD, HA.ROK}
{DO}
    {i:=0;~~}
    {WHILE: i+=1;i<=(date(HARMON.ROK,HARMON.NR,0)~3)}
    {DO}
        {
         _co:=($("HARMON.D"+form(i,-2)))();
        {? _co <> '' & _co <> ' ' & _co <> '  ' &
           _co <> HA.BRAK & _co <>HA.SW & _co <>HA.NIE & _co <>HA.NIE_SW
        || w[1]+=(date(HARMON.ROK,HARMON.NR,i)$6)-5+', '
        ?};
        ~~}
        {IF: +w[1]>990}
           {SUBSTITUTE: 'LINIA0'}
           {w[1]:='';~~}
        {FI}
    {OD}
{OD}
{HARMON.cntx_pop();~~}
{SUBSTITUTE: 'LINIA0'}
{  rsep:=PAR_WYDR.RSEP; ~~}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
