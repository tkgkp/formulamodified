:!UTF-8
{TITLE: Karta przekazania odpadu}
{PRINTER: exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1}
{BEGIN:
       {? var_pres('PRN',@)<=100 || PRN:=obj_new(@.CLASS.PRINT,5) ?}; PRN.s_frame();
       {? var_pres('PRN1',@)<=100 || PRN1:=obj_new(@.CLASS.PRINT,5) ?}; PRN1.s_frame();
       {? var_pres('PRN2',@)<=100 || PRN2:=obj_new(@.CLASS.PRINT,5) ?}; PRN2.s_frame();
       {? var_pres('PRN3',@)<=100 || PRN3:=obj_new(@.CLASS.PRINT,5) ?}; PRN3.s_frame();
       {? var_pres('PRN4',@)<=100 || PRN4:=obj_new(@.CLASS.PRINT,5) ?}; PRN4.s_frame();
       {? var_pres('PRN5',@)<=100 || PRN5:=obj_new(@.CLASS.PRINT,12) ?}; PRN5.s_frame();
       {? var_pres('PRN6',@)<=100 || PRN6:=obj_new(@.CLASS.PRINT,6) ?}; PRN6.s_frame();
       {? var_pres('PRN7',@)<=100 || PRN7:=obj_new(@.CLASS.PRINT,8) ?}; PRN7.s_frame();
       w1:=w2:=w3:=w4:=w5:=w6:='';__KOL:=0;
       w1e:='NIP';
       w2e:='REGON';
       {? KPO.R='G'
       || zb:=1
       || zb:=ask('Wydruk karty','Wybierz',,'Szczegółowo','Zbiorczo')
       ?};
       NrRejDBO:=obj_new(3);
       NrRejDBO[1]:=NrRejDBO[2]:=NrRejDBO[3]:='';
       szer:=0;
       i:=0;licz:=1;kpot_licz:=0;
       color:=prn1:=prn2:='';lp:=0;
       lm:=ll:=vp:=lmt:=rsep:=0;

       exec('czytaj','#stalesys',,XINFO);
       KHfrom:=obj_new('Name', 'Address', 'Recipient', 'RecipientAddress', 'Nr', 'Nip', 'Regon');
       {? KPO.KH <> null()
       ||
          _naz1:=KPO.KH().NAZ_P;
          KHfrom.Name:=_naz1;
          _pocz1:=exec('kpocz','faktury_wydruk',KPO.KH().KPOCZ,KPO.KH().POCZ,KPO.KH().MIASTO);
          _adr1:=exec('adr','faktury_wydruk',KPO.KH().UL);
          KHfrom.Address:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          {? KPO.KH_ODB<>null()
          ||
            _pocz1:=exec('kpocz','faktury_wydruk',KPO.KH_ODB().KPOCZ,KPO.KH_ODB().POCZ,KPO.KH_ODB().MIASTO);
            _adr1:=exec('adr','faktury_wydruk',KPO.KH_ODB().UL);
            _naz1:=KPO.KH_ODB().NAZ
          ?};
          KHfrom.RecipientAddress:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          KHfrom.Recipient:=_naz1;
          KHfrom.Nr:=KPO.KH().NRREJDBO;
          KHfrom.Nip:=KPO.KH().NIP;
          KHfrom.Regon:=KPO.KH().REG
       ||
          _naz1:=XINFO.NAZ;
          KHfrom.Name:=_naz1;
          _pocz1:=exec('kpocz','faktury_wydruk',XINFO.KOD_P,XINFO.POCZ,XINFO.MIA);
          _adr1:=exec('adr','faktury_wydruk',XINFO.UL,XINFO.NR_D,XINFO.NR_L);
          KHfrom.Address:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          KHfrom.RecipientAddress:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          KHfrom.Recipient:=_naz1;
          KHfrom.Nr:=KST.BDO;
          KHfrom.Nip:=XINFO.NIP;
          KHfrom.Regon:=XINFO.REGON
       ?};

       KHto:=obj_new('Name', 'Address', 'Recipient', 'RecipientAddress', 'Nr', 'Nip', 'Regon');
       {? KPO.KH_2 <> null()
       ||
          _naz1:=KPO.KH_2().NAZ_P;
          KHto.Name:=_naz1;
          _pocz1:=exec('kpocz','faktury_wydruk',KPO.KH_2().KPOCZ,KPO.KH_2().POCZ,KPO.KH_2().MIASTO);
          _adr1:=exec('adr','faktury_wydruk',KPO.KH_2().UL);
          KHto.Address:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          {? KPO.KH_ODB_2<>null()
          ||
            _pocz1:=exec('kpocz','faktury_wydruk',KPO.KH_ODB_2().KPOCZ,KPO.KH_ODB_2().POCZ,KPO.KH_ODB_2().MIASTO);
            _adr1:=exec('adr','faktury_wydruk',KPO.KH_ODB_2().UL);
            _naz1:=KPO.KH_ODB_2().NAZ
          ?};
          KHto.RecipientAddress:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          KHto.Recipient:=_naz1;
          KHto.Nr:=KPO.KH_2().NRREJDBO;
          KHto.Nip:=KPO.KH_2().NIP;
          KHto.Regon:=KPO.KH_2().REG
       ||
          _naz1:=XINFO.NAZ;
          KHto.Name:=_naz1;
          _pocz1:=exec('kpocz','faktury_wydruk',XINFO.KOD_P,XINFO.POCZ,XINFO.MIA);
          _adr1:=exec('adr','faktury_wydruk',XINFO.UL,XINFO.NR_D,XINFO.NR_L);
          KHto.Address:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          KHto.RecipientAddress:={? _adr1<>'' | _pocz1<>'' || _adr1+', '+_pocz1 || ''?};
          KHto.Recipient:=_naz1;
          KHto.Nr:=KST.BDO;
          KHto.Nip:=XINFO.NIP;
          KHto.Regon:=XINFO.REGON
       ?};
~~}
{END:
       obj_del(PRN);obj_del(PRN1);obj_del(PRN2);obj_del(PRN3);obj_del(PRN4);obj_del(PRN7);
       VAR_DEL.delete('PRN5','PRN6');
       VAR_DEL.delete('w1','w2','w3','w4','w5','w6');
       VAR_DEL.delete('w1e','w2e','Czytran','NrRejDBO');
       VAR_DEL.delete('KHfrom','KHto');
       &zb;
       &licz;&lp;&kpot_licz;
       &i;
       &color; &prn1; &prn2;
       &lm; &ll; &vp; &lmt; &rsep;
~~}
{FONT: 'T8G'}{SPACE: 'C'}
{
   _szer3:=exec('wydr_kol','param_wydr',,3);
   _szer:=_szer3.Width;
   _last3:=_szer3.Last;
   _last_3col:=_szer3.Last - _szer;
   PRN1.add("w1",_szer,'');
   PRN1.add("w2",_szer,'Numer karty');
   PRN1.add("w3",_last3,'Rok kalendarzowy');

   PRN.add("w1",_szer,'');
   PRN.add("w2",_szer,'');
   PRN.add("w3",_last3,'');

   PRN4.add("w1",_szer,'');
   PRN4.add("w2",_szer,'',1);
   PRN4.add("w3",_last3,'');

   _szer1:=_szer-3;
   _nr_rej:=floor(_szer1/3);
   _gap_nrr:=_szer1-_nr_rej;

   PRN5.add("w1e",_nr_rej,'');
   PRN5.add("w1",_gap_nrr,'');
   PRN5.add("w1e",_nr_rej,'');
   PRN5.add("w3",_gap_nrr,'');
   PRN5.add("w1e",_nr_rej,'');
   PRN5.add("w5",_gap_nrr + _last_3col,'');

   PRN6.add("'Nr rejestrowy'",_nr_rej,'');
   PRN6.add("w1",_gap_nrr,'');
   PRN6.add("'Nr rejestrowy'",_nr_rej,'');
   PRN6.add("w2",_gap_nrr,'');
   PRN6.add("'Nr rejestrowy'",_nr_rej,'');
   PRN6.add("w3",_gap_nrr + _last_3col,'');

   _szer4:=exec('wydr_kol','param_wydr',,4);
   PRN7.add("w1",_szer4.Width,'');
   PRN7.add("w2",_szer4.Width,'',,,"'0:0:0,255:255:160'");
   PRN7.add("w3",_szer4.Width,'');
   PRN7.add("w4",_szer4.Last,'');


   PRN2.add("w1",charleft() - 2*2,'');

   PRN3.add("w1",_szer4.Width,'',,,"'0:0:0,255:255:160'");
   PRN3.add("w2",(2*_szer4.Width)+_szer4.Last+6,'',,,"'0:0:0,255:255:160'");
~~}
{COMMENT}
color, prn1, lm, ll, vp, lmt, rsep - zmienne pomocnicze do wydrukow graficzn.
{COMMENT-}
{  PAR_WYDR.TITLE:='Karta przekazania odpadu';
   prn1:='PRN'; prn2:='PRNS'; ~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------MACRO-LINIA0B-----------------{COMMENT-}
{COMMENT}
Makro używane do drukowania rekordu bez linią poprzedzającą
dla wydruków z obiektem PRINTER o nazwie przekazywanej przez zmienną prn1.
{COMMENT-}
{MACRO: 'LINIA0B'}
{  ll:=lineleft(); ~~}
{IF:  _f:=prn1+'.length()'; _v:=($(_f))();
      ll<(2+_v) & ll<>0}{PAGE}{FI}
{ENTIRE}
{ _f:=prn1+'.ini_line()'; ($(_f))()}
{WHILE: _f:=prn1+'.next()'; ($(_f))()}
{DO}
   {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
{OD}
{ENTIRE-}
{MACRO-}
{COMMENT}

macro

{COMMENT-}
{MACRO:'linia_n'}
{<0 PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{<0 PRN.line()}
{OD}
{MACRO-}
{MACRO:'linia_x'}
{ENTIRE}
{PRN.ini_sline(2,3,w2); ~~}
{WHILE: PRN.s_next()}
{DO}
   {<0 PRN.s_line(2,3)}
{OD}
{ENTIRE-}
{MACRO-}
{MACRO:'head_n'}
{PRN.hbar()}
{<0 PRN.ini_head()}
{WHILE: PRN.h_next()}
{DO}
{<0 PRN.h_line()}
{OD}
{MACRO-}
{COMMENT}

--------------  wydruk -----------------------------

{COMMENT-}
{ lmt:=0; ~~}
{FONT: 'T8G'}{SPACE: 'C'}
{ rsep:=PAR_WYDR.RSEP; ~~}
{prn1:='PRN1'; prn2:='PRN';~~}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{ vp:=1; ~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{w1:='             KARTA PRZEKAZANIA ODPADU';w2:=' ';w3:=' ';~~}
{SUBSTITUTE: 'LINIA0B'}
{w1:='';w2:=KPO.SYM;w3:=$KPO.AR;~~}
{SUBSTITUTE: 'LINIA0B'}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:='Posiadacz odpadów, który przekazuje odpad';w2:='Transportujący odpad';
w3:='Posiadacz odpadów, który przejmuje odpad';~~}
{SUBSTITUTE: 'LINIA02'}
{FONT: 'T8GB'}{SPACE: 'C'}
{prn1:='PRN'; prn2:='PRN';~~}
{w1:=w2:=w3:=' ';licz:=1;kpot_licz:=0;~~}
{FOR: 'KPOT'}
{INDEX: 'KPO'}
{PREFIX: KPO.ref}
{DO}
{kpot_licz+=1;~~}
{OD}
{FOR: 'KPOT'}
{INDEX: 'KPO'}
{PREFIX: KPO.ref}
{DO}
{lp+=1;
    w2:={? KPOT.KH().NAZ_P<>'' || KPOT.KH().NAZ_P || '' ?};
    {? kpot_licz>1 || w2:=$lp+'. '+w2 ?};
    {? licz
    ||
       w1:=KHfrom.Name;
       w3:=KHto.Name;
       licz:=0
    ||
       w1:='';
       w3:=''
    ?};
 ~~}
{SUBSTITUTE: 'LINIA0B'}
{OD}
{IF: licz=1}
{
    w1:=KHfrom.Name;
    w2:='';
    w3:=KHto.Name;
 ~~}
{SUBSTITUTE: 'LINIA0B'}
{FI}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:=w2:=w3:='Adres';rsep:=0;~~}
{SUBSTITUTE: 'LINIA0'}
{FONT: 'T8GB'}{SPACE: 'C'}
{w1:=w2:=w3:=' ';licz:=1;lp:=0;rsep:=1;Czytran:=0;~~}
{FOR: 'KPOT'}
{INDEX: 'KPO'}
{PREFIX: KPO.ref}
{DO}
{lp+=1;
 Czytran+=1;
   {? licz=1
   ||
      w1:=KHfrom.Address;
      w3:=KHto.Address;
      licz:=0
   ||
      w1:='';
      w3:=''
   ?};
    _pocz2:=exec('kpocz','faktury_wydruk',KPOT.KH().KPOCZ,KPOT.KH().POCZ,KPOT.KH().MIASTO);
    _adr2:=exec('adr','faktury_wydruk',KPOT.KH().UL);
    w2:={? KPOT.KH().UL<>'' | _pocz2<>'' || _adr2+', '+_pocz2 || '' ?};
    {? kpot_licz>1 || w2:=$lp+'. '+w2 ?};
    NrRejDBO[2]:=KPOT.KH().NRREJDBO;
 ~~}
{SUBSTITUTE: 'LINIA0B'}
{OD}
{IF: licz=1}
{
    w1:=KHfrom.Address;
    w2:='';
    w3:=KHto.Address;
 ~~}
{SUBSTITUTE: 'LINIA0B'}
{FI}
{COMMENT}   Miejsce prowadzenia działalności  {COMMENT-}
{
   w1:='Miejsce prowadzenia działalności';
   w2:='';
   w3:='Miejsce prowadzenia działalności';
~~}
{SUBSTITUTE: 'LINIA0'}
{

    w1:=KHfrom.RecipientAddress;
    w2:='';
    w3:=KHto.RecipientAddress;

{? 1=2
||
w1:={? KPO.R='G' || 'Gminny Punkt Zbiórki Odpadów  ul.'+GPOD.UL+', '+GPOD.KODP+' '+GPOD.MIA || '' ?};
w2:='';
w3:=KPO.KH_2().UL+', '+KPO.KH_2().KPOCZ+' '+KPO.KH_2().MIASTO;
NrRejDBO[3]:=KPO.KH_2().NRREJDBO
?};

~~}
{SUBSTITUTE: 'LINIA0B'}
{w1:=w2:=w3:='';~~}
{SUBSTITUTE: 'LINIA0B'}
{COMMENT}   Nr rejestrowy  {COMMENT-}
{
   prn1:='PRN'; prn2:='PRN6';
   w1:=KHfrom.Nr;
   w2:=NrRejDBO[2];
   w3:=KHto.Nr;
~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'LINIA02'}
{COMMENT}   NIP, REGON  {COMMENT-}
{ prn1:='PRN6'; prn2:='PRN5';~~}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:=w2:=w3:=w4:=w5:=w6:='';~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{w1:=w2:=w3:=' ';licz:=1;lp:=0;~~}
{FOR: 'KPOT'}
{INDEX: 'KPO'}
{PREFIX: KPO.ref}
{DO}
{lp+=1;
   {? licz=1
   ||
     w1:=KHfrom.Nip;
     w2:=KHfrom.Regon;
     w5:=KHto.Nip;
     w6:=KHto.Regon;
     licz:=0
   ||
     w1:='';
     w2:='';
     w5:='';
     w6:=''
   ?};
    w3:={? KPOT.KH().NIP<>'' || $lp+'. '+KPOT.KH().NIP || '' ?};
    w4:={? KPOT.KH().REG<>'' || $lp+'. '+KPOT.KH().REG || '' ?};
 ~~}
 {IF: lp=1}
   {SUBSTITUTE: 'LINIA02'}
 {ELSE}
   { prn1:='PRN5'; ~~}
   {SUBSTITUTE: 'LINIA0B'}
 {FI}
 { w1e:=w2e:='';~~}
{OD}
{IF: licz=1}
{
   w1:=KHfrom.Nip;
   w2:=KHfrom.Regon;
   w5:=KHto.Nip;
   w6:=KHto.Regon;
   w3:='';
   w4:='';
 ~~}
{SUBSTITUTE: 'LINIA02'}
{FI}
{prn1:='PRN5'; prn2:='PRN2';~~}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:='Posiadacz odpadu, któremu należy przekazać odpad';~~}
{SUBSTITUTE: 'LINIA02'}
{prn1:='PRN2'; prn2:='PRN2';~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{

w1:=w2:=w3:=KHto.Recipient + ', ' + KHto.RecipientAddress;

{? 1=2
||
_adr:=KPO.KH_2().NAZ_P+', '+KPO.KH_2().UL+', '+KPO.KH_2().KPOCZ+' '+KPO.KH_2().MIASTO;
w1:=w2:=w3:={? KPO.KH_2<>null || _adr || KPO.MP ?}
?};


~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{
_adr:='';
w1:=w2:=w3:=KHto.Recipient + ', ' + KHto.RecipientAddress; ~~}
{SUBSTITUTE: 'LINIA0B'}
{prn1:='PRN2'; prn2:='PRN2';~~}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:='Rodzaj procesu przetwarzania, któremu powinien zostać poddany odpad';w2:=w3:='';~~}
{SUBSTITUTE: 'LINIA02'}
{prn1:='PRN2'; prn2:='PRN2';~~}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:='Wnioskuję o wydanie dokumentu potwierdzającego unieszkodliwienie zakaźnych odpadów medycznych lub zakażnych odpadów weterynaryjnych             '; w2:='';w3:='';~~}
{SUBSTITUTE: 'LINIA02'}
{w1:='                                 TAK   [   ]                                            NIE [   ]'; w2:='';w3:='';~~}
{SUBSTITUTE: 'LINIA0B'}
{FONT: 'T8G'}{SPACE: 'C'}
{prn1:='PRN2'; prn2:='PRN3';~~}
{w1:='Kod odpadu';
 w2:='Rodzaj odpadu';~~}
{SUBSTITUTE: 'LINIA02'}
{prn1:='PRN3'; prn2:='PRN3';~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{w1:=w2:=w3:=' ';__KOL:=1;~~}
{w1:=KPO.ODP().KOD;
 w2:=KPO.ODP().NAZ;~~}
{SUBSTITUTE: 'LINIA0B'}
{prn1:='PRN3'; prn2:='PRN7';~~}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:='Data/miesiąc';w2:='Masa przekazanych odpadów ['+exec('get','#params',100171,2)+']';w3:='Numer rejestracyjny pojazdu, przyczepy lub naczepy';
 w4:='Numer certyfikatu oraz numery pojemników';~~}
{SUBSTITUTE: 'LINIA02'}
{prn1:='PRN7'; prn2:='PRN7';~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{IF: zb=0}
{FOR: 'KPOZ'}
{INDEX: 'KPO'}
{PREFIX: KPO.ref}
{DO}
{
w1:={? KPOZ.D <> date(0,0,0) || KPOZ.D$7 || '---' ?};
 w2:=form(KPOZ.IL,,3,' ,');
 w3:=KPOZ.NRREJ;
 w4:='';~~}
{SUBSTITUTE: 'LINIA0B'}
{OD}
{ELSE}
{{? var_pres('X_Xa')>100 || obj_del(X_Xa) ?};
 X_Xa:=sql('select KPOZ.NRREJ, AR, AM, sum(KPOZ.IL) IL from KPOZ join KPO using (KPOZ.KPO,KPO.REFERENCE)where KPO = :_a group by AR,AM,KPOZ.NRREJ order by 1',KPO.ref,KPO.AR,KPO.AM);~~}
{FOR: X_Xa}
{DO}
{w1:=date(X_Xa.AR,X_Xa.AM,1)$8;
 w2:=form(X_Xa.IL,,3,' ,');
 w3:=X_Xa.NRREJ;
 w4:='';~~}
{SUBSTITUTE: 'LINIA0B'}
{OD}
{FI}
{prn1:='PRN7'; prn2:='PRN';~~}
{FONT: 'T8G'}{SPACE: 'C'}
{w1:='Potwierdzam przekazanie odpadu';
 w2:='Potwierdzam wykonanie usługi transportu';
 w3:='Potwierdzam przyjęcie odpadu';
 w4:='';~~}
{SUBSTITUTE: 'LINIA02'}
{w1:=w2:=w3:=' ';prn1:='PRN';~~}
{SUBSTITUTE: 'LINIA0B'}
{SUBSTITUTE: 'LINIA0B'}
{SUBSTITUTE: 'LINIA0B'}
{SUBSTITUTE: 'LINIA0B'}
{w1:=w2:=w3:='data i podpis';~~}
{SUBSTITUTE: 'LINIA0B'}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}