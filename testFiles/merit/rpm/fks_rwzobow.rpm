:!UTF-8
{TITLE:D. Wybrane należności / zobowiązania}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT}
{BEGIN:
   SLO.prefix; typ_roz:='';
   {? var_pres('STR',@)<=0 || STR:=obj_new(@.CLASS.STRING) ?};
   data1:=data2:=znacznik:=0; petla:=0; w1:=w2:=kwota:=0;
   platnik:=skrot:=adres:=kod:=kod2:=tekst:=kod_nr:='';
   kl:=0; il:=0; kontor:=''; s_sign:=mdc:='';
   suma4:=suma6:=suma9:=lm:=0;
   pierwszy:=licznik:=ww6:=ww4:=ww8:=ww9:=own:=oma:=0;
   kolu:=obj_new(20); w:=obj_new(20); p:=obj_new(20);
   indtym:=OP.ndx_tmp('',1,'WAL',,0,'KH',,0,'TYP',,0,'ODD',,0,'TZ',,0);
   exec('tmp_ods','rozrach_ods');
   KH.win_sel('WER_RPM')
}
{END:
   &platnik; &adres; &kod; &kod2; &tekst; &kontor; &w1; &w2;
   &data1; &data2; &znacznik; &petla; &kwota; &s_sign; &mdc; &lm;
   &kl; &il;    &suma4; &suma6; &suma9; &kod_nr;
   &pierwszy; &licznik; &ww6; &ww4;  &ww8; &ww9; &skrot;
   obj_del(kolu); obj_del(w); obj_del(p);
   DOK.use('doku'+SSTALE.AR().KOD+form(SSTALE.AO().NR,-2));
   POZ.use('pozy'+SSTALE.AR().KOD+form(SSTALE.AO().NR,-2));
   POW.use('pow_'+SSTALE.AR().KOD+form(SSTALE.AO().NR,-2));
   AN.use('koan__'+SSTALE.AR().KOD);
   &own; &oma; OP.ndx_drop(indtym); &indtym;
   {? ODS_TMP1.first() || exec('pyt_pok','rozrach_ods') ?};
   exec('del_tmp','rozrach_ods'); &typ_roz
}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: wsp_pw3.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{FOOTER:0}
{SUBSTITUTE: 'LINIA3'}
{FOOTER-}
{  w[1]:=w[5]:=w[7]:=w[10]:=0;
   w[2]:=w[3]:=w[4]:=w[6]:=w[8]:=w[9]:='';
   kl:=9;
   kolu[1]:=51;
   kolu[2]:=12;
   kolu[3]:=12;
   kolu[4]:=20;
   kolu[5]:=12;
   kolu[6]:=20;
   kolu[7]:=6;
   kolu[8]:=20;
   kolu[9]:=16;
   il:=kolu[1]+kolu[2]+kolu[3]+kolu[4]+kolu[5]+kolu[6]+kolu[7]+kolu[8]+kolu[9]+kl+1;
   p[1]:=2+kolu[1];
   {!_a:=2 ..kl
   |! p[_a]:=1+p[_a-1]+kolu[_a]
   !}; ~~}
{  {? ROZRACH.KONTR=null
   || PAR_WYDR.OMASKA:=1;
      PAR_WYDR.win_edit('RWZOBOW')
   || PAR_WYDR.OMASKA:=3;
      PAR_WYDR.win_edit('RWZOBOW2')
   ?};
   WYDRUKIN.DATA:=date();
   PAR_WYDR.S1PAR1:='N';
   WYDRUKIN.STOPE:='N';
   WYDRUKIN.DLKON:=35;
   ~~}
{EXIT: ~PAR_WYDR.edit()}
{EXIT: -WYDRUKIN.STOPE='t' & ~exec('sprtdods','rozrach_ods',WYDRUKIN.DATA)}
{  WYDRUKIN.REJSYM:='';
   typ_roz:={? PAR_WYDR.S1PAR1='N' || 'NAL' || 'ZOB' ?};
   {? PAR_WYDR.OMASKA=1 || w1:=1; w2:=0
   |? PAR_WYDR.OMASKA=2 || w1:=1; w2:=1
   |? PAR_WYDR.OMASKA=3 || w1:=2; w2:=0
   |? PAR_WYDR.OMASKA=4 || w1:=2; w2:=1
   ?};
   {? w1=1 & w2=1 ||
      {? +PAR_WYDR.MASKA<WYDRUKIN.DLKON ||
         PAR_WYDR.MASKA+=(WYDRUKIN.DLKON-+PAR_WYDR.MASKA)*'?'
      ?}
   ?};
   {? PAR_WYDR.MASKA=''
      || WYDRUKI.MASKA:=35*'?'
      || WYDRUKI.MASKA:=PAR_WYDR.MASKA
   ?};
   WYDRUKIN.STOPE:=~-WYDRUKIN.STOPE; ~~}
{IF: WYDRUKIN.STOPE='T'}
{MACRO: 'LINIA1'}
┌{kolu[1]*'─'}┬{kolu[2]*'─'}┬{kolu[3]*'─'}┬{kolu[4]*'─'}┬{kolu[5]*'─'}┬{kolu[6]*'─'}┬{kolu[7]*'─'}┬{kolu[8]*'─'}┬{kolu[9]*'─'}┐
{MACRO-}
{MACRO: 'LINIA2'}
├{kolu[1]*'─'}┼{kolu[2]*'─'}┼{kolu[3]*'─'}┼{kolu[4]*'─'}┼{kolu[5]*'─'}┼{kolu[6]*'─'}┼{kolu[7]*'─'}┼{kolu[8]*'─'}┼{kolu[9]*'─'}┤
{MACRO-}
{MACRO: 'LINIA3'}
└{kolu[1]*'─'}┴{kolu[2]*'─'}┴{kolu[3]*'─'}┴{kolu[4]*'─'}┴{kolu[5]*'─'}┴{kolu[6]*'─'}┴{kolu[7]*'─'}┴{kolu[8]*'─'}┴{kolu[9]*'─'}┘
{MACRO-}
{MACRO: 'NAGLOWEK'}
{PAR_WYDR.TITLE:={? PAR_WYDR.S1PAR1='Z'||'Zobowiązania'@|?PAR_WYDR.S1PAR1='N'||'Należności'@?}+
                 ' nr ........ stan na dzień %1'@[$WYDRUKIN.DATA];~~}
{SUBSTITUTE: 'CHARHEAD'}{FONT: 'Q'}{SPACE: 'C'}
{LINE: 1}
{<10'KONTRAHENT: %1'@[platnik]}
{<10'SKRÓT KONTRAHENTA: %1'@[skrot]}
{<10'ADRES: %1'@[adres]}
{IF: w1=1}{<10'KONTO: %1'@[kontor]}{ kod2:=kod_nr; ~~}{ELSE}{<10'KOD KONTRAHENTA: %1'@[kod]}{ kod2:=kod;  ~~}{FI}
{<10 {? OPERATOR.DEPT || 'JEDNOSTKA KSIĘGOWA: %1'@[OPERATOR.DEPT().OD] || 'Wszystkie jednostki księgowe'@ ?}}
{FONT: 'R'}
{SUBSTITUTE: 'LINIA1'}
{<1'│'}{<1>{p[1]}'Dokument'@}{<{p[1]}'│'}{<{p[1]}>{p[2]}'Data'@}{<{p[2]}'│'}{<{p[2]}>{p[3]}'Termin'@}{<{p[3]}'│'}{<{p[3]}>{p[4]}'Kwota'@
}{<{p[4]}'│'}{<{p[4]}>{p[5]}'Data'@}{<{p[5]}'│'}{<{p[5]}>{p[6]}'Kwota'@}{<{p[6]}'│'}{'Zwłoka'@}{<{p[7]}'│'}{<{p[7]}>{p[8]}'Pozostało'@}{<{p[8]}'│'
}{<{p[8]}>{p[9]}'Kwota'@}{<{p[9]}'│'}
{<1'│'}{<{p[1]}'│'}{<{p[1]}>{p[2]}'wystawienia'@}{<{p[2]}'│'}{<{p[2]}>{p[3]}'płatności'@}{<{p[3]}'│'}{<{p[3]}>{p[4]}'faktury'@}{<{p[4]}'│'
}{<{p[4]}>{p[5]}'wpłaty'@}{<{p[5]}'│'}{<{p[5]}>{p[6]}'wpłaty'@}{<{p[6]}'│'}{<{p[6]}>{p[7]}'dni'@}{<{p[7]}'│'}{<{p[7]}>{p[8]}'do zapłaty'@}{<{p[8]}'│'
}{<{p[8]}>{p[9]}'odsetek'@}{<{p[9]}'│'}
{SUBSTITUTE: 'LINIA2'}
{FONT: 'Q'}
{MACRO-}
{ELSE}
{  il-=kolu[9]-1; ~~}
{MACRO: 'LINIA1'}
┌{kolu[1]*'─'}┬{kolu[2]*'─'}┬{kolu[3]*'─'}┬{kolu[4]*'─'}┬{kolu[5]*'─'}┬{kolu[6]*'─'}┬{kolu[7]*'─'}┬{kolu[8]*'─'}┐
{MACRO-}
{MACRO: 'LINIA2'}
├{kolu[1]*'─'}┼{kolu[2]*'─'}┼{kolu[3]*'─'}┼{kolu[4]*'─'}┼{kolu[5]*'─'}┼{kolu[6]*'─'}┼{kolu[7]*'─'}┼{kolu[8]*'─'}┤
{MACRO-}
{MACRO: 'LINIA3'}
└{kolu[1]*'─'}┴{kolu[2]*'─'}┴{kolu[3]*'─'}┴{kolu[4]*'─'}┴{kolu[5]*'─'}┴{kolu[6]*'─'}┴{kolu[7]*'─'}┴{kolu[8]*'─'}┘
{MACRO-}
{MACRO: 'NAGLOWEK'}
{PAR_WYDR.TITLE:={? PAR_WYDR.S1PAR1='Z'||'Zobowiązania'|?PAR_WYDR.S1PAR1='N'||'Należności'?}+' stan na dzień '+$WYDRUKIN.DATA;~~}
{SUBSTITUTE: 'CHARHEAD'}{FONT: 'Q'}{SPACE: 'C'}
{LINE: 1}
{<10'KONTRAHENT: '+platnik}
{<10'SKRÓT KONTRAHENTA: %1'@[skrot]}
{<10'ADRES: '+adres}
{IF: w1=1}{<10'KONTO: %1'@[kontor]}{ kod2:=kod_nr; ~~}{ELSE}{<10'KOD KONTRAHENTA: %1'@[kod]}{ kod2:=kod;  ~~}{FI}
{<10 {? OPERATOR.DEPT || 'JEDNOSTKA KSIĘGOWA: %1'@[OPERATOR.DEPT().OD] || 'Wszystkie jednostki księgowe'@ ?}}
{FONT: 'R'}
{SUBSTITUTE: 'LINIA1'}
{<1'│'}{<1>{p[1]}'Dokument'@}{<{p[1]}'│'}{<{p[1]}>{p[2]}'Data'@}{<{p[2]}'│'}{<{p[2]}>{p[3]}'Termin'@}{<{p[3]}'│'}{<{p[3]}>{p[4]}'Kwota'@
}{<{p[4]}'│'}{<{p[4]}>{p[5]}'Data'@}{<{p[5]}'│'}{<{p[5]}>{p[6]}'Kwota'@}{<{p[6]}'│'}{'Zwłoka'@}{<{p[7]}'│'}{<{p[7]}>{p[8]}'Pozostało'@}{<{p[8]}'│'}
{<1'│'}{<{p[1]}'│'}{<{p[1]}>{p[2]}'wystawienia'@}{<{p[2]}'│'}{<{p[2]}>{p[3]}'płatności'@}{<{p[3]}'│'}{<{p[3]}>{p[4]}'faktury'@
}{<{p[4]}'│'}{<{p[4]}>{p[5]}'wpłaty'@}{<{p[5]}'│'}{<{p[5]}>{p[6]}'wpłaty'@}{<{p[6]}'│'}{<{p[6]}>{p[7]}'dni'@}{<{p[7]}'│'}{<{p[7]}>{p[8]}'do zapłaty'@}{<{p[8]}'│'}
{SUBSTITUTE: 'LINIA2'}
{FONT: 'Q'}
{MACRO-}
{FI}   {'  Do  STOPE';~~}
{IF: w1=1}
   {  KS.index('SYM'); KS.prefix;
      RS.index('RS'); RS.prefix;
      BUD.index('KS');
      KH.index('KOD'); KH.prefix(2); ~~}
   {  {? OPERATOR.DEPT
      || OP.index('PRZEG_O'); OP.prefix(SSTALE.WAL,OPERATOR.DEPT)
      || OP.index('PRZEG'); OP.prefix(SSTALE.WAL)
      ?};
      petla:=OP.first(); ~~}
   {WHILE: petla}
   {DO}
      {   {? OP.KH ||
            OP.KH();
            kod:=KH.KOD
         ?}; ~~}
{COMMENT}
      {IF: (OP.TYP=typ_roz) & (OP.AN<>kontor) & pierwszy & znacznik }
         {IF: -WYDRUKIN.STOPE='t'}
            {ENTIRE}
            {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')}{<{p[6]}'│'
}{<{p[7]}'│'}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}{>{p[9]-2} form(suma9,,2,' ,')}{<{p[9]}'│'}
            {ENTIRE-}
         {ELSE}
            {ENTIRE}
            {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')}{<{p[6]}'│'
}{<{p[7]}'│'}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}
            {ENTIRE-}
         {FI}  {'  Do  WYDRUKIN.STOPE=T'; ~~}
         {  suma4:=suma6:=suma9:=znacznik:=0; ~~ }
      {FI}  {'  Do  ...pierwszy & znacznik'; ~~}
{COMMENT-}
      {IF: (OP.TYP=typ_roz) & exec('mask','konto',OP.AN) & (kod<>'') & WYDRUKIN.DATA>OP.TZ}
         {  'obroty na dzien podany w parametrach'; ~~}
         {   F.RObr(OP.ref,WYDRUKIN.DATA);
             own:=F.rwn;
             oma:=F.rma; ~~}
         {IF: own$2<>oma$2}
            {IF: -WYDRUKIN.STOPE='t'}
               {INCLUDE: fks_rwzobow2.rpi}
            {ELSE}
               {INCLUDE: fks_rwzobow1.rpi}
            {FI}
         {FI}
      {FI}  {'  Do exec(mask,...';~~}
      {  petla:=OP.next(); ~~}
   {OD}  {'  Do  OP';~~}
   {IF: pierwszy & znacznik }
      {IF: -WYDRUKIN.STOPE='t'}
         {ENTIRE}
         {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')
}{<{p[6]}'│'}{<{p[7]}'│'}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}{>{p[9]-2} form(suma9,,2,' ,')}{<{p[9]}'│'}
         {ENTIRE-}
      {ELSE}
         {ENTIRE}
         {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')
}{<{p[6]}'│'}{<{p[7]}'│'}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}
         {ENTIRE-}
      {FI}  {'  Do  WYDRUKIN.STOPE=T'@;~~}
   {FI}  {'  Do  pierwszy & znacznik'@;~~}
{ELIF: w1=2}
   {IF: w2=1}
      {KH.win_sel('WER_RPM');~~}
	  {FOR: 'KH'}
      {INDEX: 'KOD'}
      {PREFIX: 2}
      {SELECT:'#EXIT'}
      {DO}
         {  platnik:=KH.NAZ;
            skrot:=KH.SKR;
            kod:=KH.KOD;
            adres:=KH.MIASTO+'  ul. '+KH.UL;
            suma4:=suma6:=suma9:=znacznik:=0; ~~}
         {  OP.index(indtym);
            {? OPERATOR.DEPT
               || OP.prefix(SSTALE.WAL,KH.ref,typ_roz,OPERATOR.DEPT)
               || OP.prefix(SSTALE.WAL,KH.ref,typ_roz)
            ?};
            petla:=OP.first();~~}
         {WHILE: petla}
         {DO}
            {IF: WYDRUKIN.DATA>OP.TZ }
               {  'obroty na dzien podany w parametrach'@; ~~}
               {   F.RObr(OP.ref,WYDRUKIN.DATA);
                   own:=F.rwn;
                   oma:=F.rma; ~~}
               {IF: own$2<>oma$2}
                  {IF: -WYDRUKIN.STOPE='t'}
                     {INCLUDE: fks_rwzobow2.rpi}
                  {ELSE}
                     {INCLUDE: fks_rwzobow1.rpi}
                  {FI}
               {FI}
            {FI}  {'  Do OP.TYP..';~~}
            {  petla:=OP.next(); ~~}
         {OD}  {'  Do  OP';~~}
         {IF: pierwszy & znacznik }
            {IF: -WYDRUKIN.STOPE='t'}
               {ENTIRE}
               {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')
}{<{p[6]}'│'}{<{p[7]}'│'}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}{>{p[9]-2} form(suma9,,2,' ,')}{<{p[9]}'│'}
               {ENTIRE-}
            {ELSE}
               {ENTIRE}
               {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')
}{<{p[6]}'│'}{<{p[7]}'│'}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}
               {ENTIRE-}
            {FI}  {'  Do  WYDRUKIN.STOPE=T'@;~~}
         {FI}  {'  Do  pierwszy & znacznik'@;~~}
      {OD}  {'  Do  KH';~~}
   {ELSE}
      {FOR: 'KH'}
      {INDEX: 'KOD'}
      {PREFIX: 2,ROZRACH.KONTR().KOD}
      {DO}
         {  platnik:=KH.NAZ;
            skrot:=KH.SKR;
            kod:=KH.KOD;
            adres:=KH.MIASTO+'  ul. '+KH.UL;
            suma4:=suma6:=suma9:=znacznik:=0; ~~}
         {  OP.index(indtym);
            {? OPERATOR.DEPT
               || OP.prefix(SSTALE.WAL,KH.ref,typ_roz,OPERATOR.DEPT)
               || OP.prefix(SSTALE.WAL,KH.ref,typ_roz)
            ?};
            petla:=OP.first(); ~~}
         {WHILE: petla}
         {DO}
            {IF: WYDRUKIN.DATA>OP.TZ }
               {  'obroty na dzien podany w parametrach'@; ~~}
               {   F.RObr(OP.ref,WYDRUKIN.DATA);
                   own:=F.rwn;
                   oma:=F.rma; ~~}
               {IF: own$2<>oma$2}
                  {IF: -WYDRUKIN.STOPE='t'}
                     {INCLUDE: fks_rwzobow2.rpi}
                  {ELSE}
                     {INCLUDE: fks_rwzobow1.rpi}
                  {FI}
               {FI}
            {FI}  {'  Do OP.TYP...';~~}
            {  petla:=OP.next(); ~~}
         {OD}  {'  Do  OP';~~}
         {IF: pierwszy & znacznik }
            {IF: -WYDRUKIN.STOPE='t'}
               {ENTIRE}
               {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')}{<{p[6]}'│'}{<{p[7]}'│'
}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}{>{p[9]-2} form(suma9,,2,' ,')}{<{p[9]}'│'}
               {ENTIRE-}
            {ELSE}
               {ENTIRE}
               {<1'│'} OGÓŁEM{<{p[1]}'│'}{<{p[2]}'│'}{<{p[3]}'│'}{>{p[4]-2} form(suma4,,2,' ,')}{<{p[4]}'│'}{<{p[5]}'│'}{>{p[6]-2} form(suma6,,2,' ,')}{<{p[6]}'│'}{<{p[7]}'│'
}{>{p[8]-2} form(suma4-suma6,,2,' ,')}{<{p[8]}'│'}
               {ENTIRE-}
            {FI}  {'  Do  WYDRUKIN.STOPE=T';~~}
         {FI}  {'  Do  pierwszy & znacznik';~~}
      {OD}  {'  Do  KH';~~}
   {FI}
{FI}  {'  Do w1';~~}