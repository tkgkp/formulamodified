:!UTF-8
{TITLE:Wydruk ewidencji VAT}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN: exec('bp_vat','!fks_vat_zrej','fks_vat_rej');
   par84:=PAR_SKID.get(84)='T'; par83:=PAR_SKID.get(83)='T';
   prewsk:=SSTALE.AR().PREWSK; procst:=SSTALE.AR().PROC_VAT; VAT7.PAR4:=-1;
   VPOZ.cntx_psh(); VPOZ_ROZ.cntx_psh()
}
{END: exec('ap_vat','!fks_vat_zrej','fks_vat_rej'); VAR_DEL.delete('par84','par83','prewsk','procst');
   VPOZ.cntx_pop(); VPOZ_ROZ.cntx_pop()
}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vat_rej.rpm
Utworzony:   ???? - ??- ?? [?????] ???????????
Modyfikacje: 2001-03-20 [AMK] Artur Makos
==================================================
Zawartosc: Wydruk rejestru VAT
{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: ~rep_expo()}{SUBSTITUTE: 'FOOT'}{FI}{EXIT: ~TMP_VAT.select()}
{ exec('in_vat','!fks_vat_zrej','fks_vat_rej');~~}
{IF: 4+RVAT.KVAT().SYM='Sprz' | 6+RVAT.KVAT().SYM='_WWspD' | 2+RVAT.KVAT().SYM='_S' | spr_zlom}
{EXIT: ~VAT7.edit}
{ param1:='Wydruk w wariancie: '+{? VAT7.PAR1=1 || 'uproszczonym' |? VAT7.PAR1=2 || 'rozszerzonym' ?};
  param2:='Uwzględniono: '+{? VAT7.PAR2=1 || 'korekty sprzedaży' |? VAT7.PAR2=2 || 'sprzedaż' || 'sprzedaż i korekty sprzedaży'?};
  param3:='Wydruk dokumentów: '+exec('vat7par3','!fks_vat_zrej');
  {? RVAT.KVAT().SYM='ZakOpod' & spr_zlom
  || param4:='Wybrano rejestr z klasą ewidencji VAT \'ZakOpod\' traktowaną jako SPRZEDAŻ';
     {? VAT7.TYP_VAT<>'' || param5:='VAT: '+{? VAT7.TYP_VAT='C' || 'naliczony' || 'należny' ?}?}
  || {? VAT7.TYP_VAT<>'' || param4:='VAT: '+{? VAT7.TYP_VAT='C' || 'naliczony' || 'należny' ?}?}
  ?};
  param6:={? VAT7.WY4=1 || 'Filtr GTU: '+{? +VAT7.JPK_GTU || STR.gsub(VAT7.JPK_GTU,',',', ') || 'Wszystkie' ?} ||'' ?};
  param7:={? VAT7.WY5=1 || 'Filtr procedur: '+{? +VAT7.JPK_PROC || STR.gsub(VAT7.JPK_PROC,',',', ') || 'Wszystkie' ?} ||'' ?};
  param8:={? VAT7.WY6=1 || 'Filtr typu dokumentu: '+{? +VAT7.JPK_TD || STR.gsub(VAT7.JPK_TD,',',', ') || 'Wszystkie' ?} ||'' ?};
  {? VAT7.PAR1=2 || prosty:=2; zak:=0 |? VAT7.PAR1=1 || prosty:=1; co:=1 ?};~~}
{ELIF: 4+RVAT.KVAT().SYM='ImpU' | RVAT.KVAT().SYM='_WWspNus'}
 {EXIT: ~VAT7.edit}
 { param1:='VAT: '+{? VAT7.PAR4=1 || 'naliczony' || 'należny' ?};
   param2:='Wydruk w wariancie: '+{? VAT7.PAR1=1 || 'uproszczonym' || 'rozszerzonym' ?};
   param3:='Uwzględniono: '+{? VAT7.PAR2=1 || 'korekty' |? VAT7.PAR2=2 || 'usługi z importu' || 'usługi z importu i korekty'?};
   param4:='Wydruk dokumentów: '+exec('vat7par3','!fks_vat_zrej');
   param6:={? VAT7.WY4=1 || 'Filtr GTU: '+{? +VAT7.JPK_GTU || STR.gsub(VAT7.JPK_GTU,',',', ') || 'Wszystkie' ?} ||'' ?};
   param7:={? VAT7.WY5=1 || 'Filtr procedur: '+{? +VAT7.JPK_PROC || STR.gsub(VAT7.JPK_PROC,',',', ') || 'Wszystkie' ?} ||'' ?};
   param8:={? VAT7.WY6=1 || 'Filtr typu dokumentu: '+{? +VAT7.JPK_TD || STR.gsub(VAT7.JPK_TD,',',', ') || 'Wszystkie' ?} ||'' ?};
   {? VAT7.PAR1=2 || prosty:=2; zak:=1 |? VAT7.PAR1=1 || prosty:=1; co:=3 ?};~~}
{ELIF: 3+RVAT.KVAT().SYM='Zak' | 6+RVAT.KVAT().SYM='_WWspN'}
 {EXIT: ~VAT7.edit("
   {? VAT7.WY2 & VAT7.DAT_ZAPL=date(0,0,0)
   || FUN.info('Nie wypełnione pole określające\ndo jakiego dnia mają być uwzględniane zapłaty.'); 'DAT_ZAPL'
   || 1
   ?}")}
 { param1:='Wydruk w podziale na: '+{? VAT7.PAR1=0 || 'stawki' || 'grupy podatkowe' ?};
   param2:='Uwzględniono: '+{? VAT7.PAR2=1 || 'korekty zakupów' |? VAT7.PAR2=2 || 'zakup' || 'zakup i korekty zakupów'?};
   param3:='Wydruk dokumentów: '+exec('vat7par3','!fks_vat_zrej');
   param4:={? UNPAR.P1 || 'Kwoty podatku VAT do odliczenia zgodnie z ustawą' || 'Kwoty podatku VAT z faktury' ?};
   {? 6+KVAT.SYM='_WWspN'
   || param5:=exec('typ_vat_str','!fks_vat_zrej',0)
   ?};
   param6:={? VAT7.WY4=1 || 'Filtr GTU: '+{? +VAT7.JPK_GTU || STR.gsub(VAT7.JPK_GTU,',',', ') || 'Wszystkie' ?} ||'' ?};
   param7:={? VAT7.WY5=1 || 'Filtr procedur: '+{? +VAT7.JPK_PROC || STR.gsub(VAT7.JPK_PROC,',',', ') || 'Wszystkie' ?} ||'' ?};
   param8:={? VAT7.WY6=1 || 'Filtr typu dokumentu: '+{? +VAT7.JPK_TD || STR.gsub(VAT7.JPK_TD,',',', ') || 'Wszystkie' ?} ||'' ?};
   {? VAT7.TYP_VAT<>'' & param5='' || param5:='VAT: '+{? VAT7.TYP_VAT='C' || 'naliczony' || 'należny' ?}?};
   {? VAT7.PAR1 || prosty:=3 |? ~VAT7.PAR1 || prosty:=1; co:=2 ?};~~}
{ELIF: 4+RVAT.KVAT().SYM='ImpT'}
{EXIT: ~VAT7.edit}
 { param1:='Wydruk w podziale na: '+{? VAT7.PAR1=0 || 'stawki' || 'grupy podatkowe i stawki %' ?};
   param2:='Uwzględniono: '+{? VAT7.PAR2=1 || 'korekty' |? VAT7.PAR2=2 || 'dostawy z importu' || 'dostawy z importu i korekty'?};
   param3:='Wydruk dokumentów: '+exec('vat7par3','!fks_vat_zrej');
   {? VAT7.TYP_VAT<>'' || param4:='VAT: '+{? VAT7.TYP_VAT='C' || 'naliczony' || 'należny' ?}?};
   param6:={? VAT7.WY4=1 || 'Filtr GTU: '+{? +VAT7.JPK_GTU || STR.gsub(VAT7.JPK_GTU,',',', ') || 'Wszystkie' ?} ||'' ?};
   param7:={? VAT7.WY5=1 || 'Filtr procedur: '+{? +VAT7.JPK_PROC || STR.gsub(VAT7.JPK_PROC,',',', ') || 'Wszystkie' ?} ||'' ?};
   param8:={? VAT7.WY6=1 || 'Filtr typu dokumentu: '+{? +VAT7.JPK_TD || STR.gsub(VAT7.JPK_TD,',',', ') || 'Wszystkie' ?} ||'' ?};
   {? VAT7.PAR1=1 || opcja:=0; prosty:=4 |? VAT7.PAR1=0 || prosty:=1; co:=4 ?};~~}
{FI}
{ {? VAT7.PAR4<>-1
  || VAT7.TYP_VAT:={? VAT7.PAR4=1 || 'C' || 'Z' ?}
  ?};
  PAR_WYDR.TITLE:=hdr_vat+exec('naz_okr_vat','!fks_vat_zrej');
  okrVat:=exec('okr_vat_wydr','!fks_vat_zrej');
  SLU.cntx_psh; SLU.index('NAZ'); SLU.prefix();
  {? SLU.find_key('~STAWKI VAT '+VAT7.KRAJ().KOD)
  || SLO.cntx_psh(); SLO.index('SL'); SLO.prefix(SLU.ref);
     sizeslo:=SLO.size; tvat:=obj_new(sizeslo);
     tn:=obj_new(sizeslo); tv:=obj_new(sizeslo); tb:=obj_new(sizeslo); tv1:=obj_new(sizeslo);
     sn:=obj_new(sizeslo); sv:=obj_new(sizeslo); sb:=obj_new(sizeslo); sv1:=obj_new(sizeslo);
     _ile:={? sizeslo<9 || 9 || sizeslo ?};
     su:=obj_new(_ile); ssu:=obj_new(8); {! _i:=1..8 |! ssu[_i]:=0 !}; is_us:=0;
     SLO.first();
     {! _a:=1 ..sizeslo |! tvat[_a]:=SLO.KOD; tn[_a]:=tv[_a]:=tb[_a]:=sn[_a]:=sv[_a]:=sb[_a]:=tv1[_a]:=sv1[_a]:=0; SLO.next() !};
     {! _a:=1.._ile
     |! su[_a]:=obj_new(4); su[_a][1]:=su[_a][2]:=su[_a][3]:=su[_a][4]:=0
     !};
     SLO.cntx_pop()
  ?}; SLU.cntx_pop();
  dokvpoch:=exec('dokvpoch','!fks_vat_zrej');
~~}
{IF: prosty=1}
{IF: (6+RVAT.KVAT().SYM='_WWspN' | KVAT.SYM='ImpUsług') & exec('typ_vat','!fks_vat_zrej')='Z'}
{tryb:=2; rejestr:=RVAT.KVAT().SYM;~~}
{INCLUDE: fks_vatrej2.rpi}
{ELSE}
{INCLUDE: fks_vatrej3.rpi}
{FI}
{ELIF: prosty=2}
  {INCLUDE: fks_vatrej5.rpi}
{ELIF: prosty=3}
  {INCLUDE: fks_vatzbzak.rpi}
{ELIF: prosty=4}
  {INCLUDE: fks_vatrzbit.rpi}
{FI}