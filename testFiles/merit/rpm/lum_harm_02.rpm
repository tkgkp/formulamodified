:!UTF-8
{TITLE:  Harmonogram umów}
{PRINTER: exec('set_parw','param_wydr'); exec('prt','param_wydr','h'),,,,,'m','b',,,,,,,,,,,,1}
{BEGIN:
   clean:="
      VAR_DEL.delete('PRN');
      VAR_DEL.delete('PRNLEG');
      VAR_DEL.delete('lp','il')
   ";
   clean();
   tryb:=rep_export();
   il:=($("PARAM_W.TAB_TMP"()+".fld_num()"))()+1;
   PRN:=obj_new(@.CLASS.PRINT, il);
   PRN.s_frame();

   PRNLEG:=obj_new(@.CLASS.PRINT,2);
   PRNLEG.s_frame();

   lp:=1;
   lm:=ll:=vp:=lmt:=rsep:=procent:=pom1:=pom2:=0;
   vp:=1;
   rsep:=1;
~~}
{END:
   clean(); VAR_DEL.delete('clean');
~~}
{MACRO: 'pr'}
{
   lp+=1;
   ~~
}
{MACRO-}
{  PAR_WYDR.TITLE:=PARAM_W.TAB_TYT;
   prn1:='PRN'; ~~}
{INCLUDE: wsp_pw.rpi}
{
   len:=2;
   PRN.add("($PARAM_W.TAB_TMP)().MIE",12,'Miesiąc'@);

   {! _it:=1..31
   |! _fml_val:='($PARAM_W.TAB_TMP)().D'+form(_it,-2);
      _fml_col:='_result:=($PARAM_W.TAB_TMP)().C'+form(_it,-2)+';exec(\'color_glue\',\'umowy_harm\',_result)';
      PRN.add($_fml_val,len,$_it,,,$_fml_col)
   !};
   ~~
}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'B'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{FONT: 'T8G'}{SPACE: 'B'}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
{FONT: 'T8G'}{SPACE: 'B'}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: tryb<>1}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{
lp:=1;
n:=($PARAM_W.TAB_TMP)().first();
~~
}
{WHILE: n}
{DO}
   {
      ($PARAM_W.TAB_TMP)().cntx_psh();
      {? ($PARAM_W.TAB_TMP)().next()=0
      || rsep:=0
      ?};
      ($PARAM_W.TAB_TMP)().cntx_pop();
      ~~
   }
   {SUBSTITUTE:'CELL'}
   {SUBSTITUTE: 'pr'}
   {n:=($PARAM_W.TAB_TMP)().next();~~}
{OD}
{SUBSTITUTE:'LINIAF'}
{"---Legenda "; ~~}
{
   HAARM_LEG.prefix();
   PRNLEG.add("HAARM_LEG.NAME",22,'Legenda'@);
   _fml_col:='_result:=HAARM_LEG.COLOR;exec(\'color_glue\',\'umowy_harm\',_result)';
   PRNLEG.add("HAARM_LEG.VAL",2,'',,,$_fml_col);
   ~~
}
{IF: HAARM_LEG.first()}
{ n:=1; lp:=1;rsep:=1;prn1:='PRNLEG';~~}
  {FONT: 'T8G'}{SPACE: 'B'}{SUBSTITUTE: 'TABHEAD'}{ vp:=1; ~~}
  {WHILE: n}
    {DO}
      {
         HAARM_LEG.cntx_psh();
         {? HAARM_LEG.next()=0
         || rsep:=0
         ?};
         HAARM_LEG.cntx_pop();
         ~~
      }
    {SUBSTITUTE: 'CELL'}
    {SUBSTITUTE: 'pr'}
    { n:=HAARM_LEG.next();~~}
    {OD}
{FI}