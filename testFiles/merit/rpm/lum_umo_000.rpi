:!UTF-8
{MACRO:'index'}
{ okno_str:="'STR'+form(WYDRUKIL.RADIOB_1+1,-2)";
  W_TMP.ndx_drop;pom[10]:=$okno_str();
  w_tmp_ndx:=W_TMP.ndx_tmp(,1,'USERS',,,'WYDRUK',,,'STR01',,,$pom[10],,)
;~~}
{MACRO-}
{MACRO:'dane_tmp'}
{W_TMP.index(w_tmp_ndx);
 {? wyb='G'
  || W_TMP.prefix(@.OPERATOR.USER().KOD,wydr_naz,GRKH.NAZ)
 |? wyb='O'
  || W_TMP.prefix(@.OPERATOR.USER().KOD,wydr_naz,OBS.NAZ)
 |? wyb='W'
  || W_TMP.prefix(@.OPERATOR.USER().KOD,wydr_naz)
 ?};
 {| W_TMP |!blank;USERS :=@.OPERATOR.USER().KOD;WYDRUK:=wydr_naz; {?wyb='G'||STR01:=@.GRKH.NAZ |?wyb='O'||STR01:=@.OBS.NAZ|?wyb='W'||STR01:=''?};
          STR02:=38+@.UM.KH().NAZ; STR03:=@.UM.SYM; STR04:=form(@.UM.OD); STR05:=form(@.UM.DO); STR06:=form(30+@.UM.FAS().NAZ);
          STR07:=form(@.UM.STU().KOD); STR08:=form(@.UM.TFAK); STR09:=form(@.UM.USERS().KOD);
          STR10:=form(@.UM.KH().GRKH().KOD); STR11:=form(@.UM.KH().OBS().KOD); STR12:=form(@.UM.KH().KOD); add|};
 ~~}
{MACRO-}
{MACRO: 'druk'}
{lp:=0; pom[1]:=''; pom[2]:=1; pom[20]:=1; ~~}
{FOR:'W_TMP'}
{INDEX: w_tmp_ndx}
{PREFIX: @.OPERATOR.USER().KOD,wydr_naz}
{DO}
   {
      wart[2]:=W_TMP.STR02;
      wart[3]:=W_TMP.STR03;
      wart[4]:=W_TMP.STR04;
      wart[5]:=W_TMP.STR05;
      wart[6]:=W_TMP.STR06;
      wart[7]:=W_TMP.STR07;
      wart[8]:=W_TMP.STR08;
      wart[9]:=W_TMP.STR09;
      {? var_pres('gkh')=2 || gkh:=W_TMP.STR10 ?};
      {? var_pres('obs')=2 || obs:=W_TMP.STR11 ?};
      {? var_pres('kkh')=2 || kkh:=W_TMP.STR12 ?};
      lp+=1
   ;~~}
   {IF: WYDRUKIL.TYP_ZEST=1 | WYDRUKIL.TYP_ZEST=0 }
      {IF: pom[1]<>W_TMP.STR01}
         {IF: pom[1]<>''}
            {
               pom[20]:=1;
               lp:=1;
               wart[2]:=W_TMP.STR02;
               wart[3]:=W_TMP.STR03;
               wart[4]:=W_TMP.STR04;
               wart[5]:=W_TMP.STR05;
               wart[6]:=W_TMP.STR06;
               wart[7]:=W_TMP.STR07;
               wart[8]:=W_TMP.STR08;
               wart[9]:=W_TMP.STR09;
               {? var_pres('gkh')=2 || gkh:=W_TMP.STR10 ?};
               {? var_pres('obs')=2 || obs:=W_TMP.STR11 ?};
               {? var_pres('kkh')=2 || kkh:=W_TMP.STR12 ?};
            ~~}
         {FI}
         {kh_grkh:=W_TMP.STR01;~~}
         {IF: pom[20]=0}
            {prn1:='PRX'; prn2:='PRN';~~}
            {SUBSTITUTE: 'LINIA0'}
         {ELSE}
            {prn1:='PRN'; prn2:='PRX';~~}
            {SUBSTITUTE: 'LINIA02'}
         {FI}
         {pom[20]:=0;~~}
         {pom[2]:=0;~~}
         {pom[1]:=W_TMP.STR01;~~}
      {FI}
      {kh_grkh:=W_TMP.STR02;~~}
      {IF: pom[20]=0}
         {prn1:='PRX'; prn2:='PRN';~~}
         {SUBSTITUTE: 'LINIA02'}
      {ELSE}
         {prn1:='PRN'; prn2:='PRX';~~}
         {SUBSTITUTE: 'LINIA0'}
      {FI}
      {pom[20]:=1;~~}
      {pom[2]:=1;~~}
   {ELIF: WYDRUKIL.TYP_ZEST=2 }
      {kh_grkh:=W_TMP.STR02;~~}
      {pom[20]:=1;~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{OD}
{pom[20]:=1;~~}
{MACRO-}
{MACRO: 'param_info'}
PARAMETRY WYDRUKU:
ZAKRES DAT POCZ: od: {WYDRUKIL.OD_DATY} do: {WYDRUKIL.DO_DATY}
ZAKRES DAT KON : od: {WYDRUKIL.OD_DATY} do: {WYDRUKIL.DO_DATY}
UMOWY: {IF: WYDRUKIL.UM=1} AKTYWNE {ELIF: WYDRUKIL.UM=2} NIE AKTYWNE {ELIF: WYDRUKIL.UM=3} WSZYSTKIE {FI}
TYP ZESTAWIENIA : {IF: WYDRUKIL.TYP_ZEST=1 } Wg grup kontrah {ELIF: WYDRUKIL.TYP_ZEST=0 }  Wg obszarów sprzedaży {ELIF: WYDRUKIL.TYP_ZEST=2 } Bez podziału {FI}
KLUCZ SORTOWANIA: {IF: WYDRUKIL.RADIOB_1 = 1}Kontrahent
                  {ELIF: WYDRUKIL.RADIOB_1 = 2}Numer umowy
                  {ELIF: WYDRUKIL.RADIOB_1 = 3}Od daty
                  {ELIF: WYDRUKIL.RADIOB_1 = 4}Do daty
                  {ELIF: WYDRUKIL.RADIOB_1 = 5}Sposób fakturowania
                  {ELIF: WYDRUKIL.RADIOB_1 = 6}Status umowy
                  {ELIF: WYDRUKIL.RADIOB_1 = 7}Fakturowanie wg umowy
                  {ELIF: WYDRUKIL.RADIOB_1 = 8}Użytkownik rejestrujący
                  {FI}
OBSZAR ROBOCZY: {IF: ODDZIAL=1} {{? ODDZ.find_key(ST.ODDZ) || 20+ODDZ.NAZ || ST.ODDZ ?}} {ELIF: ODDZIAL=2} WSZYSTKIE ODDZIAŁY {FI}
{MACRO-}