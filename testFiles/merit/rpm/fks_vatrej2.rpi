:!UTF-8
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vatrej2.rpi
Utworzony:   ???? - ??- ?? [?????] ???????????
Modyfikacje: 2001-03-20 [AMK] Artur Makos
==================================================
Zawartosc: Plik wykorzystywany w wydrukach VAT:
tryb=2 - 'Uslugi z importu'
tryb=3 - 'Rejestr zakupow VAT'
tryb=4 - 'Rejestr sprzedazy VAT'
{COMMENT-}
{'       WYDRUK   wg.   STAWEK   VAT       ';~~}
{ {? var_press('WAL',VAT7)<=0 || exec('par_1','!fks_vat_zrej') || exec('par_6','!fks_vat_zrej') ?};~~}
{ {? VAT7.WYD_TECH || PAR_WYDR.HEAD:=PAR_WYDR.LOGO:=0 ?}; colspan:=0;~~}
{ szer[1]:=9; szer[2]:=51; szer[3]:=12; szer[4]:=13; szer[5]:={? tryb=4 || 80 || 63 ?};
  szer[6]:=5; szer[7]:=20; szer[8]:=16; szer[9]:=20; szer[15]:=4; szer[16]:=11;szer[17]:=7;
  {? OPERATOR.DEPT=null ||
     szer[5]-=8; szer[4]+=8
  ?};
  {? +param6++param7++param8>0
 || _szer:={? +param6>0 || szer[17]+1 || 0 ?} + {? +param7>0 || szer[4]+1 || 0 ?}+{? +param8>0 || szer[17]+1 || 0 ?}
 || _szer:=0
 ?};
 szer[5]-=_szer;
  PRN.add("w[18]",szer[15],' Lp.',1); colspan:=colspan+1; w[18]:='';
  {? rep_expo()
  || PRN.add("w[43]",szer[1],'Rej. VAT');colspan:=colspan+1
  || PRN.add("w[1]",szer[1],'Rej. VAT/ pozycja')
  ?};
  {? tryb=3 & VAT7.WY2
  || {? rep_expo()
     || PRN.add("w[42]",szer[2],'Symbol dokumentu',,'#');colspan:=colspan+1;
        PRN.add("w[26]",szer[2],'Zapłacono',,'#');colspan:=colspan+1
     || PRN.add("w[2]",szer[2],'Symbol dokumentu/Zapłacono',,'#')
     ?}
  |? tryb=4
  || {? rep_expo()
     || PRN.add("w[42]",szer[2],'Symbol dokumentu',,'#');colspan:=colspan+1;
        PRN.add("w[26]",szer[2],'Termin płatności',,'#');colspan:=colspan+1
     || PRN.add("w[2]",szer[2],'Symbol dokumentu/Termin płatności',,'#')
     ?}
  || PRN.add("w[42]",szer[2],'Symbol dokumentu');colspan:=colspan+1
  ?};
 {? tryb=1
 || {? rep_expo()
     || PRN.add("w[27]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[28]",szer[3],'Data odp. celnej',,'#');colspan:=colspan+1;
        PRN.add("w[29]",szer[3],'Data otrzymania',,'#');colspan:=colspan+1
     || PRN.add("w[3]",szer[16],'D. zapisu/#odp. celnej/# otrzymania',,'#')
     ?}
 |? tryb=2
 ||  {? rep_expo()
     || PRN.add("w[27]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[28]",szer[3],'Data wystawienia',,'#');colspan:=colspan+1;
        PRN.add("w[29]",szer[3],'Data otrzymania',,'#');colspan:=colspan+1
     || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia',,'#')
     ?}
 |? tryb=3
 || {? rep_expo()
     || PRN.add("w[27]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
        PRN.add("w[28]",szer[3],'Data wystawienia',,'#');colspan:=colspan+1;
        {? 4+rejestr<>'ImpU' || PRN.add("w[29]",szer[3],'Data otrzymania',,'#'); colspan:=colspan+1?}
     || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia'+{? 4+rejestr<>'ImpU' || '/# otrzymania' || '' ?},,'#')
     ?}
 |? tryb=4
 || {? rejestr='SprzEksp'
    || {? rep_expo()
       || PRN.add("w[27]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
          PRN.add("w[28]",szer[3],'Data wystawienia',,'#');colspan:=colspan+1;
          PRN.add("w[29]",szer[3],'Data odpr. cel.',,'#');colspan:=colspan+1
       || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia/#odpr. cel.',,'#')
       ?}
    || {? VAT7.PAR2=2
       || {? rep_expo()
          || PRN.add("w[27]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
             PRN.add("w[28]",szer[3],'Data wystawienia',,'#');colspan:=colspan+1
          || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia',,'#')
          ?}
       || {? rep_expo()
          || PRN.add("w[27]",szer[3],'Data zapisu',,'#');colspan:=colspan+1;
             PRN.add("w[28]",szer[3],'Data wystawienia',,'#');colspan:=colspan+1;
             PRN.add("w[29]",szer[3],'Data potw. odb.',,'#');colspan:=colspan+1
          || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia/#potw. odb.',,'#')
          ?}
       ?}
    ?}
 ?};
{? rep_expo()
|| {? OPERATOR.DEPT=null|| PRN.add("w[30]",szer[4],'Jednostka księgowa',,'#');colspan:=colspan+1?};
   PRN.add("w[31]",szer[4],' Rej. księg.',,'#');colspan:=colspan+1;
   PRN.add("w[32]",szer[4],'Pozycja',,'#');colspan:=colspan+1
|| PRN.add("w[4]",szer[4],{? OPERATOR.DEPT=null||'Jednostka.Ks#'||''?}+' Rej.Ks '+' pozycja',,'#')
?};
{? rep_expo()
|| PRN.add("w[41]",szer[5],(szer[5]-61)%2*' '+'Kontrahent - nazwa, siedziba, numer identyfikacyjny'+{? grupa_vat='SprPKWSU' | grupa_vat='SprPozKr' ||', nazwa usługi'||''?});colspan:=colspan+1
|| PRN.add("w[5]",szer[5],(szer[5]-61)%2*' '+'Kontrahent - nazwa, siedziba, numer identyfikacyjny'+{? grupa_vat='SprPKWSU' | grupa_vat='SprPozKr' ||', nazwa usługi'||''?})
?};
{? param6<>''
|| PRN.add("w[50]",szer[17],'GTU',)
?};
{? param7<>''
|| PRN.add("w[51]",szer[4],'Procedury',)
?};
{? param8<>''
|| PRN.add("w[52]",szer[17],'Typ JPK',)
?};
 PRN.add("w[6]",szer[6],'% VAT',1);  PRN.add("w[7]",szer[7],'       Netto',1);
 {? tryb=3 | (tryb=2 & exec('typ_vat','!fks_vat_zrej')='C')
 || PRN.add("w[8]",szer[8],'VAT do odliczenia',1);
    PRN.add("w[19]",szer[8],'VAT nie podlegający odliczeniu',1)
 || PRN.add("w[8]",szer[8],'VAT',1)
 ?};
 PRN.add("w[9]",szer[9],'       Brutto',1);
 PRN1.add("ww[1]",szer[1]+szer[2]+szer[16]+szer[4]+szer[5]+szer[15]+5+_szer,'',,,,,,,,colspan);
 PRN1.add("ww[2]",szer[6],'',1);
 PRN1.add("ww[3]",szer[7],'',1);
 PRN1.add("ww[4]",szer[8],'',1); {? tryb=3 | (tryb=2 & exec('typ_vat','!fks_vat_zrej')='C') || PRN1.add("ww[6]",szer[8],'',1) ?};
 PRN1.add("ww[5]",szer[9],'',1);~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}{IF: ~VAT7.WYD_TECH}{LINE: 1}{FI}
{SUBSTITUTE: 'HEAD'}{FONT: 'W8'}{SPACE: 'C'}{IF: page=1}
{<3 'Parametry wydruku:'}
{<6 'Jednostka księgowa: '+{? OPERATOR.DEPT || OPERATOR.DEPT().OD || 'wszystkie jednostki księgowe' ?}+{? VAT7.TYPOKR='M' || '   Rodzaj okresu: '+{? SSTALE.AO().ZAM='T'||'zamknięty'||'otwarty'?} || '' ?}}
{IF: ~VAT7.WYD_TECH}{IF: dokvpoch<>''}{<6 dokvpoch}{FI}
{<6 'Kraj opodatkowania: '+kraj+{? wal_op<>'' || '   Waluta opodatkowania: '+wal_op || '' ?}}
{IF: param1<>''}
{<6 param1}{FI}{IF: param2<>''}
{<6 param2}{FI}{IF: param3<>''}
{<6 param3}{FI}{IF: param4<>''}
{<6 param4}{FI}{IF: param6<>''}
{<6 param6}{FI}{IF: param7<>''}
{<6 param7}{FI}{IF: param8<>''}
{<6 param8}{FI}
{IF: tryb=3 & VAT7.DAT_ZAPL<>date(0,0,0)}{<6 'Data zapłaty: '+$VAT7.DAT_ZAPL+{? VAT7.TYLKOZAP || ' - tylko zapłacone'|| '' ?}}{FI}
{FI}{FI}
{LINE: 1}{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{IF: page=1}{REP: PRN.fbar()}{FI}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------MACRO-LINIA------------------{COMMENT-}
{MACRO: 'LINIA'}
{IF: ~font_gr}{IF: s2c}{FONT: 'T8U'}{ELSE}{FONT: 'T8G'}{FI}{ELSE}{FONT: 'T8GB'}{FI}{ PRN.setcolor('255:255:255');~~}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{ vp:=0; PRN.setcolor('255:255:255'); ~~}
{REP: PRN.fline()}
{OD}{ vp:=0; PRN.setcolor(color); ~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINIA1------------------{COMMENT-}
{MACRO: 'LINIA1'}
{IF: ~font_gr}{FONT: 'T8G'}{ELSE}{FONT: 'T8GB'}{FI}{ PRN1.setcolor('255:255:255');~~}
{PRN1.ini_line()}
{WHILE: PRN1.next()}
{DO}
{REP: PRN1.fline()}
{OD}{ vp:=0; PRN1.setcolor(color); ~~}
{MACRO-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{SPACE: 'C'}
{IF: VAT7.WY3}
{FOOTER: 0}{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{REP: PRN1.fhbar()}{ww[1]:='   SUMA STRONY'; ww[2]:=''; ww[3]:= form(sstr7,,2,' ,'); ww[4]:= form(sstr8,,2,' ,');  ww[6]:= form(sstr10,,2,' ,'); ww[5]:= form(sstr9,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{IF: page>1}{ww[1]:='   Z PRZENIESIENIA'; ww[2]:=''; ww[3]:=form((suma7-sstr7),,2,' ,'); ww[4]:=form((suma8-sstr8),,2,' ,');  ww[6]:=form((suma10-sstr10),,2,' ,'); ww[5]:=form((suma9-sstr9),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{FI}{ww[1]:='   DO PRZENIESIENIA'; ww[2]:=''; ww[3]:=form(suma7,,2,' ,'); ww[4]:=form(suma8,,2,' ,');  ww[6]:=form(suma10,,2,' ,'); ww[5]:=form(suma9,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.flbar()}{ELSE}{PRN1.lbar()}{FI}{ sstr7:=sstr8:=sstr9:=sstr10:=0; vp:=1;~~}
{FOOTER-}
{ELSE}
{FOOTER: 0}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}{ vp:=1;~~}
{FOOTER-}
{FI}
{COMMENT}------------------------------MACRO-SUMASTR----------------{COMMENT-}
{MACRO: 'SUMASTR'}
{  {? DVAT.USUNIETY
   || is_us:=1;
      {! _a:=1 ..sizeslo
      |! su[_a][1]+=tn[_a]; su[_a][2]+=tv[_a]; su[_a][3]+=tv1[_a]; su[_a][4]+=tb[_a];
         ssu[1]+=tn[_a]; ssu[2]+=tv[_a]; ssu[3]+=tv1[_a]; ssu[4]+=tb[_a]
      !}
   || {! _a:=1 ..sizeslo
      |! sstr7+=tn[_a]; suma7+=tn[_a];  sstr8+=tv[_a]; sstr10+=tv1[_a]; suma8+=tv[_a]; suma10+=tv1[_a]; sstr9+=tb[_a]; suma9+=tb[_a];
         rej_1+=tn[_a]; rej_3+=tb[_a];  rej_2+=tv[_a]; rej_4+=tv1[_a]
      !}
   ?}; ~~}
{MACRO-}
{COMMENT}------------------------------MACRO-PETLA------------------{COMMENT-}
{MACRO: 'PETLA'}
{IF: (tryb=2 & (DVAT.RVAT().KVAT().SYM='ImpUsług' | KVAT.SYM='_WWspNus')) | 6+rejestr<>'_WWspN' & 4+rejestr<>'ImpU' | DVAT.RVAT().KVAT().SYM<>'_WWspNus'}
{ dat_zapl:=date(0,0,0);
  _a:=DVAT.DOKOKRO().ROK().KOD+form(DVAT.DOKOKRO().NR,-2);
  DOK.use('doku'+_a); POZ.use('pozy'+_a); POW.use('pow_'+_a); VPOZ.use('pozv'+_a); VPOZ_ROZ.use('pozr'+_a);
  DOK.prefix(); DVAT.DOK();
  {? tryb=3 & VAT7.WY2
  || dat_zapl:=exec('spr_roz1','!fks_vat_zrej',DVAT.DOK,DVAT.SYM1,DVAT.DOKOKRO().ROK().KOD,DVAT.DOKOKRO().NR,VAT7.DAT_ZAPL,DVAT.DAT2)
  ?};~~
}
{IF:   (VAT7.WY4<>0 & (VAT7.WY4=1 & {? VAT7.JPK_GTU='' || 1
                                  |? VAT7.JPK_GTU*'BRAK'>0 & DVAT.DOK().JPK_GTU='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_GTU,DVAT.DOK().JPK_GTU)
                                  ?})) |
  (VAT7.WY5<>0 & (VAT7.WY5=1 & {? VAT7.JPK_PROC='' || 1
                                  |? VAT7.JPK_PROC*'BRAK'>0 & DVAT.DOK().JPK_PROC='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_PROC,DVAT.DOK().JPK_PROC)
                                  ?})) |
   (VAT7.WY6<>0 & (VAT7.WY6=1 & {? VAT7.JPK_TD='' || 1
                                  |? VAT7.JPK_TD*'BRAK'>0 & DVAT.DOK().JPK_V_T='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_TD,DVAT.DOK().JPK_V_T)
                                  ?})) |
   (VAT7.WY4=0 & VAT7.WY5=0 & VAT7.WY6=0)
                                  }
{IF: tryb<>3 | ~VAT7.TYLKOZAP | (VAT7.TYLKOZAP & dat_zapl<>date(0,0,0) & dat_zapl<=VAT7.DAT_ZAPL)}
{IF: exec('chk_okr_vat','!fks_vat_zrej')}
    {IF: ((VAT7.PAR2=2) & (-DOK.DOK_REJ().KOR='n')) |
           ((VAT7.PAR2=1) & (-DOK.DOK_REJ().KOR='t')) |
           (VAT7.PAR2=3)}
   { kor:=DOK.DOK_REJ().KOR='T';
     w[1]:=w[43]:=DVAT.RVAT().SYM;
     w[2]:=DVAT.SYM1;
     w[3]:=DVAT.DAT1$1;
     w[13]:=DVAT.DAT2$1;
     w[14]:=DVAT.DAT4$1;
     DVAT.DOK().REJ();
     w[4]:={? OPERATOR.DEPT=null
           || REJ.ODD().OD
           || REJ.KOD+(8-(+REJ.KOD))*' '+form(DVAT.DOK().NR,szer[4]-8,,'99') ?};
     w[25]:=$DVAT.NR;
     w[26]:={? tryb=3 & VAT7.WY2 || w[11]:={? dat_zapl<>date(0,0,0)  & dat_zapl<=VAT7.DAT_ZAPL || dat_zapl$1 || 10*'-' ?}
  |? tryb=4 & DOK.D3<>date(0,0,0) || w[11]:=$DOK.D3 ?};
     w[27]:=DVAT.DAT1$1;
     w[28]:=DVAT.DAT2$1;
     w[29]:={? 6+rejestr<>'_WWspN' & 4+rejestr<>'ImpU' || DVAT.DAT4$1 || '' ?};
     w[30]:=REJ.ODD().OD;
     w[31]:=REJ.KOD;
     w[32]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
     w[33]:=$DVAT.NR;
     w55:=w[41]:=exec('szukkh','!fks_vat_zrej');
     w[42]:=DVAT.SYM1;
     {? param6<>'' || w[50]:=DVAT.DOK().JPK_GTU || w[50]:='' ?};
     {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
     {? param7<>'' || w[51]:=DVAT.DOK().JPK_PROC;  w[51]:=STR2.gsub(w[51],',',', ') || w[51]:='' ?};
     {? param8<>'' || w[52]:=DVAT.DOK().JPK_V_T || w[52]:='' ?};
     ok:=0;StrVat:=';';~~
    }
    {FOR: 'PVAT'}
    {INDEX: 'DVAT_ST'}
    {PREFIX: DVAT.ref}
    {DO}
      {IF: (grupa_vat<>'SprPKWSU' & grupa_vat<>'SprPozKr') | exec('wsu_p','!fks_vat_zrej')}
      {IF: (rejestr='ImpU' & ((VAT7.PAR4=1 & (1+PVAT.GRVAT().KOD='Z')) | VAT7.PAR4=2)) | rejestr<>'ImpU'}
      {IF: (menu_txt<>'C. Eksport towarów' & 3+menu_txt<>'N.1') | (menu_txt='C. Eksport towarów' & PVAT.STVAT().KOD=' 0 %') | (3+menu_txt='N.1' & PVAT.STVAT().KOD=' -')}
      {IF: (rejestr<>'SprzNOp' | exec('czy_sprznop','!fks_vat_zrej') )
           | (menu_txt='L. Czynności nieopodatkowane na terytorium kraju' & PVAT.GRVAT().KOD='SprPozKr' & VAT7.PAR10=3)}
      {IF: exec('typ_okr_vat','!fks_vat_zrej',2)}
       { ok:=1; _grupa:=PVAT.GRVAT().KOD;
        {! _a:=1 ..sizeslo
        |! {? PVAT.STVAT().KOD=tvat[_a]
           || {? tryb=2 | tryb=3
              || {? ~UNPAR.P1
                 || "dla zakupów: gdy UNPAR.P1 = 1 wg ustawy, 0 gdy z dokumentów";
                    {? (-_grupa='zakupods' | -_grupa='zinwpods')
                    || {? 6+RVAT.KVAT().SYM='_WWspN' & VAT7.TYP_VAT='Z'
                       || tv[_a]+=PVAT.VAT; _net_odl:=PVAT.SUM2; {? DVAT.USUNIETY=0 || sv[_a]+=PVAT.VAT ?}
                       || _vat_odl:=PVAT.VAT_ODL;
                          tv[_a]+=_vat_odl; tv1[_a]+=PVAT.VATKOSZT;
                          _net_odl:={? PVAT.VAT || (PVAT.SUM2*_vat_odl/PVAT.VAT)$2 || PVAT.SUM2$2 ?};
                          {? DVAT.USUNIETY=0 || sv[_a]+=_vat_odl; sv1[_a]+=PVAT.VATKOSZT ?}
                       ?}
                    || tv[_a]+=PVAT.VAT_ODL; tv1[_a]+=PVAT.VATKOSZT; _net_odl:=PVAT.SUM2;
                       {? DVAT.USUNIETY=0 || sv[_a]+=PVAT.VAT_ODL; sv1[_a]+=PVAT.VATKOSZT ?}
                    ?}
                 || {? 'ZInwPodS,ZInwPodZ,ZakPRopZ,ZakuPodS,ZakuPodZ,ZInwNPod,ZPozNPal,ZPozNPod,ZakupNpr'*_grupa
                    || tv[_a]+=PVAT.VAT_ODL; tv1[_a]+=PVAT.VATKOSZT;
                       _net_odl:={? PVAT.VAT
                                 || (PVAT.SUM2*PVAT.VAT_ODL/PVAT.VAT)$2
                                 |? par84
                                 || _tab:={? PVAT.VPOZ_ROZ || PVAT.VPOZ_ROZ(); VPOZ_ROZ || PVAT.VPOZ_REF(); VPOZ ?};
                                    _net_odl:={? _grupa='ZakuPodS' | _grupa='ZInwPodS'
                                              || (PVAT.SUM2/2)$2
                                              || PVAT.SUM2
                                              ?};
                                    (_net_odl
                                     *({? par83
                                       || {? _tab.C_PROC_S || procst/100 || 1 ?}
                                       || procst/100
                                       ?})
                                     *({? par83 & _tab.C_PREWSK || prewsk/100 || 1 ?}))$2
                                 || 0
                                 ?};
                       {? DVAT.USUNIETY=0 || sv[_a]+=PVAT.VAT_ODL; sv1[_a]+=PVAT.VATKOSZT ?}
                    |? _grupa='ZakuPods' | _grupa='ZInwPods'
                    ||  _vat_odl:=(PVAT.VAT/2)$2;
                       tv[_a]+=_vat_odl ; tv1[_a]+=PVAT.VAT-_vat_odl;
                       _net_odl:={? PVAT.VAT
                                 || (PVAT.SUM2*_vat_odl/PVAT.VAT)$2
                                 |? par84
                                 || (PVAT.SUM2/2)$2
                                 || 0
                                 ?};
                       {? DVAT.USUNIETY=0 || sv[_a]+=_vat_odl; sv1[_a]+=(PVAT.VAT-(_vat_odl)$2) ?}
                    || tv[_a]+=PVAT.VAT_ODL; tv1[_a]+=PVAT.VATKOSZT;  _net_odl:=PVAT.SUM2;
                       {? DVAT.USUNIETY=0 || sv[_a]+=PVAT.VAT_ODL; sv1[_a]+=PVAT.VATKOSZT ?}
                    ?}
                 ?}
              || tv[_a]+=PVAT.VAT; _net_odl:=PVAT.SUM2; {? DVAT.USUNIETY=0 || sv[_a]+=PVAT.VAT ?}
              ?};

              tn[_a]+=_net_odl;  tb[_a]+=PVAT.SUM1; StrVat+=$_a+';';
              {? DVAT.USUNIETY=0 || sn[_a]+=_net_odl;  sb[_a]+=PVAT.SUM1 ?}
           ?}
        !};
        {? DVAT.USUNIETY=0 & VAT7.WY2 & dat_zapl<>date(0,0,0) & dat_zapl<=VAT7.DAT_ZAPL
        || {? tryb=2 | tryb=3
           || {? ~UNPAR.P1
              || {? (-_grupa='zakupods' | -_grupa='zinwpods')
                 || w[22]+=(PVAT.VAT/2)$2; w[24]+=(PVAT.VAT-(PVAT.VAT/2)$2);
                    w[21]+={? PVAT.VAT || (PVAT.SUM2*(PVAT.VAT/2)$2/PVAT.VAT)$2 || PVAT.SUM2$2 ?}
                 || w[22]+=PVAT.VAT_ODL; w[24]+=PVAT.VATKOSZT; w[21]+=PVAT.SUM2
                 ?}
              || {? 'ZInwPodS,ZInwPodZ,ZakPRopZ,ZakuPodS,ZakuPodZ,ZInwNPod,ZPozNPal,ZPozNPod,ZakupNpr'*_grupa
                 || w[22]+=PVAT.VAT_ODL; w[24]+=PVAT.VATKOSZT;
                    w[21]+={? PVAT.VAT
                           || (PVAT.SUM2*PVAT.VAT_ODL/PVAT.VAT)$2
                           |? par84
                           || _tab:={? PVAT.VPOZ_ROZ || PVAT.VPOZ_ROZ(); VPOZ_ROZ || PVAT.VPOZ_REF(); VPOZ ?};
                              _net_odl:={? _grupa='ZakuPodS' | _grupa='ZInwPodS'
                                        || (PVAT.SUM2/2)$2
                                        || PVAT.SUM2
                                        ?};
                              (_net_odl
                               *({? par83
                                 || {? _tab.C_PROC_S || procst/100 || 1 ?}
                                 || procst/100
                                 ?})
                               *({? par83 & _tab.C_PREWSK || prewsk/100 || 1 ?}))$2
                           || 0
                           ?}
                 |? _grupa='ZakuPods' | _grupa='ZInwPods'
                 || _vat_odl:=(PVAT.VAT/2)$2;
                    w[22]+=_vat_odl; w[24]+=PVAT.VAT-_vat_odl;
                    w[21]+={? PVAT.VAT
                           || (PVAT.SUM2*_vat_odl/PVAT.VAT)$2
                           |? par84
                           || (PVAT.SUM2/2)$2
                           || 0
                           ?}
                 || w[22]+=PVAT.VAT_ODL; w[24]+=PVAT.VATKOSZT; w[21]+=PVAT.SUM2
                 ?}
              ?}
            || w[22]+=PVAT.VAT; w[21]+=PVAT.SUM2
            ?};
            w[23]+=PVAT.SUM1
        ?};~~
        }
      {FI}
      {FI}
      {FI}
      {FI}
      {FI}
    {OD}
{COMMENT}----------------------WYDRUK-------------------------------------------------{COMMENT-}
{IF: ok}
{{? ~rep_expo()
 || STR2.split(w[50]);
    STR3.split(w[51]) ?}; ~~}
{IF: grupa_vat='SprPKWSU' | grupa_vat='SprPozKr'}
{ENTIRE}
{ exec('wsu_gen','!fks_vat_zrej',0);~~}
{IF: WSU_TAB.size()+1>lineleft() & lineleft()<>0}{ vp:=1;~~}{PAGE}{FI}
{IF: (lineleft()<>0 & vp) | rep_expo()}{REP: PRN.fbar()}{ELIF: ~vp}{PRN.bar()}{FI}
{{? ~rep_expo() || w[5]:=STR.line(szer[5]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]) ?}; w[52]:=DVAT.DOK().JPK_V_T; ~~}
{FOR: WSU_TAB}
{DO}
{exec('wsu_line','!fks_vat_zrej'); ~~}
{IF: page<>1 & lineleft()=0}{REP: PRN.fbar()}{FI}
{IF: w[6]<>'' | w[2]<>''}{SUBSTITUTE: 'LINIA'}
{{? ~rep_expo() || w[5]:=STR.line(szer[5]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]); w[52]:='' ?};~~}
{FI}
{OD}
{w[1]:=w[2]:=w[3]:=w[4]:=w[6]:=w[7]:=w[8]:=w[9]:=w[10]:='';w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:=w[52]:='';~~}
{WHILE: (w[50]<>'' | w[51]<>'') & ~rep_expo()}
{DO}
{SUBSTITUTE: 'LINIA'}
{w[1]:=w[2]:=w[3]:=w[4]:=w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:=w[50]:=w[51]:=w[52]:='';
w[5]:=STR.line(szer[5]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]);~~}
{OD}
{w[5]:=w[50]:=w[51]:='';~~}
{SUBSTITUTE: 'SUMASTR'}
{ENTIRE-}
{ELSE}
{ _pom:=1;
  ile_l:=exec('ilelinii','rozrach',w55,szer[5]);
  {! _i:=1..sizeslo |!  {? tn[_i]$2<>0 | tv[_i]$2<>0 | tv1[_i]$2<>0 | tb[_i]$2<>0 || _pom+=1 ?} !};
  {? rejestr='_WWspN'
  || {? ile_l>=2 &  _pom<5 || _pom:=5 ?}; {? _pom>=lineleft() || vp:=1 || vp:=0 ?}
  || {? (tryb<>4 | kor | ile_l>=3) &  _pom<4
     || _pom:=4
     |?  ~(tryb<>4 | kor | ile_l>=3)
     || _pom:=3
     ?}; {? _pom>lineleft() || vp:=1 || vp:=0 ?}
  ?};
  STR.split(w55); w[5]:=STR.line(szer[5]);~~}
{ENTIRE}{pom:=1; ~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0) & ~(StrVat*(';'+$pom+';'))}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
   ||  w[6]:=form(tvat[pom],,2,' ,');  w[7]:=form(tn[pom],,2,' ,'); w[8]:=form(tv[pom],,2,' ,');  w[19]:=form(tv1[pom],,2,' ,');
       w[9]:=form(tb[pom],,2,' ,');
       {? rep_expo()
        || w[1]:=w[43]:=DVAT.RVAT().SYM;
           w[25]:=$DVAT.NR;
           w[42]:=DVAT.SYM1;
           w[26]:={? tryb=3 & VAT7.WY2 || w[11]:={? dat_zapl<>date(0,0,0)  & dat_zapl<=VAT7.DAT_ZAPL || dat_zapl$1 || 10*'-' ?} |? tryb=4 & DOK.D3<>date(0,0,0) || w[11]:=$DOK.D3 ?};
           w[27]:=DVAT.DAT1$1;
           w[28]:=DVAT.DAT2$1;
           w[29]:={? rejestr<>'_WWspN' || DVAT.DAT4$1 || '' ?};
           w[30]:=REJ.ODD().OD;
           w[31]:=REJ.KOD;
           w[32]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
           w[33]:=$DVAT.NR;
           w[50]:=DVAT.DOK().JPK_GTU;
           w[51]:=DVAT.DOK().JPK_PROC;
           w[52]:=DVAT.DOK().JPK_V_T;
           w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
        ?};
       pom+=1
   ||  w[6]:=w[41]:=''; w[7]:=w[8]:=w[9]:=w[19]:=form(0,,2,' ,')
   ?};~~}
{IF: linijka}{IF: vp | rep_expo()}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}{FI}{ linijka:=1;numer+=1;w[18]:=$numer;s2c:=DVAT.USUNIETY;~~}
{IF: ~rep_expo()}{w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]);~~}{FI}
{SUBSTITUTE: 'LINIA'}{ dru_rej:=1; w[18]:=w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:=w[50]:=w[51]:=w[52]:='';~~}
{  w[1]:=$DVAT.NR; w[2]:=w[3];
   w[4]:={? OPERATOR.DEPT=null || DVAT.DOK().REJ().KOD+(8-(+DVAT.DOK().REJ().KOD))*' '+form(DVAT.DOK().NR,szer[4]-8,,'99') || ''?};
   w[3]:=w[13]; w[5]:=STR.line(szer[5]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]); ile_l-=1; ~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0) & ~(StrVat*(';'+$pom+';'))}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
   ||   w[6]:=form(tvat[pom],,2,' ,'); w[7]:=form(tn[pom],,2,' ,'); w[8]:=form(tv[pom],,2,' ,'); w[19]:=form(tv1[pom],,2,' ,');
        w[9]:=form(tb[pom],,2,' ,');
        {? rep_expo()
        || w[1]:=w[43]:=DVAT.RVAT().SYM;
           w[25]:=$DVAT.NR;
           w[42]:=DVAT.SYM1;
           w[26]:={? tryb=3 & VAT7.WY2 || w[11]:={? dat_zapl<>date(0,0,0)  & dat_zapl<=VAT7.DAT_ZAPL || dat_zapl$1 || 10*'-' ?} |? tryb=4 & DOK.D3<>date(0,0,0) || w[11]:=$DOK.D3 ?};
           w[27]:=DVAT.DAT1$1;
           w[28]:=DVAT.DAT2$1;
           w[29]:={? rejestr<>'_WWspN' || DVAT.DAT4$1 || '' ?};
           w[30]:=REJ.ODD().OD;
           w[31]:=REJ.KOD;
           w[32]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
           w[33]:=$DVAT.NR;
           w[50]:=DVAT.DOK().JPK_GTU;
           w[51]:=DVAT.DOK().JPK_PROC;
           w[52]:=DVAT.DOK().JPK_V_T;
           w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
        ?};
        pom+=1
   ||   w[6]:=w[41]:=w[7]:=w[8]:=w[9]:=w[19]:=''
   ?};~~
}
{ {? tryb=3 & VAT7.WY2 || w[2]:={? dat_zapl<>date(0,0,0)  & dat_zapl<=VAT7.DAT_ZAPL || dat_zapl$1 || 10*'-' ?}
  |? tryb=4 & DOK.D3<>date(0,0,0) || w[2]:={? ~rep_expo() || $DOK.D3 ?} ?} ;~~}
{SUBSTITUTE: 'LINIA'}
{ w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]); w[52]:='';~~ }
 {w[1]:=w[2]:=w[3]:=w[4]:=w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:='';
 {? tryb<>4 | kor | rejestr ='SprzEksp' || w[3]:=w[14]?};w[5]:=STR.line(szer[5]); ile_l-=1; ~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0) & ~(StrVat*(';'+$pom+';'))}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
   ||   w[6]:=form(tvat[pom],,2,' ,');  w[7]:=form(tn[pom],,2,' ,'); w[8]:=form(tv[pom],,2,' ,'); w[19]:=form(tv1[pom],,2,' ,');
        w[9]:=form(tb[pom],,2,' ,');
        {? rep_expo()
        || w[1]:=w[43]:=DVAT.RVAT().SYM;
           w[25]:=$DVAT.NR;
           w[42]:=DVAT.SYM1;
           w[26]:={? tryb=3 & VAT7.WY2 || w[11]:={? dat_zapl<>date(0,0,0)  & dat_zapl<=VAT7.DAT_ZAPL || dat_zapl$1 || 10*'-' ?} |? tryb=4 & DOK.D3<>date(0,0,0) || w[11]:=$DOK.D3 ?};
           w[27]:=DVAT.DAT1$1;
           w[28]:=DVAT.DAT2$1;
           w[29]:={? rejestr<>'_WWspN' || DVAT.DAT4$1 || '' ?};
           w[30]:=REJ.ODD().OD;
           w[31]:=REJ.KOD;
           w[32]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
           w[33]:=$DVAT.NR;
           w[50]:=DVAT.DOK().JPK_GTU;
           w[51]:=DVAT.DOK().JPK_PROC;
           w[52]:=DVAT.DOK().JPK_V_T;
           w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
        ?};
        pom+=1
   ||   w[6]:=w[41]:=w[7]:=w[8]:=w[9]:=w[19]:=''
   ?};~~
}
{SUBSTITUTE: 'LINIA'}{ w[1]:=w[2]:=w[3]:=w[4]:=w[25]:=w[26]:=w[27]:=w[28]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[41]:=w[42]:=w[43]:=w[50]:=w[51]:=w[52]:=''; ~~}
 {WHILE: pom<=sizeslo}
  {DO}
    {IF: ((tn[pom]$2)<>0)|((tv[pom]$2)<>0)|((tv1[pom]$2)<>0)|((tb[pom]$2)<>0)}
           {  w[5]:=STR.line(szer[5]); w[6]:=form(tvat[pom],,2,' ,'); w[7]:=form(tn[pom],,2,' ,'); w[8]:=form(tv[pom],,2,' ,');
           w[51]:=STR3.line(szer[4]); w[50]:=STR2.line(6); ile_l-=1;
           w[19]:=form(tv1[pom],,2,' ,');
           w[9]:=form(tb[pom],,2,' ,');
           {? rep_expo()
           || w[1]:=w[43]:=DVAT.RVAT().SYM;
              w[25]:=$DVAT.NR;
              w[42]:=DVAT.SYM1;
              w[26]:={? tryb=3 & VAT7.WY2 || w[11]:={? dat_zapl<>date(0,0,0)  & dat_zapl<=VAT7.DAT_ZAPL || dat_zapl$1 || 10*'-' ?} |? tryb=4 & DOK.D3<>date(0,0,0) || w[11]:=$DOK.D3 ?};
              w[27]:=DVAT.DAT1$1;
              w[28]:=DVAT.DAT2$1;
              w[29]:={? rejestr<>'_WWspN' || DVAT.DAT4$1 || '' ?};
              w[30]:=REJ.ODD().OD;
              w[31]:=REJ.KOD;
              w[32]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
              w[33]:=$DVAT.NR;
              w[50]:=DVAT.DOK().JPK_GTU;
              w[51]:=DVAT.DOK().JPK_PROC;
              w[52]:=DVAT.DOK().JPK_V_T;
              w55:=w[41]:=exec('szukkh','!fks_vat_zrej')
           ?};~~}
{SUBSTITUTE: 'LINIA'}
    {FI}
    {w[5]:=''; pom+=1; ~~}
  {OD}
{w[5]:=''; w[6]:=w[41]:=w[7]:=w[8]:=w[9]:=w[19]:=''; w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]);~~}
 {WHILE: ile_l>0 | (w[50]<>'' | w[51]<>'')}
  {DO}
    {IF: w[5]<>'' | (w[50]<>'' | w[51]<>'')}
{SUBSTITUTE: 'LINIA'}
    {FI}
    {w[5]:=STR.line(szer[5]);w[50]:=STR2.line(6); w[51]:=STR3.line(szer[4]);~~}
    { ile_l-=1; ~~}
  {OD}
  {SUBSTITUTE: 'SUMASTR'}
{ENTIRE-}
{FI}
{FI}
    {FI}
  {FI}
{FI}
{FI}{FI}
{ {! _a:=1 ..sizeslo |!  tn[_a]:=tv[_a]:=tv1[_a]:=tb[_a]:=0 !}; ~~}
{MACRO-}
{COMMENT}----------------------PRZYGOTOWANIE WYDRUKU-----------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}{ RS.index('RS'); RS.prefix(); ~~}
{FOR: 'RVAT'}
{INDEX: 'RVAT_ESY'}
{PREFIX: REF.FIRMA,rejestr}
{DO}
{IF: {? var_pres('rvat_sym')>0 || RVAT.SYM=rvat_sym || 1 ?}}
   {IF: {? tryb=3 || RVAT.RT='Z' | RVAT.RT='W' || 1 ?}}
      {IF: ~OPERATOR.DEPT}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
            {IF: var_press('WAL',VAT7)<=0}
               {FOR: 'DVAT'}
               {INDEX: 'NR'}
               {PREFIX: VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {ELSE}
               {FOR: 'DVAT'}
               {INDEX: 'NRW'}
               {PREFIX: VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {FI}
            {okrVatNr+=1;~~}
         {OD}
      {ELSE}
         {okrVatNr:=1;~~}
         {WHILE: okrVatNr<=obj_len(okrVat)}
         {DO}
            {IF: var_press('WAL',VAT7)<=0}
               {FOR: 'DVAT'}
               {INDEX: 'NR_O' }
               {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {ELSE}
               {FOR: 'DVAT'}
               {INDEX: 'NR_OW'}
               {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref() }
               {DO}
                 {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
               {OD}
            {FI}
            {okrVatNr+=1;~~}
         {OD}
      {FI}
   {FI}
{FI}
{IF: dru_rej}
{IF: lineleft<2}{IF: lineleft<>0}{PAGE}{FI}{ vp:=1;~~}{ELSE}{ vp:=0;~~}{FI}{ {! _i:=1..41 |! w[_i]:='' !};~~}
{{? ~rep_expo() || w[50]:=''; w[51]:='' ?};~~}
{ w[1]:=RVAT.SYM; w[18]:='Suma'; w[7]:=form(rej_1,,2,' ,'); w[8]:=form(rej_2,,2,' ,'); w[19]:=form(rej_4,,2,' ,'); w[9]:=form(rej_3,,2,' ,'); s2c:=0;~~}
{ENTIRE}
{ font_gr:=1;~~}
{IF: vp | rep_expo()}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA'}{FI}{ font_gr:=0;~~}
{ENTIRE-}
{ dru_rej:=rej_1:=rej_2:=rej_3:=rej_4:=0;~~}
{FI}
{OD}   {'.... FOR RVAT';~~}
{COMMENT}----------------------------------------FOOTER-LAST----------------------------{COMMENT-}
{linecnt:=lineleft();~~}
{IF: ((page>1 & linecnt<(11+sizeslo)) | (page=1 & linecnt<(7+sizeslo))) & linecnt<>0}
{PAGE}
{FI}
{ _pom:=6+sizeslo;
  {? page>1 & VAT7.WY3 || _pom+=4 ?};
  {? VAT7.WY2 || _pom+=2 ?};
 {? _pom>lineleft() || vp:=1 || vp:=0 ?};~~}
{IF: lineleft=0}{FOOTER}{FOOTER-}{FI}
{DIRECT}{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{REP: PRN1.fhbar()}
{IF: page>1 & VAT7.WY3}
{ww[1]:='   SUMA STRONY'; ww[2]:=''; ww[3]:=form(sstr7,,2,' ,'); ww[4]:=form(sstr8,,2,' ,');  ww[6]:=form(sstr10,,2,' ,');  ww[5]:=form(sstr9,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{ww[1]:='   Z PRZENIESIENIA'; ww[2]:=''; ww[3]:=form((suma7-sstr7),,2,' ,'); ww[4]:=form((suma8-sstr8),,2,' ,');  ww[6]:=form((suma10-sstr10),,2,' ,');ww[5]:=form((suma9-sstr9),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}{FI}
{ww[1]:='   RAZEM'; ww[2]:=''; ww[3]:=form(suma7,,2,' ,'); ww[4]:=form(suma8,,2,' ,');  ww[6]:=form(suma10,,2,' ,');  ww[5]:=form(suma9,,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI} {pom:=1; ~~}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{ww[1]:='   W TYM:'; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:= form(sn[pom],,2,' ,'); ww[4]:= form(sv[pom],,2,' ,');
 ww[6]:= form(sv1[pom],,2,' ,'); ww[5]:=form(sb[pom],,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI} {pom+=1; ~~}
{WHILE: pom<=sizeslo}
  {DO}
{ww[1]:=''; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:= form(sn[pom],,2,' ,');
 ww[4]:= form(sv[pom],,2,' ,'); ww[6]:= form(sv1[pom],,2,' ,'); ww[5]:=form(sb[pom],,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI}
{pom+=1; ~~}
  {OD}
{IF: is_us}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{ww[1]:='   RAZEM operacje nie rozliczane w VAT'; ww[2]:=''; ww[3]:=form(ssu[1],,2,' ,'); ww[4]:=form(ssu[2],,2,' ,');  ww[6]:=form(ssu[3],,2,' ,');  ww[5]:=form(ssu[4],,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI} {pom:=1; ~~}
{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{WHILE: pom<=sizeslo}
  {DO}
{IF: su[pom][1]|su[pom][2]|su[pom][3]|su[pom][4]}
{ {? is_us || is_us:=0; ww[1]:='   W TYM:' || ww[1]:='' ?}; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:=form(su[pom][1],,2,' ,'); ww[4]:=form(su[pom][2],,2,' ,');
 ww[6]:= form(su[pom][3],,2,' ,'); ww[5]:=form(su[pom][4],,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI}
{FI}
{pom+=1; ~~}
  {OD}
{FI}
{IF: VAT7.WY2}{IF: vp | rep_expo()}{REP: PRN1.fbar()}{ELSE}{PRN1.bar()}{FI}
{ ww[1]:='   NALEŻNOŚCI Z ZAPŁACONYCH FAKTUR'; ww[2]:=''; ww[3]:=form(w[21],,2,' ,'); ww[4]:= form(w[22],,2,' ,');  ww[5]:=form(w[23],,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI}
{FI}
{IF: vp | rep_expo()}{REP: PRN1.flbar()}{ELSE}{PRN1.lbar()}{FI}
{IF: ~rep_expo()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'}
{FI}
{DIRECT-}
{FOOTER}{FOOTER-}