:!UTF-8
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: vatrej3.rpi
==================================================
Zawartosc: Plik wykorzystywany w wydruku 'Wydruk rejestru VAT'
co=1 sprzedaz
co=2 zakup
co=3 import uslug
co=4 import towarow
WYDRUK   wg.   STAWEK   VAT
{COMMENT-}
{ {? var_press('WAL',VAT7)<=0 || exec('par_2','!fks_vat_zrej') || exec('par_6','!fks_vat_zrej') ?};
  {? VAT7.WYD_TECH || PAR_WYDR.HEAD:=PAR_WYDR.LOGO:=0 ?}; colspan:=11;
  szer[1]:=9; szer[2]:=51; szer[3]:=12; szer[4]:=13; szer[5]:={? co=1 || 80 || 63 ?}; szer[6]:=5; szer[7]:=20; szer[8]:=16; szer[9]:=20; szer[14]:=4; szer[16]:=11;szer[17]:=7;
  PRN.add("w[20]",szer[14],' Lp.',1); w[20]:='';
{? rep_expo()
  || PRN.add("w[29]",szer[1],'Rej. VAT',,'#');
     PRN.add("w[30]",szer[1],'Pozycja',,'#')
  || PRN.add("w[1]",szer[1],'Rej. VAT/#pozycja',,'#')
  ?};
  {? co=2 & VAT7.WY2
  || PRN.add("w[2]",szer[2],'Symbol dokumentu/Zapłacono',,'#')
  |? co=1
  || {? rep_expo()
     || PRN.add("w[39]",szer[1],'Symbol dokumentu',,'#');
        PRN.add("w[37]",szer[1],'Termin płatności',,'#')
     || PRN.add("w[2]",szer[2],'Symbol dokumentu/Termin płatności',,'#')
     ?}
  || PRN.add("w[39]",szer[2],'Symbol dokumentu')
  ?};
  {? co=1 & VAT7.PAR2=2
  || {? rep_expo()
     || PRN.add("w[31]",szer[1],'Data zapisu',,'#');
        PRN.add("w[32]",szer[1],'Data wystawienia',,'#')
     || PRN.add("w[3]",szer[16],'D. zapisu / wystawienia')
     ?}
  |? co=1 & var_pres('eksport')>0 & eksport=1
  || {? rep_expo()
     || PRN.add("w[31]",szer[1],'Data zapisu',,'#');
        PRN.add("w[32]",szer[1],'Data wystawienia',,'#');
        PRN.add("w[33]",szer[1],'Data odprawy celnej',,'#'); colspan:=12
     || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia/#odpr. cel.',,'#')
     ?}
  |? co=1
  || {? rep_expo()
     || PRN.add("w[31]",szer[1],'Data zapisu',,'#');
        PRN.add("w[32]",szer[1],'Data wystawienia',,'#');
        PRN.add("w[33]",szer[1],'Data potwierdzenia odbioru',,'#'); colspan:=12
     || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia/#potw. odb.',,'#')
     ?}
  |? co=2
  || {? rep_expo()
     || PRN.add("w[31]",szer[1],'Data zapisu',,'#');
        PRN.add("w[32]",szer[1],'Data wystawienia',,'#');colspan:=10;
        PRN.add("w[33]",szer[1],'Data otrzymania',,'#');colspan:=11
     || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia/# otrzymania',,'#')
     ?}
  |? co=3
  || {? rep_expo()
      || PRN.add("w[31]",szer[3],'Data zapisu',,'#');
         PRN.add("w[32]",szer[3],'Data wystawienia',,'#')
      || PRN.add("w[3]",szer[16],'D. zapisu/#wystawienia',,'#')
     ?}
  || {? rep_expo()
      || PRN.add("w[31]",szer[3],'Data zapisu',,'#');
         PRN.add("w[32]",szer[3],'Data odp. celnej',,'#');
         PRN.add("w[33]",szer[3],'Data przekroczenia granicy',,'#')
      || PRN.add("w[3]",szer[16],'D. zapisu/#odp. celnej/# przekr.# granicy',,'#')?}
     ?};
  {? rep_expo()
     || PRN.add("w[34]",szer[1],'Rej. księg.',,'#');
        PRN.add("w[35]",szer[1],'Pozycja',,'#');
        {?odd ||PRN.add("w[36]",szer[1],'Jedn. ks.',,'#')?}
     || PRN.add("w[4]",szer[4],'Rej. księg./#pozycja'+{?odd||'/# Jedn. ks.'||''?},,'#')
  ?};
  {? +param6++param7++param8>0
  || szer[5]-={? +param6>0 || szer[17]+1 || 0 ?} + {? +param7>0 || szer[3]+1 || 0 ?}+{? +param8>0 || szer[17]+1 || 0 ?}
  ?};
  {? rep_expo()
  || PRN.add("w[38]",szer[5],13*' '+'Kontrahent - nazwa, siedziba, numer identyfikacyjny')
  || PRN.add("w[5]",szer[5],13*' '+'Kontrahent - nazwa, siedziba, numer identyfikacyjny')
  ?};
  {? param6<>''
  || PRN.add("w[50]",szer[17],'GTU',1)
  ?};
  {? param7<>''
  || PRN.add("w[51]",szer[3],'Procedury',1)
  ?};
  {? param8<>''
  || PRN.add("w[52]",szer[17],'Typ JPK',1)
  ?};
  PRN.add("w[6]",szer[6],'% VAT',1);
  PRN.add("w[7]",szer[7],'Netto',1);
  {? co=2 | co=3 | co=4
  || PRN.add("w[8]",szer[8],'VAT do odliczenia',1); PRN.add("w[19]",szer[8],'VAT nie podlegający odliczeniu',1)
  || PRN.add("w[8]",szer[8],'VAT',1)
  ?};
  PRN.add("w[9]",szer[9],'Brutto',1);
  PRN1.add("ww[1]",szer[1]+szer[2]+szer[16]+szer[4]+szer[5]+szer[14]+5+
  {?+param6>0 || szer[17]+1 || 0 ?} +
  {? +param7>0 || szer[3]+1 || 0 ?} +
  {? +param8>0 || szer[17]+1 || 0 ?},''); PRN1.add("ww[2]",szer[6],'',1);
  PRN1.add("ww[3]",szer[7],'',1); PRN1.add("ww[4]",szer[8],'',1);
  {? co=2 | co=3 | co=4 || PRN1.add("ww[6]",szer[8],'',1) ?}; PRN1.add("ww[5]",szer[9],'',1);~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}{IF: ~VAT7.WYD_TECH}{LINE: 1}{FI}
{SUBSTITUTE: 'HEAD'}
{FONT: 'W8'}{SPACE: 'C'}{IF: page=1}
{<3 'Parametry wydruku:'}
{<6 'Jednostka księgowa: '+{? ~odd || OPERATOR.DEPT().OD || 'wszystkie jednostki księgowe' ?}+{? VAT7.TYPOKR='M' || '   Rodzaj okresu: '+{? SSTALE.AO().ZAM='T'||'zamknięty'||'otwarty'?} || '' ?}}
{IF: ~VAT7.WYD_TECH}{IF: dokvpoch<>''}{<6 dokvpoch}{FI}
{<6 'Kraj opodatkowania: '+kraj+{? wal_op<>'' || '   Waluta opodatkowania: '+wal_op || '' ?}}
{IF: param1<>''}
{<6 param1}{FI}{IF: param2<>''}
{<6 param2}{FI}{IF: param3<>''}
{<6 param3}{FI}{IF: param4<>''}
{<6 param4}{FI}{IF: param5<>''}
{<6 param5}{FI}{IF: param6<>''}
{<6 param6}{FI}{IF: param7<>''}
{<6 param7}{FI}{IF: param8<>''}
{<6 param8}{FI}
{IF: co=2 & VAT7.DAT_ZAPL<>date(0,0,0)}{<6 'Data zapłaty: '+$VAT7.DAT_ZAPL+{? VAT7.TYLKOZAP || ' - tylko zapłacone'|| '' ?}}{FI}
{FI}{FI}
{LINE: 1}{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{IF: page=1}{REP: PRN.fbar()}{FI}{ vp:=1;~~}
{HEADER-}
{COMMENT}------------------------------MACRO-LINIA------------------{COMMENT-}
{MACRO: 'LINIA'}
{IF: ~font_gr}{IF: s2c}{FONT: 'T8U'}{ELSE}{FONT: 'T8G'}{FI}{ELSE}{FONT: 'T8GB'}{FI}{ PRN.setcolor('255:255:255');~~}
{PRN.ini_line()}
{WHILE: PRN.next()}
{DO}
{ vp:=0; PRN.setcolor('255:255:255'); ~~}
{REP: PRN.fline()}
{OD}{ vp:=0; PRN.setcolor(color); ~~}
{MACRO-}
{COMMENT}------------------------------MACRO-LINIA1------------------{COMMENT-}
{MACRO: 'LINIA1'}
{IF: ~font_gr}{FONT: 'T8G'}{ELSE}{FONT: 'T8GB'}{FI}{ PRN1.setcolor('255:255:255');~~}
{PRN1.ini_line()}
{WHILE: PRN1.next()}
{DO}
{REP: PRN1.fline()}
{OD}{ vp:=0; PRN1.setcolor(color); ~~}
{MACRO-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{SPACE: 'C'}
{IF: VAT7.WY3}
{FOOTER: 0}{FONT: 'T8G'}{SPACE: 'C'}
{IF: (vp & lineleft()<>0) | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{PRN1.hbar()}{ww[1]:='   SUMA STRONY'; ww[2]:=''; ww[3]:=form(sstr7,,2,' ,'); ww[4]:=form(sstr8,,2,' ,');  ww[6]:=form(sstr10,,2,' ,'); ww[5]:=form(sstr9,,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI}
{PRN1.bar()}{IF: page>1}{ww[1]:='   Z PRZENIESIENIA'; ww[2]:=''; ww[3]:= form((suma7-sstr7),,2,' ,'); ww[4]:=form((suma8-sstr8),,2,' ,');  ww[6]:=form((suma10-sstr10),,2,' ,');ww[5]:=form((suma9-sstr9),,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI}
{PRN1.bar()}{FI}{ww[1]:='   DO PRZENIESIENIA'; ww[2]:=''; ww[3]:=form(suma7,,2,' ,'); ww[4]:=form(suma8,,2,' ,');   ww[6]:=form(suma10,,2,' ,');  ww[5]:=form(suma9,,2,' ,'); ~~}
{IF: ~rep_expo()}{SUBSTITUTE: 'LINIA1'}{FI}
{PRN1.lbar()}{ sstr7:=sstr8:=sstr9:=sstr10:=0; ~~}{ vp:=1;~~}
{FOOTER-}
{ELSE}
{FOOTER: 0}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}{ vp:=1;~~}
{FOOTER-}
{FI}
{COMMENT}------------------------------MACRO-PETLA------------------{COMMENT-}
{MACRO: 'PETLA'}
{ VPOZ_ROZ.cntx_psh(); VPOZ.cntx_psh();
  dat_zapl:=date(0,0,0);
  {? VAT7.WY2 & co=2 || dat_zapl:=exec('spr_roz1','!fks_vat_zrej',DVAT.DOK,DVAT.SYM1,DVAT.DOKOKRO().ROK().KOD,DVAT.DOKOKRO().NR,VAT7.DAT_ZAPL,DVAT.DAT2) ?};
  _a:=DVAT.DOKOKRO().ROK().KOD+form(DVAT.DOKOKRO().NR,-2); DOK.use('doku'+_a);  DOK.prefix(); POZ.use('pozy'+_a); POW.use('pow_'+_a);~~}
{IF:   (VAT7.WY4<>0 & (VAT7.WY4=1 & {? VAT7.JPK_GTU='' || 1
                                  |? VAT7.JPK_GTU*'BRAK'>0 & DVAT.DOK().JPK_GTU='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_GTU,DVAT.DOK().JPK_GTU)
                                  ?})) |
  (VAT7.WY5<>0 & (VAT7.WY5=1 & {? VAT7.JPK_PROC='' || 1
                                  |? VAT7.JPK_PROC*'BRAK'>0 & DVAT.DOK().JPK_PROC='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_PROC,DVAT.DOK().JPK_PROC)
                                  ?})) |
   (VAT7.WY6<>0 & (VAT7.WY6=1 & {? VAT7.JPK_TD='' || 1
                                  |? VAT7.JPK_TD*'BRAK'>0 & DVAT.DOK().JPK_V_T='' || 1
                                  || exec('test_in','!fks_vat_zrej',VAT7.JPK_TD,DVAT.DOK().JPK_V_T)
                                  ?})) |
   (VAT7.WY4=0 & VAT7.WY5=0 & VAT7.WY6=0)
                                    }
{IF: ((4+RVAT.KVAT().SYM='ImpU') & exec('vat_nal','!fks_vat_zrej',VAT7.PAR4)) | (4+RVAT.KVAT().SYM<>'ImpU')}
{IF: co<>2 | ~VAT7.TYLKOZAP | (VAT7.TYLKOZAP & dat_zapl<>date(0,0,0) & dat_zapl<=VAT7.DAT_ZAPL)}
{IF: exec('chk_okr_vat','!fks_vat_zrej')}
    {IF: DOK.seek(DVAT.DOK)}
    {IF: ((VAT7.PAR2=2) & (-DOK.DOK_REJ().KOR='n')) | ((VAT7.PAR2=1) & (-DOK.DOK_REJ().KOR='t')) | (VAT7.PAR2=3)}
    { kor:=DOK.DOK_REJ().KOR='T'; s2c:=DVAT.USUNIETY; {? s2c || is_us:=1 ?};
      w[1]:=DVAT.RVAT().SYM;
      w[2]:=w[39]:=DVAT.SYM1;
      w[3]:=DVAT.DAT1$1;
      w[13]:=DVAT.DAT2$1;
      w[14]:=DVAT.DAT4$1;
      w[4]:=DVAT.DOK().REJ().KOD+(8-(+DVAT.DOK().REJ().KOD))*' '+form(DVAT.DOK().NR,szer[4]-8,,'99');
      w[29]:=DVAT.RVAT().SYM;
      w[30]:=DVAT.NR;
      w[31]:=DVAT.DAT1$1;
      w[32]:=DVAT.DAT2$1;
      w[33]:=DVAT.DAT4$1;
      w[34]:=DVAT.DOK().REJ().KOD;
      w[35]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
      w[36]:={?odd||DVAT.DOK().REJ().ODD().OD||''?};
      w[37]:=$DOK.D3;
      {? param6<>'' || w[50]:=DVAT.DOK().JPK_GTU || w[50]:='' ?};
      {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
      {? param7<>'' || w[51]:=DVAT.DOK().JPK_PROC;  w[51]:=STR2.gsub(w[51],',',', ') || w[51]:='' ?};
      {? param8<>'' || w[52]:=DVAT.DOK().JPK_V_T || w[52]:='' ?};
      w55:=w[38]:=exec('szukkh','!fks_vat_zrej');StrVat:=';';~~
    }
    {FOR: 'PVAT'}
    {INDEX: 'DVAT_ST'}
    {PREFIX: DVAT.ref}
    {DO}
      {IF: ((4+RVAT.KVAT().SYM='ImpU') & ((VAT7.PAR4=1 & (1+PVAT.GRVAT().KOD='Z')) | VAT7.PAR4=2)) | (4+RVAT.KVAT().SYM<>'ImpU')}
      {IF: exec('typ_okr_vat','!fks_vat_zrej',2)}
       { _grupa:=PVAT.GRVAT().KOD;
          {! _a:=1 ..sizeslo
          |! {? PVAT.STVAT().KOD=tvat[_a]
             || {? co=2 | co=3 | co=4
                || {? ~UNPAR.P1
                   || {? (-_grupa='zakupods' | -_grupa='zinwpods')
                      || {? 6+RVAT.KVAT().SYM='_WWspN' & VAT7.TYP_VAT='Z'
                         || tv[_a]+=PVAT.VAT; _net_odl:=PVAT.SUM2;
                            {? s2c
                            || su[_a][2]+=PVAT.VAT; ssu[2]+=PVAT.VAT
                            || sv[_a]+=PVAT.VAT
                            ?}
                         || _vat_odl:=PVAT.VAT_ODL;
                            tv[_a]+=_vat_odl; tv1[_a]+=PVAT.VATKOSZT;
                            _net_odl:={? PVAT.VAT || (PVAT.SUM2*_vat_odl/PVAT.VAT)$2 || PVAT.SUM2$2 ?};
                            {? s2c
                            || su[_a][2]+=_vat_odl; su[_a][3]+=PVAT.VATKOSZT; ssu[2]+=_vat_odl; ssu[3]+=PVAT.VATKOSZT
                            || sv[_a]+=_vat_odl; sv1[_a]+=PVAT.VATKOSZT
                            ?}
                         ?}
                      || tv[_a]+=PVAT.VAT_ODL; tv1[_a]+=PVAT.VATKOSZT; _net_odl:=PVAT.SUM2;
                         {? s2c || su[_a][2]+=PVAT.VAT_ODL; su[_a][3]+=PVAT.VATKOSZT; ssu[2]+=PVAT.VAT_ODL; ssu[3]+=PVAT.VATKOSZT || sv[_a]+=PVAT.VAT_ODL; sv1[_a]+=PVAT.VATKOSZT ?}
                      ?}
                   || {? 'ZInwPodS,ZInwPodZ,ZakPRopZ,ZakuPodS,ZakuPodZ,ZInwNPod,ZPozNPal,ZPozNPod,ZakupNpr'*_grupa
                      || tv[_a]+=PVAT.VAT_ODL; tv1[_a]+=PVAT.VATKOSZT;
                         _net_odl:={? PVAT.VAT
                                   || (PVAT.SUM2*PVAT.VAT_ODL/PVAT.VAT)$2
                                   |? par84
                                   || _tab:={? PVAT.VPOZ_ROZ
                                            || VPOZ_ROZ.use(ref_name(PVAT.VPOZ_ROZ));
                                               PVAT.VPOZ_ROZ(); VPOZ_ROZ
                                            || VPOZ.use(ref_name(PVAT.VPOZ_REF));
                                               PVAT.VPOZ_REF(); VPOZ
                                            ?};
                                      _net_odl:={? _grupa='ZakuPodS' | _grupa='ZInwPodS'
                                                || (PVAT.SUM2/2)$2
                                                || PVAT.SUM2
                                                ?};
                                      (_net_odl
                                       *({? par83
                                         || {? _tab.C_PROC_S || procst/100 || 1 ?}
                                         || procst/100
                                         ?})
                                       *({? par83 & _tab.C_PREWSK || prewsk/100 || 1 ?}))$2
                                   || 0
                                   ?};
                         {? s2c || su[_a][2]+=PVAT.VAT_ODL; ssu[2]+=PVAT.VAT_ODL; su[_a][3]+=PVAT.VATKOSZT; ssu[3]+=PVAT.VATKOSZT
                                || sv[_a]+=PVAT.VAT_ODL; sv1[_a]+=PVAT.VATKOSZT ?}
                      |? _grupa='ZakuPods' | _grupa='ZInwPods'
                      || _vat_odl:=(PVAT.VAT/2)$2;
                         tv[_a]+=_vat_odl ; tv1[_a]+=PVAT.VAT-_vat_odl;
                         _net_odl:={? PVAT.VAT
                                   || (PVAT.SUM2*_vat_odl/PVAT.VAT)$2
                                   |? par84
                                   || (PVAT.SUM2/2)$2
                                   || 0
                                   ?};
                         {? s2c || su[_a][2]+=_vat_odl; su[_a][3]+=PVAT.VAT-_vat_odl; ssu[2]+=PVAT.VAT_ODL; ssu[3]+=PVAT.VATKOSZT
                                || sv[_a]+=_vat_odl; sv1[_a]+=PVAT.VAT-_vat_odl ?}
                      || tv[_a]+=PVAT.VAT_ODL; tv1[_a]+=PVAT.VATKOSZT;  _net_odl:=PVAT.SUM2;
                         {? s2c || su[_a][2]+=PVAT.VAT_ODL; su[_a][3]+=PVAT.VATKOSZT; ssu[2]+=PVAT.VAT_ODL; ssu[3]+=PVAT.VATKOSZT  || sv[_a]+=PVAT.VAT_ODL; sv1[_a]+=PVAT.VATKOSZT ?}
                      ?}
                   ?}
                || tv[_a]+=PVAT.VAT; _net_odl:=PVAT.SUM2; {? s2c || su[_a][2]+=PVAT.VAT; ssu[2]+=PVAT.VAT || sv[_a]+=PVAT.VAT ?}
                ?};
                tn[_a]+=_net_odl;  tb[_a]+=PVAT.SUM1; StrVat+=$_a+';';
                {? s2c
                || su[_a][1]+=_net_odl; su[_a][4]+=PVAT.SUM1; ssu[1]+=_net_odl; ssu[4]+=PVAT.SUM1
                || sn[_a]+=_net_odl;  sb[_a]+=PVAT.SUM1
                ?};
                {? co=2 & VAT7.WY2 & dat_zapl<>date(0,0,0) & dat_zapl<=VAT7.DAT_ZAPL
                || {? ~UNPAR.P1
                   || {? (-_grupa='zakupods' | -_grupa='zinwpods')
                      || w[22]+=(PVAT.VAT/2)$2; w[24]+=(PVAT.VAT-(PVAT.VAT/2)$2); w[21]+={? PVAT.VAT || (PVAT.SUM2*(PVAT.VAT/2)$2/PVAT.VAT)$2 || PVAT.SUM2$2 ?}
                      || w[22]+=PVAT.VAT_ODL; w[24]+=PVAT.VATKOSZT; w[21]+=PVAT.SUM2
                      ?}
                   || {? 'ZInwPodS,ZInwPodZ,ZakPRopZ,ZakuPodS,ZakuPodZ,ZInwNPod,ZPozNPal,ZPozNPod,ZakupNpr'*_grupa
                      || w[22]+=PVAT.VAT_ODL; w[24]+=PVAT.VATKOSZT;
                         w[21]+={? PVAT.VAT
                                || (PVAT.SUM2*PVAT.VAT_ODL/PVAT.VAT)$2
                                |? par84
                                || _tab:={? PVAT.VPOZ_ROZ
                                         || VPOZ_ROZ.use(ref_name(PVAT.VPOZ_ROZ));
                                            PVAT.VPOZ_ROZ(); VPOZ_ROZ
                                         || VPOZ.use(ref_name(PVAT.VPOZ_REF));
                                            PVAT.VPOZ_REF(); VPOZ
                                         ?};
                                   _net_odl:={? _grupa='ZakuPodS' | _grupa='ZInwPodS'
                                             || (PVAT.SUM2/2)$2
                                             || PVAT.SUM2
                                             ?};
                                   (_net_odl
                                    *({? par83
                                      || {? _tab.C_PROC_S || procst/100 || 1 ?}
                                      || procst/100
                                      ?})
                                    *({? par83 & _tab.C_PREWSK || prewsk/100 || 1 ?}))$2
                                || 0
                                ?}
                      |? _grupa='ZakuPods' | _grupa='ZInwPods'
                      || _vat_odl:=PVAT.VAT_ODL;
                         w[22]+=PVAT.VAT_ODL; w[24]+=PVAT.VATKOSZT;
                         w[21]+={? PVAT.VAT
                                || (PVAT.SUM2*_vat_odl/PVAT.VAT)$2
                                |? par84
                                || (PVAT.SUM2/2)$2
                                || 0
                                ?}
                      || w[22]+=PVAT.VAT_ODL; w[24]+=PVAT.VATKOSZT; w[21]+=PVAT.SUM2
                      ?}
                   ?};
                   w[23]+=PVAT.SUM1
                ?}
             ?}
           !};~~}
      {FI}
      {FI}
    {OD}
{COMMENT}----------------------WYDRUK-------------------------------------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{{? ~rep_expo()
 || STR2.split(w[50]);
    STR3.split(w[51]) ?}; ~~}
{pom:=1;  _pom:=1;
  {! _i:=1..sizeslo |!  {? tn[_i]$2<>0 | tv[_i]$2<>0 | tv1[_i]$2<>0 | tb[_i]$2<>0 || _pom+=1 ?} !};
{? _pom<7 || _pom:=7 ?}; {? _pom>lineleft() || vp:=1 || vp:=0 ?};~~}
{IF: lineleft<>0 & vp}{PAGE}{FI}
{ STR.split(w55); w[5]:=STR.line(szer[5]);~~}
{ w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[52]:=DVAT.DOK().JPK_V_T; ~~}
{ENTIRE}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0)}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
  || w[6]:=form(tvat[pom],,2,' ,');
     w[7]:=form(tn[pom],,2,' ,');
     w[8]:=form(tv[pom],,2,' ,');
     w[19]:=form(tv1[pom],,2,' ,');
     w[9]:=form(tb[pom],,2,' ,');
     {? rep_expo() ||
     w[29]:=DVAT.RVAT().SYM;
     w[30]:=DVAT.NR;
     w[31]:=DVAT.DAT1$1;
     w[32]:=DVAT.DAT2$1;
     w[33]:={? 6+RVAT.KVAT().SYM<>'_WWspN'||DVAT.DAT4$1||''?};
     w[34]:=DVAT.DOK().REJ().KOD;
     w[35]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
     w[36]:={?odd||DVAT.DOK().REJ().ODD().OD||''?};
     w[37]:=$DOK.D3;
     w[38]:=exec('szukkh','!fks_vat_zrej');
     w[39]:=DVAT.SYM1;
     w[50]:=DVAT.DOK().JPK_GTU;
     {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
     w[51]:=DVAT.DOK().JPK_PROC;
     w[52]:=DVAT.DOK().JPK_V_T
     ?};
     pom+=1
  || w[6]:=''; w[7]:=w[8]:=w[9]:=w[19]:=form(0,,2,' ,')
  ?};~~}
{IF: linijka}{IF: vp}{REP: PRN.fbar()}{ELIF: ~VAT7.WYD_TECH}{PRN.bar()}{FI}{FI}{ numer+=1; w[20]:=$numer;~~}
{SUBSTITUTE: 'LINIA'}{ linijka:=1; w[20]:=w[38]:=w[39]:=w[52]:='';~~}
{ w[1]:=w[2]:=w[3]:=w[31]:=w[29]:=w[32]:=w[33]:=w[34]:=w[35]:=w[36]:=w[37]:='';
  w[4]:={?odd||DVAT.DOK().REJ().ODD().OD||''?}; w[3]:=w[13];  w[5]:=STR.line(szer[5]);
  w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]);
  {? rep_expo() || w[3]:=w[13]:=w[29]:=w[30]:=w[31]:=w[32]:=w[33]:=w[37] ?};
  {? VAT7.WY2 & co=2 || w[2]:={? dat_zapl<>date(0,0,0) & dat_zapl<=VAT7.DAT_ZAPL || dat_zapl$1 || 10*'-' ?} ?};~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0) & ~(StrVat*(';'+$pom+';'))}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
  || w[6]:=form(tvat[pom],,2,' ,');
     w[7]:=form(tn[pom],,2,' ,');
     w[8]:=form(tv[pom],,2,' ,');
     w[19]:=form(tv1[pom],,2,' ,');
     w[9]:=form(tb[pom],,2,' ,');
     {? rep_expo() ||
     w[29]:=DVAT.RVAT().SYM;
     w[30]:=DVAT.NR;
     w[31]:=DVAT.DAT1$1;
     w[32]:=DVAT.DAT2$1;
     w[33]:={? 6+RVAT.KVAT().SYM<>'_WWspN'||DVAT.DAT4$1||''?};
     w[34]:=DVAT.DOK().REJ().KOD;
     w[35]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
     w[36]:={?odd||DVAT.DOK().REJ().ODD().OD||''?};
     w[37]:=$DOK.D3;
     w[38]:=exec('szukkh','!fks_vat_zrej');
     w[39]:=DVAT.SYM1;
     w[50]:=DVAT.DOK().JPK_GTU;
     {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
     w[51]:=DVAT.DOK().JPK_PROC;
     w[52]:=DVAT.DOK().JPK_V_T
     ?};
     pom+=1
  || w[6]:=w[7]:=w[8]:=w[9]:=w[19]:=''
  ?}; w[1]:=DVAT.NR; {? co=1 & DOK.D3<>date(0,0,0)|| {? rep_expo() || w[2]:='' || w[2]:=$DOK.D3 ?} ?};~~}
{SUBSTITUTE: 'LINIA'}
{  w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]);~~}
{ w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[31]:=w[34]:=w[35]:=w[29]:=w[32]:=w[33]:=w[36]:=w[37]:=w[38]:=w[39]:=w[30]:=w[52]:='';
  {? co<>1 | kor | (var_pres('eksport')>0 & eksport=1) || w[3]:=w[14] ?}; w[5]:=STR.line(szer[5]);
~~}
{WHILE: (pom<=sizeslo)&((tn[pom]$2)=0)&((tv[pom]$2)=0)&((tv1[pom]$2)=0)&((tb[pom]$2)=0) & ~(StrVat*(';'+$pom+';'))}{DO}{pom+=1; ~~}{OD}
{ {? pom<=sizeslo
  || w[6]:=form(tvat[pom],,2,' ,');
     w[7]:=form(tn[pom],,2,' ,');
     w[8]:=form(tv[pom],,2,' ,');
     w[19]:=form(tv1[pom],,2,' ,');
     w[9]:=form(tb[pom],,2,' ,');
     {? rep_expo() ||
     w[29]:=DVAT.RVAT().SYM;
     w[30]:=DVAT.NR;
     w[31]:=DVAT.DAT1$1;
     w[32]:=DVAT.DAT2$1;
     w[33]:={? 6+RVAT.KVAT().SYM<>'_WWspN'||DVAT.DAT4$1||''?};
     w[34]:=DVAT.DOK().REJ().KOD;
     w[35]:=form(DVAT.DOK().NR,szer[4]-8,,'99');
     w[36]:={?odd||DVAT.DOK().REJ().ODD().OD||''?};
     w[37]:=$DOK.D3;
     w[38]:=exec('szukkh','!fks_vat_zrej');
     w[39]:=DVAT.SYM1;
     w[50]:=DVAT.DOK().JPK_GTU;
     {? ~rep_expo() || w[50]:=STR2.gsub(w[50],',') ?};
     w[51]:=DVAT.DOK().JPK_PROC;
     w[52]:=DVAT.DOK().JPK_V_T
     ?};
     pom+=1
  || w[6]:=w[7]:=w[8]:=w[9]:=w[19]:=''
  ?};~~
}
{SUBSTITUTE: 'LINIA'}{ {? ~rep_expo() || w[1]:=w[2]:=w[3]:=w[4]:=w[31]:=w[32]:=w[34]:=w[35]:=w[29]:=w[33]:=w[36]:=w[37]:=w[38]:=w[39]:=w[30]:='';w[5]:='' ?};~~}
{ {? ~rep_expo() || w[50]:=w[51]:=w[52]:='' ?};~~}
 {WHILE: pom<=sizeslo}
  {DO}
    {IF: ((tn[pom]$2)<>0)|((tv[pom]$2)<>0)|((tv1[pom]$2)<>0)|((tb[pom]$2)<>0)}
           {  w[6]:=form(tvat[pom],,2,' ,'); w[7]:=form(tn[pom],,2,' ,'); w[8]:=form(tv[pom],,2,' ,'); w[19]:=form(tv1[pom],,2,' ,'); w[9]:=form(tb[pom],,2,' ,');~~}
           { {? ~rep_expo() || w[5]:=STR.line(szer[5]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]) ?}; ~~}
{SUBSTITUTE: 'LINIA'}
    {FI}{pom+=1; ~~}
  {OD}
{ {? s2c
  || 1
  || {! _a:=1 ..sizeslo
     |! sstr7+=tn[_a]; suma7+=tn[_a];  sstr8+=tv[_a]; sstr10+=tv1[_a]; suma8+=tv[_a]; suma10+=tv1[_a]; sstr9+=tb[_a]; suma9+=tb[_a]
     !}
  ?}; {! _a:=1 ..sizeslo |!  tn[_a]:=tv[_a]:=tb[_a]:=tv1[_a]:=0 !}; ~~}
  {w[5]:=STR.line(szer[5]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]); w[1]:=w[2]:=w[3]:=w[4]:=w[31]:=w[34]:=w[35]:=w[29]:=w[32]:=w[33]:=w[36]:=w[37]:=w[38]:=w[39]:=w[30]:='';
  w[6]:=w[7]:=w[8]:=w[9]:=w[19]:='';~~}
  {WHILE: w[5]<>'' | w[50]<>'' | w[51]<>''}
   {DO}
     {IF: w[5]<>'' | w[50]<>'' | w[51]<>''}
     {SUBSTITUTE: 'LINIA'}
     {FI}
     {w[5]:=STR.line(szer[5]); w[50]:=STR2.line(6); w[51]:=STR3.line(szer[3]);~~}
  {OD}
{ENTIRE-}
    {FI}
    {FI}
   {FI}
{FI}
{FI}
{FI}
{ VPOZ_ROZ.cntx_pop(); VPOZ.cntx_pop();~~}
{MACRO-}
{COMMENT}----------------------PRZYGOTOWANIE WYDRUKU-----------------------{COMMENT-}
{ RS.index('RS'); RS.prefix(); DOK.prefix;  ~~}
   {IF: odd}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR' }
            {PREFIX: VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref() }
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NRW'}
            {PREFIX: VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
   {ELSE}
      {okrVatNr:=1;~~}
      {WHILE: okrVatNr<=obj_len(okrVat)}
      {DO}
         {IF: var_press('WAL',VAT7)<=0}
            {FOR: 'DVAT'}
            {INDEX: 'NR_O' }
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,okrVat[okrVatNr],RVAT.ref()}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
            {OD}
         {ELSE}
            {FOR: 'DVAT'}
            {INDEX: 'NR_OW'}
            {PREFIX: OPERATOR.DEPT,VAT7.KRAJ,VAT7.WAL,okrVat[okrVatNr],RVAT.ref}
            {DO}
               {IF: exec('wystrokokr','!fks_vat_zrej') & exec('typ_okr_vat','!fks_vat_zrej',1)}{SUBSTITUTE: 'PETLA'}{FI}
            {OD}
         {FI}
         {okrVatNr+=1;~~}
      {OD}
   {FI}
{COMMENT}----------------------------------------FOOTER-LAST----------------------------{COMMENT-}
{IF: ~rep_expo()}
{linecnt:=lineleft()-1;
 {? is_us
 || is_us:=0; {! _i:=1..sizeslo |! is_us+=su[_i][1]|su[_i][2]|su[_i][3]|su[_i][4] !};
    {? is_us=0 || is_us:=1 ?}
 ?}; ~~}
{IF: ((page>1 & linecnt<({?VAT7.WY3||-8||-2?}+11+sizeslo+(is_us<>0)*3+is_us)) | (page=1 & linecnt<({?VAT7.WY3||-8||-1?}+5+sizeslo+(is_us<>0)*3+is_us))) & linecnt<>0}
{PAGE}
{ELSE}{FOOTER}{FOOTER-}
{FI}
{ _pom:=6+sizeslo; {? page>1 & VAT7.WY3 || _pom+=4 ?}; {? co=2 & VAT7.WY2 || _pom+=2 ?};
  {? _pom>lineleft() || vp:=1 || vp:=0 ?};~~}
{IF: lineleft=0}{FOOTER}{FOOTER-}{FI}
{DIRECT}{FONT: 'T8G'}{SPACE: 'C'}
{IF: vp | rep_expo()}{REP: PRN.flbar()}{ELSE}{PRN.lbar()}{FI}
{REP: PRN1.fhbar()}
{IF: page>1 & VAT7.WY3}
{ww[1]:='   SUMA STRONY'; ww[2]:=''; ww[3]:=form(sstr7,,2,' ,'); ww[4]:=form(sstr8,,2,' ,');  ww[6]:=form(sstr10,,2,' ,'); ww[5]:=form(sstr9,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{PRN1.bar()}
{ww[1]:='   Z PRZENIESIENIA'; ww[2]:=''; ww[3]:=form((suma7-sstr7),,2,' ,'); ww[4]:=form((suma8-sstr8),,2,' ,');  ww[6]:=form((suma10-sstr10),,2,' ,'); ww[5]:=form((suma9-sstr9),,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{PRN1.bar()}{FI}
{ww[1]:='   RAZEM'; ww[2]:=''; ww[3]:=form(suma7,,2,' ,'); ww[4]:=form(suma8,,2,' ,');  ww[6]:=form(suma10,,2,' ,');  ww[5]:=form(suma9,,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'} {pom:=1; ~~}
{PRN1.bar()}
{ww[1]:='   W TYM:'; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:=form(sn[pom],,2,' ,'); ww[4]:=form(sv[pom],,2,' ,'); ww[6]:=form(sv1[pom],,2,' ,'); ww[5]:=form(sb[pom],,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'} {pom+=1; ~~}
{WHILE: pom<=sizeslo}
  {DO}
{ww[1]:=''; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:=form(sn[pom],,2,' ,'); ww[4]:=form(sv[pom],,2,' ,');  ww[6]:=form(sv1[pom],,2,' ,');  ww[5]:=form(sb[pom],,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}{pom+=1; ~~}
  {OD}
{IF: is_us}
{PRN1.bar()}
{ww[1]:='   RAZEM operacje nie rozliczane w VAT'; ww[2]:=''; ww[3]:=form(ssu[1],,2,' ,'); ww[4]:=form(ssu[2],,2,' ,');  ww[6]:=form(ssu[3],,2,' ,');  ww[5]:=form(ssu[4],,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'} {pom:=1; ~~}
{PRN1.bar()}
{WHILE: pom<=sizeslo}
  {DO}
{IF: su[pom][1]|su[pom][2]|su[pom][3]|su[pom][4]}
{{? is_us || ww[1]:='   W TYM:'; is_us:=0 || ww[1]:='' ?}; ww[2]:=form(tvat[pom],,2,' ,'); ww[3]:=form(su[pom][1],,2,' ,'); ww[4]:=form(su[pom][2],,2,' ,'); ww[6]:=form(su[pom][3],,2,' ,'); ww[5]:=form(su[pom][4],,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}{FI}{pom+=1; ~~}
  {OD}
{FI}
{IF: co=2 & VAT7.WY2}
{PRN1.bar()}
{ ww[1]:='   NALEŻNOŚCI Z ZAPŁACONYCH FAKTUR'; ww[2]:=''; ww[3]:=form(w[21],,2,' ,'); ww[4]:=form(w[22],,2,' ,');  ww[6]:=form(w[24],,2,' ,'); ww[5]:=form(w[23],,2,' ,'); ~~}
{SUBSTITUTE: 'LINIA1'}
{FI}
{PRN1.lbar()}
{<1>{PRN.width()} 'KONIEC WYDRUKU'}
{ELSE}
{TABLE-}
{FI}
{DIRECT-}
{FOOTER}{FOOTER-}
