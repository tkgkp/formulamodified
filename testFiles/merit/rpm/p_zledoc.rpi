:!UTF-8
{EXIT: ~__xr_ins}
{IF:
   _TAB:=params_get().TAB;
   _DRUK:=params_get().DRUK;
   pars[1]:=exec('memo2print','#string',ZC,'TRESC');
   _TAB.REP:=KST.PRZEDST;
   _TAB.GODZ:={? ZC.TYP='G' || ZC.GODZ || 0 ?};
   _TAB.DNI:={? ZC.TYP='N' || 14 |? ZC.TYP='M' || 10 |? ZC.TYP='D' || ZC.DNI || 0 ?};
   _TAB.ZLEC:=ZC.OSOBA().NAZWISKO+' '+ZC.OSOBA().PIERWSZE;
   _TAB.NR:=ZC.NU;
   _we:=_TAB.mk_edit({? _DRUK='uz' || 'Umowa - zlecenie'@ || 'Umowa o dzieło'@ ?},0,'umowa_uz_ud');
   _TAB.win_esep(_we,{? _DRUK='uz' || 'Dane od umowy zlecenia'@ || 'Dane od umowy o dzieło'@ ?});
   _TAB.win_efld(_we,,'NR',,,60,,1,'Numer umowy'@);
   _TAB.win_efld(_we,,'ZLEC',,,60,,1,'Zleceniobiorca'@);
   _TAB.win_efld(_we,,'REP',,,60,,,'Osoba reprezentująca zakład'@,,,,'F3_button=1');
   {? pars[1]='' || _TAB.win_efld(_we,,'TR',,,60,-4,,'Treść umowy'@) ?};
   {? ZC.TYP='G' || _TAB.win_efld(_we,,'GODZ',,,7,2,,'Przewidywany wymiar godzin'@)
   |? ZC.TYP='D' || _TAB.win_efld(_we,,'DNI',,,7,2,,'Przewidywany wymiar dni'@)
   |? ZC.TYP='N' || _TAB.win_efld(_we,,'DNI',,,5,,,'Ilość dni na realizację wypłaty'@)
   |? ZC.TYP='M' || _TAB.win_efld(_we,,'DNI',,,5,,,'Dzień miesiąca wypłaty'@)
   ?};
   exec('ok_esc','#window',_TAB,_we);
   _TAB.win_edit(_we);
   _TAB.edit()
}
{  _TAB:=params_get().TAB;
   {? pars[1]=''
   || _TAB.memo_get();
      pars[1]:=gsub(_TAB.memo_txt(),'\n',' ')
   ?};
   dni:={? ZC.TYP='N' | ZC.TYP='M' | ZC.TYP='D' || _TAB.DNI || 0 ?};
   Godziny:={? ZC.TYP='G' || _TAB.GODZ || 0 ?};
   rep:=_TAB.REP;
   _znaki:=pars[1];
   _ind:=1;
   {!
   |? ($('pars['+$_ind+']'))():=240+_znaki;
      _znaki:=240-_znaki;
     _ind+=1;
     _znaki<>'' & _ind<=5
   !};

   exec('ins_par','rap_zew',__xr_ins,cnt,
      'F_NAZWA',KST.NAZWA,
      'MIEJSCE',PAR_WYDR.MIEJSC,
      'DATA',date()$4,
      'F_ULICA',exec('ulica','stalesys'),
      'F_POCZTA',exec('poczta','stalesys'),
      'F_REGON',KST.REG,
      'F_NIP',KST.NIP,
      'F_LOGO',{? PAR_WYDR.LOGO || exec('tmp_cp_logo','img_blob') || '' ?}
   );
   _kod:=obj_new(4); _kod[1]:='C'; _kod[2]:='S'; _kod[3]:='K'; _kod[4]:='I';
   _licz:=0;
   _exit:=0;
   {!
   |? _licz+=1;
      {? exec('szukaj','osoba',_kod[_licz],ZC.DZ) || _exit:=1 ?};
      ~_exit & _licz<obj_len(_kod)
   !};
   {? ~_exit || _licz:=1 ?};
   exec('ins_par','rap_zew',__xr_ins,cnt,
      'KTO',rep,
      'CO',pars[1],
      'GODZ',$Godziny,
      'DNI',$dni,
      'TYP',ZC.TYP,
      'WDNIU',ZC.DZ$4,
      'OSOBA',OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE+' '+OSOBA.DRUGIE,
      'PLEC',OSOBA.PLEC,
      'ADRES',exec('adres','osoba',_kod[_licz],ZC.DZ),
      'ODDNIA',ZC.DU$4,
      'DODNIA',ZC.DW$4);
   exec('ins_par','rap_zew',__xr_ins,cnt,
      'NUMER',(|ZC.NU),
      'KWOTA',form(ZC.KU,,2)+' '+{? ZC.CZYWAL='T' || ZC.WAL().KOD || 'zł' ?},
      'CZY_ZAP',params_get().ZAL,
      'CO_1',pars[2],
      'CO_2',pars[3],
      'CO_3',pars[4],
      'CO_4',pars[5]);
   ~~
}
{FI}
{EXIT: ~exec('ready','rap_zew',__xr_ins)}
{  _typ_umowy:=params_get().DRUK;
   _parametry:=obj_new('dni','godz','tresc','zleceniodawca');
   _parametry.dni:=dni;
   _parametry.godz:=Godziny;
   _parametry.tresc:=obj_new('co','co_1','co_2','co_3','co_4');
   _parametry.tresc.co:=pars[1];
   _parametry.tresc.co_1:=pars[2];
   _parametry.tresc.co_2:=pars[3];
   _parametry.tresc.co_3:=pars[4];
   _parametry.tresc.co_4:=pars[5];
   _parametry.zleceniodawca:=rep;
   params_set('zc',_parametry);
   _paperless:=var_pres('par',params_get())>100;
   {? _typ_umowy='uz'
   || {? exec('rep_set','rap_zew','PXX_UZ',1)='T'
      || ZC.P().OSOBA();
         _ret:=exec('wypelnij','szablon','PXX_UZ',,,2,,1);
         {? par.ZAL='1' & type_of(_ret)>100 & _ret.STATUS=1
         || {? _paperless
            || params_exec('dodaj_dokument','paperless',_ret.INFO,ZC.uidref())
            || exec('add_zal','zal','uz',,_ret.INFO)
            ?}
         ?}
      || exec('use_tmp','rap_zew','uz_umzc');
         {? par.ZAL='1'
         || {? _paperless
            || params_exec('dodaj_dokument','paperless','@!Tmp\\macrotmp.doc',ZC.uidref())
            || exec('add_zal','zal','uz')
            ?}
         ?}
      ?}
   || {? exec('rep_set','rap_zew','PXX_UD',1)='T'
      || ZC.P().OSOBA();
         _ret:=exec('wypelnij','szablon','PXX_UD',,,2,,1);
         {? par.ZAL='1' & type_of(_ret)>100 & _ret.STATUS=1
         || {? _paperless
            || params_exec('dodaj_dokument','paperless',_ret.INFO,ZC.uidref())
            || exec('add_zal','zal','dz',,_ret.INFO)
            ?}
         ?}
      || exec('use_tmp','rap_zew','uz_umdz');
         {? par.ZAL='1'
         || {? _paperless
            || params_exec('dodaj_dokument','paperless','@!Tmp\\macrotmp.doc',ZC.uidref())
            || exec('add_zal','zal','dz')
            ?}
         ?}

      ?}
   ?};~~
}
{EXIT}