:!UTF-8
{TITLE:A. Zestawienie zgłoszeń}
{PRINTER: exec('set_parw','param_wydr'); exec('prt','param_wydr','h'),,,,,'E','C',,,,,,1,PAR_WYDR.MBOT,PAR_WYDR.MLEFT,
      PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1,,'enable'}
{BEGIN:
   dalej:=0;
   {? var_press('PRN') > 0 || obj_del(PRN) ?};
   PRN:=obj_new(@.CLASS.PRINT,6); PRN.s_frame();
   prn1:='PRN';
   tryb:=rep_export();
   color:='';
   lm:=ll:=vp:=lmt:=rsep:=0;
   chck1:=0;
   chck2:=0;
   chck3:=0;
   chck4:=0;
   chck5:=0;
   radiob1:=0;
   par1:='';
   filtr:=''
}
{END:
   undefine();
   &dalej;
   obj_del(PRN);
   &prn1;
   &color;
   &lm; &ll; &vp; &lmt; &rsep;
   &tryb;
   &radiob1;
   &par1;
   &filtr;
   &chck1;
   &chck2;
   &chck3;
   &chck4;
   &chck5
}
{COMMENT}
  Wydruk listy zgłoszeń remontowych.
{COMMENT-}
{COMMENT}-----------------------Wykonanie akcji inicjalizujacych.---{COMMENT-}
{_wydr_naz:='zgl_001';
   _edit := WYDRUKIL.mk_edit('Parametry zestawienia'@,,'zgl_001',,,,);
   WYDRUKIL.win_esep(_edit,'Status rejestracji'@);
   WYDRUKIL.win_efld(_edit,,'CHKBOX01',,,,,,
   exec('status_new','remonty_zgloszenia',1),,,'check-box',,"1","0");
   WYDRUKIL.win_efld(_edit,,'CHKBOX02',,,,,,
   exec('status_ended','remonty_zgloszenia',1),,,'check-box',,"1","0");
   WYDRUKIL.win_efld(_edit,,'CHKBOX03',,,,,,
   exec('status_verified','remonty_zgloszenia',1),,,'check-box',,"1","0");
   WYDRUKIL.win_efld(_edit,,'CHKBOX04',,,,,,
   exec('status_completed','remonty_zgloszenia',1),,,'check-box',,"1","0");
   WYDRUKIL.win_efld(_edit,,'CHKBOX05',,,,,,
   exec('status_closed','remonty_zgloszenia',1),,,'check-box',,"1","0");
   exec('ok_esc','#window',WYDRUKIL,_edit);

WYDRUKIL.index('WYDRUKI');
WYDRUKIL.prefix(OPERATOR.USER().KOD,_wydr_naz);
{? ~WYDRUKIL.first()
|| WYDRUKIL.blank();
   WYDRUKIL.USERS:=OPERATOR.USER().KOD;
   WYDRUKIL.WYDRUK:=_wydr_naz;
   WYDRUKIL.add()
?};
   WYDRUKIL.win_edit(_edit);
~~}
{IF: WYDRUKIL.edit($("{? WYDRUKIL.CHKBOX01=0 & WYDRUKIL.CHKBOX02=0
                         & WYDRUKIL.CHKBOX03=0 & WYDRUKIL.CHKBOX04=0
                         & WYDRUKIL.CHKBOX05=0
                  || FUN.info('"+'Należy wybrać przynajmniej jeden status.'@+"'); 'CHKBOX01'
                  || 1
                  ?}"))}
{
   radiob1 := WYDRUKIL.RADIOB_1;
   chck1:=WYDRUKIL.CHKBOX01;
   chck2:=WYDRUKIL.CHKBOX02;
   chck3:=WYDRUKIL.CHKBOX03;
   chck4:=WYDRUKIL.CHKBOX04;
   chck5:=WYDRUKIL.CHKBOX05;
   WYDRUKIL.put(1);
~~}
{ELSE}
{EXIT}
{FI}
{IF: chck1=1 & chck2=1 & chck3=1 & chck4=1 & chck5=1}
{filtr:='';par1:='Wszystkie'@;~~}
{ELSE}
{  _statusy :='';
   filtr:='';par1:='';
   {? chck1=1
   || _statusy+='\''+exec('status_new','remonty_zgloszenia')+'\', ' ;
      par1+=exec('status_new','remonty_zgloszenia',1)+', '
   ?};
   {? chck2=1
   || _statusy+='\''+exec('status_ended','remonty_zgloszenia')+'\', ';
      par1+=exec('status_ended','remonty_zgloszenia',1)+', '
   ?};
   {? chck3=1
   || _statusy+='\''+exec('status_verified','remonty_zgloszenia')+'\', ';
      par1+=exec('status_verified','remonty_zgloszenia',1)+', '
   ?};
   {? chck4=1
   || _statusy+='\''+exec('status_completed','remonty_zgloszenia')+'\', ';
      par1+=exec('status_completed','remonty_zgloszenia',1)+', '
   ?};
   {? chck5=1
   || _statusy+='\''+exec('status_closed','remonty_zgloszenia')+'\', ';
      par1+=exec('status_closed','remonty_zgloszenia',1)+', '
   ?};
   _statusy:=_statusy -2;
   par1:=par1-2;
   filtr:='STAT_REJ in ('+_statusy+')';
~~
}
{FI}
{COMMENT}--------Definicja wiersza wydruku zgłoszeń rementowych REM_ZGL .---{COMMENT-}
{ PRN.add("REM_ZGL.SYM",15,'Symbol zgłoszenia'@);
  PRN.add("REM_ZGL.STAT_REJ",15,'Status rejestracji'@);
  PRN.add("REM_ZGL.REM_ZAS().SYMBOL",20,'Symbol zasobu'@);
  PRN.add("REM_ZGL.REM_ZAS().NAZWA",20,'Nazwa zasobu'@);
  PRN.add("REM_ZGL.REM_KATG().SYMBOL",20,'Kategoria zgłoszenia'@);
  PRN.add("REM_ZGL.TYTUL",20,'Tytuł'@);
  PAR_WYDR.TITLE:='ZESTAWIENIE ZGŁOSZEŃ REMONTOWYCH'@; ~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8'}{SPACE: 'B'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<{lmt+1} 'PARAMETRY WYDRUKU:'@}
{<{lmt+1}}{form('Wybrane statusy rejestracji:'@,30)}{<{lmt+1+30}}{'%1'[par1]}
{FONT: 'T8B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8B'}{SPACE: 'B'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: tryb<>1}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8'}{SPACE: 'B'}
{ rsep:=PAR_WYDR.RSEP; ~~}
{COMMENT}-----------------------------------------------------------{COMMENT-}
{
REM_ZGL.cntx_psh();
REM_ZGL.index('SYMBOL'); REM_ZGL.prefix();
REM_ZGL.f_set(,,filtr,);
~~}
{IF: REM_ZGL.f_first()}{ dalej:=1; ~~}{FI}
{WHILE: dalej}
{DO}
    {SUBSTITUTE: 'LINIA0'}
    {dalej:=REM_ZGL.f_next(); ~~}
{OD}
{REM_ZGL.cntx_pop();REM_ZGL.f_clear();~~}