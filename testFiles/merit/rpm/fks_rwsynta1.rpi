:!UTF-8
{  'W E R S J A  S Y N T E T Y C Z N A';
   sql_war:='';
   {? FINFO.NAROD<>SSTALE.WAL || sql_war:='SLOW.KOD=\''+SSTALE.WAL().KOD+'\' ' ?};
   {? UNPAR.PSLO || sql_war+='and OP_PROJ.SLO_PROJ=\''+$UNPAR.PSLO+'\' ' ?};
   {? ROZNE.KH_WYB<>null || sql_war+='and OP.KH=:_a ' ?};
   {? OPERATOR.DEPT || sql_war+='and ODD.OD=\':_b\' ' ?};
   {? UNPAR.P3=3 || sql_war+='and OP.TZ<to_date(:_c) ' ?};
   {? UNPAR.P15
   || sql_war+='and OP.DO between to_date(:_d) and '+
      {? UNPAR.P34 & UNPAR.P14>UNPAR.P42
      || 'to_date(:_f) '
      || 'to_date(:_e) '
      ?}
   |? UNPAR.P34
   || sql_war+='and OP.DO<=to_date(:_f) '
   ?};
   {? KONTO.K1+1='?'
   || {! |? KONTO.K1:=KONTO.K1-1; KONTO.K1+1='?' !}; {? +KONTO.K1<35 || KONTO.K1+='%' ?}
   ?};
   {! _i:=1..2 |!
      _f:='{? KONTO.K'+$_i+'<>\'\' || {? KONTO.K'+$_i+'=35*\'?\' || KONTO.K'+$_i+':=\'%\'?};'
         +'KONTO.K'+$_i+':=STR.gsub(KONTO.K'+$_i+',\'?\',\'_\');'
         +'KONTO.K'+$_i+':=STR.gsub(KONTO.K'+$_i+',\'*\',\'%\');'
         +'sql_war+=\'and OP.AN like \\\'\'+KONTO.K'+$_i+'+\'%\\\'\' ?}';
      ($(_f))()
   !};
   {? UNPAR.P1=3
   || STR.gsub(KONTO.K3,'?','_'); STR.gsub(KONTO.K3,'*','%');
      STR.gsub(KONTO.K4,'?','_'); STR.gsub(KONTO.K4,'*','%');
      sql_war+='and OP.AN between \''+KONTO.K3+'\' and \''+KONTO.K4+%255+'\' '
   |? UNPAR.P1=4
   ||  _okn:=KS.win_sel('?');
      TMPSIK.cntx_psh();
      exec('initmpks','dok_fks_zest');
      KS.select();
      KS.win_sel(_okn);
      {? TMPSIK.first()
      || sql_war+='and (OP.AN like \'' + TMPSIK.T2 + '%\' ';
         {!|? TMPSIK.next()
         |! sql_war+='or OP.AN like \'' + TMPSIK.T2 + '%\' '
         !};
         sql_war+=') '
      || sql_war+='and (OP.AN like \'%\')';ext_spr:=1
      ?};
      TMPSIK.cntx_pop()
   |? UNPAR.P1=5
   || _okn:=AN.win_sel('?');
      TMPSIK.cntx_psh();
      exec('initmpan','dok_fks_zest');
      AN.select();
      AN.win_sel(_okn);
      {? TMPSIK.first()
      || sql_war+='and (OP.AN like \'' + TMPSIK.T2 + '%\' ';
         {!|? TMPSIK.next()
         |! sql_war+='or OP.AN like \'' + TMPSIK.T2 + '%\' '
         !};
         sql_war+=') '
      || sql_war+='and (OP.AN like \'%\')';ext_spr:=1
      ?};
      TMPSIK.cntx_pop()
   |? UNPAR.P1=6
   || KON_SCH.cntx_psh();
      KON_SCH.index('IND_LP');
      KON_SCH.prefix(ROZNE.KON_WYDR);
      {? KON_SCH.first()
      || {? KON_SCH.MZ = 'M'
         || {! |?
               {? KON_SCH.MASKA+1='?' || KON_SCH.MASKA:=KON_SCH.MASKA-1 ?};
               KON_SCH.MASKA+1='?'
            !};
            KON_SCH.MASKA:=KON_SCH.MASKA+'%';
            KON_SCH.MASKA:=STR.gsub( KON_SCH.MASKA,'?','_');
            sql_war+='and (OP.AN like \''+KON_SCH.MASKA+'\''
         || sql_war+='and (OP.AN between \''+KON_SCH.ZOD+'\' and \''+KON_SCH.ZDO+%255+'\''
         ?};
         {!|? KON_SCH.next()
         |! {? KON_SCH.MZ = 'M'
            || {! |?
                  {? KON_SCH.MASKA+1='?' || KON_SCH.MASKA:=KON_SCH.MASKA-1 ?};
                  KON_SCH.MASKA+1='?'
               !};
               KON_SCH.MASKA:=KON_SCH.MASKA+'%';
               KON_SCH.MASKA:=STR.gsub( KON_SCH.MASKA,'?','_');
               sql_war+=' or OP.AN like \''+KON_SCH.MASKA+'\''
            || sql_war+=' or OP.AN between \''+KON_SCH.ZOD+'\' and \''+KON_SCH.ZDO+%255+'\''
            ?}
         !};
         sql_war+=') '
      || sql_war+='and (OP.AN like \'%\')'
      ?};
      KON_SCH.cntx_pop()
   ?};
   {? PAR_WYDR.T_ROZ<>'' || sql_war+='and OP.TYP like \''+PAR_WYDR.T_ROZ+'%\' ' ?};
   {? PAR_WYDR.SP<>'W'
   || sql_war+='and OP.SP=\''+PAR_WYDR.SP+'\' '
   ?};
   {? +sql_war & 3+sql_war='and' || sql_war:=4-sql_war ?};
   {? +sql_war & sql_war+1<>' ' || sql_war+=' ' ?};
   {? +sql_war || sql_war:='where '+sql_war ?};
   TAB_SQL:=sql(
      {? UNPAR.PSLO
      || 'select /*+MASK_FILTER(ZAP_PROJ,\'rozprz'+SSTALE.AR().KOD+'\')*/ '
      || 'select /*+MASK_FILTER(ZAP_OP,\'rozzap'+SSTALE.AR().KOD+'\')*/ '
      ?}
      +'OP.AN,OP.SYM,OP.SYM_ROK,SLOW.KOD as WAL,'+
      {? UNPAR.PSLO
      || 'ZAP_PROJ.WN,ZAP_PROJ.MA,ZAP_PROJ.DATA,REJ.KOD as REJ_KOD,ZAP_PROJ.NR,ZAP_PROJ.NR_POZ as POZ,'
         +'ZAP_PROJ.DKS,ZAP_PROJ.NK,ZAP_PROJ.KURS,ZAP_PROJ.PAR_POZ,OP.TYP,'
         +'PAR_NAG.TYP as TYPP,ZAP_PROJ.POZ as POZDOK,'
      || 'ZAP_OP.WN,ZAP_OP.MA,ZAP_OP.DATA,REJ.KOD as REJ_KOD,ZAP_OP.NR,ZAP_OP.POZ,'
         +'ZAP_OP.DKS,ZAP_OP.NK,ZAP_OP.KURS,ZAP_OP.PAR_POZ,OP.TYP,'
         +'PAR_NAG.TYP as TYPP,ZAP_OP.POZDOK,'
      ?}+'OP.TZ,OP.DO,SLO.KOD,'
      +{? UNPAR.PSLO || 'ZAP_PROJ' || 'ZAP_OP' ?}+'.WAL2 as WALR,OP.KH,KH.KOD as KONTR,ODD.OD,'
      +'KH.NAZ as KONTNAZ '+
      {? PAR_WYDR.NO_SPVAT<>'W'
      || {? UNPAR.PSLO
         || ',ZAP_PROJ.SP_V_WN as VWN, ZAP_PROJ.SP_V_MA as VMA '
         || ',ZAP_OP.SP_V_WN as VWN, ZAP_OP.SP_V_MA as VMA '
         ?}
      || ''
      ?}+
      {? gzwal=3
      || {? UNPAR.PSLO
         || ',ZAP_PROJ.SP_V_WN as WN2, ZAP_PROJ.SP_V_MA as MA2 '
         || ',ZAP_OP.SP_V_WN as WN2, ZAP_OP.SP_V_MA as MA2 '
         ?}
      |? UNPAR.PSLO
      || ',ZAP_PROJ.WN2,ZAP_PROJ.MA2 '
      || ',ZAP_OP.WN2,ZAP_OP.MA2 '
      ?}+
      {? UNPAR.PSLO
      || 'from @ZAP_PROJ join OP_PROJ using(ZAP_PROJ.OP_PROJ,OP_PROJ.REFERENCE) join OP using(OP_PROJ.OP,OP.REFERENCE) '
      || 'from @ZAP_OP join OP using(ZAP_OP.OP,OP.REFERENCE) '
      ?}
      +'join ODD using(OP.ODD,ODD.REFERENCE) '
      +'join REJ using('+{? UNPAR.PSLO || 'ZAP_PROJ' || 'ZAP_OP' ?}+'.REJ,REJ.REFERENCE) '
      +'left join SLO using('+{? UNPAR.PSLO || 'ZAP_PROJ' || 'ZAP_OP' ?}+'.WAL2,SLO.REFERENCE) '
      +'join SLO as SLOW using(OP.WAL,SLOW.REFERENCE) '
      +'left join @PAR_POZ using('+{? UNPAR.PSLO || 'ZAP_PROJ' || 'ZAP_OP' ?}+'.PAR_POZ,PAR_POZ.REFERENCE) '
      +'left join @PAR_NAG using(PAR_POZ.PAR_NAG,PAR_NAG.REFERENCE) '
      +'left join KH using(OP.KH,KH.REFERENCE) '
      +sql_war
      +'order by WAL,'+{? UNPAR.P9=1 || '' || 'KONTR,' ?}+'OP.AN,OP.TZ,OP.SYM,OP.SYM_ROK,ODD.OD',
      ROZNE.KH_WYB,OPERATOR.DEPT().OD,gdzap,UNPAR.P13,UNPAR.P14,UNPAR.P42); ~~}
{EXIT: type_of(TAB_SQL)<100 | ext_spr}
{  {? UNPAR.P3=4 | UNPAR.P3=1 | UNPAR.P2=1 | PAR_WYDR.NO_SPVAT<>'W' || exec('rwsynt_0','!fks_roz_zazr') ?};
   ind1:=TAB_SQL.ndx_tmp(,1,'WAL',,,'AN',,,'SYM',,,'SYM',,,'SYM_ROK',,,'OD',,,'DATA',,);
   {? ~OPERATOR.DEPT
   || _vo:=9; PRN11.add("w[15]",8,'Jed. ks.')
   || _vo:=0
   ?};
   {? rep_export()
   || PRN11.add("TAB_SQL.AN",35,'Konto')
   ?};
   _zwl:={? UNPAR.P3=2 | UNPAR.P3=3 || 0 || 9 ?};
   PRN11.add("w[1]",50,'Rozrachunek');
   PRN11.add("w[2]",10,'Data otwarcia');
   PRN11.add("w[3]",10,'Termin płatności');
   {? _zwl=0
   || PRN11.add("w[14]",8,'Dni po'+{? rep_export() || ' ' || '#' ?}+'terminie',1,'#')
   ?};
   {? PAR_WYDR.T_ROZ='' | +(|PAR_WYDR.T_ROZ)=1 || PRN11.add("w[13]",4,'Typ') ?};
   PRN11.add("w[4]",16,'Obroty Wn',1);
   PRN11.add("w[5]",16,'Obroty Ma',1);
   PRN11.add("w[6]",14,'Saldo Wn',1);
   PRN11.add("w[7]",14,'Saldo Ma',1);
   {? gzwal=3
   || PRN11.add("w[9]",16,'Obroty Wn VAT',1,'#');
      PRN11.add("w[10]",16,'Obroty Ma VAT',1,'#');
      PRN11.add("w[11]",14,'Saldo Wn VAT',1,'#');
      PRN11.add("w[12]",14,'Saldo Ma VAT',1,'#')
   |? gzwal
   || PRN11.add("w[8]",4,'Wal.');
      PRN11.add("w[9]",16,'Obroty Wn#w wal. obcej',1,'#');
      PRN11.add("w[10]",16,'Obroty Ma#w wal. obcej',1,'#');
      PRN11.add("w[11]",14,'Saldo Wn#w wal. obcej',1,'#');
      PRN11.add("w[12]",14,'Saldo Ma#w wal. obcej',1,'#')
   ?};
   {? gzwal=3
   || {? PAR_WYDR.T_ROZ='' | +(|PAR_WYDR.T_ROZ)=1
      || PRN12.add("w[1]",184+30+_vo-_zwl)
      || PRN12.add("w[1]",179+30+_vo-_zwl)
      ?}
   |? gzwal
   || {? PAR_WYDR.T_ROZ='' | +(|PAR_WYDR.T_ROZ)=1
      || PRN12.add("w[1]",189+30+_vo-_zwl)
      || PRN12.add("w[1]",184+30+_vo-_zwl)
      ?}
   || {? PAR_WYDR.T_ROZ='' | +(|PAR_WYDR.T_ROZ)=1
      || PRN12.add("w[1]",120+30+_vo-_zwl)
      || PRN12.add("w[1]",115+30+_vo-_zwl)
      ?}
   ?};
   {? PAR_WYDR.T_ROZ='' | +(|PAR_WYDR.T_ROZ)=1
   || PRN13.add("w[1]",56+30+_vo-_zwl)
   || PRN13.add("w[1]",51+30+_vo-_zwl)
   ?};
   PRN13.add("w[2]",16,'',1);
   PRN13.add("w[3]",16,'',1);
   PRN13.add("w[4]",14,'',1);
   PRN13.add("w[5]",14,'',1);
   {? gzwal
   || {? gzwal<>3 || PRN13.add("w[6]",4,'') ?};
      PRN13.add("w[7]",16,'',1);
      PRN13.add("w[8]",16,'',1);
      PRN13.add("w[9]",14,'',1);
      PRN13.add("w[10]",14,'',1)
   ?};
   {? PAR_WYDR.T_ROZ='' | +(|PAR_WYDR.T_ROZ)=1
   || PRN1F.add("wf[1]",56+30+_vo-_zwl)
   || PRN1F.add("wf[1]",51+30+_vo-_zwl)
   ?};
   PRN1F.add("wf[2]",16,'',1);
   PRN1F.add("wf[3]",16,'',1);
   PRN1F.add("wf[4]",14,'',1);
   PRN1F.add("wf[5]",14,'',1);
   {? gzwal
   || {? gzwal<>3 || PRN1F.add("wf[6]",4,'') ?};
      PRN1F.add("wf[7]",16,'',1);
      PRN1F.add("wf[8]",16,'',1);
      PRN1F.add("wf[9]",14,'',1);
      PRN1F.add("wf[10]",14,'',1)
   ?};
   {! _a:=1..13 |! w[_a]:='' !}; {! _a:=1..10 |! wf[_a]:='' !};
   PAR_WYDR.TITLE:=
   {? UNPAR.P34
   || 'Zestawienie '+{? 1+PAR_WYDR.T_ROZ='N'||'należności'||'zobowiązań'?}+' z tyt. dostaw, robót i usług na dzień bilansowy '+
      UNPAR.P42$3+'\nnie zapłacone do dnia: '+gdzap$3
   || 'ZESTAWIENIE ROZRACHUNKÓW: '+
      {? UNPAR.P2=1 || 'STAN NA '+$gdzap || {? UNPAR.P3=1 || 'ROZLICZONE' ||
      'Z ZAPISAMI' ?}+' OD '+$UNPAR.P5+' DO '+$UNPAR.P6 ?}
   ?};
   prn1:='PRN11'; prn2:='PRN13'; ~~}
{COMMENT}-----------------------------------SIGNATURE------------------------------------{COMMENT-}
{IF: ~rep_export()}
{SUBSTITUTE: 'FOOT'}
{FI}
{COMMENT}-----------------------------------MACRO-LINIA1F--------------------------------{COMMENT-}
{MACRO: 'LINIA1F'}
{PRN1F.ini_line()}
{WHILE: PRN1F.next()}
{DO}
{REP: PRN1F.fline(lmt)}
{OD}
{MACRO-}
{COMMENT}-----------------------------------MACRO-G1-------------------------------------{COMMENT-}
{MACRO: 'G1'}
{IF: lineleft()<3 & lineleft()<>0}{PAGE}{  vp:=prn:=1; ~~}{FI}
{IF: prn | s=1}
{  prn1:='PRN11'; prn2:='PRN12'; ~~}
{ELIF: s=2}
{  prn1:='PRN12'; prn2:='PRN12'; ~~}
{ELIF: s=3}
{  prn1:='PRN13'; prn2:='PRN12'; ~~}
{FI}
{  rsep:=1; fun:="prn:=0; s:=2; rsep:=PAR_WYDR.RSEP"; ~~}
{SUBSTITUTE: 'LINIA02'}
{MACRO-}
{COMMENT}-----------------------------------MACRO-G2-------------------------------------{COMMENT-}
{MACRO: 'G2'}
{IF: lineleft()<3 & lineleft()<>0}{PAGE}{  vp:=prn:=1; ~~}{FI}
{IF: prn}
{ prn1:='PRN11'; prn2:='PRN12'; ~~}
{ELIF: s=1}
{ prn1:='PRN11'; prn2:='PRN12'; ~~}
{ELIF: s=2}
{ prn1:=prn2:='PRN12'; ~~}
{ELIF: s=3}
{ prn1:='PRN13'; prn2:='PRN12'; ~~}
{FI}
{ rsep:=1; fun:="prn:=0; s:=2; rsep:=PAR_WYDR.RSEP"; ~~}
{SUBSTITUTE: 'LINIA02'}
{MACRO-}
{COMMENT}-----------------------------------MACRO-G3-------------------------------------{COMMENT-}
{MACRO: 'G3'}
{IF: lineleft()<3 & lineleft()<>0}{PAGE}{ prn:=vp:=1; ~~}{FI}
{IF: prn}
{ prn1:=prn2:='PRN11'; ~~}
{ELIF: s=1}
{ prn1:=prn2:='PRN11'; ~~}
{ELIF: s=2}
{ prn1:='PRN12'; prn2:='PRN11'; ~~}
{ELIF: s=3}
{ prn1:='PRN13'; prn2:='PRN11'; ~~}
{FI}
{  {? s=1 || rsep:=PAR_WYDR.RSEP || rsep:=1 ?};
   pkwn+=vpkwn;
   pkma+=vpkma;
   pswn+=F.SWn(swng3,smag3);
   psma+=F.SMa(swng3,smag3);
   pkwwn+=vpkwwn;
   pkwma+=vpkwma;
   pswwn+=F.SWn(swwng3,swmag3);
   pswma+=F.SMa(swwng3,swmag3);
   vpkwn:=vpkma:=vpkwwn:=vpkwma:=0;
   fun:="prn:=0; s:=1; rsep:=PAR_WYDR.RSEP"; ~~}
{SUBSTITUTE: 'LINIA02'}
{MACRO-}
{COMMENT}-----------------------------------MACRO-SG3------------------------------------{COMMENT-}
{MACRO: 'SG3'}
{IF: ((lineleft()<3 & +w[1]<47) | lineleft()<4) & lineleft()<>0}{PAGE}{  vp:=prn:=1; ~~}{FI}
{ prn1:='PRN11'; prn2:='PRN13'; fun:="prn:=0; s:=3; rsep:=PAR_WYDR.RSEP"; ~~}
{SUBSTITUTE: 'LINIA02'}
{MACRO-}
{COMMENT}-----------------------------------REPORT-HEADER--------------------------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}
{  {! _i:=2..4 |!
      _f:='{? KONTO.K'+$_i+'=\'%\' || KONTO.K'+$_i+':=35*\'?\' ?};'
         +'KONTO.K'+$_i+':=STR.gsub(KONTO.K'+$_i+',\'_\',\'?\');'
         +'KONTO.K'+$_i+':=STR.gsub(KONTO.K'+$_i+',\'%\',\'*\')';
      ($(_f))()
   !}; ~~}
{ lmt:=int((charleft()-PRN11.width())/2); wl:=75; ~~}
{IF: rep_export()}
{'PARAMETRY WYDRUKU:'}
{'Okres obrachunkowy: '+SSTALE.AO().NAZ+' '+SSTALE.AO().ROK().NAZ+' - okres '
   +{? SSTALE.AO().ZAM='T' || 'zamknięty' || 'otwarty' ?}}
{'Zakres danych: syntetycznie'}
{'Waluta: '+SSTALE.WAL().KOD+' - '+SSTALE.WAL().TR}
{'Zakres danych: rozrachunki '+rozl
   +{? +PAR_WYDR.T_ROZ || ' typu: '+PAR_WYDR.T_ROZ || '' ?}
   +{? UNPAR.P1=1
   || ' dla kont o masce '+{? KONTO.K1='' || 35*'?' || PAR_WYDR.MASKA ?}
   |? UNPAR.P1=2
   || ' dla kont o prefiksie '+KONTO.K2
   |? UNPAR.P1=3
   || ' dla kont od: '+KONTO.K3+ ' do: '+KONTO.K4
   |? UNPAR.P1=4
   || ' dla wybranych kont syntetycznych'
   |? UNPAR.P1=5
   || ' dla wybranych kont analitycznych'
   |? UNPAR.P1=6
   || ' dla zestawu kont: %1'@[ROZNE.KON_WYDR().KOD]
   ?}}
{<1 {? OPERATOR.DEPT || 'Jednostka księgowa: '+OPERATOR.DEPT().OD || 'Wszystkie jednostki księgowe' ?}}{<{wl} 'Zakres danych: '
+{? PAR_WYDR.SP='T' || ' tylko ze split payment' |? PAR_WYDR.SP='N' || 'bez split payment' || 'z i bez split payment' ?}}
{IF: ROZNE.KH_WYB<>null}{'Kontrahent: '+ROZNE.KH_WYB().KOD+' - '+ROZNE.KH_WYB().SKR }{FI}
{'Sortowanie: wg '+{? UNPAR.P9=2 || 'kontrahenta' || 'symbolu konta' ?}}
{IF: UNPAR.PSLO<>null}{'Projekt: '+UNPAR.PSLO().KOD+' - '+UNPAR.PSLO().TR}{FI}
{IF: UNPAR.P15}{<1 'Data otwarcia od: '+$UNPAR.P13+' do: '+$UNPAR.P14}{FI}
{ELSE}
{<1 'PARAMETRY WYDRUKU:'}
{<1 'Okres obrachunkowy: '+SSTALE.AO().NAZ+' '+SSTALE.AO().ROK().NAZ+' - okres '
   +{? SSTALE.AO().ZAM='T' || 'zamknięty' || 'otwarty' ?}}{<{wl} 'Zakres danych: syntetycznie'}
{<1 'Waluta: '+SSTALE.WAL().KOD+' - '+SSTALE.WAL().TR}{<{wl} 'Zakres danych: rozrachunki '+rozl
   +{? +PAR_WYDR.T_ROZ || ' typu: '+PAR_WYDR.T_ROZ || '' ?}
   +{? UNPAR.P1=1
   || ' dla kont o masce '+{? KONTO.K1='' || 35*'?' || PAR_WYDR.MASKA ?}
   |? UNPAR.P1=2
   || ' dla kont o prefiksie '+KONTO.K2
   |? UNPAR.P1=3
   || ' dla kont od: '+KONTO.K3+ ' do: '+KONTO.K4
   |? UNPAR.P1=4
   || ' dla wybranych kont syntetycznych'
   |? UNPAR.P1=5
   || ' dla wybranych kont analitycznych'
   |? UNPAR.P1=6
   || ' dla zestawu kont: %1'@[ROZNE.KON_WYDR().KOD]
   ?}}
{<1 {? OPERATOR.DEPT || 'Jednostka księgowa: '+OPERATOR.DEPT().OD || 'Wszystkie jednostki księgowe' ?}}{<{wl} 'Zakres danych: '
+{? PAR_WYDR.SP='T' || ' tylko ze split payment' |? PAR_WYDR.SP='N' || 'bez split payment' || 'z i bez split payment' ?}}
{IF: ROZNE.KH_WYB<>null}{<{wl} 'Kontrahent: '+ROZNE.KH_WYB().KOD+' - '+ROZNE.KH_WYB().SKR }{FI}
{<1 'Sortowanie: wg '+{? UNPAR.P9=2 || 'kontrahenta' || 'symbolu konta' ?}
}{IF: UNPAR.PSLO<>null}{<{wl} 'Projekt: '+UNPAR.PSLO().KOD+' - '+UNPAR.PSLO().TR}{FI}
{IF: UNPAR.P15}{<1 'Data otwarcia od: '+$UNPAR.P13+' do: '+$UNPAR.P14}{FI}
{FI}
{LINE: 1}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{ vp:=1; prn:=rozg3c:=1; ~~}
{COMMENT}-----------------------------------HEADER---------------------------------------{COMMENT-}
{HEADER}
{ prn1:='PRN11'; ~~}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{ vp:=prn:=1; ~~}
{HEADER-}
{COMMENT}-----------------------------------FOOTER---------------------------------------{COMMENT-}
{IF: PAR_WYDR.PAR5}
{FOOTER: 0}
{IF: s=1}{<{lmt+1} PRN11.jbar(PRN13)}{ELIF: s=2}{<{lmt+1} PRN12.jbar(PRN13)}{ELIF: s=3}{<{lmt+1} PRN13.bar()}{FI}{ rkwn+=pkwn; rkma+=pkma; rkwwn+=pkwwn; rkwma+=pkwma; rswn+=pswn; rsma+=psma; rswwn+=pswwn; rswma+=pswma; wf[1]:='Z przeniesienia'; wf[2]:=form(rkwn-pkwn,,2,' ,'); wf[3]:=form(rkma-pkma,,2,' ,'); wf[4]:=form(rswn-pswn,,2,' ,'); wf[5]:=form(rsma-psma,,2,' ,'); {? SSTALE.WAL<>FINFO.NAROD || wf[6]:=SSTALE.WAL().KOD; wf[7]:=form(rkwwn-pkwwn,,2,' ,'); wf[8]:=form(rkwma-pkwma,,2,' ,'); wf[9]:=form(rswwn-pswwn,,2,' ,'); wf[10]:=form(rswma-pswma,,2,' ,') || wf[6]:=wf[7]:=wf[8]:=wf[9]:=wf[10]:='' ?}; ~~}
{IF: page>1}{SUBSTITUTE: 'LINIA1F'}{<{lmt+1} PRN1F.bar()}{FI}
{  wf[1]:='Suma strony'; wf[2]:=form(pkwn,,2,' ,'); wf[3]:=form(pkma,,2,' ,'); wf[4]:=form(pswn,,2,' ,'); wf[5]:=form(psma,,2,' ,');
   {? SSTALE.WAL<>FINFO.NAROD | gzwal=3
   || wf[6]:=SSTALE.WAL().KOD; wf[7]:=form(pkwwn,,2,' ,'); wf[8]:=form(pkwma,,2,' ,'); wf[9]:=form(pswwn,,2,' ,'); wf[10]:=form(pswma,,2,' ,')
   || wf[6]:=wf[7]:=wf[8]:=wf[9]:=wf[10]:=''
   ?};
~~}
{SUBSTITUTE: 'LINIA1F'}
{<{lmt+1} PRN1F.bar()}
{  wf[1]:='Do przeniesienia'; wf[2]:=form(rkwn,,2,' ,'); wf[3]:=form(rkma,,2,' ,'); wf[4]:=form(rswn,,2,' ,'); wf[5]:=form(rsma,,2,' ,');
   {? SSTALE.WAL<>FINFO.NAROD | gzwal=3
   || wf[6]:=SSTALE.WAL().KOD; wf[7]:=form(rkwwn,,2,' ,'); wf[8]:=form(rkwma,,2,' ,'); wf[9]:=form(rswwn,,2,' ,'); wf[10]:=form(rswma,,2,' ,')
   || wf[6]:=wf[7]:=wf[8]:=wf[9]:=wf[10]:=''
   ?};
~~}
{SUBSTITUTE: 'LINIA1F'}
{<{lmt+1} PRN1F.lbar()}{  prn:=1; pkwn:=pkma:=pkwwn:=pkwma:=pswn:=psma:=pswwn:=pswma:=0; ~~}
{FOOTER-}
{ELSE}
{FOOTER: 0}
{<{lmt+1}}{REP: _f:=prn2+'.lbar()'; ($(_f))()}{ rkwn+=pkwn; rkma+=pkma; rkwwn+=pkwwn; rkwma+=pkwma; rswn+=pswn; rsma+=psma; rswwn+=pswwn; rswma+=pswma; prn:=1; pkwn:=pkma:=pkwwn:=pkwma:=pswn:=psma:=pswwn:=pswma:=0; ~~}
{FOOTER-}
{FI}
{COMMENT}-----------------------------------WYDRUK---------------------------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}
{  rsep:=PAR_WYDR.RSEP; ~~}
{  KS.index('SYM'); KS.prefix(BILANSP.AROK); ~~}
{FOR: TAB_SQL}
{PREFIX: SSTALE.WAL().KOD}
{DO}
   {IF: TAB_SQL.SYM_ROK<>gsym | TAB_SQL.OD<>godd | TAB_SQL.AN<>gan}
{COMMENT}
Sprawdzenie, czy zmienilo sie konto syntetyczne, analityczne lub kontrahent i drukowanie stosownych
naglowkow
{COMMENT-}
      {  gsym:=TAB_SQL.SYM_ROK; godd:=TAB_SQL.OD; gsbud:=0;
         {? KS.find_key(BILANSP.ASYNT+TAB_SQL.AN)
         || {? KS.SYM<>gks || gks:=KS.SYM; gcks:=1 ?};
            BUD.cntx_psh(); exec('rpm_clear','dok_fks'); synt:=TAB_SQL.AN;
            KOM.index('KS'); KOM.prefix(); {? KOM.find_key(KS.ref) || exec('rpm_display','dok_fks') ?};
            gsbud:=BUD.size(); BUD.cntx_pop()
         ?};
         {? (UNPAR.P9=1 & TAB_SQL.AN=gan) | (UNPAR.P9=2 & TAB_SQL.KONTR=gkontr)
         || gnrroz+=1
         || gnrroz:=1
         ?}; ~~}
      {IF: (gcks & UNPAR.P9=1) | (~gsbud & PAR_WYDR.PAR1=1 & UNPAR.P9=2)}
         {  w[1]:=KS.SYM+' - '+KS.NAZ; {! _a:=2..13 |!  w[_a]:='' !}; gcks:=0; ~~}
         {IF: ~rep_export()}{SUBSTITUTE: 'G1'}{FI}
      {FI}
      {IF: TAB_SQL.AN<>gan}
         {  gan:=TAB_SQL.AN; {! _a:=2..13 |! w[_a]:='' !};
            {? UNPAR.P9=1
            || {! _i:=1..gtwals |! twal[_i,1]:=''; {! _j:=2..3 |! twal[_i,_j]:=0 !} !}; gwal:='';
               swng2:=smag2:=swwng2:=swmag2:=0
            ?}; ~~}
         {IF: gsbud}
            {  w[1]:=($('KA.P'+$(gsbud)+'().TR'))(); w[1]:=TAB_SQL.AN+' - '+w[1];
               RS.index('RS'); RS.prefix();
               {! _i:=1..gsbud |!
                  {? RS.find_key(($('KA.P'+$(_i)+'().SLU().WZ'))())
                  || {? RS.TAB='KH'
                     || KH.index('KOD'); KH.prefix(2);
                        {? KH.find_key(($('KA.P'+$(_i)+'().KOD'))())
                        || w[1]:=TAB_SQL.AN+' - '+KH.SKR+' - '+KH.NAZ
                        ?}
                     ?}
                  ?}
               !}; ~~}
            {IF: ~rep_export()}{SUBSTITUTE: 'G2'}{FI}
         {FI}
      {FI}
      {IF: TAB_SQL.KONTR<>gkontr}
         {  gckontr:=1; gkontr:=TAB_SQL.KONTR;
            {! _i:=1..gtwals |! twal[_i,1]:=''; {! _j:=2..3 |! twal[_i,_j]:=0 !} !}; gwal:='';
            swng2:=smag2:=swwng2:=swmag2:=0; ~~}
      {FI}
      {  TAB_SQL.cntx_psh();
         w[1]:=TAB_SQL.SYM; w[2]:=$TAB_SQL.DO; w[3]:=$TAB_SQL.TZ; w[13]:=TAB_SQL.TYP; w[8]:='';
         w[15]:=TAB_SQL.OD;~~}
{COMMENT}
Zliczanie zapisow
{COMMENT-}
      {FOR: TAB_SQL}
      {INDEX: ind1}
      {PREFIX: SSTALE.WAL().KOD,TAB_SQL.AN,TAB_SQL.SYM,TAB_SQL.SYM,TAB_SQL.SYM_ROK,TAB_SQL.OD}
      {DO}
         {  swng3+=TAB_SQL.WN; smag3+=TAB_SQL.MA; swwng3+=TAB_SQL.WN2; swmag3+=TAB_SQL.MA2;
            swng2+=TAB_SQL.WN; smag2+=TAB_SQL.MA; swwng2+=TAB_SQL.WN2; swmag2+=TAB_SQL.MA2;
            vpkwn+=TAB_SQL.WN; vpkma+=TAB_SQL.MA; vpkwwn+=TAB_SQL.WN2; vpkwma+=TAB_SQL.MA2;
            gnrzap+=1;
            {? TAB_SQL.WALR<>'' | gzwal=3
            || {? w[8]='' || w[8]:=TAB_SQL.KOD ?}; {? TAB_SQL.KOD<>'' || gwal:=TAB_SQL.KOD ?};
               _v:=0;
               {! _i:=1..gtwals |! {? twal[_i,1]=w[8] || _v:=1 ?} !};
               {? ~_v
               || _i:=0; {! |? _i+=1; twal[_i,1]<>'' !};
                  twal[_i,1]:=w[8]; twal[_i,2]:=TAB_SQL.WN2; twal[_i,3]:=TAB_SQL.MA2
               || _i:=0; {! |? _i+=1; twal[_i,1]<>w[8] !};
                  twal[_i,2]+=TAB_SQL.WN2; twal[_i,3]+=TAB_SQL.MA2
               ?}
            ?};
            TAB_SQL.cntx_psh(); gg3:={? TAB_SQL.next() || 0 || 1 ?}; TAB_SQL.cntx_pop(); ~~}
         {IF: gg3}
            {  w[4]:=form(swng3,,2,' ,'); w[5]:=form(smag3,,2,' ,');
               w[6]:=form(F.SWn(swng3,smag3),,2,' ,'); w[7]:=form(F.SMa(swng3,smag3),,2,' ,');
               {? w[8]<>'' | gzwal=3
               || w[9]:=form(swwng3,,2,' ,'); w[10]:=form(swmag3,,2,' ,');
                  w[11]:=form(F.SWn(swwng3,swmag3),,2,' ,');
                  w[12]:=form(F.SMa(swwng3,swmag3),,2,' ,')
               || w[9]:=w[10]:=w[11]:=w[12]:=''
               ?};
               _v:={? PAR_SKID.get(47)='N' & (1+TAB_SQL.TYP='N' & smag3>swng3 | 1+TAB_SQL.TYP='Z' & swng3>smag3)
                   || -1
                   || gdzap-TAB_SQL.TZ
                   ?};
                   w[14]:={? _v<0 || '-' || _v ?};~~}
            {SUBSTITUTE: 'G3'}
         {FI}
      {OD}
      {  swng3:=smag3:=swwng3:=swmag3:=0;
         TAB_SQL.cntx_pop(); ~~}
   {FI}
{COMMENT}
Sprawdzenie czy drukowac wiersz Razem
{COMMENT-}
   {  gg2:=0;
      TAB_SQL.cntx_psh();
      {? UNPAR.P9=1
      || {? TAB_SQL.next()
         || {? TAB_SQL.AN<>gan || gg2:=1 ?}
         || gg2:=1
         ?}
      || {? TAB_SQL.next()
         || {? TAB_SQL.KONTR<>gkontr || gg2:=1 ?}
         || gg2:=1
         ?}
      ?};
      TAB_SQL.cntx_pop(); ~~}
{COMMENT}
Drukowanie wiersza Razem
{COMMENT-}
   {FONT: 'T8GB'}
   {IF: gg2 & ~rep_export()}
      {  i:=gv:=1; ~~}
      {WHILE: twal[i,1]<>'' | i=1}
      {DO}
         {  {? gv=1
            || rsep:=1;
               {? UNPAR.P9=2
               || {? TAB_SQL.KONTNAZ=''
                  || w[1]:='Razem i saldo '
                  || w[1]:='Razem i saldo ('+TAB_SQL.KONTNAZ+')'
                  ?}
               || w[1]:='Razem i saldo '+TAB_SQL.AN
               ?};
               w[2]:=form(swng2,,2,' ,'); w[3]:=form(smag2,,2,' ,');
               w[4]:=form(F.SWn(swng2,smag2),,2,' ,'); w[5]:=form(F.SMa(swng2,smag2),,2,' ,')
            || rsep:=0; w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=''
            ?};
            {? gwal<>'' | gzwal=3 & i=1
            || w[6]:=twal[i,1]; w[7]:=form(twal[i,2],,2,' ,'); w[8]:=form(twal[i,3],,2,' ,');
               w[9]:=form((F.SWn(twal[i,2],twal[i,3])),,2,' ,');
               w[10]:=form((F.SMa(twal[i,2],twal[i,3])),,2,' ,')
            || w[6]:=w[7]:=w[8]:=w[9]:=w[10]:=''
            ?};
            i+=1; gv+=1; ~~}
         {SUBSTITUTE: 'SG3'}
      {OD}
      {  swng2:=smag2:=swwng2:=swmag2:=0; ~~}
   {FI}
   {FONT: 'T8G'}
   {  gnrzap:=0; ~~}
{OD}
{COMMENT}-----------------------------------FOOTER-LAST----------------------------------{COMMENT-}
{IF: ~PAR_WYDR.PAR5}
{FOOTER: 0}
{IF: s=1 | s=0}{REP: PRN11.flbar(lmt)}{ELIF: s=2}{REP: PRN12.flbar(lmt)}{ELIF: s=3}{REP: PRN13.flbar(lmt)}{FI}{ vp:=1; ~~}
{FOOTER-}
{FI}
{IF: PAR_WYDR.PAR5}
{IF: ((page()=1 & lineleft()<5) | (page()>1 & lineleft()<9)) & lineleft<>0}{PAGE}{ vp:=1; ~~}{FI}
{ELSE}
{IF: ((page()=1 & lineleft()<2) | (page()>1 & lineleft()<4)) & lineleft<>0}{PAGE}{ vp:=1; ~~}{FI}
{FI}
{IF: lineleft()=0}{ s:=1; ~~}{FI}
{FOOTER}{FOOTER-}
{ENTIRE}
{ rkwn+=pkwn; rkma+=pkma; rswn+=pswn; rsma+=psma; rkwwn+=pkwwn; rkwma+=pkwma; rswwn+=pswwn; rswma+=pswma; ~~}
{IF: PAR_WYDR.PAR5 & ~rep_export()}
   {IF: s=1 | s=0}{IF: vp}{ PRN11.setcolor(color)}{<{lmt+1}}{REP: PRN11.fjbar(PRN13)}{PRN11.setcolor('255:255:255')}{ vp:=0; ~~}{ELSE}{<{lmt+1}}{REP: PRN11.fjbar(PRN13)}{FI}{ELIF: s=2}{<{lmt+1}}{REP: PRN12.jbar(PRN13)}{ELIF: s=3}{<{lmt+1}}{REP: PRN13.bar()}{FI}
   {  wf[1]:='Z przeniesienia'; wf[2]:=form(rkwn-pkwn,,2,' ,'); wf[3]:=form(rkma-pkma,,2,' ,'); wf[4]:=form(rswn-pswn,,2,' ,'); wf[5]:=form(rsma-psma,,2,' ,');
      {? SSTALE.WAL<>FINFO.NAROD | gzwal=3
      || wf[6]:=SSTALE.WAL().KOD; wf[7]:=form(rkwwn-pkwwn,,2,' ,'); wf[8]:=form(rkwma-pkwma,,2,' ,'); wf[9]:=form(rswwn-pswwn,,2,' ,'); wf[10]:=form(rswma-pswma,,2,' ,')
      || wf[6]:=wf[7]:=wf[8]:=wf[9]:=wf[10]:=''
      ?};
   ~~}
   {IF: page>1}{SUBSTITUTE: 'LINIA1F'}{<{lmt+1}}{REP: PRN1F.fbar(lmt)}
   {  wf[1]:='Suma strony'; wf[2]:=form(pkwn,,2,' ,'); wf[3]:=form(pkma,,2,' ,'); wf[4]:=form(pswn,,2,' ,'); wf[5]:=form(psma,,2,' ,');
      {? SSTALE.WAL<>FINFO.NAROD | gzwal=3
      || wf[6]:=SSTALE.WAL().KOD; wf[7]:=form(pkwwn,,2,' ,'); wf[8]:=form(pkwma,,2,' ,'); wf[9]:=form(pswwn,,2,' ,'); wf[10]:=form(pswma,,2,' ,')
      || wf[6]:=wf[7]:=wf[8]:=wf[9]:=wf[10]:=''
      ?};
   ~~}
   {SUBSTITUTE: 'LINIA1F'}
   {<{lmt+1}}{REP: PRN1F.fbar(lmt)}
   {FI}
{ELSE}
{<{lmt+1}}{IF: vp}{ PRN1F.setcolor(color)}{ELSE}{PRN1F.setcolor('255:255:255')}{FI}{REP: PRN1F.fbar(lmt)}{PRN1F.setcolor('255:255:255')}{ vp:=0; ~~}
{FI}
{IF: ~rep_export()}
   {  wf[1]:='Razem'; wf[2]:=form(rkwn,,2,' ,'); wf[3]:=form(rkma,,2,' ,'); wf[4]:=form(rswn,,2,' ,'); wf[5]:=form(rsma,,2,' ,');
      {? SSTALE.WAL<>FINFO.NAROD | gzwal=3
      || wf[6]:=SSTALE.WAL().KOD; wf[7]:=form(rkwwn,,2,' ,'); wf[8]:=form(rkwma,,2,' ,'); wf[9]:=form(rswwn,,2,' ,'); wf[10]:=form(rswma,,2,' ,')
      || wf[6]:=wf[7]:=wf[8]:=wf[9]:=wf[10]:=''
      ?};
   ~~}
   {SUBSTITUTE: 'LINIA1F'}
   {  wf[1]:='Saldo'; wf[2]:=wf[3]:=''; wf[4]:=form(F.SWn(rkwn,rkma),,2,' ,'); wf[5]:=form(F.SMa(rkwn,rkma),,2,' ,');
      {? SSTALE.WAL<>FINFO.NAROD | gzwal=3
      || wf[6]:=SSTALE.WAL().KOD; wf[7]:=wf[8]:=''; wf[9]:=form(F.SWn(rkwwn,rkwma),,2,' ,'); wf[10]:=form(F.SMa(rkwwn,rkwma),,2,' ,')
      || wf[6]:=wf[7]:=wf[8]:=wf[9]:=wf[10]:=''
      ?};
   ~~}
   {SUBSTITUTE: 'LINIA1F'}
   {<{lmt+1} PRN1F.lbar()}
   {<{lmt+1}>{PRN1F.width()+lmt} 'KONIEC WYDRUKU'}
{FI}
{ENTIRE-}