:!UTF-8
{ kl:=18;
  PRNH.add("",35+1+40,'',,,,,,,,2);
{? ROZNE.UT_ROZR
   ||  PRNH.add("",2*kl+1,'Bilans otwarcia - saldo'@,,,,,,,,2)
   ||  PRNH.add("",2*kl+1,'Bilans otwarcia - obroty'@,,,,,,,,2)
?};
  PRNH.add("",2*kl+1,'       Okres sprawozdawczy'@,,,,,,,,2);
  PRNH.add("",2*kl+1,'           Narastająco'@,,,,,,,,2);
  PRNH.add("",2*kl+1,'              Saldo'@,,,,,,,,2);
  PRN.add("w[1]",35,15*' '+'Konto'@);
  PRN.add("w[2]",40, {? rep_export() || 'Nazwa konta'@ || '(liczba subkont)         Nazwa konta'@ ?});
  PRN.add("form(w[3],kl,2,' ,')", kl,(kl-2)*' '+'Wn'@,1);
  PRN.add("form(w[4],kl,2,' ,')", kl,(kl-2)*' '+'Ma'@,1);
  PRN.add("form(w[5],kl,2,' ,')", kl,(kl-2)*' '+'Wn'@,1);
  PRN.add("form(w[6],kl,2,' ,')", kl,(kl-2)*' '+'Ma'@,1);
  PRN.add("form(w[7],kl,2,' ,')", kl,(kl-2)*' '+'Wn'@,1);
  PRN.add("form(w[8],kl,2,' ,')", kl,(kl-2)*' '+'Ma'@,1);
  PRN.add("form(w[9],kl,2,' ,')", kl,(kl-2)*' '+'Wn'@,1);
  PRN.add("form(w[10],kl,2,' ,')", kl,(kl-2)*' '+'Ma'@,1);
  PRNS.add("ww[1]",35+1+40, '',,,,,,,,2);
  PRNS.add("form(ww[3],kl,2,' ,')", kl,'',1);
  PRNS.add("form(ww[4],kl,2,' ,')", kl,'',1);
  PRNS.add("form(ww[5],kl,2,' ,')", kl,'',1);
  PRNS.add("form(ww[6],kl,2,' ,')", kl,'',1);
  PRNS.add("form(ww[7],kl,2,' ,')", kl,'',1);
  PRNS.add("form(ww[8],kl,2,' ,')", kl,'',1);
  PRNS.add("form(ww[9],kl,2,' ,')", kl,'',1);
  PRNS.add("form(ww[10],kl,2,' ,')", kl,'',1);
  PAR_WYDR.TITLE:='ZESTAWIENIE OBROTÓW I SALD KONT ANALITYCZNYCH \nZA OKRES od %1 do %2'@[$ROZNE.DATA_OD,$ROZNE.DATA_DO];~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}  --------------------------------  T A B H E A D 0  ---------------------------------------  {COMMENT-}
{MACRO: 'TABHEAD0'}
{  PRNH.setcolor(color);
   PRNH.ini_head(); ~~}
{REP: PRNH.fhbar()}
{WHILE: PRNH.h_next()}
{DO}
   {REP: PRNH.h_fmline()}
{OD}
{REP: PRNH.fjbar(PRN)}
{ _f:='PRN'+'.setcolor(color);'+'PRN'+'.ini_head()'; ($(_f))();~~}
{WHILE: _f:='PRN'+'.h_next()'; ($(_f))()}
{DO}
   {REP: _f:='PRN'+'.h_fmline()'; ($(_f))()}
{OD}
{IF: kon}
{REP: _f:='PRN'+'.flbar(lmt)'; kon:=0; ($(_f))()}
{FI}
{MACRO-}
{COMMENT}  -----------------------------------   HEADER  -------------------------------------------   {COMMENT-}
{HEADER}
{LINE: 1}

{FONT: 'HEAD'}{SPACE: 'B'}{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}

{IF: page=1 & ~ROZNE.WYD_TECH}
{ param:={? ROZNE.PAR4=2 & (_a:=STR.gsub(ROZNE.MASKA,'?','');+_a) || 'Dla kont o masce: '+ROZNE.MASKA
         |? ROZNE.PAR4=0 & +ROZNE.PREFIX || 'Wydruk dla kont o prefiksie: '+ROZNE.PREFIX
         |? ROZNE.PAR4=3  || 'Wydruk wybranych kont syntetycznych'@
         |? ROZNE.PAR4=4  || 'Wydruk dla zakresu kont od: '+ROZNE.KS_OD().SYM+' do: '+ROZNE.KS_DO().SYM
         |? ROZNE.PAR4=5  || 'Wydruk dla kont według schematu: '+ROZNE.KON_WYDR().KOD+' ('+ROZNE.KON_WYDR().ROK_F().NAZ+')'
         |? ROZNE.PAR4=6  || 'Wydruk wybranych kont analitycznych'@
         || 'Wydruk dla wszystkich kont'
         ?};~~}
{IF: rep_export()}
{'Parametry wydruku:'}
{'Obroty: '+{? ROZNE.PAR1 || 'narastająco z bilansem otwarcia' || 'narastająco bez bilansu otwarcia' ?}}
{wal}
{'Bilans otwarcia - liczone saldo: '+{? ROZNE.UT_ROZR||'tak'||'nie'?}}
{'Drukowanie pozycji z zerowymi wartościami: '@+{? ROZNE.UT_DOK || 'tak'@ || 'nie'@ ?}}
{{? UNPAR.PSLO || 'Waluta wydruku:  %1 - %2'@[UNPAR.PSLO().TR,SLO.KOD] || 'Waluta wydruku:  %1 - %2'@[SSTALE.WAL().TR,SLO.KOD] ?}}
{{? UNPAR.P25<>1 | (UNPAR.PSLO<>null & UNPAR.PSLO<>SSTALE.WAL) || 'Kurs: '@+$UNPAR.P25 || '' ?}}
{{? ROZNE.UT_KS || 'Podsumowanie po każdym poziomie: tak'@ ||'Podsumowanie po każdym poziomie: nie'@ ?}}
{param}
{odd}
{{? rokr<>''|| {? rokr='T' || 'Rodzaj okresu: zamknięty' || 'Rodzaj okresu: otwarty' ?} || '' ?}}
{{? ROZNE.PAR3 || 'Konta aktywno-pasywne drukować z podwójnymi saldami: tak' || 'Konta aktywno-pasywne drukować z podwójnymi saldami: nie' ?}}
{kontotxt}
{{? ROZNE.BZ='N' || 'Bilans zamknięcia nie uwzględniony'@ || 'Bilans zamknięcia uwzględniony'@ ?}}
{ELSE}
{<3 'Parametry wydruku:'}
{<6 'Obroty: '+{? ROZNE.PAR1 || 'narastająco z bilansem otwarcia' || 'narastająco bez bilansu otwarcia' ?}}{<76 wal}{<136 'Bilans otwarcia - liczone saldo: '+{? ROZNE.UT_ROZR||'tak'||'nie'?}
}{<187 {? ROZNE.UT_SCAL || 'Pomijać pozycje z wybranych słowników: tak'@ || 'Pomijać pozycje z wybranych słowników: nie'@ ?}}
{<6 'Drukowanie pozycji z zerowymi wartościami: '@+{? ROZNE.UT_DOK || 'tak'@ || 'nie'@ ?}
}{<76 {? UNPAR.PSLO || 'Waluta wydruku:  %1 - %2'@[UNPAR.PSLO().TR,SLO.KOD] || 'Waluta wydruku:  %1 - %2'@[SSTALE.WAL().TR,SLO.KOD] ?}
}{<100 {? UNPAR.P25<>1 | (UNPAR.PSLO<>null & UNPAR.PSLO<>SSTALE.WAL) || 'Kurs: '@+$UNPAR.P25 || '' ?}
}{<136 {? ROZNE.UT_KS || 'Podsumowanie po każdym poziomie: tak'@ ||'Podsumowanie po każdym poziomie: nie'@ ?}}
{<6 param}{<76 odd}{<136 {? rokr<>''|| {? rokr='T' || 'Rodzaj okresu: zamknięty' || 'Rodzaj okresu: otwarty' ?} || '' ?}}
{<6 {? ROZNE.PAR3 || 'Konta aktywno-pasywne drukować z podwójnymi saldami: tak' || 'Konta aktywno-pasywne drukować z podwójnymi saldami: nie' ?}
}{<76 kontotxt}{<136 {? ROZNE.BZ='N' || 'Bilans zamknięcia nie uwzględniony'@ || 'Bilans zamknięcia uwzględniony'@ ?}}
{FI}
{FI}
{LINE: 1}{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD0'}{vp:=1;~~}
{HEADER-}
{COMMENT}   -----------------------------------   FOOTER  -------------------------------------------  {COMMENT-}
{IF: ~rep_export()}
{SUBSTITUTE: 'FOOT'}
{FI}
{FOOTER:0}
{FONT:'T8G'}{SPACE:'C'}{PRN.jbar(PRNS)}
{ww[1]:=' SUMA STRONY'@;{! _i:=3..10|! ww[_i]:=wws[_i] !};prn1:='PRNS';~~}{SUBSTITUTE: 'LINIA0'}
{IF: page>1}{ ww[1]:=' Z PRZENIESIENIA'@;{! _i:=3..10|! ww[_i]:=wwp[_i]-wws[_i] !};~~}{SUBSTITUTE: 'LINIA0'}{FI}
{ww[1]:=' DO PRZENIESIENIA'@;{! _i:=3..10|! ww[_i]:=wwp[_i]; wws[_i]:=0 !};~~}{SUBSTITUTE: 'LINIA0'}
{vp:=1;prn1:='PRN';~~}{REP: PRNS.lbar()}
{FOOTER-}
{COMMENT}  -----------------------------------   WYDRUK  -------------------------------------------   {COMMENT-}
{IF: TABW.first()}
{FOR: TABW}
{INDEX: TABW.ndx_tmp('',0,'KONTO',,0,'REK',,0)}
{DO}
{FIRST}{k:=TABW.KS;r:=TABW.REK;~~}{FIRST-}
{ w[1]:={? TABW.REK='S' || (TABW.KONTO-1) || TABW.KONTO ?};
  w[2]:={? rep_export()
        || SSTALE.AR();
           _tab:=exec('kon_fun','konto',TABW.KONTO);
           _opis:='';
           {? ~ROZNE.WYD_TECH
           || {! _i:=1..obj_len(_tab[2])
              |! _opis+=_tab[2][_i]+' / '
              !};
              &_tab;
              _opis-3
           || TABW.OPIS
           ?}
        || TABW.OPIS
        ?};
 {? TABW.REK='O'
 || {? (+w[1])>BILANSP.ASYNT
    || _s:=w[1]; w[1]:=(+w[1]-int(TABW.BOWN))*' '+(w[1]+int(TABW.BOWN))
    ?};
    w[3]:=w[4]:=w[5]:=w[6]:=w[7]:=w[8]:=w[9]:=w[10]:=''
 || w[5]:=TABW.OBWN; w[6]:=TABW.OBMA; w[7]:=TABW.ONWN; w[8]:=TABW.ONMA;
    {? ROZNE.PAR3 & (TABW.REK='S' | TABW.REK='P') & ((TABW.BOWN<>0 & TABW.BOMA<>0) | (TABW.SAWN<>0 & TABW.SAMA<>0)) & TABW.KSSALDO='D'
    || w[3]:=TABW.BOWN; w[4]:=TABW.BOMA;
       w[9]:=TABW.SAWN; w[10]:=TABW.SAMA
    |? ROZNE.UT_SCAL & TABW.REK='P' & TABW.SCAL<0
    || w[3]:=TABW.BOWN; w[4]:=TABW.BOMA;
       w[9]:=TABW.SAWN; w[10]:=TABW.SAMA
    || {? ROZNE.UT_ROZR
       || w[3]:=F.SWn(TABW.BOWN,TABW.BOMA); w[4]:=F.SMa(TABW.BOWN,TABW.BOMA)
       || w[3]:=TABW.BOWN; w[4]:=TABW.BOMA
       ?};
       w[9]:=F.SWn(TABW.SAWN,TABW.SAMA); w[10]:=F.SMa(TABW.SAWN,TABW.SAMA)
    ?}
 ?};~~}
{ PRN.ini_line();~~}
{IF: lineleft()<>0 & lineleft()<PRN.length()}{PAGE}{FI}
{IF: (TABW.REK='S' | (k<>TABW.KS & r<>'S') | (TABW.REK='P' & TABW.KS=TABW.KONTO & r<>'S')) & {? r='O' || TABW.REK<>'O' || 1 ?} & {? r='S' || TABW.REK<>'S' || 1 ?}}
 {IF: lineleft<=2 & lineleft<>0}{PAGE}{ELSE}{IF: lineleft>0 | rep_export()}{REP: PRN.fbar(lmt)}{FI}{FI}
{FI}
{IF: TABW.REK='P'}{i+=1;{!_i:=3..10|! wwp[_i]+=w[_i]; wws[_i]+=w[_i] !};k:=TABW.KS;~~}{FI}
{IF: (TABW.REK='S' & TABW.KS=(TABW.KONTO-1)) | (TABW.REK='P' & TABW.KS=TABW.KONTO)}
 {{? ROZNE.PAR3 & TABW.KSSALDO='D'
  || wss[1]+=TABW.BOWN; wss[2]+=TABW.BOMA;
     wss[3]+=TABW.SAWN; wss[4]+=TABW.SAMA
  || {? ROZNE.UT_ROZR
     || wss[1]+=F.SWn(TABW.BOWN,TABW.BOMA); wss[2]+=F.SMa(TABW.BOWN,TABW.BOMA)
     || wss[1]+=TABW.BOWN; wss[2]+=TABW.BOMA
     ?};
     wss[3]+=F.SWn(TABW.SAWN,TABW.SAMA); wss[4]+=F.SMa(TABW.SAWN,TABW.SAMA)
  ?};~~}
{FI}
{IF: TABW.REK='S' | (TABW.KS=TABW.KONTO & TABW.REK='P')}{FONT:'T8GB'}{ELSE}{FONT:'T8G'}{FI}
{SPACE:'C'}{IF: (rep_export() & (TABW.REK='O' | TABW.REK='S'))=0}{SUBSTITUTE: 'LINIA0'}{FI}
{FIRST}{REP: PRN.fbar(lmt)}{FIRST-}
{IF: TABW.REK='S' & {? r='O' || TABW.REK<>'O' || 1 ?}}
 {IF: lineleft>1 }{REP: PRN.fbar(lmt)}{FI}
 {IF: lineleft=1 & TABW.REK='S'}{PAGE}{FI}
{FI}{FONT:'T8G'}{SPACE:'C'}
{r:=TABW.REK;~~}
{OD}
{COMMENT}   -----------------------------------   FOOTER  -------------------------------------------  {COMMENT-}
{FOOTER:0}
{REP: PRNS.lbar()}
{FOOTER-}
{FONT:'T8G'}{SPACE:'C'}
{prn2:='PRNS'; rsep:=1;~~}
{IF: ~rep_export()}
{ ww[1]:=' SUMA STRONY';{! _i:=3..10|! ww[_i]:=wws[_i] !};~~}
{SUBSTITUTE: 'LINIA02'}
{FI}
{rsep:=0; prn1:='PRNS';~~}
{IF: ~ROZNE.WYD_TECH}
{IF: page>1}
{ ww[1]:=' Z PRZENIESIENIA'@;{! _i:=3..10|! ww[_i]:=wwp[_i]-wws[_i] !};~~}
{SUBSTITUTE: 'LINIA0'}
{FI}
{ ww[1]:=' ANALITYCZNIE - RAZEM'@;{! _i:=3..10|! ww[_i]:=wwp[_i]; wws[_i]:=0 !};~~}
{SUBSTITUTE: 'LINIA0'}
{ ww[1]:=' ANALITYCZNIE - PER SALDO'@;ww[3]:=F.SWn(wwp[3],wwp[4]); ww[4]:=F.SMa(wwp[3],wwp[4]); ww[5]:=F.SWn(wwp[5],wwp[6]);
                      ww[6]:=F.SMa(wwp[5],wwp[6]); ww[7]:=F.SWn(wwp[7],wwp[8]); ww[8]:=F.SMa(wwp[7],wwp[8]);
                      ww[9]:=F.SWn(wwp[9],wwp[10]); ww[10]:=F.SMa(wwp[9],wwp[10]);~~}
{SUBSTITUTE: 'LINIA0'}
{ ww[1]:=' SYNTETYCZNIE - RAZEM'@;{! _i:=5..8|! ww[_i]:=wwp[_i] !}; ww[3]:=wss[1]; ww[4]:=wss[2]; ww[9]:=wss[3]; ww[10]:=wss[4];~~}
{SUBSTITUTE: 'LINIA0'}
{ ww[1]:=' SYNTETYCZNIE - PER SALDO'@;
                      ww[3]:=F.SWn(wss[1],wss[2]); ww[4]:=F.SMa(wss[1],wss[2]);
                      ww[5]:=F.SWn(wwp[5],wwp[6]); ww[6]:=F.SMa(wwp[5],wwp[6]);
                      ww[7]:=F.SWn(wwp[7],wwp[8]); ww[8]:=F.SMa(wwp[7],wwp[8]);
                      ww[9]:=F.SWn(wss[3],wss[4]); ww[10]:=F.SMa(wss[3],wss[4]);~~}
{SUBSTITUTE: 'LINIA0'}
{FI}
{FOOTER:0}
{FOOTER-}
{REP: PRNS.flbar(lmt)}
{kon:=1;~~}
{ENTIRE}
{IF: ~rep_export()}

{<{lmt}>{PRN.width()+lmt} 'KONIEC WYDRUKU'@}{FI}
{ENTIRE-}
{ELSE}
{FOOTER:0}
{FOOTER-}
{ _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
{REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
{ _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}
{REP: _f:=prn1+'.flbar(lmt)'; ($(_f))()}
{IF: ~rep_export()}
{<{lmt}>{PRN.width()+lmt} 'KONIEC WYDRUKU'@}
{FI}
{FI}