:!UTF-8
{TITLE:Karta - zestawienie roczne}
{PRINTER: exec('prt','param_wydr','h',KST),,,,,'Q','C',,,,,,1,
          PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   _cfg:=params_get().cfg;
   VAR_DEL.delete('par','tresc','prn1','rsep','lmt','vp','b_rat');

   PAR_WYDR.TITLE:=_cfg.TABLE.comment()+' - zestawienie roczne'@;
   tresc:='kartazup';
   par:=obj_new(5);

   par[1]:=obj_new(@.CLASS.PRINT,14);
   par[1].add("par[2].DATA.NAZWA",20,'Nazwa składnika'@);
   {! _s:=1..12 |!
      STR.split(date(date~1,_s,1)$8);
      par[1].add($('par[2].DATA.M'+$_s),12,STR.get_word(),1,,,,,'12,2')
   !};
   {? ~rep_export() || par[1].add("par[2].DATA.SUM",12,'Razem'@,1,,,,,'12,2') ?};
   par[1].s_frame();

   par[2]:=_cfg;
   par[5]:=1;

   prn1:='par[1]';
   rsep:=lmt:=0;
   vp:=1;

   b_rat:=1
}
{END:
   VAR_DEL.delete('par','tresc','prn1','rsep','lmt','vp','b_rat')
}
{INCLUDE: wsp_pw.rpi}
{COMMENT}

   K O N F I G U R A C J A   -   N A G Ł Ó W E K,   S T O P K A

{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{IF: par[5]}
   {FONT: 'T8G'}
   {SPACE: 'C'}
   {LINE}
   { par[5]:=0; ~~ }
   {<{lmt+1}'Parametry sprawozdania'}
   {<{lmt+1}'Rok: '+$par[2].R}
   {IF: rep_export()}
{INCLUDE: p_prac.rpi}
   {FI}
{FI}
{FONT: 'T8GB'}
{SPACE: 'C'}
{LINE}
{SUBSTITUTE: 'TABHEAD'}
{SUBSTITUTE: 'LINIAF'}
{HEADER-}
{IF: ~rep_export()}
   {SUBSTITUTE: 'FOOT'}
{FI}
{COMMENT}

   M A K R O D E F I N I C J E

{COMMENT-}
{MACRO: tresc}
{ENTIRE}
{IF: par[2].DATA.first()}
   {IF: ~rep_export()}
      {FONT: 'W10'}
      {SPACE: 'B'}
      {<{ceil(lmt*b_rat)+1}} {INCLUDE: p_prac.rpi}
   {FI}
   {FONT: 'T8G'}
   {SPACE: 'C'}
   {REP: par[1].fhbar(lmt)}
   {FOR: par[2].DATA}{DO}
      {IF: par[2].DATA.SUM}
         { par[1].ini_line(); ~~ }
         {WHILE: par[1].next()}{DO}
            {REP: par[1].fline(lmt)}
         {OD}
      {FI}
   {OD}
   {REP: par[1].flbar(lmt)}
{FI}
{ENTIRE-}
{MACRO-}
{COMMENT}

   Z A W A R T O Ś Ć   W Y D R U K U

{COMMENT-}
{FONT: 'W10'}{ b_rat:=charleft(); ~~ }
{FONT: 'T8G'}{ b_rat:={? rep_export() || charleft() || charleft()/b_rat ?}; ~~ }
{SPACE: 'C'}
{ lmt:=int((charleft()-par[1].width())/2); ~~ }
{SUBSTITUTE: tresc}
