:!UTF-8
{TITLE:B.  Roczna kartoteka księgowań}
{PRINTER: exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN: SA:='A'; ROZNE.blank(1);
        KON_WYDR.hdr_sel; KON_WYDR.hdr_sel(' - analityczne');
        KON_WYDR.actions('WER','I:I',':d'); USERS.actions('SLO','T');USERS.win_dict('SLO');
        r_wal:=czy_w:=p_wal:={? PAR_SKID.get(39)='T' || 1 |? PAR_SKID.get(39)='N' || 0 || 2 ?};
        w_join:='';
        exec('clear','unpar','BLBVBEAE','2','3');
        UNPAR.P2_BV:=UNPAR.P2_BE:='UNPAR.P3=0';
        UNPAR.P3_AE:='{? UNPAR.P3 || UNPAR.P2:=0 ?}; win_disp()';
        PAR_WYDR.ONAR:=PAR_WYDR.NAR:=PAR_WYDR.BO:=0;
        PAR_WYDR.NSAL:=PAR_WYDR.ZSAL:=PAR_WYDR.SAL:=0;
        PAR_WYDR.MAXKOL:=charleft()-1;
        {? rep_export=1 || PAR_WYDR.MAXKOL:=1000000 ?};
        {? WYDRUKI.P1<0 | WYDRUKI.P1>2 || WYDRUKI.P1:=2 ?};
        WYDRUKI.win_edit('OKRESY1');
        OKRO_F.cntx_psh();
        OKRO_F.index('ROK'); OKRO_F.prefix(SSTALE.AO().ROK); OKRO_F.first();
        ROZNE.UT_OKROD:=OKRO_F.ref(); ROZNE.UT_OKRDO:=SSTALE.AO;
        ROZNE.UT_ROKOD:=ROZNE.UT_ROKDO:=SSTALE.AR;
        OKRO_F.prefix(SSTALE.AO().ROK,1);
        {? OKRO_F.first() || dp:=OKRO_F.POCZ; dk:=OKRO_F.KON || dp:=date(SSTALE.AO().KON~1,SSTALE.AO().KON~2,1) ?};
        {? SSTALE.AO().NR>0
        || {? SSTALE.AO().KON<>date(0,0,0)
           || dk:=SSTALE.AO().KON
           || OKRO_F.prefix(SSTALE.AR); {? OKRO_F.last() & OKRO_F.prev() || dk:=OKRO_F.KON ?}
           ?}
        ?};
        {? WYDRUKI.P1=2
        || ROZNE.DATA_OD:=ROZNE.DATA_DO:=date(0,0,0)
        || ROZNE.UT_OKROD:=ROZNE.UT_OKRDO:=null;
           {? ROZNE.DATA_OD=date(0,0,0) || ROZNE.DATA_OD:=dp ?};
           {? ROZNE.DATA_DO=date(0,0,0) || ROZNE.DATA_DO:=dk ?}
        ?};
        kontotxt:=str_sql:=sql_war:=sql_join:=okres:=refr:=kont:=color:=sqlmfd:=sqlmfp:=sqlmfdn:=sqlmfpn:='';
        w:=obj_new(34); {! _i:=1..34 |! w[_i]:='' !};
        sn:=obj_new(4); so:=obj_new(4); sk:=obj_new(4); sr:=obj_new(4); sb:=obj_new(4); sob:=obj_new(4);
        ssb:=obj_new(4); ssob:=obj_new(4); ssn:=obj_new(4);
        prn1:='PRN';prn2:='PRN1';lm:=ll:=lmt:=vn:=ks1:=p:=r:=0; vp:=v:=1; rsep:=PAR_WYDR.RSEP;
        PRN:=obj_new(@.CLASS.PRINT,32); PRN.sl_frame();
        PRN0:=obj_new(@.CLASS.PRINT,32); PRN0.sl_frame();
        PRN1:=obj_new(@.CLASS.PRINT,1); PRN1.sl_frame();
        PRNS:=obj_new(@.CLASS.PRINT,7); PRNS.sl_frame();
        wal:={? SSTALE.WAL=FINFO.NAROD || 0 || 1 ?};
        odd:=(OPERATOR.DEPT<>null);
        tuser:=tm_form(TMPVAT.tm_stamp);
        VAR_DEL.delete('TABK','TABK_IS','TABK_IA','T_WAL','TAB_SQL');
        DOK.cntx_psh(); POZ.cntx_psh(); POW.cntx_psh(); AN.cntx_psh(); AN_SLU.cntx_psh()}
{END:  VAR_DEL.delete('TABK','TABK_IS','TABK_IA','T_WAL','TAB_SQL','PRN','PRN0','PRN1','PRNS','w','TABN');
       &czy_w; &w_join; &r_wal; &p_wal; &wal; &odd; &dp; &dk; &kontotxt; &tuser; &okres; &vn;&sqlmfd;&sqlmfp;&sqlmfdn;&sqlmfpn;
       &SA; &v; &str_sql; &sql_war; &sql_join; &prn1; &prn2; &lm; &ll; &lmt; &rsep; &vp; &refr; &kont; &ks1;&color; {? var_pres('s_sign')>0 || &s_sign ?};
       &p; &r;
       VAR_DEL.delete('sn','so','sk','sr','sb','sob','ssb','ssob','ssn','s_sign');
       USERS.actions('SLO',''); DOK.cntx_pop(); POZ.cntx_pop(); POW.cntx_pop(); AN.cntx_pop(); AN_SLU.cntx_pop(); OKRO_F.cntx_pop();
       exec('clear','unpar','BLBVBEAE','2','3')}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: k_kazapk.rpm
Modyfikacje: 2001-06-26 [AMK]
             2005-01-05 [MM]
==================================================
Zawartosc: Kartoteka zapisow ksiegowych
{COMMENT-}
{EXIT: ~(WYDRUKI.edit("PAR_WYDR.PAR2:=UNPAR.P2; exec('ar_k_kazapk','!fks_ksr_zakk')"))}
{EXIT: ~v}
{
  {? ROZNE.PAR4=2
  || WYDRUKIN.DLKON:=35; WYDRUKI.MASKA:=ROZNE.MASKA;
     {? +WYDRUKI.MASKA < WYDRUKIN.DLKON || WYDRUKI.MASKA+=(WYDRUKIN.DLKON-+WYDRUKI.MASKA)*'?' ?}
  ?};
  kontotxt:={? ROZNE.PAR4=0
            || 'Prefiks konta: %1'@[ROZNE.PREFIX+(35-+ROZNE.PREFIX)*'?']
            |? ROZNE.PAR4=2
            || 'Maska konta: %1'@[ROZNE.MASKA]
            |? ROZNE.PAR4=5
            || 'Zestaw kont: %1'@[ROZNE.KON_WYDR().KOD]
            |? ROZNE.PAR4=4
            || 'Zakres kont od: %1 do: %2'@[ROZNE.KS_OD().SYM,ROZNE.KS_DO().SYM]
            |? ROZNE.PAR4=3
            || 'Wybrane konta syntetyczne'@
            |? ROZNE.PAR4=6
            || 'Wybrane konta analityczne'@
            || ''
            ?};~~}
{IF: ROZNE.PAR4=3}
 { _okn:=KS.win_sel('?'); exec('initmpks','dok_fks_zest'); KS.select(); KS.win_sel(_okn);~~}
 {EXIT: ~TMPSIK.first()}
{ELIF: ROZNE.PAR4=6}
 { _okn:=AN.win_sel('?'); exec('initmpan','dok_fks_zest'); AN.select(); AN.win_sel(_okn);~~}
 {EXIT: ~TMPSIK.first()}
{FI}
{ exec('konta','dok_fks_zest',SSTALE.AR().KOD,SSTALE.WAL,3,'A',ROZNE.PAR4,
                     {?ROZNE.PAR4=0||ROZNE.PREFIX|?ROZNE.PAR4=2||ROZNE.MASKA|?ROZNE.PAR4=4||ROZNE.KS_OD().SYM||''?},
                     {?ROZNE.PAR4=4||ROZNE.KS_DO().SYM||''?},{? ROZNE.PAR4=5||ROZNE.KON_WYDR||null?},tuser);~~}
{INCLUDE: fks_k_kazapk.rpi}
