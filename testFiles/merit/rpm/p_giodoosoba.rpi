:!UTF-8
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: p_giodoosoba.rpi
OLD: skid_gos.rpi
k[6] - tabela z kodami do ustalenia opisu na podstawie wartości i przypisania go do zmiennej SKID.GIOOPIS
k[7] - obszar, z którego została wywołany wydruk np k[7]<>'personel' zamiast FL.SYSTEM<>'KALI'
==================================================
Zawartosc: Wydruk danych osobowych i operacji dokonywanych
           na danych osobowych dla osob
{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{FONT: 'T8'}{k[2]:=k[1]+19; k[3]:=charleft()*0.5+k[1]; k[4]:=k[3]+19;~~}
{COMMENT}---------------------------------------------MACRO INFADRES-----------------------------------------{COMMENT-}
{MACRO: 'infadres'}
{FONT: 'T8'}{>{k[1]}'Kraj'@}{>{k[2]}}{FONT: 'T8B'}{OS_ADRES.KRAJ().NAZ}{>{k[3]}}{FONT: 'T8'}{'Województwo'@}{>{k[4]}}{FONT: 'T8B'}{OS_ADRES.WOJEWODZ}
{FONT: 'T8'}{>{k[1]}'Powiat'@}{>{k[2]}}{FONT: 'T8B'}{OS_ADRES.POWIAT}{>{k[3]}}{FONT: 'T8'}{'Gmina'@}{>{k[4]}}{FONT: 'T8B'}{OS_ADRES.GMINA}
{FONT: 'T8'}{>{k[1]}'Miasto'@}{>{k[2]}}{FONT: 'T8B'}{OS_ADRES.MIASTO}{>{k[3]}}{FONT: 'T8'}{'Kod pocztowy'@}{>{k[4]}}{FONT: 'T8B'}{OS_ADRES.KOD}{
STR.split(OS_ADRES.ULICA);~~}
{FONT: 'T8'}{>{k[1]}'Ulica'@}{>{k[2]}}{FONT: 'T8B'}{STR.line(48)}{>{k[3]}}{FONT: 'T8'}{'%1, %2'['Nr domu'@,'nr lokalu'@]}{>{k[4]}}{FONT: 'T8B'}{OS_ADRES.DOM}{IF: +OS_ADRES.LOKAL}{' m. '@}{OS_ADRES.LOKAL}{FI}
{WHILE: STR.next()}
{DO}
   {>{k[2]}}{FONT: 'T8B'}{STR.line(48)}
{OD}
{FONT: 'T8'}{>{k[1]}'Nr telefonu'@}{>{k[2]}}{FONT: 'T8B'}{OS_ADRES.TEL}{>{k[3]}}{FONT: 'T8'}{'Adres e-mail'@}{>{k[4]}}{FONT: 'T8B'}{OS_ADRES.EMAIL}
{MACRO-}
{COMMENT}---------------------------------------------MACRO SRODEK-----------------------------------------{COMMENT-}
{IF: k[7]<>'personel' & PAR_SKID.get(7)='T' &
     ~FUN.ask('Szerszy zakres danych będzie prezentowany w wydruku\nuruchamianym z modułu Kadry i płace.'@+
              '\n'+'Czy mimo to przygotować wydruk?'@)}
{EXIT}
{FI}
{MACRO: 'srodek'}
{IF: _jest:=0;
     _data:=date(0,0,0);
     GIODO.index('GIODOSOB');
     GIODO.prefix(OSOBA.ref());
     {? GIODO.find_ge(date()-180)
     || {!
        |? _data:=GIODO.DATA;
           _jest:=(GIODO.KOD='I');
           ~_jest & GIODO.next()
        !}
     ?};
     {? _jest
     || FUN.ask('\n'+OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE+' '+{? OSOBA.PLEC='K' || 'otrzymała'@ || 'otrzymał'@ ?}+
                '\n'+'%1 %2'['informację o zakresie przetwarzanych danych dnia'@,($_data)]+
                '\n'+'(prawo do ponownego żądania udzielenia odpowiedzi na pytanie'@+
                '\n'+'o zakres przetwarzanych danych nie przysługuje przed upływem'@+
                '\n'+'sześciu miesięcy od daty odpowiedzi na poprzednie zapytanie).'@+
                '\n'+'Czy mimo to przygotować wydruk?'@+'\n'
           )
     || 1
     ?}
}
{_msg:='Udzielenie informacji osobie zainteresowanej o zakresie przetwarzania jej danych osobowych'@;
 exec('zapisz','giodo','osoba',OSOBA.ref(),date(),'I',_msg);~~}
{SPACE: 'A'}{IF: PAR_WYDR.LOGO}
{IF: exec('get_logo','img_blob')}{<1}{IMAGE: exec('get_logo','img_blob');0;1}{ELSE}
{<1}{BITMAP:'"logo.bmp",,1'}{FI}{FI}{SPACE: 'C'}
{FONT: 'T8'}{>{charleft()}PAR_WYDR.MIEJSC+', %1 %2'['dn.'@,$date()]}
{FONT: 'T8'}{'Administrator danych osobowych'@}
{FONT: 'T8'}{'%1:'['Nazwa'@]}{FONT: 'T8B'}{STR.split(XINFO.NAZ);~~}{>8}{STR.line(charleft())}
{IF: STR.next()}{>8}{STR.line(charleft())}{FI}{
STR.split(XINFO.UL+' '+XINFO.NR_D+{? |XINFO.NR_L='' || '' || ' m. '@+XINFO.NR_L ?});~~}
{FONT: 'T8'}{'%1:'['Adres'@]}{FONT: 'T8B'}{>8}{ STR.line(charleft())}
{WHILE: STR.next()}
{DO}
   {>8}{STR.line(charleft())}
{OD}
{>8}{ XINFO.KOD_P+' '+{? |XINFO.POCZ='' || XINFO.MIA || XINFO.POCZ ?}}
{FONT: 'T8'}REGON:{FONT: 'T8B'}{>8}{XINFO.REGON}
{LINE: 2}
{FONT: 'TITLE'}
{SPACE: 'A'}
{<1>76'Informacja o zakresie przetwarzania danych'@}
{SPACE: '@'}
{LINE: 1}
{HEADER}
{IF: k[7]<>'personel'}
   {SPACE: 'A'}
   {IF: PAR_WYDR.LOGO}{<1}{BITMAP:'"logo.bmp",,1'}{FI}
   {FONT: 'TITLE'}
   {<1>{charleft()}'Wykaz operacji dokonanych na danych osobowych'@}
   {SPACE: 'C'}
   {LINE: 1}
   {FONT: 'T8'}
   {<1}Data{<12'Opis'@}
{charleft()*'─'}
{FI}
{HEADER-}
{FONT: 'T8'}{'Dane identyfikacyjne i ewidencyjne'@}
{FONT: 'f'}{charleft()*'─'}
{FONT: 'T8'}{>{k[1]}'Nazwisko aktualne'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.NAZWISKO}{>{k[3]}}{FONT: 'T8'}{'Nazwisko rodowe'@}{>{k[4]}}{FONT: 'T8B'}{OSOBA.RODOWE}
{FONT: 'T8'}{>{k[1]}'Pierwsze imię'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.PIERWSZE}{>{k[3]}}{FONT: 'T8'}{'Drugie imię'@}{>{k[4]}}{FONT: 'T8B'}{OSOBA.DRUGIE}
{FONT: 'T8'}{>{k[1]}'Imię ojca'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.OJCIEC}{>{k[3]}}{FONT: 'T8'}{'Imię matki'@}{>{k[4]}}{FONT: 'T8B'}{OSOBA.MATKA}

{FONT: 'T8'}{>{k[1]}'Data urodzenia'@}{>{k[2]}}{FONT: 'T8B'}{{? OSOBA.UR_DATA<>#0 || $OSOBA.UR_DATA || '' ?}}{>{k[3]}}{FONT: 'T8'}{'Miejsce urodzenia'@}{>{k[4]}}{FONT: 'T8B'}{OSOBA.UR_MIEJ}
{FONT: 'T8'}{>{k[1]}'Płeć'@}{>{k[2]}}{FONT: 'T8B'}{{? OSOBA.PLEC='K' || 'kobieta'@ || 'mężczyzna'@ ?}}

{FONT: 'T8'}{>{k[1]}'Obcokrajowiec'@}{>{k[2]}}{FONT: 'T8B'}{yesno(OSOBA.OBCY)}{>{k[3]}}{FONT: 'T8'}{'Posiada kartę'@}
{>{k[3]}}{FONT: 'T8'}{'stałego pobytu'@}{>{k[4]}}{FONT: 'T8B'}{yesno(OSOBA.KARTA)}
{>{k[3]}}{FONT: 'T8'}{'Obywatelstwo'@}{>{k[4]}}{FONT: 'T8B'}{OSOBA.OBYWATEL}

{IF: exec('szukaj','osoba','S')}
{FONT: 'T8'}{>{k[1]}'Adres pobytu stałego'@}
{SUBSTITUTE: 'infadres'}
{FI}
{IF: exec('szukaj','osoba','C')}
{FONT: 'T8'}{>{k[1]}'Adres zamieszkania'@}
{SUBSTITUTE: 'infadres'}
{FI}
{IF: exec('szukaj','osoba','K')}
{FONT: 'T8'}{>{k[1]}'Adres do korespondencji'@}
{SUBSTITUTE: 'infadres'}
{FI}
{IF: exec('szukaj','osoba','I')}
{FONT: 'T8'}{>{k[1]}'Adres inny'@}
{SUBSTITUTE: 'infadres'}
{FI}

{FONT: 'T8'}{>{k[1]}'Dowód osobisty'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.DOWOD}{IF: +OSOBA.ORG_DOW}{FONT: 'T8'} ({'wydany przez'@}{FONT: 'T8B'} {OSOBA.ORG_DOW}){FI}
{FONT: 'T8'}{>{k[1]}'Paszport'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.PASZPORT}{IF: +OSOBA.ORG_PASZ}{FONT: 'T8'} ({'wydany przez'@}{FONT: 'T8B'} {OSOBA.ORG_PASZ}){FI}

{FONT: 'T8'}{>{k[1]}'NIP'}{>{k[2]}}{FONT: 'T8B'}{OSOBA.NIP}
{FONT: 'T8'}{>{k[1]}'Numer PESEL'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.PESEL}
{IF: k[7]='personel'}

{ OS_SZKOL.prefix(P.OSOBA); ~~}
{IF:  OS_SZKOL.last()}
{FONT: 'T8'}{>{k[1]}'Wykształcenie'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.WYK().WK}{>{k[3]}}{FONT: 'T8'}{'Zawód wyuczony'@}{>{k[4]}}{FONT: 'T8B'}{{? OS_SZKOL.ZAW || OS_SZKOL.ZAW().ZD || '<%1>'['brak danych'@] ?}}
{FI}

{FONT: 'T8'}{>{k[1]}'Dane wprowadził'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.REJ_KTO}{>{k[3]}}{FONT: 'T8'}{'Źródło danych'@}{>{k[4]}}{FONT: 'T8B'}{OSOBA.REJ_INFO}
{FONT: 'T8'}{>{k[1]}'Data rejestracji'@}{>{k[2]}}{FONT: 'T8B'}{{? OSOBA.REJ_DATA<>#0 || OSOBA.REJ_DATA || '' ?}}
{ENTIRE}
{FOR: PKO}{INDEX: '_PKO'}{PREFIX: OSOBA.ref()}{DO}
{FIRST}

{FONT: 'T8'}{'Informacje o rachunkach bankowych'@}
{FONT: 'f'}{charleft()*'─'}
{FONT: 'T8'}{>{k[1]}'Nazwa banku'@}{>{k[4]}'Numer konta'@}
{FIRST-}
{FONT: 'T8B'}{>{k[1]}}{PKO.BA().NB}{>{k[4]}}{PKO.N}
{OD}
{ENTIRE-}

{ENTIRE}
{FOR: RD}{INDEX: '_RODZINA'}{PREFIX: OSOBA.ref()}{DO}
{FIRST}
{FONT: 'T8'}{'Dane osobowe członków rodziny'@}
{FONT: 'f'}{charleft()*'─'}
{FIRST-}
{FONT: 'T8'}{>{k[1]}'Nazwisko'@}{>{k[2]}}{FONT: 'T8B'}{RD.NA}{>{k[3]}}{FONT: 'T8'}{'Imię'@}{>{k[4]}}{FONT: 'T8B'}{RD.IM}
{FONT: 'T8'}{>{k[1]}'Data urodzenia'@}{>{k[2]}}{FONT: 'T8B'}{$RD.DA}{>{k[3]}}{FONT: 'T8'}{'Numer PESEL'@}{>{k[4]}
}{FONT: 'T8B'}{RD.PESEL}
{IF: RD.STPK}{FONT: 'T8'}{>{k[1]}'Pokrewieństwo'@}{>{k[2]}
}{FONT: 'T8B'}{form(exec('memo2print','#string',S_ZUS,'OPIS',RD.STPK))}
{LINE: 2}
{FI}
{OD}
{ENTIRE-}
{ELSE}
{FONT: 'T8'}{>{k[1]}'Źródło danych'@}{>{k[2]}}{FONT: 'T8B'}{OSOBA.REJ_INFO}
{FI}
{IF: k[7]='personel' & lineleft()<>0}
   {PAGE}
{ELSE}
   {LINE: 2}
{FI}
{ k[5].erase();
  GIODO.cntx_psh();
  GIODO.index('GIODOSOB');
  GIODO.prefix(OSOBA.ref());
  {? GIODO.first()
  || {!
     |? k[5].DATA:=GIODO.DATA;
        k[5].OPIS:=GIODO.OPER;
        k[5].KOD:=GIODO.KOD;
        STR.split(STR.gsub(GIODO.memo_txt(,1,'OPIS'),'\n',' '));
        k[5].OPIS1:=STR.line(255);
        k[5].OPIS2:=STR.line(255);
        k[5].OPIS3:=STR.line(255);
        k[5].add();
        GIODO.next()
     !}
  ?};
  GIODO.cntx_pop(); ~~}
{IF: k[5].first()}
{FOR: k[5]}{DO}
{FIRST}
{FONT: 'TITLE'}
{SPACE: 'A'}
{<1>{charleft()}'Wykaz operacji dokonanych na danych osobowych'@}
{SPACE: '@'}
{LINE: 1}
{FONT: 'T8'}
{<1'Data'@}{<12'Opis'@}
{charleft()*'─'}
{ GIODO.cntx_psh();
  GIODO.index('GIODOSOB');
  GIODO.prefix();
  GIODO.blank(1);
  GIODO.OSOBA:=OSOBA.ref();
  GIODO.KOD:='W';~~}
{IF: |PAR_SKID.get(13)<>'' & ~GIODO.find_rec()}
{FONT: 'T8B'}
{<1}{|PAR_SKID.get(13)}{>12}{'Data rozpoczęcia rejestracji operacji na danych osobowych'@}
{FI}
{  GIODO.cntx_pop();~~}
{FIRST-}
{ENTIRE}{ dru_dat:=0;~~}
{FONT: 'T8B'}
{IF: (|k[5].OPIS1='' & |k[5].OPIS2='' & |k[5].OPIS3='') | -k[5].KOD='w'}
{<1}{k[5].DATA}{>12}{FONT: 'T8'}{ {? -k[5].KOD='w' || k[5].OPIS+' - ' || '' ?}+
{? |k[5].OPIS1='' & |k[5].OPIS2='' & |k[5].OPIS3=''
|| {? exec('kod_opis','giodo',k[6],k[5].KOD) || SKID.GIOOPIS || '' ?}
|| '' ?}}
{ dru_dat:=1;~~}
{FI}
{FONT: 'T8'}
{IF: +(|k[5].OPIS1)}
{ STR.split(|k[5].OPIS1);~~}
{WHILE: STR.next()}
{DO}
{IF: dru_dat=0}{FONT: 'T8B'}{<1}{k[5].DATA}{>12 {? -k[5].KOD='w' || k[5].OPIS+' ' || '' ?}}{FONT: 'T8'}{STR.line(105)}
 { dru_dat:=1;~~}
{ELSE}{FONT: 'T8'}{>12}{STR.line(105)}
{FI}
{OD}
{FI}
{IF: +(|k[5].OPIS2)}
{ STR.split(|k[5].OPIS2);~~}
{WHILE: STR.next()}
{DO}
{IF: dru_dat=0}{FONT: 'T8B'}{<1}{k[5].DATA}{>12 {? -k[5].KOD='w' || k[5].OPIS+' ' || '' ?}}{FONT: 'T8'}{STR.line(105)}
 { dru_dat:=1;~~}
{ELSE}{FONT: 'T8'}{>12}{STR.line(105)}
{FI}
{OD}
{FI}
{IF: +(|k[5].OPIS3)}
{ STR.split(|k[5].OPIS3);~~}
{WHILE: STR.next()}
{DO}
{IF: dru_dat=0}{FONT: 'T8B'}{<1}{k[5].DATA}{>12 {? -k[5].KOD='w' || k[5].OPIS+' ' || '' ?}}{FONT: 'T8'}{STR.line(105)}
 { dru_dat:=1;~~}
{ELSE}{FONT: 'T8'}{>12}{STR.line(105)}
{FI}
{OD}
{FI}
{ENTIRE-}
{OD}
{IF: k[5].first() & lineleft()<>0}
{PAGE}
{FI}
{FI}
{ELIF: k[7]<>'personel'}
{EXIT}
{FI}
{MACRO-}
{COMMENT}---------------------------------------------CIALO WYDRUKU-----------------------------------------{COMMENT-}