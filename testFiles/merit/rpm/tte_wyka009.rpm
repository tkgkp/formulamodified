:!UTF-8
{TITLE:F. Zestawienie wynagrodzeń wg kont zleceń}
{PRINTER: INFO.W_PRN,,,,,'E','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
      PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
  ZLGD.cntx_psh;
  ZL.cntx_psh();
  PRN:=obj_new(@.CLASS.PRINT,5);
  PRN.s_frame();
  PRNSUM:=obj_new(@.CLASS.PRINT,5);
  PRNSUM.s_frame();
  __TAB:=tab_tmp(1,'KK','INTEGER','Ref do kk',
                   'SYM','STRING[20]','Symbol kk',
                   'KW','REAL','Wynagrodzenie');
  ndx:=__TAB.ndx_tmp(,1,'SYM',,);
  ndxzlgd1:=ZLGD.ndx_tmp(,1,'O',,0,
                           'ZL',,0,
                           'DT',,0,
                           'ZMIANA',,0);
  prn1:='PRN';
  prn2:='PRNSUM';
  tryb:=rep_export();
  waslbar:=0;
  dalej:=0;
  suma:=0;
  color:='';
  lm:=ll:=vp:=lmt:=rsep:=0
}
{END:
  ZLGD.cntx_pop;
  ZL.cntx_pop;
  __TAB.ndx_drop(ndx);
  ZLGD.ndx_drop(ndxzlgd1);
  obj_del(PRN);
  obj_del(PRNSUM);
  obj_del(__TAB);
  &dalej;
  &suma;
  &prn1;
  &prn2;
  &color;
  &lm; &ll; &vp; &lmt; &rsep;
  &tryb
}
{COMMENT}
  Wydruk zestawienia wynagrodzeń wg kont grup wyrobów.
   [MK]
  Wywołanie: Wykonania produkcji -> Raporty -> Zestawienia
{COMMENT-}
{COMMENT}--Definicja wiersza zestawienia wynagrodzeń wg kont grup wyrobów.--------------------{COMMENT-}
{
   PRN.add("__TAB.SYM",20,'Konto analityczne'@);
   PRN.add("form(__TAB.KW,,2)",16,'Wynagrodzenie'@,1);
   PRNSUM.add("'SUMA'@",20,'',1);
   PRNSUM.add("form(suma,,2)",16,'Wynagrodzenie'@,1);
   PAR_WYDR.TITLE:='ZESTAWIENIE WYNAGRODZEŃ WG KONT ZLECEŃ'@;
~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T10'}{SPACE: 'B'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<{lmt+1} 'PARAMETRY WYDRUKU:'@}
{<{lmt+1}}{'Oddział %1'@[(ODDZ.index('KOD2'); ODDZ.prefix(ST.ODDZ,ST.ODDZ); {? ODDZ.first() || ODDZ.NAZ ?})]}
{<{lmt+1} 'Rok: %1 Okres: %2'@[$ST.AR,form(ST.AM,-2)]}
{FONT: 'T10B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T10'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T10B'}{SPACE: 'B'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: tryb<>1}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{MACRO: 'utwtab'}
{ ZLGD.cntx_psh();
  ZLGD.clear();
  ZLGD.index(ndxzlgd1);
  ZLGD.prefix(ST.OKR_REF);
  {? ZLGD.first()
  ||
     {!
     |?
        _kk:={? ZLGD.ZL().KK<>null()
             || _ref:=#ZLGD.ZL().KK;ZLGD.ZL().KK().SYM
             || _ref:=0;''
             ?};
        __TAB.prefix(_ref);
        {? __TAB.first()
        || __TAB.KW+=ZLGD.KW;
           __TAB.put()
        || __TAB.KK:=_ref;
           __TAB.SYM:=_kk;
           __TAB.KW:=ZLGD.KW;
           __TAB.add()
        ?};
        ZLGD.next()
     !}
  ?};
  ZLGD.cntx_pop()
;~~}
{MACRO-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T10'}{SPACE: 'B'}
{ rsep:=PAR_WYDR.RSEP; ~~}
{SUBSTITUTE: 'utwtab'}
{FOR: __TAB}
 {INDEX: ndx}
{DO}
{SUBSTITUTE: 'LINIA0'}
{suma+=__TAB.KW;~~}
{OD}
{FOOTER: 0}
{FOOTER-}
{IF: tryb=1}
   {SUBSTITUTE: 'LINIAF'}
{ELSE}
   {FOOTER: 0}
   {FOOTER-}
   {SUBSTITUTE: 'LINIAFS'}
{FI}
