:!UTF-8
{TITLE:C. Dokumenty w rejestrach}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','B',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   AN.cntx_psh(); DOK.cntx_psh(); par_okr:=par_odd:=par_wal:=par_daty:='';
   sstr4:=sstr5:=suma4:=suma5:=lm:=lmt:=0;
   nar4:=nar5:=0; rejsym:=mdc:=''; rsep:='';
   kl:=il:=0; rejestr:=0; rejodd:=''; okres:=0;  odd:=0; PAR_WYDR.OMASKA:=1;
   prn1:='PRN'; prn2:=''; color:=''; last_nr:=0;vp:=0;
   kolu:=obj_new(20); kolnaz:=obj_new(10); p:=obj_new(20); w:=obj_new(20);
   PRN:=obj_new(@.CLASS.PRINT,10);PRN.sl_frame();
   PRN1:=obj_new(@.CLASS.PRINT,3);PRN1.sl_frame();
   PRNF:=obj_new(@.CLASS.PRINT,3);PRNF.sl_frame(); f:=obj_new(3);
   indtym1:=POZ.ndx_tmp('',1,'DOK','A',0,'DOK','ZK',0,'DOK','REJ',0,'DOK','DTW',0,'DOK','NK',0,'POZ',,0)
}
{END:
   AN.cntx_pop(); DOK.cntx_pop();
   &prn1; &prn2; &par_okr; &par_odd; &par_wal; &par_daty; &mdc; &lm; &lmt; &rsep;
   &sstr4; &sstr5; &suma4; &suma5; &nar4; &nar5; &color; &last_nr; &vp;
   &kl; &il;  &rejestr;  &rejodd; &okres; &rejsym;
   VAR_DEL.delete('PRN','PRN1','PRNF','kolu','kolnaz','p','w','f');
   &indtym1; &odd; POZ.ndx_drop()
}
  { ROZNE.UT_OKROD:=ROZNE.UT_OKRDO:=SSTALE.AO;
    PAR_WYDR.win_edit('DZIESKR2'@);
    PAR_WYDR.PAR1:=1;
    PAR_WYDR.DPAR1:=SSTALE.AO().POCZ;
    PAR_WYDR.DPAR2:=SSTALE.AO().KON;
    PAR_WYDR.efld_opt('DZIESKR2','editable=1',PAR_WYDR,'DPAR1');
    PAR_WYDR.efld_opt('DZIESKR2','editable=1',PAR_WYDR,'DPAR2');
    ~~}
  {EXIT: ~PAR_WYDR.edit("exec('spr_par_wydruk','dok_fks1')") |
      {? PAR_WYDR.PAR1=2
      || REJ.cntx_psh;
         REJ.index('KOD');
         {? OPERATOR.DEPT=null
         || REJ.prefix(SSTALE.AR); REJ.win_sel('WYB_ODD')
         || REJ.prefix(SSTALE.AR,OPERATOR.DEPT); REJ.win_sel('WYB')
         ?};
         _ok:={? REJ.select()
              || rejestr:=REJ.ref;
                 rejsym:=REJ.KOD;
                 rejodd:=REJ.ODD().OD; 0
              || 1
              ?};
         REJ.cntx_pop();
         _ok
      ?}
   }
   {
     {? ROZNE.UT_OKROD<>ROZNE.UT_OKRDO
     ||  par_okr:='Okresy obrachunkowe: %1 - %2 %3'@[ROZNE.UT_OKROD().NAZ,ROZNE.UT_OKRDO().NAZ,SSTALE.AO().ROK().NAZ]
     ||  par_okr:='Okres obrachunkowy: %1 %2'@[ROZNE.UT_OKROD().NAZ,SSTALE.AO().ROK().NAZ];
         {? SSTALE.AO().ZAM='T'
            || par_okr+=' - okres zamknięty'@
            || par_okr+=' - okres otwarty'@
         ?}
     ?};
      {? OPERATOR.DEPT
         || par_odd:='Jednostka księgowa: %1'@[OPERATOR.DEPT().OD]
         || par_odd:='Wszystkie jednostki księgowe'@; odd:=1
      ?};
      par_wal:='Waluta: %1 - %2'@[FINFO.NAROD().KOD,FINFO.NAROD().TR];
    ~~}
    {
      par_daty:='Zakres dat: od %1 do %2'@[$PAR_WYDR.DPAR1,$PAR_WYDR.DPAR2];
      odd:={? OPERATOR.DEPT || 1 || 0 ?};
      kl:=7;
      kolu[1]:=5;
      kolu[2]:=27+9*odd;
      kolu[3]:=12;
      kolu[4]:=50;
      kolu[5]:=28;
      kolu[6]:=20;
      kolu[7]:=20;
      kolu[8]:=5;
      {! _a:=3..7 |! kolu[_a]-=2*odd !};
      il:=kolu[1]+kolu[2]+kolu[3]+kolu[4]+kolu[5]+kolu[6]+kolu[7]+kl+1;
      p[1]:=2+kolu[1];
      {! _a:=2 ..kl
      |! p[_a]:=p[_a-1]+kolu[_a]+1
      !};
   ~~}
   {
   {? rep_export
   || kolnaz[1]:='Nr w dzienniku'@;
      kolnaz[2]:='Rejestr'@;
      kolnaz[9]:='Jednostka księgowa'@;
      kolnaz[10]:='Numer w rejestrze'@;
      kolnaz[3]:='Data wystawienia'@;
      kolnaz[4]:='Symbol dokumentu'@
   || kolnaz[1]:='Nr w#dz.'@;
      {? odd
      || kolnaz[2]:='Rejestr/Numer w rej.'@
      || kolnaz[2]:='Rejestr/Jednostka księgowa#/Numer w rej.'@
      ?};
       kolnaz[3]:='Data#  wystaw.'@;
       kolnaz[4]:='          Symbol dokumentu'@
   ?};
   kolnaz[8]:='Poz.'@;
   kolnaz[5]:='Konto'@;
   kolnaz[6]:='Wn'@;
   kolnaz[7]:='Ma'@; ~~}
   {  PRN.add("w[1]",kolu[1],kolnaz[1],1,'#');
      PRN.add("w[2]",kolu[2],kolnaz[2],,'#');~~}
   {IF: rep_export}
      {IF: odd}
         { PRN.add("w[10]",1,kolnaz[10],,'#');~~}
      {ELSE}
         { PRN.add("w[9]",1,kolnaz[9],,'#');
           PRN.add("w[10]",1,kolnaz[10],1,'#');~~}
      {FI}
   {FI}
   { PRN.add("w[3]",kolu[3],kolnaz[3],,'#');
     PRN.add("w[4]",kolu[4],kolnaz[4],,'#');
     PRN.add("w[8]",kolu[8],kolnaz[8],1);
     PRN.add("w[5]",kolu[5],kolnaz[5]);
     PRN.add("w[6]",kolu[6],kolnaz[6],1);
     PRN.add("w[7]",kolu[7],kolnaz[7],1);~~}
   { PRNF.add("f[1]",kolu[1]+kolu[2]+kolu[3]+kolu[4]+kolu[5]+kolu[8]+5,'');
     PRNF.add("f[2]",kolu[6],'',1);
     PRNF.add("f[3]",kolu[7],'',1);~~}
{'--------------------------------------------------------------';~~}
{'  Dziennik księgowań - wersja skrócona (bez pozycji)          '@;~~}
{'  dla wybranego rejestru                                      '@;~~}
{'--------------------------------------------------------------';~~}
{'--------------------------------------------------------------';~~}
{'                       MACRA                                  ';~~}
{'--------------------------------------------------------------';~~}
{COMMENT}------------------------------MACRO-LINIA1------------------{COMMENT-}
{MACRO: 'LINIA1'}
{PRNF.ini_line()}
{WHILE: PRNF.next()}
{DO}
{REP: PRNF.fline()}
{OD}
{MACRO-}
{INCLUDE: fks_dzienskr.rpi}