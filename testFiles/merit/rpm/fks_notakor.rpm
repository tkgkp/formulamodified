:!UTF-8
{TITLE:A. Nota odsetkowa - korepondencja seryjna}
{PRINTER: FINFO.W_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
   PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,1,1}
{BEGIN:
   VAR_DEL.delete('czy_szablon');
   exec('czytaj','#stalesys',,FINFO,'SLWAL');
   exec('czytaj','#stalesys',,XINFO,'SLJEZYK');
   new_poz:=0; ref_defw:=null; del_wal:=gen_wyd:=0; l_wal:=0; liczwal:=kon:=ilel:=0; tp:=date(0,0,0);
   czy_szablon:=exec('rep_set','rap_zew','FKS_KORROZ',1)='T';
   SLO.cntx_psh(); SLU.prefix(); SLO.prefix(); SLUAPPL.prefix();
   {? XINFO.SLJEZYK<>null
   || XINFO.SLJEZYK();
      SER_KOR.JEZYK:={? SLO.find_key(SLU.ref(),'POL')
                     || SLO.ref()
                     || null
                     ?}
   ?};
   SER_KOR.WYB_WAL:={? SER_NAG.WAL=null || 2 || SER_KOR.WAL:=SER_NAG.WAL; 0 ?};
   SER_NAGS.cntx_psh(); SER_NAGS.win_sel('SERNOTYW');
   SER_NAG.cntx_psh(); SER_NAG.prefix(); wz_wyd:=''; exec('ind_pref','rozrach_kor');
   color:=prn1:=prn2:='';  w:=obj_new(11); PAR_WYDR.PAR15:=0;
   lm:=ll:=vp:=lmt:=rsep:=wdt:=0;
   head:=PAR_WYDR.HEAD; SLO.prefix;
   {? var_pres('ML',@)<=100 || ML:=obj_new(@.CLASS.MEMO) ?};
   wybor:=sumafakt:=sumawpl:=pierwszy:=sumaods:=sumaods1:=0;
   tekst:=dokument:=''; licz_wal:=0;
   SLUAPPL.cntx_psh(); SLU.cntx_psh();
   SLUAPPL.prefix(); SLU.prefix();
   FINFO.SLWAL().SLU();
   SLO.index('SL'); SLO.prefix(SLU.ref);
   {? SLO.first() || licz_wal:=SLO.size() ?};
   {? licz_wal
   || sumy:=obj_new(licz_wal);
      {! _i:=1..licz_wal
      |! sumy[_i]:=obj_new(5); sumy[_i][1]:=SLO.KOD; sumy[_i][2]:=sumy[_i][3]:=sumy[_i][4]:=sumy[_i][5]:=0;
         SLO.next()
      !}
   ?};
   SLUAPPL.cntx_pop(); SLU.cntx_pop(); SLO.cntx_pop(); licznik:=1; naz_str:='';
   ROZNE.UT_KOM:=1; tab_adr:=obj_new(38); licz:=licz1:=0; tab_adr1:=obj_new(17);
   {! _i:=1..21 |!  tab_adr[_i]:='' !}; kontosp:=''; separat:=0; oddzial:='';
   ODD.cntx_psh(); ODD.index('ODDZIALY'); ODD.prefix(REF.FIRMA); SSTALE.cntx_psh(); wyd_kor:=1; kontbank:=''
 }
{END:
   ODD.cntx_pop(); SER_NAGS.cntx_pop(); SER_NAG.cntx_pop(); SSTALE.cntx_pop(); &wz_wyd; &new_poz; &ref_defw; &licz_wal; &liczwal; obj_del(sumy); &licznik;
   {? SER_KOR.WYB_WAL=1 & del_wal=1 || exec('del_wal','rozrach_kor') ?}; &kon; &ilel;
   &l_wal; &gen_wyd; &del_wal; &tp;
   {? var_pres('PRN')>0 || obj_del(PRN) ?}; obj_del(w); &color; &prn1; &prn2;
   &lm; &ll; &vp; &lmt; &rsep; &wdt; PAR_WYDR.HEAD:=head; &head;
   &wybor; &sumafakt; &sumawpl; &pierwszy; &sumaods; &sumaods1;
   &tekst; &dokument; &naz_str;
   &licz; &licz1; obj_del(tab_adr); obj_del(tab_adr1); &kontosp; &separat; &oddzial; &wyd_kor; &kontbank;
   VAR_DEL.delete('ObjForMerge')
}
{  PAR_WYDR.win_edit('NOTAKOR'); PAR_WYDR.PAR1:=1; SSTALE.WAL:=SER_NAG.WAL; exec('set_kbr','rozrach_przel'); ~~}
{EXIT: ~PAR_WYDR.edit("{? SER_KOR.JEZYK=null
                       || FUN.info('Nie wybrano języka.'@); 'JEZYK'
                       |? SER_KOR.JEZYK<>null & ~exec('sprwzwyd','rozrach','fks_nota',SER_KOR.JEZYK().KOD,1)
                       || 'JEZYK'
                       || {? RACHBANK.KB_1R=''
                          || FUN.info('Nie podano numeru konta bankowego.'@); 'KB_1R'
                          || ''
                          ?}
                       ?}")}
{  {? PAR_WYDR.PAR1=1 || wybor:=1
   |? PAR_WYDR.PAR1=2 || wybor:=2
   |? PAR_WYDR.PAR1=3 || wybor:=3
   ?}; ~~}
{IF: wybor=3}
  { WYDRUKIN.win_edit({? kh_all ||  'SER_NAG4' || 'SER_NAG5' ?});
    WYDRUKIN.hdr_edit('Nota odsetkowa - zakres'@);
    WYDRUKIN.SER_DEF:=WYDRUKIN.SER_DEF2:=0;
    SER_DEF.win_dict('SERNOW');
    KH.win_dict('WERHOME2');
    WYDRUKIN.DATAOD:=WYDRUKIN.DATADO:=date();
    WYDRUKIN.KH:=WYDRUKIN.KH2:=SER_NAG.KH;
    SER_KOR.ID_OD:=SER_KOR.ID_DO:=SER_NAG.ID;~~}
   {EXIT: ~WYDRUKIN.edit("{? SER_KOR.WYB_WAL=0 & SER_KOR.WAL=null
                          || FUN.info('Nie wybrano żadnej waluty.'@); 'WYB_WAL'
                          || ''
                          ?}")}
   {IF: SER_KOR.WYB_WAL=1}
     { exec('wyb_wal','rozrach_kor'); del_wal:=1;~~}
     {IF: l_wal=0}{ FUN.info('Nie wybrano żadnej waluty.'@);~~}{EXIT}{FI}
   {FI}
{FI}
{IF: czy_szablon & menu_txt()<>'Akceptuj'}
   {IF: ROZNE.UT_KOM}
      {IF: wybor=1}
         {SER_NAGS.SER_NAG();~~}
         {IF: exec('czy_umorz','rozrach_kor')}
            {IF: ~PAR_WYDR.PAR15}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPZ',,,);pierwszy:=1;~~}
            {ELSE}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPJ',,,);pierwszy:=1;~~}
            {FI}
         {FI}
      {ELIF: wybor=2 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N'}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
               {IF: ~PAR_WYDR.PAR15}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPZ',,,);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPJ',,,);pierwszy:=1;~~}
               {FI}
            {FI}
         {OD}
      {ELIF: wybor=2 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
               {IF: ~PAR_WYDR.PAR15}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPZ',,,);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPJ',,,);pierwszy:=1;~~}
               {FI}
            {FI}
         {OD}
      {ELIF: wybor=3 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N'}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
               {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
                  {IF:  ( ~WYDRUKIN.SER_DEF  | (WYDRUKIN.SER_DEF  & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))  &
                        ( ~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
                        ( ~#WYDRUKIN.DATAOD  | (#WYDRUKIN.DATAOD  & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
                        ( ~#WYDRUKIN.DATADO  | (#WYDRUKIN.DATADO  & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
                        ( ~WYDRUKIN.KH  | (WYDRUKIN.KH  & SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))  &
                        ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 & SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD)) &
                        ( |SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD>=SER_NAG.ID)) &
                        ( |SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO<=SER_NAG.ID))
                  }
                     {IF: ~PAR_WYDR.PAR15}
                        {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPZ',,-4,,,1);pierwszy:=1;~~}
                     {ELSE}
                        {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPJ',,-4,,,1);pierwszy:=1;~~}
                     {FI}
                  {FI}
               {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {ELIF: wybor=3 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
            {IF:    (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
                     SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
                  & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
                     SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
                  & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
                     SER_NAG.DATA>=WYDRUKIN.DATAOD))
                  & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
                     SER_NAG.DATA<=WYDRUKIN.DATADO))
                  }
               {IF: ~PAR_WYDR.PAR15}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPZ',,-4,,,1);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSPJ',,-4,,,1);pierwszy:=1;~~}
               {FI}
            {FI}
            {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {FI}
   {ELSE}
      {IF: wybor=1}
         {SER_NAGS.SER_NAG();~~}
         {IF: exec('czy_umorz','rozrach_kor')}
            {IF: ~PAR_WYDR.PAR15}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLZ',,,);pierwszy:=1;~~}
            {ELSE}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLJ',,,);pierwszy:=1;~~}
            {FI}
         {FI}
      {ELIF: wybor=2 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N'}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
               {IF: ~PAR_WYDR.PAR15}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLZ',,,);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLJ',,,);pierwszy:=1;~~}
               {FI}
            {FI}
         {OD}
      {ELIF: wybor=2 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
               {IF: ~PAR_WYDR.PAR15}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLZ',,,);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLJ',,,);pierwszy:=1;~~}
               {FI}
            {FI}
         {OD}
      {ELIF: wybor=3 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N'}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
            {IF:  ( ~WYDRUKIN.SER_DEF  | (WYDRUKIN.SER_DEF  & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))  &
                  ( ~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
                  ( ~#WYDRUKIN.DATAOD  | (#WYDRUKIN.DATAOD  & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
                  ( ~#WYDRUKIN.DATADO  | (#WYDRUKIN.DATADO  & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
                  ( ~WYDRUKIN.KH  | (WYDRUKIN.KH  & SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))  &
                  ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 & SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD)) &
                  ( |SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD>=SER_NAG.ID)) &
                  ( |SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO<=SER_NAG.ID))
            }
               {IF: ~PAR_WYDR.PAR15}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLZ',,-4,,,1);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLJ',,-4,,,1);pierwszy:=1;~~}
               {FI}
            {FI}
            {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {ELIF: wybor=3 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: exec('czy_umorz','rozrach_kor')}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
               {IF:    (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
                        SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
                     & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
                        SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
                     & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
                        SER_NAG.DATA>=WYDRUKIN.DATAOD))
                     & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
                        SER_NAG.DATA<=WYDRUKIN.DATADO))
                     }
                  {IF: ~PAR_WYDR.PAR15}
                     {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLZ',,-4,,,1);pierwszy:=1;~~}
                  {ELSE}
                     {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_NOPDSLJ',,-4,,,1);pierwszy:=1;~~}
                  {FI}
               {FI}
            {FI}
            {FI}
         {OD}
         {{? var_pres('ObjForMerge')>0 || ObjForMerge.makeMerge(0,ROZNE.ONE_PAGE) ?};~~}
      {FI}
   {FI}
   {IF: ~pierwszy}
      {FUN.info('Brak danych spełniających zadane kryteria \nlub nie zdefiniowano poprawnie odpowiednich wzorców wydruków.'@);~~}
      {EXIT}
   {FI}
   {EXIT}
{FI}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: fks_kor_head.rpi}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}
{>{charleft()} XINFO.MIA+', '+$SER_NAG.DATA}
{SUBSTITUTE: 'HEAD'}
{LINE: 2}
{HEADER-}
{FOOTER}
{>{charleft()} naz_str+$page}
{FOOTER-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{  rsep:=PAR_WYDR.RSEP;~~}
{IF: wybor=1}
   { SER_NAGS.SER_NAG(); new_poz:=0;~~}
   {IF: exec('czy_umorz','rozrach_kor')}
   {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}{ pierwszy:=1; ~~}
   {FI}
{ELIF: wybor=2 & ROZRACH.KONTR=null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'SER_NAG'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N'}
   {SELECT}
   {DO}
      { SER_NAGS.SER_NAG();~~}
      {IF: exec('czy_umorz','rozrach_kor')}
      {IF: lineleft()<>0 & pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
      {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}{ pierwszy:=1; ~~}
      {FI}
   {OD}
{ELIF: wybor=2 & ROZRACH.KONTR<>null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'TYPKH'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
   {SELECT}
   {DO}
      { SER_NAGS.SER_NAG();~~}
      {IF: exec('czy_umorz','rozrach_kor')}
      {IF: lineleft()<>0 & pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
      {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}{ pierwszy:=1; ~~}
      {FI}
   {OD}
{ELIF: wybor=3 & ROZRACH.KONTR=null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'SER_NAG'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N'}
   {DO}
      { SER_NAGS.SER_NAG();~~}
      {IF: exec('czy_umorz','rozrach_kor')}
      {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
          (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
      {IF:  ( ~WYDRUKIN.SER_DEF  | (WYDRUKIN.SER_DEF  & SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))  &
            ( ~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 & SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD)) &
            ( ~#WYDRUKIN.DATAOD  | (#WYDRUKIN.DATAOD  & SER_NAG.DATA>=WYDRUKIN.DATAOD)) &
            ( ~#WYDRUKIN.DATADO  | (#WYDRUKIN.DATADO  & SER_NAG.DATA<=WYDRUKIN.DATADO)) &
            ( ~WYDRUKIN.KH  | (WYDRUKIN.KH  & SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))  &
            ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 & SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD)) &
            ( |SER_KOR.ID_OD='' | (|SER_KOR.ID_OD<>'' & |SER_KOR.ID_OD>=SER_NAG.ID)) &
            ( |SER_KOR.ID_DO='' | (|SER_KOR.ID_DO<>'' & |SER_KOR.ID_DO<=SER_NAG.ID))
      }
         {IF: lineleft()<>0 & pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
         {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}{ pierwszy:=1; ~~}
      {FI}
      {FI}
      {FI}
   {OD}
{ELIF: wybor=3 & ROZRACH.KONTR<>null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'TYPKH'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,'N',ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
   {DO}
      { SER_NAGS.SER_NAG();~~}
      {IF: exec('czy_umorz','rozrach_kor')}
      {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
          (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
      {IF:    (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
               SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
            & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
               SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
            & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
               SER_NAG.DATA>=WYDRUKIN.DATAOD))
            & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
               SER_NAG.DATA<=WYDRUKIN.DATADO))
            }
         {IF: lineleft()<>0 & pierwszy}{PAGE}{FI}{ new_poz:=0; page(1);~~}
         {REP: '{INCLUDE: '+wz_wyd+'.rpi}'}{ pierwszy:=1; ~~}
      {FI}
      {FI}
      {FI}
   {OD}
{FI}
{IF: ~pierwszy}
{ FUN.info('Brak danych spełniających zadane kryteria \nlub nie zdefiniowano poprawnie odpowiednich wzorców wydruków \nlub wszystkie pozycje są umorzone.'@);~~}
{EXIT}
{FI}