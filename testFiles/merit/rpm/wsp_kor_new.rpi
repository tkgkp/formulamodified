:!UTF-8
{COMMENT}   wydruk faktury korygujacej                               {COMMENT-}
{COMMENT}   MACRO - headpoz                                          {COMMENT-}
{DEFINEFONT: 'TM=Inter,75,Q,,0,0'}
{DEFINEFONT: 'TMB=Inter,75,R,,0,0'}
{DEFINEFONT: 'TF=Inter,75,F,,0,0'}
{DEFINEFONT: 'IE=Inter,150,E,,0,0'}
{DEFINEFONT: 'IF=Inter,150,F,,0,0'}
{MACRO: 'MY_LINIA0'}
{  ll:=lineleft(); ~~}
{IF:  _f:=prn1+'.ini_line()'; _v:=($(_f))();
      _f:=prn1+'.length()'; _v:=($(_f))();
      ll<(rsep+_v) & ll<>0}{PAGE}{FI}
{IF: vp}
   { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
   {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
   { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
{ELSE}
   {IF: PAR_WYDR.RSEP & rsep}
      {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
   {ELIF: rsep}
      {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
   {FI}
{FI}
{WHILE: _f:=prn1+'.next()'; ($(_f))()}
{DO}
   {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
{OD}
{IF: var_pres('fun')>=0 & fun<>''}
{  $fun(); ~~}
{FI}
{MACRO-}
{MACRO: 'POZYCJA'}
{ llin:=lineleft(); lpoz:=0; lmax:=0;
  il_lin:={? __walh<>__walp & PARAM_W.WALH='T' || 5 || 4 ?};
  params_set(params_get());
  _f:='params_set(params_get()); '+prn1+'.ini_line()'; _v:=($(_f))();
  _f:=prn1+'.length()'; lmax:=($(_f))(); headfoot:={? lmax>(llin-il_lin-1) || 2 || 0 ?};
  prnDoPrze:=0;
  lmax_ft:=lmax;
~~}
{WHILE: lmax>0}
{DO}
   {IF: llin<=(il_lin+1) | ((lmax_ft+il_lin+1>llin) & lmax_ft<>0) }
      {bpage:=page(); ~~}
      {lmax_ft:=0;~~}
      {SUBSTITUTE: 'foot_tab'}
      {IF: bpage=page}{PAGE}{FI}
{COMMENT} Odrysowanie lini podziału {COMMENT-}
      { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
      {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
      { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
      { llin:=lineleft(); ~~}
      { {? headfoot=2 || headfoot:=1 ?}; ~~}
   {ELSE}
      { lpoz:=0; ~~}
{COMMENT} Odrysowanie lini podziału {COMMENT-}
      {IF: headfoot<>1}
         {IF: vp}
            { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
            {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
            { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
         {ELSE}
            {IF: PAR_WYDR.RSEP & rsep}
               {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
            {ELIF: rsep}
               {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
            {FI}
         {FI}
      {FI}
{COMMENT} Odrysowanie treści pozycji {COMMENT-}
      {WHILE: _f:=prn1+'.next()'; ($(_f))() & (llin-lpoz>(il_lin+1) | lpoz=0)}
      {DO}
         { lpoz+=1; lmax-=1; ~~}
         {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
         { {? prnDoPrze=0 || prnDoPrze:=1; {? PARAM_W.WALH='H' || do_przeh() || do_przep() ?} ?}; ~~}
      {OD}
      { llin:=lineleft(); ~~}
   {FI}
{OD}
{ VAR_DEL.delete('prnDoPrze','lmax_ft'); ~~}
{MACRO-}
{MACRO: 'foot_tab'}
{
vp:=0;
prn1_tmp:=prn1;
prn2_tmp:=prn2;
prn1:='PRN1';
prn2:='PRN3';
prz[1]:=exec('tr','tlumaczenia','1000130');
prz[2]:=do_p[1];
prz[3]:='';
prz[4]:=do_p[2];
prz[5]:=do_p[3];
prz[6]:=__walp;
rrsep:=rsep;
rsep:=1;
walutowa:=0
;~~}
{IF: PARAM_W.WALH<>'H'}{SUBSTITUTE: 'LINIA02'}{FI}
{IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
   {
   {? PARAM_W.WALH<>'H' || rsep:=0 ?};
   walutowa:=1;
   {? PARAM_W.WALH<>'H' || prz[1]:='' ?};
   prz[2]:=do_p[4];
   prz[4]:=do_p[5];
   prz[5]:=do_p[6];
   prz[6]:=__walh
   ;~~}
   {SUBSTITUTE: 'LINIA02'}
{FI}
{prn1:='PRN3'; vp:=0; rsep:=rrsep; VAR_DEL.delete('rrsep');~~}
{SUBSTITUTE: 'LINIAF'}
{prn1:=prn1_tmp; prn2:=prn2_tmp; VAR_DEL.delete('prn1_tmp','prn2_tmp'); vp:=1;~~}
{MACRO-}
{MACRO: 'headpoz'}
{SUBSTITUTE: 'HEADF'}
{FONT: exec('font','param_wydr','tabhead_poz')}{SPACE: exec('space','param_wydr')}
{IF: fabs(do_p[1])+fabs(do_p[2])+fabs(do_p[3])+fabs(do_p[4])+fabs(do_p[5])+fabs(do_p[6])}
   {
   vp_tmp:=vp; vp:=0;
   rsep_tmp:=rsep; rsep:=0;
   prn1:='PRN3';
   prz[1]:=exec('tr','tlumaczenia','1000129');
   prz[2]:=do_p[1];
   prz[3]:='';
   prz[4]:=do_p[2];
   prz[5]:=do_p[3];
   prz[6]:=__walp
   ;~~}
   {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
   {IF: PARAM_W.WALH<>'H'}
      {
      _f:=prn1+'.ini_line()'; _v:=($(_f))();
      _f:=prn1+'.length()'; _v:=($(_f))()
      ;~~}
      {WHILE: _f:=prn1+'.next()'; ($(_f))()}
      {DO}
         {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
      {OD}
   {FI}
   {IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
      {
      {? PARAM_W.WALH<>'H' || prz[1]:='' ?};
      prz[2]:=do_p[4];
      prz[4]:=do_p[5];
      prz[5]:=do_p[6];
      prz[6]:=__walh
      ;~~}
      {
      ll:=lineleft();
      _f:=prn1+'.ini_line()'; _v:=($(_f))();
      _f:=prn1+'.length()'; _v:=($(_f))();
      ll<(rsep+_v) & ll<>0
      ;~~}
      {WHILE: _f:=prn1+'.next()'; ($(_f))()}
      {DO}
         {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
      {OD}
   {FI}
   {SUBSTITUTE: 'LINIAF'}
   { prn1:='PRN1'; vp:=vp_tmp; rsep:=rsep_tmp; ~~}
{FI}
{FONT: exec('font','param_wydr','tabhead_poz')}{SPACE: exec('space','param_wydr')}
{SUBSTITUTE: 'TABHEAD'}
{MACRO-}
{COMMENT}   MACRO - footpoz                                          {COMMENT-}
{MACRO: 'footpoz'}
{SUBSTITUTE: 'LINIAF'}
{
vp_tmp:=vp; vp:=0;
rsep_tmp:=rsep; rsep:=0;
prn1:='PRN3';
prz[1]:= exec('tr','tlumaczenia','1000130');
prz[2]:=do_p[1];
prz[3]:='';
prz[4]:=do_p[2];
prz[5]:=do_p[3];
prz[6]:=__walp
;~~}
{REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
{IF: PARAM_W.WALH<>'H'}
   {
   _f:=prn1+'.ini_line()'; _v:=($(_f))();
   _f:=prn1+'.length()'; _v:=($(_f))()
   ;~~}
   {WHILE: _f:=prn1+'.next()'; ($(_f))()}
   {DO}
      {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
   {OD}
{FI}
{IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
   {
   {? PARAM_W.WALH<>'H' || prz[1]:=''?};
   prz[2]:=do_p[4];
   prz[3]:='';
   prz[4]:=do_p[5];
   prz[5]:=do_p[6];
   prz[6]:=__walh
   ;~~}
   {
   _f:=prn1+'.ini_line()'; _v:=($(_f))();
   _f:=prn1+'.length()'; _v:=($(_f))()
   ;~~}
   {WHILE: _f:=prn1+'.next()'; ($(_f))()}
   {DO}
      {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
   {OD}
{FI}
{SUBSTITUTE: 'LINIAF'}
{ prn1:='PRN1'; vp:=vp_tmp; rsep:=rsep_tmp; ~~}
{MACRO-}
{COMMENT}   MACRO - druk                                             {COMMENT-}
{MACRO: 'druk'}
{WHILE: ilkop<=PARAM_W.KOPIA}
{DO}
{COMMENT}   FOOTER                                                   {COMMENT-}
   {FONT: exec('font','param_wydr','footer')}{SPACE: exec('space','param_wydr')}
   {IF: exec('czy_grp_dr','faktury_wydruk') | PARAM_W.KOPIA }
   { strona:=1;pages:=page-1;~~}
   {FOOTER}
   {<1}{charleft_foot:=charleft();~~}{>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
   {<1}{IF: exec('get_footer','img_blob')}{IMAGE: exec('get_footer','img_blob');;1}{FI}{>{charleft_foot-3}}{$strona}{' '}{COLOR: color_oo}{'  '}{COLOR: color_bw}{strona+=1;~~}
   {>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
   {FOOTER-}
   {ELSE}
   {FOOTER}
   {<1}{charleft_foot:=charleft();~~}{>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
   {<1}{IF: exec('get_footer','img_blob')}{IMAGE: exec('get_footer','img_blob');;1}{FI}{MAXPAGE: >{charleft_foot-3};$page+' / '; 3L;' '}{' '}{COLOR: color_oo}{'  '}{COLOR: color_bw}
   {>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
   {FOOTER-}
   {FI}
   {
   loop.loop:=1;
   FAKS.cntx_psh();
   FAKS.clear();
   {? FAKS.seek(BB.sqlint(FAKS.FKSQL),form(8+FAKS.FKSQL))
   ||
      dat_kor:=FAKS.DW;kw_zal:=FAKS.KW_ZAL; zal_wal:=__walh
   ||
      dat_kor:=date(0,0,0)
   ?};
   FAKS.cntx_pop();
   PAR_WYDR.TITLE:=exec('trans_typysp','tlumaczenia',TYPYSP.ref(),PARAM_W.JEZYK);
   PAR_WYDR.SYM:=FAKS.SYM;
   TYPYSP.cntx_psh();
   PAR_WYDR.TYPE:=FAKS.T().T;
   TYPYSP.cntx_pop();
   prn1:='PRN1';
   prn2:='PRN2';
   rsep:=0
   ;~~}
{COMMENT}   REPORT - HEADER                                          {COMMENT-}
   {IF: FAKS.WHERE<>'K' & FAKS.WHERE<>'N'}
   { {? WYDRUKIL.WYDRUK='kor_rr'
     ||
        podtytul:=exec('tr','tlumaczenia','2000121')+' '+FAKS.KOR
     ||
        podtytul:=exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','2000102'))+exec('get','#params',100225,3)()+' '+FAKS.KOR
     ?};
     podtytul+=' ' + exec('tr','tlumaczenia','2000103')+' '+gsub(form(dat_kor,,3),'/','-');
     ~~
   }
   {FI}
   { head:=PAR_WYDR.HEAD; PAR_WYDR.HEAD:=1;~~}
   { __STRTAB:='FAKS'; __STRODB:='FAKS.KH_ODB'; __STRLIN:='KOR'; __STRDAT:=FAKS.DW;~~}
{COMMENT}   HEDER obowiazujacy przed wydrukiem pozycji               {COMMENT-}
   {
    {? -PARAM_W.DR_DUPL='t'
    ||
       dup_head:=exec('tr','tlumaczenia','1000105');
       dup_val:=gsub(form(PARAM_W.DUPLIKAT,,3),'/','-');
       dup_sym:=1
    ?};
    ~~}
   {HEADER}
   {SUBSTITUTE: 'HEADF'}
   {PAR_WYDR.HEAD:=0;podtytul:='';~~}
   {HEADER-}
{COMMENT}   oryginal / kopia, tryb probny                            {COMMENT-}
   {FONT: exec('font','param_wydr','ory_kop')}{SPACE: exec('space','param_wydr')}
   {IF: (';NZA'*FAKS.STAT_REJ)>1}{<1}{>{charleft}exec('tr','tlumaczenia','100021'+{? FAKS.STAT_REJ='A' || '5' || '0' ?})}{FI}
   {<1}{>{charleft}{? ~skladanka
      || {? ilkop=0 || exec('tr','tlumaczenia','1000103') || exec('tr','tlumaczenia','1000104') ?}
      || '' ?}}
{ ilkop+=1;~~}
{COMMENT}   DANE NAGLOWKOWE                                          {COMMENT-}
{COMMENT}   strony transakcji                                        {COMMENT-}
{SUBSTITUTE: 'stronyf'}
{ VAR_DEL.delete('__STRTAB','__STRODB','__STRLIN','__STRDAT');~~}
   {FONT: exec('font','param_wydr','strony_po')}
   {<1}{
   _sz1:=max_T8G/2$0;_sz2:=1;
   print4(_sz1,_sz2);
   _sz2+=charleft-PRN4.width();
   print4(_sz1,_sz2);
   ~~}
   {inf_head:=inf_head_beg;
   inf_val:=inf_val_beg;
   ~~}
{COMMENT}informacje dodatkowe: zamowienia, dokumenty magazynowe  {COMMENT-}
   {{? var_press('inf_head_arr')>100 || obj_del(inf_head_arr) ?}; inf_head_arr:=spli_str(inf_head-1, ';');int_inf_head:=1;
   {? var_press('inf_val_arr')>100 || obj_del(inf_val_arr) ?}; inf_val_arr:=spli_str(inf_val-1, ';');int_inf_val:=1;
   charleft_head:=0;
   ~~}
   {ENTIRE}
   {IF: obj_len(inf_head_arr)>0 & obj_len(inf_val_arr)>0 & inf_head_arr[1]<>'' & inf_val_arr[1]<>''}
   {COLOR: color_gw}{FONT: exec('font','param_wydr','dane')}{<3}{WHILE: int_inf_head<=obj_len(inf_head_arr)}{DO}{<+{charleft_head} _wyn:=inf_head_arr[int_inf_head];charleft_head:={? ((+inf_head_arr[int_inf_head])>(+inf_val_arr[int_inf_head]))||+inf_head_arr[int_inf_head]||+inf_val_arr[int_inf_head]?}+6;int_inf_head+=1;_wyn}{OD}
   {charleft_head:=0;~~}
   {COLOR: color_bw}{FONT: exec('font','param_wydr','dane_bold')}{<3}{WHILE: int_inf_val<=obj_len(inf_val_arr)}{DO}{<+{charleft_head} _wyn:=inf_val_arr[int_inf_val];charleft_head:={? ((+inf_head_arr[int_inf_val])>(+inf_val_arr[int_inf_val]))||+inf_head_arr[int_inf_val]||+inf_val_arr[int_inf_val]?}+6;int_inf_val+=1;_wyn}{OD}
   {FI}
   {ENTIRE-}
   {VAR_DEL.delete('inf_head','inf_val','int_inf_head','int_inf_val');~~}
{COMMENT}   informacje dodatkowe dla naglowka                        {COMMENT-}
   {
   "--pobranie danych--"; exec('pobgdnag','fakso','F',FAKS.ref);
   VAR_DEL.delete('oo','OPIK')
   ;~~}
   {FOR: S_GD}
   {PREFIX: 'G'}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {SUBSTITUTE: 'inf_dod'}
   {OD}
{COMMENT}   platnosci                                                {COMMENT-}
   {COLOR: color_bw}
   {  fp_tr:=fp_war:=tp_tr:=tp_war:=wp_tr:=wp_war:=wp_wal:=slownie:=slownie_vat:='';
      FAKSPL.cntx_psh();
      FAKSPL.use((5+FAKSPL.name())+(ref_name(FAKS.ref())+3));
      FAKSPL.index('FAKS');
      FAKSPL.prefix(FAKS.ref());
      pl_size:=(FAKSPL.size()<>1);
      FAKSPL.cntx_pop();
   ~~}
   {IF: PARAM_W.DR_TERM='T'}
      {FOR: FAKSPL}
      {INDEX: 'FAKS'}
      {PREFIX: FAKS.ref}
      {DO}
         {<{3}}{
         _tlumacz:={? PARAM_W.JEZYK=null || '' || exec('trans_slo','tlumaczenia',FAKSPL.PL,PARAM_W.JEZYK) ?};
         fp_tr:=exec('tr','tlumaczenia','1000121')+' ';
         fp_war:=
            {? PARAM_W.JEZYK<>null & _tlumacz<>''
            || _tlumacz
            || FAKSPL.PL().TR
            ?};
         tp_tr:=exec('tr','tlumaczenia','1000124');
         tp_war:=' '+gsub(form(FAKSPL.TERMPLAT,,3),'/','-');
         wp_tr:='';
         wp_war:='';
         wp_wal:='';

         ZR_SLO.cntx_psh();
         ZR_SLO.index('SLO_NR');
         ZR_SLO.prefix();
         {? ZR_SLO.find_key(FAKSPL.PL,7)
         || {? ZR_SLO.WAR ='N'|| tp_tr:=tp_war:='' ?}
         ?};
         ZR_SLO.cntx_pop();

         {? (exec('sp_active','faktury_wspolne',FAKS.DW)=0 | FAKS.SP_WYM<>'T')
               &
            (FAKS.NWAL=INFO.NAROD | FAKS.WAL=FAKS.NWAL)
         ||
            {? FAKSPL.WAR>0
            ||
               wp_tr:={? tp_war<>'' || ', '|| '' ?} +exec('tr','tlumaczenia','1000125')+' ';
               wp_war:=form(FAKSPL.WAR,,2,'.,')
            ||
               wp_tr:={? tp_war<>'' || ', '|| '' ?} +exec('tr','tlumaczenia','1000151')+' ';
               wp_war:=form(-FAKSPL.WAR,,2,'.,')
            ?};
            wp_wal:=' '+__walh
         ?};
         odstep:=charleft()-(+fp_tr)-(+fp_war)-(+tp_tr)-(+tp_war)-(+wp_tr)-(+wp_war)-(+wp_wal);
         odstep:={? odstep>0 || ' '*odstep || ' ' ?};
         ~~}
         {IF: pl_size}
         {<{3}
            }{FONT: exec('font','param_wydr','fp_tr')}{fp_tr
            }{FONT: exec('font','param_wydr','fp_war')}{fp_war
            }{FONT: exec('font','param_wydr','fp_ods')}{odstep
            }{FONT: exec('font','param_wydr','tp_tr')}{tp_tr
            }{FONT: exec('font','param_wydr','tp_war')}{tp_war
            }{FONT: exec('font','param_wydr','wp_tr')}{wp_tr
            }{FONT: exec('font','param_wydr','wp_war')}{wp_war
            }{FONT: exec('font','param_wydr','wp_wal')}{wp_wal}
         {FI}
      {OD}
   {FI}
{COMMENT}   korekta zbiorcza - początek pętli {COMMENT-}
   {WHILE: loop.loop}
   {DO}
      {FIRST}
      {
      _kz_uid:=exec('FindAndGet','#table',FAKS,FAKS.ref(),,"FAKS.uidref()",'');
      FAKS.cntx_psh();
      FAKS_KZF.cntx_psh();
      FAKS_KZF.index('KZ_UID');
      FAKS_KZF.prefix(_kz_uid);

      {? FAKS_KZF.first()
      ||
         FAKS.prefix();
         loop.faks_ref:={? +FAKS_KZF.KOR & FAKS.seek(FAKS_KZF.KOR) || FAKS.ref() || null() ?}
      ?};
      ~~}
      {FIRST-}
      {HEADER}{HEADER-}
      {
      {? loop.kz
      ||
         p_druk:='';
         {? -PARAM_W.POZY='k'
         ||
            FAP.cntx_psh();
            FAP.index('FAP');
            FAP.prefix(FAKS.ref());
            {? FAP.first() || {! |? {? exec('spr_kor','faktury_poz') || p_druk+='/'+$FAP.POZ+'/' ?}; FAP.next() !} ?};
            FAP.cntx_pop();
            {? p_druk='' || loop.faks_ref:=null() ?}
         ?}
      ?};
      ~~}
      {IF: loop.faks_ref}
         {ENTIRE}
         {IF: loop.kz}
            {<3}{FONT: exec('font','param_wydr','dane')
            }{'Korekta faktury: '@
            }{FONT: exec('font','param_wydr','dane_bold')
            }{exec('record','#to_string',FAKS_KZF.FAK)}
         {FI}
{COMMENT}   wyliczenie szerokosci kolumn                             {COMMENT-}
         {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
         {<1}{
prn1:='PRN1';prn2:='PRN2';
{? ilkop=1
||
   _loop:=xktm.first(); {! |? _loop |! _loop:=xktm.del() !};
   {! _i:=1..obj_len(fak) |! fak[_i]:=0 !};
   _fak9:=_fak11:=_fak12:=_fak9s:=_fak11s:=_fak12s:=0;
   _czy_rab:=0;
   _war9:=_war11:=_war12:=0;
   FAKS.cntx_psh();
   {! _razdwa:=1..2
   |!
      fak[9]:=fak[11]:=fak[12]:=0;
      FAP.cntx_psh;
      FAP.index('FAP');
      {? _razdwa=1
      || FAP.prefix(FAKS.ref)
      || FAKS.use(form(8+FAKS.LKSQL));
         FAP.use('fakpo'+(5-form(8+FAKS.LKSQL)));
         FAP.prefix(BB.sqlint(FAKS.LKSQL))
      ?};
      {? FAP.first()
      ||
         _czy_rab+=FAP.FAKS().RAB;
         {? FAP.FAKS().DSP_WPOZ='T' || fak[16]:=10 ?};
         {!
         |? {? _razdwa=1
            || xktm.clear; xktm.blank;
               xktm.POZ:=FAP.POZ; xktm.KTM:=FAP.M().KTM; xktm.NAZ:=M.N;
               xktm.KTX:=FAP.MX; xktm.NAX:=FAP.NX;
               xktm.JEM:=M.J().KOD;
               xktm.PKW:=exec('pkwiu','material',FAP.FAKS().DW,FAP.M,1,FAP.PKWIU_CN);
               xktm.DKC:=form(exec('sym_dk_c','mat_atr',FAP.DK_C));
               xktm.KP:=FAP.KP;
               xktm.add(1)
            |? _razdwa=2
            || {? xktm.find_key(FAP.POZ)
               || xktm.PKW:=exec('pkwiu','material',FAP.FAKS().DW,FAP.M,1,FAP.PKWIU_CN);
                  xktm.UWA:={? FAP.memo_lin('UWAGI')<>'\n' || gsub(FAP.memo_lin('UWAGI'),'\n',' ') || '' ?};
                  xktm.put(1)
               ?}
            ?};
            exec('wysw_kor','faktury_poz');
            fak[1]:={? (+form(FAP.POZ,,0))>fak[1] || +form(FAP.POZ,,0) || fak[1] ?};
            _uwagi:={? FAP.memo_lin('UWAGI')<>'\n' || gsub(FAP.memo_lin('UWAGI'),'\n',' ') || '' ?};
            fak[2]:={? (+(FAP.M().KTM+' - '+M.N+' '+_uwagi))>fak[2] || +(M.KTM+' - '+M.N+' '+_uwagi) || fak[2] ?};
            fak[3]:={? (+xktm.PKW)>fak[3] || +xktm.PKW || fak[3] ?};
            fak[4]:={? (+form(FKOR.BIL,,ddokl))>fak[4] || +form(FKOR.BIL,,ddokl) || fak[4] ?};
            _tlumacz:=exec('trans_jm','tlumaczenia',FAP.JM,PARAM_W.JEZYK);
            _tlumacz:={? PARAM_W.JEZYK<>null & _tlumacz<>'' || _tlumacz || FAP.JM().KOD ?};
            fak[5]:={? (+_tlumacz)>fak[5] || +_tlumacz || fak[5] ?};
            {? walutowa=0  | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || fak[6]:=
                  {? +form(FKOR.BCPR,,ddokl_c)>fak[6]
                  || +form(FKOR.BCPR,,ddokl_c)
                  || fak[6]
                  ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || fak[6]:=
                  {? +form(FKOR.BCWAL,,ddokl_c)>fak[6]
                  || +form(FKOR.BCWAL,,ddokl_c)
                  || fak[6]
                  ?}
            ?};
            {? exec('czyrabp','ceny',FAKS.RAB_TYP)
            || _rabat:=exec('rab_proc','ceny',FAP.RAB,FAKS.RAB,FAKS.RAB_TYP);
               fak[7]:=
                  {? +form(_rabat,,ddokl_c)>fak[7]
                  || +form(_rabat,,ddokl_c)
                  || fak[7]
                  ?}
            || {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
               || _cb_cn:={? odbrutto=1 || FKOR.BCB || FKOR.BCN ?};
                  fak[7]:=
                     {? +form(FKOR.BCPR-_cb_cn,,ddokl_c)>fak[7]
                     || +form(FKOR.BCPR-_cb_cn,,ddokl_c)
                     || fak[7]
                     ?}
               ?};
               {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
               || fak[7]:=
                     {? +form(FAP.RABK+(FAKS.RAB*FKOR.BCWAL/100)$2,,ddokl_c)>fak[7]
                     || +form(FAP.RABK+(FAKS.RAB*FKOR.BCWAL/100)$2,,ddokl_c)
                     || fak[7]
                     ?}
               ?}
            ?};
            _czy_rab+=FAP.RAB+FAP.RABK;
            {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || _cb_cn:={? odbrutto=1 || FKOR.BCB || FKOR.BCN ?};
               fak[8]:=
                  {? +form(_cb_cn,,ddokl_c)>fak[8]
                  || +form(_cb_cn,,ddokl_c)
                  || fak[8]
                  ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || {? exec('czyrabp','ceny',FAKS.RAB_TYP)
               || _rabat:=1-exec('rab_proc','ceny',FAP.RAB,FAKS.RAB,FAKS.RAB_TYP)/100;
                  fak[8]:=
                     {? +form(FKOR.BCWAL*_rabat,,ddokl_c)>fak[8]
                     || +form(FKOR.BCWAL*_rabat,,ddokl_c) || fak[8] ?}
               || _cpor:=FKOR.BCWAL-FAP.RABK-(FAKS.RAB*FKOR.BCWAL/100)$ddokl_c;
                  fak[8]:=
                     {? +form(_cpor,,ddokl_c)>fak[8]
                     || +form(_cpor,,ddokl_c)
                     || fak[8]
                     ?}
               ?}
            ?};
            fak[9]+=FKOR.BWWAL_P; _war9+=FKOR.BWWAL; _fak9s+={? _razdwa=1 || FKOR.BWWAL_P || -FKOR.BWWAL_P ?};
            fak[10]:=5;
            fak[11]+=FKOR.BVWAL_P; _war11+=FKOR.BVWAL; _fak11s+={? _razdwa=1 || FKOR.BVWAL_P || -FKOR.BVWAL_P ?};
            fak[12]+=FKOR.BBWAL_P; _war12+=FKOR.BBWAL; _fak12s+={? _razdwa=1 || FKOR.BBWAL_P || -FKOR.BBWAL_P ?};
            _war:=(FKOR.BIL*FKOR.BCPR)$2;
            _warw:=(FKOR.BIL*FKOR.BCWAL)$2;
            {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || fak[14]:={? fak[14]<+form(_war,,2) || +form(_war,,2) || fak[14] ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || fak[14]:={? fak[14]<+form(_warw,,2) || +form(_warw,,2) || fak[14] ?}
            ?};
            _kw_rab:=_war-{? odbrutto=1 || FKOR.BBWAL_P || FKOR.BWWAL_P ?};
            _kw_rabw:=_warw-{? odbrutto=1 || FKOR.BBWAL || FKOR.BWWAL ?};
            {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || fak[15]:={? fak[15]<+form(_kw_rab,,2) || +form(_kw_rab,,2) || fak[15] ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || fak[15]:={? fak[15]<+form(_kw_rabw,,2) || +form(_kw_rabw,,2) || fak[15] ?}
            ?};
            {? FAP.SV().KOD=' -o' | FKOR.SV().KOD=' -o' || __oo:=1 ?};
            FAP.next()
         !}
      ?};
      {? _razdwa=1
      ||
         {? walutowa=0 | PARAM_W.WALH='N' || _war9:=_war11:=_war12:=0 ?};
         _fak9:={? +form(fak[9],,2)>+form(_war9,,2) || +form(fak[9],,2) || +form(_war9,,2) ?};
         _fak11:={? +form(fak[11],,2)>+form(_war11,,2) || +form(fak[11],,2) || +form(_war11,,2) ?};
         _fak12:={? +form(fak[12],,2)>+form(_war12,,2) || +form(fak[12],,2) || +form(_war12,,2) ?}
      ||
         _zm_sv:=FAP.SV<>FKOR.SV;
         {? walutowa=0 | PARAM_W.WALH='N' || _war9:=_war11:=_war12:=0 ?};
         fak[9]:={? +form(fak[9],,2)>+form(_war9,,2) || +form(fak[9],,2) || +form(_war9,,2) ?}+_zm_sv;
         fak[11]:={? +form(fak[11],,2)>+form(_war11,,2) || +form(fak[11],,2) || +form(_war11,,2) ?}+_zm_sv;
         fak[12]:={? +form(fak[12],,2)>+form(_war12,,2) || +form(fak[12],,2) || +form(_war12,,2) ?}+_zm_sv;
         fak[9]:={? _fak9<fak[9] || fak[9] || {? _fak9<k[9] || k[9] || _fak9 ?} ?}+_zm_sv;
         fak[11]:={? _fak11<fak[11] || fak[11] || {? _fak11<k[11] || k[11] || _fak11 ?} ?}+_zm_sv;
         fak[12]:={? _fak12<fak[12] || fak[12] || {? _fak12<k[12] || k[12] || _fak12 ?} ?}+_zm_sv;
         _fak9s:=+form(_fak9s,,2); {? fak[9]<_fak9s || fak[9]:=_fak9s ?};
         _fak11s:=+form(_fak11s,,2); {? fak[11]<_fak11s || fak[11]:=_fak11s ?};
         _fak12s:=+form(_fak12s,,2); {? fak[12]<_fak12s || fak[12]:=_fak12s ?};
         fak[13]:={? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H') || 6 || 0 ?}
      ?};
      FAP.cntx_pop()
   !};
   FAKS.cntx_pop();

   {? ~('TO'*ndvat)
   ||
      _war9:=_war11:=_war12:=0;
      {? FAKS.WHERE='L'
      ||
         FAKSV.index('FF_SV');
         FAKSV.prefix('',$FAKS.ref);
         {? FAKSV.first
         ||
            {!
            |?
               _war9+=FAKSV.WN_Z;
               _war11+=FAKSV.WV_Z;
               _war12+=FAKSV.WB_Z;
               FAKSV.next
            !}
         ?};
         fak[9]:={? fak[9]>+form(_war9,,2) || fak[9] || +form(_war9,,2) ?};
         fak[11]:={? fak[11]>+form(_war11,,2) || fak[11] || +form(_war11,,2) ?};
         fak[12]:={? fak[12]>+form(_war12,,2) || fak[12] || +form(_war12,,2) ?}
      ?}
   ?};
   {? _czy_rab=0 & (PARAM_W.DR_RAB<>'N' | FAKS.SPOBLRAB<>'C') | FAKS.SPOBLRAB='W' || fak[7]:=fak[8]:=0 ?};
   {? _czy_rab=0 | FAKS.SPOBLRAB='C' || fak[14]:=fak[15]:=0 ?};
   {? PARAM_W.DR_RAB='N' & FAKS.SPOBLRAB='C' || fak[6]:=fak[7]:=fak[14]:=fak[15]:=0 ?};
   {? k1[1]<fak[9]  || k1[1]:=fak[9] ?};
   {? k1[2]<fak[11] || k1[2]:=fak[11] ?};
   {? k1[3]<fak[12] || k1[3]:=fak[12] ?};
   {? ~('TO'*ndvat) & vatzpoz=0 & odbrutto=1 || fak[9]:=fak[11]:=0
   |? ~('TO'*ndvat) & vatzpoz=0              || fak[11]:=fak[12]:=0
   |? ('TO'*ndvat)                           || fak[10]:=fak[11]:=fak[12]:=0
   ?};
      {? fak[1]>2 || k[1]+=FAKS.SP_WYM='T' ?};
      {? fak[1]<3 || k[1]:=3 ?};
      fak[1]:=k[1];
   {! _i:=1..obj_len(k) |! {? fak[_i]=0 || k[_i]:=0 ?} !};
   {! _i:=3..obj_len(k)
   |!
      {? fak[_i]>k[_i] || k[_i]:=fak[_i] ?}
   !};
   k[2]:=1; print1();
   k[2]+=charleft-PRN1.width();
   print1(); print2(); print3()
|| print2()
?};
         ~~}
{COMMENT}   napis przed korekta                                      {COMMENT-}
         {FONT: exec('font','param_wydr','kor_przed')}
         {<1}{LINE}
         {SPACE: exec('space','param_wydr')}
         {<3}{COLOR: color_wg}{'   '+exec('tr','tlumaczenia','2000104')}{COLOR: color_dgg}{'...'}{COLOR: color_bw}
         {SPACE: 'E'}
         {<3}{COLOR: color_dgg}{'   '+exec('tr','tlumaczenia','2000104')}{COLOR: color_dgg}{'...'}{COLOR: color_bw}
         {SPACE: exec('space','param_wydr')}
{COMMENT}   kurs dla waluty                                          {COMMENT-}
         {wal_h:={? PARAM_W.WALH='H' & exec('get','#params',100232,2)='N' || 0 || 1 ?};~~}
         {IF: walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H') & wal_h}
            {
            _sz1:=max_T8G/2$0;_sz2:=1;
            print4(_sz1,_sz2);
            _sz2+=charleft-PRN4.width();
            print4(_sz1,_sz2);
            FAKS.cntx_psh();
            FAKS.clear();
            FAKS.seek(BB.sqlint(FAKS.FKSQL),form(8+FAKS.FKSQL));
            inf_head:=exec('tr','tlumaczenia','1000126')+' '+__walh+';'+ exec('tr','tlumaczenia','1000126')+' '+exec('tr','tlumaczenia','1000127')+';';
            inf_val:=form(FAKS.KRS,,4)+';'+gsub(form(FAKS.DTK,,3),'/','-')+';';
            B.cntx_psh();
            B.index('BANKOD');
            B.prefix(FAKS.BTK,);
            {? FAKS.SWAL=1 & B.first
            ||
               inf_head+=exec('tr','tlumaczenia','1000128')+';';
               inf_val+=B.NB+';'
            ?};
            B.cntx_pop();
            FAKS.cntx_pop();
            Line:=0;
            ~~}
            {SUBSTITUTE: 'panel_informacji'}
         {FI}
{COMMENT}   odrysowanie po raz pierwszy naglowka tabeli pozycji      {COMMENT-}
         {FONT: exec('font','param_wydr','tabhead_poz')}
         {
         prn1:='PRN1'; prn2:='PRN2';
         {! _ii:=1..6 |! s[_ii]:=0 !};
         {! _ii:=1..6 |! do_p[_ii]:=0 !};
         il_lin:=0;
         _allkor:=-PARAM_W.POZY='w';
         _jest:=0;
         {? ilkop=1 || p_druk:='' || _jest:=1 ?};
         _poz:=0;
         FAP.index('FAP'); FAP.prefix(FAKS.ref());
         {? FAP.first()
         || {!
            |? {? _allkor
               || pozycjaa();
                  _poz:=1;
                  0
               |? {? _jest || p_druk*('/'+$FAP.POZ+'/') || exec('spr_kor','faktury_poz') ?}
               || {? ~_jest || p_druk+='/'+$FAP.POZ+'/' ?};
                  {? ~_poz || pozycjaa(); _poz:=1 ?};
                  {? _jest || 0 || FAP.next() ?}
               || FAP.next()
               ?}
            !}
         ?};
         "--szacowanie ilosci lini pozycji--";
         _f:=prn1+'.ini_head()'; _v:=($(_f))();
         _f:=prn1+'.hlength()'; il_lin+=($(_f))()+1;
         "--uwzglednienie footer poniewaz nie jest jeszcze ustawiony--";
         il_lin+=3;
         logr:=9+{? PARAM_W.WALH='T' || 1 || 0 ?}+{? exec('czy_rab','faktury_wspolne') || 2 || 0 ?};
         ~~}
         {IF: lineleft>0 & lineleft()<logr}{PAGE}{FI}
         {SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
         {ENTIRE-}
{COMMENT}   HEADER obowiazujacy przy drukowaniu pozycji faktury      {COMMENT-}
{COMMENT}   przed korekta                                           {COMMENT-}
         {HEADER}
         {SUBSTITUTE: 'headpoz'}
         {HEADER-}
         { rsep:=PAR_WYDR.RSEP;~~}
{COMMENT}   pozycje przed korekta                                    {COMMENT-}
         {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
         {
         FAKSO.cntx_psh; FAP.cntx_psh(); FAKS.cntx_psh();
         prn1:='PRN1'; prn2:='PRN2';
         {! _ii:=1..6 |! s[_ii]:=0 !};
         {! _ii:=1..6 |! do_p[_ii]:=0 !};
         przed_po:='przed';
         ~~}
         {FOR: FAP}{INDEX: 'FAP'}{PREFIX: FAKS.ref()}
         {DO}
            {FIRST}
               {
               fap_bkor:=null();
               ~~}
            {FIRST-}
            {IF: FAP.POZP=0 & (-PARAM_W.POZY='w' | p_druk*('/'+$FAP.POZ+'/'))}
               { FAP.cntx_psh();
                 FAP.use('fakpo'+(5-form(8+FAKS.LKSQL)));
                 FAP.index('FAP');
                 FAP.prefix(BB.sqlint(FAKS.LKSQL),FAP.POZ);
                 fap_bkor:={? FAP.first() || FAP.ref() || null() ?};
                 FAP.cntx_pop();
                 walutowa:=PARAM_W.WALH='H'; pozycjaa(fap_bkor);
               ~~}
               {IF: fap_bkor}
                  {SUBSTITUTE: 'POZYCJA'}
                  {IF: __walh<>__walp & PARAM_W.WALH='T'}
                     { {? PARAM_W.WALH='T' || rsep:=0 ?}; walutowa:=1; pozycjaa(fap_bkor); logr:=4; ~~}
                     {IF: lineleft()<=(logr+1)}
                        {bpage:=page(); ~~}
                        {SUBSTITUTE: 'foot_tab'}
                        {IF: bpage=page}{PAGE}{FI}
                        { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
                        {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
                        { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
                     {FI}
                     {SUBSTITUTE: 'LINIA0'}
                     { rsep:=PAR_WYDR.RSEP; do_przeh(); ~~}
                  {FI}
{COMMENT}   informacje dodatkowe dla pozycji                         {COMMENT-}
                  {
                  FAP.use('fakpo'+(5-form(8+FAKS.LKSQL)));
                  FAKS.use(form(8+FAKS.LKSQL));
                  FAKSO.use('fakto'+(5-form(8+FAKS.LKSQL)));
                  FAP.prefix();
                  FAP.seek(fap_bkor);
                  ~~}
                  {FOR: FAKSO}{INDEX: 'FAP'}{PREFIX: FAP.ref()}
                  {DO}
                     { {! _i..obj_len(k) |! w[_i]:='' !};
                       w[2]:=exec('printFAKSO','fakso',PARAM_W.JEZYK);
                       rsep:=0;~~}
                     {SUBSTITUTE: 'LINIA0'}
                     { rsep:=1;~~}
                  {OD}
               {FI}
            {FI}
            {TOTAL}
               {
               VAR_DEL.delete('fap_bkor');
               ~~}
         {OD}
{COMMENT}   podsumowanie pozycji przed korekta                       {COMMENT-}
         {
         rsep:=1;
         FAKSO.cntx_pop; FAP.cntx_pop(); FAKS.cntx_pop();
         w[1]:=exec('tr','tlumaczenia','2000107');
         w[9]:=s[1];
         w[10]:='';
         w[11]:=s[2];
         w[12]:=s[3];
         w[13]:=__walp
         ;~~}
         {IF: lineleft>0 & lineleft<4}{PAGE}{FI}
         {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
         {PRN2.setcolor(color_g);~~}
         {IF: PARAM_W.WALH<>'H'}{SUBSTITUTE: 'LINIA02'}{FI}
         { strona:=page()-pages;~~}
         {IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
            {
            w[1]:=exec('tr','tlumaczenia','2000107');
            w[9]:=s[4];
            w[10]:='';
            w[11]:=s[5];
            w[12]:=s[6];
            w[13]:=__walh
            ;~~}
            {IF: PARAM_W.WALH<>'H'}
               { rsep:=0; prn1:='PRN2';~~}
               {SUBSTITUTE: 'LINIA0'}
            {ELSE}
               {SUBSTITUTE: 'LINIA02'}
            {FI}
         {FI}
         { prn1:='PRN2';~~}
         {SUBSTITUTE: 'LINIAF'}
         {HEADER}{HEADER-}
         { vp:=0; ~~}
{COMMENT}   tekst po korekcie                                        {COMMENT-}
         {ENTIRE}
         {FONT: exec('font','param_wydr','kor_po')}
         {<1}{LINE}
         {SPACE: exec('space','param_wydr')}
         {<3}{COLOR: color_wg}{'   '+exec('tr','tlumaczenia','2000106')}{COLOR: color_dgg}{'...'}{COLOR: color_bw}
         {SPACE: 'E'}
         {<3}{COLOR: color_dgg}{'   '+exec('tr','tlumaczenia','2000106')}{COLOR: color_dgg}{'...'}{COLOR: color_bw}
         {SPACE: exec('space','param_wydr')}
{COMMENT}   kurs dla waluty                                          {COMMENT-}
         {IF: walutowa=1  & (PARAM_W.WALH='T' | PARAM_W.WALH='H') & wal_h}
            {FONT: exec('font','param_wydr','strony_po')}
            {
            _sz1:=max_T8G/2$0;_sz2:=1;
            print4(_sz1,_sz2);
            _sz2+=charleft-PRN4.width();
            print4(_sz1,_sz2);
            inf_head:=exec('tr','tlumaczenia','1000126')+' '+__walh+';'+ exec('tr','tlumaczenia','1000126')+' '+exec('tr','tlumaczenia','1000127')+';';
            inf_val:=form(FAKS.KRS,,4)+';'+gsub(form(FAKS.DTK,,3),'/','-')+';';
            B.cntx_psh();
            B.index('BANKOD');
            B.prefix(FAKS.BTK,);
            {? FAKS.SWAL=1 & B.first
            ||
               inf_head+=exec('tr','tlumaczenia','1000128')+';';
               inf_val+=B.NB+';'
            ?};
            B.cntx_pop()
            ;~~}
            {SUBSTITUTE: 'panel_informacji'}
         {FI}
{COMMENT}   HEADER obowiazujacy dla tekstu po korekcie               {COMMENT-}
         {HEADER}
         {SUBSTITUTE: 'HEADF'}
         {HEADER-}
{COMMENT}   odrysowanie po raz pierwszy naglowka tabeli pozycji      {COMMENT-}
         {FONT: exec('font','param_wydr','tabhead_poz')}
         {
         prn1:='PRN1'; prn2:='PRN2';
         {! _ii:=1..6 |! s[_ii]:=0 !};
         {! _ii:=1..6 |! do_p[_ii]:=0 !};
         przed_po:='po';
         il_lin:=0;
         _allkor:=-PARAM_W.POZY='w';
         _jest:=~(ilkop<=1);
         FAP.index('FAP'); FAP.prefix(FAKS.ref());
         {? FAP.first()
         || {!
            |? {? _allkor | {? _jest || p_druk*('/'+$FAP.POZ+'/') || exec('spr_kor','faktury_poz') ?}
               || pozycjab();
                  0
               || FAP.next()
               ?}
            !}
         ?};
         logr:=9+{? PARAM_W.WALH='T' || 1 || 0 ?}+{? exec('czy_rab','faktury_wspolne') || 2 || 0 ?};
         ~~}
         {IF: lineleft()<logr}{PAGE}{FI}
         {IF: strona<>page()-pages}
            {SUBSTITUTE: 'TABHEAD'}{ strona:=1; vp:=1;~~}
         {FI}
         {ENTIRE-}
{COMMENT}   HEADER obowiazujacy przy drukowaniu pozycji faktury      {COMMENT-}
{COMMENT}   po korekcie                                              {COMMENT-}
         {FONT: exec('font','param_wydr','header')}{SPACE: exec('space','param_wydr')}
         {HEADER}
         {SUBSTITUTE: 'headpoz'}
         {HEADER-}
{COMMENT}   pozycje po korekcie                                      {COMMENT-}
         {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
         {
         prn1:='PRN1'; prn2:='PRN2';
         {! _ii:=1..6 |! s[_ii]:=0 !};
         {! _ii:=1..6 |! do_p[_ii]:=0 !};
         next_poz:=0;
         rsep:=PAR_WYDR.RSEP
         ;~~}
         {IF: p_druk='' & -PARAM_W.POZY<>'w'}
{COMMENT}   pominiecie naglowka tabeli jesli po korekcie zaczyna sie {COMMENT-}
{COMMENT}   na pierwszej stronie - brak pozycji do wydruku           {COMMENT-}
            { prn1:='PRN2';~~}
            {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
         {ELSE}
            {FOR: FAP}{INDEX: 'FAP'}{PREFIX: FAKS.ref}
            {DO}
               {IF: p_druk*('/'+$FAP.POZ+'/') | -PARAM_W.POZY='w'}
                  { walutowa:=PARAM_W.WALH='H'; pozycjab();
                    {? strona=page()-pages || il_lin+=1 ?};
                  ~~}
                  {IF: strona=1}
                     {SUBSTITUTE: 'POZYCJA'}
                  {ELSE}
{COMMENT}   pominiecie naglowka tabeli jesli po korekcie zaczyna sie {COMMENT-}
{COMMENT}   na pierwszej stronie                                     {COMMENT-}
                     { rsep:=0;~~}
                     {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
                     {SUBSTITUTE: 'POZYCJA'}
                  {FI}
                  {IF: __walh<>__walp & PARAM_W.WALH='T'}
                     { {? PARAM_W.WALH='T' || rsep:=0 ?}; walutowa:=1; pozycjab(); logr:=4; ~~}
                     {IF: lineleft()<=(logr+1)}
                        {bpage:=page(); ~~}
                        {SUBSTITUTE: 'foot_tab'}
                        {IF: bpage=page}{PAGE}{FI}
                        { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
                        {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
                        { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
                     {FI}
                     {SUBSTITUTE: 'LINIA0'}
                     { do_przeh(); ~~}
                  {FI}
                  { rsep:=PAR_WYDR.RSEP; ~~}
{COMMENT}   informacje dodatkowe dla pozycji                         {COMMENT-}
                  {FOR: FAKSO}{INDEX: 'FAP'}{PREFIX: FAP.ref()}
                  {DO}
                     { {! _i..obj_len(k) |! w[_i]:='' !};
                       w[2]:=exec('printFAKSO','fakso',PARAM_W.JEZYK);
                       rsep:=0;~~}
                     {SUBSTITUTE: 'LINIA0'}
                     { rsep:=PAR_WYDR.RSEP;~~}
                  {OD}
               {FI}
            {OD}
         {FI}
{COMMENT}   podsumowanie pozycji po korekcie                         {COMMENT-}
         {
         w[1]:=exec('tr','tlumaczenia','2000107');
         w[9]:=s[1];
         w[10]:='';
         w[11]:=s[2];
         w[12]:=s[3];
         w[13]:=__walp;
         vp:=0;
         rsep:=1
         ;~~}
         {IF: lineleft>0 & lineleft<4}{PAGE}{FI}
         { VAR_DEL.delete('przed_po'); ~~}
         {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
         {IF: PARAM_W.WALH<>'H'}
            {IF: p_druk='' & -PARAM_W.POZY<>'w'}
{COMMENT}   pominiecie naglowka tabeli jesli po korekcie zaczyna sie {COMMENT-}
{COMMENT}   na pierwszej stronie - brak pozycji do wydruku           {COMMENT-}
               { rsep:=0;~~}
               {SUBSTITUTE: 'LINIA0'}
            {ELSE}
               {SUBSTITUTE: 'LINIA02'}
            {FI}
         {FI}
         {IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
            {
            strona:=page()-pages;
            w[1]:=exec('tr','tlumaczenia','2000107');
            w[9]:=s[4];
            w[10]:='';
            w[11]:=s[5];
            w[12]:=s[6];
            w[13]:=__walh
            ;~~}
            {IF: PARAM_W.WALH<>'H'}
               { rsep:=0; prn1:='PRN2';~~}
               {SUBSTITUTE: 'LINIA0'}
            {ELSE}
               {SUBSTITUTE: 'LINIA02'}
            {FI}
         {FI}
         { prn1:='PRN2'; rsep:=PAR_WYDR.RSEP;~~}
         {SUBSTITUTE: 'LINIAF'}
{COMMENT}   HEADER obowiazujacy do konca                     {COMMENT-}
         {HEADER}
         {SUBSTITUTE: 'HEADF'}
         {HEADER-}
{COMMENT}   tabela posumowująca                                {COMMENT-}
         {ENTIRE}
         {IF: wal_h }
            {IF: lineleft()>0 & lineleft()<12}{PAGE}{LINE}{FI}
            {FONT: exec('font','param_wydr','head')}
            {LINE}
            {<1}{print6();PRN6.ini_line();~~}
            {REP: PRN6.fline(lmt)}
            {REP: PRN6.flbar(lmt)}
            {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
            {
            licznik:=0;
            exec('jakislsv','ustawienia',1);
            prn1:='PRN2'; tmp:=k[1]
            ;~~}
            {IF: ~('TO'*ndvat)}
               {IF: FAKS.WHERE<>'L'}
                  {IF: ~('TO'*ndvat) }
{COMMENT}   tabela podsumowujaca z pozycji faktury                   {COMMENT-}
                     { VAR_DEL.delete('il_stvat'); il_stvat:=exec('ilStVat','faktury_wydruk',FAKS.ref(),SLU.ref());~~}
                     {FOR:'SLO'}{INDEX:'SL'}{PREFIX: SLU.ref}
                     {DO}
                        {FIRST}
                           {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
                           {
                           _ret:=__odsskr; {! _ii:=1..16 |! _ret+=({? k[_ii]<>0 & (_ii<5 | _ii>13 ) || k[_ii]+__odsram || 0 ?}) !}; _ret-=__odsram-__odsskr;
                           tmp:=k[1];
                           k[1]:=0;
                           lmt:=_ret-{? vatzpoz=0 & odbrutto=1 || k1[1]+__odsram+k1[2]+__odsram |? vatzpoz=0 || k1[2]+__odsram+k1[3]+__odsram ?};
                           il_lin:={? il_stvat>1 || il_stvat+2 || il_stvat ?}+{? walutowa=1 || 5 || 3 ?};
                           sp[1]:=sp[2]:=sp[3]:=0;
                           print2(1,1)
                           ;~~}
                           {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
                        {FIRST-}
                        {
                        vp:=0;
                        exec('w_tym','faktury_wydruk',FAKS.ref,SLO.ref,vatk,2,p_druk,vat);
                        ~~}
                        {IF: vatk[1]<>0 | vat[1]<>0}
                           {licznik+=1;~~}
                           {IF: licznik=1}
                              {Text_dl:=PRN2.width();~~}
                              {
                              lmt-=1;
                              ~~}
                              {IF: vatzpoz=1}
                                 { rsep:=0; vp:=0;~~}
                              {ELSE}
                                 {FONT: exec('font','param_wydr','tabhead_vat')}{SPACE: exec('space','param_wydr')}
                                 {SUBSTITUTE: 'TABHEAD'}
                                 { rsep:=0; vp:=1;~~}
                                 {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
                              {FI}
                           {FI}
                           {
                           w[6]:={? k[8]=0 & licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
                           w[8]:={? licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
                           sp[1]+=w[9]:=vatk[1]-vat[1];
                           w[10]:=SLO.KOD;
                           sp[2]+=w[11]:=vatk[2]-vat[2];
                           sp[3]+=w[12]:=vatk[3]-vat[3];
                           w[13]:=__walp
                           ;~~}
                           {SUBSTITUTE: 'LINIA0I'}
                           { rsep:=0; vp:=0;~~}
                        {FI}
                     {TOTAL}
                        {IF: vatzpoz=0}
                           {
                           w[6]:={? k[8]=0 || exec('tr','tlumaczenia','2000107') || '' ?};
                           w[8]:=exec('tr','tlumaczenia','2000107');
                           w[9] :=sp[1];
                           w[10]:='';
                           w[11]:=sp[2];
                           w[12]:=sp[3];
                           w[13]:=__walp
                           ;~~}
                           {FONT: exec('font','param_wydr','razem')}
                           {PRN2.setcolor(color_g);~~}
                           { rsep:=1; vp:=0;~~}
                           {SUBSTITUTE: 'LINIAFSI'}
                           {FONT: exec('font','param_wydr','vat')}
                           {PRN2.setcolor(color_w);~~}
                           { rsep:=0; vp:=0;~~}
                        {FI}
                        {IF: licznik>0 & vatzpoz=1}
                           {
                             w[6]:={? k[8]=0 || exec('tr','tlumaczenia','2000107') || '' ?};
                             w[8]:=exec('tr','tlumaczenia','2000107');
                             w[9]:=sp[1];
                             w[10]:='';
                             w[11]:=sp[2];
                             w[12]:=sp[3];
                             w[13]:=__walp
                             ;~~}
                           {FONT: exec('font','param_wydr','razem')}
                           {PRN2.setcolor(color_g);~~}
                           { rsep:=1; vp:=0;~~}
                           {SUBSTITUTE: 'LINIAFSI'}
                           {FONT: exec('font','param_wydr','vat')}
                           {PRN2.setcolor(color_w);~~}
                           { rsep:=0; vp:=0;~~}
                           {SUBSTITUTE: 'LINIAF'}
                        {ELIF: licznik=1 | vatzpoz=0}
                           {IF: licznik>0}{SUBSTITUTE: 'LINIAF'}{FI}
                        {FI}
                        {LINE}
                        { k[1]:=tmp;w[13]:='';~~}
                     {OD}
                     { VAR_DEL.delete('il_stvat','Text_dl');~~}
                   {FI}
               {ELSE}
{COMMENT}   tabela podusmowujaca dla faktury zaliczkowej             {COMMENT-}
                  {FOR: FAKSV}{INDEX: 'FF_SV'}{PREFIX: '',BB.refsql(FAKS.ref)}
                  {DO}
                     {FIRST}
                        {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
                        {
                        _ret:=__odsskr; {! _ii:=1..16 |! _ret+=({? k[_ii]<>0 & (_ii<5 | _ii>13 ) || k[_ii]+__odsram || 0 ?}) !}; _ret-=__odsram-__odsskr;
                        tmp:=k[1];
                        k[1]:=0;
                        lmt:=_ret-{? vatzpoz=0 & odbrutto=1 || k1[1]+__odsram+k1[2]+__odsram |? vatzpoz=0 || k1[2]+__odsram+k1[3]+__odsram ?};
                        il_lin:=FAKSV.size()+5;
                        sp[1]:=sp[2]:=sp[3]:=0;
                        print2(1,1)
                        ;~~}
                        {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
                        { Text:=exec('tr','tlumaczenia','2000111'); Text_dl:=PRN2.width();~~}
                        {SUBSTITUTE: 'prn_txt'}
                        { VAR_DEL.delete('Text','Text_dl');~~}
                        { lmt-=1;~~}
                        {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
                        { rsep:=0; vp:=0;~~}
                     {FIRST-}
                     {
                     licznik+=1;
                     w[6]:=w[8]:='';
                     sp[1]+=w[9]:=FAKSV.WN_Z;
                     w[10]:=FAKSV.SV().KOD;
                     sp[2]+=w[11]:=FAKSV.WV_Z;
                     sp[3]+=w[12]:=FAKSV.WB_Z;
                     w[13]:=__walp
                     ;~~}
                     {SUBSTITUTE: 'LINIA0I'}
                     {TOTAL}
                        {IF: licznik>0}
                           {
                             w[6]:={? k[8]=0 || exec('tr','tlumaczenia','2000107') || '' ?};
                             w[8]:=exec('tr','tlumaczenia','2000107');
                             w[9]:=sp[1];
                             w[10]:='';
                             w[11]:=sp[2];
                             w[12]:=sp[3];
                             w[13]:=__walp
                           ;~~}
                           {FONT: exec('font','param_wydr','razem')}
                           {PRN2.setcolor(color_g);~~}
                           { rsep:=1; vp:=0;~~}
                           {SUBSTITUTE: 'LINIAFSI'}
                           {FONT: exec('font','param_wydr','vat')}
                           {PRN2.setcolor(color_w);~~}
                           { rsep:=0; vp:=0;~~}
                        {FI}
                        {IF: licznik>0}{SUBSTITUTE: 'LINIAF'}{FI}
                        { k[1]:=tmp;w[13]:='';~~}
                  {OD}
               {FI}
               {IF: exec('czy_end','faktury_zalicz')}
{COMMENT}   tabela podsumowujaca dla faktury rozliczajacej zaliczke  {COMMENT-}
                  {FOR: FAKSV}
                  {INDEX: 'FF_SV'}
                  {PREFIX: '',BB.refsql(FAKS.ref)}
                  {DO}
                     {FIRST}
                        {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
                        {<1}{
                        sp[1]:=sp[2]:=sp[3]:=0;
                        il_lin:=FAKSV.size()+{? walutowa=1 || 5 || 3 ?};
                        txt:=exec('tr','tlumaczenia','1000135')+' '+KSTE.WAL().KOD;
                        delta:=+txt+lmt+1-charleft(); {? delta<0 || delta:=0 ?};
                        ~~}
                        {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
                        {<{lmt+1-delta}}{txt}
                        {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
                     {FIRST-}
                     {
                     vp:=0;
                     licznik+=1;
                     w[6]:=w[8]:='';
                     w[12]:=FAKSV.WB_R;
                     w[9] :=FAKSV.WN_R;
                     w[10]:=FAKSV.SV().KOD;
                     w[11]:=FAKSV.WV_R;
                     sp[1]+=0;
                     sp[1]+=w[9];
                     sp[2]+=w[11];
                     sp[3]+=w[12]
                     ;~~}
                     {SUBSTITUTE: 'LINIA0I'}
                  {OD}
                  {IF: licznik>0}
                     {
                     w[6]:={? k[8]=0 || exec('tr','tlumaczenia','2000107') || '' ?};
                     w[8]:=exec('tr','tlumaczenia','2000107');
                     w[9]:=sp[1];
                     w[10]:='';
                     w[11]:=sp[2];
                     w[12]:=sp[3]
                     ;~~}
                     {FONT: exec('font','param_wydr','razem')}
                     {PRN2.setcolor(color_g);~~}
                     { rsep:=1; vp:=0;~~}
                     {SUBSTITUTE: 'LINIAFSI'}
                     {FONT: exec('font','param_wydr','vat')}
                     {PRN2.setcolor(color_w);~~}
                     { rsep:=0; vp:=0;~~}
                  {FI}
                  {SUBSTITUTE: 'LINIAF'}
                  {IF: walutowa}
                     {FOR: FAKSV}
                     {INDEX: 'FF_SV'}
                     {PREFIX: '',faks}
                     {DO}
                        {FIRST}
                           {<1}{
                           sp[1]:=sp[9]:=sp[11]:=sp[12]:=0;
                           il_lin:=FAKSV.size()+{? walutowa=1 || 5 || 3 ?};
                           txt:=exec('tr','tlumaczenia','1000135')+' '+exec('tr','tlumaczenia','1000131')+' '+FAKSV.WAL().KOD;
                           delta:=+txt+lmt+1-charleft(); {? delta<0 || delta:=0 ?};
                           ~~}
                           {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
                           {<{lmt+1-delta}}{txt}
                           {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
                        {FIRST-}
                        {
                        vp:=0;
                        licznik+=1;
                        w[6]:=w[8]:='';
                        w[12]:=FAKSV.WW-FAKSV.WW_Z;
                        _sv:=(#((FAKSV.SV().KOD*'%')+FAKSV.SV().KOD-1))*0.01;
                        _wwn:=(FAKSV.WW/(1+_sv))$2;
                        _wwn_z:=(FAKSV.WW_Z/(1+_sv))$2;
                        w[9] :=_wwn-_wwn_z;
                        w[10]:=FAKSV.SV().KOD;
                        _wwv:=FAKSV.WW-_wwn;
                        _wwv_z:=FAKSV.WW_Z-_wwn_z;
                        w[11]:=(_wwv-_wwv_z)$2;
                        sp[1]+=0;
                        sp[1]+=w[9];
                        sp[2]+=w[11];
                        sp[3]+=w[12]
                        ;~~}
                        {SUBSTITUTE: 'LINIA0I'}
                     {OD}
                     {IF: licznik>0}
                        {
                        w[6]:={? k[8]=0 || exec('tr','tlumaczenia','2000107') || '' ?};
                        w[8]:=exec('tr','tlumaczenia','2000107');
                        w[9]:=sp[1];
                        w[10]:='';
                        w[11]:=sp[2];
                        w[12]:=sp[3]
                        ;~~}
                        {FONT: exec('font','param_wydr','razem')}
                        {PRN2.setcolor(color_g);~~}
                        { rsep:=1; vp:=0;~~}
                        {SUBSTITUTE: 'LINIAFSI'}
                        {FONT: exec('font','param_wydr','vat')}
                        {PRN2.setcolor(color_w);~~}
                        { rsep:=0; vp:=0;~~}
                     {FI}
                     {SUBSTITUTE: 'LINIAF'}
                  {FI}
               {FI}
            {FI}
            { lmt:=lmt_org; VAR_DEL.delete('tmp');~~}
         {ELSE}
            {LINE}
         {FI}
         {ENTIRE-}
{COMMENT}   rozliczone zaliczki                                      {COMMENT-}
         { FAKSV.cntx_psh;~~}
         {FOR: FAPOW}
         {INDEX: 'END_K'}
         {PREFIX: BB.refsql(FAKS.ref()),'N'}
         {DO}
            {FIRST}
               { fk_roz:=1; ~~}
               {<{lmt+1}}{FONT: exec('font','param_wydr','rozzal_nag')}{exec('tr','tlumaczenia','1000138')+' '}
            {FIRST-}
            {<{lmt+5}
               }{FONT: exec('font','param_wydr','rozzal_1')}{form(FAPOW.FAKS_SYM)
               }{FONT: exec('font','param_wydr','rozzal_2')}{' '}{exec('tr','tlumaczenia','1000127')
               }{FONT: exec('font','param_wydr','rozzal_3')}{' '}{form($FAPOW.DW)
               }{FONT: exec('font','param_wydr','rozzal_4')}{', '}{exec('tr','tlumaczenia','1000137')
               }{FONT: exec('font','param_wydr','rozzal_5')}{' '}{form(FAPOW.KW_ROZ,,2,'.,')
               }{FONT: exec('font','param_wydr','rozzal_6')}{' '}{FAPOW.WAL
                +{? exec('FindAndGet','#table',FAKS,FAPOW.FAKS,,"STAT_REJ",'N')='A' || ' - '+exec('tr','tlumaczenia','1000215') || '' ?}}
            {IF: __walh<>__walp & ~('TO'*ndvat)}
               { FAKSV.use('faksv'+(8+FAPOW.FAKS+3));~~}
               {FOR: FAKSV}
               {INDEX: 'FAPOW_SV'}
               {PREFIX: $FAPOW.ref}
               {DO}
                  {FONT: exec('font','param_wydr','rozzal_narod')}
                  {FIRST}
                     { il_lin:=FAKSV.size()+3;~~}
                     {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
                     {<{lmt+7}exec('tr','tlumaczenia','1000132')+' '+KSTE.WAL().KOD+
                        ' '+exec('tr','tlumaczenia','1000158')+' '+form(FAKSV.KRS_ZAL,,4)}
                     {lmt:=5; rsep:=vp:=0;~~}
                     {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
                  {FIRST-}
                  {
                  w[9]:=FAKSV.WN_Z;
                  w[10]:=FAKSV.SV().KOD;
                  w[11]:=FAKSV.WV_Z;
                  w[12]:=FAKSV.WB_Z
                  ;~~}
                  {SUBSTITUTE: 'LINIA0'}
                  {TOTAL}
                     {SUBSTITUTE: 'LINIAF'}
               {OD}
            {FI}
            { {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H') & (exec('sp_active','faktury_wspolne',FAKS.DW)=0 | FAKS.SP_WYM<>'T') || kw_fak-=FAPOW.KW_ROZ ?};~~}
         {OD}
         { FAKSV.cntx_pop;~~}
{COMMENT}   do zaplaty                                               {COMMENT-}
         {
         __walprn:=__walp;
         {? PARAM_W.WALH='T' | PARAM_W.WALH='H'
         ||
            {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
                  |
               __walh<>INFO.NAROD().KOD
            ||
               __walprn:=__walh
            ?}
         ?};
         ~~}
         {IF: ~loop.kz}
            {IF: FAKS.WHERE='L'}
               {<{lmt+1}
                  }{FONT: exec('font','param_wydr','kwzal_tr')}{exec('tr','tlumaczenia','2000108')+' '+FAKS.KOR
                  }{FONT: exec('font','param_wydr','kwzal_war')}{'   '}{form(kw_zal,,2)
                  }{FONT: exec('font','param_wydr','kwzal_wal')}{' '}{zal_wal}
               {<{lmt+1}
                  }{FONT: exec('font','param_wydr','kwzal_tr')}{exec('tr','tlumaczenia','2000109')+' '+FAKS.SYM
                  }{FONT: exec('font','param_wydr','kwzal_war')}{'   '}{form(-FAKS.KW_ZAL,,2)
                  }{FONT: exec('font','param_wydr','kwzal_wal')}{' '}{__walprn}
            {FI}
            {
            w[12]:=0;
            kw_vat:=0;
            FAPOW.cntx_psh();
            FAPOW.index('END_K');
            FAPOW.prefix($FAKS.ref(),'N');
            _roz:=FAPOW.first();
            FAPOW.cntx_pop();
            _obj:=exec('obj_fv_sp','dok_fks_aut_dok');
            _obj.create($FAKS.ref());
            _Faksv:=_obj.tab;
            _loop:=_Faksv.first();
            {!
            |? _loop
            |!
               {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
               ||
                  {? exec('sp_active','faktury_wspolne',FAKS.DW) & FAKS.SP_WYM='T'
                  ||
                     w[12]+={? FAKS.WHERE='L' || _Faksv.WWN_Z |? _roz || _Faksv.WWN_R  || _Faksv.WWN ?};
                     kw_vat+={? FAKS.WHERE='L' || _Faksv.WV_Z |? _roz || _Faksv.WV_R || _Faksv.WV ?}
                  ||
                     {? ('TO'*ndvat)
                     || w[12]+={? FAKS.WHERE='L' || _Faksv.WWN_Z |? _roz || _Faksv.WWN_R  || _Faksv.WWN ?}
                     || w[12]+={? FAKS.WHERE='L' || _Faksv.WW_Z |? _roz || _Faksv.WW_R  || _Faksv.WW ?}
                     ?}
                  ?}
               ||
                  {? ('TO'*ndvat)
                  || w[12]+={? FAKS.WHERE='L' || _Faksv.WN_Z |? _roz || _Faksv.WN_R  || _Faksv.WN ?}
                  || w[12]+={? FAKS.WHERE='L' || _Faksv.WB_Z |? _roz || _Faksv.WB_R  || _Faksv.WB ?}
                  ?}
               ?};
               _loop:=_Faksv.next()
            !};
            {? PARAM_W.SLOWNIE='T'
            ||
               slownie:=exec('slownie','tlumaczenia',fabs(w[12]),__walprn);
               {? slownie=''
               || kw_fak:={? w[12]<0 || -w[12] || w[12] ?};
                  slownie:=
                     {? __walprn=INFO.NAROD().KOD
                     ||
                        STR.kwota_sł(fabs(kw_fak))
                     ||
                        STR.słownie(kw_fak)+{? frac(kw_fak) ||' '+$(#(form(kw_fak,,2)+2))+'/100'||''?}+' '+__walprn
                     ?}
               ?};
               slownie:=(~(1+slownie))+(1-slownie);
               slownie_vat:='';
               {? kw_vat<0 || kw_vat:=-kw_vat ?};
               {? kw_vat
               ||
                  slownie_vat:=
                     exec('tr','tlumaczenia','1000217')+' '+
                     {? __walp=INFO.NAROD().KOD
                     ||
                        STR.kwota_sł(fabs(kw_vat))
                     ||
                        STR.słownie(kw_vat)+{? frac(kw_vat) ||' '+$(#(form(kw_vat,,2)+2))+'/100'||''?}+' '+__walp
                     ?}
               ?};
               slownie+=' '+slownie_vat
            ?};
            {? FAKS.SKID_RBK<>null() & ~exec('rbkvat_drukuj','faktury_wydruk')
            ||
               SKID_RBK.cntx_psh();
               B.cntx_psh();
               bank_tr:=exec('tr','tlumaczenia','1000220');
               bank_war:=FAKS.SKID_RBK().BANK().NB;
               STR.split(bank_war);
               rach_tr:=exec('tr','tlumaczenia','1000221');
               exec('RB','object');
               rach_war:=exec('rb_prefix','faktury_wydruk')+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO);
               swift_tr:=exec('tr','tlumaczenia','1000114');
               swift_war:=FAKS.SKID_RBK().BANK().SWIFT;
               SKID_RBK.cntx_pop();
               B.cntx_pop()
            || bank_tr:=bank_war:=rach_tr:=rach_war:=swift_tr:=swift_war:='';STR.split('')
            ?};
            ~~}
            {IF: kw_vat=0}
               {IF: w[12]<0}
                  {wp_tr:=exec('tr','tlumaczenia','2000110');
                  wp_war:=form(-w[12],,2,'.,');
                  wp_wal:=' '+{? PARAM_W.WALH='T' | PARAM_W.WALH='H' || __walh || __walp ?};~~}
               {ELSE}
                  {wp_tr:=exec('tr','tlumaczenia','1000139');
                  wp_war:=form(w[12],,2,'.,');
                  wp_wal:=' '+{? PARAM_W.WALH='T' | PARAM_W.WALH='H' || __walh || __walp ?};~~}
               {FI}
            {ELSE}
               {IF: w[12]<0}
                  {wp_tr:=exec('tr','tlumaczenia','2000110');
                   wp_war:=form(-w[12],,2,'.,');
                   wp_war+=' '+__walprn;
                   wp_war+=' '+exec('tr','tlumaczenia','1000217')+' '+form(-kw_vat,,2,'.,');
                   wp_war+=' '+__walp;
                   ~~}
               {ELSE}
                  {wp_tr:=exec('tr','tlumaczenia','1000139');
                   wp_war:=form(w[12],,2,'.,');
                   wp_war+=' '+__walprn;
                   wp_war+=' '+exec('tr','tlumaczenia','1000217')+' '+form(kw_vat,,2,'.,');
                   wp_war+=' '+__walp;
                   ~~
                  }
               {FI}
            {FI}
            {grey_line:=+fp_tr;
            {? +grey_line<+fp_war||grey_line:=+fp_war?};
            {? +grey_line<+tp_tr||grey_line:=+tp_tr?};
            {? +grey_line<+tp_war||grey_line:=+tp_war?};
            grey_line+=12;
            ~~}
{COMMENT}   czyszczenie etykiet jeśli nie mają wartości {COMMENT-}
            { {? pl_size      || fp_war:=''; tp_war:='' ?};
              {? fp_war=''    || fp_tr:=''   ?};
              {? tp_war=''    || tp_tr:=''   ?};
              {? bank_war=''  || bank_tr:='' ?};
              {? rach_war=''  || rach_tr:='' ?};
              {? swift_war='' || swift_tr:=''?};

              line_sign:='│';
              {? fp_war='' & tp_war=''
              || line_sign:='';
                 grey_line:=0
              ?};
            ~~}
{COMMENT}   rysowanie paska z danymi {COMMENT-}
            {SUBSTITUTE: 'panel_platnosci'}
            {IF: PARAM_W.PODNALDR='T'}
               {IF: w[11]<0}
                  {<{lmt+1}}{FONT: exec('font','param_wydr','podnal_zm')}{ exec('tr','tlumaczenia','2000213')}{':'
                     }{FONT: exec('font','param_wydr','podnal_zm_war')}{' '}{form(-w[11],,2,'.,')
                     }{FONT: exec('font','param_wydr','podnal_zm_wal')}{' '+__walp}
               {ELIF: w[11]>0}
                  {<{lmt+1}}{FONT: exec('font','param_wydr','podnal_zw')}{ exec('tr','tlumaczenia','2000214')}{':'
                     }{FONT: exec('font','param_wydr','podnal_zw_war')}{' '}{form(w[11],,2,'.,')
                     }{FONT: exec('font','param_wydr','podnal_zw_wal')}{' '+__walp}
               {FI}
            {FI}
         {FI}
      {FI}
      {
      VAR_DEL.delete('__walprn','kw_vat');
      loop.loop:=FAKS_KZF.next();
      {? loop.loop || loop.faks_ref:={? +FAKS_KZF.KOR & FAKS.seek(FAKS_KZF.KOR) || FAKS.ref() || null() ?} ?};
      ~~}
      {IF: loop.loop}{LINE}{FI}
   {TOTAL}
      {
      FAKS_KZF.cntx_pop();
      FAKS.cntx_pop();
      ~~}
{COMMENT}   korekta zbiorcza - koniec pętli {COMMENT-}
   {OD}
   {IF: loop.kz}
{COMMENT}   RABAT, KWOTA ZMNIEJSZENIA PODATKU                        {COMMENT-}
      {ENTIRE}
      {
      lmt:=3;
      VAR_DEL.delete('wspw','wsp','__kz');
      wspw:={? FAKS.BRTW<0 || -1 || 1 ?};
      wsp:={? FAKS.BRUTTO<0 || -1 || 1 ?};
      ~~}
      {LINE:2}
      {IF: FAKS.RAB<>0}
      {<{lmt}
         }{FONT: exec('font','param_wydr','kz_rab_tr')}{exec('tr','tlumaczenia','1000187')+':'
         }{FONT: exec('font','param_wydr','kz_rab')}{' '}{form(FAKS.RAB,,2,',.')
         }{FONT: exec('font','param_wydr','kz_rab_proc')}{'%'}
      {FI}
      {IF: FAKS.TZP<>''}{<{lmt}exec('tr','tlumaczenia','3000111')+': '+FAKS.TZP}{FI}
      {LINE}
      {IF: wspw<0 & walutowa & (PARAM_W.WALH='H' | PARAM_W.WALH='T')}
         {<{lmt}
            }{FONT: exec('font','param_wydr','kz_kwrab_tr')}{exec('tr','tlumaczenia','1000199')+':'
            }{FONT: exec('font','param_wydr','kz_kwrab')}{' '}{form(wspw*FAKS.BRTW,,2,',.')
            }{FONT: exec('font','param_wydr','kz_kwrab_wal')}{' '}{FAKS.WAL().KOD}
      {FI}
      {IF: walutowa=0 | PARAM_W.WALH='N' | PARAM_W.WALH='T'}
         {IF: wsp<0}
            {<{lmt}
               }{FONT: exec('font','param_wydr','kz_kwrab_tr')}{exec('tr','tlumaczenia','1000199')+':'
               }{FONT: exec('font','param_wydr','kz_kwrab')}{' '}{form(wsp*FAKS.BRUTTO,,2,',.')
               }{FONT: exec('font','param_wydr','kz_kwrab_wal')}{' '}{FAKS.NWAL().KOD}
         {FI}
         {<{lmt}
            }{FONT: exec('font','param_wydr','kz_kwzp_tr')
             }{{? wsp<0 || exec('tr','tlumaczenia','2000213') || exec('tr','tlumaczenia','2000214') ?}+':'
            }{FONT: exec('font','param_wydr','kz_kwzp')}{' '}{form(wsp*FAKS.VAT,,2,',.')
            }{FONT: exec('font','param_wydr','kz_kwzp_wal')}{' '}{FAKS.NWAL().KOD}
      {FI}
      {LINE}
{COMMENT}   TABELA VAT                                               {COMMENT-}
      {<{lmt}}{FONT: exec('font','param_wydr','poz')}{exec('tr','tlumaczenia','1000132')}
      {
      __kz:=obj_new('ilk','ww','kk','nn','PRN');
      prn1:='__kz.PRN';
      __kz.ilk:=4;
      __kz.ww:=obj_new(__kz.ilk); {! _ii..__kz.ilk |! __kz.ww[_ii]:=0 !};
      __kz.kk:=obj_new(__kz.ilk);
      __kz.nn:=obj_new(__kz.ilk);
      __kz.kk[1]:=+exec('tr','tlumaczenia','1000189');  {? __kz.kk[1]<12 || __kz.kk[1]:=12 ?}; __kz.nn[1]:=exec('tr','tlumaczenia','1000189');
      __kz.kk[2]:=+exec('tr','tlumaczenia','1000190');  {? __kz.kk[2]<8 || __kz.kk[2]:=8 ?}; __kz.nn[2]:=exec('tr','tlumaczenia','1000190');
      __kz.kk[3]:=+exec('tr','tlumaczenia','1000191');  {? __kz.kk[3]<12 || __kz.kk[3]:=12 ?}; __kz.nn[3]:=exec('tr','tlumaczenia','1000191');
      __kz.kk[4]:=+exec('tr','tlumaczenia','1000192');  {? __kz.kk[4]<12 || __kz.kk[4]:=12 ?}; __kz.nn[4]:=exec('tr','tlumaczenia','1000192');
      __kz.PRN:=obj_new(@.CLASS.PRINT,4,__empty_char*3,'  ' ,'  ', '───' ,'  ' ,'──','─',' ');
      __kz.PRN.framecol(color_frame_g);
      __kz.PRN.add("__kz.ww[1]",__kz.kk[1],__kz.nn[1],1);
      __kz.PRN.add("__kz.ww[2]",__kz.kk[2],__kz.nn[2],1);
      __kz.PRN.add("__kz.ww[3]",__kz.kk[3],__kz.nn[3],1);
      __kz.PRN.add("__kz.ww[4]",__kz.kk[4],__kz.nn[4],1);
      ~~}
      {FONT: exec('font','param_wydr','tabhead_vat')}{SPACE: exec('space','param_wydr')}
      {lmt:=0;~~}
      {SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
      {FONT: exec('font','param_wydr','vat')}
      {FOR: FAKSV}
      {INDEX: 'FF_SV'}
      {PREFIX: '',$FAKS.ref}
      {DO}
         {FIRST}
         {FIRST-}
         {
         __kz.ww[1]:=form(wsp*FAKSV.WN,,2,',.');
         __kz.ww[2]:=form(FAKSV.SV().KOD,,2,',.');
         __kz.ww[3]:=form(wsp*FAKSV.WV,,2,',.');
         __kz.ww[4]:=form(wsp*FAKSV.WB,,2,',.');
         {? FAKSV.SV().KOD=' -o' | FKOR.SV().KOD=' -o' || __oo:=1 ?};
         ~~
         }
         {SUBSTITUTE: 'MY_LINIA0'}
      {OD}
      {SUBSTITUTE: 'LINIAF'}
      {ENTIRE-}
      {
      VAR_DEL.delete('wspw','wsp','__kz');
      lmt:=3;
      ~~}
      {ENTIRE}
{COMMENT}   opis stawki odwrotne obciążenie                          {COMMENT-}
      {  SLU.cntx_psh(); SLO.cntx_psh(); ~~}
      {IF:
         __oo
         &  (
               SLU.index('NAZ');
               SLO.index('SL');
               SLU.prefix();
               SLU.find_key('~STAWKI VAT '+KSTE.KRAJ().KOD);
               SLO.prefix(SLU.ref,' -o');
               SLO.first()
            )
      }
         {<1}{<{lmt}}{SLO.KOD+' - '+exec('tr','tlumaczenia','1000168')}
      {FI}
      {  SLU.cntx_pop(); SLO.cntx_pop(); ~~}
{COMMENT}   do zaplaty                                               {COMMENT-}
      {LINE}
      {
      zap:=
         {? __walh=__walp | (PARAM_W.WALH<>'T' & PARAM_W.WALH<>'H')
         ||
            FAKS.BRUTTO
         ||
            FAKS.BRTW
         ?};
      {? zap <= 0 && FAKS.KOR*'F100%' || zap:=0 ?};
      slownie:=exec('slownie','tlumaczenia',fabs(zap),{? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H') || __walh || __walp ?});
      {? slownie=''
      || kw_fak:={? zap<0 || -zap || zap ?};
         slownie:=
            {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
               | __walp<>INFO.NAROD().KOD
            ||
               STR.słownie(kw_fak)+{? frac(kw_fak) ||' '+$(#(form(kw_fak,,2,',.')+2))+'/100'||''?}+' '+
                  {? PARAM_W.WALH='T' | PARAM_W.WALH='H' || __walh || __walp ?}
            ||
               STR.kwota_sł(fabs(kw_fak))
            ?}
      ?}
      ;~~}
      {IF: zap<0}
         {wp_tr:=exec('tr','tlumaczenia','2000110');
          wp_war:=form(-zap,,2,'.,');
          wp_wal:=' '+{? PARAM_W.WALH='T' | PARAM_W.WALH='H' || __walh || __walp ?};
          ~~}
      {ELSE}
         {wp_tr:=exec('tr','tlumaczenia','1000139');
          wp_war:=form(zap,,2,'.,');
          wp_wal:=' '+{? PARAM_W.WALH='T' | PARAM_W.WALH='H' || __walh || __walp ?};
          ~~}
      {FI}
      {ENTIRE-}
   {  fp_war:=fp_tr:=tp_war:=tp_tr:=bank_tr:=bank_war:=rach_tr:=rach_war:=swift_tr:=swift_war:='';STR.split('');
      line_sign:='';
      grey_line:=0;
      {? PARAM_W.SLOWNIE='T' || slownie:=(~(1+slownie))+(1-slownie) || slownie:='' ?} ;
   ~~}
{COMMENT}   rysowanie paska z danymi {COMMENT-}
   {SUBSTITUTE: 'panel_platnosci'}
   {FI}
   {ENTIRE}
{COMMENT}   mechanizm podzielonej płatności                          {COMMENT-}
   {FONT: exec('font','param_wydr','mpp')}{SPACE: exec('space','param_wydr')}
   {  SLU.cntx_psh(); SLO.cntx_psh(); ~~}
   {IF: exec('sp_active','faktury_wspolne',FAKS.DW) & FAKS.SP_WYM='T'}
      {
      Text:='';
      {? FAKS.WHERE<>'L'
            &
         FAKS.SP_WAR
            &
         FAKS.SP_WAR<>FAKS.BRUTTO
            &
         FAKS.T().VATZPOZ='T'
      ||
         SLO.cntx_psh();
         _waln:=FAKS.NWAL().KOD;
         SLO.cntx_pop();
         Text:=
            ' ('+
            exec('tr','tlumaczenia','1000189')+': '+form(FAKS.SP_NET,,2,'.,')+' '+_waln+'; '+
            exec('tr','tlumaczenia','1000191')+': '+form(FAKS.SP_VAT,,2,'.,')+' '+_waln+'; '+
            exec('tr','tlumaczenia','1000192')+': '+form(FAKS.SP_WAR,,2,'.,')+' '+_waln+
            ')'
      ?};
      ~~}
      {<1}{LINE}
      {<1}{<{lmt}}{'* - '+exec('tr','tlumaczenia','1000170')}{FONT: exec('font','param_wydr','mpp')}{Text}
   {FI}
   {  SLU.cntx_pop(); SLO.cntx_pop(); ~~}
{COMMENT}   rachunki bankowe - tylko jeśli podany FAKS.VSKIDRBK   {COMMENT-}
   {IF: exec('rbkvat_drukuj','faktury_wydruk')}
      {IF: +FAKS.VNB}
         {<1}{LINE}
         {IF: +FAKS.NB}
            {<1}{<{lmt}}{(exec('tr','tlumaczenia','1000109')-1)+' '+__walh+':'}
            {<1}{<{lmt}}{FAKS.NB}
            {<1}{<{lmt}}{FONT: 'T10B'}{
               exec('rb_prefix','faktury_wydruk')+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO)}
            {IF: (FAKS.T().EXPORT='T' | FAKS.T().UE='T') & +FAKS.SKID_RBK().BANK().SWIFT}
               {<1}{<{lmt}}{FONT: 'T8GB'}{exec('tr','tlumaczenia','1000114')+' '+FAKS.SKID_RBK().BANK().SWIFT}
            {FI}
         {FI}
         {<1}{<{lmt}}{FONT: 'T8G'}{(exec('tr','tlumaczenia','1000109')-1)+' '+__walp+':'}
         {<1}{<{lmt}}{FAKS.VNB}
         {<1}{<{lmt}}{FONT: 'T10B'}{
            exec('rb_prefix','faktury_wydruk','vskid_rbk')+RB.get_rbtx(3,FAKS.VRBK,FAKS.VSKIDRBK().KRAJ().KODISO)}
         {IF: (FAKS.T().EXPORT='T' | FAKS.T().UE='T') & +FAKS.VSKIDRBK().BANK().SWIFT}
            {<1}{<{lmt}}{FONT: 'T8GB'}{exec('tr','tlumaczenia','1000114')+' '+FAKS.VSKIDRBK().BANK().SWIFT}
         {FI}
      {FI}
   {FI}
   {ENTIRE-}
{COMMENT}   informacje dodatkowe pod dokumentem                        {COMMENT-}
   {FONT: exec('font','param_wydr','inf_dod')}
   {FOR: S_GD}
   {PREFIX: 'D'}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {SUBSTITUTE: 'inf_dod'}
   {OD}
{COMMENT}   podmioty                                                 {COMMENT-}
   {SUBSTITUTE: 'podmioty'}
   {ENTIRE}
{COMMENT}   tekst dla faktury uproszczonej                           {COMMENT-}
   {FONT: exec('font','param_wydr','fakupr_txt')}
   {IF: (FAKS.T().UE='T' & FAKS.DO_UE='T') | ndvat='O' }
       {LINE}
       {<{lmt+1}}{
       {? FAKS.T().UE='T' & FAKS.DO_UE='T'
       || Text:=exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000142'))+' ';
          Text+=exec('tr','tlumaczenia','1000143')
       |? ndvat='O'
       || Text:=exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000144'))
       || Text:=''
       ?};
       max_T8:=charleft;
       STR.split(Text)
       ;~~}
       {WHILE: +(Text:=STR.line(max_T8-4-2))}
       {DO}
          {IF: +Text>=(max_T8-4-8)}
             {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-5}Text}
          {ELSE}
             {<{lmt+1}}{Text}
          {FI}
       {OD}
   {FI}
{COMMENT}   podstawa zwolnienia z podatku                               {COMMENT-}
   {FONT: exec('font','param_wydr','zw_pod')}
   {<1}{
   Text:='';
   {? FAKS.SZ='S'
   || FAKSPOLA.index('UNIK');
      FAKSPOLA.prefix(FAKS.ref());
      {? FAKSPOLA.first()
      || _sep:='';
         {? +FAKSPOLA.PZW_PRZE || Text+=FAKSPOLA.PZW_PRZE; _sep:='\n' ?};
         {? +FAKSPOLA.PZW_DUE || Text+=_sep+FAKSPOLA.PZW_DUE; _sep:='\n' ?};
         {? +FAKSPOLA.PZW_INNA || Text+=_sep+FAKSPOLA.PZW_INNA; _sep:='\n' ?};
         {?  FAKSPOLA.SAMFAK='T' || Text+=_sep+exec('tr','tlumaczenia','1000161'); _sep:='\n' ?};
         {?  FAKSPOLA.MK='T'     || Text+=_sep+exec('tr','tlumaczenia','1000231'); _sep:='\n' ?};
         {?  FAKSPOLA.USL_TUR='T'|| Text+=_sep+exec('tr','tlumaczenia','1000232'); _sep:='\n' ?};
         {?  FAKSPOLA.UDS='T'    || Text+=_sep+FAKSPOLA.UDS_OPIS; _sep:='\n' ?}
      ?}
   ?};
   max_T8:=charleft;
   STR.split(Text);
   ~~}
   {IF: +Text}{LINE}{FI}
   {WHILE: +(Text:=STR.line(max_T8-4-2))}
   {DO}
      {IF: +Text>=(max_T8-4-8)}
         {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-5}Text}
      {ELSE}
         {<{lmt+1}}{Text}
      {FI}
   {OD}
{COMMENT}   przyczyna korekty                                        {COMMENT-}
   {FONT: exec('font','param_wydr','kor_przyczyna')}
   {IF: FAKS.TZP<>'' & ~loop.kz}
      {<1}{COLOR: color_gw}{exec('tr','tlumaczenia','3000111')}
      {<1}{charleft()*'─'}
      {<1}{COLOR: color_bw}{FAKS.TZP}
   {FI}
   {ENTIRE-}
{COMMENT}   opis do korekty wg tlumaczen systemu                        {COMMENT-}
   {FONT: exec('font','param_wydr','opis_wg_tlu')}
   {ok:=0;~~}
   {WHILE: ok+=1;ok<=9}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {<{lmt+1}}{
      Text:=exec('tr','tlumaczenia','200020'+$ok,'N');
      max_T8:=charleft;
      STR.split(Text)
      ;~~}
      {WHILE: +(Text:=STR.line(max_T8-4-2))}
      {DO}
         {IF: +Text>=(max_T8-4-8)}
            {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-5}Text}
         {ELSE}
            {<{lmt+1}}{Text}
         {FI}
      {OD}
   {OD}
{COMMENT}   uwagi                                                    {COMMENT-}
   {FONT: exec('font','param_wydr','uwagi')}
   { __memo:=FAKS.memo_get('r','UWAGI'); text:='';~~}
   {IF: __memo.is_open}
      {WHILE: text:=fread(__memo); text<>'\n'}
      {DO}
         {FIRST}{LINE}{FIRST-}
         {<{lmt+1}}{
         max_T8:=charleft-(lmt+8);
         STR.split(text);
         Text:='';
         sep:=0
         ;~~}
         {WHILE: STR.next()}
         {DO}
            { word:=STR.get_word(); sep+=1;~~}
            {IF: +Text+(+word)>=(max_T8-4-8)}
               {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-8}Text}
               { Text:=word; sep:=1;~~}
            {ELSE}
               { Text+={? sep>1 || ' ' || '' ?}+word;~~}
            {FI}
         {OD}
         {IF: +Text}
            {<{lmt+1}}{Text}
         {FI}
      {OD}
      {CENTER}
   {FI}
   { VAR_DEL.delete('__memo','text','Text');~~}
   {ENTIRE}
{COMMENT}   podpisujacy                                              {COMMENT-}
   {FONT: exec('font','param_wydr','podpisy')}
   {<1}{
   max_T8:=charleft;
   _p100230:=exec('get','#params',100230,2);
   {? var_pres('STR1')>=100 || obj_del(STR1) ?};
   STR1:=obj_new(@.CLASS.STRING);
   Text:={? _p100230='O' | _p100230='N' || exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000145')) || '' ?};
   Text1:={? _p100230='O' | _p100230='S' || exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000146')) || '' ?};
   STR.split(Text);
   STR1.split(Text1);
   ~~}
   {WHILE: _a:=+(Text:=STR.line(((max_T8-4)/2)$0-30)); _b:=+(Text1:=STR1.line(((max_T8-4)/2)$0-30)); _a | _b}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {IF: +Text | +Text1}
         {IF: +Text}{<{lmt+1}Text}{FI}{IF: +Text1}{<{((max_T8-4)/2)$0+20}Text1}{FI}
      {FI}
   {OD}
{COMMENT}   upowaznienie                                             {COMMENT-}
   {FONT: exec('font','param_wydr','upowaznienie')}
   {_p100230:=exec('get','#params',100230,2);
   _os:=form(exec('kh_osob_default','kontrahent',KH.ref));
   USERS.cntx_psh;
   USERS.index('USR_KKOD');
   USERS.prefix;
   Text:={? _p100230='O' | _p100230='N' || {? +_os || _os || 20*'.' ?} || '' ?};
   Text1:={? _p100230='O' | _p100230='S' || {? USERS.find_key(FAKS.USER,FAKS.USER) & +USERS.DANE || USERS.DANE || 20*'.' ?} || '' ?};
   USERS.cntx_pop;
   STR.split(Text);
   STR1.split(Text1)
   ;~~}
   {IF: +Text | +Text1}{LINE}{FI}
   {WHILE: _a:=+(Text:=STR.line(((max_T8-4)/2)$0-30)); _b:=+(Text1:=STR1.line(((max_T8-4)/2)$0-30)); _a | _b}
   {DO}
      {IF: +Text | +Text1}
         {IF: +Text}{<{lmt+1}Text}{FI}{IF: +Text1}{<{((max_T8-4)/2)$0+20}Text1}{FI}
      {FI}
   {OD}
   {ENTIRE-}
   {CENTER}
   { PAR_WYDR.HEAD:=head;~~}
   {HEADER}{HEADER-}
   { duplex:=page%*2=1;~~}
   {IF: lineleft()>0}{PAGE}{FI}
   {IF: BEER.SZ='S' & exec('get','#params',2124,2,OPERATOR.USER)='T' & duplex=1}
      {duplex:=2;~~}
      {PAGE}
      {duplex:=0;~~}
   {FI}
{OD}
{MACRO-}