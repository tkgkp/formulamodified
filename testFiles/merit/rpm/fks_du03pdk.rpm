:!UTF-8
{TITLE: Korekta informacji VAT-UE}
{PRINTER: 'port_std',,,,,,,,,,,,1,
   PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,,1}
{BEGIN:
   sd:=obj_new(12); nd:=obj_new(12); kd:=obj_new(12); td:=obj_new(12);
   sn:=obj_new(12); nn:=obj_new(12); kn:=obj_new(12); tn:=obj_new(12);
   su:=obj_new(12); nu:=obj_new(12); ku:=obj_new(12);
   kl:='0:0:0,60:100:200'; bl:='0:0:0,255:255:255'; ks:='0:0:0,175:175:175';
   ko:='0:0:0,225:225:225'; l:=-1; STR.split(XINFO.NAZ+', '+XINFO.REGON); {! |? l+=1; STR.line(71); STR.next() !};
   us:=-1; STR.split(XINFO.URZAD().NU+', '+XINFO.URZAD().UK+' '+XINFO.URZAD().MU+', '+XINFO.URZAD().UU);
   {! |? us+=1; STR.line(71); STR.next() !};
   i:=j:=ld:=0; fc:=fd:=fe:='';
   NIPY.index('SNIP_F'); NIPY.prefix(REF.S_FIRMA,'PL');
   nipuelic:={? NIPY.first() || 2-NIPY.SNIP || XINFO.NIP ?}
}
{END:
   VAR_DEL.delete('sd','nd','kd','td','sn','nn','kn','tn','su','nu','ku');
   VAR_DEL.delete('nipuelic','kl','bl','ks','ko','i','j','ld','l','us','fc','fd','fe')
}
{COMMENT}
gr - tekst pogrubiony dla poszczególnych pozycji sprawozdania
zw - tekst zwykły dla poszczególnych pozycji sprawozdania
tyt - tytuł sprawozdania
ptyt - podtytuł sprawozdania
ppkt - podpunkt sprawozdania np. E.1.
op - tytuł dla tekstu wolnego (objaśnienia lub pouczenia)
{COMMENT-}
{DEFINEFONT: 'gr=Arial,110,r,8'}
{DEFINEFONT: 'tyt=Arial,120,f,8'}
{DEFINEFONT: 'ptyt=Arial,80,m,8'}
{DEFINEFONT: 'zw=Arial,100,q,8'}
{DEFINEFONT: 'zwn=Arial,120,q,8'}
{DEFINEFONT: 'ppkt=Arial,80,e,8'}
{DEFINEFONT: 'op=Arial,110,f,8'}
{SPACE: 'd'}{FONT: 'q'}
{  VAT_POZ.index('VAT_POZ'); VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK C');
   ld:=VAT_POZ.size();
   {? VAT_POZ.first || fc:=1+(11-VAT_POZ.LP) ?};
   VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK D');
   _v:=VAT_POZ.size();
   {? VAT_POZ.first || fd:=1+(11-VAT_POZ.LP) ?};
   {? _v>ld || ld:=_v ?};
   VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK E');
   _v:=VAT_POZ.size();
   {? VAT_POZ.first || fe:=1+(11-VAT_POZ.LP) ?};
   {? _v>ld || ld:=_v ?};
   ld:=ceil(ld/12); ~~}
{WHILE: j<ld}
{DO}
   {  {! i:=1..12
      |! sd[i]:=nd[i]:=td[i]:=sn[i]:=nn[i]:=tn[i]:=su[i]:=nu[i]:='';
         kd[i]:=kn[i]:=ku[i]:=0
      !};
      i:=1; j+=1; ~~}
   {FOR: VAT_POZ}
   {INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK C. '+{? #fc || $j || form((j),-2,0,'9.') ?}+' '}
   {DO}
      {  kd[i]:=VAT_POZ.NETTO$0;
         {? kd[i]
         || nd[i]:=VAT_POZ.OP;  td[i]:=VAT_POZ.Z;
            {? exec('kod_pl','slo_slu',2+nd[i])
            || sd[i]:=2+nd[i]; nd[i]:=2-nd[i]
            ?}
         ?};
         i+=1;
         ~~}
   {OD}
   { i:=1; ~~}
   {FOR: VAT_POZ}
   {INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK D. '+{? #fd || $j || form((j),-2,0,'9.') ?}+' '}
   {DO}
      {  kn[i]:=VAT_POZ.NETTO$0;
         {? kn[i]
         || nn[i]:=VAT_POZ.OP;  tn[i]:=VAT_POZ.Z;
            {? exec('kod_pl','slo_slu',2+nn[i])
            || sn[i]:=2+nn[i]; nn[i]:=2-nn[i]
            ?}
         ?};
         i+=1;
         ~~}
   {OD}
   { i:=1; ~~}
   {FOR: VAT_POZ}
   {INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK E. '+{? #fe || $j || form((j),-2,0,'9.') ?}+' '}
   {DO}
      {  ku[i]:=VAT_POZ.NETTO$0;
         {? ku[i]
         || nu[i]:=VAT_POZ.OP;
            {? exec('kod_pl','slo_slu',2+nu[i])
            || su[i]:=2+nu[i]; nu[i]:=2-nu[i]
            ?}
         ?};
         i+=1;
         ~~}
   {OD}
   {DIRECT}{<1}{REP: '{INCLUDE: fks_du03pdk1.rpi}'}{DIRECT-}
   {DIRECT}{<1}{REP: '{INCLUDE: fks_du03pdk2.rpi}'}{DIRECT-}
{OD}