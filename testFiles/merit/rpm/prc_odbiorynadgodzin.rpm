:!UTF-8
{TITLE: Odbiór nadgodzin w danym okresie}
{PRINTER: exec('prt','param_wydr','v',KST),,,,,'M','C',,,,,,1,
          PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   VAR_DEL.delete('par','prn1','lmt','tresc','okr_do','okr_od');

   _TAB:=exec('tab_prac','!prc_czp_wydr');
   {? _TAB.first()
   || tresc:='odbior';
      PAR_WYDR.TITLE:='';

      par:=obj_new(5);
      par[1]:=obj_new(@.CLASS.PRINT,5);
      par[1].add("par[3]+=1",5,'Lp.'@,1,,,,,',,\'9.\'');
      par[1].add("$R_WYK.DO",16,' Data odbioru'@);
      par[1].add("$R_WYK.DN",16,'Data nadgodzin'@);
      par[1].add("form(R_WYK.G)",16,'Odebrane godziny'@);
      par[1].add("R_WYK.R().RT",25,'Typ nadgodzin'@);
      par[1].s_frame();

      prn1:='par[1]';
      okr_do:=okr_od:=date();
      lmt:=par[3]:=par[4]:=par[5]:=0
   ?};
   params_set('P',_TAB)
}
{END:
   VAR_DEL.delete('par','prn1','lmt','tresc','okr_do','okr_od')
}
{EXIT: ~params_get().P.first()}
{COMMENT}OLD: w_codbio.rpm{COMMENT-}
{COMMENT}OLD: skid_pw.rpi{COMMENT-}
{COMMENT}OLD: std_info.rpi{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}
==============================================================================

   K O N F I G U R A C J A   -   N A G ¥ · W E K,   S T O P K A

{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'f'}
{SPACE: 'B'}
{<1>{charleft()}'ODBIÓR NADGODZIN ZA OKRES OD: %1 DO: %2'@[$okr_od,$okr_do]}
{FONT: '@'}
{ par[1].ini_head(); ~~}
{REP: par[1].fhbar(lmt)}
{REP: par[1].h_line(lmt)}
{HEADER-}
{FOOTER: 0}
{REP: par[1].lbar(lmt)}
{FOOTER-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}
==============================================================================

   M A K R O D E F I N I C J E

{COMMENT-}
{MACRO: tresc}
{ENTIRE}
{FOR: 'R_WYK'}
{INDEX: 'R_WYKDO'}
{FROM: P.ref(),okr_od}
{TO: P.ref(),okr_do}
{DO}
   {FIRST}
   {  par[5]:=1; par[3]:=0; ~~}
   {SPACE: 'B'}
   {FONT: '@'}
{REP: par[1].lbar(lmt)}
   {FONT: 'n'}
   {<{lmt+1}} {par[4]+=1}.  {P.OSOBA().NAZWISKO} {OSOBA.PIERWSZE} {OSOBA.DRUGIE}   {'(%1 %2)'['Nr teczki'@,|P.T]}
   {FONT: '@'}
   {FIRST-}
   {IF: par[5]}
      {  par[5]:=0; ~~}
      {REP: par[1].fhbar(lmt)}
   {ELSE}
      {REP: par[1].fcbar(lmt)}
   {FI}
   { par[1].ini_line(); ~~}
   {REP: par[1].fline(lmt)}
{OD}
{ENTIRE-}
{MACRO-}
{COMMENT}
==============================================================================

   Z A W A R T O Ł ╝   W Y D R U K U

{COMMENT-}
{IF:  VAR_EDIT.win_edit('PRDN_DAT');
      VAR_EDIT.ROK:=date()~1;
      VAR_EDIT.MSC:=date()~2;
      VAR_EDIT.efld_opt('PRDN_DAT','mark=1',,'ROK');
      VAR_EDIT.efld_opt('PRDN_DAT','mark=1',,'MSC');
      ~VAR_EDIT.edit(
         "  _result:=__CHK.record(VAR_EDIT,,'ROK','MSC');
            {? _result='' & (VAR_EDIT.MSC<1 | VAR_EDIT.MSC>12)
            || FUN.emsg('Proszę podać porawną wartość w polu \"Miesiąc\".'@);
               _result:='MSC'
            ?};
            _result
         "
      )
}
   {EXIT}
{FI}
{SPACE: 'B'}
{ lmt:=int((charleft()-par[1].width())/2);
   okr_od:=date(VAR_EDIT.ROK,VAR_EDIT.MSC,1);
   okr_do:=date(VAR_EDIT.ROK,VAR_EDIT.MSC,0); ~~
}
{FOR: params_get().P}
{DO}
   {IF: P.seek(params_get().P.SQL,,1)}
      {SUBSTITUTE: tresc}
   {FI}
{OD}