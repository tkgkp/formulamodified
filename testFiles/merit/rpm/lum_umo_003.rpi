:!UTF-8
{MACRO:'druk'}
{
    w[1] := w[2] := w[3] := w[4] := w[5] := w[6] := '';
    s[1] := s[2] := s[3] := 0
;~~}
{FOR: POS}
{INDEX:'MIA'}
{DO}
   {
      {? spr_mia='' | spr_mia<>POS.MIA().NAZ || nrpos:=0 ?}
   ;~~}
   {IF: (~-POS.UL().MIA().NAZ*~-pref_miasto>0 | pref_miasto='')
      & (~-POS.UL().REJO().NAZ*~-pref_rejon>0 | pref_rejon='')
      & (~-POS.UL().UL*~-pref_ulica>0 | pref_ulica='')}
      {IF:nrpos<=0}
      {
       spr_mia:=POS.MIA().NAZ;
       lp+=1;
       nrpos:=1;
       w[1] := lp;
       w[2] := POS.MIA().NAZ;
       w[3] := POS.UL().REJO().NAZ;
       w[4] := POS.UL().UL;
       w[5] := POS.NR;
       w[6] := POS.KH().KOD
      ;~~}
      {ELSE}
      {
       w[1] := '';
       w[2] := {? var_pres('tryb')=1 & tryb=1 || POS.MIA().NAZ || '' ?};
       w[3] := POS.UL().REJO().NAZ;
       w[4] := POS.UL().UL;
       w[5] := POS.NR;
       w[6] := POS.KH().KOD;~~}
      {FI}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{OD}
{MACRO-}
