:!UTF-8
{TITLE: Bilans przekształcenia }
{PRINTER: FINFO.SZ_PRN,,,,, 'i', 'c',,,, 1,,1,5,5,5,5 }
{BEGIN:  __ramki:='graf';
         typ:=' ';  grupa:=' '; opcja:='';
         SRST.cntx_psh(); SRSR.cntx_psh();
         TAM.cntx_psh();
         TAM.index('KST');
         exec('ster_zkst','fst_kst');
         lp:=0;
         total1:=total2:='';
         kolumny:=15; lastkol:=i:=k:=0;
         kol:=obj_new(kolumny);
         szer:=obj_new(kolumny);
         war:=obj_new(kolumny);
         swar:=obj_new(kolumny);
         sumuj:=obj_new(kolumny);
         czysumuj:=obj_new(kolumny);
         opi1:=obj_new(kolumny);
         opi2:=obj_new(kolumny);
         tytul:=obj_new(kolumny) }
{END:    {? var_pres('__ramki') = type_of('string') || &A1; &B1; &C1; &D1; &E1; &F1; &G1; &H1; &I1; &J1; &K1; &A2; &B2; &C2; &D2; &E2; &F2; &G2; &H2; &I2; &J2; &K2; &A3; &B3; &C3; &D3; &E3; &F3; &G3; &H3; &I3; &J3; &K3; &A4; &B4; &C4; &D4; &E4; &F4; &G4; &H4; &I4; &J4; &K4 ?};
         TAM.cntx_pop();
         SRST.cntx_pop(); SRSR.cntx_pop();
         obj_del(kol);   obj_del(szer);     obj_del(war);     obj_del(swar);
         obj_del(sumuj); obj_del(czysumuj);
         obj_del(opi1);  obj_del(opi2);     obj_del(tytul);
         &total1; &total2;
         &lastkol;
         &grupa;
         &kolumny;
         &typ; &opcja; &i; &k; &lp;
         undefine() }
{EXIT:
   {? SSTALE.AR().ZK<>'T'
   || FUN.emsg('W bieżącym roku nie przeprowadzono zmiany klasyfikacji.'@);
      1
   || 0
   ?}
}
{INCLUDE: fst_ramki.rpi}
{COMMENT}
(c) 1997 Macrologic
==============================================================================
    system: E S T R A
==============================================================================

 Data utworzenia pliku   : 2001-04-05 [bla] Bogdan Lawreszuk
 Ostatnie zmiany w pliku : 2001-04-05 [bla] Bogdan Lawreszuk
            +----------------------------------------------------------------+
  Zawartosc | Wydruk bilansu przeksztalcenia wartosci srodkow w wyniku       |
            | zmiany klasyfikacji srodkow trwalych.                          |
            +----------------------------------------------------------------+

==============================================================================
{COMMENT-}
{EXIT:
   EDIT_ES.win_edit('KST_BIL');
   EDIT_ES.KST_TOR:='T';
   EDIT_ES.OLD_KST:='T';
   {? EDIT_ES.edit()
   || lastkol:=9;
      szer[1]:=15;
      szer[2]:=15;
      szer[3]:=15;
      szer[4]:=15;
      szer[5]:=15;
      szer[6]:=15;
      szer[7]:=15;
      szer[8]:=15;
      kol[1]:=1;
      {! i:=2..lastkol |!  kol[i]:=kol[i-1]+szer[i-1] !};
      {! i:=1..lastkol |! sumuj[i]:=czysumuj[i]:=0 !};
      opi1[1]:='Wartość';
      opi2[1]:='BZ '+$(STER.NKST().AR-1);
      opi1[2]:='Wartość';
      opi2[2]:='BO '+$STER.NKST().AR;
      opi1[3]:='Umorzenie';
      opi2[3]:='BZ '+$(STER.NKST().AR-1);
      opi1[4]:='Umorzenie';
      opi2[4]:='BO '+$STER.NKST().AR;
      opi1[5]:='Wartość';
      opi2[5]:='BZ '+$(STER.NKST().AR-1);
      opi1[6]:='Wartość';
      opi2[6]:='BO '+$STER.NKST().AR;
      opi1[7]:='Umorzenie';
      opi2[7]:='BZ '+$(STER.NKST().AR-1);
      opi1[8]:='Umorzenie';
      opi2[8]:='BO '+$STER.NKST().AR;
      tytul[2]:='Z M I A N A    W A R T O Ś C I   I    U M O R Z E N I A    Ś R O D K Ó W    T R W A Ł Y C H';
      tytul[1]:='Z M I A N A   K L A S Y F I K A C J I   Ś R O D K Ó W   T R W A Ł Y C H   N A   D Z I E Ń : '+date(SSTALE.AO().RES,1,1)$6;
      war[1]:=('swar[1]');
      war[2]:=('swar[2]');
      war[3]:=('swar[3]');
      war[4]:=('swar[4]');
      war[5]:=('swar[5]');
      war[6]:=('swar[6]');
      war[7]:=('swar[7]');
      war[8]:=('swar[8]');
      war[9]:=('swar[8]');
      0
   || "# koniec #"; 1
   ?}
}
{HEADER}
{ A1 }{ (kol[lastkol]-2)*J1 }{ B1 }
{ K1 } { XINFO.NAZ+{?OPERATOR.DEPT<>0||' < jedn. ks. : '+OPERATOR.DEPT().OD+' >'||''?} } {>{kol[lastkol]-5} 'dn. '+form(date())+' Strona '+form(page()) } {<{kol[lastkol]} K1 }
{ H1 }{ (kol[lastkol]-2)*J1 }{ F1 }
{ K1 }{<{kol[1]}>{kol[lastkol]} tytul[1]}{<{kol[lastkol]} K1 }
{ K1 }{<{kol[1]}>{kol[lastkol]} tytul[2]}{>{kol[lastkol]} K1 }
{ k:=1; ~~}
{H1}{WHILE:k<lastkol}{DO}{(kol[k+1]-kol[k]-1)*J1}{<{kol[k+1]}}{IF:k=lastkol-1}{F1}{ELIF:k=4}{E1}{ELSE}{J1}{FI}{k+=1;~~}{OD}
{K1}{' Klasyfikacja '+STER.ZKST().KST}{<{kol[5]}K1}{' Klasyfikacja '+STER.NKST().KST}{<{kol[lastkol]}K1}
{ k:=1; ~~}
{H1}{WHILE:k<lastkol}{DO}{(kol[k+1]-kol[k]-1)*J1}{<{kol[k+1]}}{IF:k=lastkol-1}{F1}{ELIF:k=4}{I1}{ELSE}{E1}{FI}{k+=1;~~}{OD}
{ k:=1; ~~}
{K1}{WHILE:k<lastkol}{DO}{<{kol[k]}>{kol[k+1]}opi1[k]}{<{kol[k+1]} K1 }{k+=1;~~}{OD}
{ k:=1; ~~}
{K1}{WHILE:k<lastkol}{DO}{<{kol[k]}>{kol[k+1]}opi2[k]}{<{kol[k+1]} K1 }{k+=1;~~}{OD}
{HEADER-}
{FOOTER:0}
{ i:=1; ~~}
{D1}{WHILE:i<lastkol}{DO}{(kol[i+1]-kol[i]-1)*J1}{<{kol[i+1]}}{IF:i=lastkol-1}{C1}{ELSE}{G1}{FI}{i+=1;~~}{OD}
{FOOTER-}
{MACRO:'suma'}
{ENTIRE}
{ i:=1; ~~}
{H1}{WHILE:i<lastkol}{DO}{(kol[i+1]-kol[i]-1)*J1}{<{kol[i+1]}}{IF:i=lastkol-1}{F1}{ELIF:i=4}{I1}{ELSE}{G1}{FI}{i+=1;~~}{OD}
{ o}
{ i:=1; ~~}
{H1}{WHILE:i<lastkol}{DO}{(kol[i+1]-kol[i]-1)*J1}{<{kol[i+1]}}{IF:i=lastkol-1}{F1}{ELIF:i=4}{I1}{ELSE}{E1}{FI}{i+=1;~~}{OD}
{<{kol[1]}K1}{>{kol[2]-2},2sum('WAR1')}{<{kol[2]}K1} {>{kol[3]-2},2 sum('WAR2')
}{<{kol[3]}K1}{>{kol[4]-2},2 sum('WAR3')}{<{kol[4]}K1} {>{kol[5]-2},2 sum('WAR4')
}{<{kol[5]}K1}{>{kol[6]-2},2 sum('WAR5')}{<{kol[6]}K1} {>{kol[7]-2},2 sum('WAR6')
}{<{kol[7]}K1}{>{kol[8]-2},2 sum('WAR7')}{<{kol[8]}K1} {>{kol[9]-2},2 sum('WAR8')}{<{kol[9]}K1}
{ENTIRE-}
{MACRO-}
{MACRO:'oblicz'}
{ SRST.index('PODAT');
  SRST.prefix();
  SRSR.prefix();
  SRDO.SRSR();
  {? SRST.find_key(SRSR.ref(),SSTALE.AO().RES-1,12) || _t_sgr:=SRST.GR().GR || __t_sgr:='' ?};
  {? SRSR.seek(SRDO.SRSR) & SRSR.DZ<date(SSTALE.AO().RES,1,1) & SRST.find_key(SRSR.ref,SSTALE.AO().RES,1)
  || {? EDIT_ES.OLD_KST='N'
     || swar[1]:={? EDIT_ES.KST_TOR='T' || SRST.WARP || SRST.WARF ?};
        swar[3]:={? EDIT_ES.KST_TOR='T' || SRST.UMOP || SRST.UMOF ?};

        {? _t_sgr=SRST.GR().GR
        || swar[2]:=swar[1]; swar[4]:=swar[3];
           swar[5]:=swar[1]; swar[6]:=swar[2];
           swar[7]:=swar[3]; swar[8]:=swar[4]
        || swar[6]:=swar[1]; swar[8]:=swar[3]
        ?}
     || swar[6]:={? EDIT_ES.KST_TOR='T' || SRST.WARP || SRST.WARF ?};
        swar[8]:={? EDIT_ES.KST_TOR='T' || SRST.UMOP || SRST.UMOF ?};
        {? _t_sgr=SRST.GR().GR
        || swar[5]:=swar[6]; swar[7]:=swar[8];
           swar[1]:=swar[5]; swar[2]:=swar[6];
           swar[3]:=swar[7]; swar[4]:=swar[8]
        || swar[1]:=swar[6]; swar[3]:=swar[8]
        ?}
     ?}
  ?};
~~}
{MACRO-}
{IF: (EDIT_ES.OLD_KST='T')}
{FOR: SRDO}{INDEX: 'AUTO3'} {PREFIX: SSTALE.AR,SSTALE.AO,FINFO.KST_MT,'T'}
{DO}
{ENTIRE}
{ {! l:=1..lastkol |! swar[l]:=0 !}; ~~}
{SUBSTITUTE:'oblicz'}
{ADD: WAR1; #; swar[1] }
{ADD: WAR2; #; swar[2] }
{ADD: WAR3; #; swar[3] }
{ADD: WAR4; #; swar[4] }
{ADD: WAR5; #; swar[5] }
{ADD: WAR6; #; swar[6] }
{ADD: WAR7; #; swar[7] }
{ADD: WAR8; #; swar[8] }
{ENTIRE-}
{TOTAL:exec('t_sgr','fst'); form((K1+' Grupa: '+__t_sgr),(kol[5]-kol[1]))+form((K1+' na: '+SRDO.GR().GR),(kol[lastkol]-kol[5]))+K1}
{ o:=grp_fld(); ~~}
{SUBSTITUTE:'suma'}
{TOTAL:form((K1+' Łącznie grupa: '+SRST.GR().GR),(kol[5]-kol[1]))+form(K1,(kol[lastkol]-kol[5]))+K1}
{ o:=grp_fld(); ~~}
{SUBSTITUTE:'suma'}
{TOTAL}
{ o:=form((K1+' Ogółem klasyfikacja '+STER.ZKST().KST),(kol[5]-kol[1]))
    +form((K1+' Ogółem klasyfikacja '+STER.NKST().KST),(kol[lastkol]-kol[5]))+K1; ~~}
{SUBSTITUTE:'suma'}
{OD}
{ELSE}
{FOR: SRDO}{INDEX: 'AUTO3' } {PREFIX: SSTALE.AR,SSTALE.AO,FINFO.KST_MT,'T'}
{DO}
{ENTIRE}
{ {! l:=1..lastkol |! swar[l]:=0 !}; ~~}
{SUBSTITUTE:'oblicz'}
{ADD: WAR1; #; swar[1] }
{ADD: WAR2; #; swar[2] }
{ADD: WAR3; #; swar[3] }
{ADD: WAR4; #; swar[4] }
{ADD: WAR5; #; swar[5] }
{ADD: WAR6; #; swar[6] }
{ADD: WAR7; #; swar[7] }
{ADD: WAR8; #; swar[8] }
{ENTIRE-}
{TOTAL: exec('t_sgr','fst');form((K1+' Z grupy : '+__t_sgr),(kol[5]-kol[1]))+form((K1+' Grupa: '+SRDO.GR().GR),(kol[lastkol]-kol[5]))+K1}
{ o:=grp_fld(); ~~}
{SUBSTITUTE:'suma'}
{TOTAL:form(K1,(kol[5]-kol[1]))+form(K1+' Łącznie grupa: '+SRDO.GR().GR,(kol[lastkol]-kol[5]))+K1}
{ o:=grp_fld(); ~~}
{SUBSTITUTE:'suma'}
{TOTAL}
{ o:=form((K1+' Ogółem klasyfikacja '+STER.ZKST().KST),(kol[5]-kol[1]))
    +form((K1+' Ogółem klasyfikacja '+STER.NKST().KST),(kol[lastkol]-kol[5]))+K1; ~~}
{SUBSTITUTE:'suma'}
{OD}
{FI}
{COMMENT}
==============================================================================
      koniec pliku: fst_kst_bil.rpm
==============================================================================
1997 Macrologic Ltd. All rights reserved.
{COMMENT-}
