:!UTF-8
{prz:=PAR_WYDR.PAR1;
 stan_na:=PAR_WYDR.DPAR5;
 w[4]:=w[5]:=0;
 PAR_WYDR.PAR1+=1;
 tab_kol:=PAR_WYDR.PAR1+5;
 szer_kol[1]:={? PAR_WYDR.PAR3=2 || 45 || 100 ?};
 szer_kol[2]:={? PAR_WYDR.PAR3=2 || 51 || 0 ?};
 szer_kol[3]:={? PAR_WYDR.PAR3=2 || 10 || 0 ?};
 szer_kol[4]:={? PAR_WYDR.PAR3=2 || 10 || 0 ?};
 szer_kol[5]:=0;
 {! _a:=6..tab_kol
 |! szer_kol[_a]:=15
 !};
 p[1]:=2+szer_kol[1];
 {! _a:=2..tab_kol
 |! p[_a]:=p[_a-1]+szer_kol[_a]+1
 !};
 il:=p[tab_kol];
 per[1]:=PAR_WYDR.DPAR1;
 per[2]:=PAR_WYDR.DPAR2;
 per[3]:=PAR_WYDR.DPAR3;
 per[4]:=PAR_WYDR.DPAR4;
 WYDRUKIN.REJSYM:=''; ~~}
{COMMENT}-------------------------------------------------------------------------------{COMMENT-}
{MACRO: 'LINIA_D'}
{IF: ~rep_export()}
│{<1 {? STR.next() || STR.line(szer_kol[1]) || w[3] ?}
}{IF: PAR_WYDR.PAR3=2}{<{p[1]}'│'}{<{p[1]} w[1]
}{<{p[2]}'│'}{<{p[2]}>{p[3]} w[2]
}{<{p[3]}'│'}{<{p[3]}>{p[4]} OP.TZ
}{FI}{<{p[4]}'│'
}{ i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1}{DO}{IF: i<>1}{<{p[4+i]}'│'}{FI}{>{p[5+i]-1} form(q[i],,2,' ,')
}{ i+=1;~~}{OD}│
{ w[3]:='';vp:=0;~~}
{ELSE}
{TR}{TD}{w[3]}{IF: PAR_WYDR.PAR3=2}{TD}{w[1]}{TD}{w[2]}{TD}{OP.TZ}{FI}
{ i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1}{DO}{TD:;'right'}{form(q[i],,2,' ,')}{ i+=1;~~}{OD}
{vp:=0;~~}
{FI}
{MACRO-}
{MACRO: 'LINIA_K'}
{IF: ~rep_export()}
{WHILE: STR.next()}
{DO}
│{<1 STR.line(szer_kol[1])
}{IF: PAR_WYDR.PAR3=2}{<{p[1]}'│'
}{<{p[2]}'│'}{<{p[3]}'│'}{FI}{<{p[4]}'│'
}{ i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1}{DO}{IF: i<>1}{<{p[4+i]}'│'}{FI}{>{p[5+i]-1}
}{ i+=1;~~}{OD} │
{ w[3]:='';vp:=0;~~}
{OD}
{FI}
{MACRO-}
{MACRO: 'SUMA'}
{IF: ~rep_export()}
│{<2 {? STR.next() || STR.line(szer_kol[1]) || w[3] ?}
}{IF: PAR_WYDR.PAR3=2}{<{p[1]}'│'}{<{p[1]}>{p[2]} ''
}{<{p[2]}'│'}{<{p[2]}>{p[3]} ''
}{<{p[3]}'│'}{<{p[3]}>{p[4]} ''
}{FI}{<{p[4]}'│'
}{ i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1}{DO}{IF: i<>1}{i_saved:=i;~~}{<{p[4+i]}'│'}{i:=i_saved;~~}{FI}{>{p[5+i]-1} form(s[i],,2,' ,')
}{ i+=1;~~}{OD}│
{ w[3]:='';vp:=0;~~}
{FI}
{MACRO-}
{MACRO: 'LINIA1'}
{IF: ~rep_export()}
┌{ i:=1;~~}{WHILE: i<=tab_kol-1}{DO}{szer_kol[i]*'─'}{IF: PAR_WYDR.PAR3=1 & i<4}─{ELIF: i=5 & PAR_WYDR.PAR3=2}─{ELIF: ~(i=5 & PAR_WYDR.PAR3=1)}┬{ELSE}─{FI}{ i+=1;~~}{OD}{szer_kol[tab_kol]*'─'}┐
{FI}
{MACRO-}
{MACRO: 'LINIA2'}
{IF: ~rep_export()}
├{ i:=1;~~}{WHILE: i<=tab_kol-1}{DO}{szer_kol[i]*'─'}{IF: PAR_WYDR.PAR3=1 & i<4}─{ELIF: i=5 & PAR_WYDR.PAR3=2}─{ELIF: ~(i=5 & PAR_WYDR.PAR3=1)}┼{ELSE}─{FI}{ i+=1;~~
}{OD}{szer_kol[tab_kol]*'─'}┤
{FI}
{MACRO-}
{MACRO: 'LINIA3'}
{IF: ~rep_export()}
└{ i:=1;~~}{WHILE: i<=tab_kol-1}{DO}{szer_kol[i]*'─'}{IF: PAR_WYDR.PAR3=1 & i<4}─{ELIF: i=5 & PAR_WYDR.PAR3=2}─{ELIF: ~(i=5 & PAR_WYDR.PAR3=1)}┴{ELSE}─{FI}{ i+=1;~~
}{OD}{szer_kol[tab_kol]*'─'}┘
{FI}
{MACRO-}
{MACRO: 'CZOLO1'}
{PAR_WYDR.TITLE:='ZESTAWIENIE ODSETEK OD '@+{? wybor2='Z' || 'ZOBOWIĄZAŃ'@ || 'NALEŻNOŚCI'@ ?}+
                 ' WG DAT'+'  '+'STAN NA DZIEŃ: '+ $stan_na;~~}
{SUBSTITUTE: 'HEAD'}{FONT: 'T8G'}{SPACE: 'C'}
{LINE: 1}
{<1 'PARAMETRY WYDRUKU:'}
{IF: PAR_WYDR.PAR2=1}{<1'Dla wszystkich kontrahentów'@}{ELSE}{<1'Dla wybranych kontrahentów'}{FI}
{<1 'Maska konta: '+{? UNPAR.P1=1 || KONTO.K1 || 35+(KONTO.K2+35*'?') ?}}
{<1'Waluta:  '+SSTALE.WAL().KOD+' '+SSTALE.WAL().TR}
{<1 p_odd}
{SUBSTITUTE: 'LINIA1'}{FONT: 'T8GB'}
{IF: ~rep_export()}
│{<1>{p[1]} {? PAR_WYDR.PAR2=1 & ((KONTO.K1<>'' & KONTO.K1<>35*'?') | KONTO.K2<>'') || 'Konto' || 'Kontrahent' ?}
}{IF: PAR_WYDR.PAR3=2}{<{p[1]}'│'}{<{p[1]}>{p[2]}'Dokument'
}{<{p[2]}'│'}{<{p[2]}>{p[3]}'Data'
}{<{p[3]}'│'}{<{p[3]}>{p[4]}'Termin'
}{FI}{<{p[4]}'│'
}{ i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1-1}{DO}{IF: i<>1}{<{p[4+i]}'│'}{FI}{<{p[4+i]}>{p[5+i]} 'Stan na'
}{ i+=1;~~}{OD}{<{p[PAR_WYDR.PAR1+4]} '│'}{<{p[PAR_WYDR.PAR1+4]}>{p[PAR_WYDR.PAR1+5]}'Stan na'
}{>{p[PAR_WYDR.PAR1+5]} '│'}
│{<1>{p[1]}''
}{IF: PAR_WYDR.PAR3=2}{<{p[1]}'│'}{<{p[1]}>{p[2]}''
}{<{p[2]}'│'}{<{p[2]}>{p[3]}'otwarcia'
}{<{p[3]}'│'}{<{p[3]}>{p[4]}'zapłaty'
}{FI}{<{p[4]}'│'
}{i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1-1}{DO}{IF: i<>1}{<{p[4+i]}'│'}{FI}{<{p[4+i]}>{p[5+i]}per[i]
}{i+=1;~~}{OD}{<{p[PAR_WYDR.PAR1+4]} '│'}{<{p[PAR_WYDR.PAR1+4]}>{p[PAR_WYDR.PAR1+5]}PAR_WYDR.DPAR5
}{>{p[PAR_WYDR.PAR1+5]}'│'}
{ELSE}
{TABLE}
{TR}{TH}{{? PAR_WYDR.PAR2=1 & ((KONTO.K1<>'' & KONTO.K1<>35*'?') | KONTO.K2<>'') || 'Konto' || 'Kontrahent' ?}}
{IF: PAR_WYDR.PAR3=2}{TH}Dokument{TH}Data otwarcia{TH}Termin zapłaty
{FI}
{ i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1-1}{DO}{TH}{'Stan na '+$per[i]}{ i+=1;~~}{OD}{TH}{'Stan na '+$PAR_WYDR.DPAR5}
{FI}
{SUBSTITUTE: 'LINIA2'}{FONT: 'T8G'}{ vp:=1;~~}
{MACRO-}
{MACRO: 'CZOLO'}
{PAR_WYDR.TITLE:='ZESTAWIENIE ODSETEK OD '+{? wybor2='Z' || 'ZOBOWIĄZAŃ' || 'NALEŻNOŚCI' ?}+
                 ' WG DAT'+'  '+'STAN NA DZIEŃ: '+ $stan_na;~~}
{SUBSTITUTE: 'HEAD'}
{LINE: 1}{SPACE: 'C'}{FONT: 'T8GB'}
{SUBSTITUTE: 'LINIA1'}
│{<1>{p[1]} {? PAR_WYDR.PAR2=1 & ((KONTO.K1<>'' & KONTO.K1<>35*'?') | KONTO.K2<>'') || 'Konto' || 'Kontrahent' ?}
}{IF: PAR_WYDR.PAR3=2}{<{p[1]}'│'}{<{p[1]}>{p[2]}'Dokument'
}{<{p[2]}'│'}{<{p[2]}>{p[3]}'Data'
}{<{p[3]}'│'}{<{p[3]}>{p[4]}'Termin'
}{FI}{<{p[4]}'│'
}{ i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1-1}{DO}{IF: i<>1}{<{p[4+i]}'│'}{FI}{<{p[4+i]}>{p[5+i]} 'Stan na'
}{ i+=1;~~}{OD}{<{p[PAR_WYDR.PAR1+4]} '│'}{<{p[PAR_WYDR.PAR1+4]}>{p[PAR_WYDR.PAR1+5]}'Stan na'
}{>{p[PAR_WYDR.PAR1+5]} '│'}
│{<1>{p[1]}''
}{IF: PAR_WYDR.PAR3=2}{<{p[1]}'│'}{<{p[1]}>{p[2]}''
}{<{p[2]}'│'}{<{p[2]}>{p[3]}'otwarcia'
}{<{p[3]}'│'}{<{p[3]}>{p[4]}'zapłaty'
}{FI}{<{p[4]}'│'
}{i:=1;~~}{WHILE: i<=PAR_WYDR.PAR1-1}{DO}{IF: i<>1}{<{p[4+i]}'│'}{FI}{<{p[4+i]}>{p[5+i]}per[i]
}{i+=1;~~}{OD}{<{p[PAR_WYDR.PAR1+4]} '│'}{<{p[PAR_WYDR.PAR1+4]}>{p[PAR_WYDR.PAR1+5]}PAR_WYDR.DPAR5
}{>{p[PAR_WYDR.PAR1+5]}'│'}
{SUBSTITUTE: 'LINIA2'}{FONT: 'T8G'}{ vp:=1; ~~}
{MACRO-}
{'--------------------------------------------------------------------';~~}
{MACRO:'BODY_'}{ 'WYWOLYWANE W PETLI KH';~~}
{IF: STR.next() & licznik<>0}{SUBSTITUTE: 'LINIA_K'}{FI}
{  w[3]:=KH.KOD+' - '+KH.NAZ; STR.split(w[3]); licznik:=0;
   _typ_roz:={? wybor2='Z' || 'ZOB' || 'NAL' ?};
   OP.index(indtym);
   {? OPERATOR.DEPT
   || OP.prefix(_typ_roz,SSTALE.WAL,KH.ref,OPERATOR.DEPT,KONTO.K2)
   || OP.prefix(_typ_roz,SSTALE.WAL,KH.ref,KONTO.K2)
   ?};
   petla:=OP.first(); ~~}
{WHILE: petla}
{DO}
   { {? UNPAR.P1=1 & KONTO.K1<>'' || vk:=exec('mask','konto',OP.AN) || vk:=1 ?}; ~~}
   {IF: vk & PAR_WYDR.DPAR5>OP.TZ}
      {  druk:=0;
         ZAP_OP.cntx_psh;
         ZAP_OP.index('OP');
         ZAP_OP.prefix(OP.ref);
         {? ZAP_OP.first
         || {! |?
               {? ZAP_OP.DATA<=PAR_WYDR.DPAR5
               || druk:=1
              ?};
              ZAP_OP.next & druk=0
            !}
         ?};
         ZAP_OP.cntx_pop;~~}
      {IF: druk=1}
         { 'obroty na dzien podany w parametrach wejsciowych';
         own:=F.ROw(OP.ref, PAR_WYDR.DPAR5); oma:=F.ROm(OP.ref, PAR_WYDR.DPAR5); ~~}
         {IF: ((OP.TYP='ZOB' & wybor2='Z' & ((own=oma & own<>0) | oma<>own )) |
               (OP.TYP='NAL' & wybor2='N' & ((own=oma & own<>0) | oma<>own )))}
            {  w[1]:=OP.SYM;
               w[2]:=OP.DO;
               {! _i:=1..prz |!
                  q[_i]:=exec('odsetki','rozrach_ods',OP.ref,($('PAR_WYDR.DPAR'+$_i))())
               !};
               q[prz+1]:=exec('odsetki','rozrach_ods',OP.ref,PAR_WYDR.DPAR5);
               suma:=q[prz+1]; ~~}
            {IF: PAR_WYDR.PAR3=2 & suma$2<>0}
               { licznik+=1; ~~}
               {SUBSTITUTE: 'LINIA_D'}
               {  {! i:=1..(PAR_WYDR.PAR1+2)
               |! s[i]+=q[i]$2; q[i]:=0
               !}; ~~}
               {IF: +w[3]}
                  {SUBSTITUTE: 'LINIA_K'}
               {FI}
            {ELIF: PAR_WYDR.PAR3=1 & suma$2<>0}
               {  {! i:=1..(PAR_WYDR.PAR1+2)
               |! s[i]+=q[i]$2; q[i]:=0
               !}; ~~}
            {FI}
         {FI}
      {FI}
   {FI}
   { petla:=OP.next(); ~~}
{OD}{' Do  OP';~~}
{IF: (PAR_WYDR.PAR3=1 & s[PAR_WYDR.PAR1]$2<>0) | (PAR_WYDR.PAR3=2 & licznik>1)}
   {IF: STR.next() & licznik>0}{SUBSTITUTE: 'LINIA_K'}{FI}
   { w[3]:={?PAR_WYDR.PAR3=2||'Razem: '||''?}+{? PAR_WYDR.PAR3=2|| KH.SKR||KH.KOD+' - '+KH.NAZ?};~~}
   {IF: lineleft()<4 & lineleft<>0}{PAGE}{FI}
   {ENTIRE}
   {IF: ~vp}{SUBSTITUTE: 'LINIA2'}{FI}
   {SUBSTITUTE: 'SUMA'}
   {IF: +w[3]<>0 | STR.next()}
      {SUBSTITUTE: 'LINIA_K'}
      { w[3]:=''; ~~}
   {FI}
   {IF: PAR_WYDR.PAR3=2}
      {SUBSTITUTE: 'LINIA2'}
   {FI}
   {ENTIRE-}
{ELIF: PAR_WYDR.PAR3=2 & licznik=1 }
   {IF:  +w[3] | STR.next()}
      {SUBSTITUTE: 'LINIA_K'}
   {FI}
      {SUBSTITUTE: 'LINIA2'}
{FI}
{  {! i:=1..(PAR_WYDR.PAR1+2)
   |! t[i]+=s[i]; s[i]:=0
   !}; ~~}
{MACRO-}
{MACRO:'BODY'}
{  licznik:=0;
   {? OPERATOR.DEPT
   || OP.index('PRZEG_O'); OP.prefix(SSTALE.WAL,OPERATOR.DEPT,KONTO.K2)
   || OP.index('PRZEG');   OP.prefix(SSTALE.WAL,KONTO.K2)
   ?};
   petla:=OP.first(); ~~}
{WHILE: petla}
{DO}
   { {? UNPAR.P1=1|| vk:=exec('mask','konto',OP.AN) || vk:=1 ?}; ~~}
   {IF: vk & PAR_WYDR.DPAR5>OP.TZ}
      {  druk:=0;
         ZAP_OP.cntx_psh;
         ZAP_OP.index('OP');
         ZAP_OP.prefix(OP.ref);
         {? ZAP_OP.first
         || {! |?
               {? ZAP_OP.DATA<=PAR_WYDR.DPAR5 || druk:=1 ?};
               ZAP_OP.next & druk=0
            !}
         ?};
         ZAP_OP.cntx_pop; ~~}
      {IF: druk=1}
         { 'obroty na dzien podany w parametrach wejsciowych';
            own:=F.ROw(OP.ref, PAR_WYDR.DPAR5); oma:=F.ROm(OP.ref, PAR_WYDR.DPAR5); ~~}
         {IF: ((OP.TYP='ZOB' & wybor2='Z' & ((own=oma & own<>0) | oma<>own )) |
               (OP.TYP='NAL' & wybor2='N' & ((own=oma & own<>0) | oma<>own )))}
            {  w[1]:=OP.SYM;
               w[2]:=OP.DO;
               {! _i:=1..prz |!
                  q[_i]:=exec('odsetki','rozrach_ods',OP.ref,($('PAR_WYDR.DPAR'+$_i))())
               !};
               q[prz+1]:=exec('odsetki','rozrach_ods',OP.ref,PAR_WYDR.DPAR5);
               suma:=q[prz+1]; ~~}
            {IF: PAR_WYDR.PAR3=2 & suma$2<>0}
               {IF: OP.AN<>kan}
               {IF: g1>1}
                     {  w[3]:='Razem: '+kan; ~~}
                     {ENTIRE}
                     {SUBSTITUTE: 'LINIA2'}
                     {SUBSTITUTE: 'SUMA'}
                     {ENTIRE-}
               {FI}
                  {  w[3]:=OP.AN; kan:=OP.AN; kanc:=1; g1:=0; ~~}
                  {IF: pr>0}
                     {SUBSTITUTE: 'LINIA2'}
                  {FI}
                  {  {! i:=1..(PAR_WYDR.PAR1+2) |! t[i]+=s[i]; s[i]:=0 !}; ~~}
               {ELSE}
                  { kanc:=0;~~}
               {FI}
               { licznik+=1; g1+=1; pr:=1; ~~}
               {SUBSTITUTE: 'LINIA_D'}
               {  {! i:=1..(PAR_WYDR.PAR1+2)
                  |! s[i]+=q[i]$2; q[i]:=0
               !};  ~~}
               {IF: +w[3]}
                  {SUBSTITUTE: 'LINIA_K'}
               {FI}
            {ELIF: PAR_WYDR.PAR3=1 & s[PAR_WYDR.PAR1]$2<>0}
               {IF: OP.AN<>kan}
                  {  w[3]:=kan; g1:=1; ~~}
                  {ENTIRE}
                  {IF: pr>0}
                     {SUBSTITUTE: 'LINIA2'}
                  {FI}
                  {SUBSTITUTE: 'SUMA'}
                  {IF: +w[3]}
                     {SUBSTITUTE: 'LINIA_K'}
                  {FI}
                  {ENTIRE-}
               {  {! i:=1..(PAR_WYDR.PAR1+2) |! t[i]+=s[i]; s[i]:=0 !}; pr:=1; ~~}
               {FI}
            {FI}
            {IF: PAR_WYDR.PAR3=1 & kan<>OP.AN & suma>0}
            { kan:=OP.AN; ~~}
            {  {! i:=1..(PAR_WYDR.PAR1+2)
                  |! s[i]+=q[i]$2; q[i]:=0
               !};  ~~}
            {FI}
         {FI}
      {FI}
   {FI}
   {petla:=OP.next(); ~~}
{OD}{' Do  OP';~~}
{IF: (PAR_WYDR.PAR3=1 & s[PAR_WYDR.PAR1]$2<>0)}
   {  w[3]:=kan; ~~}
   {IF: lineleft()<4 & lineleft<>0}{PAGE}{FI}
   {ENTIRE}
   {SUBSTITUTE: 'LINIA2'}
   {SUBSTITUTE: 'SUMA'}
   {IF: +w[3]<>0}
      {SUBSTITUTE: 'LINIA_K'}
   {FI}
   {ENTIRE-}
{  {! i:=1..(PAR_WYDR.PAR1+2) |! t[i]+=s[i]; s[i]:=0 !}; ~~}
{ELIF: PAR_WYDR.PAR3=2}
   {IF: g1>1}
      {  w[3]:='Razem: '+kan; ~~}
      {ENTIRE}
      {SUBSTITUTE: 'LINIA2'}
      {SUBSTITUTE: 'SUMA'}
      {ENTIRE-}
   {FI}
   {  w[3]:=OP.AN; kan:=OP.AN; kanc:=1; g1:=0; ~~}
   {IF: pr>0}
      {SUBSTITUTE: 'LINIA2'}
   {FI}
   {  {! i:=1..(PAR_WYDR.PAR1+2) |! t[i]+=s[i]; s[i]:=0 !}; ~~}
{FI}
{MACRO-}
{FOOTER:0}
{ vp:=1; ~~}

{FOOTER-}
{'--------------------------------------------------------------------';~~}
{SUBSTITUTE: 'CZOLO1'}
{HEADER}
{SUBSTITUTE: 'CZOLO'}
{HEADER-}
{'--------------------------------------------------------------------';~~}
{IF: 1}
{FOOTER:0}
{SUBSTITUTE: 'LINIA3'}
{SUBSTITUTE: 'CHARFOOT'}
{ vp:=1; ~~}
{FOOTER-}
{'--------------------------------------------------------------------';~~}
{FI}
{IF: PAR_WYDR.PAR2=1}
   {IF: (KONTO.K1='' | KONTO.K1=35*'?') & KONTO.K2=''}
      {FOR: 'KH'}
      {INDEX: 'KOD'}
      {PREFIX: 2, WYDRUKIN.REJSYM}
      {DO}
         {SUBSTITUTE: 'BODY_'}
      {OD}{'  Do  KH';~~}
   {ELSE}
      {SUBSTITUTE: 'BODY'}
   {FI}
{ELIF: PAR_WYDR.PAR2=2}
   {FOR: 'KH'}
   {INDEX: 'KOD'}
   {PREFIX: 2, WYDRUKIN.REJSYM}
   {SELECT}
   {DO}
      {SUBSTITUTE: 'BODY_'}
   {OD}{'  Do  KH';~~}
{FI}
{IF: t[PAR_WYDR.PAR1]$2<>0}
{IF: STR.next() & licznik<>0}{SUBSTITUTE: 'LINIA_K'}{ELSE}{STR.split('');~~}{FI}
{  {? (KONTO.K1<>'' & KONTO.K1<>35*'?') | KONTO.K2<>''
   || w[3]:='Ogółem'
   || w[3]:='Ogółem wszyscy kontrahenci'
   ?};
 {! i:=1..(PAR_WYDR.PAR1)
        |! s[i]:=t[i]
        !};~~
}
{IF: PAR_WYDR.PAR3=1}{SUBSTITUTE: 'LINIA2'}{FI}
{SUBSTITUTE: 'SUMA'}
{FI}
{FOOTER}
{SUBSTITUTE: 'CHARFOOT'}
{~~}
{FOOTER-}
{SUBSTITUTE: 'LINIA3'}
{IF: ~rep_export()}
{<1>{il}'KONIEC WYDRUKU'}
{ELSE}
{TABLE-}
{FI}