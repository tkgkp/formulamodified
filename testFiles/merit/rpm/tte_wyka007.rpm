:!UTF-8
{TITLE:E. Zestawienie kwot wypracowanych}
{PRINTER: INFO.W_PRN,,,,,'E','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
      PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
  ZLGB.cntx_psh();
  ZLGD.cntx_psh();
  PRN:=obj_new(@.CLASS.PRINT,5);
  PRN.s_frame();

  __TAB:=tab_tmp(2,
     'P','INTEGER','Ref.do pracownika',
     'NAZWA','STRING[50]','Imie, nazwisko',
     'KWOTA','REAL','Wart.robocizny',
     'ILDNI','INTEGER','średnia dniówkowa'
  );
  ndx:=__TAB.ndx_tmp(,1,'NAZWA',,,'P',,);
  ndxzlgb1:=ZLGB.ndx_tmp(,1,
     'ZLGD','O',0,
     'P',,0,
     'ZLGD','DT',0,
     'ZLGD','ZMIANA',0
  );
  prn1:='PRN';
  tryb:=rep_export();
  waslbar:=0;
  dalej:=0;
  color:='';
  lm:=ll:=vp:=lmt:=rsep:=0
}
{END:
  ZLGB.cntx_pop();
  ZLGD.cntx_pop();
  __TAB.ndx_drop(ndx);
  ZLGB.ndx_drop(ndxzlgb1);
  obj_del(PRN);
  obj_del(__TAB);
  &dalej;
  &prn1;
  &color;
  &lm; &ll; &vp; &lmt; &rsep;
  &tryb
}
{COMMENT}
 Zestawienie godzin wypracowanych
 [MK] - 2002/11/28 - [7.62]
  Wywołanie: Wykonania produkcji -> Raporty -> Zestawienia
{COMMENT-}
  {INCLUDE: tte_wykx001.rpi}
{COMMENT}--Definicja wiersza wydruku godzin wypracowanych.--------------------{COMMENT-}
{
PRN.add("__TAB.NAZWA",30,'Pracownik'@);
PRN.add("form(__TAB.KWOTA,,2)",12,'Kwota'@,1);
PRN.add("form(__TAB.KWOTA/__TAB.ILDNI,,2)",12,'Średnia dniówka'@,1);
PRN.add("''",12,'Premia'@);
PAR_WYDR.TITLE:='ZESTAWIENIE KWOT WYPRACOWANYCH'@;~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T10'}{SPACE: 'B'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<{lmt+1} 'PARAMETRY WYDRUKU:'@}
{<{lmt+1}}{'Oddział %1'@[(ODDZ.index('KOD2'); ODDZ.prefix(ST.ODDZ,ST.ODDZ); {? ODDZ.first() || ODDZ.NAZ ?})]}
{<{lmt+1} 'Rok: %1 Okres: %2'@[$ST.AR,form(ST.AM,-2)]}
{FONT: 'T10B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T10'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T10B'}{SPACE: 'B'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{IF: tryb<>1}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}------------------------------MAKRA-----------------------{COMMENT-}
{MACRO: 'utwtab'}
{  ZLGB.clear;
   ZLGB.index(ndxzlgb1);
   ZLGB.prefix(ST.OKR_REF);
   ZLGB.first();
   data:=ZLGB.ZLGD().DT;
   prac:=#ZLGB.P;
   {!
   |?
      nazwisko:=ZLGB.P().OSOBA().NAZWISKO;pierwsze:=OSOBA.PIERWSZE;pesel:=OSOBA.PESEL;
      {? P.f_find(nazwisko,pierwsze,pesel)
      ||
         {? (data<>ZLGB.ZLGD().DT & prac<>#ZLGB.P) |
            (data=ZLGB.ZLGD().DT & prac<>#ZLGB.P)
         || __TAB.prefix();
            __TAB.P:=#ZLGB.P;
            __TAB.NAZWA:=ZLGB.P().OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE;
            __TAB.KWOTA:=ZLGB.KW;
            __TAB.ILDNI:=1;
            __TAB.add();
            prac:=#ZLGB.P;
            data:=ZLGB.ZLGD().DT
         |? (data<>ZLGB.ZLGD().DT & prac=#ZLGB.P)
         || __TAB.prefix(#ZLGB.P);
            {? __TAB.first()
            || __TAB.KWOTA+=ZLGB.KW;
               __TAB.ILDNI+=1;
               __TAB.put();
               data:=ZLGB.ZLGD().DT
            ?}
         |? (data=ZLGB.ZLGD().DT & prac=#ZLGB.P)
         || __TAB.prefix(#ZLGB.P);
            {? __TAB.first()
            || __TAB.KWOTA+=ZLGB.KW;
               __TAB.put()
            || __TAB.P:=#ZLGB.P;
               __TAB.NAZWA:=ZLGB.P().OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE;
               __TAB.KWOTA:=ZLGB.KW;
               __TAB.ILDNI:=1;
               __TAB.add();
               prac:=#ZLGB.P
            ?}
         ?}
      ?};
      ZLGB.next()
   !};
~~}
{MACRO-}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T10'}{SPACE: 'B'}
{ rsep:=PAR_WYDR.RSEP; ~~}
{SUBSTITUTE: 'filtrprac'}
{SUBSTITUTE: 'utwtab'}
{FOR: __TAB}
{INDEX: ndx}
{DO}
{SUBSTITUTE: 'LINIA0'}
{OD}
