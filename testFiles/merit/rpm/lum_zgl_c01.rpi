:!UTF-8
{MACRO:'index'}
{ okno_str:="'STR'+form(WYDRUKIL.RADIOB_1+1,-2)";
  W_TMP.ndx_drop;pom[10]:=$okno_str();
  w_tmp_ndx:=W_TMP.ndx_tmp(,1,'USERS',,,'WYDRUK',,,'STR01',,,'STR02',,,$pom[10],,);
  "uwaga - tu wstawione tzw. sortowanie : pierwsze wystapienie recordu (STR02) odznaczane przez 0";
  Str02:='';
  W_TMP.index(w_tmp_ndx);
  W_TMP.prefix(@.OPERATOR.USER().KOD,wydr_naz);
  {? W_TMP.first()
  || {! |?
      {? W_TMP.STR02<>Str02
      || W_TMP.INT01:=0; Str02:=W_TMP.STR02; W_TMP.put()
      ?};
     W_TMP.next()
     !}
  ?}
;~~}
{MACRO-}
{MACRO:'dane_tmp'}
{W_TMP.index(w_tmp_ndx);
 W_TMP.prefix(@.OPERATOR.USER().KOD,wydr_naz);
 {| W_TMP |!blank;USERS :=@.OPERATOR.USER().KOD;WYDRUK:=wydr_naz;
            {? wyb='K'|| STR01:=38+@.ZLE.KH().NAZ |? wyb='G' || STR01:=39+@.ZLE.KH().GRKH().NAZ |? wyb='W' ||STR01:=''?};
            {? wyb='K'| wyb='G'|| STR02:=38+@.ZLE.KH().NAZ |? wyb='W' || STR02:=@.ZLE.SYM ?};
            STR03:=@.ZLE.SYM; STR04:=@.ZLE.UM().SYM;
            STR05:=form(@.ZLE.POS().UL().MIA().NAZ); _n:=+@.ZLE.POS().UL().UL; _m:=+@.ZLE.POS().NR;  STR11:=form((_n+@.ZLE.POS().UL().UL)+' '+(_m+@.ZLE.POS().NR));
            STR06:=form(@.ZLE.USL().KOD); STR07:=form(@.ZLE.TAR().KOD); STR08:=form(@.ZLE.TFAK); STR09:=form(30+@.ZLE.FAS().NAZ);
            STR12:=form(@.ZLE.KH().GRKH().KOD); STR13:=form(@.ZLE.KH().KOD);
            INT01:=1; add|};
 ~~}
{MACRO-}
{MACRO: 'druk'}
{lp:=0; pom[1]:=''; pom[2]:=1;~~}
{pom[20]:=1; pom[21]:=''; ~~}
{FOR:'W_TMP'}
{INDEX: w_tmp_ndx}
{PREFIX: @.OPERATOR.USER().KOD,wydr_naz}
{DO}
  {wart[2]:=W_TMP.STR02;
   wart[3]:=W_TMP.STR03;
   wart[4]:=W_TMP.STR04;
   wart[5]:=W_TMP.STR05;
   wart[6]:=W_TMP.STR06;
   wart[7]:=W_TMP.STR07;
   wart[8]:=W_TMP.STR08;
   wart[9]:=W_TMP.STR09;
   pom[21]:=W_TMP.INT01;
   {? var_pres('gkh')=2 || gkh:=W_TMP.STR12 ?};
   {? var_pres('kkh')=2 || kkh:=W_TMP.STR13 ?};
   {? var_pres('ami')=2 || ami:=W_TMP.STR05 ?};
   {? var_pres('aul')=2 || aul:=W_TMP.STR11 ?};
   lp+=1;
   ~~}
  {IF: tryb=1}
     {SUBSTITUTE: 'LINIA0'}
  {ELIF: WYDRUKIL.TYP_ZEST=2 }
    {IF: pom[1]<>W_TMP.STR01}
       {IF: pom[1]<>''}
   {pom[20]:=1;~~}
   {lp:=1;
   wart[2]:=W_TMP.STR02;
   wart[3]:=W_TMP.STR03;
   wart[4]:=W_TMP.STR04;
   wart[5]:=W_TMP.STR05;
   wart[6]:=W_TMP.STR06;
   wart[7]:=W_TMP.STR07;
   wart[8]:=W_TMP.STR08;
   wart[9]:=W_TMP.STR09;
   pom[21]:=W_TMP.INT01;
   {? var_pres('gkh')=2 || gkh:=W_TMP.STR12 ?};
   {? var_pres('kkh')=2 || kkh:=W_TMP.STR13 ?};
   {? var_pres('ami')=2 || ami:=W_TMP.STR05 ?};
   {? var_pres('aul')=2 || aul:=W_TMP.STR11 ?};
   ~~}
       {FI}
{kh_grkh:=W_TMP.STR01;~~}
{pom[20]:=1;~~}
{pom[20]:=0;~~}
{grkh_set:=1;~~}
{prn1:='PRN'; prn2:='PRX';~~}
{SUBSTITUTE: 'LINIA02'}
{pom[2]:=0;~~}
    {pom[1]:=W_TMP.STR01;~~}
    {FI}
   {kh_grkh:=W_TMP.STR02;~~}
   {pom[20]:=1;~~}
   {pom[2]:=1;~~}
   {IF: pom[21]=1}
   {wart[2]:=''; gkh:=kh_grkh; kh_grkh:=''; llp:=lp; lp:=''; ~~}
   {FI}
   {IF: grkh_set=1}
      {grkh_set:=0;~~}
      {prn1:='PRX'; prn2:='PRN';~~}
      {SUBSTITUTE: 'LINIA02'}
   {ELSE}
      {prn1:='PRN'; prn2:='PRN';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{IF: pom[21]=1}
   {lp:=llp-1; kh_grkh:=gkh;~~}
{FI}
{IF: W_TMP.STR11<>''}
  {llp:=lp; lp:='';
   gkh:=kh_grkh; kh_grkh:='';
   wart[2]:='';
   wart[3]:='';
   wart[4]:='';
   wart[5]:=W_TMP.STR11;
   wart[6]:='';
   wart[7]:='';
   wart[8]:='';
   wart[9]:='';
   wart[10]:=''; ~~}
   {prn1:='PRN'; prn2:='PRN';~~}
   {SUBSTITUTE: 'LINIA0'}
   {lp:=llp; kh_grkh:=gkh; ~~}
{FI}
  {ELIF: WYDRUKIL.TYP_ZEST=1 | WYDRUKIL.TYP_ZEST=3 }
{kh_grkh:=W_TMP.STR02;~~}
{pom[20]:=1;~~}
{IF: pom[21]=1}
{wart[2]:=''; gkh:=kh_grkh; kh_grkh:=''; llp:=lp; lp:=''; ~~}
{FI}
{prn1:='PRN'; prn2:='PRN';~~}
{SUBSTITUTE: 'LINIA0'}
{IF: pom[21]=1}
  {lp:=llp-1; kh_grkh:=gkh;~~}
{FI}
{IF: W_TMP.STR11<>''}
  {llp:=lp; lp:='';
   gkh:=kh_grkh; kh_grkh:='';
   wart[2]:='';
   wart[3]:='';
   wart[4]:='';
   wart[5]:=W_TMP.STR11;
   wart[6]:='';
   wart[7]:='';
   wart[8]:='';
   wart[9]:='';
   wart[10]:=''; ~~}
   {prn1:='PRN'; prn2:='PRN';~~}
   {SUBSTITUTE: 'LINIA0'}
   {lp:=llp; kh_grkh:=gkh; ~~}
{FI}{ENTIRE-}
  {FI}
{OD}
{pom[20]:=1;~~}
{MACRO-}
{MACRO: 'param_info'}
PARAMETRY WYDRUKU:
TYP ZESTAWIENIA : {IF: WYDRUKIL.TYP_ZEST=1 } Wg kontrah. {ELIF: WYDRUKIL.TYP_ZEST=2 }  Wg grup kontrah. {ELIF: WYDRUKIL.TYP_ZEST=3 } Bez podziału {FI}
KLUCZ SORTOWANIA: {IF: WYDRUKIL.RADIOB_1 = 1}Kontrahent
                  {ELIF: WYDRUKIL.RADIOB_1 = 2}Numer zlecenia
                  {ELIF: WYDRUKIL.RADIOB_1 = 3}Numer umowy
                  {ELIF: WYDRUKIL.RADIOB_1 = 4}Posesja
                  {ELIF: WYDRUKIL.RADIOB_1 = 5}Rodzaj usługi
                  {ELIF: WYDRUKIL.RADIOB_1 = 6}Taryfa
                  {ELIF: WYDRUKIL.RADIOB_1 = 7}Fakturowanie wg. umowy
                  {ELIF: WYDRUKIL.RADIOB_1 = 8}Sposób fakturowania
                  {FI}
OBSZAR ROBOCZY: {IF: ODDZIAL=1} {{? ODDZ.find_key(ST.ODDZ) || 20+ODDZ.NAZ || ST.ODDZ ?}} {ELIF: ODDZIAL=2} WSZYSTKIE ODDZIAŁY {FI}
{MACRO-}