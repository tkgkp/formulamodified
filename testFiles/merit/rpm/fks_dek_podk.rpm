:!UTF-8
{TITLE: Korekta informacji VAT-UE}
{PRINTER: 'port_std',,,,,,,,,,,,1,
   PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,,1}
{BEGIN:
   sd:=obj_new(6); nd:=obj_new(6); kdb:=obj_new(6); kdj:=obj_new(6);
   td:=obj_new(6);
   sn:=obj_new(6); nn:=obj_new(6); knb:=obj_new(6); knj:=obj_new(6);
   tn:=obj_new(6);
   kl:='0:0:0,60:100:200'; bl:='0:0:0,255:255:255'; ks:='0:0:0,175:175:175';
   ko:='0:0:0,225:225:225'; l:=-1; STR.split(XINFO.NAZ); {! |? l+=1; STR.line(71); STR.next() !};
   i:=j:=ld:=0;
   NIPY.index('SNIP_F'); NIPY.prefix(REF.S_FIRMA,'PL');
   nipuelic:={? NIPY.first() || 2-NIPY.SNIP || XINFO.NIP ?}
}
{END:
   &sd; &nd; &kdb; &kdj; &td; &nipuelic;
   &sn; &nn; &knb; &knj; &tn;
   &kl; &bl; &ks; &ko;
   &i; &j; &ld; &l
}
{COMMENT}
gr - tekst pogrubiony dla poszczególnych pozycji sprawozdania
zw - tekst zwykły dla poszczególnych pozycji sprawozdania
tyt - tytuł sprawozdania
ptyt - podtytuł sprawozdania
ppkt - podpunkt sprawozdania np. E.1.
op - tytuł dla tekstu wolnego (objaśnienia lub pouczenia)
{COMMENT-}
{DEFINEFONT: 'gr=Arial,110,r,8'}
{DEFINEFONT: 'tyt=Arial,120,f,8'}
{DEFINEFONT: 'ptyt=Arial,80,m,8'}
{DEFINEFONT: 'zw=Arial,100,q,8'}
{DEFINEFONT: 'zwn=Arial,120,q,8'}
{DEFINEFONT: 'ppkt=Arial,80,e,8'}
{DEFINEFONT: 'op=Arial,110,f,8'}
{SPACE: 'd'}{FONT: 'q'}
{  VAT_POZ.index('VAT_POZ'); VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK C');
   ld:=VAT_POZ.size();
   VAT_POZ.prefix(VAT_DEK.ref(),'VAT-UEK D');
   _v:=VAT_POZ.size();
   {? _v>ld || ld:=_v ?};
   ld:=ceil(ld/12); ~~}
{WHILE: j<ld}
{DO}
   {  {! i:=1..6 |!
         sd[i]:=nd[i]:=td[i]:=sn[i]:=nn[i]:=tn[i]:='';
         kdb[i]:=kdj[i]:=knb[i]:=knj[i]:=0
      !};
      i:=1; j+=1; ~~}
   {FOR: VAT_POZ}
   {INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK C. '+$j+' '}
   {DO}
      {  {? VAT_POZ.LP+1='B'
         || nd[i]:=VAT_POZ.OP; kdb[i]:=VAT_POZ.NETTO$0; td[i]:=VAT_POZ.Z;
            {? exec('kod_pl','slo_slu',2+nd[i])
            || sd[i]:=2+nd[i]; nd[i]:=2-nd[i]
            ?};
            VAT_POZ.next();
            kdj[i]:=VAT_POZ.NETTO$0;
            i+=1
         ?}; ~~}
   {OD}
   { i:=1; ~~}
   {FOR: VAT_POZ}
   {INDEX: 'VAT_POZ'}
   {PREFIX: VAT_DEK.ref(),'VAT-UEK D. '+$j+' '}
   {DO}
      {  {? VAT_POZ.LP+1='B'
         || nn[i]:=VAT_POZ.OP; knb[i]:=VAT_POZ.NETTO$0; tn[i]:=VAT_POZ.Z;
            {? exec('kod_pl','slo_slu',2+nn[i])
            || sn[i]:=2+nn[i]; nn[i]:=2-nn[i]
            ?};
            VAT_POZ.next();
            knj[i]:=VAT_POZ.NETTO$0;
            i+=1
         ?}; ~~}
   {OD}
   {DIRECT}{<1}{REP: '{INCLUDE: fks_dek_uk1w.rpi}'}{DIRECT-}
   {DIRECT}{<1}{REP: '{INCLUDE: fks_dek_uk2w.rpi}'}{DIRECT-}
{OD}