:!UTF-8
{TITLE:B.  Plan kont - analitycznie}
{PRINTER: FINFO.W_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT}
{BEGIN:  pomoc:=0; kl:=0; il:=0; pomoc2:=0; pomoc3:=0;
         kolu:=obj_new(20); w:=obj_new(20); p:=obj_new(20);
         r:=SSTALE.AR; SSTALE.AR:=ROK_F.ref; ROZNE.PAR1:=lm:=1; mdc:='';
         vp:=0; KS.cntx_psh()
         }
{END:    &pomoc;  &kl; &il; &pomoc2; &pomoc3; &lm; &mdc;
         obj_del(kolu); obj_del(w); obj_del(p);
         SSTALE.AR:=r; &r; &vp; KS.cntx_pop()
         }
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: koplan.rpm
Utworzony:   ????-??-??
Modyfikacje: 2001-06-26 [AMK] Artur Makos
==================================================
Zawartosc: Wydruk planu kont - analitycznie
{COMMENT-}
  { w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[6]:='';
    kl:=6;
    kolu[1]:=8;
    kolu[2]:=62;
    kolu[3]:=6;
    kolu[4]:=5;
    kolu[5]:=22;
    kolu[6]:=7;
    il:=kolu[1]+kolu[2]+kolu[3]+kolu[4]+kolu[5]+kolu[6]+kl+1;
    p[1]:=2+kolu[1];
    {!_a:=2 ..kl
    |! p[_a]:=1+p[_a-1]+kolu[_a]
    !};
    ~~
  }
  {IF: KS.index('SYM'); KS.prefix(ROK_F.ref); ~KS.first}
    { FUN.info('Brak kont syntetycznych.'@);  ~~}
    {EXIT}
  {FI}
  {
    KS.cntx_psh;
    KS.index('SYM');
    KS.prefix(ROK_F.ref);
    KS.first;
    WYDRUKI.KSOD:=KS.ref;
    KS.last;
    WYDRUKI.KSDO:=KS.ref;
    KS.cntx_pop;
    WYDRUKI.win_edit('KONTAKS1');
    ~~
  }
  {EXIT: ~WYDRUKI.edit}
{'------------------------------------------------------------------';~~}
{'           DEFINICJE "MACRO", "HEADER" I "FOOTER"                 ';~~}
{'------------------------------------------------------------------';~~}
{MACRO: 'LINIA1'}
┌{kolu[1]*'─'}┬{kolu[2]*'─'}┬{kolu[3]*'─'}┬{kolu[4]*'─'}┬{kolu[5]*'─'}┬{kolu[6]*'─'}┐
{MACRO-}
{MACRO: 'LINIA2'}
├{kolu[1]*'─'}┼{kolu[2]*'─'}┼{kolu[3]*'─'}┼{kolu[4]*'─'}┼{kolu[5]*'─'}┼{kolu[6]*'─'}┤
{MACRO-}
{MACRO: 'LINIA3'}
└{kolu[1]*'─'}┴{kolu[2]*'─'}┴{kolu[3]*'─'}┴{kolu[4]*'─'}┴{kolu[5]*'─'}┴{kolu[6]*'─'}┘
{MACRO-}
{MACRO: 'LINIA4'}
├{kolu[1]*'─'}┴{kolu[2]*'─'}┴{kolu[3]*'─'}┴{kolu[4]*'─'}┴{kolu[5]*'─'}┴{kolu[6]*'─'}┤
{MACRO-}
{MACRO: 'LINIA5'}
├{kolu[1]*'─'}┬{kolu[2]*'─'}┬{kolu[3]*'─'}┬{kolu[4]*'─'}┬{kolu[5]*'─'}┬{kolu[6]*'─'}┤
{MACRO-}
{MACRO: 'LINIA33'}
└{kolu[1]*'─'}─{kolu[2]*'─'}─{kolu[3]*'─'}─{kolu[4]*'─'}─{kolu[5]*'─'}─{kolu[6]*'─'}┘
{MACRO-}
{INCLUDE: wsp_pw3.rpi}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{PAR_WYDR.TITLE:='PLAN KONT - ANALITYKA ZA ROK:  '+BILANSP.AROK().NAZ;~~}
{SUBSTITUTE: 'CHARHEAD'}{FONT: 'Q'}{SPACE: 'B'}
{LINE: 1}{IF: page=1}
{<3 'Parametry wydruku:'@}
{ KS.cntx_psh;~~}
{<6 'Od konta: %1 - %2'@[WYDRUKI.KSOD().SYM,WYDRUKI.KSOD().NAZ]}
{<6 'Do konta: %1 - %2'@[WYDRUKI.KSDO().SYM,WYDRUKI.KSDO().NAZ]}
{ KS.cntx_pop;~~}
{<6
{? ROZNE.PAR1=1
   || 'Wydruk: pełny'@
   || 'Wydruk: skrócony'@
?}
}
{FI}
{FONT: 'R'}{SPACE: 'C'}
{SUBSTITUTE: 'LINIA1'}
│  Konto{<{p[1]}'│'}{<{p[1]}>{p[2]}'Nazwa konta'@}{<{p[2]}'│'}{'Poziom'@}{<{p[3]}'│'}{' Sep.'@}{<{p[4]}'│'}{<{p[4]}>{p[5]}'Nazwa słownika'@}{<{p[5]}'│'}{'Długość'@}{<{p[6]}'│'}
{FONT: 'Q'}{SPACE: 'C'}{ vp:=1;~~}
{HEADER-}
{'------------------------------------------------------------------';~~}
{'                   FOOTER                                         ';~~}
{'------------------------------------------------------------------';~~}
{FOOTER:0}{FONT: 'Q'}{SPACE: 'C'}
{IF: (pomoc2=0)}{SUBSTITUTE: 'LINIA3'}{ELSE}{SUBSTITUTE: 'LINIA33'}{FI}
{SUBSTITUTE: 'CHARFOOT'}
{ vp:=1;~~}
{FOOTER-}
{'------------------------------------------------------------------';~~}
{'                    CIAŁO  WYDRUKU                                ';~~}
{'------------------------------------------------------------------';~~}
{FONT: 'Q'}{SPACE: 'C'}
{SUBSTITUTE: 'LINIA2'}
{FOR: 'KS'}
{INDEX: 'SYM'}
{FROM: ROK_F.ref,WYDRUKI.KSOD().SYM}
{TO: ROK_F.ref,WYDRUKI.KSDO().SYM}
{DO}
   { pomoc2:=pomoc:=0; w[1]:=KS.SYM; w[2]:=KS.NAZ; ~~}
   {FOR: 'BUD'}
   {INDEX: 'KS'}
   {PREFIX: KS.ref}
   {DO}
      { pomoc:=1; w[3]:=BUD.POZ; w[4]:=BILANSP.ASEP;
      w[5]:=BUD.SLU().SLU().NAZ; w[6]:=BUD.SLU().SLU().DL;~~}
      {IF: lineleft()=1}{PAGE}{FI}
      {IF: vp}
         {SUBSTITUTE: 'LINIA2'}{vp:=0;~~}
      {FI}
      {<1'│'} {w[1]}{<{p[1]}'│'} {w[2]}{<{p[2]}'│'}   {w[3]}{<{p[3]}'│'}  {w[4]}{<{p[4]}'│'} {w[5]}{<{p[5]}'│'}   {w[6]}{<{p[6]}'│'}
      { w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[6]:=''; ~~}
   {OD}
   {IF: pomoc=0}
      {IF: lineleft()=1}{PAGE}{FI}
      {IF: vp}
         {SUBSTITUTE: 'LINIA2'}
      {FI}
      {<1'│'} {w[1]}{<{p[1]}'│'} {w[2]}{<{p[2]}'│'}   {w[3]}{<{p[3]}'│'}  {w[4]}{<{p[4]}'│'} {w[5]}{<{p[5]}'│'}   {w[6]}{<{p[6]}'│'}{vp:=0;~~}
   {ELIF: ROZNE.PAR1=1}
      { pomoc2+=1; ~~}
      {IF: lineleft()=1}{PAGE}{FI}
      {IF: vp}
         {IF: (pomoc2=0)|((pomoc2-1)=pomoc3)}
            {SUBSTITUTE: 'LINIA2'}
            { pomoc3:=0; ~~}
         {ELSE}
            {SUBSTITUTE: 'LINIA4'}{vp:=0;~~}
         {FI}
      {ELSE}
         {SUBSTITUTE: 'LINIA4'}
      {FI}
      {FOR: 'BUD'}
      {INDEX: 'KS'}
      {PREFIX: KS.ref}
      {DO}
         {FOR: 'SLO'}
         {INDEX: 'SL'}
         {PREFIX: BUD.SLU().SLU}
         {DO}
         {FIRST}
         {<1'│'}{' '+BUD.SLU().SLU().NAZ}{<{il}'│'}{vp:=0;~~}
         {FIRST-}
            {IF: (BUD.SLU().SLU().WZ<>'Kontrahent')&(BUD.SLU().SLU().WZ<>'Osoba')&(BUD.SLU().SLU().WZ<>'Pracownik')}
               { pomoc2+=1; pomoc3:=SLO.size; ~~}
               {IF: lineleft()=1}{PAGE}{FI}
               {IF: vp}
                  {SUBSTITUTE: 'LINIA4'}{vp:=0;~~}
               {FI}
               {<1'│'}{' '+SLO.KOD}{(8-+SLO.KOD)*' '}{SLO.TR}{<{il}'│'}{vp:=0;~~}
            {ELSE}
               { pomoc3:=SLO.size(); ~~}
            {FI}
         {OD}
      {OD}
      {IF: pomoc3<>0}
         { pomoc2:=0;  ~~}
         {IF: ~vp}
            {SUBSTITUTE: 'LINIA5'}
         {ELSE}
            {IF: (pomoc2=0)|((pomoc2-1)=pomoc3)}
               {SUBSTITUTE: 'LINIA2'}
               { pomoc3:=0; ~~}
            {ELSE}
               {SUBSTITUTE: 'LINIA4'}
            {FI}
         {FI}
      {FI}
   {FI}
{OD}
{'------------------------------------------------------------------';~~}
{'            KONIEC  WYDRUKU                                       ';~~}
{'------------------------------------------------------------------';~~}
{SPACE: 'B'}
{FOOTER}
{SUBSTITUTE: 'CHARFOOT'}
{FOOTER-}
{ENTIRE}{FONT: 'Q'}{SPACE: 'C'}
{SUBSTITUTE: 'LINIA3'}
{<1>{il}'KONIEC WYDRUKU '@}
{ENTIRE-}