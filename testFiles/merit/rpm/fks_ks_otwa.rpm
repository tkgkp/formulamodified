:!UTF-8
{TITLE:A.  Bilans otwarcia}
{PRINTER: exec('prt','param_wydr','h'),,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:  ROZNE.win_edit('KS_2'); SA:='A';
         KON_WYDR.hdr_sel; KON_WYDR.hdr_sel(' - analityczne@, użytkownika (%1)'@[@.OPERATOR.USER().KOD]);
         KON_WYDR.actions('WER','I:I',':d'); SSTALE.AR();
         USERS.actions('SLO','T');USERS.win_dict('SLO');
         {? ~(var_pres('O_AN')>100)
         || ROZNE.blank(1); ROZNE.PAR2:=3; ROZNE.PAR4:=0; ROZNE.UT_DOK:=UNPAR.P8:=UNPAR.P7:=1; ROZNE.PAR1:=2; ROZNE.UT_KS:=0
         ?};
         UNPAR.P8_BV:=UNPAR.P8_BE:='{? ~UNPAR.P7 || 0 || 1 ?}';
         UNPAR.P8_AE:=UNPAR.P7_BE:=''; UNPAR.P7_AE:='win_disp()';
         exec('ini_wal','konto');
         {? var_pres('PRNH')>0 || obj_del(PRNH) ?};
         {? var_pres('PRN')>0 || obj_del(PRN) ?};
         PRNH:=obj_new(@.CLASS.PRINT,5); PRNH.sl_frame();
         PRN:=obj_new(@.CLASS.PRINT,8);  PRN.sl_frame();
         PRNF:=obj_new(@.CLASS.PRINT,7);  PRNF.sl_frame();
         prn1:='PRN';prn2:='PRNH';lm:=ll:=lmt:=i:=pp:=0;rsep:=vp:=1;param:=wal:=odd:=k:=kontotxt:=color:=kssaldo:='';
         VAR_DEL.delete('TABW','TABK','TABK_IS','TABK_IA');
         w:=obj_new(8); ww1:=obj_new(8); wws:=obj_new(8); wwp:=obj_new(8); wwsynt:=obj_new(2); wpsynt:=obj_new(2);
         {!_i:=3..8|! w[_i]:=ww1[_i]:=wws[_i]:=wwp[_i]:=0!};
         wwsynt[1]:=wwsynt[2]:=0;
         tuser:=tm_form(TMPVAT.tm_stamp)
       }
{END: &SA; VAR_DEL.delete('TABK','PRNH','PRN','PRNF','TABW','TABK_IS','TABK_IA',
                          'w','ww1','wwsynt','wpsynt','wws','wwp');
      &i; &k; &tuser; &wal; &odd;&kontotxt;&param;
      &prn1;&prn2;&lm;&ll;&lmt;&rsep;&vp;&color;&pp;&kssaldo;
      UNPAR.P8_BV:=UNPAR.P7_AE:='';
      USERS.actions('SLO','')}
{ wal:='Waluta aktywna:  %1 - %2'@[SSTALE.WAL().TR,SSTALE.WAL().KOD];
  odd:={? WYDRUKI.ODD=0 || '' || 'Jednostka księgowa:  %1'@[WYDRUKI.ODD().OD] ?};~~}
{EXIT: ~ROZNE.edit(" _a:='';
{? ROZNE.PAR4=4
|| _a:=__CHK.record(ROZNE,,'KS_OD','KS_DO');
   {? _a=''
   || {? ROZNE.KS_OD().SYM> ROZNE.KS_DO().SYM
      || FUN.info('Błędny zakres kont.'@); _a:='KS_OD'
      ?}
   ?}
|? ROZNE.PAR4=5
|| _a:=__CHK.record(ROZNE,,'KON_WYDR');
   {? _a=''
   || {? (ROZNE.KON_WYDR().SA='S' & ROZNE.PAR1=2)
      || FUN.info('Błędny zestaw kont.'@); SA:='A'; _a:='KON_WYDR'
      |? ROZNE.KON_WYDR().SA='A' & ROZNE.PAR1=1
      || FUN.info('Błędny zestaw kont.'@); SA:='S'; _a:='KON_WYDR'
      ?}
   ?};
   {? _a=''
   || KON_SCH.prefix(KON_WYDR.ref);
      _a:={? KON_SCH.first()
          || ''
          || FUN.info('Brak definicji kont w podanym zestawie.'@); 'KON_WYDR'
          ?}
   ?}
|? ROZNE.PAR1=1 & ROZNE.PAR4=6
|| FUN.info('Dla opcji syntetycznej, wybór kont poprzez selekcję analityczną jest niedostępny.'@); _a:='PAR4'
?}; _a")}
{ {? ROZNE.PAR2=1 || kontotxt:='Konta: pozabilansowe'@
  |? ROZNE.PAR2=2 || kontotxt:='Konta: bilansowe'@
  |? ROZNE.PAR2=3 || kontotxt:='Konta: wszystkie'@
  |? ROZNE.PAR2=4 || kontotxt:='Konta: wynikowe'@
  || kontotxt:='Konta: wszystkie bez pozabilansowych'@
  ?};
~~}
{ {? ROZNE.PAR4=2
  || WYDRUKIN.DLKON:=35; WYDRUKI.MASKA:=ROZNE.MASKA;
     WYDRUKI.MASKA:=exec('usostsep','konto',WYDRUKI.MASKA);
     {? +WYDRUKI.MASKA<WYDRUKIN.DLKON
     || WYDRUKI.MASKA+=(WYDRUKIN.DLKON-+WYDRUKI.MASKA)*'?'
     ?}
  |? ROZNE.PAR4=0
  || WYDRUKI.MASKA:=ROZNE.PREFIX
  || WYDRUKI.MASKA:=''
  ?};~~}
{SA:={? ROZNE.PAR1=1 ||'S'||'A'?};~~}
{IF: ROZNE.PAR4=3}
 { _okn:=KS.win_sel('?'); exec('initmpks','dok_fks_zest'); KS.select; KS.win_sel(_okn);~~}
 {EXIT: ~TMPSIK.first()}
{ELIF: ROZNE.PAR4=6}
 { _okn:=AN.win_sel('?'); exec('initmpan','dok_fks_zest'); AN.select(); AN.win_sel(_okn);~~}
 {EXIT: ~TMPSIK.first()}
{FI}
{TABW:=proc_exec('ks_otwa@ks_otwa',SSTALE.AO().ROK().KOD,SSTALE.AO().ROK().NAZ,SA,SSTALE.WAL().KOD,FINFO.NAROD().KOD,WYDRUKI.ODD().OD,
                                  {? ROZNE.UT_KS || 'T' || 'N' ?}, {? UNPAR.P7||'S'||'O'?},ROZNE.PAR2,
                                  {?UNPAR.P8||'N'||'T'?},ROZNE.PAR4,ROZNE.PREFIX, ROZNE.MASKA,ROZNE.KS_OD().SYM,
                                  ROZNE.KS_DO().SYM,ROZNE.KON_WYDR().KOD,{?ROZNE.UT_DOK||'T'||'N'?},
                                  BILANSP.ASEP,BILANSP.ASYNT,SSTALE.AO().ZAM,#ROZNE.KON_WYDR,tuser,
                                  form(exec('kurs','konto',UNPAR.PSLO().KOD,UNPAR.P25),,,'9.'));
{? rep_export()
|| TABW.for_each("{? TABW.REK='O' | TABW.REK='S' || TABW.del() ?}")
?}; ~~}
{INCLUDE:fks_ks_otwa.rpi}