:!UTF-8
{TITLE:1. Brygady}
{PRINTER: INFO.W_PRN,,,,,'E','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
      PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   undefine();
   ZLBR.cntx_psh();
   dalej:=0;
   PRN:=obj_new(@.CLASS.PRINT,7); PRN.s_frame();
   prn1:='PRN';
   color:='';
   elem:=wykl:=0;
   el:='';
   dt:=date();
   lm:=ll:=vp:=lmt:=rsep:=0
}
{END:
   undefine();
   ZLBR.cntx_pop();
   &dalej;
   obj_del(PRN);
   &prn1;
   &elem;
   &wykl;
   &el;
   &dt;
   &color;
   &lm; &ll; &vp; &lmt; &rsep
}
{COMMENT}
  Wydruk tabeli brygad ZLBR
  [TS] - [8.10] - 2003/05/23
  Wywolanie: Ustawienia i parametryzacja -> Produkcja -> Brygady -> Drukuj
{COMMENT-}
{  define('DATA',dt,'Podaj skład brygad na dzień'@);
   def_btn('text=%1'['Zapisz'@],'key:F2');
   def_btn('text=%1'['Anuluj'@],'key:Esc');
   ~~}
  {IF: def_edit(,FUN.TYT)}
  { dt:=@.DEFINE.DATA;
  ~~}
  {ELSE}
  {EXIT}
  {FI}
{COMMENT}--------------------------Definicja wiersza ---------{COMMENT-}
{  PRN.add("ZLBR.KOD",20,'Kod brygady'@);
   PRN.add("ZLBR.NAZ",40,'Nazwa brygady'@);
   PRN.add("el",37,'Pracownicy'@,,'#');
   PAR_WYDR.TITLE:='BRYGADY'@; ~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8'}{SPACE: 'B'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{<{lmt+1} 'PARAMETRY WYDRUKU:'@}
{<{lmt+1} 'Skład brygad na dzień: %1'@[$dt]}
{FONT: 'T8B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T10'}{SPACE: 'B'}
{ lmt:=int((charleft()-PRN.width())/2); ~~}
{FONT: 'T8B'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE: 1}
{FOOTER-}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8'}{SPACE: 'B'}
{ rsep:=PAR_WYDR.RSEP; ~~}
{FOR: 'ZLBR'}
  {INDEX: 'KOD'}
{DO}
    { ZLBS.clear();
      ZLBS.index('BODIP');
      ZLBS.prefix(ZLBR.ref());
      {? ZLBS.first()
      || {!
         |?
            {? (ZLBS.OD<=dt | ZLBS.OD=date(0,0,0)) & (dt<=ZLBS.DO | ZLBS.DO=date(0,0,0))
            || el+=form(ZLBS.P().OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE,37)+'#'
            ?};
            ZLBS.next()
         !}
      ?}
     ;~~}
   {SUBSTITUTE: 'LINIA0'}
   { el:='';~~}
{OD}
