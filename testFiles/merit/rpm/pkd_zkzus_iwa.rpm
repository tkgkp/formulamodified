:!UTF-8
{TITLE:Zestawienie osób podlegających ubezpieczeniu wypadkowemu}
{PRINTER: exec('prt','param_wydr','v',KST),,,,,'Q','C',,,,,,1,
          PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   VAR_DEL.delete('PRNT','PRNF','PRNB','__tab');
   _tmp:=exec('params','zus_iwa');
   __tp:=_tmp.first();
   __rok:=_tmp.ROK;
   __par:=_tmp.RR;
   vp:=1;

   prn1:='PRNT';
   lm:=lmt:=0;
   __upr:=exec('no_limit','schemat','PKD');
   {? ~__upr
   || FUN.emsg('Brak wymaganych uprawnień do przeglądania informacji.')
   ||
      __tab:=exec('generuj','zus_iwa',__rok,__par) ;
      PAR_WYDR.TITLE:='Zestawienie osób podlegających ubezpieczeniu wypadkowemu';
      {? ~__par ||
         PRNF:=obj_new(@.CLASS.PRINT,5); PRNF.s_frame();
         PRNB:=obj_new(@.CLASS.PRINT,5); PRNB.s_frame();
         PRNC:=obj_new(@.CLASS.PRINT,13); PRNC.s_frame();
         color:='229:229:229';
         vp:=1;
         prn1:='PRNF';prn2:='PRNB';
         lm:=lmt:=0;
         rsep:=1;
         __lp:=0;
         color:='229:229:229';
         sumaW:=sumaM:=0;
         __v:=0;

         __sumOS:=obj_new(12);
         __sumOS[1]:=__sumOS[2]:=__sumOS[3]:=0;
         __sumOS[4]:=__sumOS[5]:=__sumOS[6]:=0;
         __sumOS[7]:=__sumOS[8]:=__sumOS[9]:=0;
         __sumOS[10]:=__sumOS[11]:=__sumOS[12]:=0;
         __i:=0;

         PRNF.add("form(__rok,-4,0,'9.')",10,'Rok'@,1,);
         PRNF.add("form(__tab.MC,-2,0,'9.')",10,'Miesiąc'@,1);
         PRNF.add("__tab.NAZWISKO + ' ' + __tab.IMIE",81,'Nazwisko i imię'@);
         PRNF.add("__tab.ID",20,'Identyfikator'@);
         PRNF.add("__tab.ID_TYP",14,'Typ identyfikatora'@);

         PRNB.add("''",10,,);
         PRNB.add("''",10,,);
         PRNB.add("__suma",81,,1);
         PRNB.add("''",20,,1);
         PRNB.add("$sumaW",14,,);

         PRNC.add("'Lista osób podlegających ubezpieczeniu wypadkowemu'",23,'Miesiąc'@);
         PRNC.add("__sumOS[1]",6,'I'@);
         PRNC.add("__sumOS[2]",6,'II'@);
         PRNC.add("__sumOS[3]",6,'III'@);
         PRNC.add("__sumOS[4]",6,'IV'@);
         PRNC.add("__sumOS[5]",6,'V'@);
         PRNC.add("__sumOS[6]",6,'VI'@);
         PRNC.add("__sumOS[7]",6,'VII'@);
         PRNC.add("__sumOS[8]",6,'VIII'@);
         PRNC.add("__sumOS[9]",6,'IX'@);
         PRNC.add("__sumOS[10]",6,'X'@);
         PRNC.add("__sumOS[11]",6,'XI'@);
         PRNC.add("__sumOS[12]",6,'XII'@)
      ||
         PRNF:=obj_new(@.CLASS.PRINT,15); PRNF.s_frame();
         PRNB:=obj_new(@.CLASS.PRINT,5); PRNB.s_frame();
         PRNC:=obj_new(@.CLASS.PRINT,13); PRNC.s_frame();
         color:='229:229:229';
         vp:=1;
         prn1:='PRNF';prn2:='PRNC';
         lm:=lmt:=0;
         rsep:=1;
         __lp:=0;
         color:='229:229:229';
         sumaW:=sumaM:=0;
         __v:=1;

         __sumOS:=obj_new(12);
         __sumOS[1]:=__sumOS[2]:=__sumOS[3]:=0;
         __sumOS[4]:=__sumOS[5]:=__sumOS[6]:=0;
         __sumOS[7]:=__sumOS[8]:=__sumOS[9]:=0;
         __sumOS[10]:=__sumOS[11]:=__sumOS[12]:=0;
         __i:=0;
         __zm:="{?_a=1||'X'||''?}";
         PRNF.add("__tab.NAZIM",41,'Nazwisko i imię'@);
         PRNF.add("__tab.ID",20,'Identyfikator'@);
         PRNF.add("__tab.ID_TYP",14,'Typ identyfikatora'@);
         PRNF.add("__zm(__tab.MC1)",3,'I'@);
         PRNF.add("__zm(__tab.MC2)",3,'II'@);
         PRNF.add("__zm(__tab.MC3)",3,'III'@);
         PRNF.add("__zm(__tab.MC4)",3,'IV'@);
         PRNF.add("__zm(__tab.MC5)",3,'V'@);
         PRNF.add("__zm(__tab.MC6)",3,'VI'@);
         PRNF.add("__zm(__tab.MC7)",3,'VII'@);
         PRNF.add("__zm(__tab.MC8)",4,'VIII'@);
         PRNF.add("__zm(__tab.MC9)",3,'IX'@);
         PRNF.add("__zm(__tab.MC10)",3,'X'@);
         PRNF.add("__zm(__tab.MC11)",3,'XI'@);
         PRNF.add("__zm(__tab.MC12)",3,'XII'@);

         PRNC.add("'Liczba osób podlegających ubezpieczeniu wypadkowemu w mieiącu'",81,'Miesiąc'@,,,,,,,,3);
         PRNC.add("__sumOS[1]",3,'I'@);
         PRNC.add("__sumOS[2]",3,'II'@);
         PRNC.add("__sumOS[3]",3,'III'@);
         PRNC.add("__sumOS[4]",3,'IV'@);
         PRNC.add("__sumOS[5]",3,'V'@);
         PRNC.add("__sumOS[6]",3,'VI'@);
         PRNC.add("__sumOS[7]",3,'VII'@);
         PRNC.add("__sumOS[8]",4,'VIII'@);
         PRNC.add("__sumOS[9]",3,'IX'@);
         PRNC.add("__sumOS[10]",3,'X'@);
         PRNC.add("__sumOS[11]",3,'XI'@);
         PRNC.add("__sumOS[12]",3,'XII'@)
      ?}
   ?}
}
{END:
VAR_DEL.delete('PRNT','PRNC','PRNF','PRNB','__tab','__sumOS')
}
{EXIT: ~__upr}
{EXIT: ~__tp}
{EXIT: ~__tab.first()}
{INCLUDE: wsp_pw.rpi}
{MACRO: 'TABHEADX'}
{ _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
{ _f:=prn1+'.ini_head()'; ($(_f))()}
{REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
{WHILE: _f:=prn1+'.h_next()'; ($(_f))()}
{DO}
   {REP: _f:=prn1+'.h_fmline(lmt)'; ($(_f))()}
{OD}
{MACRO-}
{ lmt:=int((charleft()-PRNF.width())/2); ~~ }
{HEADER}
{SUBSTITUTE: 'HEAD'}
{IF: 1}
   {FONT: 'T8G'}
   {SPACE: 'C'}
   {LINE}
   {<{lmt+1}'Parametry sprawozdania'@}
   {<{lmt+1}'Rok zestawienia: %1'@[$__rok]}

{FI}
{FONT: 'T8G'}
{SPACE: 'C'}
{IF: prn1='PRNF'}
   {SUBSTITUTE: 'TABHEADX'}
{FI}
{HEADER-}
{FOOTER:0}
{FONT: 'T8GB'}
{IF: __par}
{IF: ~__v}
   {prn1:='PRNC';~~}
{FI}
{FI}
{SUBSTITUTE: 'LINIAF'}
{FOOTER-}
{IF: ~rep_export()}
   {SUBSTITUTE: 'FOOT'}
{FI}
{IF: ~__par}
{FONT: 'T8G'}
{SPACE: 'C'}
{FOR: __tab}
   {DO}
   {ADD: licz; #; 1}
   {ADD: liczTot; #; 1}
   {__p:=__tab.MC;~~}
   {SUBSTITUTE: 'LINIA0'}
   {TOTAL:__tab.MC}
      {
      __suma:= 'Liczba osób podlegających ubezpieczeniu wypadkowemu w ';
      {? __p=1 || __suma+= 'styczniu'
      |? __p=2 || __suma+= 'lutym'
      |? __p=3 || __suma+= 'marcu'
      |? __p=4 || __suma+= 'kwietniu'
      |? __p=5 || __suma+= 'maju'
      |? __p=6 || __suma+= 'czerwcu'
      |? __p=7 || __suma+= 'lipcu'
      |? __p=8 || __suma+= 'sierpniu'
      |? __p=9 || __suma+= 'wrześniu'
      |? __p=10 || __suma+= 'październiku'
      |? __p=11 || __suma+= 'listopadzie'
      || __suma+= 'grudniu'
      ?};
      ~~
      }
      {prn1:='PRNF';__i+=1; prn2:='PRNB';~~}
      {sumaW:=sum('licz');__sumOS[__p]:=sumaW; ~~}
      {IF: ~rep_export()}
      {SUBSTITUTE: 'LINIA02'}
      {FI}
   {TOTAL}
      {prn1:='PRNF';prn2:='PRNB';__suma:='Razem';~~}
      {sumaW:=sum('licz');~~}
      {SUBSTITUTE: 'LINIAF'}
      {prn1:='PRNC';~~}
      {SUBSTITUTE: 'TABHEADX'}
      {SUBSTITUTE: 'LINIA0'}
   {OD}
{ELSE}
{FONT: 'T8G'}
{SPACE: 'C'}
{FOR: __tab}
   {DO}
   {__sumOS[1]+=__tab.MC1;
   __sumOS[2]+=__tab.MC2;
   __sumOS[3]+=__tab.MC3;
   __sumOS[4]+=__tab.MC4;
   __sumOS[5]+=__tab.MC5;
   __sumOS[6]+=__tab.MC6;
   __sumOS[7]+=__tab.MC7;
   __sumOS[8]+=__tab.MC8;
   __sumOS[9]+=__tab.MC9;
   __sumOS[10]+=__tab.MC10;
   __sumOS[11]+=__tab.MC11;
   __sumOS[12]+=__tab.MC12;
   ~~}
   {SUBSTITUTE: 'LINIA0'}
   {TOTAL}
      {__v:=0;~~}
      {SUBSTITUTE: 'LINIA02'}
   {OD}
{FI}