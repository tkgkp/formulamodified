:!UTF-8
{TITLE:Karta wypłat zasiłków}
{PRINTER: exec('prt','param_wydr','v',KST),,,,,'Q','C',,,,,,1,
          PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   VAR_DEL.delete('par','prn1','vp','lmt','rsep','tresc','zdate','__edit','__param','__okredit','__okred');
   tresc:='kwypzas';
   PAR_WYDR.TITLE:='Karta wypłat zasiłków rodzinnych, pielęgnacyjnych i wychowawczych'@;
   par:=obj_new(15); par[7]:=par[9]:=par[15]:=0;
   par[10]:=obj_new(@.CLASS.PRINT,3);
   par[10].add("''",37,'Lista wypłat'@);
   par[10].add("''",66,'Miesiąc, za który wypłacono'@);
   par[10].add("''",10,'Kwota wypłaty'@);
   par[10].s_frame();
   _upr:=exec('uprawnieniawrap','pkd','Dane płacowe'@,'PPL_PLL_RSKP','PPL_PLL_PSKP');
   {? +_upr
   || FUN.emsg('Brak wymaganych uprawnień do przeglądania informacji o:%1'@[_upr])
   || __param:=tab_tmp(1,
               'RODZAJ1','STRING[1]','Wybrany Rodzaj zasiłku',
               'OD1','DATE','Data od',
               'DO1','DATE','Data do',
               'RODZAJ2','STRING[1]','Wybrany Rodzaj zasiłku',
               'OD2','DATE','Data od',
               'DO2','DATE','Data do',
               'RODZAJ3','STRING[1]','Wybrany Rodzaj zasiłku',
               'OD3','DATE','Data od',
               'DO3','DATE','Data do');
      __param.OD1:=date(,1,1);
      __param.DO1:=date(,12,0);
      __param.RODZAJ1:='R';
      __param.OD2:=__param.DO2:=#0;
      __param.OD3:=__param.DO3:=#0;
      __param.add();

      __okredit:="{? +_a
                  || __param.fld_fml('OD2','BEFORE_EDIT',\"1\");
                     __param.efld_opt(__edit,'enable='+$(+_a),,'OD2');
                     __param.fld_fml('DO2','BEFORE_EDIT',\"1\");
                     __param.efld_opt(__edit,'enable='+$(+_a),,'DO2');
                     __param.efld_opt(__edit,'mark=1',,'OD2');
                     __param.efld_opt(__edit,'mark=1',,'DO2');
                     __param.OD2:=date(,1,1);
                     __param.DO2:=date(,12,0)
                  || __param.fld_fml('OD2','BEFORE_EDIT',\"0\");
                     __param.efld_opt(__edit,'enable='+$(+_a),,'OD2');
                     __param.fld_fml('DO2','BEFORE_EDIT',\"0\");
                     __param.efld_opt(__edit,'enable='+$(+_a),,'DO2');
                     __param.OD2:=__param.DO2:=#0
                  ?}";
      __okred:="{? +_a
                || __param.fld_fml('OD3','BEFORE_EDIT',\"1\");
                   __param.efld_opt(__edit,'enable='+$(+_a),,'OD3');
                   __param.fld_fml('DO3','BEFORE_EDIT',\"1\");
                   __param.efld_opt(__edit,'enable='+$(+_a),,'DO3');
                   __param.efld_opt(__edit,'mark=1',,'OD3');
                   __param.efld_opt(__edit,'mark=1',,'DO3');
                   __param.OD3:=date(,1,1);
                   __param.DO3:=date(,12,0)
                || __param.fld_fml('OD3','BEFORE_EDIT',\"0\");
                   __param.efld_opt(__edit,'enable='+$(+_a),,'OD3');
                   __param.fld_fml('DO3','BEFORE_EDIT',\"0\");
                   __param.efld_opt(__edit,'enable='+$(+_a),,'DO3');
                   __param.OD3:=__param.DO3:=#0
                ?}";
      __edit:=__param.mk_edit('%1'[PAR_WYDR.TITLE],0,'ppl_pwypzas');
      __param.win_esep(__edit,'Parametry wydruku'@);
      __param.win_efld(__edit,,'RODZAJ1',,,,,,'Rodzaj zasiłku'@,,,'radio-buttons',,
                                              'Rodzinny'@,"'R'",'Pielęgnacyjny'@,"'P'",'Wychowawczy'@,"'W'");
      __param.win_efld(__edit,,'OD1',,,11,,,'Data od'@);
      __param.win_efld(__edit,,'DO1',,,11,,,'Data do'@);
      __param.win_ecol(__edit);
      __param.win_esep(__edit,' ');
      __param.win_efld(__edit,,'RODZAJ2',,,,,,'Rodzaj zasiłku'@,,,'radio-buttons',,'Pomiń'@,"''",
                                              'Rodzinny'@,"'R'",'Pielęgnacyjny'@,"'P'",'Wychowawczy'@,"'W'");
      __okredit(0);

      __param.fld_fml('RODZAJ2','AFTER_EDIT',"__okredit(__param.RODZAJ2)");
      __param.win_efld(__edit,,'OD2',,,11,,,'Data od'@);
      __param.efld_opt(__edit,'enable='+$(+__param.RODZAJ2),,'OD2');
      __param.win_efld(__edit,,'DO2',,,11,,,'Data do'@);
      __param.efld_opt(__edit,'enable='+$(+__param.RODZAJ2),,'DO2');
      __param.win_ecol(__edit);
      __param.win_esep(__edit,' ');
      __param.win_efld(__edit,,'RODZAJ3',,,,,,'Rodzaj zasiłku'@,,,'radio-buttons',,'Pomiń'@,"''",
                                              'Rodzinny'@,"'R'",'Pielęgnacyjny'@,"'P'",'Wychowawczy'@,"'W'");
      __okred(0);

      __param.fld_fml('RODZAJ3','AFTER_EDIT',"__okred(__param.RODZAJ3)");
      __param.win_efld(__edit,,'OD3',,,11,,,'Data od'@);
      __param.efld_opt(__edit,'enable='+$(+__param.RODZAJ3),,'OD3');
      __param.win_efld(__edit,,'DO3',,,11,,,'Data do'@);
      __param.efld_opt(__edit,'enable='+$(+__param.RODZAJ3),,'DO3');
      __param.win_ecol(__edit);
      __param.efld_opt(__edit,'mark=1',,'OD1');
      __param.efld_opt(__edit,'mark=1',,'DO1');

      exec('ok_esc','#window',__param,__edit);
      __param.fld_fml('OD1','AFTER_EDIT',"{? __param.OD1=#0
                                         || FUN.emsg('Data początku okresu musi być wypełniona.'@); 0
                                         |? __param.OD1>__param.DO1 & __param.DO1<>#0
                                         || FUN.emsg('Data początku okresu nie może być większa od daty końcowej.'@); 0
                                         || 1
                                         ?}");
      __param.fld_fml('DO2','AFTER_EDIT',"{? __param.DO2=#0
                                         || FUN.emsg('Data końca okresu musi być wypełniona.'@); 0
                                         |? __param.OD2>__param.DO2 & __param.DO2<>#0
                                         || FUN.emsg('Data początku okresu nie może być większa od daty końcowej.'@); 0
                                         || 1
                                         ?}");
      __param.fld_fml('DO3','AFTER_EDIT',"{? __param.DO3=#0
                                         || FUN.emsg('Data końca okresu musi być wypełniona.'@); 0
                                         |? __param.OD3>__param.DO3 & __param.DO3<>#0
                                         || FUN.emsg('Data początku okresu nie może być większa od daty końcowej.'@); 0
                                         || 1
                                         ?}");
      __param.win_edit(__edit);
      {? par[15]:=__param.edit("
                  {? __param.RODZAJ1<>''
                  || {? __param.OD1~1<=1900
                     || FUN.emsg('Brak wypełnienia daty w parametrach wydruku.'@); return('OD1')
                     |? __param.DO1~1<=1900
                     || FUN.emsg('Brak wypełnienia daty w parametrach wydruku.'@); return('DO1')
                     |? __param.OD1>__param.DO1 & __param.DO1<>#0
                     || FUN.emsg('Data początku okresu nie może być większa od daty końcowej.'@); return('OD1')
                     ?}
                  ?};
                  {? __param.RODZAJ2<>''
                  || {? __param.OD2~1<=1900
                     || FUN.emsg('Brak wypełnienia daty w parametrach wydruku.'@); return('OD2')
                     |? __param.DO2~1<=1900
                     || FUN.emsg('Brak wypełnienia daty w parametrach wydruku.'@); return('DO2')
                     |? __param.OD2>__param.DO2 & __param.DO2<>#0
                     || FUN.emsg('Data początku okresu nie może być większa od daty końcowej.'@); return('OD2')
                     ?}
                  ?};
                  {? __param.RODZAJ3<>''
                  || {? __param.OD3~1<=1900
                     || FUN.emsg('Brak wypełnienia daty w parametrach wydruku.'@); return('OD3')
                     |? __param.DO3~1<=1900
                     || FUN.emsg('Brak wypełnienia daty w parametrach wydruku.'@); return('DO3')
                     |? __param.OD3>__param.DO3 & __param.DO3<>#0
                     || FUN.emsg('Data początku okresu nie może być większa od daty końcowej.'@); return('OD3')
                     ?}
                  ?}; 1
                               ")

      || par[1]:=obj_new(@.CLASS.PRINT,14);
         par[1].add("par[8][1]",3,'Lp.'@);
         par[1].add("par[8][2]",5,'Lista'@,1);
         par[1].add("''",10,'Nr pozycji'@,1);
         par[1].add("par[8][3]$1",10,'Data'@,1);
         par[1].add("par[8][4]",20,'Zasiłek rodzinny'@,1);
         par[1].add("par[8][5]",20,'Zasiłek pielęgancyjny'@,1);
         par[1].add("par[8][6]",20,'Zasiłek wychowawczy'@,1);
         par[1].add("par[8][7]",10,'Kwota'@,1,,,,,'12,2');
         par[1].s_frame();

         par[12]:=obj_new(@.CLASS.PRINT,8);
         par[12].add("''",3,'1');
         par[12].add("''",5,'2');
         par[12].add("''",10,'3');
         par[12].add("''",10,'4');
         par[12].add("''",20,'5');
         par[12].add("''",20,'6');
         par[12].add("''",20,'7');
         par[12].add("''",10,'8');
         par[12].s_frame();

         par[13]:=tab_tmp(,'REF','INTEGER','Reference');
         prn1:='par[1]';
         lmt:=rsep:=0;
         vp:=1;
         par[11]:=0;
         zdate:=date(0,0,0);

         par[5]:=obj_new(3);
         par[6]:=obj_new(3);
         par[7]:=obj_new(3);
         {? __param.RODZAJ1<>'' | __param.RODZAJ2<>'' | __param.RODZAJ3<>''
         || par[5][1]:=__param.OD1;par[5][2]:=__param.DO1; par[5][3]:=__param.RODZAJ1;
            par[6][1]:=__param.OD2;par[6][2]:=__param.DO2; par[6][3]:=__param.RODZAJ2;
            par[7][1]:=__param.OD3;par[7][2]:=__param.DO3; par[7][3]:=__param.RODZAJ3
         || FUN.emsg('Brak zaznaczonej opcji w parametrach wydruku.'@); return(0)
         ?};
         par[4]:=1;
         par[8]:=obj_new(7);
         par[8][1]:=0;
         par[8][4]:=par[8][5]:=par[8][6]:='';

         par[9]:=obj_new(10);
         par[9][1]:=539;
         par[9][2]:=540;
         par[9][3]:=0;
         par[9][4]:=535;
         par[9][5]:=536;
         par[9][6]:=0;
         par[9][7]:=520;
         par[9][8]:=521;
         par[9][9]:=0;
         par[9][10]:=0;
         par[3]:=0;
         par[4]:=1;
         params_set('P',exec('wybierz_parses','pracownik','PPL').P)
      ?}
   ?};
   P.cntx_psh;
   LS.cntx_psh;
   O.cntx_psh
}
{END:
   P.cntx_pop; LS.cntx_pop; O.cntx_pop; FUNKCJE.OTWOLIST();
   VAR_DEL.delete('par','prn1','vp','lmt','rsep','tresc','zdate','__edit','__param','__okredit','__okred')
}
{EXIT: ~par[15]}
{EXIT: ~params_get().P.first()}
{COMMENT}OLD: pwypzas.rpm{COMMENT-}
{COMMENT}OLD: std_info.rpi{COMMENT-}
{COMMENT}OLD: skid_pw.rpi{COMMENT-}
{COMMENT}OLD: oddzial.rpi{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}
══════════════════════════════════════════════════════════════════════════════

   K O N F I G U R A C J A   -   N A G Ł Ó W E K,   S T O P K A

{COMMENT-}
{HEADER}
{IF: par[3]}
     {SUBSTITUTE: 'HEAD'}
{FI}
{FONT: 'T8GB'}
{SPACE: 'C'}
{LINE}
{HEADER-}
{FOOTER: 0}
{REP: par[1].flbar(lmt)}
{<20}ZUS Z-9
{par[11]:=1;~~}
{FOOTER-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}
══════════════════════════════════════════════════════════════════════════════

   M A K R O D E F I N I C J E

{COMMENT-}
{MACRO: 'pracownik'}
{FONT: 'W10'}
{SPACE: 'B'}
{FONT: 'T8G'}
{SPACE: 'C'}




{<1}{P.OSOBA().NAZWISKO} {P.OSOBA().PIERWSZE} {<100}{P.OSOBA().UR_DATA}
{<1}{'(imię i nazwisko ubezpieczonego)'@} {<100}{'(data urodzenia)'@}


{IF: exec('szukaj','osoba')<>null}
{<1}{exec('poczta','osoba')}
{<1}{exec('ulica','osoba')} {<100}{OSOBA.PESEL}, {OSOBA.NIP}
{<1}{'(adres zamieszkania)'@} {<100}{'(Nr PESEL i NIP)'@}
{ELSE}
  {<1} {' brak adresu'@}
{FI}
{MACRO-}
{MACRO: 'zasilki'}

{<1}{ {? par[5][3]='R'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku rodzinnego'@[par[5][1]$1,par[5][2]$1]
      |? par[5][3]='P'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku pielęgnacyjnego'@[par[5][1]$1,par[5][2]$1]
      |? par[5][3]='W'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku wychowawczego'@[par[5][1]$1,par[5][2]$1]
      ?}
    }

{IF: par[6][3]<>''}
{<1}{ {? par[6][3]='R'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku rodzinnego'@[par[6][1]$1,par[6][2]$1]
      |? par[6][3]='P'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku pielęgnacyjnego'@[par[6][1]$1,par[6][2]$1]
      |? par[6][3]='W'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku wychowawczego'@[par[6][1]$1,par[6][2]$1]
      ?}
    }
{FI}

{IF: par[7][3]<>''}
{<1}{ {? par[7][3]='R'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku rodzinnego'@[par[7][1]$1,par[7][2]$1]
      |? par[7][3]='P'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku pielęgnacyjnego'@[par[7][1]$1,par[7][2]$1]
      |? par[7][3]='W'
      || ' - ustalono prawo w okresie od %1 do %2 do zasiłku wychowawczego'@[par[7][1]$1,par[7][2]$1]
      ?}
    }

{FI}
{MACRO-}
{MACRO: 'licz'}
{FUNKCJE.OTWOLIST();~~}
{par[9][3]:=0;
 par[9][6]:=0;
 par[9][9]:=0;
 par[9][10]:=0;~~
}
{WHILE: par[9][10]<3}{DO}
    {FOR: LS}{INDEX: 'OSOBAKOD'}{PREFIX: exec('ref_firma','ustawienia'),P.OSOBA,par[9][(par[9][10]*3)+1]}{DO}
                 {par[9][(par[9][10]*3)+3]+=LS.KW;~~}
    {OD}
    {FOR: LS}{INDEX: 'OSOBAKOD'}{PREFIX: exec('ref_firma','ustawienia'),P.OSOBA,par[9][(par[9][10]*3)+2]}{DO}
                 {par[9][(par[9][10]*3)+3]+=LS.KW;~~}
    {OD}
    {par[9][10]+=1;~~}
{OD}
{IF: par[9][3]<>0 & par[2]='R'}
        {par[8][1]+=1;
         par[8][7]:=par[9][3];
         par[8][2]:=O.T().T;
         par[8][3]:=O.D;
         par[8][4]:={? O.D <> zdate || O.D || date(O.R, O.M, 0) ?}$8;
         par[8][5]:='';
         par[8][6]:='';~~}
        {SUBSTITUTE: 'tab'}
{FI}
{IF: par[9][6]<>0 & par[2]='P'}
        {par[8][1]+=1;
         par[8][7]:=par[9][6];
         par[8][2]:=O.T().T;
         par[8][3]:=O.D;
         par[8][4]:='';
         par[8][5]:={? O.D <> zdate || O.D || date(O.R, O.M, 0) ?}$8;
         par[8][6]:='';~~}
        {SUBSTITUTE: 'tab'}
{FI}
{IF: par[9][9]<>0 & par[2]='W'}
        {par[8][1]+=1;
         par[8][7]:=par[9][9];
         par[8][2]:=O.T().T;
         par[8][3]:=O.D;
         par[8][4]:='';
         par[8][5]:='';
         par[8][6]:={? O.D <> zdate || O.D || date(O.R, O.M, 0) ?}$8;~~}
        {SUBSTITUTE: 'tab'}
{FI}
{MACRO-}
{MACRO: 'naglowek'}
  {par[10].ini_head()}
  {REP: par[10].fhbar(lmt)}
  {WHILE: par[10].h_next()}
  {DO}
     {REP: par[10].h_fmline(lmt)}
  {OD}
  {REP: '{<{lmt+1}}'+par[10].jbar(par[1])}
  {par[1].ini_head()}
  {WHILE: par[1].h_next()}
  {DO}
     {REP: par[1].h_fmline(lmt)}
  {OD}
  {REP: par[1].fbar(lmt)}
  {par[12].ini_head()}
  {WHILE: par[12].h_next()}
  {DO}
     {REP: par[12].h_fmline(lmt)}
  {OD}
  {REP: par[1].fbar(lmt)}
{MACRO-}
{MACRO: 'tab'}
{IF: ~par[3] & par[11]}
  {SUBSTITUTE: 'naglowek'}
  {par[11]:=0;~~}
{FI}
{IF: par[3]}
  {SUBSTITUTE: 'pracownik'}
  {SUBSTITUTE: 'zasilki'}
  {SUBSTITUTE: 'naglowek'}
  {par[3]:=0;~~}
{FI}
{par[1].ini_line();~~}
{REP: par[1].fline(lmt)}
{MACRO-}
{MACRO: tresc}
{IF: ~par[13].find_key(P.OSOBA)}
   {par[13].REF:=P.OSOBA;par[13].add;~~}
   {par[3]:=1;~~}
   {par[2]:=par[5][3];~~}
   {FOR: O}
   {INDEX: 'LISTYPLA'}
   {FROM: exec('ref_firma','ustawienia'),__F_ZATR.P,par[5][1]~1,par[5][1]~2}
   {TO: exec('ref_firma','ustawienia'),__F_ZATR.P,par[5][2]~1,par[5][2]~2}{DO}
      {SUBSTITUTE: 'licz'}
   {OD}
   {par[2]:=par[6][3];~~}
   {IF: par[6][3]<>''}
      {FOR: O}
      {INDEX: 'LISTYPLA'}
      {FROM: exec('ref_firma','ustawienia'),__F_ZATR.P,par[6][1]~1,par[6][1]~2}
      {TO: exec('ref_firma','ustawienia'),__F_ZATR.P,par[6][2]~1,par[6][2]~2}{DO}
         {SUBSTITUTE: 'licz'}
      {OD}
   {FI}
   {par[2]:=par[7][3];~~}
   {IF: par[7][3]<>''}
      {FOR: O}
      {INDEX: 'LISTYPLA'}
      {FROM: exec('ref_firma','ustawienia'),__F_ZATR.P,par[7][1]~1,par[7][1]~2}
      {TO: exec('ref_firma','ustawienia'),__F_ZATR.P,par[7][2]~1,par[7][2]~2}{DO}
         {SUBSTITUTE: 'licz'}
      {OD}
   {FI}
   {IF: par[3]=0}
      {WHILE: lineleft-1}{DO}
         {REP: par[1].fline(lmt)}
      {OD}
      {PAGE}
      {par[8][1]:=0;par[11]:=0;~~}
   {FI}
{FI}
{MACRO-}
{COMMENT}
══════════════════════════════════════════════════════════════════════════════

   Z A W A R T O Ś Ć   W Y D R U K U

{COMMENT-}
{FONT: 'T8G'}
{SPACE: 'C'}
{ lmt:=int((charleft-par[1].width())/2); ~~ }
{FOR: params_get().P}
{DO}
{IF: P.seek(params_get().P.SQL,,1)}
      {SUBSTITUTE: tresc}
{FI}
{OD}