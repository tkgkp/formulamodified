:!UTF-8
{TITLE:A. Urzędowe poświadczenie odbioru}
{PRINTER: exec('prt','param_wydr','v',KST),,,,,,,,,,,,1,17,15,10,,,1}
{BEGIN:
   kl:='0:0:0,240:240:240'; bl:='0:0:0,255:255:255'; ks:='0:0:0,200:200:200'; i:=0;
   SKID.TYP_ZAP:=SKID.DEKL_NAZ; __nomsg:=0; __ok:=0;
   VAR_DEL.delete('__P_UPR');
   __P_UPR:=exec('dostepne_p','schemat','PPL',P_FILTER.F_ZATR().KOD,'*');
   __P_UPR.prefix()
}
{END:
   &kl; &bl; &ks; &i; VAR_DEL.delete('upo','ver_upo','__nomsg','__ok','__P_UPR')
}
{COMMENT}
gr - tekst pogrubiony dla poszczególnych pozycji sprawozdania
zw - tekst zwykły dla poszczególnych pozycji sprawozdania
tyt - tytuł sprawozdania
ptyt - podtytuł sprawozdania
ppkt - podpunkt sprawozdania np. E.1.
op - tytuł dla tekstu wolnego (objaśnienia lub pouczenia)
{COMMENT-}
{DEFINEFONT: 'gr=Arial,110,r,8'}
{DEFINEFONT: 'tyt=Arial,120,f,8'}
{DEFINEFONT: 'ptyt=Arial,80,f,8'}
{DEFINEFONT: 'zw=Arial,120,e,8'}
{DEFINEFONT: 'zws=Arial,100,i,8'}
{DEFINEFONT: 'zwn=Arial,120,q,8'}
{DEFINEFONT: 'ppkt=Arial,80,e,8'}
{DEFINEFONT: 'op=Arial,80,q,8'}
{SPACE: 'd'}{FONT: 'q'}
{FOR: VAT_DEK}
{INDEX: 'VAT_PITG'}
{PREFIX: PIT_GRUP.ref}
{DO}
{IF: __P_UPR.find_key($VAT_DEK.P)}
{FOR: E_DEK}
{INDEX: 'DATA_ONE'}
{PREFIX: BPMN.SYM_DOM,SKID.TYP_ZAP,VAT_DEK.ref()}
{DO}
{IF: E_DEK.DATA_AKC<>date(0,0,0) & E_DEK.PLIK_AKC}
{ _kod:=exec('set_upo','xml',E_DEK,'PLIK_AKC',E_DEK.DATA_WYS);
  __ok:=1;
  {? _kod='3' & (ver_upo<>'' & ver_upo<>'4-0' & ver_upo<>'5-0' & ver_upo<>'6-0')
  || __ok:=0
  ?};
  {? ~__ok
  || {? ~__nomsg
     || FUN.info('Wykryto nową wersję UPO %1.\nWymagana aktualizacja oprogramowania.\n'
                 'Wydruk potwierdzenia UPO w wersji %1 nie zostanie wykonany.'@[ver_upo]);
        __nomsg:=1
     ?}
  ?};
~~}
{IF: __ok}
{IF: ver_upo=''}
{DIRECT}
{SPACE: 'd'}{REP: '{INCLUDE: wsp_upo3.rpi}'}
{DIRECT-}
{ELSE}
{DIRECT}
{SPACE: 'd'}{REP: '{INCLUDE: wsp_upo4.rpi}'}
{DIRECT-}
{FI}
{PAGE}
{FI}
{FI}
{OD}
{FI}
{OD}