:!UTF-8
{ KOL_WYDR.first(); KOL_WYDR.next(); _w:=0; czy_w:=0; _ikl:=1;
  {? rep_export=1 || _ikl+=1; PRN.add("w[33]",20,'Analityka');PRN0.add("''",20,'') ?};
  {? rep_export=1 || _ikl+=1; PRN.add("w[34]",50,'Opis konta księgowego');PRN0.add("''",50,'') ?};
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[2]",KOL_WYDR.SZER-1,'Jed. ks.');PRN0.add("''",KOL_WYDR.SZER-1,'');            ks1+=KOL_WYDR.SZER ?}; {? odd | (~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK) || str_sql+=', ODD.OD as F2'; w_join+='ODD,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[3]",KOL_WYDR.SZER-1,'Zarejestrował');PRN0.add("''",KOL_WYDR.SZER-1,'');       ks1+=KOL_WYDR.SZER; str_sql+=', DOK.ZAR as F3' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[4]",KOL_WYDR.SZER-1,'D. oper.');PRN0.add("''",KOL_WYDR.SZER-1,'');            ks1+=KOL_WYDR.SZER ?};
     {? WYDRUKI.P1=0 | (~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK) || str_sql+=', DOK.DOP as F4'; w_join+='DOK,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[5]",KOL_WYDR.SZER-1,'D. zapisu.');PRN0.add("''",KOL_WYDR.SZER-1,'');          ks1+=KOL_WYDR.SZER ?};
     {? WYDRUKI.P1=1 | (~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK) || str_sql+=', DOK.DTW as F5'; w_join+='DOK,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[6]",KOL_WYDR.SZER-1,'Nr w dz.');PRN0.add("''",KOL_WYDR.SZER-1,'');            ks1+=KOL_WYDR.SZER; str_sql+=', DOK.NRDZ as F6' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[7]",KOL_WYDR.SZER-1,'Rejestr/nr');PRN0.add("''",KOL_WYDR.SZER-1,'');          ks1+=KOL_WYDR.SZER ?};
     {? ROZNE.KODREJ<>'' || str_sql+=', REJ.KOD as F7A'; w_join+=',REJ,' ?};
     {? (~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK) || str_sql+={? ROZNE.KODREJ='' || w_join+=',REJ,';', REJ.KOD as F7A' || '' ?}+', DOK.NR as F7B' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[8]",KOL_WYDR.SZER-1,'Symbol dokumentu');PRN0.add("''",KOL_WYDR.SZER-1,'');    ks1+=KOL_WYDR.SZER; str_sql+=', DOK.NK as F8' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[7]",KOL_WYDR.SZER-1,'Opis dokumentu');PRN0.add("''",KOL_WYDR.SZER-1,'');      ks1+=KOL_WYDR.SZER; str_sql+=', DOK.TR as F9' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[10]",KOL_WYDR.SZER-1,'Rodzaj dokumentu');PRN0.add("''",KOL_WYDR.SZER-1,'');   ks1+=KOL_WYDR.SZER; str_sql+=', DOK_REJ.NAZ as F10' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[11]",KOL_WYDR.SZER-1,'Data wyst.');PRN0.add("''",KOL_WYDR.SZER-1,'');         ks1+=KOL_WYDR.SZER; str_sql+=', DOK.DTO as F11' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[12]",KOL_WYDR.SZER-1,'Data otrz.');PRN0.add("''",KOL_WYDR.SZER-1,'');         ks1+=KOL_WYDR.SZER; str_sql+=', DOK.D4 as F12' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[13]",KOL_WYDR.SZER-1,'Data akc.');PRN0.add("''",KOL_WYDR.SZER-1,'');          ks1+=KOL_WYDR.SZER; str_sql+=', DOK.DAKC as F13' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[14]",KOL_WYDR.SZER-1,'Korekta dokumentu');PRN0.add("''",KOL_WYDR.SZER-1,'');  ks1+=KOL_WYDR.SZER; str_sql+=', DOK.KOR as F14' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[15]",KOL_WYDR.SZER-1,'Rej. VAT');PRN0.add("''",KOL_WYDR.SZER-1,'');           ks1+=KOL_WYDR.SZER; str_sql+=', VAT_REJ.SYM as F15'; w_join+='VAT_REJ,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[16]",KOL_WYDR.SZER-1,'Okres VAT');PRN0.add("''",KOL_WYDR.SZER-1,'');          ks1+=KOL_WYDR.SZER; str_sql+=', ROK_F.NAZ||\' \'||OKRO_F.NAZ as F16' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[17]",KOL_WYDR.SZER-1,'Źródło pochodzenia');PRN0.add("''",KOL_WYDR.SZER-1,''); ks1+=KOL_WYDR.SZER; str_sql+=', SLUWYS.NAZ as F17'; w_join+='SLUWYS,SLOWYS,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[18]",KOL_WYDR.SZER-1,'Kod');PRN0.add("''",KOL_WYDR.SZER-1,'');                ks1+=KOL_WYDR.SZER; str_sql+=', SLOWYS.KOD as F18'; w_join+='SLOWYS,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[19]",KOL_WYDR.SZER-1,'Dodatkowy słownik');PRN0.add("''",KOL_WYDR.SZER-1,'');  ks1+=KOL_WYDR.SZER; str_sql+=', DODSLU.NAZ as F19'; w_join+='DODSLU,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[20]",KOL_WYDR.SZER-1,'Pozycja');PRN0.add("''",KOL_WYDR.SZER-1,'');            ks1+=KOL_WYDR.SZER; str_sql+=', DODSLO.KOD as F20'; w_join+='DODSLO,' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[21]",KOL_WYDR.SZER-1,'Dokument źródł.');PRN0.add("''",KOL_WYDR.SZER-1,'');    ks1+=KOL_WYDR.SZER; str_sql+=', DOK.DOKZRODL as F21' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || _ikl+=1; PRN.add("w[22]",KOL_WYDR.SZER-1,'Poz.');PRN0.add("''",KOL_WYDR.SZER-1,'');               ks1+=KOL_WYDR.SZER; str_sql+=', POZ.POZ as F22' ?}; KOL_WYDR.next();
  {? +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("w[23]",KOL_WYDR.SZER-1,{? ~UNPAR.P3
                                                         || 'Treść zapisu'
                                                         || 'Okres obrachunkowy'
                                                         ?});PRN0.add("w[23]",KOL_WYDR.SZER-1,''); ks1+=KOL_WYDR.SZER; str_sql+=', POZ.OP as F23' ?}; KOL_WYDR.next();PRNS.add("w[1]",ks1-1,'',,,,,,,,_ikl); _w:=ks1;
  {? +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("form(w[24],,2,' ,')",KOL_WYDR.SZER-1,'WN ('+(3+FINFO.NAROD().KOD)+')',1); PRN0.add("form(w[24],,2,' ,')",KOL_WYDR.SZER-1,'',1); PRNS.add("form(w[24],,2,' ,')",KOL_WYDR.SZER-1,'',1); ks1+=KOL_WYDR.SZER; _w:=ks1; str_sql+=', case POZ.STR when \'Wn\' then POZ.SUM else 0 end as F24' ?}; KOL_WYDR.next();
  {? +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("form(w[25],,2,' ,')",KOL_WYDR.SZER-1,'MA ('+(3+FINFO.NAROD().KOD)+')',1); PRN0.add("form(w[25],,2,' ,')",KOL_WYDR.SZER-1,'',1); PRNS.add("form(w[25],,2,' ,')",KOL_WYDR.SZER-1,'',1); ks1+=KOL_WYDR.SZER; _w:=ks1; str_sql+=', case POZ.STR when \'Ma\' then POZ.SUM else 0 end as F25' ?}; KOL_WYDR.next();
  {? +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("w[26]",KOL_WYDR.SZER-1,'Wal');PRN0.add("''",KOL_WYDR.SZER-1,''); ks1+=KOL_WYDR.SZER ?};  str_sql+=', SLOWAL.KOD as F26'; w_join+='SLOWAL,'; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("{? +w[26] || form(w[27],,4,' ,') || '' ?}",KOL_WYDR.SZER-1,'Kurs',1);PRN0.add("''",KOL_WYDR.SZER-1,'');ks1+=KOL_WYDR.SZER; str_sql+=', POZ.KURS as F27' ?}; KOL_WYDR.next();
  {? +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("{? +w[26] || form(w[28],,2,' ,') || '' ?}",KOL_WYDR.SZER-1,'WN '+{? ~wal ||'(waluta)'||'('+(3+SSTALE.WAL().KOD)+')'?},1);PRN0.add("form(w[28],,2,' ,')",KOL_WYDR.SZER-1,'',1);{? ks1>_w || PRNS.add("''",ks1-_w-1,'') ?}; PRNS.add("form(w[28],,2,' ,')",KOL_WYDR.SZER-1,'',1); ks1+=KOL_WYDR.SZER; _w:=ks1; czy_w+=1; str_sql+=', case POZ.STR when \'Wn\' then POZ.SUMW else 0 end as F28' ?}; KOL_WYDR.next();
  {? +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("{? +w[26] || form(w[29],,2,' ,') || '' ?}",KOL_WYDR.SZER-1,'MA '+{? ~wal ||'(waluta)'||'('+(3+SSTALE.WAL().KOD)+')'?},1);PRN0.add("form(w[29],,2,' ,')",KOL_WYDR.SZER-1,'',1);{? ks1>_w || PRNS.add("''",ks1-_w-1,'') ?}; PRNS.add("form(w[29],,2,' ,')",KOL_WYDR.SZER-1,'',1); ks1+=KOL_WYDR.SZER; _w:=ks1; czy_w+=1; str_sql+=', case POZ.STR when \'Ma\' then POZ.SUMW else 0 end as F29' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("{?w[30]='() '||''||w[30]?}",KOL_WYDR.SZER-1,'(Typ) Symbol rozr.');PRN0.add("''",KOL_WYDR.SZER-1,''); ks1+=KOL_WYDR.SZER; str_sql+=', \'(\'||POZ.TID||\')\'||\' \'||POZ.ID as F30' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("w[31]",KOL_WYDR.SZER-1,'Data otw.');PRN0.add("''",KOL_WYDR.SZER-1,'');          ks1+=KOL_WYDR.SZER; str_sql+=', POZ.DO as F31' ?}; KOL_WYDR.next();
  {? ~UNPAR.P3 & +KOL_WYDR.WSK_DRUK & 'XW'*KOL_WYDR.WSK_DRUK || PRN.add("w[32]",KOL_WYDR.SZER-1,'Termin pł.');PRN0.add("''",KOL_WYDR.SZER-1,'');          ks1+=KOL_WYDR.SZER; str_sql+=', POZ.TP as F32' ?}; KOL_WYDR.next();
  {? ks1>_w || PRNS.add("''",ks1-_w-1,'') ?};
  PAR_WYDR.TITLE:='KARTOTEKA ZAPISÓW KSIĘGOWYCH DLA '+{? WYDRUKI.P1=2 || 'OKRESU OD '+ROZNE.UT_OKROD().NAZ+' DO '+ROZNE.UT_OKRDO().NAZ || 'ZAKRESU DAT OD '+ROZNE.DATA_OD$6+' DO '+ROZNE.DATA_DO$6 ?};
  lmt:=int((charleft()-PRN.width())/2);
  {? ks1-1>0 || PRN1.add("w[1]",ks1-1,'') ?};
  {! _i:=1..4 |! so[_i]:=sk[_i]:=sr[_i]:=sn[_i]:=sb[_i]:=sob[_i]:=ssb[_i]:=ssob[_i]:=ssn[_i]:=0 !};~~}
{INCLUDE: wsp_pw.rpi}
{MACRO: 'LPRN0'}
{ll:=lineleft(); ~~}
{IF: _f:=prn1+'.ini_line()'; _v:=($(_f))();
     _f:=prn1+'.length()';   _v:=($(_f))();
     ll<(rsep+_v) & ll<>0}{PAGE}{FI}
{IF: vp}
   { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
   {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
   { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
{ELSE}
   {IF: PAR_WYDR.RSEP & rsep}
      {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
   {ELIF: rsep}
      {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
   {FI}
{FI}
{PRN0.ini_line();~~}
{IF: ~UNPAR.P3 | ('NARASTAJĄCO|SALDO|BO |OBROTY OKRESU '*w[23])>0 | (w[23]*'OBROTY DO:')>0}
{FONT: 'T8GB'}
{ELSE}
{FONT:'T8G'}
{FI}
{SPACE:'C'}
{WHILE: PRN0.next()}
{DO}
{REP: PRN0.fline(lmt)}
{OD}
{FONT:'T8G'}{SPACE:'C'}
{MACRO-}
{MACRO: 'SKONTO'}
{ w[23]:='NARASTAJĄCO'; w[24]:=sk[1]; w[25]:=sk[2]; {? p_wal & p || w[28]:=sk[3]; w[29]:=sk[4] || w[28]:=w[29]:=''?};~~}
{SUBSTITUTE: 'LPRN0'}
{IF: PAR_WYDR.SAL}
 { w[23]:='SALDO'; w[24]:={? sk[1]>sk[2] || sk[1]-sk[2] || 0 ?}; w[25]:={? sk[2]>sk[1] || sk[2]-sk[1] || 0 ?};
   {? p_wal & p || w[28]:={? sk[3]>sk[4] || sk[3]-sk[4] || 0 ?}; w[29]:={? sk[4]>sk[3] || sk[4]-sk[3] || 0 ?} || w[28]:=w[29]:=''?};~~}
 {SUBSTITUTE: 'LPRN0'}
{FI}
{{!_i:=1..4|! sk[_i]:=0 !}; p:=0; ~~}
{MACRO-}
{MACRO: 'SOKRES'}
{ p_wal:=0;
  {? czy_w & (T_WAL.prefix(kont); T_WAL.first())
  || _w:=0; p_wal:=1; {!|? {? form(T_WAL.F26)<>'' || _w+=1 ?}; T_WAL.next() !}; {? _w>1 || p_wal:=0 ?}
  |? czy_w & SSTALE.WAL<>FINFO.NAROD
  || p_wal:=1; p:=1
  ?};
  {? vn=1
  || w[23]:='OBROTY DO: '+{? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NAZ || ROZNE.DATA_OD$6 ?}+{? ROZNE.KODREJ<>'~BO' || ' (z BO)' || '' ?};
     w[24]:=sn[1]; ssn[1]+=sn[1]; w[25]:=sn[2]; ssn[2]+=sn[2];
     {? p_wal & p || w[28]:=sn[3]; ssn[3]+=sn[3]; w[29]:=sn[4]; ssn[4]+=sn[4] || w[28]:=w[29]:=''?}
  |? vn=2
  || w[23]:='BO '; w[24]:=sb[1]; w[25]:=sb[2]; ssb[1]+=sb[1]; ssb[2]+=sb[2];
     {? p_wal & p || w[28]:=sb[3]; ssb[3]+=sb[3]; w[29]:=sb[4]; ssb[4]+=sb[4] || w[28]:=w[29]:=''?}
  |? vn=3
  || w[23]:='OBROTY '+{? WYDRUKI.P1=2 || 'OKRESU ' || 'W ZAKRESIE DAT ' ?};
     w[24]:=sob[1]; w[25]:=sob[2]; ssob[1]+=sob[1]; ssob[2]+=sob[2];
     {? p_wal & p || w[28]:=sob[3]; ssob[3]+=sob[3]; w[29]:=sob[4]; ssob[4]+=sob[4] || w[28]:=w[29]:=''?}
  |? vn=4
  || w[23]:=13*' '+'NARASTAJĄCO';
     w[24]:=sk[1]; w[25]:=sk[2];
     {? p_wal & p || w[28]:=sk[3]; w[29]:=sk[4] || w[28]:=w[29]:='' ?}
  |? vn=5
  || w[23]:=13*' '+'SALDO';
     w[24]:=F.SWn(sk[1],sk[2]); w[25]:=F.SMa(sk[1],sk[2]);
     {? p_wal & p || w[28]:=F.SWn(sk[3],sk[4]); w[29]:=F.SMa(sk[3],sk[4]) || w[28]:=w[29]:='' ?}
  || OKRO_F.index('ROK'); OKRO_F.prefix; w[23]:={? UNPAR.P3 || '' || 'obroty: ' ?}; w[24]:=so[1]; w[25]:=so[2];
     sob[1]+=so[1]; sob[2]+=so[2];
     {? p_wal & p || w[28]:=so[3]; w[29]:=so[4]; sob[3]+=so[3]; sob[4]+=so[4] || w[28]:=w[29]:='' ?};
     {? OKRO_F.find_key(SSTALE.AR,#okres) || w[23]+=OKRO_F.NAZ ?}
  ?}; rsep:=0;~~}
{SUBSTITUTE: 'LPRN0'}
{{!_i:=1..4|! so[_i]:=0 !}; {? vn=3 || {!_i:=1..4|! sob[_i]:=0 !} ?};~~}
{MACRO-}
{COMMENT}  -----------------------------------   HEADER  -------------------------------------------   {COMMENT-}
{HEADER}
{LINE: 1}
{FONT: 'HEAD'}{SUBSTITUTE: 'HEAD'}
{FONT: 'T8G'}{SPACE: 'C'}
{IF: page=1}
{LINE: 1}
{<1 'PARAMETRY WYDRUKU:'}
{<1 'Rok bilansowy: '+SSTALE.AR().NAZ} {<45 'Jednostka księgowa: '+{? odd || OPERATOR.DEPT().OD || 'wszystkie jednostki księgowe' ?}}
{<1 'Waluta: '+SSTALE.WAL().KOD+' - '+SSTALE.WAL().TR} {<45 kontotxt}
{IF: +ROZNE.KODREJ | PAR_WYDR.ZSAL}{<1 {? ROZNE.KODREJ<>'' || 'Rejestr: '+ROZNE.KODREJ || 'Z kontami z zerowym saldem' ?}}{FI}{IF: UNPAR.P3}{<45 'Bez zapisów księgowych'}{FI}
{IF: +ROZNE.KODREJ & PAR_WYDR.ZSAL}{<1 'Z kontami z zerowym saldem'}{FI}
{<1 {? WYDRUKI.P1=2 || 'Dla okresu od '+ROZNE.UT_OKROD().NAZ+' do '+ROZNE.UT_OKRDO().NAZ || 'Dla zakresu dat '+
    {? WYDRUKI.P1=0 || 'operacji' || 'zapisu' ?}+' od '+ROZNE.DATA_OD$6+' do '+ROZNE.DATA_DO$6 ?}}
{LINE: 1}
{FI}
{FONT: 'T8GB'}{SPACE: 'C'}
{prn1:='PRN';~~}{SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}{IF: rep_export=1}{TR}{FI}
{HEADER-}
{COMMENT}  ----------------------------------- SIGNATURE -------------------------------------------   {COMMENT-}
{IF: rep_export=0}{SUBSTITUTE: 'FOOT'}{FI}
{COMMENT}  -----------------------------------   FOOTER  -------------------------------------------   {COMMENT-}
{FOOTER:0}
{REP: _f:=prn1+'.flbar(lmt)'; ($(_f))()}
{vp:=1;~~}
{FOOTER-}
{COMMENT}  -----------------------------------   WYDRUK  -------------------------------------------   {COMMENT-}
{ {? odd || sql_war+='and ODD.OD=\''+OPERATOR.DEPT().OD+'\' '; w_join+='ODD,' ?};
  {? ROZNE.KODREJ<>'' || sql_war+='and REJ.KOD=\''+ROZNE.KODREJ+'\' ' ?};
  {? SSTALE.WAL<>FINFO.NAROD || sql_war+='and SLOWAL.KOD=\''+SSTALE.WAL().KOD+'\' '; w_join+='SLOWAL,'?};
  {? 1+str_sql=',' || str_sql:=1-str_sql ?}; {? 3+sql_war='and' || sql_war:=4-sql_war ?};
  {? WYDRUKI.P1=2
  || sqlmfd:=exec('getmaskf','dok_fks',WYDRUKI.P1=2,SSTALE.AR,0,0,ROZNE.UT_OKROD().NR,ROZNE.UT_OKRDO().NR,DOK);
     sqlmfp:=exec('getmaskf','dok_fks',WYDRUKI.P1=2,SSTALE.AR,0,0,ROZNE.UT_OKROD().NR,ROZNE.UT_OKRDO().NR,POZ);
     {? PAR_WYDR.NAR & ROZNE.UT_OKROD().NR>0
     || sqlmfdn:=exec('getmaskf','dok_fks',WYDRUKI.P1=2,SSTALE.AR,0,0,0,ROZNE.UT_OKROD().NR-1,DOK);
        sqlmfpn:=exec('getmaskf','dok_fks',WYDRUKI.P1=2,SSTALE.AR,0,0,0,ROZNE.UT_OKROD().NR-1,POZ)
     ?}
  || sqlmfd:=exec('getmaskf','dok_fks',WYDRUKI.P1-1,SSTALE.AR,1,1,ROZNE.DATA_OD,ROZNE.DATA_DO,DOK);
     sqlmfp:=exec('getmaskf','dok_fks',WYDRUKI.P1-1,SSTALE.AR,1,1,ROZNE.DATA_OD,ROZNE.DATA_DO,POZ);
     {? PAR_WYDR.NAR
     || sqlmfdn:=exec('getmaskf','dok_fks',WYDRUKI.P1-1,SSTALE.AR,1,1,date(ROZNE.DATA_OD~1,1,1),ROZNE.DATA_OD-1,DOK);
        sqlmfpn:=exec('getmaskf','dok_fks',WYDRUKI.P1-1,SSTALE.AR,1,1,date(ROZNE.DATA_OD~1,1,1),ROZNE.DATA_OD-1,POZ)
     ?}
  ?};
  _slotd:=PAR_WYDR.NAR & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || dp<ROZNE.DATA_OD?} & PAR_WYDR.BO;
  sql_join:={? _slotd
               | WYDRUKI.P1<=1
               | w_join*'DOK,' | w_join*'ODD,' | w_join*',REJ,'
               | w_join*'SLOWYS,' | w_join*'DODSLU,'
               | w_join*'DODSLO,' | w_join*'VAT_REJ,'
               | w_join*'ODD,' | str_sql*' as F10'
               | str_sql*' as F16'
            || 'join @DOK using (POZ.DOK,DOK.REFERENCE) '
            || ''
            ?}+
            {? str_sql*' as F16'
            || 'left join OKRO_F using (DOK.OKRVAT,OKRO_F.REFERENCE) '+
               'left join ROK_F using (OKRO_F.ROK, ROK_F.REFERENCE) '
            || ''
            ?}
           +{? w_join*',REJ,' || 'join REJ using (DOK.REJ,REJ.REFERENCE) ' || '' ?}
           +{? _slotd
               | str_sql*' as F10'
            || 'join DOK_REJ using (DOK.DOK_REJ,DOK_REJ.REFERENCE) '
            || ''
            ?}
           +{? w_join*'SLOWYS,' || 'left join SLO as SLOWYS using (DOK.WYS,SLOWYS.REFERENCE) ' || '' ?}
           +{? w_join*'SLUWYS,' || 'left join SLU as SLUWYS using (SLOWYS.SLU,SLUWYS.REFERENCE) ' || '' ?}
           +{? w_join*'DODSLU,' || 'left join SLU as DODSLU using (DOK.DODSLU,DODSLU.REFERENCE) ' || '' ?}
           +{? w_join*'DODSLO,' || 'left join SLO as DODSLO using (DOK.DODSLO,DODSLO.REFERENCE) ' || '' ?}
           +{? w_join*'VAT_REJ,' || 'left join VAT_REJ using (DOK.RVAT,VAT_REJ.REFERENCE) ' || '' ?}
           +{? w_join*'SLOWAL,' || 'left join SLO as SLOWAL using (POZ.WAL,SLOWAL.REFERENCE) ' || '' ?}
           +{? _slotd
            || 'join SLO as SLOTD using(DOK_REJ.SLO, SLOTD.REFERENCE) '
            || ''
            ?}
           +{? w_join*'ODD,' || 'join ODD using (DOK.ODD,ODD.REFERENCE) ' || '' ?};
  TAB_SQL:=sql('select /*+MASK_FILTER(POZ,:_e) '
              +{? WYDRUKI.P1<=1 | w_join*'ODD,' | w_join*',REJ,' | w_join*'SLOWYS,' | w_join*'DODSLU,'
                  | w_join*'DODSLO,' | w_join*'VAT_REJ,' | w_join*'ODD,'
               || 'MASK_FILTER(DOK,:_f)'
               || ''
               ?}
              +' index(POZ,KON)*/ '
              +'\'P\' as REK, POZ.DOK as F0, POZ.KON as F1, '+str_sql
              +{? PAR_WYDR.NAR
               || ',cast(0 as real_type) as NWN, cast(0 as real_type) as NMA, cast(0 as real_type) as NWWN, cast(0 as real_type) as NWMA'
               || ''
               ?}
              +{? PAR_WYDR.BO
               || ',cast(0 as real_type) as BOWN, cast(0 as real_type) as BOMA, cast(0 as real_type) as BOWWN, cast(0 as real_type) as BOWMA'
               || ''
               ?}
              +{? w_join*'VAT_REJ,'
               || ', \'N\' as WVR'
               || ''
               ?}
              +' from @POZ'
              +{? ~(ROZNE.PAR4=0 | ROZNE.PAR4=2 | ROZNE.PAR4=4)
               || ' join :_g using (:_g.ANSYM,POZ.KON)'
               || ''
               ?}
              +' :_d'
              +{? sql_war<>'' || ' where :_a and ' || ' where ' ?}
              +{? (ROZNE.PAR4=0 & +form(ROZNE.PREFIX))
                  | (ROZNE.PAR4=2 & +form(ROZNE.MASKA))
                  | (ROZNE.PAR4=4 & +form(ROZNE.KS_OD().SYM) & +form(ROZNE.KS_DO().SYM))
               || ' POZ.KON '+
                  {? ROZNE.PAR4=0 | ROZNE.PAR4=2
                  || 'like \''+exec('str_sql','#sql',{? ROZNE.PAR4=0 || ROZNE.PREFIX || ROZNE.MASKA?})+'\' and '
                  || ' between \''+ROZNE.KS_OD().SYM+'\' and \''
                                  +ROZNE.KS_DO().SYM+%255+'\' and '
                  ?}
               || ''
               ?}
              +{? WYDRUKI.P1=0
               || '(DOK.DOP between to_date(:_b) and to_date(:_c)) and '
               |? WYDRUKI.P1=1
               || '(DOK.DTW between to_date(:_b) and to_date(:_c)) and '
               || ''
               ?}
               +'POZ.ZP=\'T\''
               +{? UNPAR.P3 || ' order by F1, REK, F0 ' || ' order by F1, REK, F0, F5' ?}
               +{? str_sql*'F7A' & str_sql*'F7B' || ', F7A, F7B'||''?}
               +{? str_sql*'F22' || ', F22'||''?}
               ,sql_war,ROZNE.DATA_OD,ROZNE.DATA_DO,sql_join,sqlmfp,sqlmfd,TABK);
    {? w_join*'VAT_REJ,' || exec('wyp_wvr','dok_fks_zest') ?};~~}
{IF: type_of(TAB_SQL)>100 & TAB_SQL.size}
   { {? czy_w
     || _t:=sql('select F26 from :_a where F26 is not null group by F26',TAB_SQL); r_wal:=czy_w;
        {? _t.first
        || _w:=0; {!|? {? form(_t.F26)<>'' || _w+=1 ?}; _t.next() !}; {? _w>1 || r_wal:=0 ?}
        || r_wal:=0
        ?};
        T_WAL:=sql('select F1, F26 from :_a where F26 is not null group by F1, F26 order by F1,F26',TAB_SQL)
     ?};~~}
   {IF: PAR_WYDR.NAR & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || dp<ROZNE.DATA_OD?}}
    { {? var_pres('TABN')>0 || obj_del(TABN) ?};
      TABN:=sql('select /*+MASK_FILTER(POZ,:_e) MASK_FILTER(DOK,:_f) index(POZ,KON)*/ '
               +'POZ.KON as PKON, sum(case POZ.STR when \'Wn\' then POZ.SUM else 0 end) as PWN, '
               +'sum(case POZ.STR when \'Ma\' then POZ.SUM else 0 end) as PMA, '
               +'sum(case POZ.STR when \'Wn\' then POZ.SUMW else 0 end) as PWWN, '
               +'sum(case POZ.STR when \'Ma\' then POZ.SUMW else 0 end) as PWMA'
               + {? PAR_WYDR.BO
                 || ', sum(case when POZ.STR=\'Wn\' and (SLOTD.KOD=\'BO\' or SLOTD.KOD=\'KOR_BO\') then POZ.SUM else 0 end) as BOWN, '
                   +'sum(case when POZ.STR=\'Ma\' and (SLOTD.KOD=\'BO\' or SLOTD.KOD=\'KOR_BO\') then POZ.SUM else 0 end) as BOMA, '
                   +'sum(case when POZ.STR=\'Wn\' and (SLOTD.KOD=\'BO\' or SLOTD.KOD=\'KOR_BO\') then POZ.SUMW else 0 end) as BOWWN, '
                   +'sum(case when POZ.STR=\'Ma\' and (SLOTD.KOD=\'BO\' or SLOTD.KOD=\'KOR_BO\') then POZ.SUMW else 0 end) as BOWMA '
                 || ' '
                 ?}
               +'from @POZ :_b '
               +{? ~(ROZNE.PAR4=0 | ROZNE.PAR4=2 | ROZNE.PAR4=4)
                || 'join :_a using(POZ.KON,:_a.ANSYM) '
                || ''
                ?}
               +'where POZ.ZP=\'T\' '
               +{? ROZNE.PAR4=0 | ROZNE.PAR4=2 | ROZNE.PAR4=4
                || ' and POZ.KON '+
                   {? ROZNE.PAR4=0 | ROZNE.PAR4=2
                   || 'like \''+exec('str_sql','#sql',{? ROZNE.PAR4=0 || ROZNE.PREFIX || ROZNE.MASKA?})+'\' '
                   || ' between \''+ROZNE.KS_OD().SYM+'\' and \''
                                   +ROZNE.KS_DO().SYM+%255+'\' '
                   ?}
                || ''
                ?}
               +{? WYDRUKI.P1=0 || ' and DOK.DOP<to_date(:_c) ' |? WYDRUKI.P1=1 || ' and DOK.DTW<to_date(:_c) ' || '' ?}
               +{? sql_war<>'' || 'and :_d' || '' ?}
               +' group by POZ.KON',TABK, sql_join,ROZNE.DATA_OD,sql_war,sqlmfpn,sqlmfdn);
      TABN.index(TABN.ndx_tmp('',,'PKON',,0,'PKON',,0));
      ~~}
    {FOR: TABK}
     {INDEX: TABK_IA}
     {DO}
       { TAB_SQL.blank(); TAB_SQL.REK:='N'; TAB_SQL.F1:=TABK.ANSYM;
         {? TABN.find_key(TABK.ANSYM, TABK.ANSYM)
         || TAB_SQL.NWN:=TABN.PWN; TAB_SQL.NMA:=TABN.PMA; TAB_SQL.NWWN:=TABN.PWWN; TAB_SQL.NWMA:=TABN.PWMA;
            {? PAR_WYDR.BO || TAB_SQL.BOWN:=TABN.BOWN; TAB_SQL.BOMA:=TABN.BOMA; TAB_SQL.BOWWN:=TABN.BOWWN;
            TAB_SQL.BOWMA:=TABN.BOWMA ?};
            TAB_SQL.add()
         || TAB_SQL.cntx_psh();
            TAB_SQL.blank(); TAB_SQL.F1:=TABK.ANSYM;
            _jest:=TAB_SQL.find_rec();
            TAB_SQL.cntx_pop();
            {? _jest || TAB_SQL.add() ?}
         ?};
          ~~}
     {OD}
    {TAB_SQL.first();~~}
   {FI}
   {'Usuniecie kont z zerowym saldem';~~}
   {IF: ~PAR_WYDR.ZSAL}
       { {? TABK.index(TABK_IA); TABK.prefix(); TABK.first()
         || echo('Usuwanie kont z zerowym saldem, sprawdzenie dla konta: '+TABK.ANSYM);
            {!
            |? {? TAB_SQL.prefix(TABK.ANSYM); TAB_SQL.first()
               || _wn:=_ma:=0;
                  {!
                  |? {? PAR_WYDR.NAR
                     || _wn+=TAB_SQL.NWN; _ma+=TAB_SQL.NMA
                     ?};
                     _wn+=TAB_SQL.F24; _ma+=TAB_SQL.F25;
                     TAB_SQL.next()
                  !};
                  {? _wn=_ma
                  || TAB_SQL.first();
                     {!|? TAB_SQL.del() !}
                  ?}
               ?};
               TABK.next()
            !}
        ?};~~}
   {FI}
   {IF: ROZNE.PAR4=5}
   { exec('k_kazapk_zest1','dok_fks_zest');~~}
   { exec('k_kazapk_zest2','dok_fks_zest');~~}
   {FI}
   {FOR: TAB_SQL}
   {DO}
      {IF: (+okres & ((8+TAB_SQL.F0)+2)<>okres & rep_export=0) | (+kont & TAB_SQL.F1<>kont & (so[1]<>0 | so[2]<>0) & rep_export=0)}
        {SUBSTITUTE: 'SOKRES'}
        {IF: TAB_SQL.F1=kont}
         {IF: PAR_WYDR.ONAR}
          {vn:=4;~~}{SUBSTITUTE: 'SOKRES'}
         {FI}
         {IF: PAR_WYDR.SAL & PAR_WYDR.NSAL}
           {vn:=5;~~}{SUBSTITUTE: 'SOKRES'}
         {FI}
         {vn:=0;~~}
        {FI}
      {FI}
      {IF: +kont & TAB_SQL.F1<>kont & rep_export=0}
        {IF: PAR_WYDR.NAR & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || 1 ?}}
         {IF: PAR_WYDR.BO
            & {? ROZNE.KODREJ<>'' || ROZNE.KODREJ='~BO' || 1 ?}
            & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 ||dp<ROZNE.DATA_OD ?}}
          {vn:=2;~~}{SUBSTITUTE: 'SOKRES'}
         {FI}
         {IF: {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || dp<ROZNE.DATA_OD ?}}
          {vn:=1;~~}{SUBSTITUTE: 'SOKRES'}
         {FI}
         {vn:=3;~~}{SUBSTITUTE: 'SOKRES'}
         {vn:=0;~~}
        {FI}
        {SUBSTITUTE: 'SKONTO'}
      {FI}
      {IF: TAB_SQL.REK='N'}
       {FONT: 'T8G'}{SPACE: 'C'}
       { _k:=exec('op_konta','dok_fks_zest',TAB_SQL.F1,SSTALE.AR,0);
         _opis:={? _k[3]>0 || _t:=KA.O1; {! _i:=1.._k[3] |! _t+=' / '+($('KA.O'+$(_i+1)))() !}; _t || _k[1] ?};
          {? rep_export=1
          || w[33]:=TAB_SQL.F1; w[34]:=_opis
          || w[1]:=TAB_SQL.F1+' '+_opis
          ?};
         rsep:=1;refr:='';~~}
       {IF: lineleft<=(ceil(+w[1]/(ks1-1))+2) & lineleft<>0} {PAGE} {FI}
       {SUBSTITUTE: 'LINIA02'}
       {REP: rsep:=0; _f:=prn2+'.fjbar('+prn1+',lmt)'; ($(_f))()}
       { sn[1]:=TAB_SQL.NWN; sn[2]:=TAB_SQL.NMA; sn[3]:=TAB_SQL.NWWN; sn[4]:=TAB_SQL.NWMA;
         {? PAR_WYDR.BO || sb[1]:=TAB_SQL.BOWN; sb[2]:=TAB_SQL.BOMA; sb[3]:=TAB_SQL.BOWWN; sb[4]:=TAB_SQL.BOWMA ?};
         sk[1]+=sn[1]; sk[2]+=sn[2]; sk[3]+=sn[3]; sk[4]+=sn[4];
         sr[1]+=sn[1]; sr[2]+=sn[2]; sr[3]+=sn[3]; sr[4]+=sn[4];~~}
       {kont:=TAB_SQL.F1; okres:='';~~}
      {ELSE}
      {  {? PAR_WYDR.NAR & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || dp<ROZNE.DATA_OD ?}
         || w[1]:=''
         || {? TAB_SQL.F1<>kont
            || _k:=exec('op_konta','dok_fks_zest',TAB_SQL.F1,SSTALE.AR,0);
               _opis:={? _k[3]>0 || _t:=KA.O1; {! _i:=1.._k[3] |! _t+=' / '+($('KA.O'+$(_i+1)))() !}; _t || _k[1] ?};
               {? rep_export=1
               || w[33]:=TAB_SQL.F1; w[34]:=_opis
               || w[1]:=TAB_SQL.F1+' '+_opis
               ?}
            || w[1]:=''
            ?};
            rsep:=1
         ?};
         {? TAB_SQL.F0<>refr | TAB_SQL.F1<>kont
         || {? var_pres('F2',TAB_SQL)>=0 || w[2]:=TAB_SQL.F2 ?};
            {? var_pres('F3',TAB_SQL)>=0 || w[3]:=TAB_SQL.F3 ?};
            {? var_pres('F4',TAB_SQL)>=0 || w[4]:=$TAB_SQL.F4 ?};
            {? var_pres('F5',TAB_SQL)>=0 || w[5]:=$TAB_SQL.F5 ?};
            {? var_pres('F6',TAB_SQL)>=0 || w[6]:=$TAB_SQL.F6 ?};
            {? var_pres('F7A',TAB_SQL)>=0 & var_pres('F7B',TAB_SQL)>=0 || w[7]:=TAB_SQL.F7A+'/'+$TAB_SQL.F7B ?};
            {? var_pres('F8',TAB_SQL)>=0 || w[8]:=TAB_SQL.F8 ?};
            {? var_pres('F9',TAB_SQL)>=0 || w[9]:=TAB_SQL.F9 ?};
            {? var_pres('F10',TAB_SQL)>=0 || w[10]:=TAB_SQL.F10 ?};
            {? var_pres('F11',TAB_SQL)>=0 || w[11]:=$TAB_SQL.F11 ?};
            {? var_pres('F12',TAB_SQL)>=0 || w[12]:=$TAB_SQL.F12 ?};
            {? var_pres('F13',TAB_SQL)>=0 || w[13]:=$TAB_SQL.F13 ?};
            {? var_pres('F14',TAB_SQL)>=0 || w[14]:=TAB_SQL.F14 ?};
            {? var_pres('F15',TAB_SQL)>=0
            || {? var_pres('WVR',TAB_SQL)>=0 & TAB_SQL.WVR='T'
               || w[15]:='wiele'
               || w[15]:=TAB_SQL.F15
               ?}
            ?};
            {? var_pres('F16',TAB_SQL)>=0 || w[16]:=TAB_SQL.F16 ?};
            {? var_pres('F17',TAB_SQL)>=0 || w[17]:=TAB_SQL.F17 ?};
            {? var_pres('F18',TAB_SQL)>=0 || w[18]:=TAB_SQL.F18 ?};
            {? var_pres('F19',TAB_SQL)>=0 || w[19]:=TAB_SQL.F19 ?};
            {? var_pres('F20',TAB_SQL)>=0 || w[20]:=TAB_SQL.F20 ?};
            {? var_pres('F21',TAB_SQL)>=0
            || w[21]:=exec('nsystem','dok_fks_zest',TAB_SQL.F21)+': '+exec('zarej','dok_fks',TAB_SQL.F21)
            ?};
            refr:=TAB_SQL.F0;
            rsep:=PAR_WYDR.RSEP
         || {! _i:=2..21 |! w[_i]:='' !}
         ?};
         kont:=TAB_SQL.F1; okres:=(8+TAB_SQL.F0)+2;
         {? var_pres('F22',TAB_SQL)>=0 || w[22]:=$TAB_SQL.F22 ?};
         {? var_pres('F23',TAB_SQL)>=0 || w[23]:=TAB_SQL.F23 ?};
         {? var_pres('F24',TAB_SQL)>=0 || w[24]:=TAB_SQL.F24; so[1]+=w[24]; sk[1]+=w[24]; sr[1]+=w[24] ?};
         {? var_pres('F25',TAB_SQL)>=0 || w[25]:=TAB_SQL.F25; so[2]+=w[25]; sk[2]+=w[25]; sr[2]+=w[25] ?};
         {? var_pres('F26',TAB_SQL)>=0 || w[26]:=TAB_SQL.F26 ?}; {? +w[26] || p+=1; r+=1 ?};
         {? var_pres('F27',TAB_SQL)>=0 || w[27]:=TAB_SQL.F27 ?};
         {? var_pres('F28',TAB_SQL)>=0 || w[28]:=TAB_SQL.F28; sk[3]+=w[28]; so[3]+=w[28]; sr[3]+=w[28] ?};
         {? var_pres('F29',TAB_SQL)>=0 || w[29]:=TAB_SQL.F29; sk[4]+=w[29]; so[4]+=w[29]; sr[4]+=w[29] ?};
         {? var_pres('F30',TAB_SQL)>=0 || w[30]:=TAB_SQL.F30 ?};
         {? var_pres('F31',TAB_SQL)>=0 || w[31]:={? TAB_SQL.F31<>date(0,0,0) || $TAB_SQL.F31 || '' ?} ?};
         {? var_pres('F32',TAB_SQL)>=0 || w[32]:={? TAB_SQL.F32<>date(0,0,0) || $TAB_SQL.F32 || '' ?} ?}; rsep:=0; ~~}
      {FONT:'T8G'}{SPACE:'C'}
      {IF: w[1]<>''}
       {rsep:=1;~~}
       {IF: lineleft<=(ceil(+w[1]/(ks1-1))+2) & lineleft<>0}{PAGE}{FI}
       {SUBSTITUTE: 'LINIA02'}
       {REP: rsep:=0;_f:=prn2+'.fjbar('+prn1+',lmt)'; ($(_f))()}
      {FI}
      {IF: UNPAR.P3=0 & TAB_SQL.REK='P'}
       {SUBSTITUTE: 'LINIA0'}
      {FI}
     {FI}
   {OD}
   {IF: rep_export=0 & (so[1]<>0 | so[2]<>0)}
    {SUBSTITUTE: 'SOKRES'}
   {FI}
   {IF: rep_export=0 & +kont}
    {IF: PAR_WYDR.NAR & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || 1 ?}}
     {IF: PAR_WYDR.BO
        & {? ROZNE.KODREJ<>'' || ROZNE.KODREJ='~BO' || 1 ?}
        & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 ||dp<ROZNE.DATA_OD ?}}
       {vn:=2;~~}{SUBSTITUTE: 'SOKRES'}
     {FI}
     {IF: {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || dp<ROZNE.DATA_OD ?}}
      {vn:=1;~~}{SUBSTITUTE: 'SOKRES'}
     {FI}
     {vn:=3;~~}{SUBSTITUTE: 'SOKRES'}
     {vn:=0;~~}
    {FI}
    {SUBSTITUTE: 'SKONTO'}
   {FI}
{FOOTER:0}
{REP: _f:=prn2+'.flbar(lmt)'; ($(_f))()}
{vp:=1;~~}
{FOOTER-}
   {rsep:=1; linie:=0;~~}
   {IF: PAR_WYDR.NAR & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || 1 ?}}
    {IF: PAR_WYDR.BO & {? ROZNE.KODREJ<>'' || ROZNE.KODREJ='~BO' || 1 ?} & {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || dp<ROZNE.DATA_OD ?}}
     { w[1]:='BO';w[24]:=ssb[1]; w[25]:=ssb[2]; prn2:='PRNS'; linie+=1;
      {? r_wal & r || w[28]:=ssb[3]; w[29]:=ssb[4] || w[28]:=w[29]:='' ?}; ~~}{FONT: 'T8GB'}{SPACE: 'C'}{SUBSTITUTE: 'LINIA02'}
     { rsep:=0; {? lineleft || prn1:='PRNS' || prn1:='PRN' ?};~~}
    {FI}
    {IF: {? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NR>0 || dp<ROZNE.DATA_OD ?}}
    { w[1]:='OBROTY DO: '+{? WYDRUKI.P1=2 || ROZNE.UT_OKROD().NAZ || ROZNE.DATA_OD$6 ?}+
         {? WYDRUKI.P1=0 || 'wg daty operacji' |? WYDRUKI.P1=1 || 'wg daty zapisu' || '' ?}+{? ROZNE.KODREJ<>'~BO' || ' (z BO)' || '' ?};
      w[24]:=ssn[1]; w[25]:=ssn[2]; prn2:='PRNS'; linie+=1;
      {? r_wal & r || w[28]:=ssn[3]; w[29]:=ssn[4] || w[28]:=w[29]:='' ?}; ~~}{FONT: 'T8GB'}{SPACE: 'C'}{SUBSTITUTE: 'LINIA02'}
      {rsep:=0; {? lineleft || prn1:='PRNS' || prn1:='PRN' ?};~~}
    {FI}
    { w[1]:='OBROTY OKRESU';w[24]:=ssob[1]; w[25]:=ssob[2]; prn2:='PRNS'; linie+=1;
      {? r_wal & r || w[28]:=ssob[3]; w[29]:=ssob[4] || w[28]:=w[29]:='' ?}; ~~}{FONT: 'T8GB'}{SPACE: 'C'}{SUBSTITUTE: 'LINIA02'}
    { rsep:=0; {? lineleft || prn1:='PRNS' || prn1:='PRN' ?};~~}
   {FI}
   { w[1]:='RAZEM'; w[24]:=sr[1]; w[25]:=sr[2]; prn2:='PRNS'; {? r_wal & r || w[28]:=sr[3]; w[29]:=sr[4] || w[28]:=w[29]:='' ?}; ~~}
{FONT: 'T8GB'}{SPACE: 'C'}
{IF: lineleft<=5 & lineleft>0}{{? ~linie || prn2:=prn1 ?};~~}{PAGE}{prn1:='PRN';~~}{FOOTER:0}{FOOTER-}{FI}
{&linie;prn2:='PRNS';~~}
{IF: PAR_WYDR.SAL}
 {SUBSTITUTE: 'LINIA02'}
 { w[1]:='SALDO';w[24]:={? sr[1]>sr[2] || sr[1]-sr[2] || 0 ?}; w[25]:={? sr[2]>sr[1] || sr[2]-sr[1] || 0 ?}; rsep:=0;prn1:='PRNS';
  {? r_wal & r || w[28]:={? sr[3]>sr[4] || sr[3]-sr[4] || 0 ?}; w[29]:={? sr[4]>sr[3] || sr[4]-sr[3] || 0 ?} || w[28]:=w[29]:='' ?}; ~~}
 {SUBSTITUTE: 'LINIA02'}
{ELSE}
 {{? lineleft=0 || prn1:='PRN' ?};~~}
 {SUBSTITUTE: 'LINIA02'}
{FI}
{REP: _f:=prn2+'.flbar(lmt)'; ($(_f))()}
{FOOTER:0}{FOOTER-}
{FONT: 'T8G'}{SPACE:'C'}
{IF: rep_export=0}{<{lmt}>{PRN.width()} 'KONIEC WYDRUKU'}{FI}
{ELSE}
{FOOTER:0}
{FOOTER-}
{ _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}{REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
{ _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{REP: _f:=prn1+'.flbar(lmt)'; ($(_f))()}
{IF: rep_export=0}{<{lmt}>{PRN.width()} 'KONIEC WYDRUKU'}{FI}
{FI}
