:!UTF-8
{TITLE:1. Wydruk nagłówka zlecenia}
{PRINTER: INFO.W_PRN,,,,,'E','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
      PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
 ZL.cntx_psh();
  "---Obiekt wydruku pozycji naglowka zlecenia.";
  PRNZL := obj_new(@.CLASS.PRINT,8); "wydruk naglowkow zlecen";
  PRNZL.s_frame();
  waslbar:=0;
  kreska :='─';
  "---Obiekt wydruku atrybutow zlecenia.";
  PRNATR := obj_new(@.CLASS.PRINT,10);
  PRNATR.s_frame();
  "--Pierwsze i drugie pole wydruku.";
  f1:=f2:='';
  "---1 - atrybuty istnieja, 0 - atrybuty nie istnieja.";
  atrexist:=0;
  prn1:='PRNZL';
  waslbar:=0;
  dalej:=0;
  color:='';
  lm:=ll:=vp:=lmt:=rsep:=0
}
{END:
ZL.cntx_pop();
  obj_del(PRNZL);
  obj_del(PRNATR);
  &waslbar;
  &kreska;
  &f1;
  &f2;
  &atrexist
  &dalej;
  &prn1;
  &color;
  &lm; &ll; &vp; &lmt; &rsep
}
{COMMENT}
  Wydruk naglowka zlecenia.
  [SS] - 2000/09/18 - [7.22]
  [SS] - 2001/03/20 - [7.41] Dodanie kolumny kotrahent i data realizacji, dodanie
                             tabelki atrybutow
  [MKO] - 2001/11/12 - [7.53] OWwSK003_Aneks1
  Wywołanie: Zlecenia (produkcyjne, warsztatowe) -> Drukuj
{COMMENT-}
{COMMENT}--Definicja wiersza wydruku naglowka zl.--------------------{COMMENT-}
{"---Definicja wiersza wydruku                                            "; ~~}
{PRNZL.add("f1",25,'Pole'@); ~~}
{PRNZL.add("f2",56,'Wartość'@); ~~}
{"------------------------------------------------------------------------"; ~~}
{"---Definicja wiersza wydruku atrybutow zlecenia UAT.                    "; ~~}
{PRNATR.add("UAT.TYP().NA",20,'Typ'@); ~~}
{PRNATR.add("exec('decode','tech_atr'); ATR.TWAR",58,'Wartość'@); ~~}
{PAR_WYDR.TITLE:='WYDRUK NAGŁÓWKA ZLECENIA'@;~~}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------REPORT-HEADER----------------{COMMENT-}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8'}{SPACE: 'B'}
{ lmt:=int((charleft()-PRNZL.width())/2); ~~}
{FONT: 'T8B'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
{COMMENT}------------------------------HEADER-----------------------{COMMENT-}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{FONT: 'T8B'}{SPACE: 'B'}
{SUBSTITUTE: 'TABHEAD'}
{HEADER-}
{COMMENT}------------------------------FOOTER-----------------------{COMMENT-}
{FOOTER: 0}
{FOOTER-}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{FONT: 'T8'}{SPACE: 'B'}
{ rsep:=PAR_WYDR.RSEP; ~~}
{IF: ZL.TYP().WP='P'}
  {f1:='Symbol'@; f2:=ZL.SYM; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Opis'@; f2:=ZL.OPIS; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Typ'@; f2:=ZL.TYP().TYP+' - '+ZL.TYP().OPIS; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Rodzaj'@; f2:={? ZL.RODZAJ='P' || 'Zlecenie pojedyncze'@ |? ZL.RODZAJ='Z' || 'Zlecenie złożone z podzleceniami'@ || 'Zlecenie z podzleceniami niezleżnymi'@ ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Data realizacji'@; f2:=form(ZL.DTR); ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Podstawa'@; f2:=ZL.PWYD().PWYD; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Kod produktu'@; f2:=ZL.KTM().KTM+' - '+ZL.KTM().N; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Ilość do wykonania'@; f2:=form(ZL.IL,,4)+' '+ZL.KTM().J().KOD; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Kontrahent'@; {? ZL.JORG<>null() || f2:=ZL.KH().SKR+' - '+ZL.KH().NAZ || f2:='<brak>'@ ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Jednostka organizacyjna'@; {? ZL.JORG<>null() || f2:=ZL.JORG().KOD+' - '+ZL.JORG().TR || f2:='<brak>'@ ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Konto kosztowe'@; f2:=ZL.KK().SYM+' - '+ZL.KK().NAZWA; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Stan zlecenia'@; ~~}
  {f2:={? ~(-ZL.STAN)='N' || 'W przygotowaniu'@
       |? ~(-ZL.STAN)='O' || 'Otwarte'@
       |? ~(-ZL.STAN)='Z' || 'Zamknięte'@
       || '<brak>'@
       ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Powołanie'@; f2:=form(ZL.OD)+' - '+ZL.POWOL().DANE; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Zatwierdzenie'@; ~~}
  {f2:={? ZL.DZATW=date(0,0,0)
       || '<brak>'@
       || form(ZL.DZATW)+' - '+ZL.ZATW().DANE
       ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Zamknięcie'@; ~~}
  {f2:={? ZL.DO=date(0,0,0)
       || '<brak>'@
       || form(ZL.DO)+' - '+ZL.CLOSED().DANE
       ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
 {SUBSTITUTE: 'LINIAF'}
{ELIF: ZL.TYP().WP='W'}
  {f1:='Symbol'@; f2:=ZL.SYM; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Opis'@; f2:=ZL.OPIS; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Typ'@; f2:=ZL.TYP().TYP+' - '+ZL.TYP().OPIS; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Jednostka organizacyjna'@; {? ZL.JORG<>null() || f2:=ZL.JORG().KOD+' - '+ZL.JORG().TR || f2:='<brak>'@ ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Konto kosztowe'@; f2:=ZL.KK().SYM+' - '+ZL.KK().NAZWA; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Stan zlecenia'@; ~~}
  {f2:={? ~(-ZL.STAN)='N' || 'W przygotowaniu'@
       |? ~(-ZL.STAN)='O' || 'Otwarte'@
       |? ~(-ZL.STAN)='Z' || 'Zamknięte'@
       || '<brak>'@
       ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Powołanie'@; f2:=form(ZL.OD)+' - '+ZL.POWOL().DANE; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Zatwierdzenie'@; ~~}
  {f2:={? ZL.DZATW=date(0,0,0)
       || '<brak>'@
       || form(ZL.DZATW)+' - '+ZL.ZATW().DANE
       ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {f1:='Zamknięcie'@; ~~}
  {f2:={? ZL.DO=date(0,0,0)
       || '<brak>'@
       || form(ZL.DO)+' - '+ZL.CLOSED().DANE
       ?}; ~~}
  {SUBSTITUTE: 'LINIA0'}
  {SUBSTITUTE: 'LINIAF'}
 {ELSE}
  {EXIT}
{FI}
{"---Teraz drukuj tabelke atrybutow biezacego zlecenia.                   "; ~~}
  { ATR.TACR:='ZL';
    ATR.TREF:=#ZL.ref();
    ATR.TMSK:=ref_name(ZL.ref());
  ~~}
  {FOR: 'UAT'}
    {INDEX: 'TR'}
    {PREFIX: (ATR.TACR+'*'),ATR.TREF}
  {DO}
    {FIRST}
     {"---Istnieja atrybuty zlecenia.                                    "; ~~}
      { atrexist:=1; ~~}
{      lk:=charleft();prn1:='PRNATR'; ~~}
      {<1>{lk} 'Spis atrybutów zlecenia: %1'@[ZL.SYM]}
{ lmt:=int((charleft()-PRNATR.width())/2); ~~}
      {FONT: 'T8B'}
      {SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}
     {FIRST-}
        {IF: lineleft > 5} {SUBSTITUTE: 'LINIA0'}
        {ELSE}{SUBSTITUTE: 'LINIAF'}{PAGE}{FONT: 'T8B'}{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8'}{ vp:=1; ~~}{SUBSTITUTE: 'LINIA0'}
        {FI}
  {OD}
{IF: atrexist=1}{SUBSTITUTE: 'LINIAF'}{FI}
