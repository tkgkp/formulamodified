:!UTF-8
{
   zkzam_02();

   exec('czytaj','#stalesys',,XINFO); KSTE.get();
   VAR_DEL.delete('PRN','NAG','w','s','na');
   PRN:=obj_new(@.CLASS.PRINT,7); PRN.s_frame();
   NAG:=obj_new(@.CLASS.PRINT,2); NAG.n_frame();
   w:=obj_new(8); "--wartosci kolumn--";
   s:=obj_new(8); "--razem--";
   na:=obj_new(2); "--naglowek--";
   dokl:=3; "--dokladnosc ilosci--";

   prn1:='PRN';
   color:=prn2:='';
   lm:=ll:=vp:=lmt:=rsep:=0;
   s[1]:=5;
   s[2]:=40;
   s[4]:=10;
   s[5]:=40;
   s[6]:=12;
   s[7]:=10;
   s[8]:=15;
   il_lin:=0;
   zakoncz:=1;
   oddzial:=KSTE.NAZ<>'';
   wsk:=byl:=0;~~
}

{EXIT: {? ZK_N.A='Z' || FUN.info('Raport niedostępny dla zamówienia archiwalnego.'@); 1 || 0 ?}}
{
   PRN.add("form(w[1])",s[1],'Lp.'@,1);
   PRN.add("form(w[2])",s[2],'Materiał/Usługa'@);
   PRN.add("form(w[8])",s[8],'Cecha'@);
   PRN.add("form(w[6],,dokl)",s[6],'Ilość'@,1);
   PRN.add("form(w[7])",s[7],'jm'@,1);
   PRN.add("form(w[4])",s[4],'Stan'@);
   PRN.add("form(w[5],,3)",s[5],'Planowane daty dostaw'@)
;~~}
{FONT: 'T8G'}{SPACE: 'C'}
{
   _nag_wc1:=charleft()/2;
   _nag_wc2:=charleft()-_nag_wc1;
   NAG.add("na[1]",_nag_wc1,'');
   NAG.add("na[2]",_nag_wc2,'');

   lmt:=int((charleft()-PRN.width())/2);
   PAR_WYDR.TITLE:='Plan zamówienia nr: \n'+ZK_N.SYM+' z dnia '+$ZK_N.DP;
   prn1:='NAG';

   exec('zam_plan','zamsiw_rea',1);
   w[1]:=0; rsep:=1
;~~}
{EXIT: {? XPLAN.first() || 0  || FUN.info('Brak pozycji planu.'@); ZK_N.sel_size()=0 ?}}
{COMMENT}   SIGNATURE                                                {COMMENT-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}   REPORT-HEADER                                            {COMMENT-}
{SUBSTITUTE: 'HEAD'}
{ns:=0;~~}
{IF: page=1}
   {FONT: 'T8G'}{SPACE: 'C'}
   {LINE}
   {
      prn1:='NAG';

      na[1]:={? oddzial=1 || KSTE.NAZ || XINFO.NAZ ?};
      na[2]:=ZK_N.KH().NAZ_P
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
      na[1]:=
         {? oddzial=1
         ||
            {? KSTE.UL<>''
            ||
               'ul. '+KSTE.UL+' '+form(KSTE.NR_D)+{? +KSTE.NR_L || '/'+KSTE.NR_L || '' ?}
            ||
               ''
            ?}
         ||
            {? XINFO.UL<>''
            ||
               'ul. '+XINFO.UL+' '+form(XINFO.NR_D)+{? +XINFO.NR_L || '/'+XINFO.NR_L || '' ?}
            ||
               ''
            ?}
         ?};
      na[2]:={? ZK_N.KH().UL<>'' || 'ul. '+KH.UL || '' ?}
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
      na[1]:=
         {? oddzial=1
         ||
            KSTE.KOD_P+', '+KSTE.MIA
         ||
            XINFO.KOD_P+', '+XINFO.MIA
         ?};
      na[2]:=ZK_N.KH().KPOCZ+{? +KH.POCZ || ' '+KH.POCZ || '' ?}+', '+ZK_N.KH().MIASTO
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
      na[1]:=
         {? oddzial=1
         ||
            {? KSTE.TEL<>'' || 'tel.: '+KSTE.TEL || '' ?}
         ||
            {? XINFO.TEL<>'' || 'tel.: '+XINFO.TEL || '' ?}
         ?};
      na[2]:={? ZK_N.KH().NIP<>'' || 'NIP: '+ZK_N.KH().NIP || '' ?}
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
{COMMENT}   informacje dodatkowe dla naglowka dokumentu              {COMMENT-}
   {
      'pobieram dane'; exec('pobgdnag','fakso','Z',ZK_N.ref);
      VAR_DEL.delete('oo','OPIK')
   ;~~}
   {FOR: S_GD}
   {PREFIX: 'G'}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {SUBSTITUTE: 'inf_dod'}
   {OD}
   {  prn1:='PRN'; rsep:=1; ~~}
{FI}
{FONT: 'T8GB'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{ vp:=1; ~~}
{COMMENT}   HEADER                                                   {COMMENT-}
{HEADER}
   {IF: ~ns}
   {SUBSTITUTE: 'HEAD'}
   {IF: zakoncz}
      {FONT: 'T8GB'}{SPACE: 'C'}
      {SUBSTITUTE: 'TABHEAD'}
   {FI}
   {FI}
{HEADER-}
{COMMENT}   FOOTER                                                   {COMMENT-}
{IF: _a:=exec('get_par','#parametr',34); _a='Z' | _a='A'}
   {FOOTER}
   {SUBSTITUTE: 'FOOT_LIC'}
   {~~}
   {~~}
   {~~}
   {FOOTER-}
{ELSE}
   {FOOTER}{FOOTER-}
{FI}
{COMMENT}   pozycje wydruku                                          {COMMENT-}
{FOR: XPLAN}
{DO}
{IF:XPLAN.TREE<>0}
   {FIRST}
   { dokl:=FD.FLD_PREC(XPLAN,'ILE');~~}
   {FIRST-}
   {
      w[5]:='';
      {? XPLAN.STA='BRAK'
      ||
         ZD_NAG.index('STAN');
         ZD_NAG.prefix('A');
         {? ZD_NAG.first
         ||
            {!
            |? bb:=ZD_NAG.DTPREAL;
               ZD_POZ.index('POZ');
               ZD_POZ.prefix(ZD_NAG.ref);
               {? ZD_POZ.first
               || _czy_ok:=0;
                  {!
                  |? {? ZD_POZ.M().KTM=XPLAN.KTM2
                     || w[5]+=$bb+'; '; _czy_ok:=1
                     ?};
                     ZD_POZ.next & _czy_ok=0
                  !}
               ?};
               ZD_NAG.next
            !}
         ?};
         w[5]:=w[5]-2
      ?};
      w[1]+=1;w[2]:=XPLAN.KTM;w[4]:=XPLAN.STA;w[6]:={? XPLAN.STA<>'BRAK' || XPLAN.ILE || XPLAN.ILB ?};
      w[7]:=exec('FindInSet','#table','M','MATKTM',XPLAN.KTM2,XPLAN.KTM2,"M.J().KOD",,,''); ZK_P.JM().KOD;
      w[8]:=XPLAN.DKC;

      _f:=prn1+'.ini_line()'; _v:=($(_f))();
      _f:=prn1+'.length()'; il_lin:=($(_f))() + 2
   ;~~}
   {IF: lineleft()>0 & lineleft<=il_lin}
      {SUBSTITUTE: 'LINIAF'}{PAGE}
   {FI}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{OD}
{SUBSTITUTE: 'LINIAF'}
{
   zakoncz:=0;
   rsep:=PAR_WYDR.RSEP;
   VAR_DEL.delete('oo','OPIK')
;~~}
{COMMENT}   informacje dodatkowe dla naglowka dokumentu              {COMMENT-}
{FOR: S_GD}
{PREFIX: 'D'}
{DO}
   {FIRST}
      {LINE}
   {FIRST-}
   {SUBSTITUTE: 'inf_dod'}
{OD}