:!UTF-8
{TITLE:A.  Wykonanie rozliczenia kosztów}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:  PRN:=obj_new(@.CLASS.PRINT,10); PRN.sl_frame();
         w:=obj_new(11); wyr:=PAR_SKID.get(35)='T';
         color:=''; prn1:=prn2:='PRN';
         lm:=ll:=lmt:=rsep:=0; vp:=1; rsep:=PAR_WYDR.RSEP; fun:='';
         co:='WARTOŚCI KONT ŹRÓDŁOWYCH'@; war:=wark:=separat:=0;
         {! _i:=1..11 |! w[_i]:='' !}
}
{END:  obj_del(PRN); obj_del(w); &wyr; &war; &wark; &separat;
       &color; &prn1; &prn2; &lm; &ll; &vp; &lmt; &rsep; &fun}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
==================================================
Nazwa pliku: fks_row_kosz.rpm
==================================================
Zawartosc: Wydruk wykonania rozliczenia kosztow
{COMMENT-}
{INCLUDE: wsp_pw.rpi}
{COMMENT}------------------------------SIGNATURE--------------------{COMMENT-}
{SUBSTITUTE: 'FOOT'}
{ PRN.add("w[7]",35,'        Konto       '@);
  PRN.add("w[8]",15,'    Funkcja    #'@,,'#');
  PRN.add("w[9]",4,'Str.'@);
  PRN.add("w[10]",16,'     Kwota      #'@,1,'#');
  {? wyr
  || PRN.add("w[1]",20,'     Wyróżnik1:     #      Słownik      #        Kod         #'@,,'#');
     PRN.add("w[2]",20,'     Wyróżnik2:     #      Słownik      #        Kod         #'@,,'#');
     PRN.add("w[3]",20,'     Wyróżnik3:     #      Słownik      #        Kod         #'@,,'#');
     PRN.add("w[4]",20,'     Wyróżnik4:     #      Słownik      #        Kod         #'@,,'#');
     PRN.add("w[5]",20,'     Wyróżnik5:     #      Słownik      #        Kod         #'@,,'#');
     PRN.add("w[6]",20,'     Wyróżnik6:     #      Słownik      #        Kod         #'@,,'#')
  ?};
~~}
{COMMENT}------------------------------HEADER i FOOTER-----------------------{COMMENT-}
{HEADER}
{FONT: 'HEAD'}{SPACE: 'B'}
{LINE: 1}{ PAR_WYDR.TITLE:='WYKONANIE ROZLICZENIA KOSZTÓW %1 %2'@[ROW_NAG.ROZ_NAZ().KOD,ROZ_NAZ.NAZWA];~~}
{SUBSTITUTE: 'HEAD'}
{FONT: 'W8'}{SPACE: 'C'}
{IF: page=1}{LINE: 1}
{<3 'Parametry wydruku:'@}
{IF: ROW_NAG.ROZ_NAZ().TYP='P'}
{<3 'Wartości narzutów wyznaczane poprzez: Procentowo/formuły'@}
{ELIF: ROZ_NAZ.TYP='K'}
{<3 'Wartości narzutów wyznaczane poprzez: Klucz podziałowy'@}
{ELSE}
{<3 'Wartości narzutów wyznaczane poprzez: \'Ręczny\' rozdzielnik'@}
{FI}
{<3 'Jednostka księgowa: %1'@[ROW_NAG.ODD().OD]}
{<3 'Okres obrachunkowy: %1 rok %2'@[ROW_NAG.OKRES().NAZ,ROW_NAG.OKRES().ROK().NAZ]}
{<3 'Data wykonania: %1'@[$ROW_NAG.DATA]}
{IF: ROW_NAG.ZAKS='T'}{<3 'Zadekretowano w dokumencie: %1 %2 nr %3'@[ROW_NAG.ODD().OD,
                                                            (((ROW_NAG.SLAD*'~')-1)+ROW_NAG.SLAD),
                                                            ((ROW_NAG.SLAD*'/')-ROW_NAG.SLAD)]}{FI}{FI}
{LINE: 1}
{<3 co}
{LINE: 1}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{ vp:=1;~~}
{HEADER-}
{FOOTER: 0}
{PRN.lbar()}{ vp:=1;~~}
{FOOTER-}
{COMMENT}------------------------------MACRA WYROZN-----------------------{COMMENT-}
{MACRO: 'WYROZN1'}
{ {! _i:=1..6
  |! {? ($('ROW_KON.WYR'+$_i))()<>null
     || w[_i]:=form(($('ROW_KON.WYR'+$_i+'().SLU().NAZ'))(),20)+'#'+($('ROW_KON.WYR'+$_i+'().KOD'))()
     || w[_i]:=''
     ?}
  !}; ~~}
{MACRO-}
{MACRO: 'WYROZN2'}
{ ROW_WYR.index('ROW_WYR');
  {! _i:=1..6
  |! w[_i]:='';
     ROW_WYR.prefix(ROW_DOC.ref(),_i);
     {? ROW_WYR.first()
     || w[_i]+=ROW_WYR.SLU().SLU().NAZ+'#';
        {!|? w[_i]+=form(ROW_WYR.SLO().KOD,8)+form(ROW_WYR.KW,12,2,' ,')+'#'; ROW_WYR.next()  !}
     ?}
  !}; ~~}
{MACRO-}
{MACRO: 'WYROZN3'}
{ {! _i:=1..6
  |! {? ($('ROW_DOC.WYR'+$_i))()<>null
     || w[_i]:=form(($('ROW_DOC.WYR'+$_i+'().SLU().NAZ'))(),20)+'#'+($('ROW_DOC.WYR'+$_i+'().KOD'))()
     || w[_i]:=''
     ?}
  !}; ~~}
{MACRO-}
{COMMENT}-------------------------------------PRZYGOTOWANIE WYDRUKU------------------------------------{COMMENT-}
{COMMENT}----------------------------------------KONTA ZRODLOWE----------------------------------------{COMMENT-}
{FONT: 'T8G'}{SPACE: 'C'}{ war:=0;~~}
{FOR:    'ROW_KON'}
{INDEX:  'KONTO'}
{PREFIX: ROW_NAG.ref()}
{DO}
{ w[7]:=ROW_KON.KONTOZ; w[8]:=ROW_KON.FUN().TRESC; w[9]:=ROW_KON.STR;
  w[10]:=form(ROW_KON.KWOTA,16,2,' ,'); war+=ROW_KON.KWOTA;~~}
{SUBSTITUTE: 'WYROZN1'}
{SUBSTITUTE: 'LINIA0'}
{OD}
{IF: lineleft()=2 | lineleft()=1}{PAGE}{FI}
{ w[7]:=form('Kwota do rozliczenia:'@,20); w[8]:=w[9]:=''; w[10]:=form(war,16,2,' ,');
  {! _i:=1..6 |! w[_i]:='' !}; separat:=rsep; rsep:=1;~~}
{SUBSTITUTE: 'LINIA0'}{ rsep:=separat;~~}
{FOOTER}{FOOTER-}
{IF: lineleft()<>0}{PRN.lbar()}{FI}{ co:=''; {! _i:=1..11 |! w[_i]:='' !}; ~~}
{COMMENT}------------------------------------KONTA DOCELOWE, KLUCZE------------------------------------{COMMENT-}
{COMMENT}-------------------------------ROZLICZENIE PROCENTOWE I RECZNE--------------------------------{COMMENT-}
{IF: ROW_NAG.ROZ_NAZ().TYP='P' | ROZ_NAZ.TYP='R'}
{ obj_del(PRN); war:=0;
  PRN:=obj_new(@.CLASS.PRINT,11); PRN.sl_frame();
  PRN.add("w[7]",35,'Konto');
  {? ROZ_NAZ.TYP='R' || PRN.add("w[11]",16,'Wartość'@,1)  ?};
  PRN.add("w[8]",9,'%% narzutu'@,1);
  PRN.add("w[9]",3,'St.');
  PRN.add("w[10]",16,'Kwota narzutu'@,1);
  {? wyr
  || PRN.add("w[1]",20,'     Wyróżnik1:     #      Słownik      #'@+{?ROZ_NAZ.TYP='P'||'Kod            kwota'@||'        Kod         '@?},,'#');
     PRN.add("w[2]",20,'     Wyróżnik2:     #      Słownik      #'@+{?ROZ_NAZ.TYP='P'||'Kod            kwota'@||'        Kod         '@?},,'#');
     PRN.add("w[3]",20,'     Wyróżnik3:     #      Słownik      #'@+{?ROZ_NAZ.TYP='P'||'Kod            kwota'@||'        Kod         '@?},,'#');
     PRN.add("w[4]",20,'     Wyróżnik4:     #      Słownik      #'@+{?ROZ_NAZ.TYP='P'||'Kod            kwota'@||'        Kod         '@?},,'#');
     PRN.add("w[5]",20,'     Wyróżnik5:     #      Słownik      #'@+{?ROZ_NAZ.TYP='P'||'Kod            kwota'@||'        Kod         '@?},,'#');
     PRN.add("w[6]",20,'     Wyróżnik6:     #      Słownik      #'@+{?ROZ_NAZ.TYP='P'||'Kod            kwota'@||'        Kod         '@?},,'#')
  ?}; co:='WARTOŚCI KONT DOCELOWYCH'@;
~~}
{IF: lineleft()<11 & lineleft<>0}
{PAGE}
{FOOTER: 0}
{PRN.lbar()}{ vp:=1;~~}
{FOOTER-}
{ELSE}
{FOOTER: 0}
{PRN.lbar()}{ vp:=1;~~}
{FOOTER-}
{LINE: 1}
{FONT: 'W8'}{SPACE: 'C'}
{<3 co}
{LINE: 1}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{FI}
{FONT: 'T8G'}{SPACE: 'C'}{ vp:=1; PRN.setcolor('255:255:255');~~}
{FOR:    'ROW_DOC'}
{INDEX:  'KONTO'}
{PREFIX: ROW_NAG.ref()}
{DO}
{ w[7]:=ROW_DOC.KONTODC; w[8]:=form(100*ROW_DOC.WSP,10,6,' ,'); w[9]:=ROW_DOC.STR;
  w[11]:=form(ROW_DOC.KWOTAKL,20,6,' ,');
  w[10]:=form(ROW_DOC.KWOTA,16,2,' ,'); war+=ROW_DOC.KWOTA;~~}
{IF: ROZ_NAZ.TYP='P'}{SUBSTITUTE: 'WYROZN2'}{ELSE}{SUBSTITUTE: 'WYROZN3'}{FI}
{SUBSTITUTE: 'LINIA0'}
{OD}
{COMMENT}----------------------------------ROZLICZENIE Z KLUCZAMI-----------------------------------{COMMENT-}
{ELIF: ROW_NAG.ROZ_NAZ().TYP='K'}
{ obj_del(PRN); war:=0; PRN:=obj_new(@.CLASS.PRINT,11); PRN.sl_frame();
 PRN.add("w[7]",14,'Rodzaj konta'@);
 PRN.add("w[8]",35,'Konto'@);
 PRN.add("w[9]",4,'Str.'@);
 PRN.add("w[10]",16,'Kwota'@,1);
 PRN.add("w[11]",10,'%% narzutu'@,1);
 {? wyr
 || PRN.add("w[1]",20,'     Wyróżnik1:     #      Słownik      #        Kod         #'@,,'#');
    PRN.add("w[2]",20,'     Wyróżnik2:     #      Słownik      #        Kod         #'@,,'#');
    PRN.add("w[3]",20,'     Wyróżnik3:     #      Słownik      #        Kod         #'@,,'#');
    PRN.add("w[4]",20,'     Wyróżnik4:     #      Słownik      #        Kod         #'@,,'#');
    PRN.add("w[5]",20,'     Wyróżnik5:     #      Słownik      #        Kod         #'@,,'#');
    PRN.add("w[6]",20,'     Wyróżnik6:     #      Słownik      #        Kod         #'@,,'#')
 ?}; co:='WARTOŚCI KONT DOCELOWYCH'@;
~~}
{IF: lineleft()<11 & lineleft<>0}
{PAGE}
{FOOTER: 0}
{PRN.lbar()}{ vp:=1;~~}
{FOOTER-}
{ELSE}
{FOOTER: 0}
{PRN.lbar()}{ vp:=1;~~}
{FOOTER-}
{LINE: 1}
{FONT: 'W8'}{SPACE: 'C'}
{<3 co}
{LINE: 1}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}
{FI}
{FONT: 'T8G'}{SPACE: 'C'}{ vp:=1; PRN.setcolor('255:255:255');~~}
{FOR:    'ROW_DOC'}
{INDEX:  'KONTO'}
{PREFIX: ROW_NAG.ref()}
{DO}
{ w[7]:='Konto klucza'@; w[8]:=ROW_DOC.KONTOKL; w[9]:='';  w[10]:=form(ROW_DOC.KWOTAKL,16,2,' ,');
  w[11]:=form(100*ROW_DOC.WSP,10,6,' ,'); wark+=ROW_DOC.KWOTAKL;~~}
{SUBSTITUTE: 'WYROZN3'}
{SUBSTITUTE: 'LINIA0'}
{ w[7]:='Konto docelowe'@; w[8]:=ROW_DOC.KONTODC; w[9]:=ROW_DOC.STR;
  w[10]:=form(ROW_DOC.KWOTA,16,2,' ,'); w[11]:=''; war+=ROW_DOC.KWOTA; separat:=rsep; rsep:=0;~~}
{SUBSTITUTE: 'WYROZN1'}
{SUBSTITUTE: 'LINIA0'}{ rsep:=separat;~~}
{OD}
{FI}
{IF: ROW_NAG.ROZ_NAZ().TYP<>'K'}
{ w[7]:=form('Razem:'@,20); w[8]:=w[9]:=w[11]:=''; w[10]:=form(war,16,2,' ,'); {! _i:=1..6 |! w[_i]:='' !}; ~~}
{SUBSTITUTE: 'LINIA0'}
{ELSE}
{ w[7]:=''; w[8]:=form('Kwota klucza:'@,20); w[9]:=''; w[10]:=form(wark,16,2,' ,'); {! _i:=1..6 |! w[_i]:='' !}; ~~}
{SUBSTITUTE: 'LINIA0'}{ separat:=rsep; rsep:=0;~~}
{ w[7]:=''; w[8]:=form('Kwota rozliczona:'@,20); w[9]:=''; w[10]:=form(war,16,2,' ,'); {! _i:=1..6 |! w[_i]:='' !}; ~~}
{SUBSTITUTE: 'LINIA0'}{ rsep:=separat;~~}
{FI}
{FOOTER}{FOOTER-}
{IF: lineleft()<>0}{PRN.lbar()}{FI}