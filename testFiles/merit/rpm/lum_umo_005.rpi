:!UTF-8
{
 ok_dataod:="
 {? od_datyod<>date(0,0,0) & do_datyod<>date(0,0,0)
 || {? @.UM.OD >= od_datyod & @.UM.OD <= do_datyod || 1 || 0 ?}
 |? od_datyod<>date(0,0,0) & do_datyod=date(0,0,0)
 || {? @.UM.OD >= od_datyod || 1 || 0 ?}
 |? od_datyod=date(0,0,0) & do_datyod<>date(0,0,0)
 || {? @.UM.OD <= do_datyod || 1 || 0 ?}
 |? od_datyod=date(0,0,0) & do_datyod=date(0,0,0)
 || 1
 ?}
 ";
 ok_datado:="
 {? od_datydo<>date(0,0,0) & do_datydo<>date(0,0,0)
 || {? @.UM.DO >= od_datydo & @.UM.DO <= do_datydo || 1 || 0 ?}
 |? od_datydo<>date(0,0,0) & do_datydo=date(0,0,0)
 || {? @.UM.DO >= od_datydo || 1 || 0 ?}
 |? od_datydo=date(0,0,0) & do_datydo<>date(0,0,0)
 || {? @.UM.DO <= do_datydo || 1 || 0 ?}
 |? od_datydo=date(0,0,0) & do_datydo=date(0,0,0)
 || 1
 ?}
 ";
 ok_datawyd:="
 {? od_datywyd<>date(0,0,0) & do_datywyd<>date(0,0,0)
 || {? @.UM.DP >= od_datywyd & @.UM.DP <= do_datywyd || 1 || 0 ?}
 |? od_datywyd<>date(0,0,0) & do_datywyd=date(0,0,0)
 || {? @.UM.DP >= od_datywyd || 1 || 0 ?}
 |? od_datywyd=date(0,0,0) & do_datywyd<>date(0,0,0)
 || {? @.UM.DP <= do_datywyd || 1 || 0 ?}
 |? od_datywyd=date(0,0,0) & do_datywyd=date(0,0,0)
 || 1
 ?}
 ";
~~}
{'-------------------------To jest początek wydruku-----------------------------';~~}
{MACRO:'druk'}
{ w[1]:=w[2]:=w[3]:=w[4]:='' ;~~}
{FOR: UM}
{INDEX:'NRU'}
{FROM:ST.ODDZ,'N',od_symk}
{TO:ST.ODDZ,'N',do_symk}
{DO}
   {IF: FZL.SPR_WAR("@.UM.KH().KOD",od_kh,do_kh,od_khk,do_khk) & (stu=UM.STU().KOD | stu='') &
        ok_datawyd() & ok_dataod() & ok_datado()
   }
      {lp:=0;
       w[1]:=UM.SYM;~~}
      {FOR: UP}
      {INDEX:ind}
      {PREFIX:UM.ref,WYDRUKIL.HM}
      {DO}
         {
          lp+=1;
          w[2]:=UP.POZ;
          w[3]:=UP.IL;
          w[4]:=UP.MJ().J().KOD
         ;~~}
         {SUBSTITUTE: 'LINIA0'}
      {OD}
   {FI}
{OD}
{MACRO-}