:!UTF-8
{TITLE:A. Potwierdzenie salda - korespondencja seryjna}
{PRINTER: FINFO.W_PRN,,,,,'Q','C',,,,,,1,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,
   PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,1,1}
{BEGIN:
   VAR_DEL.delete('czy_szablon');
   exec('czytaj','#stalesys',,FINFO,'SLWAL');
   exec('czytaj','#stalesys',,XINFO,'SLJEZYK');
   w:=obj_new(9); liczwal:=0; l_wal:=0; nr_str:=0; ROZNE.UT_KOM:=1; ROZNE.UT_VAT:=0; kon:=ilel:=0;
   czy_szablon:=exec('rep_set','rap_zew','FKS_KORROZ',1)='T';
   SLUAPPL.cntx_psh(); SLU.cntx_psh(); SLO.cntx_psh();
   SLU.prefix(); SLO.prefix(); SLUAPPL.prefix();
   {? XINFO.SLJEZYK<>null
   || XINFO.SLJEZYK();
      SER_KOR.JEZYK:={? SLO.find_key(SLU.ref(),'POL')
                     || SLO.ref()
                     || null
                     ?}
   ?};
   new_poz:=new_poz1:=0; ref_defw:=null; del_wal:=gen_wyd:=0; l_wal:=0;
   firstloopone:=nrdone:=0;
   SER_KOR.WYB_WAL:={? SER_NAG.WAL=null || 2 || SER_KOR.WAL:=SER_NAG.WAL; 0 ?};
   SER_NAGS.cntx_psh(); SER_NAGS.win_sel('SERNAGNW');
   SER_NAG.cntx_psh(); SER_NAG.prefix(); wz_wyd:=''; exec('ind_pref','rozrach_kor');
   color:=prn1:=prn2:=''; lm:=ll:=vp:=lmt:=rsep:=wdt:=pierwszy:=pageaf:=pagebef:=0;
   head:=PAR_WYDR.HEAD; SLO.prefix;
   {? var_pres('ML',@)<=100 || ML:=obj_new(@.CLASS.MEMO) ?}; nwn:=nma:='';
   suma3:=suma4:=pier:=wybor:=petla:=druk1:=obrn:=obrw:=0; druktyt:=1;
   logo:=PAR_WYDR.LOGO;
   SLUAPPL.prefix(); SLU.prefix();
   FINFO.SLWAL().SLU();
   SLO.index('SL'); SLO.prefix(SLU.ref);
   {? SLO.first() || licz_wal:=SLO.size() ?};
   {? licz_wal
   || sumy:=obj_new(licz_wal);
      {! _i:=1..licz_wal
      |! sumy[_i]:=obj_new(4); sumy[_i][1]:=SLO.KOD; sumy[_i][2]:=sumy[_i][3]:=sumy[_i][4]:=0;
         SLO.next()
      !}
   ?};
   SLUAPPL.cntx_pop(); SLU.cntx_pop(); SLO.cntx_pop(); licznik:=1; naz_str:='';
   ROZNE.UT_KOM:=1; tab_adr:=obj_new(38); licz:=licz1:=0; tab_adr1:=obj_new(17);
   {! _i:=1..21 |!  tab_adr[_i]:='' !}; separat:=0;
  ODD.cntx_psh(); ODD.index('ODDZIALY'); ODD.prefix(REF.FIRMA); SSTALE.cntx_psh(); wyd_kor:=1; kontbank:=''
}
{END:
   SER_NAGS.cntx_pop(); SER_NAG.cntx_pop(); ODD.cntx_pop(); SSTALE.cntx_pop(); &wz_wyd;  &new_poz; &new_poz1; &ref_defw; &naz_str; &kon; &ilel;
   {? SER_KOR.WYB_WAL=1 & del_wal=1 || exec('del_wal','rozrach_kor') ?};
   &l_wal; &gen_wyd; &del_wal; PAR_WYDR.LOGO:=logo; &logo; &nrdone;
   {? var_pres('PRN')>0 || obj_del(PRN) ?};
   {? var_pres('PRN1')>0 || obj_del(PRN1) ?};
   obj_del(w); &color; &prn1; &prn2; &pierwszy; &licz_wal; &liczwal; obj_del(sumy); &licznik; &firstloopone;
   &lm; &ll; &vp; &lmt; &rsep; &wdt; PAR_WYDR.HEAD:=head; &head; &nwn; &nma; &pageaf; &pagebef;
   &suma3; &suma4; &pier; &wybor; &petla; &druk1; &obrn; &obrw; &druktyt;
   &licz; &licz1; obj_del(tab_adr); obj_del(tab_adr1); &separat; &wyd_kor; &kontbank; {? ~(menu_txt()='Akceptuj' | menu_txt()='Rozpocznij' | menu_txt()='Załączniki') || VAR_DEL.delete('ObjForMerge') ?}
}
{IF: var_press('ToPDF')<=0}
{  PAR_WYDR.win_edit('POTWKOR'); PAR_WYDR.PAR1:=1; SSTALE.WAL:=SER_NAG.WAL; exec('set_kbr','rozrach_przel'); ~~}
{EXIT: ~PAR_WYDR.edit("{? SER_KOR.JEZYK=null
                       || FUN.info('Nie wybrano języka.'@); 'JEZYK'
                       |? SER_KOR.JEZYK<>null & ~exec('sprwzwyd','rozrach','fks_potw',SER_KOR.JEZYK().KOD,1)
                       || 'JEZYK'
                       || {? RACHBANK.KB_1R=''
                          || FUN.info('Nie podano numeru konta bankowego.'@); 'KB_1R'
                          || ''
                          ?}
                       ?}")}
{ELIF: var_press('ToPDF')>0 & var_press('__POTWPAR')>0}
{  PAR_WYDR.PAR1:=1; SSTALE.WAL:=SER_NAG.WAL; exec('set_kbr','rozrach_przel'); ~~}
{  SER_KOR.JEZYK:=__POTWPAR.JEZYK;
   RACHBANK.KB_1R:=__POTWPAR.KB_1R;
   ROZNE.UT_VAT:=__POTWPAR.UT_VAT;
   ROZNE.UT_KOM:=__POTWPAR.UT_KOM;
   ~~}
{EXIT: {? SER_KOR.JEZYK=null
       || FUN.info('Nie wybrano języka.'@); 1
       |? SER_KOR.JEZYK<>null & ~exec('sprwzwyd','rozrach','fks_potw',SER_KOR.JEZYK().KOD,1)
       || 1
       || {? RACHBANK.KB_1R=''
          || FUN.info('Nie podano numeru konta bankowego.'@); 'KB_1R'; 1
          || 0
          ?}
       ?} }
{ELSE}
{  PAR_WYDR.win_edit('POTWKORG'); PAR_WYDR.PAR1:=1; SSTALE.WAL:=SER_NAG.WAL; exec('set_kbr','rozrach_przel'); ~~}
{EXIT: ~PAR_WYDR.edit("{? SER_KOR.JEZYK=null
                       || FUN.info('Nie wybrano języka.'@); 'JEZYK'
                       |? SER_KOR.JEZYK<>null & ~exec('sprwzwyd','rozrach','fks_potw',SER_KOR.JEZYK().KOD,1)
                       || 'JEZYK'
                       || {? RACHBANK.KB_1R=''
                          || FUN.info('Nie podano numeru konta bankowego.'@); 'KB_1R'
                          || ''
                          ?}
                       ?}")}
{ VAR_DEL.delete('__POTWPAR');
  __POTWPAR:=obj_new('JEZYK','KB_1R','UT_VAT','UT_KOM');
  __POTWPAR.JEZYK:=SER_KOR.JEZYK;
  __POTWPAR.KB_1R:=RACHBANK.KB_1R;
  __POTWPAR.UT_VAT:=ROZNE.UT_VAT;
  __POTWPAR.UT_KOM:=ROZNE.UT_KOM;
  ~~}
{FI}
{ wybor:=PAR_WYDR.PAR1;~~}
{ firstloopone:=ROZNE.ONE_PAGE;~~}
{IF: wybor=3}
   {  WYDRUKIN.win_edit({? kh_all || 'SER_NAG' || 'SER_NAG1' ?});
      WYDRUKIN.hdr_edit('Potwierdzenia salda - zakres'@);
      WYDRUKIN.SER_DEF:=WYDRUKIN.SER_DEF2:=SER_NAG.KOD;
      SER_DEF.win_dict('SERNOW'); KH.win_dict('WERHOME2');
      WYDRUKIN.DATAOD:=WYDRUKIN.DATADO:=date();
      WYDRUKIN.KH:=WYDRUKIN.KH2:=SER_NAG.KH; ~~}
    {EXIT: ~WYDRUKIN.edit("{? SER_KOR.WYB_WAL=0 & SER_KOR.WAL=null
                           || FUN.info('Nie wybrano żadnej waluty.'@); 'WYB_WAL'
                           || ''
                           ?}")}
    {IF: SER_KOR.WYB_WAL=1}
     { exec('wyb_wal','rozrach_kor'); del_wal:=1;~~}
     {IF: l_wal=0}{ FUN.info('Nie wybrano żadnej waluty.'@);~~}{EXIT}{FI}
    {FI}
{FI}
{IF: czy_szablon}
   {IF: ROZNE.UT_KOM}
      {IF: wybor=1}
         {SER_NAGS.SER_NAG();~~}
         {IF: ~ROZNE.UT_VAT}
            {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPB',,-4,,,1);ObjForMerge.makeMerge({? (menu_txt()='Akceptuj' | menu_txt()='Rozpocznij' | menu_txt()='Załączniki') || 1 ?},~ROZNE.ONE_PAGE);pierwszy:=1;~~}
         {ELSE}
            {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPBJ',,-4,,,1);ObjForMerge.makeMerge({? (menu_txt()='Akceptuj' | menu_txt()='Rozpocznij' | menu_txt()='Załączniki') || 1 ?},~ROZNE.ONE_PAGE);pierwszy:=1;~~}
         {FI}
      {ELIF: wybor=2 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: ~ROZNE.UT_VAT}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPB',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {ELSE}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPBJ',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=2 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP,ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: ~ROZNE.UT_VAT}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPB',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {ELSE}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPBJ',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=3 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP}
         {DO}
            { SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
            {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
                     SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
                  & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
                     SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
                  & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
                     SER_NAG.DATA>=WYDRUKIN.DATAOD))
                  & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
                     SER_NAG.DATA<=WYDRUKIN.DATADO) )
                  & (~WYDRUKIN.KH | (WYDRUKIN.KH &
                     SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))
                  & ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 &
                     SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD))}
               {IF: ~ROZNE.UT_VAT}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPB',,-4,,,1);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPBJ',,-4,,,1);pierwszy:=1;~~}
               {FI}
            {FI}
            {FI}
         {OD}
         {ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);~~}
      {ELIF: wybor=3 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP,ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {DO}
            { SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
            {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
                     SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
                  & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
                     SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
                  & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
                     SER_NAG.DATA>=WYDRUKIN.DATAOD))
                  & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
                     SER_NAG.DATA<=WYDRUKIN.DATADO))}
               {IF: ~ROZNE.UT_VAT}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPB',,-4,,,1);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSPBJ',,-4,,,1);pierwszy:=1;~~}
               {FI}
            {FI}
            {FI}
         {OD}
         {ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);~~}
      {FI}
   {ELSE}
      {IF: wybor=1}
         {SER_NAGS.SER_NAG();~~}
         {IF: ~ROZNE.UT_VAT}
            {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLB',,-4,,,1);ObjForMerge.makeMerge({? (menu_txt()='Akceptuj' | menu_txt()='Rozpocznij' | menu_txt()='Załączniki') || 1 ?},~ROZNE.ONE_PAGE);pierwszy:=1;~~}
         {ELSE}
            {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLBJ',,-4,,,1);ObjForMerge.makeMerge({? (menu_txt()='Akceptuj' | menu_txt()='Rozpocznij' | menu_txt()='Załączniki') || 1 ?},~ROZNE.ONE_PAGE);pierwszy:=1;~~}
         {FI}
      {ELIF: wybor=2 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: ~ROZNE.UT_VAT}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLB',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {ELSE}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLBJ',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=2 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP,ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {SELECT}
         {DO}
            {SER_NAGS.SER_NAG();~~}
            {IF: ~ROZNE.UT_VAT}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLB',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {ELSE}
               {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLBJ',,-4,,,1);ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);pierwszy:=1;~~}
            {FI}
         {OD}
      {ELIF: wybor=3 & ROZRACH.KONTR=null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'SER_NAG'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP}
         {DO}
            { SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
            {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
                     SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
                  & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
                     SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
                  & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
                     SER_NAG.DATA>=WYDRUKIN.DATAOD))
                  & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
                     SER_NAG.DATA<=WYDRUKIN.DATADO) )
                  & (~WYDRUKIN.KH | (WYDRUKIN.KH &
                     SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))
                  & ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 &
                     SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD))}
               {IF: ~ROZNE.UT_VAT}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLB',,-4,,,1);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLBJ',,-4,,,1);pierwszy:=1;~~}
               {FI}
            {FI}
            {FI}
         {OD}
         {ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);~~}
      {ELIF: wybor=3 & ROZRACH.KONTR<>null}
         {FOR: 'SER_NAGS'}
         {INDEX: 'TYPKH'}
         {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP,ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
         {DO}
            { SER_NAGS.SER_NAG();~~}
            {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
                (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
            {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
                     SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
                  & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
                     SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
                  & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
                     SER_NAG.DATA>=WYDRUKIN.DATAOD))
                  & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
                     SER_NAG.DATA<=WYDRUKIN.DATADO))}
               {IF: ~ROZNE.UT_VAT}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLB',,-4,,,1);pierwszy:=1;~~}
               {ELSE}
                  {exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLA',,-4,,,1);exec('wypelnij','szablon','FKS_KORROZ','FKS_KORROZ_PSPDSLBJ',,-4,,,1);pierwszy:=1;~~}
               {FI}
            {FI}
            {FI}
         {OD}
         {ObjForMerge.makeMerge(0,~ROZNE.ONE_PAGE);~~}
      {FI}
   {FI}
   {IF: ~pierwszy}
      {FUN.info('Brak danych spełniających zadane kryteria \nlub nie zdefiniowano poprawnie odpowiednich wzorców wydruków.'@);~~}
      {EXIT}
   {FI}
   {EXIT}
{FI}
{  SZKH.BANK:=SKID_RBK.BANK().NB; SZKH.KB:=RACHBANK.KB_1R; PAR_WYDR.HEAD:=0; ~~}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: wsp_lic.rpi}
{INCLUDE: fks_kor_head.rpi}
{HEADER}
{IF: druktyt}
{FONT: 'HEAD'}{SPACE: 'B'}
{>{charleft()} XINFO.MIA+', '+$SER_NAG.DATA}
{SUBSTITUTE: 'HEAD'}{FONT: 'W8'}{SPACE: 'C'}
{LINE: 1}
{ELSE}
{druktyt:=1;~~}
{FI}
{HEADER-}
{IF: _a:=PAR_SKID.get(34); _a='Z' | _a='A'}
{FOOTER}{ nr_str+=1;~~}
{SUBSTITUTE: 'FOOT_LIC'}
{~~}
{~~}
{~~}
{~~}
{FONT: '@'}{SPACE: '@'}{>{charleft()}  naz_str+$nr_str}
{FOOTER-}
{ELSE}
{FOOTER}{ nr_str+=1;~~}
{FONT: '@'}{SPACE: '@'}{>{charleft()}  naz_str+$nr_str}
{FOOTER-}
{FI}
{COMMENT}------------------------------WYDRUK-----------------------{COMMENT-}
{  rsep:=PAR_WYDR.RSEP; ~~}
{IF: wybor=1}
   { {? var_press('ToPDF')<=0 || SER_NAGS.SER_NAG() ?}; new_poz:=new_poz1:=0;~~}{REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
{ELIF: wybor=2 & ROZRACH.KONTR=null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'SER_NAG'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP}
   {SELECT}
   {DO}
      { SER_NAGS.SER_NAG();~~}
      { new_poz:=new_poz1:=0;page(1);~~}{REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
   {OD}
{ELIF: wybor=2 & ROZRACH.KONTR<>null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'TYPKH'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP,ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
   {SELECT}
   {DO}
      { SER_NAGS.SER_NAG(); new_poz:=new_poz1:=0; page(1); ~~}{REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
   {OD}
{ELIF: wybor=3 & ROZRACH.KONTR=null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'SER_NAG'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP}
   {DO}
      { SER_NAGS.SER_NAG();~~}
      {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
          (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
      {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
               SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
            & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
               SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
            & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
               SER_NAG.DATA>=WYDRUKIN.DATAOD))
            & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
               SER_NAG.DATA<=WYDRUKIN.DATADO) )
            & (~WYDRUKIN.KH | (WYDRUKIN.KH &
               SER_NAG.KH().KOD>=WYDRUKIN.KH().KOD))
            & ( ~WYDRUKIN.KH2 | (WYDRUKIN.KH2 &
               SER_NAG.KH().KOD<=WYDRUKIN.KH2().KOD))}
         { new_poz:=new_poz1:=0;~~}{REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
      {FI}
      {FI}
   {OD}
{ELIF: wybor=3 & ROZRACH.KONTR<>null}
   {FOR: 'SER_NAGS'}
   {INDEX: 'TYPKH'}
   {PREFIX: REF.FIRMA,OPERATOR.DEPT().OD,SER_KOR.TYP,ROZRACH.KONTR().KOD,ROZRACH.KONTR().KOD}
   {DO}
      { SER_NAGS.SER_NAG();~~}
      {IF: SER_KOR.WYB_WAL=2 | (SER_KOR.WYB_WAL=0 & SER_KOR.WAL=SER_NAG.WAL) |
          (SER_KOR.WYB_WAL=1 & TMP_WAL.find_key(SER_NAG.WAL().KOD,SER_NAG.WAL().KOD))}
      {IF:  (~WYDRUKIN.SER_DEF | (WYDRUKIN.SER_DEF &
               SER_NAG.KOD().KOD>=WYDRUKIN.SER_DEF().KOD))
            & (~WYDRUKIN.SER_DEF2 | (WYDRUKIN.SER_DEF2 &
               SER_NAG.KOD().KOD<=WYDRUKIN.SER_DEF2().KOD))
            & (~#WYDRUKIN.DATAOD | (#WYDRUKIN.DATAOD &
               SER_NAG.DATA>=WYDRUKIN.DATAOD))
            & (~#WYDRUKIN.DATADO | (#WYDRUKIN.DATADO &
               SER_NAG.DATA<=WYDRUKIN.DATADO))}
         { new_poz:=new_poz1:=0; page(1);~~}{REP: '{INCLUDE: '+wz_wyd+'.rpi}'}
      {FI}
      {FI}
   {OD}
{FI}
{IF: ~pierwszy}
{ FUN.info('Brak danych spełniających zadane kryteria\nlub nie zdefiniowano poprawnie odpowiednich wzorców wydruków.'@);~~}
{EXIT}
{FI}