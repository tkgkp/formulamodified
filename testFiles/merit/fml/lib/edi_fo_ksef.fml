:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: edi_fo_ksef.fml
:: Utworzony: 27.05.2021
:: Autor: AWI
:: Systemy:
::======================================================================================================================
:: Zawartość:
::======================================================================================================================


\rola_podmiotu_slo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Rola podmiotu - słownik
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_Tab:=tab_tmp(1,'ROLA','STRING[50]','Rola');
::_Tab.ROLA:='Faktor'; _Tab.add();
_Tab.ROLA:='Odbiorca'; _Tab.add();
_Tab.ROLA:='Podmiot pierwotny'; _Tab.add();
_Tab.ROLA:='Dodatkowy nabywca'; _Tab.add();
_Tab.ROLA:=exec('rola_wyst','edi_fo_ksef'); _Tab.add();
_Tab.ROLA:='Dokonujący płatności'; _Tab.add();
_Tab.ROLA:='Inny podmiot'; _Tab.add();
::_Tab.ROLA:='Grupa VAT - licencjobiorca'; _Tab.add();
::_Tab.ROLA:='Jednostka samorządu terytorialnego - wystawca'; _Tab.add();
::_Tab.ROLA:='Jednostka samorządu terytorialnego - odbiorca'; _Tab.add();
::_Tab.ROLA:='Członek grupy VAT - wystawca'; _Tab.add();
::_Tab.ROLA:='Członek grupy VAT - odbiorca'; _Tab.add();
_Tab


\rola_podmiotu_ksef
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Rola podmiotu - KSeF
::   WE: _a - opis roli
::       [_b] - format KSeF [1]/2
::       [_c] - rola
::   WY: obj_new('ROLA','ROLAINNA','OPISROLI')
::----------------------------------------------------------------------------------------------------------------------
_ksef_jak:={? var_pres('_b')=type_of(0) || _b || 1 ?};
_c:={? var_pres('_c')=type_of('') || _c || '' ?};
{? _ksef_jak<>1 & _ksef_jak<>2
|| _ksef_jak:=1
?};
_result:=obj_new('ROLA','ROLAINNA','OPISROLI');
_result.ROLA:={? var_pres('_a')=type_of('') || _c || '' ?};
_result.ROLAINNA:='';
_result.OPISROLI:=_a;
{? _result.OPISROLI<>''
|| {? _ksef_jak=2 & _a=exec('rola_grupa_vat','edi_fo_ksef')     || _result.ROLA:='0'
   |? _a=exec('rola_faktor','edi_fo_ksef')                      || _result.ROLA:='1'
   |? _a='Odbiorca'                                             || _result.ROLA:='2'
   |? _a='Podmiot pierwotny'                                    || _result.ROLA:='3'
   |? _a='Dodatkowy nabywca'                                    || _result.ROLA:='4'
   |? _a=exec('rola_wyst','edi_fo_ksef')                        || _result.ROLA:='5'
   |? _a='Dokonujący płatności'                                 || _result.ROLA:='6'
   |? _ksef_jak=2 & _a=exec('rola_jst_wyst','edi_fo_ksef')      || _result.ROLA:='7'
   |? _ksef_jak=2 & _a=exec('rola_jst_odb','edi_fo_ksef')       || _result.ROLA:='8'
   |? _ksef_jak=2 & _a=exec('rola_cz_grvat_wyst','edi_fo_ksef') || _result.ROLA:='9'
   |? _ksef_jak=2 & _a=exec('rola_cz_grvat_odb','edi_fo_ksef')  || _result.ROLA:='10'
   |? _a='Inny podmiot'                                         || _result.ROLA:='11'
   || _result.ROLA:='11'
   ?};
   {? _result.ROLA='11'
   || _result.ROLAINNA:='1';
      _result.OPISROLI:=_a
   ?}
|? _result.ROLA<>''
|| {? _ksef_jak=2 & _c='0'    || _result.OPISROLI:=exec('rola_grupa_vat','edi_fo_ksef')
   |? _c='1'                  || _result.OPISROLI:=exec('rola_faktor','edi_fo_ksef')
   |? _c='2'                  || _result.OPISROLI:='Odbiorca'
   |? _c='3'                  || _result.OPISROLI:='Podmiot pierwotny'
   |? _c='4'                  || _result.OPISROLI:='Dodatkowy nabywca'
   |? _c='5'                  || _result.OPISROLI:=exec('rola_wyst','edi_fo_ksef')
   |? _c='6'                  || _result.OPISROLI:='Dokonujący płatności'
   |? _ksef_jak=2 & _c='7'    || _result.OPISROLI:=exec('rola_jst_wyst','edi_fo_ksef')
   |? _ksef_jak=2 & _c='8'    || _result.OPISROLI:=exec('rola_jst_odb','edi_fo_ksef')
   |? _ksef_jak=2 & _c='9'    || _result.OPISROLI:=exec('rola_cz_grvat_wyst','edi_fo_ksef')
   |? _ksef_jak=2 & _c='10'   || _result.OPISROLI:=exec('rola_cz_grvat_odb','edi_fo_ksef')
   |? _c='11'                 || _result.OPISROLI:=_a
   || _result.OPISROLI:=_a
   ?};
   {? _result.ROLA='11'
   || _result.ROLAINNA:='1';
      _result.OPISROLI:=_a
   ?}
?};
_result


\rola_podmiotu_select
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Rola podmiotu - select
::   WE: _a - dotychczasowa wartość
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_fld:=_a;
_result:=obj_new('RESULT','FLD');
_result.RESULT:=0;
_result.FLD:='';
_Tab:=exec('rola_podmiotu_slo','edi_fo_ksef');
_Tab.first();
~_Tab.find_key(_fld);
_wer:=_Tab.mk_sel('Role podmiotów'@,,,'podmiot_rola',,,15,,'U');
_Tab.win_fld(_wer,,'ROLA',,,,,,,1);
_Tab.win_act(_wer,,'Formuła','Wybierz'@,,,"sel_exit()",,1);
_Tab.win_sel(_wer);
{? _Tab.select(,1,10)
||
   _result.RESULT:=1;
   _result.FLD:=_Tab.ROLA
?};
_result


\rola_faktor
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Faktor
::----------------------------------------------------------------------------------------------------------------------
'Faktor'


\rola_grupa_vat
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WHAN [23.25]
:: OPIS: Faktor
::----------------------------------------------------------------------------------------------------------------------
'Grupa VAT - licencjobiorca'


\kst_status_p_slo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Rola podmiotu - słownik
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_Tab:=tab_tmp(1,'STATUS_P','STRING[255]','Status podatnika'@);
_Tab.STATUS_P:='Podatnik w stanie likwidacji'; _Tab.add();
_Tab.STATUS_P:='Podatnik w trakcie postępowania restrukturyzacyjnego'; _Tab.add();
_Tab.STATUS_P:='Podatnik w stanie upadłości'; _Tab.add();
_Tab.STATUS_P:='Przedsiębiorstwo w spadku'; _Tab.add();
_Tab


\kst_status_p_ksef
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Rola podmiotu - KSeF
::   WE: _a - rola
::   WY: status
::----------------------------------------------------------------------------------------------------------------------
{? _a='Podatnik w stanie likwidacji'                           || '1'
|? _a='Podatnik w trakcie postępowania restrukturyzacyjnego'   || '2'
|? _a='Podatnik w stanie upadłości'                            || '3'
|? _a='Przedsiębiorstwo w spadku'                              || '4'
                                                               || ''
?}


\kst_status_p_select
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Rola podmiotu - select
::   WE: _a - dotychczasowa wartość
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_fld:=_a;
_result:=obj_new('RESULT','FLD');
_result.RESULT:=0;
_result.FLD:='';
_Tab:=exec('kst_status_p_slo','edi_fo_ksef');
_Tab.first();
~_Tab.find_key(_fld);
_wer:=_Tab.mk_sel('Statusy podatnika'@,,,'kst_status_p',,,10,,'U');
_Tab.win_fld(_wer,,'STATUS_P',,,50,,,,1);
_Tab.win_act(_wer,,'Formuła','Wybierz'@,,,"sel_exit()",,1);
_Tab.win_sel(_wer);
{? _Tab.select(,1,4)
||
   _result.RESULT:=1;
   _result.FLD:=_Tab.STATUS_P
?};
_result


\jpk_slo_proc_faks
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [22.26]
:: OPIS: Inicjuje słownik JPK_SLO - procedura w nagłówku faktury
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('bl_js_wersja','jpk_v');
HELPJPK.SLO_TYP:='PROC_FAKS';
exec('bw_jpk_slo','jpk_v')


\jpk_slo_proc_fap
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [20.14_01]
:: OPIS: Inicjuje słownik JPK_SLO - procedura w pozycji faktury
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('bl_js_wersja','jpk_v');
HELPJPK.SLO_TYP:='PROC_FAP';
exec('bw_jpk_slo','jpk_v')


\jpk_slo_proc_vat
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [20.14_01]
:: OPIS: Inicjuje słownik JPK_SLO - procedura vat
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('bl_js_wersja','jpk_v');
HELPJPK.SLO_TYP:='PROC_VAT';
exec('bw_jpk_slo','jpk_v')


\ksef_001_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Domyślne działanie wtyczki KSEF_001 - logistyka
::   WE: _a - 0 - dokument manualny (domyślnie), 1 - import z komunikatu EDI
::   WY: '' lub akronim niewłaściwie wypełnionego pola
::----------------------------------------------------------------------------------------------------------------------
{? FAKS.SZ='S'
||
   {? FAP.EF_PRVAT=null() & (FAKS.PROC=null() | FAKS.KRAJ_VAT().KODISO='' | FAKS.KRAJ_VAT().KODISO='PL')
   ||
      FAKS.T();
      _sv:=FAP.SV().KOD;
      _fa_prvat:=
:: 1 - Stawka 0% stosowana w ramach sprzedaży krajowej
         {? TYPYSP.UE='N' & TYPYSP.EXPORT='N' & _sv=' 0%'            || '1'
:: 2 - Stawka 0% - wewnątrzwspólnotowa dostawa towarów
         |? TYPYSP.UE='T' & _sv=' 0%'                                || '2'
:: 3 - Stawka 0% - eksport towarów
         |? TYPYSP.UE='N' & TYPYSP.EXPORT='T' & _sv=' 0%'            || '3'
:: 4 - Dostawa, świadczenie poza terytorium kraju
         |? FAP.M().RODZ='T' & (TYPYSP.UE='T' | TYPYSP.EXPORT='T')   || '4'
:: 5 - Świadczenie usług z art. 100 ust. 1 pkt 4 ustawy
         |? FAP.M().RODZ='U' & (TYPYSP.UE='T' | TYPYSP.EXPORT='T')   || '5'
:: 6 - Towar/usługa wymienione w załączniku 15
         |? FAKS.NDVAT='O' | _sv=' -o'                               || '6'
:: 7 - Pozostała sprzedaż krajowa
                                                                     || '7'
         ?};
      exec('FindInSet','#table','JPK_SLO','KOD',_fa_prvat,1,"FAP.EF_PRVAT:=JPK_SLO.ref()",1,'PROC_VAT')
   ?};
   {? FAP.EF_PROC=null() & FAKS.PROC=null()
   ||
      _fa_proc:=
:: SW - Dostawa w ramach sprzedaży wysyłkowej z terytorium kraju, o której mowa w art. 23 ustawy
:: EE - Świadczenie usług telekomunikacyjnych, nadawczych i elektronicznych, o których mowa w art. 28k ustawy
:: TT_D - W przypadku faktur wystawianych w procedurze uproszczonej przez drugiego w kolejności podatnika, o którym mowa w art. 135 ust. 1 pkt 4 lit. b i c oraz ust. 2, zawierającej adnotację, o której mowa w art. 136 ust. 1 pkt 1 i stwierdzenie, o którym mowa w art. 136 ust. 1 pkt 2 ustawy
         {? FAKS.DO_UE='T' || 'TT_D'
:: B_SPV - Transfer bonu jednego przeznaczenia dokonany przez podatnika działającego we własnym imieniu, opodatkowany zgodnie z art. 8a ust. 1 ustawy
:: B_SPV_DOSTAWA - Dostawa towarów oraz świadczenie usług, których dotyczy bon jednego przeznaczenia na rzecz podatnika, który wyemitował bon zgodnie z art. 8a ust. 4 ustawy
:: B_MPV_PROWIZJA - Świadczenie usług pośrednictwa oraz innych usług dotyczących transferu bonu różnego przeznaczenia, opodatkowane zgodnie z art. 8b ust. 2 ustawy
:: w pozostałych przypadkach
         || ''
         ?};
      {? _fa_proc<>'' || exec('FindInSet','#table','JPK_SLO','KOD',_fa_proc,1,"FAP.EF_PROC:=JPK_SLO.ref()",1,'PROC') ?}
   ?}
||
:: I_42 - Wewnątrzwspólnotowa dostawa towarów następująca po imporcie tych towarów w ramach procedury celnej 42 (import)
:: I_63 - Wewnątrzwspólnotowa dostawa towarów następująca po imporcie tych towarów w ramach procedury celnej 63 (import)
   ~~
?};
~~


\RodzajFaktury
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: RodzajFaktury
::   WY: VAT / KOREKTA / ZAL / ROZ / UPROSZCZONA
::----------------------------------------------------------------------------------------------------------------------
{? FAKS.T().ZAK='T'
|| {? FAKS.T().KOR='T'
   || 'KOR_VAT_RR'
   || 'VAT_RR'
   ?}
|| {? FAKS.T().KOR='T' & FAKS.T().ZAL='T'
   || 'KOR_ZAL'
   |? FAKS.T().KOR='T' & FAKS.T().ZAL='N'
   || FAPOW.cntx_psh();
      FAPOW.index('END_K');
      FAPOW.prefix($FAKS.ref());
      _fapow:=FAPOW.first();
      FAPOW.cntx_pop();
      {? _fapow || 'KOR_ROZ' || 'KOR' ?}
   |? FAKS.T().KOR='N' & FAKS.T().ZAL='T'
   || 'ZAL'
   |? FAKS.T().KOR='Z'
   || 'KOR'
   |? exec('brutto','faktury_plat',FAKS.ref(),1,1)<>FAKS.BRTW
   || 'ROZ'
   || 'VAT'
   ?}
?}


\eb_sv_szuk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Znalezienie stawki VAT w tabeli __EB.TAX_SUMM
::   WE: _a - symbol stawki
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_vsym:=_a;
_vt:=exec('str2num','#string',_vsym);

_jest:=0;
{? __EB.TAX_SUMM.first()
|| {!
   |? {? (_vt>0 & exec('str2num','#string',__EB.TAX_SUMM.SV)=_vt) | (_vt=0 & __EB.TAX_SUMM.SV=_vsym)
      || _jest:=1
      ?};
      ~_jest & __EB.TAX_SUMM.next()
   !}
?};

_jest


\kh_pole
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: wartość pola z tabeli KH
::   WE: _a - ref KH
::       _b - pole
::   WY: wartość pola z tabeli KH
::----------------------------------------------------------------------------------------------------------------------
_wyn:='';
KH.cntx_psh();
KH.clear();
{? var_pres('_a')<=0 | ~KH.seek(_a)
|| KH.blank()
?};
_fm:=$('KH.'+_b);
_wyn:=_fm();
KH.cntx_pop();
_wyn


\xmlval_start
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Wypełnia __XML.VAL i zwraca czy jest niepuste
::   WE: _a - wartość
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
__XML.VAL:=_a;
__XML.VAL<>''


\podmiot3_start
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - formuła start
::   WE: [_a] - format KSeF [1]/2
::       [_b] - rola
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_ksef_jak:={? var_pres('_a')=type_of(0) || _a || 1 ?};
_rola:={? var_pres('_b')=type_of('') || _b || '' ?};
{? _ksef_jak<>1 & _ksef_jak<>2
|| _ksef_jak:=1
?};
_ret:=0;
VAR_DEL.delete('__P3');
__P3:=obj_new('JAK','KH');
__P3.JAK:=0;
__P3.KH:=null();
FAKSKH.index('UNIK');
FAKSKH.prefix(FAKS.ref());
{? FAKS.KH_ODB<>null() & _rola=''
|| __P3.JAK:=1;
   __P3.KH:=FAKS.KH_ODB().KH_LNK
|| {? FAKSKH.first()
   || {!
      |? {? exec('rola_pomin_lsp','edi_fo_ksef2',FAKSKH.ROLA,_ksef_jak)
         || FAKSKH.next()
         |? _rola='' | _rola=FAKSKH.ROLA
         || __P3.JAK:=2;
            __P3.KH:=FAKSKH.KH;
            0
         ?}
      !}
   ?}
?};
{? __P3.JAK>0
|| _ret:=1
|| VAR_DEL.delete('__P3')
?};
_ret


\podmiot3_end
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - formuła end
::   WE: [_a] - format KSeF [1]/2
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_ksef_jak:={? var_pres('_a')=type_of(0) || _a || 1 ?};
_ret:=0;
{? _ksef_jak<>1 & _ksef_jak<>2
|| _ksef_jak:=1
?};
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || __P3.JAK:=0;
      __P3.KH:=null();
      {? FAKSKH.first()
      || {!
         |? {? exec('rola_pomin_lsp','edi_fo_ksef2',FAKSKH.ROLA,_ksef_jak)
            || FAKSKH.next()
            || __P3.JAK:=2;
               __P3.KH:=FAKSKH.KH;
               0
            ?}
         !}
      ?}
   |? __P3.JAK=2
   || __P3.JAK:=0;
      __P3.KH:=null();
      {? FAKSKH.next()
      || {!
         |? {? exec('rola_pomin_lsp','edi_fo_ksef2',FAKSKH.ROLA,_ksef_jak)
            || FAKSKH.next()
            || __P3.JAK:=2;
               __P3.KH:=FAKSKH.KH;
               0
            ?}
         !}
      ?}
   || __P3.JAK:=0
   ?};
   {? __P3.JAK>0
   || _ret:=1
   || VAR_DEL.delete('__P3')
   ?}
?};
_ret


\podmiot3_nip
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - NIP
::   WY: NIP
::----------------------------------------------------------------------------------------------------------------------
_nip:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _nip:=FAKS.O_NIP;
      {? _nip='' & FAKS.KH_ODB().JST='T'
      || _nip:=FAKS.KH_ODB().NIP
      ?}
   |? __P3.JAK=2
   || _nip:=FAKSKH.NIP
   ?}
?};
_nip:=exec('niptostr','#string',_nip);
_nip


\podmiot3_nipue
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: "Podmiot3" - NIP UE
::   WY: NIP
::----------------------------------------------------------------------------------------------------------------------
_nip:='';
_nip


\podmiot3_idwew
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [RR.xx]
:: OPIS: "Podmiot3" - Identyfikator wewnętrzny jednostki samorządu terytorialnego
::   WY: Identyfikator wewnętrzny
::----------------------------------------------------------------------------------------------------------------------
_idwew:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || {? exec('upgrade2325_jst01','zbl') & FAKS.KH_ODB().JST='T'
      || _idwew:=FAKS.KH_ODB().ID_WEW
      ?}
   ?}
?};
_idwew


\podmiot3_naz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - nazwa
::   WY: nazwa
::----------------------------------------------------------------------------------------------------------------------
_naz:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _naz:=FAKS.O_NAZ
   |? __P3.JAK=2
   || _naz:=FAKSKH.NAZ
   ?}
::   {? _naz=''
::   || _naz:=exec('kh_pole','edi_fo_ksef',__P3.KH,'NAZ_P')
::   ?}
?};
_naz


\podmiot3_krajiso
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - symbol kraju
::   WY: symbol kraju
::----------------------------------------------------------------------------------------------------------------------
_sym:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _sym:=FAKS.O_KRISO().SYM
   |? __P3.JAK=2
   || _sym:=FAKSKH.KRAJISO().SYM
   ?}
::   {? _sym=''
::   || _sym:=exec('kh_pole','edi_fo_ksef',__P3.KH,'KRAJISO().SYM')
::   ?}
?};
_sym


\podmiot3_miasto
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - miasto
::   WY: miasto
::----------------------------------------------------------------------------------------------------------------------
_mia:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _mia:=FAKS.O_MIASTO
   |? __P3.JAK=2
   || _mia:=FAKSKH.MIASTO
   ?}
::   {? _mia=''
::   || _mia:=exec('kh_pole','edi_fo_ksef',__P3.KH,'MIASTO')
::   ?}
?};
_mia


\podmiot3_ulica
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - ulica
::   WY: ulica
::----------------------------------------------------------------------------------------------------------------------
_ul:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _ul:=FAKS.O_UL
   |? __P3.JAK=2
   || _ul:=FAKSKH.UL
   ?}
::   {? _ul=''
::   || _ul:=exec('kh_pole','edi_fo_ksef',__P3.KH,'UL')
::   ?}
?};
_ul


\podmiot3_dom
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot3" - nr domu
::   WY: nr domu
::----------------------------------------------------------------------------------------------------------------------
_dom:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _dom:=FAKS.O_DOM
   |? __P3.JAK=2
   || _dom:=FAKSKH.DOM
   ?}
::   {? _dom=''
::   || _dom:=exec('kh_pole','edi_fo_ksef',__P3.KH,'DOM')
::   ?}
?};
_dom


\podmiot3_lokal
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot3" - nr lokalu
::   WY: nr lokalu
::----------------------------------------------------------------------------------------------------------------------
_lok:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _lok:=FAKS.O_LOKAL
   |? __P3.JAK=2
   || _lok:=FAKSKH.LOKAL
   ?}
::   {? _lok=''
::   || _lok:=exec('kh_pole','edi_fo_ksef',__P3.KH,'LOKAL')
::   ?}
?};
_lok


\podmiot3_kdp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - kod pocztowy
::   WY: kod pocztowy
::----------------------------------------------------------------------------------------------------------------------
_kdp:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _kdp:=exec('KodPoczta','edi_fo_ksef',FAKS.O_POCZ,FAKS.O_KPOCZ)
   |? __P3.JAK=2
   || _kdp:=exec('KodPoczta','edi_fo_ksef',FAKSKH.POCZ,FAKSKH.KPOCZ)
   ?}
::   {? _kdp=''
::   || _kdp:=exec('kh_pole','edi_fo_ksef',__P3.KH,'KPOCZ')
::   ?}
?};
_kdp


\podmiot3_poczta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot3" - poczta
::   WY: poczta
::----------------------------------------------------------------------------------------------------------------------
_poczta:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || _poczta:=exec('KodPoczta','edi_fo_ksef',FAKS.O_POCZ,FAKS.O_KPOCZ,'P')
   |? __P3.JAK=2
   || _poczta:=exec('KodPoczta','edi_fo_ksef',FAKSKH.POCZ,FAKSKH.KPOCZ,'P')
   ?}
::   {? _poczta=''
::   || _poczta:=exec('kh_pole','edi_fo_ksef',__P3.KH,'POCZ')
::   ?}
?};
_poczta


\podmiot3_rola
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - rola
::   WE: [_a] - format KSeF [1]/2
::   WY: rola
::----------------------------------------------------------------------------------------------------------------------
_ksef_jak:={? var_pres('_a')=type_of(0) || _a || 1 ?};
{? _ksef_jak<>1 & _ksef_jak<>2
|| _ksef_jak:=1
?};
_rola:='';
{? var_press('__P3')>0
|| {? __P3.JAK=1
   || {? _ksef_jak=2 & FAKS.KH_ODB().JST='T'
      || _rola:='8'
      |? _ksef_jak=2 & FAKS.KH_ODB().CGVAT='T'
      || _rola:='10'
      || _rola:='2'
      ?}
   || _rola:=exec('rola_podmiotu_ksef','edi_fo_ksef',FAKSKH.ROLA,_ksef_jak).ROLA
   ?}
?};
_rola


\podmiot3_rola_op
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - opis roli
::   WE: [_a] - format KSeF [1]/2
::   WY: opis roli
::----------------------------------------------------------------------------------------------------------------------
_ksef_jak:={? var_pres('_a')=type_of(0) || _a || 1 ?};
{? _ksef_jak<>1 & _ksef_jak<>2
|| _ksef_jak:=1
?};
_op:='';
{? var_press('__P3')>0
|| {? __P3.JAK=2
   || _op:=exec('rola_podmiotu_ksef','edi_fo_ksef',FAKSKH.ROLA,_ksef_jak).OPISROLI
   ?}
?};
_op


\podmiot_upow_start
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot upoważniony" - formuła start
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_ret:=0;
VAR_DEL.delete('__PU');
__PU:=obj_new('JAK','KH');
__PU.JAK:=0;
__PU.KH:=null();
FAKSPOLA.index('UNIK');
FAKSPOLA.prefix(FAKS.ref());
{? FAKSPOLA.first()
|| {? FAKSPOLA.EGZ_KH<>null()
   || __PU.JAK:=1;
      __PU.KH:=FAKSPOLA.EGZ_KH
   |? FAKSPOLA.PP_KH<>null()
   || __PU.JAK:=3;
      __PU.KH:=FAKSPOLA.PP_KH
   ?}
?};
{? __PU.JAK>0
|| _ret:=1
|| VAR_DEL.delete('__PU')
?};
_ret


\podmiot_upow_end
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot upoważniony" - formuła end
::   WY: 0
::----------------------------------------------------------------------------------------------------------------------
_ret:=0;
VAR_DEL.delete('__PU');
_ret


\nst_czy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Czy nowy środek transportu
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_czy:=0;
FAKSPOLA.index('UNIK');
FAKSPOLA.prefix(FAKS.ref());
{? FAKSPOLA.first()
|| _czy:=(FAKSPOLA.NST_DATA<>date(0,0,0) | FAKSPOLA.NST_RODZ<>'')
?};
_czy


\nst_poj_czy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Czy nowy środek transportu z danymi pojazdu
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
exec('nst_czy','edi_fo_ksef') & FAKSPOLA.NST_POJ<>null()


\nst_ladowy_czy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Czy nowy środek transportu lądowy
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
exec('nst_czy','edi_fo_ksef') & (FAKSPOLA.NST_RODZ=exec('nst_ladowy','jpk_log') | FAKSPOLA.NST_RODZ='')


\nst_plywajacy_czy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Czy nowy środek transportu pływający
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
exec('nst_czy','edi_fo_ksef') & FAKSPOLA.NST_RODZ=exec('nst_plywajacy','jpk_log')


\nst_powietrzny_czy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Czy nowy środek transportu powietrzny
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
exec('nst_czy','edi_fo_ksef') & FAKSPOLA.NST_RODZ=exec('nst_powietrzny','jpk_log')


\uds_opis_nr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: Numer procedury marży UDS (używane, dzieła sztuki)
::   WY: 0 / 1 / 2 / 3
::----------------------------------------------------------------------------------------------------------------------
_nr:=3;
_jest:=0;
{!
|? {? FAKSPOLA.UDS_OPIS=exec('uds_opis','jpk_log',_nr)
   || _jest:=1
   || _nr-=1
   ?};
   ~_jest & _nr>=1
!};
_nr


\sv
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: stawka vat w postaci 7
::   WE: _a - SLO.KOD
::       _b - FAKS.NDVAT
::----------------------------------------------------------------------------------------------------------------------
_sv:=exec('sv','edi_form',_a);
{? _sv+3='.00'       || _sv:=_sv-3
|? FAKS.KRAJ_VAT().KODISO<>'' & FAKS.KRAJ_VAT().KODISO<>'PL'
|| _sv:='0'
|? _a=' -' | _b='T'  || _sv:='np'
|? _a=' -o' | _b='O' || _sv:='oo'
|? _a=' -zw0'        || _sv:='zw'
|? _a='Zwol.'        || _sv:='zw'
?};
_sv


\platnosc_ksef_slo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Forma płatności - słownik - KSeF
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_Tab:=tab_tmp(1,'NUMER','INTEGER','Numer',
              'PLATNOSC','STRING[50]','Płatność'
              );
_Tab.PLATNOSC:='gotówka';
_Tab.NUMER:=1;
_Tab.add();
_Tab.PLATNOSC:='karta';
_Tab.NUMER:=2;
_Tab.add();
_Tab.PLATNOSC:='bon';
_Tab.NUMER:=3;
_Tab.add();
_Tab.PLATNOSC:='czek';
_Tab.NUMER:=4;
_Tab.add();
_Tab.PLATNOSC:='kredyt';
_Tab.NUMER:=5;
_Tab.add();
_Tab.PLATNOSC:='przelew';
_Tab.NUMER:=6;
_Tab.add();
_Tab.PLATNOSC:='mobilna';
_Tab.NUMER:=7;
_Tab.add();
_Tab


\platnosc_ksef_nr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Forma płatności (numer) - KSeF
::   WE: _a - ref() płatności
::   WY: numer
::----------------------------------------------------------------------------------------------------------------------
_nr:=0;
_naz1:='';
_naz2:='';
SLO.cntx_psh();
ZR_SLO.cntx_psh();
SLO.clear();
ZR_SLO.index('SLO_NR');
{? SLO.seek(_a)
|| _naz1:=SLO.TR;
   ZR_SLO.prefix(_a,1);
   {? ZR_SLO.first()
   || {? ZR_SLO.WAR='T'
      || _naz2:='gotówka'
      ?}
   ?};
   {? _naz2=''
   || ZR_SLO.prefix(_a,5);
      {? ZR_SLO.first()
      || _naz2:=ZR_SLO.WAR
      ?}
   ?};
   {? _naz2=''
   || _naz2:='przelew'
   ?}
?};
SLO.cntx_pop();
ZR_SLO.cntx_pop();
{? _naz1<>'' | _naz2<>''
|| _slo:=exec('platnosc_ksef_slo','edi_fo_ksef');
   {? _slo.first()
   || _jest:=0;
      {!
      |? {? (_naz1<>'' & -_naz1=_slo.PLATNOSC) | (_naz2<>'' & -_naz2=_slo.PLATNOSC)
         || _nr:=_slo.NUMER;
            _jest:=1
         ?};
         ~_jest & _slo.next()
      !}
   ?}
?};
_nr


\TypKorekty
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: TypKorekty
::   WY: 1 / 2
::----------------------------------------------------------------------------------------------------------------------
_tk:='';
{? FAKS.LKSQL<>''
|| {? exec('FindAndGet','#table',FAKS,FAKS.LKSQL,,"FAKS.DO",date(0,0,0))=FAKS.DO
   || _tk:='1'
   || _tk:='2'
   ?}
?};
_tk


\podmiot2k_start
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot2K" - formuła start
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
:: dla korekty RR kontrahent dokumentu korygowanego jest pomijany, bo jest w Podmiot1K
_ret:=0;
VAR_DEL.delete('__P2K');
__P2K:=obj_new('JAK','KH');
__P2K.JAK:=0;
__P2K.KH:=null();

FAKS.cntx_psh();
FAKSKH.cntx_psh();

{? FAKS.LKSQL<>'' & FAKS.WHERE='N'
|| _lksql:=FAKS.LKSQL;
   FAKS.use(form(8+_lksql));
   FAKSKH.use('fkpf_'+(5-form(8+_lksql)));
   FAKS.prefix();
   {? FAKS.seek(_lksql)
   || FAKSKH.index('UNIK');
      FAKSKH.prefix(FAKS.ref());
      __P2K.JAK:=1;
      __P2K.KH:=FAKS.KH
   ?}
?};

{? __P2K.JAK>0
|| {? FAKS.SZ='Z'
   || _ret:=exec('podmiot2k_end','edi_fo_ksef')
   || _ret:=1
   ?}
|| FAKS.cntx_pop();
   FAKSKH.cntx_pop();
   VAR_DEL.delete('__P2K')
?};
_ret


\podmiot2k_end
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot2K" - formuła end
::   WE: [_a] - format KSeF [1]/2
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_ksef_jak:={? var_pres('_a')=type_of(0) || _a || 1 ?};
_ret:=0;
{? var_press('__P2K')>0
|| {? __P2K.JAK=1 & FAKS.KH_ODB<>null()
   || __P2K.JAK:=2;
      __P2K.KH:=FAKS.KH_ODB().KH_LNK
   |? __P2K.JAK=2 | (__P2K.JAK=1 & FAKS.KH_ODB=null())
   || __P2K.JAK:=0;
      __P2K.KH:=null();
      {? FAKSKH.first()
      || {!
         |? {? exec('rola_pomin_lsp','edi_fo_ksef2',FAKSKH.ROLA,_ksef_jak)
            || FAKSKH.next()
            || __P2K.JAK:=3;
               __P2K.KH:=FAKSKH.KH;
               0
            ?}
         !}
      ?}
   |? __P2K.JAK=3
   || __P2K.JAK:=0;
      __P2K.KH:=null();
      {? FAKSKH.next()
      || {!
         |? {? exec('rola_pomin_lsp','edi_fo_ksef2',FAKSKH.ROLA,_ksef_jak)
            || FAKSKH.next()
            || __P2K.JAK:=3;
               __P2K.KH:=FAKSKH.KH;
               0
            ?}
         !}
      ?}
   ?};
   {? __P2K.JAK>0
   || _ret:=1
   || FAKS.cntx_pop();
      FAKSKH.cntx_pop();
      VAR_DEL.delete('__P2K')
   ?}
?};
_ret


\podmiot2k_pref
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot2K" - prefiks NIP
::   WY: prefiks NIP
::----------------------------------------------------------------------------------------------------------------------
_nip:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _nip:=2+FAKS.NIP_UE
   ?}
?};
_nip


\podmiot2k_nip
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - NIP
::   WY: NIP
::----------------------------------------------------------------------------------------------------------------------
_nip:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _nip:=FAKS.NIP
   |? __P2K.JAK=2
   || _nip:=FAKS.O_NIP
   |? __P2K.JAK=3
   || _nip:=FAKSKH.NIP
   ?}
?};
_nip:=exec('niptostr','#string',_nip);
_nip


\podmiot2k_nipue
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: "Podmiot2K" - NIP UE
::   WY: NIP
::----------------------------------------------------------------------------------------------------------------------
_nip:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _nip:=FAKS.NIP_UE
   ?}
?};
_nip


\podmiot2k_naz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot2K" - nazwa
::   WY: nazwa
::----------------------------------------------------------------------------------------------------------------------
_naz:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _naz:=FAKS.NAZ
   |? __P2K.JAK=2
   || _naz:=FAKS.O_NAZ
   |? __P2K.JAK=3
   || _naz:=FAKSKH.NAZ
   ?}
?};
_naz


\podmiot2k_krajiso
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot2K" - symbol kraju
::   WY: symbol kraju
::----------------------------------------------------------------------------------------------------------------------
_sym:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _sym:=FAKS.KH().KRAJISO().SYM
   |? __P2K.JAK=2
   || _sym:=FAKS.O_KRISO().SYM
   |? __P2K.JAK=3
   || _sym:=FAKSKH.KRAJISO().SYM
   ?}
?};
_sym


\podmiot2k_miasto
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot3" - miasto
::   WY: miasto
::----------------------------------------------------------------------------------------------------------------------
_mia:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _mia:=FAKS.MIASTO
   |? __P2K.JAK=2
   || _mia:=FAKS.O_MIASTO
   |? __P2K.JAK=3
   || _mia:=FAKSKH.MIASTO
   ?}
?};
_mia


\podmiot2k_ulica
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot2K" - ulica
::   WY: ulica
::----------------------------------------------------------------------------------------------------------------------
_ul:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _ul:=FAKS.UL
   |? __P2K.JAK=2
   || _ul:=FAKS.O_UL
   |? __P2K.JAK=3
   || _ul:=FAKSKH.UL
   ?}
?};
_ul


\podmiot2k_dom
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2K" - nr domu
::   WY: nr domu
::----------------------------------------------------------------------------------------------------------------------
_dom:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _dom:=FAKS.DOM
   |? __P2K.JAK=2
   || _dom:=FAKS.O_DOM
   |? __P2K.JAK=3
   || _dom:=FAKSKH.DOM
   ?}
?};
_dom


\podmiot2k_lokal
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2K" - nr lokalu
::   WY: nr lokalu
::----------------------------------------------------------------------------------------------------------------------
_lok:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _lok:=FAKS.LOKAL
   |? __P2K.JAK=2
   || _lok:=FAKS.O_LOKAL
   |? __P2K.JAK=3
   || _lok:=FAKSKH.LOKAL
   ?}
?};
_lok


\podmiot2k_kdp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.37]
:: OPIS: "Podmiot2K" - kod pocztowy
::   WY: kod pocztowy
::----------------------------------------------------------------------------------------------------------------------
_kdp:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _kdp:=exec('KodPoczta','edi_fo_ksef',FAKS.POCZ,FAKS.KPOCZ)
   |? __P2K.JAK=2
   || _kdp:=exec('KodPoczta','edi_fo_ksef',FAKS.O_POCZ,FAKS.O_KPOCZ)
   |? __P2K.JAK=3
   || _kdp:=exec('KodPoczta','edi_fo_ksef',FAKSKH.POCZ,FAKSKH.KPOCZ)
   ?}
?};
_kdp


\podmiot2k_poczta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2K" - poczta
::   WY: poczta
::----------------------------------------------------------------------------------------------------------------------
_poczta:='';
{? var_press('__P2K')>0
|| {? __P2K.JAK=1
   || _poczta:=exec('KodPoczta','edi_fo_ksef',FAKS.POCZ,FAKS.KPOCZ,'P')
   |? __P2K.JAK=2
   || _poczta:=exec('KodPoczta','edi_fo_ksef',FAKS.O_POCZ,FAKS.O_KPOCZ,'P')
   |? __P2K.JAK=3
   || _poczta:=exec('KodPoczta','edi_fo_ksef',FAKSKH.POCZ,FAKSKH.KPOCZ,'P')
   ?}
?};
_poczta


\uu_id
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Uniwersalny unikalny numer wiersza faktury
::   WE: _a - FAP.ref()
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_poz:=_a;
_result:='';
_fap:=obj_new('FAKS','POZ','IDADD');
_fap.FAKS:='';
_fap.POZ:=0;
_fap.IDADD:='';
exec('FindAndGet','#table',FAP,_poz,,"
   _fap:=_b;
   _fap.FAKS:=FAP.FAKS;
   _fap.POZ:=FAP.POZ;
   _fap.IDADD:=FAP.IDADD
",null(),_fap);
_result:=_fap.IDADD;
_lksql:=exec('FindAndGet','#table',FAKS,_fap.FAKS,,"FAKS.LKSQL",'');
{? _lksql<>''
||
   _poz:=exec('FindAndGet','#table',FAKS,_lksql,,"
      exec('FindInSet','#table','FAP','FAP',_b,FAKS.ref(),,,,null())
   ",null(),_fap.POZ);
   {? _poz || _result:=exec('uu_id','edi_fo_ksef',_poz) ?}
?};
_result


\kh_faktor
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Znalenie kontrahenta będącego faktorem dokumentu sprzedaży
::   WY: KH.ref() albo null()
::----------------------------------------------------------------------------------------------------------------------
_kh:=null();
{? FAKS.SZ='S' & FAKS.SKID_RBK().TAB='KH'
|| KH.cntx_psh();
   {? KH.seek(FAKS.SKID_RBK().REF)
   || _kh:=KH.ref()
   ?};
   KH.cntx_pop()
?};
_kh


\kh_faktor_v
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Znalenie kontrahenta będącego faktorem dokumentu sprzedaży - rachunek VAT
::   WY: KH.ref() albo null()
::----------------------------------------------------------------------------------------------------------------------
_kh:=null();
{? FAKS.SZ='S' & FAKS.VSKIDRBK().TAB='KH'
|| KH.cntx_psh();
   {? KH.seek(FAKS.VSKIDRBK().REF)
   || _kh:=KH.ref()
   ?};
   KH.cntx_pop()
?};
_kh


\OkresFaKorygowanej
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [22.26]
:: OPIS: OkresFaKorygowanej
::   WE: _a - 0 - warunek; 1 - okres
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? _a=0
||
   {? FAKS.T().KOR='Z'
   ||
      1
   ||
      exec('polafaks_get','jpk_log');
      FAKSPOLA.OKRES_OD<>date(0,0,0) & FAKSPOLA.OKRES_DO<>date(0,0,0)
   ?}
||
   {? FAKS.T().KOR='Z'
   ||
      exec('date_f','edi_fo03',FAKS.KZ_OD)+' - '+exec('date_f','edi_fo03',FAKS.KZ_DO)
   ||
      exec('date_f','edi_fo03',FAKSPOLA.OKRES_OD)+' - '+exec('date_f','edi_fo03',FAKSPOLA.OKRES_DO)
   ?}
?}


\FaKorygowane
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: zwraca tabelę danych korygowanych faktur, dla korekty zwykłej lub zbiorczej
::   WE: [_a] - 0 - wszystkie (domyślnie), 1 - z nr KSEF, 2 - bez nr KSEF
::   WY: tabela z danymi korygowanych faktur
::----------------------------------------------------------------------------------------------------------------------
_jak:={? var_pres('_a')=type_of(0) || _a || 0 ?};
_tab:=tab_tmp(2,
              'DW','DATE','Data wystawienia',
              'SYM','STRING[20]','Symbol',
              'NRKSEF','STRING[40]','Nr KSeF');
{? FAKS.T().KOR='Z'
||
   _fml:="_tab:=_b;
         ";
   {? _jak=1
   || _fml+="_czy:=(FAKS.NRKSEF<>'');
            "
   |? _jak=2
   || _fml+="_czy:=(FAKS.NRKSEF='');
            "
   || _fml+="_czy:=1;
            "
   ?};
   _fml+="{? _czy
          || DOKUM.cntx_psh();
             _tab.DW:={? exec('bl_dokum_seek','zbl',FAKS) || DOKUM.KSEFSDAT || date(0,0,0) ?};
             DOKUM.cntx_pop();
             _tab.SYM:=FAKS.SYM;
             _tab.NRKSEF:=FAKS.NRKSEF;
             _tab.add()
          ?}
         ";
   FAKS_KZF.cntx_psh();
   FAKS_KZF.index('KZ_UID');
   FAKS_KZF.prefix(FAKS.uidref());
   {? FAKS_KZF.first()
   ||
      {!
      |?
         _kor:=FAKS_KZF.KOR;
         _lksql:=exec('FindAndGet','#table',FAKS,_kor,,"FAKS.LKSQL",'');
         _kz:=exec('FindAndGet','#table',FAKS,_lksql,,"FAKS.KZ",'');
         _faks:={? _kz='' || _lksql || _kz ?};
         exec('FindAndGet','#table',FAKS,_faks,,_fml,'',_tab);
         FAKS_KZF.next()
      !}
   ?};
   FAKS_KZF.cntx_pop()
||
   _fml:="_tab:=_b;
         ";
   {? _jak=1
   || _fml+="_czy:=(FAKS.NRKSEF<>'');
            "
   |? _jak=2
   || _fml+="_czy:=(FAKS.NRKSEF='');
            "
   || _fml+="_czy:=1;
            "
   ?};
   _fml+="{? _czy
          || DOKUM.cntx_psh();
             _tab.DW:={? exec('bl_dokum_seek','zbl',FAKS) || DOKUM.KSEFSDAT |? (FAKS.name()+2)='hs' || FAKS.DW || date(0,0,0) ?};
             DOKUM.cntx_pop();
             _tab.SYM:=FAKS.SYM;
             _tab.NRKSEF:=FAKS.NRKSEF;
             _tab.add()
          ?}
   ";
   _kz:=exec('FindAndGet','#table',FAKS,FAKS.LKSQL,,"FAKS.KZ",'');
   _faks:={? _kz='' || FAKS.FKSQL || _kz ?};
   exec('FindAndGet','#table',FAKS,_faks,,_fml,'',_tab,_jak)
?};
_tab


\KodPoczta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: zwraca kod pocztowy albo pocztę na podstawie napisu "kod pocztowy poczta"
::   WE: _a - napis zawierający "kod pocztowy poczta"
::       _b - napis zawierający "kod pocztowy"
::       _c - K - kod pocztowy (domyślnie), P - poczta
::   WY: kod pocztowy albo poczta
::----------------------------------------------------------------------------------------------------------------------
_nap:='';
_jak:='K';
_kdp:='';
_pcz:='';
{? var_pres('_a')=type_of('')
|| _nap:=_a
?};
{? var_pres('_b')=type_of('')
|| _kdp:=_b
?};
{? var_pres('_c')=type_of('')
|| _jak:=_c
?};
{? _kdp=''
|| {? _nap<>''
   || _ii:=_nap*' ';
      {? _ii>0
      || _kdp:=(_ii-1)+_nap;
         _pcz:=_ii-_nap
      || _kdp:=_nap
      ?}
   ?}
|| _kk:=+_kdp;
   {? (_kk+1)+_nap=_kdp+' '
   || _pcz:=(_kk+1)-_nap
   || _pcz:=_nap
   ?}
?};
{? _jak='P'
|| _wyn:=_pcz
|| _wyn:=_kdp
?};
_wyn


\Adres_CzyDane
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: czy są wszystkie wymagane do KSeF dane adresu kontrahenta
:: kod kraju i miasto - zawsze, kod pocztowy i numer domu - tylko dla PL
::   WE: _a - kod kraju
::       _b - miasto
::       _c - kod pocztowy
::       _d - numer domu
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_kraj:='';
_mia:='';
_kdp:='';
_dom:='';
{? var_pres('_a')=type_of('')
|| _kraj:=_a
?};
{? var_pres('_b')=type_of('')
|| _mia:=_b
?};
{? var_pres('_c')=type_of('')
|| _kdp:=_c
?};
{? var_pres('_d')=type_of('')
|| _dom:=_d
?};
_wyn:=0;
{? _kraj<>'' & _mia<>''
|| {? _kraj='PL'
   || {? _kdp<>'' & _dom<>''
      || _wyn:=1
      ?}
   || _wyn:=1
   ?}
?};
_wyn


\RachBank_Kraj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Rachunek bankowy - symbol kraju
::   WE: [_a] - 0 - dla FAKS.SKID_RBK (domyslne), 1 - dla FAKS.VSKIDRBK
::   WY: symbol kraju
::----------------------------------------------------------------------------------------------------------------------
_jak:=0;
{? var_pres('_a')=type_of(0)
|| _jak:=_a
?};
_kraj:='';
{? _jak
|| _kraj:=FAKS.VSKIDRBK().KRAJ().KODISO
|| _kraj:=FAKS.SKID_RBK().KRAJ().KODISO
?};
_kraj


\RachBank_Rach
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Rachunek bankowy - nr rachunku
::   WE: [_a] - 0 - dla FAKS.SKID_RBK (domyslne), 1 - dla FAKS.VSKIDRBK
::       [_b] - czy dodać kod kraju: 0 - tylko dla zagranicznych (domyślnie), 1 - zawsze
::   WY: nr rachunku
::----------------------------------------------------------------------------------------------------------------------
_jak:=0;
_jak_kraj:=0;
{? var_pres('_a')=type_of(0)
|| _jak:=_a
?};
{? var_pres('_b')=type_of(0)
|| _jak_kraj:=_b
?};
_rach:='';
_kraj:=exec('RachBank_Kraj','edi_fo_ksef');
{? _jak
|| _rach:=FAKS.VSKIDRBK().N
|| _rach:=FAKS.SKID_RBK().N
?};
{? _rach<>'' & (_jak_kraj<>0 | _kraj<>'PL')
|| _rach:=_kraj+_rach
?};
_rach


\RachBank_Swift
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Rachunek bankowy - SWIFT
::   WE: [_a] - 0 - dla FAKS.SKID_RBK (domyslne), 1 - dla FAKS.VSKIDRBK
::   WY: SWITF
::----------------------------------------------------------------------------------------------------------------------
_jak:=0;
{? var_pres('_a')=type_of(0)
|| _jak:=_a
?};
_swift:='';
{? _jak
|| {? FAKS.VSKIDRBK().SWIFT=''
   || _swift:=FAKS.VSKIDRBK().BANK().SWIFT
   || _swift:=FAKS.VSKIDRBK().SWIFT
   ?}
|| {? FAKS.SKID_RBK().SWIFT=''
   || _swift:=FAKS.SKID_RBK().BANK().SWIFT
   || _swift:=FAKS.SKID_RBK().SWIFT
   ?}
?};
_swift


\RachBank_Naz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Rachunek bankowy - nazwa banku
::   WE: [_a] - 0 - dla FAKS.SKID_RBK (domyslne), 1 - dla FAKS.VSKIDRBK
::   WY: nazwa
::----------------------------------------------------------------------------------------------------------------------
_jak:=0;
{? var_pres('_a')=type_of(0)
|| _jak:=_a
?};
_naz:='';
{? _jak
|| _naz:=FAKS.VSKIDRBK().BANK().NB
|| _naz:=FAKS.SKID_RBK().BANK().NB
?};
_naz


\ksef_validate
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [22.26]
:: OPIS: Walidacja wstępna dokumentu KSeF
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_edi:=exec('edi','edi_wspolne');
_edi.xml_xsd_validate:=1;
{? var_pres('BL_TYPE',_edi.context)>0
      &
   (_edi.context.BL_TYPE='KSeF_INV'
      |
   _edi.context.BL_TYPE='KSeF_INV_CORR')
||
::   {? FAKS.DW<date()
::   ||
::      exec('add_kom','#message',
::         'Data wystawienia dokumentu %1 nie może być wcześniejsza od aktualnej daty.'@[FAKS.SYM],
::         2,EDI_Z.SYM);
::      return(0)
::   ?};
   {? FAKS.T().KOR='Z'
   || _dob:=1;
      _tb:=exec('FaKorygowane','edi_fo_ksef');
      {? _tb.first()
      || {!
         |? {? _tb.NRKSEF=''
            || _dob:=0;
               exec('add_kom','#message',
                    'Należy potwierdzić korygowany dokument %1 przed wygenerowaniem dokumentu %2.'@[_tb.SYM,FAKS.SYM],
                    2,EDI_Z.SYM)
            ?};
            _tb.next()
         !}
      ?};
      {? ~_dob
      || return(0)
      ?}
   || _sym:=exec('FindAndGet','#table',FAKS,FAKS.LKSQL,,"
            {? FAKS.KZ<>'' || exec('FindAndGet','#table',FAKS,FAKS.KZ,,\"{? FAKS.NRKSEF='' || FAKS.SYM || '' ?}\",'')
            |? FAKS.NRKSEF='' || FAKS.SYM || '' ?}
         ",'');
      {? _sym<>''
      || exec('add_kom','#message',
            'Należy potwierdzić korygowany dokument %1 przed wygenerowaniem dokumentu %2.'@[_sym,FAKS.SYM],
            2,EDI_Z.SYM);
         return(0)
      ?}
   ?}
?};
1


\podmiot_os_fiz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot" - czy jest osobą fizyczną
::   WE: _a - KH.ref()
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_kh:=_a;
_osfiz:=(exec('kh_pole','edi_fo_ksef',_kh,'FIZYCZNY')=1);
_osfiz


\podmiot_im_naz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "PodmiotUpowazniony" - imię albo nazwisko
::   WE: _a - KH.ref()
::       _b - N - nazwisko (domyślnie), I - imię
::   WY: imię albo nazwisko
::----------------------------------------------------------------------------------------------------------------------
_jak:='N';
{? var_pres('_b')=type_of('')
|| _jak:=_b
?};
_kh:=_a;
_imie:=exec('kh_pole','edi_fo_ksef',_kh,'FIZ_IM');
_nazw:=exec('kh_pole','edi_fo_ksef',_kh,'FIZ_NAZW');
{? _nazw='' & exec('kh_pole','edi_fo_ksef',_kh,'OSOBA')<>null()
|| _imie:=exec('kh_pole','edi_fo_ksef',_kh,'OSOBA().PIERWSZE');
   _nazw:=exec('kh_pole','edi_fo_ksef',_kh,'OSOBA().NAZWISKO')
?};
{? _jak='I'
|| _wyn:=_imie
|| _wyn:=_nazw
?};
_wyn


\podmiot2_os_fiz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2" - czy jest osobą fizyczną
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_osfiz:=exec('podmiot_os_fiz','edi_fo_ksef',FAKS.KH);
_osfiz


\podmiot2_im_naz_jest
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2" - czy jest imię i nazwisko
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_wyn:=exec('podmiot2_imie','edi_fo_ksef')<>'' & exec('podmiot2_nazwisko','edi_fo_ksef')<>'';
_wyn


\podmiot2_imie
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2" - imię
::   WY: imię
::----------------------------------------------------------------------------------------------------------------------
_imie:=exec('podmiot_im_naz','edi_fo_ksef',FAKS.KH,'I');
_imie


\podmiot2_nazwisko
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2" - nazwisko
::   WY: nazwisko
::----------------------------------------------------------------------------------------------------------------------
_nazw:=exec('podmiot_im_naz','edi_fo_ksef',FAKS.KH);
_nazw


\podmiot3_os_fiz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot3" - czy jest osobą fizyczną
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_osfiz:=0;
{? __P3.KH<>null()
|| _osfiz:=exec('podmiot_os_fiz','edi_fo_ksef',__P3.KH)
?};
_osfiz


\podmiot3_im_naz_jest
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot3" - czy jest imię i nazwisko
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_wyn:=exec('podmiot3_imie','edi_fo_ksef')<>'' & exec('podmiot3_nazwisko','edi_fo_ksef')<>'';
_wyn


\podmiot3_imie
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot3" - imię
::   WY: imię
::----------------------------------------------------------------------------------------------------------------------
_imie:=exec('podmiot_im_naz','edi_fo_ksef',__P3.KH,'I');
_imie


\podmiot3_nazwisko
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot3" - nazwisko
::   WY: nazwisko
::----------------------------------------------------------------------------------------------------------------------
_nazw:=exec('podmiot_im_naz','edi_fo_ksef',__P3.KH);
_nazw


\podmiot2k_os_fiz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2K" - czy jest osobą fizyczną
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_osfiz:=exec('podmiot_os_fiz','edi_fo_ksef',__P2K.KH);
_osfiz


\podmiot2k_im_naz_jest
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "PodmiotUpowazniony" - czy jest imię i nazwisko
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_wyn:=exec('podmiot2k_imie','edi_fo_ksef')<>'' & exec('podmiot2k_nazwisko','edi_fo_ksef')<>'';
_wyn


\podmiot2k_imie
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2K" - imię
::   WY: imię
::----------------------------------------------------------------------------------------------------------------------
_imie:=exec('podmiot_im_naz','edi_fo_ksef',__P2K.KH,'I');
_imie


\podmiot2k_nazwisko
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "Podmiot2K" - nazwisko
::   WY: nazwisko
::----------------------------------------------------------------------------------------------------------------------
_nazw:=exec('podmiot_im_naz','edi_fo_ksef',__P2K.KH);
_nazw


\podmiotU_os_fiz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "PodmiotUpowazniony" - czy jest osobą fizyczną
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_osfiz:=exec('podmiot_os_fiz','edi_fo_ksef',__PU.KH);
_osfiz


\podmiotU_im_naz_jest
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "PodmiotUpowazniony" - czy jest imię i nazwisko
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_wyn:=exec('podmiotU_imie','edi_fo_ksef')<>'' & exec('podmiotU_nazwisko','edi_fo_ksef')<>'';
_wyn


\podmiotU_imie
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "PodmiotUpowazniony" - imię
::   WY: imię
::----------------------------------------------------------------------------------------------------------------------
_imie:=exec('podmiot_im_naz','edi_fo_ksef',__PU.KH,'I');
_imie


\podmiotU_nazwisko
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: "PodmiotUpowazniony" - nazwisko
::   WY: nazwisko
::----------------------------------------------------------------------------------------------------------------------
_nazw:=exec('podmiot_im_naz','edi_fo_ksef',__PU.KH);
_nazw


\ef_prvat
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Wyliczenie P_12_Procedura
::   WE: _a - 1 - dla dokumentu korygowanego, 0 - zwyczajnie (domyślnie)
::   WY: P_12_Procedura
::----------------------------------------------------------------------------------------------------------------------
_jak:=0;
{? var_pres('_a')=type_of(0)
|| _jak:=_a
?};
_proc:='';
{? _jak=1
|| _proc:=FKOR.EF_PRVAT().KOD
|| {? FAKS.PROC=null() | FAKS.KRAJ_VAT().KODISO='' | FAKS.KRAJ_VAT().KODISO='PL'
   || _proc:=FAP.EF_PRVAT().KOD
   ?}
?};
_proc


\ef_proc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Wyliczenie Procedura
::   WE: _a - 1 - dla dokumentu korygowanego, 0 - zwyczajnie (domyślnie)
::   WY: Procedura
::----------------------------------------------------------------------------------------------------------------------
_jak:=0;
{? var_pres('_a')=type_of(0)
|| _jak:=_a
?};
_proc:='';
{? _jak=1
|| _proc:=FKOR.EF_PROC().KOD
|| {? FAKS.PROC=null()
   || _proc:=FAP.EF_PROC().KOD
   || _proc:=FAKS.PROC().KOD
   ?}
?};
_proc


\platczesc_czy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [22.26]
:: OPIS: Czy wypełniać pozycję "PlatnosciCzesciowe" (nieużywane)
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_czy:=0;
_rodz:=exec('RodzajFaktury','edi_fo_ksef');
{? (_rodz='ROZ' | _rodz='VAT') & FAKS.KW_ZAL<>0
|| _czy:=1
?};
_czy


\p9AZ
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [22.26]
:: OPIS: Cena jednostkowa netto dla dokumentów zaliczkowych
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__vk')=type_of(0)
||
:: korekta
   _il:={? __vk=2 || FKOR.BIL |? FAP.POZP || 0 || FKOR.IL ?};
   _wn:={? __vk=2 || FKOR.BWWAL |? FAP.POZP || 0 || FKOR.WWAL ?};
   _cn:=
      {? _il=0 | _wn=0
      || {? __vk=2
         || _il:=FKOR.IL;
            _wn:=FKOR.WWAL;
            {? _il=0 | _wn=0 || exec('CNWal_PoKor','edi_fo_ufd') || (_wn/_il)$2 ?}
         |? FAP.POZP
         || 0
         || exec('CNWal_PrzedKor','edi_fo_ufd')
         ?}
      || (_wn/_il)$2
      ?}
||
:: faktura
   _il:=FAP.IL;
   _wn:=FAP.WWAL;
   _cn:={? _il=0 | _wn=0 || exec('CNWal','edi_fo_ufd') || (_wn/_il)$2 ?}
?};
form(_cn,,2,'9.')


\KursWaluty_Poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Kurs waluty dla pozycji
::   WY: kurs
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__vk')=type_of(0)
||
:: korekta
   {? __vk=2
   || _krs:=FAP.KRS
   || _krs:=FKOR.KRS
   ?}
||
:: faktura
   _krs:=FAP.KRS
?};
_krs


\rola_cz_grvat_wyst
::----------------------------------------------------------------------------------------------------------------------
::  UTW:IFZ [23.25]
:: OPIS: Członek grupy VAT - wystawca
::----------------------------------------------------------------------------------------------------------------------
'Członek grupy VAT - wystawca'


\rola_jst_wyst
::----------------------------------------------------------------------------------------------------------------------
::  UTW: IFZ [23.25]
:: OPIS: Jednostka samorządu terytorialnego - wystawca
::----------------------------------------------------------------------------------------------------------------------
'Jednostka samorządu terytorialnego - wystawca'


\rola_cz_grvat_odb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: IFZ [23.25]
:: OPIS: Członek grupy VAT - odbiorca
::----------------------------------------------------------------------------------------------------------------------
'Członek grupy VAT - odbiorca'


\rola_jst_odb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: IFZ [23.25]
:: OPIS: Jednostka samorządu terytorialnego - odbiorca
::----------------------------------------------------------------------------------------------------------------------
'Jednostka samorządu terytorialnego - odbiorca'


\rola_wyst
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [RR.xx]
:: OPIS: Wystawca faktury
::----------------------------------------------------------------------------------------------------------------------
'Wystawca faktury'


\rola_pomin_lsp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Czy dana rola podmiotu ma być pomijana w pliku KSeF i na wydruku
::   WE: _a - rola
::       [_b] - format KSeF [1]/2
::   WY: 0 / 1
::----------------------------------------------------------------------------------------------------------------------
_ksef_jak:={? var_pres('_b')=type_of(0) || _b || 1 ?};
{? _ksef_jak<>1 & _ksef_jak<>2
|| _ksef_jak:=1
?};
_wyn:=0;
{? (_a=exec('rola_grupa_vat','edi_fo_ksef') & _ksef_jak=2) | _a=exec('rola_cz_grvat_odb','edi_fo_ksef')
   | _a=exec('rola_jst_odb','edi_fo_ksef')
|| _wyn:=1
?};
_wyn


\systemInfo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: JK [23.25]
:: OPIS: Zwraca informację wyświetlane w polu SystemInfo
::----------------------------------------------------------------------------------------------------------------------
'Macrologic Merit by Asseco (https://assecobs.pl/macrologic/)'

:Sign Version 2.0 jowisz:1045 2024/01/29 14:27:18 8cfd4cac443a3f5a1fcd8fcbaf57171dffbeea849240edb2907a9cc7b5f82a58a98be3fbaf282c5e212bfdf65ccbcce530c57a43fcaf3cb80d19185c78be20998fcfd193a361bf8374d45861021eacd1afb402eb7ef1ee3c532c75c99b60e4a2fcf040db5579cfadb0779024e630d3ccf9e52e3a3202a001575ea9173432ce3e
