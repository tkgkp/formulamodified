:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: ltr.fml
:: Utworzony: 21.01.2019
:: Autor: MW
:: Systemy:
::======================================================================================================================
:: Zawartość: Formuły oraz wywoływacze obszaru LTR
::======================================================================================================================


\init
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: inicjuje obszar LTR
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{?  ST.AR<=0 | ST.AM<=0
|| return
?};

:: Podczytanie INFO.KRAJ - kraj waluty opodatkowania
exec('czytaj','#stalesys',,INFO,FINFO);
exec('czytaj','#stalesys',,XINFO,'SLWYDZIA','SLJEZYK','SLWAL','TER_AKT','TER_KNT');
exec('czytaj','#stalesys',,KST,'BDO');

:: Podczytanie parametrów oddziału
KSTE.prefix();
KSTE.first();

:: RB - objekt obsługujący rachunki bankowe
exec('RB','object');

:: Ustawienie prezycji pól w oknach
exec('fld_prec','win_ust');

exec('param_ustaw','ltr');

exec('trig_log','transport_wspolne');

:: format dla reklamacji
exec('f_DISP_EDIT','reklamacje');

~~


\param_ustaw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Ustawienie parametrów w zmiennej KARTDROG
::----------------------------------------------------------------------------------------------------------------------
KARTDROG.ODDZ:=ST.ODDZ;
KARTDROG.OKR:=ST.OKR;
KARTDROG.AR:=ST.AR;
KARTDROG.AM:=ST.AM;
KARTDROG.DOD_AUTO:=exec('get','#params',700801,2);
KARTDROG.PAL_AUTO:=exec('get','#params',700802,2);
KARTDROG.PRA_AUTO:=exec('get','#params',700803,2);
KARTDROG.TRA_AUTO:=exec('get','#params',700804,2);
KARTDROG.KOS_AUTO:=exec('get','#params',700805,2);
KARTDROG.ODP_AUTO:=exec('get','#params',700807,2);
KARTDROG.U_WSPZ:=exec('get','#params',700806,2);
KARTDROG.WYBKART:='M';
KARTDROG.WYB_STAT:='W';
KARTDROG.KARTY_OD:=date(KARTDROG.AR,KARTDROG.AM,1);
KARTDROG.KARTY_DO:=date(KARTDROG.AR,KARTDROG.AM,0);
~~


\parses
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Ustawienie parametrów sesji w obszarze roboczym dziedziny LTR
::  TAG: <MBUILDER>
::----------------------------------------------------------------------------------------------------------------------
__PARSES.editDom('LTR');

AreaTitle.setTitle();

~~


\ltr_kar_param_proc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Zmiana parametrów pracy obszaru LTR_KAR
::----------------------------------------------------------------------------------------------------------------------
_okr_ref:=ST.OKR_REF;
{? __PARSES.editDom('LTR')
|| {? _okr_ref<>ST.OKR_REF
   || exec('init','ltr');
      exec('refresh_ltrkar_reje','ltr')
   ?};
   AreaTitle.setTitle()
?}


\ltr_kar
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Uruchamia obszar roboczy LTR_KAR
::----------------------------------------------------------------------------------------------------------------------
{?  ST.AR<=0 | ST.AM<=0
|| __PARSES.editDom('LTR');
   {? ST.AR<=0 | ST.AM<=0
   || return(0)
   ?}
?};

exec('init','ltr');

_p_kar:=(exec('chk_role','#b__box',OPERATOR.USER,'LTR_KAR_PKAR')
        | exec('chk_role','#b__box',OPERATOR.USER,'LTR_KAR_DKAR')
        | exec('chk_role','#b__box',OPERATOR.USER,'LTR_KAR_AKAR'));
{? ~_p_kar
|| FUN.info('Brak uprawnień do przeglądania kart drogowych.'@);
   return(0)
?};

exec('rodzaje_paliw','zasoby_wspolne');
RODZPAL.win_sel('WER1');
RODZPAL.win_dict('WER1');

exec('year_przygotuj','ltr');
exec('year_pojazd_przygotuj','ltr');
exec('driver_cart_przygotuj','ltr');

_win_grp:=SAMK.grp_make(,,'kartydrog_grp',,,"exec('exit','zws',_a)");

:: Rejestracja kart drogowych
_fb:="exec('before_ltrkar_reje','ltr')";
_fa:="exec('after_ltrkar_reje','ltr')";
_fr:="exec('refresh_ltrkar_reje','ltr')";
SAMK.grp_sel(_win_grp,POJAZDY,'WER_K','Rejestracja kart drogowych'@,_fr,,,,_fb,_fa,,,'maximized');
SAMK.tab_splt(_win_grp,,'vertical','karty1',',33%');
_fr:="grp_edisp(SAMK,'INFO')";
SAMK.grp_sel(_win_grp,SAMK,'WER',,_fr,,,,,,,,'maximized');
SAMK.tab_splt(_win_grp,'karty1','horizontal','paliwo1',20);
SAMK.grp_edit(_win_grp,SAMK,'INFO',,,,,,'maximized_with_title');

:: Przegląd kart drogowych - okres
_fb:="exec('before_ltrkar_okr','ltr')";
_fa:="exec('after_ltrkar_okr','ltr')";
_fr:="exec('refresh_ltrkar_okr','ltr')";
SAMK.grp_sel(_win_grp,__YEAR,__WIN_YEAR,'Przegląd kart drogowych - okres'@,_fr,,,,_fb,_fa,,,'maximized');
SAMK.tab_splt(_win_grp,,'vertical','karty2',',25%');
SAMK.grp_sel(_win_grp,SAMK,'PWER');

:: Przegląd kart drogowych - pojazd + okres
_fb:="exec('before_ltrkar_poj','ltr')";
_fa:="exec('after_ltrkar_poj','ltr')";
_fr:="exec('refresh_ltrkar_poj','ltr')";
SAMK.grp_sel(_win_grp,__YEAR_POJAZD,__WIN_YEAR_POJAZD,'Przegląd kart drogowych - pojazd, okres'@,
             _fr,,,,_fb,_fa,,,'maximized');
SAMK.tab_splt(_win_grp,,'vertical','karty3',',25%');
SAMK.grp_sel(_win_grp,SAMK,'PWER');

:: Przegląd kart drogowych - kierowca
_fb:="exec('before_ltrkar_kier','ltr')";
_fa:="exec('after_ltrkar_kier','ltr')";
_fr:="exec('refresh_ltrkar_kier','ltr')";
SAMK.grp_sel(_win_grp,__DRIVER,__WIN_DRIVER,'Przegląd kart drogowych - kierowcy'@,
             _fr,,,,_fb,_fa,,,'maximized');
SAMK.tab_splt(_win_grp,,'vertical','karty4',',25%');
SAMK.grp_sel(_win_grp,__CART,__WIN_CART);

SAMK.win_fml('WER',,'SYM',,'ICON_BEFORE',exec('samk_sym_ib','karty_drog'));
SAMK.win_fml('PWER',,'SYM',,'ICON_BEFORE',exec('samk_sym_ib','karty_drog'));
__CART.win_fml(__WIN_CART,,'NR',,'ICON_BEFORE',exec('ltrkar_kier_ib','ltr'));

AreaTitle.setTabWin(SAMK,~~);
AreaTitle.setTitle();
POJAZDY.f_clear();
POJAZDY.index('FIRAKTNR');
POJAZDY.prefix(REF.FIRMA);
{? ~POJAZDY.find_key('T')
|| POJAZDY.first()
?};
VAR_DEL.delete('__POJAZD_REF');
__POJAZD_REF:=POJAZDY.ref();
SAMK.win_sel(_win_grp);
SAMK.select();
~~


\before_ltrkar_reje
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Rejestracja kart drogowych
::----------------------------------------------------------------------------------------------------------------------
exec('param_ustaw','ltr');
POJAZDY.f_clear();
POJAZDY.index('FIRAKTNR');
POJAZDY.prefix(REF.FIRMA);
POJAZDY.win_edit('RED');
{? var_pres('__POJAZD_REF')=7 & POJAZDY.ref()<>__POJAZD_REF
|| POJAZDY.seek(__POJAZD_REF)
?};
~~


\after_ltrkar_reje
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Rejestracja kart drogowych
::----------------------------------------------------------------------------------------------------------------------
__POJAZD_REF:=POJAZDY.ref();
{? ~POJAZDY.sel_size() || POJAZDY.f_clear() ?};
{? ~SAMK.sel_size() || SAMK.f_clear() ?};
~~


\refresh_ltrkar_reje
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Rejestracja kart drogowych
::----------------------------------------------------------------------------------------------------------------------
exec('samk_show','karty_drog');
~~


\before_ltrkar_okr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - okres
::----------------------------------------------------------------------------------------------------------------------
exec('param_ustaw','ltr');
exec('year_wypelnij','ltr');
~~


\after_ltrkar_okr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - okres
::----------------------------------------------------------------------------------------------------------------------
~~


\refresh_ltrkar_okr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - okres
::----------------------------------------------------------------------------------------------------------------------
exec('wys_karty','karty_drog');
~~


\before_ltrkar_poj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - pojazd + okres
::----------------------------------------------------------------------------------------------------------------------
exec('param_ustaw','ltr');
exec('year_pojazd_wypelnij','ltr');
~~


\after_ltrkar_poj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - pojazd + okres
::----------------------------------------------------------------------------------------------------------------------
~~


\refresh_ltrkar_poj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - pojazd + okres
::----------------------------------------------------------------------------------------------------------------------
exec('wys_poj_karty','karty_drog');
~~


\before_ltrkar_kier
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - kierowcy
::----------------------------------------------------------------------------------------------------------------------
exec('driver_cart_wypelnij','ltr');
~~


\after_ltrkar_kier
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - kierowcy
::----------------------------------------------------------------------------------------------------------------------
~~


\refresh_ltrkar_kier
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - kierowcy
::----------------------------------------------------------------------------------------------------------------------
exec('wys_cart','karty_drog');
~~


\ltrkar_kier_ib
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Formuła ikony dla SAMK.STATUS
::----------------------------------------------------------------------------------------------------------------------
"{? __CART.Z='T' | __CART.Z='S'
 || exec('zaakceptowany','icon')
 || exec('zarejestrowany','icon')
 ?}
"


\year_przygotuj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - okres
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('__YEAR');
VAR_DEL.delete('__WIN_YEAR');
__YEAR:=tab_tmp(1,'T','TREE_REF','T',
                'YEAR','STRING[20]','Rok'@,
                'MONTH','STRING[4]','Miesiąc'@);

__WIN_YEAR:=__YEAR.mk_sel('Rok/miesiąc'@,'P',,'_year',,,,1);
__YEAR.win_fld(__WIN_YEAR,__YEAR,'YEAR',,,,,,'Rok/miesiąc'@);
__YEAR.win_sel(__WIN_YEAR);
~~


\year_wypelnij
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - okres
::----------------------------------------------------------------------------------------------------------------------
_start:=ST.AR;
_stop:=ST.AR;
SAMK.cntx_psh();
SAMK.index('D2');
SAMK.prefix();
{? SAMK.first()
|| {!
   |? (SAMK.D=date(0,0,0) | SAMK.POJAZD=null()) & SAMK.next()
   !};
   {? SAMK.D>date(0,0,0) & SAMK.POJAZD<>null()
   || _start:=SAMK.D~1;
      SAMK.last();
      _stop:=SAMK.D~1;
      {? _stop<ST.AR
      || _stop:=ST.AR
      ?}
   ?}
?};
SAMK.cntx_pop();

_miesiac:=obj_new(12);
_miesiac[1]:='styczeń';
_miesiac[2]:='luty';
_miesiac[3]:='marzec';
_miesiac[4]:='kwiecień';
_miesiac[5]:='maj';
_miesiac[6]:='czerwiec';
_miesiac[7]:='lipiec';
_miesiac[8]:='sierpień';
_miesiac[9]:='wrzesień';
_miesiac[10]:='październik';
_miesiac[11]:='listopad';
_miesiac[12]:='grudzień';

__YEAR.erase();

{! _i:=_start.._stop |!
   __YEAR.T:=null;
   __YEAR.YEAR:=$_i;
   __YEAR.MONTH:='';
   __YEAR.add();
   _ref:=__YEAR.ref();
   {! _j:=1..12 |!
       __YEAR.T:=_ref;
       __YEAR.YEAR:=form(_j,4)+'. '+_miesiac[_j];
       __YEAR.MONTH:=$_i;
       __YEAR.add()
   !}
!};

__YEAR.last();
{!
|? __YEAR.MONTH<>'' & __YEAR.prev()
!};
~~


\year_pojazd_przygotuj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - pojazd + okres
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('__YEAR_POJAZD');
VAR_DEL.delete('__WIN_YEAR_POJAZD');
__YEAR_POJAZD:=tab_tmp(1,'T','TREE_REF','T',
                       'YEAR','STRING[33]','Rok',
                       'POJAZD','STRING[16]','Ref pojazdu?',
                       'NPOJAZD','STRING[33]','Pojazd',
                       'MONTH','STRING[4]','Miesiąc');

__WIN_YEAR_POJAZD:=__YEAR_POJAZD.mk_sel('Rok/miesiąc'@,'P',,'_year_pojazd',,,,1);
__YEAR_POJAZD.win_fld(__WIN_YEAR_POJAZD,__YEAR_POJAZD,'YEAR',,,,,,'Pojazd/Rok/Miesiąc'@);
__YEAR_POJAZD.win_sel(__WIN_YEAR_POJAZD);
~~


\year_pojazd_wypelnij
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - pojazd + okres
::----------------------------------------------------------------------------------------------------------------------
_start:=ST.AR;
_stop:=ST.AR;
SAMK.cntx_psh();
SAMK.index('D2');
SAMK.prefix();
{? SAMK.first()
|| {!
   |? (SAMK.D=date(0,0,0) | SAMK.POJAZD=null()) & SAMK.next()
   !};
   {? SAMK.D>date(0,0,0) & SAMK.POJAZD<>null()
   || _start:=SAMK.D~1;
      SAMK.last();
      _stop:=SAMK.D~1;
      {? _stop<ST.AR
      || _stop:=ST.AR
      ?}
   ?}
?};
SAMK.cntx_pop();

_miesiac:=obj_new(12);
_miesiac[1]:='styczeń';
_miesiac[2]:='luty';
_miesiac[3]:='marzec';
_miesiac[4]:='kwiecień';
_miesiac[5]:='maj';
_miesiac[6]:='czerwiec';
_miesiac[7]:='lipiec';
_miesiac[8]:='sierpień';
_miesiac[9]:='wrzesień';
_miesiac[10]:='październik';
_miesiac[11]:='listopad';
_miesiac[12]:='grudzień';

__YEAR_POJAZD.erase();

_poj_akt_ref:=null();

POJAZDY.cntx_psh();
POJAZDY.f_clear();
POJAZDY.index('FIRAKTNR');
POJAZDY.prefix(REF.FIRMA);
{? POJAZDY.first()
|| {!
   |? __YEAR_POJAZD.T:=null;
      __YEAR_POJAZD.YEAR:=(20+POJAZDY.NAZ)+' ['+POJAZDY.NRREJ+']';
      __YEAR_POJAZD.NPOJAZD:=(20+POJAZDY.NAZ)+' ['+POJAZDY.NRREJ+']';
      __YEAR_POJAZD.POJAZD:=$(#POJAZDY.ref());
      __YEAR_POJAZD.MONTH:='';
      __YEAR_POJAZD.add();
      _poj:=__YEAR_POJAZD.ref();
      {? _poj_akt_ref=null() & POJAZDY.A='T'
      || _poj_akt_ref:=_poj
      ?};
      {! _i:=_start.._stop
      |! __YEAR_POJAZD.T:=_poj;
         __YEAR_POJAZD.YEAR:=$_i;
         __YEAR_POJAZD.NPOJAZD:=(20+POJAZDY.NAZ)+' ['+POJAZDY.NRREJ+']';
         __YEAR_POJAZD.POJAZD:=$(#POJAZDY.ref());
         __YEAR_POJAZD.MONTH:='';
         __YEAR_POJAZD.add();
         _ref:=__YEAR_POJAZD.ref();
         {! _j:=1..12
         |! __YEAR_POJAZD.T:=_ref;
            __YEAR_POJAZD.YEAR:=form(_j,4)+'. '+_miesiac[_j];
            __YEAR_POJAZD.NPOJAZD:=(20+POJAZDY.NAZ)+' ['+POJAZDY.NRREJ+']';
            __YEAR_POJAZD.POJAZD:=$(#POJAZDY.ref());
            __YEAR_POJAZD.MONTH:=$_i;
            __YEAR_POJAZD.add()
         !}
      !};
      POJAZDY.next()
   !}
?};
POJAZDY.cntx_pop();

{? _poj_akt_ref=null()
|| __YEAR_POJAZD.first()
|| __YEAR_POJAZD.seek(_poj_akt_ref)
?};
~~


\driver_cart_przygotuj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - kierowcy
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('__DRIVER','__CART','__WIN_DRIVER','__WIN_CART','__NDX_DRIVER', '__PARAM_DRIVER');

__PARAM_DRIVER:=obj_new('WYBKART','WYB_STAT','KARTY_OD','KARTY_DO','OKR');
__PARAM_DRIVER.WYBKART:=KARTDROG.WYBKART;
__PARAM_DRIVER.WYB_STAT:=KARTDROG.WYB_STAT;
__PARAM_DRIVER.KARTY_OD:=KARTDROG.KARTY_OD;
__PARAM_DRIVER.KARTY_DO:=KARTDROG.KARTY_DO;
__PARAM_DRIVER.OKR:=KARTDROG.OKR;

__DRIVER:=tab_tmp(1,'REF_OSO','INTEGER','Wskazanie na osobę',
                    'NAZ','STRING[40]','Nazwisko i imię');
__NDX_DRIVER:=__DRIVER.ndx_tmp(,,'REF_OSO',,);
__NDX_DRIVER1:=__DRIVER.ndx_tmp(,,'NAZ',,);
__DRIVER.index(__NDX_DRIVER);

__CART:=tab_tmp(2,'R_DRIVER','INTEGER','Wskazanie na kierowcę',
                  'DATA','DATE','Data wpr. karty',
                  'R_SAMK','INTEGER','Wskazanie na kartę drogową',
                  'NR','STRING[10]','Numer karty',
                  'POJAZD','STRING[40]','Pojazd',
                  'PALIWO','STRING[5]','Paliwo',
                  'PRZEBIEG','REAL','Przebieg',
                  'NORMA','REAL','Wg normy',
                  'RZECZ','REAL','Rzeczywiste',
                  'WYNIK','REAL','Wynik',
                  'PO','STRING[11]','Przepał',
                  'Z','STRING[1]','Zatwierdzona');

__WIN_DRIVER:=__DRIVER.mk_sel('Kierowcy'@,'P',0,'_driver',,,,,'U','T');
__DRIVER.win_fld(__WIN_DRIVER,__DRIVER,'NAZ',,,30,,,'Nazwisko i imię kierowcy'@);
__DRIVER.win_act(__WIN_DRIVER,0,'Formuła','&Zmień zakres'@@,,'Zakres kart drogowych'@,
               "","exec('driver_cart_zmien_zakres','ltr')",0,0,,,'Z');
__DRIVER.win_act(__WIN_DRIVER,1,'Formuła','&Zmień zakres'@@,,'Zakres kart drogowych'@,
               "","exec('driver_cart_zmien_zakres','ltr')",0,0,,,'Z');

__WIN_CART:=__CART.mk_sel('Karty drogowe'@,'P',0,'_cart_w',,,,,'U','T');
__CART.win_fld(__WIN_CART,__CART,'DATA',,,10,,,'Data'@);
__CART.win_fld(__WIN_CART,__CART,'NR',,,10,,,'Numer karty'@);
__CART.win_fld(__WIN_CART,__CART,'POJAZD',,,20,,,'Pojazd'@);
__CART.win_fld(__WIN_CART,__CART,'PALIWO',,,5,,,'Paliwo'@);
__CART.win_fld(__WIN_CART,__CART,'PRZEBIEG',,,10,,,'Przebieg'@);
__CART.win_fld(__WIN_CART,__CART,'NORMA',,,10,,,'Wg normy'@);
__CART.win_fld(__WIN_CART,__CART,'RZECZ',,,10,,,'Rzeczywiste'@);
__CART.win_fld(__WIN_CART,__CART,'WYNIK',,,10,,,'Wynik'@);
__CART.win_fld(__WIN_CART,__CART,'PO',,,11,,,'Przepał/Oszczędność'@);

__CART.win_act(__WIN_CART,0,'Formuła','K&arta'@@,,'Szczegółowe dane karty drogowej'@,
               "","exec('cart_view','karty_drog')",1,0,,,'A');
__CART.win_act(__WIN_CART,0,'Formuła','Pal&iwo'@@,,'Paliwo pobrane do karty drogowej'@,
               "","exec('cart_pal','karty_drog')",0,0,,,'I');
__CART.win_act(__WIN_CART,0,'Formuła','P&racownicy'@@,,'Pracownicy przypisani do karty drogowej'@,
               "","exec('cart_pra','karty_drog')",0,0,,,'R');
__CART.win_act(__WIN_CART,0,'Formuła','D&odatki'@@,,'Dodatki pobrane do karty drogowej'@,
               "","exec('cart_dod','karty_drog')",0,0,,,'O');
__CART.win_act(__WIN_CART,0,'Formuła','&Trasy'@@,,'Trasy przejechane w ramach karty drogowej'@,
               "","exec('cart_tra','karty_drog')",0,0,,,'T');
{? exec('luo_view','odpady')
|| __CART.win_act(__WIN_CART,0,'Formuła','Transporto&wane odpady'@@,,'Transportowane odpady dla karty drogowej'@,
                  "","exec('cart_sambr','karty_drog')",0,0,,,'W')
?};
__CART.win_act(__WIN_CART,0,'Formuła','&Zmień zakres'@@,,'Zakres kart drogowych'@,
               "","exec('driver_cart_zmien_zakres','ltr')",0,0,,,'Z');
__CART.win_act(__WIN_CART,1,'Formuła','&Zmień zakres'@@,,'Zakres kart drogowych'@,
               "","exec('driver_cart_zmien_zakres','ltr')",0,0,,,'Z');
__CART.win_act(__WIN_CART,0,'Kolejność','',,'Kolejność'@,"","",0);
__CART.win_act(__WIN_CART,0,'Formuła','&Legenda'@@,,'Legenda'@,
               "","exec('legenda','color','CART#01')",0);
__CART.win_act(__WIN_CART,0,'Rekord','',,'Formuła na rekord przed',
               "exec('rekprzed','color','CART#01#')","",0);
__CART.win_act(__WIN_CART,0,'Wyświetl','',,'Pokaż',
               "exec('cart_view','karty_drog')","",0);
__CART.win_sel(__WIN_CART);
~~


\driver_cart_wypelnij
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - kierowcy
::----------------------------------------------------------------------------------------------------------------------
{? __PARAM_DRIVER.WYBKART<>'M' & __PARAM_DRIVER.WYBKART<>'Z' & __PARAM_DRIVER.WYBKART<>'W'
|| __PARAM_DRIVER.WYBKART:='M'
?};
{? __PARAM_DRIVER.WYB_STAT<>'W' & __PARAM_DRIVER.WYB_STAT<>'T' & __PARAM_DRIVER.WYB_STAT<>'N'
|| __PARAM_DRIVER.WYB_STAT:='W'
?};

{? __PARAM_DRIVER.WYBKART='M'
|| __PARAM_DRIVER.KARTY_OD:=date(KARTDROG.AR,KARTDROG.AM,1);
   __PARAM_DRIVER.KARTY_DO:=date(KARTDROG.AR,KARTDROG.AM,0)
?};

__DRIVER.erase();
__CART.erase();

__DRIVER.index(__NDX_DRIVER);
__DRIVER.prefix();
__CART.prefix();

P_KAP.index('K');

POJAZDY.cntx_psh();
SAMK.cntx_psh();
SAMK.index('D');
SAMK.prefix();
SAMK.first();
{!
|? {? SAMK.POJAZD<>null()
   || P_KAP.prefix(SAMK.ref(),'T');
      {? P_KAP.first()
      || {!
         |? {? (__PARAM_DRIVER.WYBKART='W' | (SAMK.D>=__PARAM_DRIVER.KARTY_OD & SAMK.D<=__PARAM_DRIVER.KARTY_DO))
               & (__PARAM_DRIVER.WYB_STAT='W' | __PARAM_DRIVER.WYB_STAT=SAMK.STATUS)
            || {? ~__DRIVER.find_key(#P_KAP.OSOBA)
               || __DRIVER.blank();
                  __DRIVER.REF_OSO:=#P_KAP.OSOBA;
                  __DRIVER.NAZ:=P_KAP.OSOBA().NAZWISKO +' '+P_KAP.OSOBA().PIERWSZE;
                  __DRIVER.add()
               ?};
               __CART.blank();
               __CART.R_DRIVER:=__DRIVER.REF_OSO;
               __CART.R_SAMK:=#SAMK.ref();
               __CART.DATA:=SAMK.D;
               __CART.NR:=SAMK.SYM;
               __CART.POJAZD:=SAMK.POJAZD().NAZ;
               __CART.PALIWO:=SAMK.PALIWO;
               __CART.PRZEBIEG:=SAMK.PRZ;
               __CART.NORMA:=SAMK.Z_NORMA;
               __CART.RZECZ:=SAMK.Z_RZECZ;
               __CART.WYNIK:=SAMK.ZU_KART;
               __CART.PO:=SAMK.PO;
               __CART.Z:=SAMK.STATUS;
               __CART.add()
            ?};
            P_KAP.next()
         !}
      ?}
   ?};
   SAMK.next()
!};

__DRIVER.index(__NDX_DRIVER1);
__DRIVER.first();

POJAZDY.cntx_pop();
SAMK.cntx_pop();
~~


\driver_cart_chk_zakres
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - kierowcy
::----------------------------------------------------------------------------------------------------------------------
_wyn:='';
{? KARTDROG.WYBKART='Z' & KARTDROG.KARTY_DO<KARTDROG.KARTY_OD
|| FUN.info('Błędny zakres dat.'@);
   _wyn:='KARTY_DO'
?};
_wyn


\driver_cart_zmien_zakres
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Przegląd kart drogowych - kierowcy
::----------------------------------------------------------------------------------------------------------------------
_par:=obj_new('WYBKART','WYB_STAT','KARTY_OD','KARTY_DO','OKR');
_par.WYBKART:=KARTDROG.WYBKART;
_par.WYB_STAT:=KARTDROG.WYB_STAT;
_par.KARTY_OD:=KARTDROG.KARTY_OD;
_par.KARTY_DO:=KARTDROG.KARTY_DO;
_par.OKR:=KARTDROG.OKR;

KARTDROG.WYBKART:=__PARAM_DRIVER.WYBKART;
KARTDROG.WYB_STAT:=__PARAM_DRIVER.WYB_STAT;
KARTDROG.KARTY_OD:=__PARAM_DRIVER.KARTY_OD;
KARTDROG.KARTY_DO:=__PARAM_DRIVER.KARTY_DO;
KARTDROG.OKR:=__PARAM_DRIVER.OKR;

KARTDROG.win_edit('KARTY');
_wyn:=KARTDROG.edit("exec('driver_cart_chk_zakres','ltr')");

{? _wyn
|| __PARAM_DRIVER.WYBKART:=KARTDROG.WYBKART;
   __PARAM_DRIVER.WYB_STAT:=KARTDROG.WYB_STAT;
   __PARAM_DRIVER.KARTY_OD:=KARTDROG.KARTY_OD;
   __PARAM_DRIVER.KARTY_DO:=KARTDROG.KARTY_DO;
   __PARAM_DRIVER.OKR:=KARTDROG.OKR
?};

KARTDROG.WYBKART:=_par.WYBKART;
KARTDROG.WYB_STAT:=_par.WYB_STAT;
KARTDROG.KARTY_OD:=_par.KARTY_OD;
KARTDROG.KARTY_DO:=_par.KARTY_DO;
KARTDROG.OKR:=_par.OKR;

{? _wyn
|| _drv:=__DRIVER.REF_OSO;
   exec('driver_cart_wypelnij','ltr');
   {? _drv<>null
   || __DRIVER.index(__NDX_DRIVER);
      __DRIVER.find_key(_drv);
      __DRIVER.index(__NDX_DRIVER1)
   ?};
   exec('wys_cart','karty_drog')
?};
~~


\ltr_zle
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MarKus [19.42]
:: OPIS: Uruchamia obszar roboczy LTR_ZLE
::----------------------------------------------------------------------------------------------------------------------
{?  ST.AR<=0 | ST.AM<=0
|| __PARSES.editDom('LTR');
   {? ST.AR<=0 | ST.AM<=0
   || return(0)
   ?}
?};

exec('init','ltr');
:: DRO_TODO_AWI: jakieś środowisko zrobić
VAR_DEL.delete('__TR_WYKON');

_upr:=(exec('chk_role','#b__box',OPERATOR.USER,'LTR_ZLE_PZLE')
     | exec('chk_role','#b__box',OPERATOR.USER,'LTR_ZLE_DZLE'));
_tra:=(exec('chk_role','#b__box',OPERATOR.USER,'LTR_TRA_PZLE')
     | exec('chk_role','#b__box',OPERATOR.USER,'LTR_TRA_DZLE'));
_mag:=(exec('chk_role','#b__box',OPERATOR.USER,'LTR_ZLE_DMAG')
     | exec('chk_role','#b__box',OPERATOR.USER,'LTR_ZLE_PMAG'));
_pck:=exec('isCourier','transport_paczki');

_title_grp:=''@;
TR_Z.ARCHKOD:='____';
TR_Z.ARCHNAZ:='Niezarchiwizowane';

{? _upr | _tra | _mag
||
   _fb:="";
   _win_grp:=TR_NZL.grp_make(_title_grp,_fb,'transzlec_grp',,,"exec('exit','zws',_a)");
   {? _upr
   || _fb:="exec('before_ltr_zle_pzle','ltr')";
      _fa:="exec('after_ltr_zle_pzle','ltr')";
      _fr:="exec('refresh_ltr_zle_pzle','ltr')";
      TR_NZL.grp_sel(_win_grp,,'WER','Dyspozycje transportu'@,_fr,,,16,_fb,_fa,,,'maximized');

::    Okno z pozycjami zleceń transportu

      _fb:="exec('before_ltr_zle_pzlepoz','ltr')";
      _fr:="";
      TR_NZL.tab_splt(_win_grp,,'horizontal','pozioma_1',0);
      TR_NZL.grp_sel(_win_grp, TR_ZL,'POZ',,_fr,,,10,_fb,,,,'maximized_with_title');

      TR_NZL.win_fml('WER',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'))
   ?};

   {? _mag
   ||
:: Dyspozycje załadunku
      TR_NZL.grp_sel(_win_grp,TR_NZL,'MAGALL','Dyspozycje załadunku'@,"exec('pd_TR_NZL','ltr','Z')",,,15
       ,"exec('pr_TR_NZL','ltr','Z')","exec('po_TR_NZL','ltr','Z')",,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,'tab0','horizontal','pozycjeZ');
      TR_NZL.grp_sel(_win_grp,TR_ZL,'MAG',,"exec('pd_TR_ZLM','ltr','Z')",,,6
       ,"exec('pr_TR_ZLM','ltr')",,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,'pozycjeZ','horizontal','pozyZD');
      TR_NZL.grp_sel(_win_grp,TR_ZLM,'WER',,,,,,,,,,'maximized_with_title');

:: Dyspozycje rozładunku
      TR_NZL.grp_sel(_win_grp,TR_NZL,'MAGALL','Dyspozycje rozładunku'@,"exec('pd_TR_NZL','ltr','R')",,,15
       ,"exec('pr_TR_NZL','ltr','R')","exec('po_TR_NZL','ltr','R')",,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,'tab0','horizontal','pozycjeR');
      TR_NZL.grp_sel(_win_grp,TR_ZL,'MAG',,"exec('pd_TR_ZLM','ltr','Z')",,,6
       ,"exec('pr_TR_ZLM','ltr')",,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,'pozycjeR','horizontal','pozyRD');
      TR_NZL.grp_sel(_win_grp,TR_ZLM,'WER',,,,,,,,,,'maximized_with_title');

      TR_NZL.win_sel(_win_grp);

      TR_NZL.win_fml('MAGALL',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
      _formikon:="{? TR_ZL.ILRB>0
                  || 'xwin16.png:61'
                  || ''
                  ?}";
      TR_ZL.win_fml('MAG',,'ILRB',,'ICON_BEFORE',_formikon);
      _formikon:="{? TR_ZL.ILRW>0
                  || 'xwin16.png:83'
                  || ''
                  ?}";
      TR_ZL.win_fml('MAG',,'ILRW',,'ICON_BEFORE',_formikon);
      _formikon:="{? TR_ZL.ILRD>0
                  || 'xwin16.png:16'
                  || ''
                  ?}";
      TR_ZL.win_fml('MAG',,'ILRD',,'ICON_BEFORE',_formikon);
      TR_ZL.fld_fml('ILRB','DISPLAY_FORMAT',"{? TR_ZL.TR_NZL().RODZ='Z' || 'empty=0' || 'empty=1' ?}");
      TR_ZL.fld_fml('ILRW','DISPLAY_FORMAT',"{? TR_ZL.TR_NZL().RODZ='Z' || 'empty=0' || 'empty=1' ?}");
      TR_ZL.fld_fml('ILRD','DISPLAY_FORMAT',"{? TR_ZL.TR_NZL().RODZ='Z' || 'empty=0' || 'empty=1' ?}")
   ?};
   {? _tra
   || _fb:="exec('before_tr_nzlplan','ltr')";
      _fa:="exec('after_tr_nzlplan','ltr')";
      _fr:="exec('refresh_tr_nzlplan','ltr')";
      TR_NZL.grp_sel(_win_grp,TR_NZL,'PLAN','Planowanie transportu'@,_fr,,,15,_fb,_fa,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,,'horizontal','zlecenia');
      _fb:="exec('before_tr_nagplan','ltr')";
      _fa:="exec('after_tr_nagplan','ltr')";
      _fr:="exec('refresh_tr_nagplan','ltr')";
      TR_NZL.grp_sel(_win_grp,TR_NAG,'PLAN',,_fr,,,8,_fb,_fa,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,'zlecenia','vertical','transport','0,33%');
      _fb:="exec('before_tr_trasplan','ltr')";
      _fa:="exec('after_tr_trasplan','ltr')";
      _fr:="exec('refresh_tr_trasplan','ltr')";
      TR_NZL.grp_sel(_win_grp,TR_NZL,'TRASY',,_fr,,,8,_fb,_fa,,,'maximized_with_title');
      _fb:="exec('before_tr_nag','ltr')";
      _fa:="exec('after_tr_nag','ltr')";
      _fr:="exec('refresh_tr_nag','ltr')";
      TR_NZL.grp_sel(_win_grp,TR_NAG,'REAL','Transport'@,_fr,,,8,_fb,_fa,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,,'horizontal','transport');
      _fb:="exec('before_tr_trasplan','ltr')";
      _fa:="exec('after_tr_trasplan','ltr')";
      _fr:="";
      TR_NZL.grp_sel(_win_grp,TR_NZL,'REAL',,_fr,,,8,_fb,_fa,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,,'horizontal','noreal','0, 67%');
      _fb:="exec('before_tr_trasno','ltr')";
      _fa:="exec('after_tr_trasno','ltr')";
      _fr:="";
      TR_NZL.grp_sel(_win_grp,TR_LOG,'REAL',,_fr,,,4,_fb,_fa,,,'maximized_with_title');
      TR_NAG.win_fml('PLAN',,'SYM',,'ICON_BEFORE',exec('tr_nag_sym_ib','transport'));
      TR_NAG.win_fml('REAL',,'SYM',,'ICON_BEFORE',exec('tr_nag_sym_ib','transport'));
      TR_NAG.win_fml('PLAN',,'WYJ_D',,'ICON_BEFORE',exec('tr_nag_wyj_d_ib','transport'));
      TR_NAG.win_fml('REAL',,'WYJ_D',,'ICON_BEFORE',exec('tr_nag_wyj_d_ib','transport'));
      TR_NAG.win_edit(exec('tr_nag_win_edit','transport'));

      TR_NZL.win_fml('TRASY',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
      TR_NZL.win_fml('PLAN',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
      TR_NZL.win_fml('REAL',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
      TR_NZL.win_fml('TRASY',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
      TR_NZL.win_fml('PLAN',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
      TR_NZL.win_fml('WER',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
      TR_NZL.win_fml('TRASY',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
      TR_NZL.win_fml('PLAN',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
      TR_NZL.win_fml('REAL',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
      TR_NZL.dnd_sel('TRASY',,'records.TR_NZL',"exec('dndTR_NZL_trasy','transport')");
      TR_NZL.dnd_sel('PLAN',,'records.TR_NZL',"exec('dndTR_NZL_plan','transport')")
   ?};
   {? _pck
   || _fb:="exec('before_tr_pack','ltr')";
      _fa:="exec('after_tr_pack','ltr')";
      _fr:="exec('refresh_tr_pack','ltr')";
      TR_NZL.grp_sel(_win_grp,TR_PACK,'WERALL','Przesyłki kurierskie'@,_fr,,,12,_fb,_fa,,,'maximized_with_title','PCK');
      TR_NZL.tab_splt(_win_grp,,'horizontal','przesylki');
      _fb:="exec('before_tr_hpack','transport_paczki')";
      _fa:="exec('after_tr_hpack','transport_paczki')";
      _fr:="exec('refresh_tr_hpack','transport_paczki')";
      TR_NZL.grp_sel(_win_grp,TR_HPACK,'WER',,_fr,,,8,_fb,_fa,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,'przesylki','vertical','pozycje','0,33%');
      _fb:="exec('before_tr_zpack','transport_paczki')";
      _fa:="exec('after_tr_zpack','transport_paczki')";
      _fr:="exec('refresh_tr_zpack','transport_paczki')";
      TR_NZL.grp_sel(_win_grp,TR_ZPACK,'WER',,_fr,,,8,_fb,_fa,,,'maximized_with_title');
      TR_PACK.win_fml('WERALL',TR_Z,'STROZ',,'ICON_BEFORE',exec('tr_z_stroz_ib','transport_paczki'))
   ?};
   {? _tra
   || __TR_WYKON:=exec('use_sel','transport_moc');
      _fb:="exec('before_tr_moc','ltr',__TR_WYKON)";
      _fa:="";
      _fr:="exec('refresh_tr_moc','ltr',__TR_WYKON)";
      TR_NZL.grp_sel(_win_grp,TR_MOC,'WER','Moce'@,_fr,,,10,_fb,_fa,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,,'horizontal','tr_moc_zl1',16);
      _fb:="exec('before_tr_zlec','ltr',__TR_WYKON)";
      _fa:="exec('after_tr_zlec','ltr',__TR_WYKON)";
      _fr:="";
      TR_NZL.grp_sel(_win_grp,__TR_WYKON.TAB,__TR_WYKON.WER_Z,,_fr,,,,_fb,_fa,,,'maximized_with_title');
      TR_NZL.tab_splt(_win_grp,'tr_moc_zl1','horizontal','tr_moc_zl2',10);
      _fb:="exec('before_tr_wykon','ltr',__TR_WYKON)";
      _fa:="exec('after_tr_wykon','ltr',__TR_WYKON)";
      _fr:="";
      TR_NZL.grp_sel(_win_grp,__TR_WYKON.TAB,__TR_WYKON.WER_W,,_fr,,,,_fb,_fa,,,'maximized_with_title');
      task_attach('LTR_MOC_DMOC');
      task_attach('LTR_MOC_PMOC')
   ?};
   TR_NZL.win_sel(_win_grp);
   AreaTitle.setTabWin(TR_NZL,~~);
   AreaTitle.setTitle();

   exec('zakr_dysp_get','transport_zlec');
   TR_NZL.select()

|| FUN.info('Brak uprawnień do przeglądania zleceń transportowych lub transportów.'@);
   return(0)
?};
VAR_DEL.delete('__TR_WYKON');
~~


\before_ltr_zle_pzle
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MarKus [19.42]
:: OPIS: Przegląd zleceń transportowych
::----------------------------------------------------------------------------------------------------------------------
{? TR_NAG.name()+4<>'____'
|| exec('opentr','open_tab','____')
?};
exec('zakr_dysp_ustaw','transport_zlec');
{? TR_NZL.size() & TR_Z.MUID<>'' || TR_NZL.seek(TR_Z.MUID) ?};
exec('refresh_ltr_zle_pzle','ltr');
~~


\after_ltr_zle_pzle
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MarKus [19.42]
:: OPIS: Przegląd zleceń transportowych
::----------------------------------------------------------------------------------------------------------------------
{? TR_Z.name()+4='____'
|| TR_Z.NZL_PL:={? TR_NZL.sel_size() | {? TR_NZL.f_active() || TR_NZL.f_size() || TR_NZL.size() ?}
                || $TR_NZL.ref()
                || ''
                ?}
?};
TR_Z.DUID:=TR_NZL.uidref();
TR_Z.MUID:='';
::TR_NZL.cntx_pop();
~~


\refresh_ltr_zle_pzle
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MarKus [19.42]
:: OPIS: Przegląd zleceń transportowych
::----------------------------------------------------------------------------------------------------------------------
exec('pozycja_menu_dolacz','transport_zlec');
no_msg(1); errno();
_size:=TR_NZL.sel_size() | {? TR_NZL.f_active() || TR_NZL.f_size() || TR_NZL.size() ?};
_err:=errno(); no_msg(0);
TR_ZL.index('POZ');
TR_ZL.prefix({? _size || TR_NZL.ref() || null() ?});
{? ~_size || exec('rekord_poz','transport_wspolne') ?};
grp_disp(TR_ZL,'POZ');
~~


\before_ltr_zle_pzlepoz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MarKus [19.42]
:: OPIS: Przegląd zleceń transportowych
::----------------------------------------------------------------------------------------------------------------------
exec('pozycja_menu_dolacz','transport_zlec');
~~


\after_tr_nag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\refresh_tr_nag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
_mob:={? var_pres('_a')=type_of(1) || _a || 0 ?};
_tr_nag:=TR_NAG.ref();
TR_NZL.cntx_psh();
{? _tr_nag<>null()
|| TR_NZL.index('TR_NAG');
   TR_NZL.prefix(TR_NAG.ref(),'no')
|| TR_NZL.index('ODDZ');
   TR_NZL.prefix('X')
?};
{? TR_Z.NZL_RE<>'' & ref_name(TR_Z.NZL_RE)=TR_NZL.name()
|| TR_NZL.seek(TR_Z.NZL_RE)
?};
grp_disp(TR_NZL,'REAL',,1);
TR_NZL.cntx_pop();
_tr_uid:=TR_NAG.uidref();
TR_LOG.cntx_psh();
{? _tr_uid<>''
|| TR_LOG.index('NO_REAL');
   TR_LOG.prefix(_tr_uid,'T')
|| TR_LOG.index('NO_REAL');
   TR_LOG.prefix('xxx','x')
?};
grp_disp(TR_LOG,'REAL',,1);
TR_LOG.cntx_pop();
~~


\before_tr_nag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::   WE: [_a] 0/1 tryb mobilny
::----------------------------------------------------------------------------------------------------------------------
_mob:={? var_pres('_a')=type_of(1) || _a || 0 ?};

{? TR_Z.ARCHKOD<>(TR_PACK.name()+4) || exec('opentr','open_tab',TR_Z.ARCHKOD) ?};
_wer:=cur_win(1,1);
_act_hid:={? (TR_NAG.name()+4)<>'____' || 'DPUZEN(OCRKH):DE' || '' ?};
_act_dom:={? (TR_NAG.name()+4)<>'____' || 'R:R' || 'P:D' ?};
TR_NAG.actions(_wer,_act_hid,_act_dom,1);
{? _mob
||
   USERS.cntx_psh();
   TR_NAG.index('K_SYM');
   TR_NAG.prefix(OPERATOR.USER().OSOBA);
   USERS.cntx_pop()
||
   TR_NAG.index('SYM');
   TR_NAG.prefix()
?};
~~


\refresh_tr_trasa
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\after_tr_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\refresh_tr_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\before_tr_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\ltr_zle_param_proc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Zmiana parametrów pracy obszaru LTR_ZLE
::----------------------------------------------------------------------------------------------------------------------
_okr_ref:=ST.OKR_REF;
{? __PARSES.editDom('LTR')
|| {? _okr_ref<>ST.OKR_REF
   || exec('init','ltr');
      exec('refresh_ltr_zle_pzle','ltr')
   ?};
   AreaTitle.setTitle()
?}


\param_tr_rodz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MarKus [19.42]
:: OPIS: Parametry transportu - kategoria transportu
::----------------------------------------------------------------------------------------------------------------------
TR_RODZ.win_edit('RED');
TR_RODZ.win_sel('WER');
TR_RODZ.select()


\param_tr_rodz_record
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MarKus [19.42]
:: OPIS: Parametry transportu - kategoria transportu
::----------------------------------------------------------------------------------------------------------------------
_wyn:=chk_rec('KOD','NAZ');
_wyn


\before_tr_nzlplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
{? TR_NAG.name()+4<>'____'
|| exec('opentr','open_tab','____')
?};
TR_NZL.cntx_psh();
grp_disp(TR_NAG,'PLAN',,1);
{? TR_Z.DUID='' & TR_Z.MUID<>'' & TR_NZL.seek(TR_Z.MUID)
|| ''
|? TR_Z.NZL_TR<>'' & ref_name(TR_Z.NZL_TR)=TR_NZL.name()
|| TR_NZL.seek(TR_Z.NZL_TR)
?};
grp_disp(TR_NZL,'TRASY',,1);
TR_NZL.index('PLAN');
TR_NZL.prefix('T','no');
{? TR_Z.DUID='' & TR_Z.MUID<>'' & TR_NZL.seek(TR_Z.MUID)
|| ''
|? TR_Z.NZL_PL<>'' & ref_name(TR_Z.NZL_PL)=TR_NZL.name()
|| TR_NZL.seek(TR_Z.NZL_PL)
?};
~~


\after_tr_nzlplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
{? TR_Z.name()+4='____'
|| TR_Z.NZL_PL:={? TR_NZL.sel_size() | {? TR_NZL.f_active() || TR_NZL.f_size() || TR_NZL.size() ?}
                || $TR_NZL.ref()
                || ''
                ?}
?};
TR_Z.DUID:={? (';ZK_N;ZD_NAG;ZDP_NAG;'*TR_NZL.WHERE)>1 || TR_NZL.uidref() || '' ?};
TR_Z.MUID:={? (';ZK_N;ZD_NAG;ZDP_NAG;'*TR_NZL.WHERE)>1 || TR_NZL.uidref() || '' ?};
TR_NZL.cntx_pop();
~~


\refresh_tr_nzlplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\before_tr_nagplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
TR_NAG.index('NR');
TR_NAG.prefix('N');
~~


\after_tr_nagplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\refresh_tr_nagplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
_tr_nag:=TR_NAG.ref();
_par:=exec('get','#params',700811,2)='T';
TR_NZL.cntx_psh();
TR_NZL.actions('TRASY','R','P');
{? _tr_nag<>null()
|| {? _par || TR_NZL.index('TR_NAG2'); TR_NZL.prefix(_tr_nag) || TR_NZL.index('TR_NAG'); TR_NZL.prefix(_tr_nag,'no') ?}
|| TR_NZL.index('PLAN');
   TR_NZL.prefix('X')
?};
{? TR_Z.NZL_TR<>'' & ref_name(TR_Z.NZL_TR)=TR_NZL.name()
|| TR_NZL.seek(TR_Z.NZL_TR)
|| TR_NZL.first()
?};
grp_disp(TR_NZL,'TRASY',,1);
TR_NZL.cntx_pop();
~~


\before_tr_trasplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
_mob:=(var_pres('_a')=type_of('') & (_a='T' | _a='N'));
_tr_nag:={? TR_NAG.size() || TR_NAG.ref() || null() ?};
_par:=exec('get','#params',700811,2)='T';
TR_NZL.cntx_psh();
{? _tr_nag<>null()
|| {? _mob
   || {? _par
      || TR_NZL.index('TR_NAG4'); TR_NZL.prefix(_tr_nag,_a,)
      || TR_NZL.index('TR_NAG3'); TR_NZL.prefix(_tr_nag,_a,'no')
      ?}
   |? _par
   || TR_NZL.index('TR_NAG2'); TR_NZL.prefix(_tr_nag)
   || TR_NZL.index('TR_NAG'); TR_NZL.prefix(_tr_nag,'no')
   ?};
   {? TR_Z.NZL_TR<>'' & ref_name(TR_Z.NZL_TR)=TR_NZL.name()
   || TR_NZL.seek(TR_Z.NZL_TR)
   ?}
::   {? TR_NZL.TR_NAG().STAT_REJ='N'
::   || TR_NZL.dnd_sel('REAL',,'records.TR_NZL',"exec('dndTR_NZL_trasy','transport')")
::   || TR_NZL.dnd_sel('REAL',,'records.TR_NZL',"")
::   ?}
|| TR_NZL.index('PLAN');
   TR_NZL.prefix('X')
?};
~~


\after_tr_trasno
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
TR_LOG.cntx_pop();
~~


\before_tr_trasno
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
_tr_nag:={? TR_NAG.size() || TR_NAG.uidref() || 'xxx' ?};
TR_LOG.cntx_psh();
TR_LOG.index('NO_REAL');
TR_LOG.prefix(_tr_nag,'T');
~~


\after_tr_trasplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
{? TR_NZL.name()+4='____'
|| TR_Z.NZL_TR:={? TR_NZL.sel_size() | {? TR_NZL.f_active() || TR_NZL.f_size() || TR_NZL.size() ?}
                || $TR_NZL.ref()
                || ''
                ?}
?};
TR_NZL.cntx_pop();
~~


\refresh_tr_trasplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\before_tr_pozplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\after_tr_pozplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\refresh_tr_pozplan
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Przegląd i rejestracja transportu
::----------------------------------------------------------------------------------------------------------------------
~~


\before_tr_moc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [MW] [19.42]
:: OPIS: Przegląd i rejestracja transportu - zakładka "Moce"
::----------------------------------------------------------------------------------------------------------------------
{? TR_NAG.name()+4<>'____'
|| exec('opentr','open_tab','____')
?};
_Tab:=_a.TAB;
_wer_z:=_a.WER_Z;
_wer_w:=_a.WER_W;
TR_MOC.index('OTR_RODZ');
TR_MOC.prefix();
TR_MOC.win_edit('RED');

exec('use_tab_erase','transport_moc',_Tab);
grp_disp(_Tab,_wer_z);
grp_disp(_Tab,_wer_w);
~~


\refresh_tr_moc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [MW] [19.42]
:: OPIS: Przegląd i rejestracja transportu - zakładka "Moce"
::----------------------------------------------------------------------------------------------------------------------
_Tab:=_a.TAB;
_wer_z:=_a.WER_Z;
_wer_w:=_a.WER_W;
{? {? ~TR_MOC.sel_size() & TR_MOC.f_active() || TR_MOC.f_get() || TR_MOC.get() ?}
||
   exec('use_tab_refresh','transport_moc',_Tab)
||
   exec('use_tab_erase','transport_moc',_Tab)
?};
grp_disp(_Tab,_wer_z);
grp_disp(_Tab,_wer_w);
~~


\before_tr_zlec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [MW] [19.42]
:: OPIS: Przegląd i rejestracja transportu - zakładka "Moce" / Zlecony transport
::----------------------------------------------------------------------------------------------------------------------
_Tab:=_a.TAB;
_Tab.cntx_psh();
_Tab.prefix('Z');
~~


\after_tr_zlec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [MW] [19.42]
:: OPIS: Przegląd i rejestracja transportu - zakładka "Moce" / Zlecony transport
::----------------------------------------------------------------------------------------------------------------------
_Tab:=_a.TAB;
_Tab.cntx_pop();
~~


\before_tr_wykon
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [MW] [19.42]
:: OPIS: Przegląd i rejestracja transportu - zakładka "Moce" / Wykonany transport
::----------------------------------------------------------------------------------------------------------------------
_Tab:=_a.TAB;
_Tab.cntx_psh();
_Tab.prefix('W');
~~


\after_tr_wykon
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [MW] [19.42]
:: OPIS: Przegląd i rejestracja transportu - zakładka "Moce" / Wykonany transport
::----------------------------------------------------------------------------------------------------------------------
_Tab:=_a.TAB;
_Tab.cntx_pop();
~~


\tr_moc_b_usun
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [MW] [19.42]
:: OPIS: Przegląd i rejestracja transportu - zakładka "Moce" - sprawdzenie, czy można usunąć
::----------------------------------------------------------------------------------------------------------------------
_wyn:=1;
{? TR_MOC.count()>0
|| _wyn:=0;
   FUN.info('Tej pozycji nie można usunąć. Istnieją powiązanie zlecenia.'@)
|| _wyn:=exec('tr_rodz_del','transport_wspolne',TR_MOC.TR_RODZ,'Moc transportowa'@)
?};
_wyn


\ltr_tra_param_proc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: Zmiana parametrów pracy obszaru LTR_ZLE
::----------------------------------------------------------------------------------------------------------------------
_okr_ref:=ST.OKR_REF;
{? __PARSES.editDom('LTR')
|| {? _okr_ref<>ST.OKR_REF
   || exec('init','ltr');
      {? AreaTitle.area<>'LTR_MOB'
      || exec('refresh_ltr_zle_pzle','ltr')
      ?}
   ?};
   AreaTitle.setTitle()
?}


\pr_TR_NZL
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.14]
:: OPIS: przed dla dyspozycji w magazynie
::   WE: _a - 'Z'-załadunek (domyślnie) 'R'-rozładunek
::----------------------------------------------------------------------------------------------------------------------
{? TR_NAG.name()+4<>'____'
|| exec('opentr','open_tab','____')
?};
::TR_NZL.cntx_psh();
_rodz:={? var_pres('_a')=type_of('') & (';ZR'*_a)>1 || _a || 'Z' ?};

TR_NZL.index('MGRODZ');
TR_NZL.prefix('TR_NZL',_rodz,ST.ODDZ);
{? TR_NZL.size() & TR_Z.DUID<>''
|| _trnzl:=exec('FindInSet','#table','TR_NZL','DOK_REF',TR_Z.DUID);
   {? _trnzl<>null() || TR_NZL.seek(_trnzl) ?}
?};
exec('pd_TR_NZL','ltr',_rodz);
~~


\po_TR_NZL
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.14]
:: OPIS: po dla dyspozycji w magazynie
::   WE: _a - 'Z'-załadunek (domyślnie) 'R'-rozładunek
::----------------------------------------------------------------------------------------------------------------------
_rodz:={? var_pres('_a')=type_of('') & (';ZR'*_a)>1 || _a || 'Z' ?};
{? TR_Z.name()+4='____'
|| TR_Z.NZL_PL:={? TR_NZL.sel_size() | {? TR_NZL.f_active() || TR_NZL.f_size() || TR_NZL.size() ?}
                || $TR_NZL.ref()
                || ''
                ?}
?};
TR_Z.DUID:='';
TR_Z.MUID:=TR_NZL.DOK_REF;
::TR_NZL.cntx_pop();
~~


\pd_TR_NZL
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.14]
:: OPIS: przed dla dyspozycji w magazynie
::   WE: _a - 'Z'-załadunek (domyślnie) 'R'-rozładunek
::----------------------------------------------------------------------------------------------------------------------
_rodz:={? var_pres('_a')=type_of('') & (';ZR'*_a)>1 || _a || 'Z' ?};
no_msg(1); errno();
_size:=TR_NZL.sel_size() | {? TR_NZL.f_active() || TR_NZL.f_size() || TR_NZL.size() ?};
_err:=errno(); no_msg(0);
TR_ZL.index('POZ');
TR_ZL.prefix({? _size || TR_NZL.ref() || null() ?});
grp_disp(TR_ZL,'MAG');
~~


\lmg_dsa_param_proc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.14]
:: OPIS: Zmiana parametrów pracy obszaru LMG_MAG - od strony dyspozycji w magazynie
::----------------------------------------------------------------------------------------------------------------------
_rodz:={? TR_NZL.cur_prfx*',''Z'',' || 'Z' || 'R' ?};
_oddz:=ST.ODDZ;
_okr_ref:=ST.OKR_REF;
_wer:=cur_win(1,1);
_nofix:=var_pres('__trgrp')>0;
{? AreaTitle.area='LMG_MAG'
|| _mg:=ST.MAG;
   exec('lmg_dsm_param_proc','lmg');
   {? _mg<>ST.MAG | _oddz<>ST.ODDZ | _okr_ref<>ST.OKR_REF || exec('pr_TR_NZL','lmg',_rodz) ?}
|? __PARSES.editPar('OddzialLogProd','OkresRok')
|| {? _oddz<>ST.ODDZ
   || exec('init','ltr')
   ?};
   {? _wer='WER'
   || exec('before_ltr_zle_pzle','ltr')
   |? _wer='MAGALL' & ~_nofix
   || exec('pr_TR_NZL','ltr',_rodz)
   |? _wer='PLAN'
   || exec('before_tr_nzlplan','ltr')
   ?};
   AreaTitle.setTitle()
?}


\pd_TR_ZLM
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.14]
:: OPIS: przed dla dyspozycji w magazynie - dodatki dla pozycji
::----------------------------------------------------------------------------------------------------------------------
_size:={? TR_ZL.f_active() || TR_ZL.f_size() || TR_ZL.size() ?};
_ref:=TR_ZL.ref();
{? _ref=null() || _size:=0 ?};
TR_ZLM.index('TR_ZL');
TR_ZLM.prefix({? _size || _ref || null() ?});
{? ~_size
|| _tmg:='X';
   _wym:='N';
   _atr:='N'
|| TR_ZL.get();
   _tmg:=(1+TR_ZL.TR_NZL().MG().TYP);
   _wym:=TR_ZL.TR_NZL().MG().SL;
   _atr:=TR_ZL.M().M_ATR<>null()
?};

{? ~_size | ((~_atr | _tmg<>'D') & _wym='N')
 | (TR_ZL.TR_NZL().WHERE='TR_NZL'
  & ((1+TR_NZL.STMG)<>'A' | exec('FindInSet','#table','EANN','AKT',$TR_NZL.ref(),'T')<>null()))
|| TR_ZLM.actions_grayed('WER','DPU:D')
|| TR_ZLM.actions_grayed('WER','')
?};
grp_disp(TR_ZLM,'WER');
~~


\pr_TR_ZLM
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.14]
:: OPIS: przed dla dyspozycji w magazynie - dodatki dla pozycji
::----------------------------------------------------------------------------------------------------------------------
exec('pd_TR_ZLM','ltr');
~~


\ltr_lic
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.14]
:: OPIS: Formuła sprawdzająca licencję dla obszaru LTR
::   WY: 'T' - jest licencja, 'N' - nie ma licencji
::----------------------------------------------------------------------------------------------------------------------
_result:='N';
_domain:=exec('domain_ref','#b_domain','LTR');
{? _domain<>null()
|| {? exec('lic','#b_domain',_domain)=1
   || _result:='T'
   ?}
?};
_result


\before_tr_pack
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.42]
:: OPIS: przed obsługą okienka TR_PACK
::----------------------------------------------------------------------------------------------------------------------
{? TR_Z.ARCHKOD<>(TR_PACK.name()+4) || exec('opentr','open_tab',TR_Z.ARCHKOD) ?};
_wer:=cur_win(1,1);
_act_hid:={? (TR_PACK.name()+4)<>'____' || ':D' || '' ?};
_act_dom:={? (TR_PACK.name()+4)<>'____' || 'R:R' || 'D:D' ?};
TR_PACK.actions(_wer,_act_hid,_act_dom,1);
TR_PACK.index('ALL');
TR_PACK.prefix();
~~


\refresh_tr_pack
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.42]
:: OPIS: odświeżenie okienka TR_PACK
::----------------------------------------------------------------------------------------------------------------------
_size:=TR_PACK.sel_size() | {? ~TR_PACK.f_active() || TR_PACK.size() || TR_PACK.f_size() ?};
_tr_pack:={? _size || TR_PACK.ref() || null() ?};
TR_ZPACK.index('TR_PACK');
TR_ZPACK.prefix(_tr_pack);
grp_disp(TR_ZPACK,'WER');
TR_HPACK.index('TR_PACK');
TR_HPACK.prefix(_tr_pack);
grp_disp(TR_HPACK,'WER');
''


\after_tr_pack
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [20.42]
:: OPIS: po obsłudze okienka TR_PACK
::----------------------------------------------------------------------------------------------------------------------
''


\wlasny_wp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [PD] [23.25]
:: OPIS: Wartośc początkowa TR_NZL.WLASNY i TR_NAG.WLASNY
::----------------------------------------------------------------------------------------------------------------------
exec('get','#params',700812)


\ltr_mob
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PD [23.25]
:: OPIS: Uruchamia obszar roboczy LTR_MOB
::----------------------------------------------------------------------------------------------------------------------
{?  ST.AR<=0 | ST.AM<=0
|| __PARSES.editDom('LTR');
   {? ST.AR<=0 | ST.AM<=0
   || return(0)
   ?}
?};

exec('init','ltr');

:: Ustalenie treści linku
_params:=params_get();
{? type_of(_params)>0 & var_pres('LINK',_params)
|| _link:=_params.LINK
|| _link:=''
?};

:: DRO_TODO_AWI: jakieś środowisko zrobić
VAR_DEL.delete('__TR_WYKON');

_tra:=(exec('chk_role','#b__box',OPERATOR.USER,'LTR_TRA_PZLE')
     | exec('chk_role','#b__box',OPERATOR.USER,'LTR_TRA_DZLE'));

_title_grp:=''@;
TR_Z.ARCHKOD:='____';
TR_Z.ARCHNAZ:='Niezarchiwizowane';

USERS.cntx_psh();
TR_NAG.index('K_SYM');
TR_NAG.prefix(OPERATOR.USER().OSOBA);
_tr_nag:=TR_NAG.first();
USERS.cntx_pop();
{? ~_tr_nag || FUN.info('Użytkowinik nie ma zdefiniowanych żadnych transportów.'@); return(0) ?};

{? _tra
||
   _fb:="";
   _win_grp:=TR_NZL.grp_make(_title_grp,_fb,'transzlec_grp',,,"exec('exit','zws',_a)");

   _fb:="exec('before_tr_nag','ltr',1)";
   _fa:="exec('after_tr_nag','ltr')";
   _fr:="exec('refresh_tr_nag','ltr')";
   TR_NZL.grp_sel(_win_grp,TR_NAG,'REAL',,_fr,,,8,_fb,_fa,,,'maximized_with_title');
   TR_NZL.grp_splt(_win_grp,,'horizontal','transport');
   _fb:="grp_disp(TR_NAG,'REAL');exec('before_tr_trasplan','ltr','N')";
   _fa:="exec('after_tr_trasplan','ltr')";
   _fr:="";
   TR_NZL.grp_sel(_win_grp,TR_NZL,'REAL','Realizacja transportu'@,_fr,,,8,_fb,_fa,,,'maximized','TRREALMOB');
   _fb:="grp_disp(TR_NAG,'REAL');exec('before_tr_trasplan','ltr','T')";
   _fa:="exec('after_tr_trasplan','ltr')";
   _fr:="";
   TR_NZL.grp_sel(_win_grp,TR_NZL,'REAL','Zrealizowane trasy'@,_fr,,,8,_fb,_fa,,,'maximized','ZREALMOB');
   _fb:="exec('before_tr_trasno','ltr')";
   _fa:="exec('after_tr_trasno','ltr')";
   _fr:="";
   TR_NZL.grp_sel(_win_grp,TR_LOG,'REAL','Niezrealizowane trasy'@,_fr,,,4,_fb,_fa,,,'maximized','NREALMOB');
   TR_NAG.win_fml('PLAN',,'SYM',,'ICON_BEFORE',exec('tr_nag_sym_ib','transport'));
   TR_NAG.win_fml('REAL',,'SYM',,'ICON_BEFORE',exec('tr_nag_sym_ib','transport'));
   TR_NAG.win_fml('PLAN',,'WYJ_D',,'ICON_BEFORE',exec('tr_nag_wyj_d_ib','transport'));
   TR_NAG.win_fml('REAL',,'WYJ_D',,'ICON_BEFORE',exec('tr_nag_wyj_d_ib','transport'));
   TR_NAG.win_edit(exec('tr_nag_win_edit','transport'));

   TR_NZL.win_fml('TRASY',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
   TR_NZL.win_fml('PLAN',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
   TR_NZL.win_fml('REAL',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
   TR_NZL.win_fml('TRASY',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
   TR_NZL.win_fml('PLAN',,'SYM',,'ICON_BEFORE',exec('tr_nzl_sym_ib','transport_zlec'));
   TR_NZL.win_fml('WER',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
   TR_NZL.win_fml('TRASY',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
   TR_NZL.win_fml('PLAN',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
   TR_NZL.win_fml('REAL',,'KTM',,'ICON_BEFORE',exec('tr_nzl_ktm_ib','transport_zlec'));
   TR_NZL.dnd_sel('TRASY',,'records.TR_NZL',"exec('dndTR_NZL_trasy','transport')");
   TR_NZL.dnd_sel('PLAN',,'records.TR_NZL',"exec('dndTR_NZL_plan','transport')");

   TR_NZL.win_sel(_win_grp);
   AreaTitle.setTabWin(TR_NZL,~~);
   AreaTitle.setTitle();

   exec('zakr_dysp_get','transport_zlec');
   {? _link <> ''
   ||  TR_Z.ARCHKOD:=4+(_link+12);
       exec('opentr','open_tab',TR_Z.ARCHKOD);
      {? ref_tab(_link)=TR_NAG & TR_NAG.seek(_link)
      || TR_NZL.select(,1,5,,'TRREALMOB',,1)
      || FUN.info('Nie odnaleziono transportu: %1'@[exec('record','#to_string',_link)]);
         TR_NZL.select()
      ?}
   || TR_NZL.select()
   ?}

|| FUN.info('Brak uprawnień do przeglądania zleceń transportowych lub transportów.'@);
   return(0)
?};
VAR_DEL.delete('__TR_WYKON');
~~


\map_display
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PD [23.25]
:: OPIS: Wyświetla mapę
::----------------------------------------------------------------------------------------------------------------------
{? TR_NAG.PLM<>null()
|| TR_NAG.cntx_psh();
   TR_NAG.win_edit('MAP');
   TR_NAG.display();
   TR_NAG.cntx_pop()
|| FUN.info('Brak wygenerowanej mapy transportu.'@)
?};
~~


\opis_edit
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PD [23.25]
:: OPIS: Wyświetla opis do redakcji
::----------------------------------------------------------------------------------------------------------------------
TR_NZL.memo_get(,'OPIS',0);
{? TR_NZL.memo_edit(1,'OPIS') || TR_NZL.memo_put(,'OPIS') ?};
~~

:Sign Version 2.0 jowisz:1048 2023/06/23 14:14:39 a16d471b0269a23742766578ed9f78437e4e302acfc5c6565c65757603333b35b3345445e29d338125ed313d4bb57fc08e5a02c05aa7cb666c5c62dbcb95990cc7a6ea0536e046439e0c7fb7730cb2e03e399adabd32223319ae9bf317117ca284715725fe0e65b42a663bb3047b5184165527b712b0b8b7ebff30c52d63906c
