:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: bdo_test.fml
:: Utworzony: 25.11.2019
:: Autor: TS
::======================================================================================================================
:: Zawartość: Formuły współpracy z BDO poprzez serwis REST
::            Plik zawiera funkcje testowe
::======================================================================================================================


\CardStatus_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo słownik statusów kart
::----------------------------------------------------------------------------------------------------------------------
_tab:=json_tparse(exec('CardStatus','bdo_api').DATA,50,50);
_wer:=_tab.mk_sel('Statusy kart'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Country_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo słownik krajów
::----------------------------------------------------------------------------------------------------------------------
_tab:=json_tparse(exec('Country','bdo_api').DATA,50,50);
_wer:=_tab.mk_sel('Kraje'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Country_search_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo słownik krajów
::----------------------------------------------------------------------------------------------------------------------
_codeName:=exec('edit_string','#edit',,'Kod kraju'@);
_tab:=json_tparse(exec('Country_search','bdo_api',_codeName).DATA,50,50);
_wer:=_tab.mk_sel('Kraje'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\WasteCode_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo słownik kodów odpadów
::----------------------------------------------------------------------------------------------------------------------
_tab:=json_tparse(exec('WasteCode','bdo_api').DATA,50,50);
_wer:=_tab.mk_sel('Kody odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\WasteCode_search_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo słownik kodów odpadów
::----------------------------------------------------------------------------------------------------------------------
_code:=exec('edit_string','#edit',,'Kod odpadu'@);
_tab:=json_tparse(exec('WasteCode_search','bdo_api',_code).DATA,50,50);
_wer:=_tab.mk_sel('Kody odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\WasteProcess_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo słownik procesów przetwarzania odpadów
::----------------------------------------------------------------------------------------------------------------------
_tab:=json_tparse(exec('WasteProcess','bdo_api').DATA,50,50);
_wer:=_tab.mk_sel('Procesy przetwarzania odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\WasteProcess_search_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo słownik procesów przetwarzania odpadów
::----------------------------------------------------------------------------------------------------------------------
_name:=exec('edit_string','#edit',,'Nazwa procesu'@);
_codeName:=exec('edit_string','#edit',,'Oznaczenie kodowe procesu'@);
_tab:=json_tparse(exec('WasteProcess_search','bdo_api',_name,_codeName).DATA,50,50);
_wer:=_tab.mk_sel('Procesy przetwarzania odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Search_searchcompany_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo listę podmiotów
::----------------------------------------------------------------------------------------------------------------------
_query:=exec('edit_string','#edit',,'Zapytanie'@);
_tab:=json_tparse(exec('Search_searchcompany','bdo_api',_query).DATA,50,50);
_wer:=_tab.mk_sel('Podmioty'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Search_getcompanybyid_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla dane podmiotu
::----------------------------------------------------------------------------------------------------------------------
_companyId:=exec('edit_string','#edit',,'Identyfikator podmiotu'@);
_tab:=json_tparse(exec('Search_getcompanybyid','bdo_api',_companyId).DATA,50,50);
_wer:=_tab.mk_sel('Podmiot'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Search_geteupbyid_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla dane miejsca prowadzenia działalności
::----------------------------------------------------------------------------------------------------------------------
_eupId:=exec('edit_string','#edit',,'Identyfikator miejsca prowadzenia działalności'@);
_tab:=json_tparse(exec('Search_geteupbyid','bdo_api',_eupId).DATA,50,50);
_wer:=_tab.mk_sel('Miejce prowadzenia działalności'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Search_geteupsbycompanyid_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla listę miejsc prowadzenia działalności podmiotu
::----------------------------------------------------------------------------------------------------------------------
_companyId:=exec('edit_string','#edit',,'Identyfikator podmiotu'@);
_tab:=json_tparse(exec('Search_geteupsbycompanyid','bdo_api',_companyId).DATA,50,50);
_wer:=_tab.mk_sel('Miejsca prowadzenia działalności'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Kpo_create_plannedcard_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Test tworzenia karty przekazania odpadów
::----------------------------------------------------------------------------------------------------------------------
:: transportujący wg NIP
_carrierCompanyId:=json_parse(exec('Search_searchcompany','bdo_api','7571043354').DATA)[1].companyId;
:: odbierający wg NIP
_receiverCompanyId:=json_parse(exec('Search_searchcompany','bdo_api','5222612717').DATA)[1].companyId;
:: pierwsze miejsce prowadzenia działalności
_receiverEupId:=json_parse(exec('Search_geteupsbycompanyid','bdo_api',_receiverCompanyId).DATA)[1].eupId;
_wasteCodeId:=1;
_vehicleRegNumber:='SC 123456';
_wasteMass:=100;
_plannedTransportTime:='2019-12-10T18:04:34.097Z';
_wasteProcessId:=1;
_tab:=json_tparse(
   exec('Kpo_create_plannedcard','bdo_api',
      _carrierCompanyId,
      _receiverCompanyId,
      _receiverEupId,
      _wasteCodeId,
      _vehicleRegNumber,
      _wasteMass,
      _plannedTransportTime,
      _wasteProcessId
   ).DATA,
   50,50
);
_wer:=_tab.mk_sel('Karta przekazania odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Kpo_sender_search_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Test wyszukiwarki kart
::----------------------------------------------------------------------------------------------------------------------
_obj:=exec('Kpo_sender_search','bdo_api',1,5);
{? _obj.STATUS=200
|| _tab:=json_tparse(_obj.DATA,50,50);
   _wer:=_tab.mk_sel('Wyszukiwarka kart przekazania odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
   _tab.win_sel(_wer);
   _tab.select()
|| FUN.emsg(_obj.MESSAGE)
?};
~~


\Kpo_planned_card_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Test
::----------------------------------------------------------------------------------------------------------------------
_obj:=exec('Kpo_planned_card','bdo_api','a0177d37-082d-417a-a5f1-a57d7d17aacc','Sender');
{? _obj.STATUS=200
|| _tab:=json_tparse(_obj.DATA,50,50);
   _wer:=_tab.mk_sel('Pobranie karty odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
   _tab.win_sel(_wer);
   _tab.select()
|| FUN.emsg(_obj.MESSAGE)
?};
~~


\Search_searchterytcommune_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo listę gmin
::----------------------------------------------------------------------------------------------------------------------
_query:=exec('edit_string','#edit',,'Zapytanie'@);
_tab:=json_tparse(exec('Search_searchterytcommune','bdo_api',_query).DATA,50,50);
_wer:=_tab.mk_sel('Gminy'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Search_getterytcommunebyid_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo listę gmin
::----------------------------------------------------------------------------------------------------------------------
_query:=exec('edit_string','#edit',,'Zapytanie'@);
_tab:=json_tparse(exec('Search_getterytcommunebyid','bdo_api',_query).DATA,50,50);
_wer:=_tab.mk_sel('Gminy'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\Keok_search
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.14]
:: OPIS: Wyświetla testowo KEOK
::----------------------------------------------------------------------------------------------------------------------
_tab:=json_tparse(exec('Keok_search','bdo_api',1,50,'','','').DATA,50,50);
_wer:=_tab.mk_sel('Karty ewidencji odpadów'@+' — '+'TEST'@,'N',1,'test',,,,1);
_tab.win_sel(_wer);
_tab.select();
~~


\xlimit_test
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [20.42]
:: OPIS: Formuła do testowania limitu zapytań do API
::----------------------------------------------------------------------------------------------------------------------
_env:=exec('env_create','odpady');
params_set('env',_env);

_kpoId:='d9200d4a-eb27-4892-ac7c-8a1312945af9';

_utc_start:=utc_get();
_size:=2000;
FUN.prg_start(_size);
_it:=1;
{!
|?
::   _obj:=exec('HealthCheck','bdo_api');
::   _obj:=exec('Search_getterytcommunebyid','bdo_api','x');
::   _obj:=exec('Kpo_printingpage','bdo_api',_kpoId);
   _obj:=exec('kpo_confirmation','bdo_api',_kpoId);

   _can_continue:=FUN.prg_next(1,'%1 (%2)\n\n'[$_it,form(utc_get()-_utc_start,,3)]+_obj.HEADER);
   echo('%1 %2 %3'[$_obj.STATUS,form(utc_get()-_utc_start,,3),$_it]);

   obj_del(_obj);
   _it+=1;
   _can_continue>0 & _it<=_size
!};
FUN.prg_stop();
~~


\Keo_create
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [21.37]
:: OPIS: Tworzy testowo KEO
::----------------------------------------------------------------------------------------------------------------------
_env:=exec('env_create','odpady');
params_set('env',_env);

exec('Keo_create','bdo_api',1,50);
~~


\Keo_search
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [21.37]
:: OPIS: Wyszukuje testowo KEO
::----------------------------------------------------------------------------------------------------------------------
_env:=exec('env_create','odpady');
params_set('env',_env);

exec('Keo_search','bdo_api',1,50,'01 01 01','','');
~~


\Keo_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [21.37]
:: OPIS: Pobiera testowo KEO
::----------------------------------------------------------------------------------------------------------------------
_env:=exec('env_create','odpady');
params_set('env',_env);

exec('Keo_get','bdo_api','0de969be-7790-4e75-a399-fe80fd47f476');
~~


\Keo_printingpage
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [21.37]
:: OPIS: Pobiera testowo KEO
::----------------------------------------------------------------------------------------------------------------------
_env:=exec('env_create','odpady');
params_set('env',_env);

exec('Keo_printingpage','bdo_api','0de969be-7790-4e75-a399-fe80fd47f476');
~~

:Sign Version 2.0 jowisz:1045 2021/09/17 15:17:05 428df6d63b9fce5771b3826bfc84d6cdb281e6702b8dc609099afa99b4f3326e4c4db6bb75638fdeffa5374cc4dda68c15309a9a2f9de028026f6944fe8990ef4b52f8f886d59673d5f8b91d3741b8d79d0f52e4de55162bc4adbe53f90fbe09958ab8b340c6f31e69a7fced959d013bea5355fb836aaec2715fc7d06cabd63b
