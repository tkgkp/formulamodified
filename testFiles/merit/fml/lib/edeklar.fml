:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzezone
::======================================================================================================================
:: Nazwa pliku: edeklar.fml
:: Utworzony: 2008
:: Autor: DAROKR
::======================================================================================================================
:: Zawartosc: Funkcje do obslugi deklaracji podatkowych.
::======================================================================================================================


\wybor
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula do wyboru deklaracji podatkowych
::   WE: _a  [STRING]   - (wymagany) oznaczenie rodzaju deklaracji np. 'PIT4R', 'PIT8AR'
::      [_b] [INTEGER]  - (opcjonalny) rok deklaracji
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || return(~~) ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0          ?};

EDIT_VAR.PIT_RODZ:='';
_TPAR:=exec('tab_rok','edeklar','Deklaracja %1'@[_pitTyp]);
_TPAR.ROK:={? _rok || _rok || date()~1 ?};
params_set('TPAR',_TPAR);

{? {? ~exec('no_limit','schemat',BPMN.SYM_DOM) || return() ?};
   {? _rok=0
   || _TPAR.edit("_par:=params_get(); _TPAR:=_par.TPAR;
               {? _TPAR.ROK>=2007
               || 1
               || FUN.emsg('E-deklaracje są dostępne tylko od 2007 roku.'@);
                  return('ROK')
               ?}")
   || 1
   ?}

|| {? _pitTyp='PIT4R'
   || {? _TPAR.ROK=2013
      || datapoc:=date(2013,11,21);
         datakon:=date(2013,12,0)
      |? _TPAR.ROK=2014
      || datapoc:=date(2014,12,8);
         datakon:=date(2014,12,0)
      || datapoc:=date(_TPAR.ROK,1,1);
         datakon:=date(_TPAR.ROK,12,0)
      ?};
      okres:=$_TPAR.ROK;
      rodzdekl:='D';
      SKID.DEKL_NAZ:='PIT4R';
      __Rok:=_TPAR.ROK
   |? _pitTyp='PIT8AR'
   || {? _TPAR.ROK=2008 | _TPAR.ROK=2012
      || datapoc:=date(_TPAR.ROK,5,1);
         datakon:=date(_TPAR.ROK,12,0)
      |? _TPAR.ROK=2013
      || datapoc:=date(_TPAR.ROK,10,10);
         datakon:=date(_TPAR.ROK,12,0)
      |? _TPAR.ROK=2014
      || datapoc:=date(_TPAR.ROK,12,8);
         datakon:=date(_TPAR.ROK,12,0)
      |? _TPAR.ROK=2015
      || datapoc:=date(_TPAR.ROK,1,20);
         datakon:=date(_TPAR.ROK,12,0)
      || datapoc:=date(_TPAR.ROK,1,1);
         datakon:=date(_TPAR.ROK,12,0)
      ?};
      okres:=$_TPAR.ROK;
      rodzdekl:='Z';
      SKID.DEKL_NAZ:='PIT8AR';
      __Rok:=_TPAR.ROK
   || FUN.emsg('Brak wskazanego typu e-deklaracji.'@);
      return()
   ?};
   rok_dekp:=date(0,0,0);
   pit_typ:=_pitTyp;
   VAT_DEK.index('VAT_DEKR');
   VAT_DEK.prefix(rodzdekl,rok_dekp,okres,pit_typ);
   {? SKID.DEKL_NAZ='PIT4R'
   || VAT_DEK.win_edit('PIT4R');
      VAT_DEK.win_sel('WER_4R')
   || VAT_DEK.win_edit('POD_KL');
      VAT_DEK.win_sel('WER_8AR')
   ?};
   VAT_DEK.hdr_sel();
   VAT_DEK.hdr_sel(': %1 z roku %2'@[pit_typ,okres]);
   VAT_DEK.select(,1,7)
?}


\pit_dol
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Akcja Dolacz w okienkach wer. tabeli VAT_DEK
::----------------------------------------------------------------------------------------------------------------------
EDIT_VAR.NR_EDIT:=1;
::Sprawdzenie czy mamy aktualizacja 12.51_122 PIT za 2021 rok
_akt_122:=var_pres('PDOF1',VAT_DEK)>0;
{? SKID.DEKL_NAZ='PIT4R'
|| {? __Rok>=2021 & _akt_122
   || VAT_DEK.win_edit('PIT4R_21')
   |? __Rok>=2019 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('PIT4R_19')
   || VAT_DEK.win_edit('PIT4R')
   ?}
|| {? __Rok>=2021 & _akt_122
   || VAT_DEK.win_edit('POD_KL21')
   |? __Rok>=2019 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('POD_KL19')
   || VAT_DEK.win_edit('POD_KL')
   ?}
?};
VAT_DEK.blank();
VAT_DEK.ROK:=null();
VAT_DEK.RODZAJ:=rodzdekl;
VAT_DEK.TYP:=pit_typ;
VAT_DEK.OKRES:=okres;
VAT_DEK.OPIS:='Deklaracja %1'@[pit_typ];
_u:=userdata();
VAT_DEK.IMIE:=~-{? _im:=_u*' ' || (_im-1)+_u || _u ?};
VAT_DEK.NAZ:=~-{? _im || _im-_u || '' ?};
VAT_DEK.STN:=exec('stanowisko','edeklar');
VAT_DEK.DATA:=date();
_ver:=1;
VAT_DEK.cntx_psh();
VAT_DEK.index('VAT_DEK');
VAT_DEK.prefix(rok_dekp,pit_typ,okres);
{? VAT_DEK.last() || _ver:=VAT_DEK.WER+1 ?};
VAT_DEK.cntx_pop;
VAT_DEK.WER:=_ver;

_refnr:=null;
::zmiana dla roku 2015 w zaleznosci od daty systemowej rozne wersje e-deklaracji PIT-4R lub PIT-8AR
::ustawienie odpowiedno wersji 6 i 5 PIT-4R lub 7 i 6 PIT-8AR
::dla lat 2016 i 2017 ustawienie 6 wersji PIT-4R oraz 7 wersji PIT-8AR
::Zmiany 2018 w zaleznosci od daty systemowej rozne wersje e-deklaracji PIT-4R lub PIT-8AR
::dotyczace przychodu za 2018 tworzony w 2018 to wersja 7 w 2019 za 2018 to 8 wersja
{? __Rok>=2018
|| VAT_VER.index('VER_NR');
   {? SKID.DEKL_NAZ='PIT4R'
   || {? __Rok>=2023 & date>=date(2023,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,13)
      |? __Rok>=2021 & date>=date(2021,4,16)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,12)
      |? date>=date(2021,1,20)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,11)
      |? date>=date(2020,11,18)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,10)
      |? date>=date(2020,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,9)
      |? date>=date(2019,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,8)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,7)
      ?};
      {? VAT_VER.first
      || _refnr:=VAT_VER.ref()
      ?}
   || {? __Rok>=2023 & date>=date(2023,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,14)
      |? __Rok>=2022
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,13)
      |? __Rok>=2021 & date>=date(2021,4,16)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,12)
      |? date>=date(2021,1,22)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,11)
      |? date>=date(2020,11,18)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,10)
      |? date>=date(2020,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,9)
      |? date>=date(2019,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,8)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,7)
      ?};
      {? VAT_VER.first
      || _refnr:=VAT_VER.ref()
      ?}
   ?}
|? __Rok>=2015 & __Rok<2018
|| VAT_VER.index('VER_NR');
   {? SKID.DEKL_NAZ='PIT4R'
   || {? date>=date(2016,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,6)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,5)
      ?};
      {? VAT_VER.first
      || _refnr:=VAT_VER.ref()
      ?}
   || {? date>=date(2016,1,1)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,7)
      || VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ,6)
      ?};
      {? VAT_VER.first
      || _refnr:=VAT_VER.ref()
      ?}
   ?}
|| VAT_VER.index('VER_OD');
   VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ);
   {? VAT_VER.find_le(datapoc)
   || {? datakon~1=VAT_VER.OD~1
      || _refnr:=VAT_VER.ref
      || {? ~VAT_VER.next
         || _refnr:=VAT_VER.ref()
         ?}
      ?}
   ?}
?};
VAT_DEK.NR:=_refnr;
VAT_DEK.memo_set(,'OPISKOR');
VAT_DEK.memo_set(,'OPISWPLA');
{? var_pres('PODFIZ',KST)>0
|| VAT_DEK.POD:=exec('ust_nk','lista_licz',date(__Rok,12,0),'PODFIZ')
?};
::ustawienie blokowania do redakcji pola VAT_DEK.POD przy dolacz, pole ustalane na podstawie
::stalych systemu jezeli mamy pole KST.PODFIZ w zmiennej KST
VAT_DEK.fld_fml('POD','BEFORE_EDIT',"0");
exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,VAT_DEK.win_edit('?'));
{? VAT_DEK.edit("exec('pit_rec','edeklar',1)")
|| exec('stanowisko','edeklar','set',VAT_DEK.STN);
   {? VAT_DEK.add
   || VAT_DEK.memo_put(,'OPISKOR');
      VAT_DEK.memo_put(,'OPISWPLA');
      VAT_POZ.index('VAT_POZ');
      VAT_POZ.prefix(VAT_DEK.ref);
      exec('pit_addpoz','edeklar',pit_typ)
   ?}
?};
VAT_DEK.fld_fml('POD','BEFORE_EDIT',"*")


\pit_wys
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Akcja Wyswietl w okienkach wer. tabeli VAT_DEK
::----------------------------------------------------------------------------------------------------------------------
_rok:=#VAT_DEK.OKRES; _vern:=VAT_DEK.NR().NR;
::Sprawdzenie czy mamy aktualizacja 12.51_122 PIT za 2021 rok
_akt_122:=var_pres('PDOF1',VAT_DEK)>0;
{? VAT_DEK.TYP='PIT11P'
|| {? _rok>=2019 & _vern>=10 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('PIT11PW9')
   |? _rok>=2015 & _vern>=7
   || VAT_DEK.win_edit('PIT11PW5')
   |? _rok>=2011 & _vern>=3
   || VAT_DEK.win_edit('PIT11PW1')
   || VAT_DEK.win_edit('PIT11PW')
   ?};
   VAT_DEK.hdr_edit();
   VAT_DEK.hdr_edit(': '+VAT_DEK.NAZWISKO+' '+VAT_DEK.PIERWSZE)
|? VAT_DEK.TYP='PIT11Z'
|| {? _rok>=2019 & _vern>=10 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('PIT11ZW9')
   |? _rok>=2015 & _vern>=7
   || VAT_DEK.win_edit('PIT11ZW5')
   |? _rok>=2011 & _vern>=3
   || VAT_DEK.win_edit('PIT11ZW1')
   || VAT_DEK.win_edit('PIT11ZW')
   ?};
   VAT_DEK.hdr_edit();
   VAT_DEK.hdr_edit(': '+VAT_DEK.NAZWISKO+' '+VAT_DEK.PIERWSZE)
|? VAT_DEK.TYP='PIT40'
|| VAT_DEK.win_edit('PIT40W');
   VAT_DEK.hdr_edit();
   VAT_DEK.hdr_edit(': '+VAT_DEK.NAZWISKO+' '+VAT_DEK.PIERWSZE)
|? VAT_DEK.TYP='PIT8CP' | VAT_DEK.TYP='PIT8CZ'
|| VAT_DEK.win_edit('PIT8CW');
   VAT_DEK.hdr_edit();
   VAT_DEK.hdr_edit(': '+VAT_DEK.NAZWISKO+' '+VAT_DEK.PIERWSZE)
|? VAT_DEK.TYP='IFT1' | VAT_DEK.TYP='IFT1R'
|| {? VAT_DEK.TYP='IFT1'
   || VAT_DEK.win_edit('IFT1W')
   || VAT_DEK.win_edit('IFT1RW')
   ?};
   VAT_DEK.hdr_edit();
   VAT_DEK.hdr_edit(': '+VAT_DEK.NAZWISKO+' '+VAT_DEK.PIERWSZE)
|? VAT_DEK.TYP='PIT4R'
|| {? _rok>=2021 & _vern>=12 & _akt_122
   || VAT_DEK.win_edit('PIT4R_21')
   |? _rok>=2019 & _vern>=9 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('PIT4R_19')
   || VAT_DEK.win_edit('PIT4R')
   ?}
|| {? _rok>=2021 & _vern>=12 & _akt_122
   || VAT_DEK.win_edit('POD_KL21')
   |? _rok>=2019 & _vern>=9 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('POD_KL19')
   || VAT_DEK.win_edit('POD_KL')
   ?}
?};
VAT_DEK.memo_get(,'OPISKOR');
exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,VAT_DEK.win_edit('?'));
VAT_DEK.display()


\pit_usu
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula na Usun dla deklaracji podatkowych
::----------------------------------------------------------------------------------------------------------------------
{? exec('is_edek','xml',SKID.DEKL_NAZ)
|| FUN.emsg('Istnieją e-Deklaracje.\nUsunięcie zabronione.'@);
   return(0)
?};
{? VAT_DEK.r_lock(1,1,1)
|| {? VAT_DEK.get()
   || {? FUN.ask('Usunąć bieżący wiersz?'@)
      || _usu_dek:=0; _pit11:=0;
         {? 5+VAT_DEK.TYP='PIT11' | (5+VAT_DEK.TYP='PIT8C')
         || DEKL_POD.use('pod_'+$__Rok); _usu_dek:=1; _v_data:=VAT_DEK.DATA;
            {? VAT_DEK.TYP='PIT11P' | VAT_DEK.TYP='PIT8CP'
            || _rodz:='E'
            || _rodz:='Z'
            ?};
            {? 5+VAT_DEK.TYP='PIT11'
            || _pit11:=1
            || _pit11:=0
            ?};
            _dek_p:=VAT_DEK.P; _dek_o:=VAT_DEK.P().OSOBA
         ?};
         {? VAT_DEK.TYP='PIT40'
         || _pit12:=exec('pit12_get','osoba',VAT_DEK.P().OSOBA,__Rok)
         ?};

         do();
         VAT_POZ.index('VAT_POZ');
         VAT_POZ.prefix(VAT_DEK.ref);
         {? VAT_POZ.first() || {! |? VAT_POZ.del() !} ?};

            {? _usu_dek
            || _akt_147:=exec('akt_147','edeklar');
               {? VAT_DEK.PODATNIK='T'
               || DEKL_POD.index('DEKL_OSO');
                  {? _pit11
                  || {? __Rok>=2022 & _akt_147
                     || DEKL_POD.prefix(_dek_o,'(E)PIT-11','(E)PIT-11',)
                     || DEKL_POD.prefix(_dek_o,'(E)PIT-11','(E)PIT-11',_v_data)
                     ?}
                  || DEKL_POD.prefix(_dek_o,'(E)PIT-8C','(E)PIT-8C',_v_data)
                  ?};
                  {? _pit11 & __Rok>=2022 & _akt_147
               || {? DEKL_POD.first()
                  || {!
                     |? {? DEKL_POD.VAT_DEK<>null()
                        || {? DEKL_POD.VAT_DEK=VAT_DEK.ref()
                           || DEKL_POD.del()
                           || DEKL_POD.next()
                           ?}
                        || DEKL_POD.del()
                        ?}
                     !}
                  ?}
               || {? DEKL_POD.first || {! |? DEKL_POD.del !} ?}
               ?}
            || {? _pit11 & __Rok>=2022 & _akt_147
               || DEKL_POD.index('DEKL_OSO');
                  DEKL_POD.prefix(_dek_o,'(E)PIT-11','(E)PIT-11',);
                  {? DEKL_POD.first()
                  || {!
                     |? {? DEKL_POD.VAT_DEK<>null() & DEKL_POD.VAT_DEK=VAT_DEK.ref()
                        || DEKL_POD.del()
                        || DEKL_POD.next()
                        ?}
                     !}
                  ?}
               || DEKL_POD.index('DEKL_PED');
                  {? _pit11
                  || DEKL_POD.prefix(_rodz,_dek_p,'(E)PIT-11','(E)PIT-11',_v_data)
                  || DEKL_POD.prefix(_rodz,_dek_p,'(E)PIT-8C','(E)PIT-8C',_v_data)
                  ?};
                  {? DEKL_POD.first() || {! |? DEKL_POD.del() !} ?}
               ?}
            ?}
         ?};
         {? VAT_DEK.TYP='PIT40' & _pit12.JEST>1
         || _ret:=exec('pit12_set','osoba',VAT_DEK.P().OSOBA,__Rok,'UO')
         || _ret:=''
         ?};
         {? exec('del_ndx','#table',ZALACZ,'NAG',VAT_DEK.uidref())
         || VAT_DEK.del(1)
         || undo()
         ?};
         end();
         {? _ret<>'' || FUN.emsg(_ret) ?}
      || VAT_DEK.r_unlock()
      ?}
   || VAT_DEK.r_unlock();
      FUN.emsg('Deklarację przegląda inny operator.\n'@+'Zabroniony dostęp.'@); 0
   ?}
|| FUN.emsg('Deklarację przegląda inny operator.\n'@+'Zabroniony dostęp.'@); 0
?}


\pit_dpoz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula na akcje poZycje dla deklaracji podatkowych
::----------------------------------------------------------------------------------------------------------------------
{? exec('bepitdek','edeklar')
|| VAT_POZ.index('VAT_POZ'); VAT_POZ.prefix(VAT_DEK.ref());
   {? VAT_POZ.first || VAT_POZ.VAT_DEK() ?};
   {? VAT_DEK.TYP='PIT8CP' | VAT_DEK.TYP='PIT8CZ'
   || VAT_POZ.win_edit(pit_typ-1);
      VAT_POZ.win_sel(pit_typ-1)
   |? VAT_DEK.TYP='IFT1' | VAT_DEK.TYP='IFT1R'
   || VAT_POZ.win_edit('IFT1');
      VAT_POZ.win_sel('IFT1')
   || VAT_POZ.win_edit(pit_typ);
      VAT_POZ.win_sel(pit_typ)
   ?};
   {? VAT_DEK.TYP='PIT11P' | VAT_DEK.TYP='PIT11Z' | VAT_DEK.TYP='PIT40'
      | VAT_DEK.TYP='PIT8CP' | VAT_DEK.TYP='PIT8CZ' | VAT_DEK.TYP='IFT1' | VAT_DEK.TYP='IFT1R'
   || VAT_POZ.hdr_sel();
      VAT_POZ.hdr_sel(': %1 %2'@[VAT_DEK.NAZWISKO,VAT_DEK.PIERWSZE])
   ?};
   exec('edit_var_p_format','edeklar',VAT_DEK.TYP);
   params_set('ver',VAT_DEK.NR().NR);
:: Dla PIT-11 za 2019 mamy dostępna akcja Popraw oraz nowe okienko redakcji 'PIT11_19'
   _p11_19:=0;
   {? var_pres('KOR_RODZ',VAT_DEK)>0
   || {? (VAT_DEK.TYP='PIT11P' | VAT_DEK.TYP='PIT11Z')
      || {? VAT_DEK.NR().NR>=10
         || VAT_POZ.win_edit('PIT11_19');
            _p11_19:=1;
            VAT_POZ.actions(pit_typ+'_1',':')
         || VAT_POZ.actions(pit_typ+'_1','P:')
         ?}
      ?}
   ?};
   VAT_POZ.select();
   {? _p11_19
   || VAT_POZ.fld_fml('KW1','BEFORE_EDIT',"*");
      VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"*");
      VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"*");
      VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"*")
   ?};
   {? VAT_DEK.TYP='PIT4R' | VAT_DEK.TYP='PIT8AR'
   || {! _ind:=1..6
      |! VAT_POZ.fld_fml('K'+$_ind,'EDIT_FORMAT',"")
      !};
      {! _ind:=1..6
      |! VAT_POZ.fld_fml('K'+$_ind,'DISPLAY_FORMAT',"")
      !}
   ?};
   VAT_POZ.hdr_sel();
   VAT_DEK.r_unlock()
?}


\bepitdek
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula sprawdzajaca czy wybrany rekord nie jest zablokowany
::   WE: [_a] [INTEGER] - czy pokazywać komunikaty (0/1) - domyślnie 1 (pokazywać)
::----------------------------------------------------------------------------------------------------------------------
_msg:={? var_pres('_a')=type_of(0) || _a || 1 ?};

{? VAT_DEK.r_lock(1,1,1)
|| {? VAT_DEK.get()
   || 1
   || {? _msg || FUN.emsg('Deklarację przegląda inny operator.'@+'\n'+'Zabroniony dostęp.'@) ?};
      VAT_DEK.r_unlock();
      0
   ?}
|| {? _msg || FUN.emsg('Deklarację przegląda inny operator.'@+'\n'+'Zabroniony dostęp.'@) ?}; 0
?}


\edpitdek
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula na Popraw przed okno WER tabeli VAT_DEK, sprawdza czy
::       istnieja e-deklaracje, jesli tak poprawianie jest niemozliwe
::----------------------------------------------------------------------------------------------------------------------
{? exec('is_edek','xml',SKID.DEKL_NAZ)
|| FUN.emsg('Istnieją e-Deklaracje.\nPoprawianie zabronione.'@);
   return(0)
?};
{? exec('bepitdek','edeklar')
   || EDIT_VAR.NR_EDIT:=0;
      VAT_DEK.fld_fml('POD','BEFORE_EDIT',"0");
      _nr_info:=0;
::    Sprawdzenie czy mamy aktualizacja 12.51_66 PIT za 2019 rok
      _akt_66:=var_pres('KOR_RODZ',VAT_DEK)>0 & var_pres('STN',VAT_DEK)>0 & var_pres('NR_INFOR',VAT_DEK)>0;
::    Sprawdzenie czy mamy aktualizacja 12.51_122 PIT za 2021 rok
      _akt_122:=var_pres('PDOF1',VAT_DEK)>0;
      {? SKID.DEKL_NAZ='PIT4R'
      || {? #VAT_DEK.OKRES>=2021 & VAT_DEK.NR().NR>=12 & _akt_122
         || VAT_DEK.win_edit('PIT4R_21')
         |? #VAT_DEK.OKRES>=2019 & VAT_DEK.NR().NR>=9 & _akt_66
         || VAT_DEK.win_edit('PIT4R_19')
         || VAT_DEK.win_edit('PIT4R')
         ?}
      |? SKID.DEKL_NAZ='PIT8AR'
      || {? #VAT_DEK.OKRES>=2021 & VAT_DEK.NR().NR>=12 & _akt_122
         || VAT_DEK.win_edit('POD_KL21')
         |? #VAT_DEK.OKRES>=2019 & VAT_DEK.NR().NR>=9 & _akt_66
         || VAT_DEK.win_edit('POD_KL19')
         || VAT_DEK.win_edit('POD_KL')
         ?}
      |? SKID.DEKL_NAZ='PIT11'
      || {? #VAT_DEK.OKRES>=2019 & VAT_DEK.NR().NR>=10 & _akt_66
         || VAT_DEK.win_edit('PIT11_19');
            _nr_info:=1
         || VAT_DEK.win_edit('POD_KL')
         ?}
      || VAT_DEK.win_edit('POD_KL')
      ?};
      VAT_DEK.memo_get(,'OPISKOR');
      VAT_DEK.memo_get(,'OPISWPLA');
      exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,VAT_DEK.win_edit('?'));
      {? {? _nr_info
         || VAT_DEK.edit("exec('pit11_popraw','edeklar')")
         || VAT_DEK.edit("exec('pit_rec','edeklar',0)")
         ?}
      || exec('stanowisko','edeklar','set',VAT_DEK.STN);
         {? VAT_DEK.put || VAT_DEK.memo_put(,'OPISKOR'); VAT_DEK.memo_put(,'OPISWPLA') ?}
      ?};
      VAT_DEK.r_unlock;
      VAT_DEK.fld_fml('POD','BEFORE_EDIT',"*")
?}


\pit_rec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula sprawdza poprawnosc danych w rekordzie tabeli VAT_DEK
::   WE: _a - 1-sprawdzenie przy Dolacz pola NR, 0-akcja Popraw nie sprawdza
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0) || _a:=0 ?};
{? _a
|| {? VAT_DEK.KOR='T'
   || {? __Rok>=2018
      || _spr:=__CHK.record(VAT_DEK,,'NR','OPIS','IMIE','NAZ','STN','DATA')
      || _spr:=__CHK.record(VAT_DEK,,'NR','OPIS','OPISKOR','IMIE','NAZ','STN','DATA')
      ?}
   || _spr:=__CHK.record(VAT_DEK,,'NR','OPIS','IMIE','NAZ','STN','DATA')
   ?}
|| {? VAT_DEK.KOR='T'
   || {? __Rok>=2018
      || _spr:=__CHK.record(VAT_DEK,,'OPIS','IMIE','NAZ','STN','DATA')
      || _spr:=__CHK.record(VAT_DEK,,'OPIS','OPISKOR','IMIE','NAZ','STN','DATA')
      ?}
   || _spr:=__CHK.record(VAT_DEK,,'OPIS','IMIE','NAZ','STN','DATA')
   ?}
?};
{? _spr=''
|| {? VAT_DEK.KOR='T'
   || {? (SKID.DEKL_NAZ='PIT4R' | SKID.DEKL_NAZ='PIT8AR') & VAT_DEK.NR().NR>=9
      || {? __Rok>=2019 & var_pres('KOR_RODZ',VAT_DEK)>0
         || {? VAT_DEK.KOR_RODZ='2'
            || _spr:=__CHK.record(VAT_DEK,,'OPISKOR')
            ?}
         ?}
      ?}
   || {? (SKID.DEKL_NAZ='PIT4R' | SKID.DEKL_NAZ='PIT8AR') & VAT_DEK.NR().NR>=9
      ||  {? __Rok>=2019 & var_pres('KOR_RODZ',VAT_DEK)>0
          || VAT_DEK.KOR_RODZ:='1';
             VAT_DEK.memo_set('','OPISKOR');
             win_disp()
          ?}
      ?}
   ?}
?};
:: czyszczenie pól
{? _spr=''
|| {? VAT_DEK.KOR='N'
   || VAT_DEK.memo_set(,'OPISKOR')
   ?}
?};
_spr


\pit_wyd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula ustawiajaca raport w akcji Wydruk z tabeli VAT_DEK
::----------------------------------------------------------------------------------------------------------------------
{? pit_typ='PIT4R'
|| _vern:=VAT_DEK.NR().NR;
   _file:=
      {? _vern=1 || 'ppl_dek04r01'
      |? _vern=2 || 'ppl_dek04r02'
      |? _vern=3 || 'ppl_dek04r03'
      |? _vern=4 || 'ppl_dek04r04'
      |? _vern=5 || 'ppl_dek04r05'
      |? _vern=6 || 'ppl_dek04r06'
      |? _vern=7 || 'ppl_dek04r07'
      |? _vern=8 || 'ppl_dek04r08'
      |? _vern=9 || 'ppl_dek04r09'
      |? _vern=10 || 'ppl_dek04r10'
      |? _vern=11 || 'ppl_dek04r11'
      || _nrf:=VAT_DEK.NR().NRF;
         {? _nrf<>0 || 'ppl_dek04r'+$_nrf || '' ?}
      ?};
   {? _file<>''
   || {? _vern<4 | _vern>=6
      || rep_exec(_file)
      || exec('drukuj','edeklar','pit-4r',_file)
      ?}
   ?}
|? pit_typ='PIT8AR'
|| _vern:=VAT_DEK.NR().NR;
   _file:=
      {? _vern=1 | _vern=2 || 'ppl_dek8ar01'
      |? _vern=3 || 'ppl_dek8ar02'
      |? _vern=4 || 'ppl_dek8ar03'
      |? _vern=5 || 'ppl_dek8ar04'
      |? _vern=6 || 'ppl_dek8ar05'
      |? _vern=7 || 'ppl_dek8ar06'
      |? _vern=8 || 'ppl_dek8ar07'
      |? _vern=9 || 'ppl_dek8ar08'
      |? _vern=10 || 'ppl_dek8ar09'
      |? _vern=11 || 'ppl_dek8ar10'
      || _nrf:=VAT_DEK.NR().NRF;
         {? _nrf<>0 || 'ppl_dek8ar'+$_nrf || '' ?}
      ?};
   {? _file<>''
   || {? _vern<4 | _vern>=7
      || rep_exec(_file)
      || exec('drukuj','edeklar','pit-8ar',_file)
      ?}
   ?}
|? pit_typ='PIT11P' | pit_typ='PIT11Z'
|| _vern:=VAT_DEK.NR().NR;
   _file:=
      {? _vern=1 || 'ppl_dek1116'
      |? _vern=2 || 'ppl_dek1117'
      |? _vern=3 || 'ppl_dek1118'
      |? _vern=4 || 'ppl_dek1119'
      |? _vern=5 || 'ppl_dek1120'
      |? _vern=6 || 'ppl_dek1121'
      |? _vern=7 || 'ppl_dek1122'
      |? _vern=8 || 'ppl_dek1123'
      |? _vern=9 || 'ppl_dek1124'
      |? _vern=10 || 'ppl_dek1125'
      |? _vern=11 || 'ppl_dek1126'
      || _nrf:=VAT_DEK.NR().NRF;
         {? _nrf<>0 || 'ppl_dek11'+$_nrf || '' ?}
      ?};
   {? _file<>''
   || {? _vern<5 | _vern>=8
      || {? _vern>=8
         || exec('ask4File','podpis','png',1,0,'dek')
         ?};
         rep_exec(_file)
      || exec('drukuj','edeklar','pit-11',_file,1)
      ?}
   ?}
|? pit_typ='PIT40'
|| _vern:=VAT_DEK.NR().NR;
   _file:=
      {? _vern=2 || 'ppl_dek4016'
      |? _vern=3 || 'ppl_dek4017'
      |? _vern=4 || 'ppl_dek4019'
      |? _vern=5 || 'ppl_dek4020'
      |? _vern=6 || 'ppl_dek4022'
      || ''
      ?};
   {? _file<>''
   || {? _vern<4 | _vern>=6
      || {? _vern>=6
         || exec('ask4File','podpis','png',1,0,'dek')
         ?};
         rep_exec(_file)
      || exec('drukuj','edeklar','pit-40',_file,1)
      ?}

   ?}
|? pit_typ='PIT8CP' | pit_typ='PIT8CZ'
|| _vern:=VAT_DEK.NR().NR;
   _file:=
      {? _vern=6 || 'ppl_dek8c06'
      |? _vern=7 || 'ppl_dek8c07'
      |? _vern=8 || 'ppl_dek8c08'
      |? _vern=9 || 'ppl_dek8c09'
      |? _vern=10 || 'ppl_dek8c10'
      || _nrf:=VAT_DEK.NR().NRF;
         {? _nrf<>0 || 'ppl_dek8c'+$_nrf || '' ?}
      ?};
   {? _file<>''
   || {? _vern<6 | _vern>=8
      || rep_exec(_file)
      || exec('drukuj','edeklar','pit-8c',_file)
      ?}
   ?}
|? pit_typ='IFT1' | pit_typ='IFT1R'
|| _vern:=VAT_DEK.NR().NR;
   _file:=
      {? _vern=10 || 'ppl_dekift110'
      |? _vern=11 || 'ppl_dekift111'
      |? _vern=12 || 'ppl_dekift112'
      |? _vern=13 || 'ppl_dekift113'
      |? _vern=14 || 'ppl_dekift114'
      |? _vern=15 || 'ppl_dekift115'
      |? _vern=16 || 'ppl_dekift116'
      || ''
      ?};
   {? _file<>''
   || {? _vern<10 | _vern>=13
      || rep_exec(_file)
      || exec('drukuj','edeklar','ift-1',_file)
      ?}
   ?}
?}


\pit_addpoz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula dodaje rekordy w tabeli VAT_POZ
::
::----------------------------------------------------------------------------------------------------------------------
{? pit_typ='PIT4R'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=1
   || exec('obl_'+(-pit_typ)+'_'+$VAT_DEK.NR().NR,'pit');
      {? var_pres('__TAB')<100 || return(0) ?};
      {? __TAB.first
      || VAT_POZ.prefix; __TAB.prefix;
         _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
                    VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
                    VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
                    {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
                    || {! _ind:=1..6
                       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                          ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                          {? _d=6
                          || _poz:=($('VAT_POZ.P'+$_ind))();
                             {? _poz=95 | _poz=96 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                          ?};
                          {? _d=7
                          || _poz:=($('VAT_POZ.P'+$_ind))();
                             {? _poz=93 | _poz=94 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                          ?}
                       !}
                    ?}; VAT_POZ.add";

         _dod_zap('C. 1.1','Liczba podatników',18,0,0,'A');
         _dod_zap('C. 1.2','Liczba podatników',30,0,6,'A');
         _dod_zap('C. 1.3','Należne zaliczki',24,1,0,'A');
         _dod_zap('C. 1.4','Należne zaliczki',36,1,6,'A');

         _dod_zap('C. 2.1','2. Zaliczki na podatek obliczone przez płatników, o których mowa',42,2,0,'R');
         _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',48,2,6,'R');

         _dod_zap('C. 3.1','3. Suma należnych zaliczek za poszczególne miesiące roku podatkowego',54,3,0,'S');
         _dod_zap('C. 3.2','wykazanych w wierszach 1 i 2',60,3,6,'S');

         _dod_zap('C. 4.1','4. Kwota zaliczek, których pobór',66,4,0,'R');
         _dod_zap('C. 4.2','został ograniczony art.32 ust.2',72,4,6,'R');

         _dod_zap('C. 5.1','5. Ograniczenie poboru zaliczek w',78,5,0,'R');
         _dod_zap('C. 5.2','poprzednich miesiącach art.32 ust.2',84,5,6,'R');

         _dod_zap('C. 6.1','6. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',90,6,0,'A');

         _dod_zap('C. 7.1','7. Nadpłaty wynikające z rozliczenia za rok ubiegły oraz zwrot nadpłat',92,7,0,'A');
         _dod_zap('C. 7.2','w gotówce zaliczone na poczet należnej zaliczki',98,7,6,'A');

         _dod_zap('C. 8.1','8. Pobrany podatek, przekazany na PFRON',104,8,0,'R');
         _dod_zap('C. 8.2','oraz zak. fun. rehab. osób niepełnos.',110,8,6,'R');

         _dod_zap('C. 9.1','9. Zaliczki pobrane od należności',116,9,0,'R');
         _dod_zap('C. 9.2','wynikającej z umowy aktywizacyjnej',122,9,6,'R');

         _dod_zap('C.10.1','10. Zaliczki pobr. od świadczeń z tyt.',128,10,0,'R');
         _dod_zap('C.10.2','działal. okr. w art.13 pkt 2 i 4-9',134,10,6,'R');

         _dod_zap('C.11.1','11. Pobrany podatek do przekazania do urzędu skarbowego za',140,11,0,'S');
         _dod_zap('C.11.2','poszczególne miesiące roku podatkowego',146,11,6,'S');

         _dod_zap('C.12.1','12. Kwota z tytułu terminowego',152,12,0,'R');
         _dod_zap('C.12.2','wpłacania podatku',158,12,6,'R');

         _dod_zap('C.13.1','13. Kwoty do wpłaty',164,13,0,'S');
         _dod_zap('C.13.2','',170,13,6,'S')
      ?};
      {? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}
   |? _vern=2
   || exec('obl_'+(-pit_typ)+'_'+$VAT_DEK.NR().NR,'pit');
      {? var_pres('__TAB')<100 || return(0) ?};
      {? __TAB.first
      || VAT_POZ.prefix; __TAB.prefix;
         _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
                    VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
                    VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
                    {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
                    || {! _ind:=1..6
                       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                          ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                          {? _d=6
                          || _poz:=($('VAT_POZ.P'+$_ind))();
                             {? _poz=95 | _poz=96 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                          ?}
                       !}
                    ?}; VAT_POZ.add";

         _dod_zap('C. 1.1','Liczba podatników',18,0,0,'A');
         _dod_zap('C. 1.2','Liczba podatników',30,0,6,'A');
         _dod_zap('C. 1.3','Należne zaliczki',24,1,0,'A');
         _dod_zap('C. 1.4','Należne zaliczki',36,1,6,'A');

         _dod_zap('C. 2.1','2. Zaliczki na podatek obliczone przez płatników, o których mowa',42,2,0,'R');
         _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',48,2,6,'R');

         _dod_zap('C. 3.1','3. Suma należnych zaliczek za poszczególne miesiące roku podatkowego',54,3,0,'S');
         _dod_zap('C. 3.2','wykazanych w wierszach 1 i 2',60,3,6,'S');

         _dod_zap('C. 4.1','4. Zaliczki na podatek, których pobór został ograniczony',66,4,0,'R');
         _dod_zap('C. 4.2','na podstawie art.32 ust.2 ustawy',72,4,6,'R');

         _dod_zap('C. 5.1','5. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',78,5,0,'R');
         _dod_zap('C. 5.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',84,5,6,'R');

         _dod_zap('C. 6.1','6. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',90,6,0,'A');

         _dod_zap('C. 7.1','7. Nadpłaty wynikające z rozliczenia za rok ubiegły oraz zwrot nadpłat',94,7,0,'A');
         _dod_zap('C. 7.2','w gotówce zaliczone na poczet należnej zaliczki',100,7,6,'A');

         _dod_zap('C. 8.1','8. Pobrany podatek, przekazany na PFRON',106,8,0,'R');
         _dod_zap('C. 8.2','oraz zak. fun. rehab. osób niepełnos.',112,8,6,'R');

         _dod_zap('C. 9.1','9. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',118,9,0,'R');
         _dod_zap('C. 9.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy 4)',124,9,6,'R');

         _dod_zap('C.10.1','10. Zaliczki na podatek pobrane od innych należności,',130,10,0,'R');
         _dod_zap('C.10.2','w tym wynikających z umowy aktywizacyjnej 4)',136,10,6,'R');

         _dod_zap('C.11.1','11. Pobrany podatek do przekazania do urzędu skarbowego za',142,11,0,'S');
         _dod_zap('C.11.2','poszczególne miesiące roku podatkowego',148,11,6,'S');

         _dod_zap('C.12.1','12. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',154,12,0,'R');
         _dod_zap('C.12.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',160,12,6,'R');

         _dod_zap('C.13.1','13. Należne kwoty do wpłaty za poszczególne miesiące roku podatkowego',166,13,0,'S');
         _dod_zap('C.13.2','',172,13,6,'S')
      ?};
      {? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}
   |? _vern=3
   || exec('obl_'+(-pit_typ)+'_'+$VAT_DEK.NR().NR,'pit');
      {? var_pres('__TAB')<100 || return(0) ?};
      {? __TAB.first
      || VAT_POZ.prefix; __TAB.prefix;
         _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
                    VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
                    VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
                    {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
                    || {! _ind:=1..6
                       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                          ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                          {? _d=6
                          || _poz:=($('VAT_POZ.P'+$_ind))();
                             {? _poz=95 | _poz=96 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                          ?}
                       !}
                    ?}; VAT_POZ.add";

         _dod_zap('C. 1.1','Liczba podatników',18,0,0,'A');
         _dod_zap('C. 1.2','Liczba podatników',30,0,6,'A');
         _dod_zap('C. 1.3','Należne zaliczki',24,1,0,'A');
         _dod_zap('C. 1.4','Należne zaliczki',36,1,6,'A');

         _dod_zap('C. 2.1','2. Zaliczki na podatek obliczone przez płatników, o których mowa',42,2,0,'R');
         _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',48,2,6,'R');

         _dod_zap('C. 3.1','3. Suma należnych zaliczek za poszczególne miesiące roku podatkowego',54,3,0,'S');
         _dod_zap('C. 3.2','wykazanych w wierszach 1 i 2',60,3,6,'S');

         _dod_zap('C. 4.1','4. Zaliczki na podatek, których pobór został ograniczony',66,4,0,'R');
         _dod_zap('C. 4.2','na podstawie art.32 ust.2 ustawy',72,4,6,'R');

         _dod_zap('C. 5.1','5. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',78,5,0,'R');
         _dod_zap('C. 5.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',84,5,6,'R');

         _dod_zap('C. 6.1','6. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',90,6,0,'A');

         _dod_zap('C. 7.1','7. Nadpłaty wynikające z rozliczenia za rok ubiegły oraz zwrot nadpłat',94,7,0,'A');
         _dod_zap('C. 7.2','w gotówce zaliczone na poczet należnej zaliczki',100,7,6,'A');

         _dod_zap('C. 8.1','8. Pobrany podatek, przekazany na PFRON',106,8,0,'R');
         _dod_zap('C. 8.2','oraz zak. fun. rehab. osób niepełnos.',112,8,6,'R');

         _dod_zap('C. 9.1','9. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',118,9,0,'R');
         _dod_zap('C. 9.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy 4)',124,9,6,'R');

         _dod_zap('C.10.1','10. Zaliczki na podatek pobrane od innych należności,',130,10,0,'R');
         _dod_zap('C.10.2','w tym wynikających z umowy aktywizacyjnej 4)',136,10,6,'R');

         _dod_zap('C.11.1','11. Pobrany podatek do przekazania do urzędu skarbowego za',142,11,0,'S');
         _dod_zap('C.11.2','poszczególne miesiące roku podatkowego',148,11,6,'S');

         _dod_zap('C.12.1','12. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',154,12,0,'R');
         _dod_zap('C.12.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',160,12,6,'R');

         _dod_zap('C.13.1','13. Kwoty do wpłaty',166,13,0,'S');
         _dod_zap('C.13.2','',172,13,6,'S')
      ?};
      {? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}
   |? _vern=4
   || exec('poz_pit4r_'+$_vern,'edeklar',_vern)
   |? _vern=5 | _vern=6
   || exec('poz_pit4r_5','edeklar',_vern)
   |? _vern=7
   || exec('poz_pit4r_7','edeklar',_vern)
   |? _vern=8
   || exec('poz_pit4r_8','edeklar',_vern)
   |? _vern=9
   || exec('poz_pit4r_9','edeklar',_vern)
   |? _vern=10 | _vern=11 | _vern=12
   || exec('poz_pit4r_10','edeklar',_vern)
   |? _vern=13
   || exec('poz_pit4r_13','edeklar',_vern)
   ?}
|? pit_typ='PIT8AR'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=1 | _vern=2 | _vern=3
   || _ver:={? _vern=1 | _vern=2 | _vern=3 || 1 || _vern ?};
      exec('obl_'+(-pit_typ)+'_'+$_ver,'pit');
      {? var_pres('__TAB')<100 || return(0) ?};
      {? __TAB.first
      || VAT_POZ.prefix; __TAB.prefix;
         _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
                    VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
                    VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
                    {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
                    || {! _ind:=1..6
                       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                          ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                       !}
                    ?}; VAT_POZ.add";

         _dod_zap('C. 2.1','2. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',30,2,0,'A');
         _dod_zap('C. 2.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',36,2,6,'A');
         _dod_zap('C. 5.1','5. Należności osób zagranicznych, wymienione w art.29 ustawy',66,5,0,'A');
         _dod_zap('C. 5.2','',72,5,6,'A');
         _dod_zap('C.13.1','13. Inne należności niewymienione w wierszach 1-12',162,13,0,'A');
         _dod_zap('C.13.2','',168,13,6,'A');
         _dod_zap('C.14.1','14. Suma pobranego zryczałtowanego podatku za poszczególne',174,14,0,'S');
         _dod_zap('C.14.2','    miesiące z wierszy 1-13',180,14,6,'S');
         _dod_zap('C.15.1','15. Kwota potr. wyn. z tyt. terminowego ',186,15,0,'R');
         _dod_zap('C.15.2','    wpłacenia podatku dochodowego',192,15,6,'R');
         _dod_zap('C.16.1','16. Kwoty do wpłaty ',198,16,0,'S');
         _dod_zap('C.16.2','    Od kwot za poszczególne miesiące z wiersza 14 należy odpowiednio odjąć kwoty z wiersza 15 ',204,16,6,'S')
      ?};
      {? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}
   |? _vern=4
   || exec('poz_pit8ar_'+$_vern,'edeklar',_vern)
   |? _vern=5
   || exec('poz_pit8ar_'+$_vern,'edeklar',_vern)
   |? _vern=6 | _vern=7
   || exec('poz_pit8ar_6','edeklar',_vern)
   |? _vern=8
   || exec('poz_pit8ar_'+$_vern,'edeklar',_vern)
   |? _vern=9
   || exec('poz_pit8ar_'+$_vern,'edeklar',_vern)
   |? _vern=10 | _vern=11 | _vern=12
   || exec('poz_pit8ar_10','edeklar',_vern)
   |? _vern=13
   || exec('poz_pit8ar_'+$_vern,'edeklar',_vern)
   |? _vern=14
   || exec('poz_pit8ar_'+$_vern,'edeklar',_vern)
   ?}
|? pit_typ='PIT11P' | pit_typ='PIT11Z'
|| {? VAT_DEK.NR().NR=1
   || exec('obl_pit11p'+'_'+$VAT_DEK.NR().NR,'pit')
   ?}
?};
1


\pr_pit_p
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula Popraw przed dla okienek wert. tabeli VAT_POZ
::
::----------------------------------------------------------------------------------------------------------------------
{? exec('is_edek','xml',SKID.DEKL_NAZ)
|| FUN.emsg('Istnieją e-Deklaracje.\nModyfikowanie zabronione.'@); 0
|? VAT_POZ.TYP='S'
|| FUN.emsg('Wiersz będący podsumowaniem.\nModyfikacje zabronione.'@); 0
|? VAT_POZ.TYP='A'
|| FUN.ask('Wiersz wyliczany automatycznie na podstawie danych z systemu.'@+
            '\n'+'Kontynuować?'@)
|| 1
?}


\po_pit_p
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula Popraw po dla okienek wert. tabeli VAT_POZ
::----------------------------------------------------------------------------------------------------------------------
_vern:=VAT_DEK.NR().NR;
{? pit_typ='PIT4R'
|| {? _vern>=1 & _vern<=6
   || exec('oblpit4r1','edeklar')
   |? _vern=7
   || exec('oblpit4r7','edeklar')
   |? _vern>=8 & _vern<=9
   || exec('oblpit4r8','edeklar')
   |? _vern>=10 & _vern<=12
   || exec('oblpit4r10','edeklar')
   |? _vern>=13
   || exec('oblpit4r13','edeklar')
   ?}
|? pit_typ='PIT8AR'
|| {? _vern>=1 & _vern<=5
   || exec('oblpit8ar1','edeklar')
   |? _vern=6 | _vern=7
   || exec('oblpit8ar6','edeklar')
   |? _vern=8 | _vern=9
   || exec('oblpit8ar8','edeklar')
   |? _vern>=10 & _vern<=12
   || exec('oblpit8ar10','edeklar')
   |? _vern=13
   || exec('oblpit8ar13','edeklar')
   |? _vern>=14
   || exec('oblpit8ar14','edeklar')
   ?}
?};
1


\oblpit4r1
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw
::       dla deklaracji PIT 4R
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh;
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh; VAT_POZ.prefix;
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put
       ?}; VAT_POZ.cntx_pop";

_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,1);
{? VAT_POZ.first
|| {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,3,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,2);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,3,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,3);
{? VAT_POZ.first
|| {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,5);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,6);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,9);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,10);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,4);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,7);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,8);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,11);
{? VAT_POZ.first
|| {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !}; VAT_POZ.put;
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,13,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,12);
{? VAT_POZ.first
|| _czyblank+=1;
   {! |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,13,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,13);
{? VAT_POZ.first
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put; VAT_POZ.next
   !}
?};
VAT_POZ.cntx_pop


\oblpit8ar1
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw
::       dla deklaracji PIT 8AR
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh;
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh; VAT_POZ.prefix;
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put
       ?}; VAT_POZ.cntx_pop";

_czyblank:=0;
{! _ix:=1..13
|! VAT_POZ.prefix(VAT_DEK.ref,_ix);
   {? VAT_POZ.first
   || {!
      |? {? _ix>1 || _czyblank+=1 ?};
         _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,14,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
      !}
   ?}
!};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,14);
{? VAT_POZ.first
|| {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,16,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,15);
{? VAT_POZ.first
|| {! |? _czyblank+=1;
         _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,16,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,16);
{? VAT_POZ.first
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put; VAT_POZ.next
   !}
?};
VAT_POZ.cntx_pop


\pozrekpr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula na Rekord przed tabeli VAT_POZ
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::----------------------------------------------------------------------------------------------------------------------
{! _ind:=1..6 |! ($('EDIT_VAR.P'+$_ind))():=($('VAT_POZ.P'+$_ind))() !}; ''


\pw_p16
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula Przed wyswietl. dla pol VAT_POZ.K1..K6 oraz VAT_POZ.P1..P6
::   WE: _a - numer pola 1..6
::       _b - string K lub P oznaczenie dla pola wartosci lub numeru poz.
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0) || return('') ?};
{? var_pres('_b')<>type_of('') || return('') ?};
{? pit_typ='PIT4R'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=1
   || {? (VAT_POZ.NR=6 & (_a=5 | _a=6)) | (VAT_POZ.NR=7 & VAT_POZ.NRK=0 & (_a=1 | _a=2))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            |? _a=5 || 'VAT_POZ#01#05'
            |? _a=6 || 'VAT_POZ#01#06'
            || ''
            ?}
         |? _b='K'
         || {? _a=1 || 'VAT_POZKW#01#01'
            |? _a=2 || 'VAT_POZKW#01#02'
            |? _a=3 || 'VAT_POZKW#01#03'
            |? _a=4 || 'VAT_POZKW#01#04'
            |? _a=5 || 'VAT_POZKW#01#05'
            |? _a=6 || 'VAT_POZKW#01#06'
            || ''
            ?}
         || ''
         ?}
      || ''
      ?}
   |? _vern=2 | _vern=3 | _vern=4 | _vern=5 | _vern=6
   || {? VAT_POZ.NR=6 & (_a=5 | _a=6)
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            |? _a=5 || 'VAT_POZ#01#05'
            |? _a=6 || 'VAT_POZ#01#06'
            || ''
            ?}
         |? _b='K'
         || {? _a=1 || 'VAT_POZKW#01#01'
            |? _a=2 || 'VAT_POZKW#01#02'
            |? _a=3 || 'VAT_POZKW#01#03'
            |? _a=4 || 'VAT_POZKW#01#04'
            |? _a=5 || 'VAT_POZKW#01#05'
            |? _a=6 || 'VAT_POZKW#01#06'
            || ''
            ?}
         || ''
         ?}
      || ''
      ?}
   |? _vern=8 | _vern=9 | _vern=10 | _vern=11 | _vern=12 | _vern=13
   || {? VAT_POZ.NR=8 & (_a=5 | _a=6)
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            |? _a=5 || 'VAT_POZ#01#05'
            |? _a=6 || 'VAT_POZ#01#06'
            || ''
            ?}
         |? _b='K'
         || {? _a=1 || 'VAT_POZKW#01#01'
            |? _a=2 || 'VAT_POZKW#01#02'
            |? _a=3 || 'VAT_POZKW#01#03'
            |? _a=4 || 'VAT_POZKW#01#04'
            |? _a=5 || 'VAT_POZKW#01#05'
            |? _a=6 || 'VAT_POZKW#01#06'
            || ''
            ?}
         || ''
         ?}
      || ''
      ?}
   || ''
   ?}
|? pit_typ='PIT11P' | pit_typ='PIT11Z'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=2 | _vern=3 | _vern=4
   || {? ((VAT_POZ.NR=2 | VAT_POZ.NR=3 | VAT_POZ.NR=4 | VAT_POZ.NR=5 | VAT_POZ.NR=10) & _a=2)
         | ((VAT_POZ.NR=11 | VAT_POZ.NR=12) & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   |? _vern=5 | _vern=6 | _vern=7 | _vern=8
   || {? ((VAT_POZ.NR=2 | VAT_POZ.NR=3 | VAT_POZ.NR=4 | VAT_POZ.NR=5 | VAT_POZ.NR=10) & _a=2)
         | ((VAT_POZ.NR=11 | VAT_POZ.NR=12) & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | ((VAT_POZ.NR=13 | VAT_POZ.NR=14) & (_a=2 | _a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   |? _vern=9
   || {? ((VAT_POZ.NR=2 | VAT_POZ.NR=3 | VAT_POZ.NR=4 | VAT_POZ.NR=5 | VAT_POZ.NR=10) & _a=2)
         | ((VAT_POZ.NR=11 | VAT_POZ.NR=12) & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=13 & (_a=2 | _a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   |? _vern=10 | _vern=11
   || {? (VAT_POZ.NR=3 & _a=2)
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=7 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=7 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=9 & (_a=2 | _a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   |? _vern=12
   || {? (VAT_POZ.NR=3 & _a=2)
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=7 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=7 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=9 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=11 & (_a=2 | _a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   |? _vern=13
   || {? (VAT_POZ.NR=4 & _a=2)
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=9 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=9 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=4 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=11 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=12 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=13 & (_a=2 | _a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   |? _vern=14
   || {? (VAT_POZ.NR=4 & _a=2)
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=9 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=9 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=4 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=11 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=12 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=13 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=14 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=15 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=16 & (_a=2 | _a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   ?}
|? pit_typ='PIT40'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=2 | _vern=3
   || {? ((VAT_POZ.NR=2 | VAT_POZ.NR=3 | VAT_POZ.NR=4) & _a=2)
         | ((VAT_POZ.NR>=9) & (_a=1 | _a=2 | _a=3)) | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   |? _vern=4 | _vern=5 | _vern=6
   || {? ((VAT_POZ.NR=2 | VAT_POZ.NR=3 | VAT_POZ.NR=4) & _a=2)
         | ((VAT_POZ.NR>=9) & (_a=1 | _a=2 | _a=3)) | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=6 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=6 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
      || {? _b='P'
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            || ''
            ?}
        ?}
      ?}
   ?}
|? pit_typ='PIT8CP' | pit_typ='PIT8CZ'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern>=9
   || {? (VAT_POZ.NR=7 & (_a=1 | _a=2 | _a=3))
          | ((VAT_POZ.NR>=1 & VAT_POZ.NR<=5) & ( _a=3 | _a=4))
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            ?}
         || ''
      ?}
   || {? (((VAT_POZ.NR>=1 & VAT_POZ.NR<=4) | VAT_POZ.NR=12 ) & (_a=1 | _a=2 | _a=3))
          | ((VAT_POZ.NR>=6 & VAT_POZ.NR<=10) & ( _a=3 | _a=4))
         || {? _a=1 || 'VAT_POZ#01#01'
            |? _a=2 || 'VAT_POZ#01#02'
            |? _a=3 || 'VAT_POZ#01#03'
            |? _a=4 || 'VAT_POZ#01#04'
            ?}
         || ''
      ?}
   ?}
|| ''
?}


\be_edit16
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2008]
:: OPIS: Formula przed redakcja pol VAT_POZ.K1..K6
::   WE: _a - numer pola 1..6
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0) || return('1') ?};
{? pit_typ='PIT4R'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=1
   || {? VAT_POZ.NR=6 & (_a=5 | _a=6)
      || 0
      |? VAT_POZ.NR=7 & VAT_POZ.NRK=0 & (_a=1 | _a=2)
      || 0
      || 1
      ?}
   |? _vern=2 | _vern=3 | _vern=4 | _vern=5 | _vern=6
   || {? VAT_POZ.NR=6 & (_a=5 | _a=6)
      || 0
      || 1
      ?}
   |? _vern=9 | _vern=12 | _vern=13
   || {? VAT_POZ.NR=8 & (_a=5 | _a=6)
      || 0
      || 1
      ?}
   || 1
   ?}
|| 1
?}


\inipit11_select
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula przygotowujaca system do wyswietlenia okna deklaracji PIT-11 dla pracownika lub zleceniobiorcy
::   WE: _a  [STRING]   - oznaczenie rodzaju deklaracji np. 'PIT11P'
::      [_b] [integer]  - rok dla deklaracji
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || '' ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0  ?};

{? _pitTyp='' || return(0) ?};

_wynik:=0;
_TPAR:=exec('tab_rok','edeklar','Deklaracje'@);
_TPAR.ROK:={? _rok || _rok || date()~1 ?};
params_set('TPAR',_TPAR);

{? _rok=0
|| _okedit:=_TPAR.edit("_par:=params_get(); _TPAR:=_par.TPAR;
               {? _TPAR.ROK>=2007
               || 1
               || FUN.emsg('E-deklaracje są dostępne tylko od 2007 roku.'@);
                  return('ROK')
               ?}")
|| _TPAR.ROK:=_rok;
   _okedit:=1
?};

{? _okedit
|| {? _TPAR.ROK=2008
   || datapoc:=date(_TPAR.ROK,7,1);
      datakon:=date(_TPAR.ROK,12,0)
   |? _TPAR.ROK=2013
   || datapoc:=date(_TPAR.ROK,10,11);
      datakon:=date(_TPAR.ROK,12,0)
   |? _TPAR.ROK=2014
   || {? date>=date(2015,1,1)
      || datapoc:=date(_TPAR.ROK,12,8);
         datakon:=date(_TPAR.ROK,12,0)
      || datapoc:=date(_TPAR.ROK,1,1);
         datakon:=date(_TPAR.ROK,12,0)
      ?}
   || datapoc:=date(_TPAR.ROK,1,1);
      datakon:=date(_TPAR.ROK,12,0)
   ?};
   okres:=$_TPAR.ROK;
   pit_typ:=_pitTyp;
   {? _pitTyp='PIT11P'
   || rodzdekl:='T'
   || rodzdekl:='I'
   ?};
   SKID.DEKL_NAZ:='PIT11';
   __Rok:=_TPAR.ROK;
:: Dla danych za rok 2011 tworzonych w 2012 roku i danych 2012 ustalamy wersja 4 e-deklaracji
:: Dla danych za rok 2014 tworzonych w 2014 roku ustalamy 5 wersje
:: Dla danych za rok 2014 tworzonych w 2015 roku ustalamy 6 wersje
   __datver:={? __Rok=2011 & date>=date(2012,1,1)
             || date(2012,12,0)
             |? __Rok=2012
             || date(2012,12,0)
             |? __Rok=2013
             || date(2013,12,0)
             |? __Rok=2014
             || {? date>=date(2015,1,1) || date(2014,12,0) || date(2013,12,0) ?}
             |? __Rok=2015
             || {? date>=date(2016,1,1) || date(2016,12,0) || date(2015,12,0) ?}
             |? __Rok>=2016 & __Rok<=2017
             || date(2016,12,0)
             |? __Rok=2018
             || {? date>=date(2019,1,1) || date(2018,1,1) || date(2016,12,0) ?}
:: Dla danych za rok 2020 ustalamy 10 wersje
             |? __Rok=2020
             || {? date>=date(2020,11,18) || date(2020,11,13) || date(2019,1,1) ?}
:: Dla danych za rok 2021 ustalamy 12 wersje
             |? __Rok=2021
             || {? date>=date(2021,3,4) || date(2021,3,4) || date(2020,11,13) ?}
:: Dla danych za rok 2022 ustalamy 14 wersje
             |? __Rok=2022 | __Rok=2023
             || {? date>=date(2022,11,9) || date(2022,11,9) || date(2022,1,1) ?}
             || date(_TPAR.ROK,1,1)
             ?};
   rok_dekp:=date(0,0,0);
   _wynik:=1
?};
_wynik


\end_inipit11
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula zwiazana z funkcja \inipit11_select usuwajaca zmienne tworzone w tej funkcji
::----------------------------------------------------------------------------------------------------------------------
undefine();
VAR_DEL.delete('datapoc','datakon','okres','rodzdekl','__Rok','pit_typ','rok_dekp','__datver')


\pit11_dod
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula dla akcji Dolacz okna deklaracji PIT-11 dla pracownika lub zleceniobiorcy
::   WE: _a - opcjonalny 1 Dolacz w grupie, 0 zwykla akcja Dolacz
::----------------------------------------------------------------------------------------------------------------------
_grupa:={? var_pres('_a')=type_of(0) & _a || _a || 0 ?};
EDIT_VAR.NR_EDIT:=1;
_dalej:=1;

P.cntx_psh();
{? _grupa
||
:: wybranie pracowników do dalszego przetwarzania
   _args:=exec('wybierz_args','pracownik');
   _args.WIELU:=0;
   _args.DOMAIN:='PPL';
   _args.UD_SCH:=UD_DEF.UD_SCH;
   _args.UD_SKL:=UD_DEF.UD_SKL;
   _args.F_ZATR:=P_FILTER.F_ZATR().KOD;
   _args.VIEW:=P_FILTER.STATUS;
   _args.SQL_FROM:='';
   _args.HDR_SEL:={? P_FILTER.F_ZATR().KOD='P' || 'Wybór pracowników'@ || 'Wybór zleceniobiorców'@ ?};

   _wyb:=exec('wybierz','pracownik',_args);

   {? _wyb.STATUS<>''
   || FUN.info(_wyb.STATUS)
   ?};

   {? _wyb.P.SQL<>''
   || P.prefix();
      {? P.seek(_wyb.P.SQL)
      || P.OSOBA()
      || _dalej:=0
      ?}
   || _dalej:=0
   ?};
   EDIT_VAR.NR_EDIT:=0
?};
{? _dalej & P.F_ZATR().KOD<>'P' & P.F_ZATR().KOD<>'Z'
|| FUN.emsg('Deklaracja PIT-11 dostępna jest tylko dla pracowników i zleceniobiorców.'@);
   _dalej:=0
?};
{? ~_dalej
|| P.cntx_pop();
   return(0)
?};
{? ~exec('symbol_edek','edeklar',date(__Rok,12,0))
|| FUN.emsg('Symbol urzędu dla e-Deklaracji nie jest wypełniony.'@
           +'\nDodanie deklaracji %1 nie jest możliwe.'@[SKID.DEKL_NAZ]
           +'\nUzupełnij brakujące informacje w kartotece Urzędy skarbowe.'@);
   P.cntx_pop();
   return(0)
?};
::Zmiana 2015 rok 70 znakow
_tab_err:=tab_tmp(1,'EL','STRING[70]','Element');
{? ~exec('spr_wymagane','edeklar',pit_typ,__Rok,_tab_err)
|| _textb:=exec('text_err','edeklar',_tab_err);
   _kto:={? pit_typ='PIT11P' || P.T || '' ?}+' '+OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE;
   FUN.emsg('%1\nDodanie deklaracji %2 nie jest możliwe.\nBrak wypełnionych wymaganych danych: \n%3.'@
            [_kto,SKID.DEKL_NAZ,_textb]);
   P.cntx_pop();
   return(0)
?};
{? pit_typ='PIT11P'
|| {? __Rok>=2019 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('PIT11P19')
   || VAT_DEK.win_edit('PIT11P')
   ?};
   VAT_DEK.hdr_edit();
   VAT_DEK.hdr_edit(': '+P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE);
   VAT_DEK.fld_fml('PODATNIK','AFTER_EDIT',
      "{? VAT_DEK.PODATNIK='N'
       || VAT_DEK.PODATUZ:='N';
          win_disp
       || 1
       ?};
       _we:=VAT_DEK.win_edit('?');
       exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,_we)
       "
   )
|| {? __Rok>=2019 & var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.win_edit('PIT11Z19')
   || VAT_DEK.win_edit('PIT11Z')
   ?};
   VAT_DEK.hdr_edit();
   VAT_DEK.hdr_edit(': '+P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE)
?};
VAT_DEK.blank();
::ustawienie * do pola Numer wersji
VAT_DEK.efld_opt(VAT_DEK.win_edit('?'),'mark=%1'[$EDIT_VAR.NR_EDIT],VAT_DEK,'NR');
{? _grupa || VAT_DEK.PIT_GRUP:=PIT_GRUP.ref ?};
VAT_DEK.P:=P.ref;
VAT_DEK.ROK:=null();
VAT_DEK.RODZAJ:=rodzdekl;
VAT_DEK.TYP:=pit_typ;
VAT_DEK.OKRES:=okres;
VAT_DEK.OPIS:='Deklaracja '+SKID.DEKL_NAZ;
_u:=userdata;
VAT_DEK.IMIE:=~-{? _im:=_u*' ' || (_im-1)+_u || _u ?};
VAT_DEK.NAZ:=~-{? _im || _im-_u || '' ?};
VAT_DEK.STN:=exec('stanowisko','edeklar');
VAT_DEK.DATA:=date;
_ver:=1;
VAT_DEK.cntx_psh;
VAT_DEK.index('VAT_PRAC');
VAT_DEK.prefix(P.ref,rodzdekl,rok_dekp,okres,pit_typ);
{? VAT_DEK.last || _ver:=VAT_DEK.WER+1 ?};
VAT_DEK.cntx_pop;
VAT_DEK.WER:=_ver;

_refnr:=null;
{? _grupa
|| _refnr:=PIT_GRUP.NR
|| VAT_VER.index('VER_OD');
   VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ);
   {? VAT_VER.find_le(__datver)
   || {? __datver~1=VAT_VER.OD~1
      || _refnr:=VAT_VER.ref
      ?}
   ?}
?};
VAT_DEK.NR:=_refnr;
{? __Rok>=2022 || VAT_DEK.PODATNIK:='T' ?};
VAT_DEK.memo_set(,'OPISKOR');

exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,VAT_DEK.win_edit('?'));

{? VAT_DEK.edit("exec('pit_rec11','edeklar')")
|| exec('stanowisko','edeklar','set',VAT_DEK.STN);
   _vern:=VAT_DEK.NR().NR;
   {? pit_typ='PIT11P' & {? _vern>=10 || 0 || VAT_DEK.PIT12='N' & exec('pit12_get','osoba',P.OSOBA,__Rok).JEST>1 ?}
   || FUN.emsg('Podatnik złożył oświadczenie PIT-12 za rok %1.\nDeklaracja PIT-11 nie została utworzona.'@[$__Rok])
   |? _vern=1 | _vern=2 | _vern=3 | _vern=4 | _vern=5 | _vern=6 | _vern=7  | _vern=8 | _vern=9 | _vern=10
      | _vern=11 | _vern=12 | _vern=13 | _vern=14
   || {? _vern=3 | _vern=4
      || exec('init_pit11p_3','pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.PODATNIK,VAT_DEK.PODATUZ,
              VAT_DEK.PITR,VAT_DEK.KOR,VAT_DEK.GIODO,VAT_DEK.GIODODAT,VAT_DEK.WER_KU,_vern);
         _dane:=exec('obl_pit11p_3','pit',,_vern)
      |? _vern=7 | _vern=8
      || exec('init_pit11p_7','pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.PODATNIK,VAT_DEK.PODATUZ,
              VAT_DEK.PITR,VAT_DEK.KOR,VAT_DEK.GIODO,VAT_DEK.GIODODAT,VAT_DEK.WER_KU,_vern);
         _dane:=exec('obl_pit11p_7','pit',,7)
      |? _vern=10 | _vern=11
      || exec('init_pit11p_10','pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.PODATNIK,VAT_DEK.PODATUZ,
              VAT_DEK.PITR,VAT_DEK.KOR,VAT_DEK.GIODO,VAT_DEK.GIODODAT,VAT_DEK.WER_KU,_vern);
         _dane:=exec('obl_pit11p_10','pit',,_vern)
      ||
::       Od PIT-11 za 2022 rok 13 wersja e-deklaracji zmiana pliku pit.fml -> pit1.fml
         _fml:={? _vern>=13 || 'pit1' || 'pit' ?};
         exec('init_pit11p_'+$_vern,_fml,pit_typ,VAT_DEK.TWORZ,VAT_DEK.PODATNIK,VAT_DEK.PODATUZ,
            VAT_DEK.PITR,VAT_DEK.KOR,VAT_DEK.GIODO,VAT_DEK.GIODODAT,VAT_DEK.WER_KU,_vern);
         _dane:=exec('obl_pit11p'+'_'+$_vern,_fml)
      ?};
      {? _dane>0
      || VAT_DEK.US:=us_podat;
         {? _vern<=2
         || VAT_DEK.OD:=pit[4]; VAT_DEK.DO:=pit[5];
            VAT_DEK.NIP:=pit[20]; VAT_DEK.NAZWISKO:=pit[21]; VAT_DEK.PIERWSZE:=pit[22];
            VAT_DEK.DATA_UR:=pit[23]; VAT_DEK.PESEL:=pit[24];
            VAT_DEK.WOJEWODZ:=pit[26]; VAT_DEK.POWIAT:=pit[27];
            VAT_DEK.GMINA:=pit[28]; VAT_DEK.ULICA:=pit[29]; VAT_DEK.DOM:=pit[30];
            VAT_DEK.LOKAL:=pit[31]; VAT_DEK.MIASTO:=pit[32]; VAT_DEK.KOD:=pit[33]; VAT_DEK.POCZTA:=pit[34];
            VAT_DEK.PKU:={? pit[3][2]='P' || $pit[35] || '' ?}
         |? _vern=3
         || VAT_DEK.NIP:=pit[19]; VAT_DEK.NAZWISKO:=pit[20]; VAT_DEK.PIERWSZE:=pit[21];
            VAT_DEK.DATA_UR:=pit[22]; VAT_DEK.PESEL:=pit[23];
            VAT_DEK.WOJEWODZ:=pit[25]; VAT_DEK.POWIAT:=pit[26];
            VAT_DEK.GMINA:=pit[27]; VAT_DEK.ULICA:=pit[28]; VAT_DEK.DOM:=pit[29];
            VAT_DEK.LOKAL:=pit[30]; VAT_DEK.MIASTO:=pit[31]; VAT_DEK.KOD:=pit[32]; VAT_DEK.POCZTA:=pit[33];
            VAT_DEK.PKU:={? pit[3][2]='P' || $pit[34] || '' ?}
         |? _vern=4
         || P.OSOBA().NAZWISKO;
            {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
            || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
            || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
            ?};
            VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
            VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
            VAT_DEK.KRAJ:={? type_of(pit[24])=type_of(null) || pit[24] || null ?};
            VAT_DEK.WOJEWODZ:=pit[25]; VAT_DEK.POWIAT:=pit[26];
            VAT_DEK.GMINA:=pit[27]; VAT_DEK.ULICA:=pit[28]; VAT_DEK.DOM:=pit[29];
            VAT_DEK.LOKAL:=pit[30]; VAT_DEK.MIASTO:=pit[31]; VAT_DEK.KOD:=pit[32]; VAT_DEK.POCZTA:=pit[33];
            VAT_DEK.PKU:={? pit[3][2]='P' || $pit[34] || '' ?}
         |? _vern=5 | _vern=6
         || P.OSOBA().NAZWISKO;
            {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
            || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
            || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
            ?};
            VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
            VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
            VAT_DEK.KRAJ:={? type_of(pit[14])=type_of(null) || pit[14] || null ?};
            VAT_DEK.WOJEWODZ:=pit[15]; VAT_DEK.POWIAT:=pit[16];
            VAT_DEK.GMINA:=pit[17]; VAT_DEK.ULICA:=pit[18]; VAT_DEK.DOM:=pit[19];
            VAT_DEK.LOKAL:=pit[20]; VAT_DEK.MIASTO:=pit[21]; VAT_DEK.KOD:=pit[22]; VAT_DEK.POCZTA:=pit[23];
            VAT_DEK.PKU:={? pit[3][2]='P' || $pit[24] || '' ?}
         |? _vern=7 | _vern=8 | _vern=9
         || P.OSOBA().NAZWISKO;
            {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
            || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
            || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
            ?};
::          Pole dodane w wersji 12.41 od wersji PIT-11(22)
            VAT_DEK.REZYDENT:=pit[10];
            VAT_DEK.ZNIP:=pit[12];
            VAT_DEK.RZNIP:={? var_pres('[13]',pit)=type_of(null) || pit[13] || null ?};
            VAT_DEK.KRAJZNIP:={? var_pres('[14]',pit)=type_of(null) || pit[14] || null ?};
            VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
            VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
            VAT_DEK.KRAJ:={? type_of(pit[18])=type_of(null) || pit[18] || null ?};
            VAT_DEK.WOJEWODZ:=pit[19]; VAT_DEK.POWIAT:=pit[20];
            VAT_DEK.GMINA:=pit[21]; VAT_DEK.ULICA:=pit[22]; VAT_DEK.DOM:=pit[23];
            VAT_DEK.LOKAL:=pit[24]; VAT_DEK.MIASTO:=pit[25]; VAT_DEK.KOD:=pit[26]; VAT_DEK.POCZTA:=pit[27];
            VAT_DEK.PKU:={? pit[3][2]='P' || $pit[28] || '' ?};
::          Ustawienie pola VAT_DEK.POD na podstawie pit[82] dla wersji 9 pit[93]
            VAT_DEK.POD:={? _vern<9 || pit[82] || pit[93] ?}
         |? _vern=10 | _vern=11 | _vern=12 | _vern=13 | _vern=14
         || P.OSOBA().NAZWISKO;
            {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
            || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
            || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
            ?};
::          Pole dodane w wersji 12.41 od wersji PIT-11(22)
            VAT_DEK.REZYDENT:=pit[11];
            VAT_DEK.ZNIP:=pit[13];
            VAT_DEK.RZNIP:={? var_pres('[14]',pit)=type_of(null) || pit[14] || null ?};
            VAT_DEK.KRAJZNIP:={? var_pres('[15]',pit)=type_of(null) || pit[15] || null ?};
            VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO;
            VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
            VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
            VAT_DEK.KRAJ:={? type_of(pit[19])=type_of(null) || pit[19] || null ?};
            VAT_DEK.WOJEWODZ:=pit[20]; VAT_DEK.POWIAT:=pit[21]; VAT_DEK.GMINA:=pit[22];
::          Ze względu na ograniczenie po stronie PITów, pole ulica może przyjmować maksymalnie 65 znaków
            VAT_DEK.ULICA:={? +pit[23]<=65 || pit[23] || STR.split(pit[23]); STR.line(65) ?};
            VAT_DEK.DOM:=pit[24]; VAT_DEK.LOKAL:=pit[25]; VAT_DEK.MIASTO:=pit[26]; VAT_DEK.KOD:=pit[27];
            VAT_DEK.PKU:={? pit[3][2]='P' || $pit[28] || '' ?};
::          Ustawienie pola VAT_DEK.POD na podstawie pit[93] dla wersji 9, pit[100] dla 12 wersji
::          Ustawienie pola VAT_DEK.POD na podstawie pit[114] dla wersji 13
::          Ustawienie pola VAT_DEK.POD na podstawie pit[127] dla wersji 14
            VAT_DEK.POD:=
              {? _vern=14 || pit[127] |? _vern=13 || pit[114] |? _vern=12 || pit[100] || pit[93] ?}
         ?};
         {? VAT_DEK.add
         || VAT_DEK.memo_put(,'OPISKOR');
            {? _grupa
            || {? VAT_DEK.f_active()>0 || VAT_DEK.f_rfresh() ?}
            ?};
            VAT_POZ.index('VAT_POZ');
            VAT_POZ.prefix(VAT_DEK.ref);
            {? _vern=3 | _vern=4
            || exec('poz_pit11p_3','edeklar')
            |? _vern=7 | _vern=8
            || exec('poz_pit11p_7','edeklar')
            |? _vern=10 | _vern=11
            || exec('poz_pit11p_10','edeklar')
            || exec('poz_pit11p_'+$_vern,'edeklar')
            ?};
::          ustalenie nowego pola DEKL_POD.VAT_DEK po dodaniu rekordu VAT_DEK
            exec('vatdek_dekl','edeklar',VAT_DEK.ref(),__Rok)
         ?}
      |? _dane<0
      || FUN.emsg('Deklaracja PIT-11 została już %1\n Nie dodano kolejnej deklaracji.'@
                  [{? _dane=-1 || 'wykonana.' || 'wydrukowana.' ?}])
      || FUN.emsg('Brak informacji do wykazania na deklaracji PIT-11\n (zerowe kwoty dochodu i podatku).'@)
      ?};
      {? _vern=9
      || exec('end_pit11p_9','pit')
      |? _vern=10 | _vern=11 | _vern=12
      || exec('end_pit11p_10','pit')
::Od PIT-11 za 2022 rok 13 wersja e-deklaracji zmiana pliku pit.fml -> pit1.fml
      |? _vern>=13
      || exec('end_pit11p_13','pit1')
      || exec('end_pit11p_1','pit')
      ?}
   ?}
?};
VAT_DEK.fld_fml('PODATNIK','AFTER_EDIT',"*");
P.cntx_pop()


\pit11_rekp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula na Rekord przed tabeli VAT_POZ okna deklaracji PIT-11
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::----------------------------------------------------------------------------------------------------------------------
{! _ind:=1..4 |! ($('EDIT_VAR.PW'+$_ind))():=($('VAT_POZ.P'+$_ind))() !}; ''


\poz_pit11p_1
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=12 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=79 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=12 & _ind>=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',35,1,0,'A',4);
_dod_zap('E. 6','6. Przychody z osobiście wykonywanej dział., o której mowa w art.13 pkt 2, 4, 6',53,6,0,'A',4);
_dod_zap('E. 8','8. Udział w organach stanowiących osób prawnych (art.13 pkt 7 ustawy)',61,8,0,'A',4);
_dod_zap('E.10','10. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',69,10,0,'A',4);
_dod_zap('E.12','12. Inne źródła',77,12,0,'A',4);

_dod_zap('F. 1','Składki na ubezpieczenia społeczne, o których mowa w przepisach ustawy',80,13,0,'A',1);
_dod_zap('F. 2','Składki na ubezpieczenie zdrowotne, o których mowa w przepisach ustawy',81,14,0,'A',1)


\poz_pit11p_2
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2010]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 dla 2 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=44 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=47 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=51 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=5 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=54 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=5 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=10 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=73 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=10 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=10 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',35,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',40,1,1,'A',2);
_dod_zap('E. 2.1','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',42,2,0,'A',4);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',45,3,0,'A',4);
_dod_zap('E. 4.1','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',49,4,0,'A',4);
_dod_zap('E. 5.1','5. Świadczenia wypłacone z Funduszów: Pracy i Gwarantowanych Świadczeń Pracowniczych',52,5,0,'A',4);
_dod_zap('E. 6.1','6. Przychody z osobiście wykonywanej dział., o której mowa w art.13 pkt 2, 4, 6 i 7-9',55,6,0,'A',4);
_dod_zap('E. 7.1','7. Czynności związane z pełnieniem obowiązków społecznych lub obywatelskich',59,7,0,'A',4);
_dod_zap('E. 8.1','8. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',63,8,0,'A',4);
_dod_zap('E. 9.11','9. Należności wynikające z umowy aktywizacyjnej',67,9,0,'A',4);
_dod_zap('E.10.1','10. Inne źródła',71,10,0,'A',4);

_dod_zap('F. 1','Składki na ubezpieczenia społeczne, o których mowa w przepisach ustawy',75,11,0,'A',1);
_dod_zap('F. 2','Składki na ubezpieczenie zdrowotne, o których mowa w przepisach ustawy',77,12,0,'A',1)


\poz_pit11p_3
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [11.22]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (18) dla 3 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=43 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=46 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=50 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=5 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=53 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=5 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=10 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=72 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=10 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=10 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',34,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.40 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',39,1,1,'A',2);
_dod_zap('E. 2.1','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',41,2,0,'A',4);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',44,3,0,'A',4);
_dod_zap('E. 4.1','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',48,4,0,'A',4);
_dod_zap('E. 5.1','5. Świadczenia wypłacone z Funduszów: Pracy i Gwarantowanych Świadczeń Pracown.',51,5,0,'A',4);
_dod_zap('E. 6.1','6. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4, 6 i 7-9',54,6,0,'A',4);
_dod_zap('E. 7.1','7. Czynności związane z pełnieniem obowiązków społecznych lub obywatelskich',58,7,0,'A',4);
_dod_zap('E. 8.1','8. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',62,8,0,'A',4);
_dod_zap('E. 9.11','9. Należności wynikające z umowy aktywizacyjnej',66,9,0,'A',4);
_dod_zap('E.10.1','10. Inne źródła',70,10,0,'A',4);

_dod_zap('F. 1','Składki na ubezpieczenia społeczne, o których mowa w przepisach ustawy',74,11,0,'A',1);
_dod_zap('F. 2','Składki na ubezpieczenie zdrowotne, o których mowa w przepisach ustawy',76,12,0,'A',1)


\pit11_grup
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula wyswietla grupy deklaracji podatkowych PIT-11
::   WE: _a  [STRING]  - oznaczenie rodzaju deklaracji np. 'PIT11P'
::       [_b] [INTEGER] - rok deklaracji podatkowej
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || return(~~) ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0          ?};

{? exec('inipit11_select','edeklar',_pitTyp,_rok)
|| USERS.cntx_psh();
   OGRANICZ.blank(1);
   SKID.TYP_ZAP:=SKID.DEKL_NAZ;
   PIT_GRUP.clear();
   PIT_GRUP.index('RODZAJP');
   EDIT_VAR.cntx_psh();
   EDIT_VAR.PIT_RODZ:=P_FILTER.F_ZATR().KOD;
   {? EDIT_VAR.PIT_RODZ='P'
   || _tytul:='Pracownicy'; EDIT_VAR.OBSZAR:='Pracownicy etatowi'
   || _tytul:='Zleceniobiorcy'; EDIT_VAR.OBSZAR:='Zleceniobiorcy'
   ?};
   PIT_GRUP.prefix(EDIT_VAR.PIT_RODZ,_rok);
   PIT_GRUP.win_sel('WER');
   PIT_GRUP.hdr_sel();
   PIT_GRUP.hdr_sel(': PIT-11 %1 z roku %2'@[_tytul,$_rok]);
   PIT_GRUP.select(,1,10);
   EDIT_VAR.cntx_pop();
   USERS.cntx_pop()
?}


\pitpozyc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula wyswietla deklaracje dla danej grupy
::----------------------------------------------------------------------------------------------------------------------
_ws:=
   {? EDIT_VAR.PIT_RODZ='D'
   || 'WERGR40'
   |? EDIT_VAR.PIT_RODZ='A' | EDIT_VAR.PIT_RODZ='B'
   || 'PIT8CGR'
   |? EDIT_VAR.PIT_RODZ='C'
   || 'PITIFTGR'
   || 'WERGR'
   ?};
VAT_DEK.win_sel(_ws);
VAT_DEK.clear();
VAT_DEK.f_set('PIT_GRUP,NAZWISKO,PIERWSZE,PESEL',,
   'VAT_DEK.PIT_GRUP=:_a AND VAT_DEK.P in (select distinct :_b.REF from :_b)',
   PIT_GRUP.ref(),exec('dostepne_p','schemat','PPL',P_FILTER.F_ZATR().KOD,'*'));
VAT_DEK.hdr_sel;
VAT_DEK.hdr_sel(': %1 z roku: %2'@[EDIT_VAR.OBSZAR,$__Rok]);

VAT_DEK.win_fml(_ws,,'NAZWISKO',,'ICON_BEFORE',"exec('x_zalacz_icon','zalacz')");

VAT_DEK.select(,1,10);
VAT_DEK.f_clear()


\dodawnie_pit
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula generuje deklaracje podatkowe dla danej grupy
::----------------------------------------------------------------------------------------------------------------------
{? ~FUN.ask('Czy na pewno rozpocząć proces tworzenia deklaracji PIT-11?'@) || return() ?};
_grpit:=0;
VAT_DEK.cntx_psh();
VAT_DEK.index('VAT_PITG');
VAT_DEK.prefix(PIT_GRUP.ref());
{? VAT_DEK.first() || _grpit:=1 ?};
VAT_DEK.cntx_pop();
{? _grpit & ~FUN.ask('Istnieją Deklaracje PIT-11 wygenerowane w wybranej grupie.\nCzy kontynuować?'@) || return() ?};
{? PIT_GRUP.RODZAJ='P'
|| {? var_pres('STN',PIT_EDIT)>0 & __Rok>=2019 & PIT_GRUP.NR().NR>=10
   || PIT_EDIT.win_edit('RED19')
   || PIT_EDIT.win_edit('RED')
   ?};
   PIT_EDIT.fld_fml('PODATNIK','AFTER_EDIT',
      "{? PIT_EDIT.PODATNIK='N'
       || PIT_EDIT.PODATUZ:='N';
          win_disp
       || 1
       ?};
       _we:=PIT_EDIT.win_edit('?');
       exec('vat_dek_efld_opt','edeklar','*',PIT_EDIT,_we)
       "
   )
|| {? var_pres('STN',PIT_EDIT)>0 & __Rok>=2019 & PIT_GRUP.NR().NR>=10
   || PIT_EDIT.win_edit('REDZ19')
   || PIT_EDIT.win_edit('REDZ')
   ?}
?};
PIT_EDIT.blank();
PIT_EDIT.ROK:=PIT_GRUP.ROK;
PIT_EDIT.TYP:=PIT_GRUP.TYP;
PIT_EDIT.NR:=PIT_GRUP.NR;
PIT_EDIT.DATA:=PIT_GRUP.DATA_UTW;
PIT_EDIT.OPIS:=PIT_GRUP.OPIS;
_usr:=userdata();
_imie:=~-{? _im:=_usr*' ' || (_im-1)+_usr || _usr ?};
_naz:=~-{? _im || _im-_usr || '' ?};
PIT_EDIT.IMIE:=_imie;
PIT_EDIT.NAZ:=_naz;
PIT_EDIT.STN:=exec('stanowisko','edeklar');
{? __Rok>=2022 || PIT_EDIT.PODATNIK:='T' ?};

exec('vat_dek_efld_opt','edeklar','*',PIT_EDIT,PIT_EDIT.win_edit('?'));

_ok:=PIT_EDIT.edit("exec('pit_edit_chck','edeklar')");
{? ~_ok || return() ?};
exec('stanowisko','edeklar','set',PIT_EDIT.STN);
PIT_EDIT.fld_fml('PODATNIK','AFTER_EDIT',"*");
_opiskor:={? PIT_EDIT.KOR='T' || PIT_EDIT.OPISKOR || '' ?};

:: wybranie pracowników do dalszego przetwarzania
_args:=exec('wybierz_args','pracownik');
_args.DOMAIN:='PPL';
_args.UD_SCH:=UD_DEF.UD_SCH;
_args.UD_SKL:=UD_DEF.UD_SKL;
_args.F_ZATR:=P_FILTER.F_ZATR().KOD;
_args.VIEW:='W';
_args.SQL_FROM:='';
_args.HDR_SEL:='Wybór pracowników'@;

_wyb:=exec('wybierz','pracownik',_args);
{? _wyb.STATUS<>''
|| FUN.info(_wyb.STATUS)
?};

_test:="1";
_tab:=_wyb.P;
OSOBA.cntx_psh();
P.cntx_psh();
P.prefix();
_tab.cntx_psh();
_prac_up:=obj_new('P','Ndx');
_prac_up.P:=_wyb.P;
_prac_up.Ndx:=_prac_up.P.ndx_tmp(,1,'REF',,);

_ile:=0;
_bledy:=0;
_vern:=PIT_GRUP.NR().NR;
{? _tab.first()
|| {? _vern=3 | _vern=4
   || exec('init_pit11p_3','pit',PIT_GRUP.TYP,PIT_EDIT.TWORZ,PIT_EDIT.PODATNIK,
           PIT_EDIT.PODATUZ,PIT_EDIT.PITR,PIT_EDIT.KOR,PIT_EDIT.GIODO,PIT_EDIT.GIODODAT,PIT_EDIT.WER_KU,_vern)
   |? _vern=7 | _vern=8
   || exec('init_pit11p_7','pit',PIT_GRUP.TYP,PIT_EDIT.TWORZ,PIT_EDIT.PODATNIK,
           PIT_EDIT.PODATUZ,PIT_EDIT.PITR,PIT_EDIT.KOR,PIT_EDIT.GIODO,PIT_EDIT.GIODODAT,PIT_EDIT.WER_KU,_vern)
   |? _vern=10 | _vern=11
   || exec('init_pit11p_10','pit',PIT_GRUP.TYP,PIT_EDIT.TWORZ,PIT_EDIT.PODATNIK,
           PIT_EDIT.PODATUZ,PIT_EDIT.PITR,PIT_EDIT.KOR,PIT_EDIT.GIODO,PIT_EDIT.GIODODAT,PIT_EDIT.WER_KU,_vern)
   |? _vern>=13
   || exec('init_pit11p_'+$_vern,'pit1',PIT_GRUP.TYP,PIT_EDIT.TWORZ,PIT_EDIT.PODATNIK,
           PIT_EDIT.PODATUZ,PIT_EDIT.PITR,PIT_EDIT.KOR,PIT_EDIT.GIODO,PIT_EDIT.GIODODAT,PIT_EDIT.WER_KU,_vern)
   || exec('init_pit11p_'+$_vern,'pit',PIT_GRUP.TYP,PIT_EDIT.TWORZ,PIT_EDIT.PODATNIK,
           PIT_EDIT.PODATUZ,PIT_EDIT.PITR,PIT_EDIT.KOR,PIT_EDIT.GIODO,PIT_EDIT.GIODODAT,PIT_EDIT.WER_KU,_vern)
   ?};
   VAT_DEK.clear;
   RAPLS.ustaw(1);
:: Zmiana 2015 rok 70 znakow
   _tab_err:=tab_tmp(1,'EL','STRING[70]','Element'@);
   _licz:=0;
   _size:=_tab.size;
   _prgs:=100*_licz/_size;
   progress(_prgs,'Tworzenie deklaracji PIT-11.'@,'Proszę czekać...'@);
   {!
   |? {? P.seek(_tab.SQL)
      || P.OSOBA();
         _licz+=1;
         _prgs:=100*_licz/_size;
         progress(_prgs,'Tworzenie deklaracji PIT-11.'@,'Proszę czekać...'@);
         {? {? _vern>=10
            || _test()
            || _test() & (PIT_GRUP.RODZAJ<>'P' | PIT_EDIT.PIT12='T' | exec('pit12_get','osoba',P.OSOBA,__Rok).JEST<2)
            ?}
         || _symb:=exec('symbol_edek','edeklar',date(__Rok,12,0));
            _tab_err.erase;
            _wymdane:=exec('spr_wymagane','edeklar',pit_typ,__Rok,_tab_err);
            {? _vern=3 | _vern=4
            || _kw_dek:=exec('obl_pit11p_3','pit',_symb & _wymdane,_vern)
            |? _vern=7 | _vern=8
            || _kw_dek:=exec('obl_pit11p_7','pit',_symb & _wymdane,,1,_prac_up)
            |? _vern=10 | _vern=11
            || _kw_dek:=exec('obl_pit11p_10','pit',_symb & _wymdane,_vern,1,_prac_up)
            |? _vern>=13
            || _kw_dek:=exec('obl_pit11p'+'_'+$_vern,'pit1',_symb & _wymdane,,1,_prac_up)
            || _kw_dek:=exec('obl_pit11p'+'_'+$_vern,'pit',_symb & _wymdane,,1,_prac_up)
            ?};
            {? _kw_dek>0 & _symb & _wymdane
            || VAT_DEK.blank;
               VAT_DEK.memo_set(,'OPISKOR');
               VAT_DEK.ROK:=null();
               VAT_DEK.RODZAJ:=rodzdekl;
               VAT_DEK.TYP:=pit_typ;
               VAT_DEK.OKRES:=okres;
               VAT_DEK.OPIS:=PIT_EDIT.OPIS;
               VAT_DEK.IMIE:=PIT_EDIT.IMIE;
               VAT_DEK.NAZ:=PIT_EDIT.NAZ;
               VAT_DEK.STN:=PIT_EDIT.STN;
               {? var_pres('NR_INFOR',PIT_EDIT)>0 & var_pres('NR_INFOR',VAT_DEK)>0
               || VAT_DEK.NR_INFOR:=PIT_EDIT.NR_INFOR
               ?};
               VAT_DEK.DATA:=PIT_EDIT.DATA;
               VAT_DEK.TWORZ:=PIT_EDIT.TWORZ;
               VAT_DEK.PIT12:=PIT_EDIT.PIT12;
               VAT_DEK.PODATNIK:=PIT_EDIT.PODATNIK;
               VAT_DEK.PODATUZ:=PIT_EDIT.PODATUZ;
               VAT_DEK.PITR:=PIT_EDIT.PITR;
               VAT_DEK.KOR:=PIT_EDIT.KOR;
               VAT_DEK.GIODO:=PIT_EDIT.GIODO;
               VAT_DEK.GIODODAT:=PIT_EDIT.GIODODAT;
               VAT_DEK.WER_KU:=PIT_EDIT.WER_KU;
               _ver:=1;
               VAT_DEK.cntx_psh;
               VAT_DEK.index('VAT_PRAC');
               VAT_DEK.prefix(P.ref,rodzdekl,rok_dekp,okres,pit_typ);
               {? VAT_DEK.last || _ver:=VAT_DEK.WER+1 ?};
               VAT_DEK.cntx_pop;
               VAT_DEK.WER:=_ver;
               VAT_DEK.NR:=PIT_EDIT.NR;
               VAT_DEK.US:=us_podat;
               {? _vern<=2
               || VAT_DEK.OD:=pit[4]; VAT_DEK.DO:=pit[5];
                  VAT_DEK.NIP:=pit[20]; VAT_DEK.NAZWISKO:=pit[21]; VAT_DEK.PIERWSZE:=pit[22];
                  VAT_DEK.DATA_UR:=pit[23]; VAT_DEK.PESEL:=pit[24];
                  VAT_DEK.WOJEWODZ:=pit[26]; VAT_DEK.POWIAT:=pit[27];
                  VAT_DEK.GMINA:=pit[28]; VAT_DEK.ULICA:=pit[29]; VAT_DEK.DOM:=pit[30];
                  VAT_DEK.LOKAL:=pit[31]; VAT_DEK.MIASTO:=pit[32]; VAT_DEK.KOD:=pit[33]; VAT_DEK.POCZTA:=pit[34];
                  VAT_DEK.PKU:={? pit[3][2]='P' || $pit[35] || '' ?}
               |? _vern=3
               || VAT_DEK.NIP:=pit[19]; VAT_DEK.NAZWISKO:=pit[20]; VAT_DEK.PIERWSZE:=pit[21];
                  VAT_DEK.DATA_UR:=pit[22]; VAT_DEK.PESEL:=pit[23];
                  VAT_DEK.WOJEWODZ:=pit[25]; VAT_DEK.POWIAT:=pit[26];
                  VAT_DEK.GMINA:=pit[27]; VAT_DEK.ULICA:=pit[28]; VAT_DEK.DOM:=pit[29];
                  VAT_DEK.LOKAL:=pit[30]; VAT_DEK.MIASTO:=pit[31]; VAT_DEK.KOD:=pit[32]; VAT_DEK.POCZTA:=pit[33];
                  VAT_DEK.PKU:={? pit[3][2]='P' || $pit[34] || '' ?}
               |? _vern=4
               || P.OSOBA().NAZWISKO;
                  {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
                  || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
                  || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
                  ?};
                  VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
                  VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
                  VAT_DEK.KRAJ:={? type_of(pit[24])=type_of(null) || pit[24] || null ?};
                  VAT_DEK.WOJEWODZ:=pit[25]; VAT_DEK.POWIAT:=pit[26];
                  VAT_DEK.GMINA:=pit[27]; VAT_DEK.ULICA:=pit[28]; VAT_DEK.DOM:=pit[29];
                  VAT_DEK.LOKAL:=pit[30]; VAT_DEK.MIASTO:=pit[31]; VAT_DEK.KOD:=pit[32]; VAT_DEK.POCZTA:=pit[33];
                  VAT_DEK.PKU:={? pit[3][2]='P' || $pit[34] || '' ?}
               |? _vern=5 | _vern=6
               || P.OSOBA().NAZWISKO;
                  {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
                  || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
                  || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
                  ?};
                  VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
                  VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
                  VAT_DEK.KRAJ:={? type_of(pit[14])=type_of(null) || pit[14] || null ?};
                  VAT_DEK.WOJEWODZ:=pit[15]; VAT_DEK.POWIAT:=pit[16];
                  VAT_DEK.GMINA:=pit[17]; VAT_DEK.ULICA:=pit[18]; VAT_DEK.DOM:=pit[19];
                  VAT_DEK.LOKAL:=pit[20]; VAT_DEK.MIASTO:=pit[21]; VAT_DEK.KOD:=pit[22]; VAT_DEK.POCZTA:=pit[23];
                  VAT_DEK.PKU:={? pit[3][2]='P' || $pit[24] || '' ?}
               |? _vern=7 | _vern=8 | _vern=9
               || P.OSOBA().NAZWISKO;
                  {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
                  || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
                  || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
                  ?};
::             Pole dodane w wersji 12.41 od wersji PIT-11(22)
                  VAT_DEK.REZYDENT:=pit[10];
                  VAT_DEK.ZNIP:=pit[12];
                  VAT_DEK.RZNIP:={? var_pres('[13]',pit)=type_of(null) || pit[13] || null ?};
                  VAT_DEK.KRAJZNIP:={? var_pres('[14]',pit)=type_of(null) || pit[14] || null ?};
                  VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
                  VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
                  VAT_DEK.KRAJ:={? type_of(pit[18])=type_of(null) || pit[18] || null ?};
                  VAT_DEK.WOJEWODZ:=pit[19]; VAT_DEK.POWIAT:=pit[20];
                  VAT_DEK.GMINA:=pit[21]; VAT_DEK.ULICA:=pit[22]; VAT_DEK.DOM:=pit[23];
                  VAT_DEK.LOKAL:=pit[24]; VAT_DEK.MIASTO:=pit[25]; VAT_DEK.KOD:=pit[26]; VAT_DEK.POCZTA:=pit[27];
                  VAT_DEK.PKU:={? pit[3][2]='P' || $pit[28] || '' ?};
::             Ustawienie pola VAT_DEK.POD na podstawie pit[82] dla wersji 9 pit[93]
                  VAT_DEK.POD:={? _vern<9 || pit[82] || pit[93] ?}
               |? _vern=10 | _vern=11 | _vern=12 | _vern=13 | _vern=14
               || P.OSOBA().NAZWISKO;
                  {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
                  || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
                  || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
                  ?};
::             Pole dodane w wersji 12.41 od wersji PIT-11(22)
                  VAT_DEK.REZYDENT:=pit[11];
                  VAT_DEK.ZNIP:=pit[13];
                  VAT_DEK.RZNIP:={? var_pres('[14]',pit)=type_of(null) || pit[14] || null ?};
                  VAT_DEK.KRAJZNIP:={? var_pres('[15]',pit)=type_of(null) || pit[15] || null ?};
                  VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO;
                  VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
                  VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
                  VAT_DEK.KRAJ:={? type_of(pit[19])=type_of(null) || pit[19] || null ?};
                  VAT_DEK.WOJEWODZ:=pit[20]; VAT_DEK.POWIAT:=pit[21]; VAT_DEK.GMINA:=pit[22];
::                Ze względu na ograniczenie po stronie PITów, pole ulica może przyjmować maksymalnie 65 znaków
                  VAT_DEK.ULICA:={? +pit[23]<=65 || pit[23] || STR.split(pit[23]); STR.line(65) ?};
                  VAT_DEK.DOM:=pit[24]; VAT_DEK.LOKAL:=pit[25]; VAT_DEK.MIASTO:=pit[26]; VAT_DEK.KOD:=pit[27];
                  VAT_DEK.PKU:={? pit[3][2]='P' || $pit[28] || '' ?};
::             Ustawienie pola VAT_DEK.POD na podstawie pit[93] dla wersji 9, pit[100] dla 12 wersji
::             Ustawienie pola VAT_DEK.POD na podstawie pit[114] dla wersji 13
::             Ustawienie pola VAT_DEK.POD na podstawie pit[127] dla wersji 14
                   VAT_DEK.POD:=
                     {? _vern=14 || pit[127] |? _vern=13 || pit[114] |? _vern=12 || pit[100] || pit[93] ?}
               ?};
               VAT_DEK.PIT_GRUP:=PIT_GRUP.ref;
               VAT_DEK.P:=P.ref;
               {? VAT_DEK.add
               || VAT_DEK.memo_set(_opiskor,'OPISKOR');
                  VAT_DEK.memo_put(,'OPISKOR');
                  VAT_POZ.index('VAT_POZ');
                  VAT_POZ.prefix(VAT_DEK.ref);
                  {? _vern=3 | _vern=4
                  || exec('poz_pit11p_3','edeklar')
                  |? _vern=7 | _vern=8
                  || exec('poz_pit11p_7','edeklar')
               |? _vern=10 | _vern=11
               || exec('poz_pit11p_10','edeklar')
                  || exec('poz_pit11p_'+$_vern,'edeklar')
                  ?};
::                ustalenie nowego pola DEKL_POD.VAT_DEK po dodaniu rekordu VAT_DEK
                  exec('vatdek_dekl','edeklar',VAT_DEK.ref(),__Rok);
                  _ile+=1
               ?}
            || {? _kw_dek>0 & ~_symb
               || _bledy:=1;
                  RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,
                            'Symbol urzędu dla e-Deklaracji nie jest wypełniony.'@,
                            'Dodanie deklaracji %1 nie jest możliwe.'@[SKID.DEKL_NAZ])
               |? _kw_dek<0 & _kw_dek=-2
               || _bledy:=1;
                  RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,
                            'Deklaracja PIT-11 została już wydrukowana.'@,
                            'Nie dodano kolejnej deklaracji.'@)
               |? _kw_dek & _wymdane=0
               || _bledy:=1; _textb:=exec('text_err','edeklar',_tab_err);
                  RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,
                            'Dodanie deklaracji %1 nie jest możliwe.'@[SKID.DEKL_NAZ],
                            'Brak wypełnionych wymaganych danych: '@,
                            _textb+'.')
               ?}
            ?}
         ?}
      ?};
      ~{? escape()
       || FUN.ask('Czy przerwać tworzenie deklaracji PIT-11?'@)
       ?}
       & _tab.next()
   !};
   prgs_clr();
   {? _vern=9
   || exec('end_pit11p_9','pit')
   |? _vern=10 | _vern=11 | _vern=12
   || exec('end_pit11p_10','pit')
::Od PIT-11 za 2022 rok 13 wersja e-deklaracji zmiana pliku pit.fml -> pit1.fml
   |? _vern>=13
   || exec('end_pit11p_13','pit1')
   || exec('end_pit11p_1','pit')
   ?}
?};
_tab.cntx_pop();
P.cntx_pop();
OSOBA.cntx_pop();
RAPLS.raport({? PIT_GRUP.RODZAJ='P' || 3 || 4 ?});
RAPLS.ustaw(0);
FUN.emsg('Zakończono proces tworzenia deklaracji PIT-11.\nIlość utworzonych deklaracji: %1.'@[$_ile])


\pit_edit_chck
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Funkcja sprawdza poprawnosc wypelnienia zmiennej PIT_EDIT - parametrow tworzenia grupowych
::       deklaracji podatkowych PIT-11
::----------------------------------------------------------------------------------------------------------------------
_spr:=__CHK.record(PIT_EDIT,,'OPIS');
{? _spr=''
|| {? PIT_EDIT.KOR='T'
   || {? __Rok>=2018 || _spr:='' || _spr:=__CHK.record(PIT_EDIT,,'OPISKOR') ?}
   || PIT_EDIT.OPISKOR:='';
      win_disp()
   ?}
?};
{? _spr='' & var_pres('NR_INFOR',VAT_DEK)>0 & __Rok>=2019 & PIT_EDIT.NR().NR>=10
|| {? PIT_EDIT.NR_INFOR<0
   || FUN.emsg('Wartość pola "Numer informacji" nie może być ujemna.'@);
      _spr:='NR_INFOR'
   ?};
   {? PIT_EDIT.NR_INFOR>99
   || FUN.emsg('Wartość pola "Numer informacji" nie może większa od 99.'@);
      _spr:='NR_INFOR'
   ?}
?};
{? _spr=''
|| {? EDIT_VAR.PIT_RODZ='P' & PIT_EDIT.PODATNIK='N' || PIT_EDIT.PODATUZ:='N' ?};
   {? PIT_EDIT.GIODO='T'
   || _spr:=__CHK.record(PIT_EDIT,,'GIODODAT')
   ?}
?};
{? _spr=''
|| {? PIT_EDIT.GIODO='N' & PIT_EDIT.GIODODAT<>date(0,0,0)
   || PIT_EDIT.GIODODAT:=date(0,0,0);
      win_disp
   ?}
?};
{? _spr=''
|| _spr:=__CHK.record(PIT_EDIT,,'IMIE','NAZ','STN','DATA')
?};
_spr


\pitgr_dol
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Akcja Dolacz w okienku WER tabeli PIT_GRUP
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')=type_of(1) & _a=1 || _a || 0 ?};
{? _a
|| _choice:=FUN.choice('Wybierz rodzaj deklaracji'@,,'I) IFT-1','R) IFT-1R');
   {? _choice=1
   || VAT_DEK.win_edit('IFT1');
      pit_typ:='IFT1';
      SKID.DEKL_NAZ:='IFT1'
   |? _choice=2
   || VAT_DEK.win_edit('IFT1R');
      pit_typ:='IFT1R';
      SKID.DEKL_NAZ:='IFT1R'
   || return(0)
   ?}
?};
PIT_GRUP.win_edit('RED');
PIT_GRUP.blank();
PIT_GRUP.ROK:=__Rok;
PIT_GRUP.TYP:=pit_typ;
PIT_GRUP.USER:=OPERATOR.USER;
PIT_GRUP.DATA_UTW:=date();
PIT_GRUP.OBSZAR:=exec('obszar_roboczy','edeklar');
_refnr:=null;
VAT_VER.index('VER_OD');
VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ);
{? VAT_VER.find_le(__datver)
|| {? __datver~1=VAT_VER.OD~1
   || _refnr:=VAT_VER.ref()
   ?}
?};
PIT_GRUP.NR:=_refnr;
{? PIT_GRUP.edit("exec('pitgr_rec','edeklar')")
|| PIT_GRUP.add()
?}


\pitgr_rec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula sprawdza poprawnosc wypelnienia pol dla akcji Dolacz okno WER tabeli PIT_GRUP
::----------------------------------------------------------------------------------------------------------------------
_spr:=__CHK.record(PIT_GRUP,,'NR','DATA_UTW','OPIS')


\pitgr_popraw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula na Popraw okna WER tabeli PIT_GRUP
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of('') || _a:='PIT-11' || _a ?};
{? exec('pozycja_grupy','edeklar')
|| FUN.emsg('Istnieją Deklaracje %1.\nPoprawianie zabronione.'@[_a]);
   return(0)
?};
PIT_GRUP.win_edit('RED1');
{? PIT_GRUP.edit("exec('pitgr_rec','edeklar')") || PIT_GRUP.put() ?}


\pozycja_grupy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula sprawdza czy sa utworzone deklaracje PIT-11 lub PIT-40 dla wybranej grupy PIT_GRUP
::----------------------------------------------------------------------------------------------------------------------
VAT_DEK.cntx_psh;
VAT_DEK.index('VAT_PITG');
VAT_DEK.prefix(PIT_GRUP.ref);
_ok:=VAT_DEK.first;
VAT_DEK.cntx_pop;
_ok


\pitgr_usun
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula na Usun okna WER tabeli PIT_GRUP sprawdza czy mozna usuwac rekord
::   WE: _a - opcjonalny np. 'PIT-40', nie podano to 'PIT-11'
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')=type_of('') || _a || _a:='PIT-11' ?};
{? exec('pozycja_grupy','edeklar')
|| FUN.info('Istnieją Deklaracje %1.\nUsuwanie zabronione.'@[_a]);
   return(0)
?};
1


\pitgr_edek_gen
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula do generowania e-deklaracji dla wybranej grupy deklaracji PIT-11 lub PIT-40
::   WE: _a - opcjonalny np. 'PIT-40', nie podano to 'PIT-11'
::----------------------------------------------------------------------------------------------------------------------
_deklaracja:={? var_pres('_a')=type_of('') || _a || 'PIT-11' ?};
{? ~FUN.ask('Czy na pewno rozpocząć proces tworzenia e-Deklaracji %1?'@[_deklaracja]) || return() ?};

ISTDEF.cntx_psh();
ISTDEF.index('DATA');
ISTDEF.prefix(BPMN.SYM_DOM,'D',SKID.TYP_ZAP,PIT_GRUP.NR);
{? ~ISTDEF.last()
|| FUN.info('Brak pasującej specyfikacji e-Deklaracji \'%1\'\ndla wersji numer %2.'
       '\nTworzenie e-Deklaracji niemożliwe.'@[SKID.TYP_ZAP,$PIT_GRUP.NR().NR]);
   ISTDEF.cntx_pop();
   return()
?};
ISTDEF.cntx_pop();

P.cntx_psh();
E_DEK.cntx_psh();
E_DEK.index('DATA_ONE');
VAT_DEK.cntx_psh();
VAT_DEK.index('VAT_PITG');
VAT_DEK.prefix(PIT_GRUP.ref());
{? VAT_DEK.first()
||
:: powołujemy obiekt komunikatów
   VAR_DEL.delete('KOMM','NoXSD','NotValid','ErrFun','EdekGr');
   ErrFun:="NotValid:=1";
   exec('KOMM','#object');
   KOMM.init(,,'Uwagi generowania e-deklaracji'@);
   _komm_sect:=0;
   _komm_err:=0;
   PROGRESS.set(VAT_DEK.size(),'Tworzenie e-deklaracji %1.'@[_deklaracja]);
   {? var_pres('_p_upr')>100 || obj_del(_p_upr) ?};
   _p_upr:=exec('dostepne_p','schemat','PPL',P_FILTER.F_ZATR().KOD,'*');
   _p_upr.prefix();
   EdekGr:=1;
   {!
   |? {? _p_upr.find_key($VAT_DEK.P)
::    sprawdzamy czy mamy uprawnienia do pracownika oraz sprawdzamy czy możemy zablokować deklarację
      || {? exec('bepitdek','edeklar',0)
         || NotValid:=0;
            exec('edek_gen','xml',0);
            {? NotValid=1
            || VAT_DEK.P();
               _komm_err+=1;
               _komm:='%1. '[exec('P','#to_string')]+'E-deklaracja niezgodna ze schematem.'@;
               {? _komm_sect=0
               || _komm_sect:=1;
                  KOMM.sect_beg('Nie utworzono e-deklaracji.'@,4)
               ?};
               KOMM.add(_komm)
            ?}
         || VAT_DEK.P();
            _komm_err+=1;
            _komm:='%1. '[exec('P','#to_string')]+'Deklarację przegląda inny operator.'@+'Zabroniony dostęp.'@;
            {? _komm_sect=0
            || _komm_sect:=1;
               KOMM.sect_beg('Nie utworzono e-deklaracji.'@,4)
            ?};
            KOMM.add(_komm)
         ?}
      ?};
      VAT_DEK.r_unlock();
      PROGRESS.next();
      VAT_DEK.next()
   !};
   obj_del(_p_upr);
   PROGRESS.close();
   {? _komm_sect || KOMM.sect_end() ?};
   {? var_pres('NoXSD')>0
   || _komm_err+=1;
      KOMM.sect_beg('Brak schematu XSD e-deklaracji. Utworzono e-deklaracje bez weryfikacji.'@);
      KOMM.sect_end()
   ?};
   {? _komm_err || KOMM.select() ?};
   VAR_DEL.delete('NoXSD','NotValid','ErrFun','EdekGr');
   FUN.emsg('Zakończono proces tworzenia e-deklaracji %1.'@[_deklaracja])
|| FUN.emsg('Brak danych do tworzenia e-deklaracji %1.'@[_deklaracja])
?};
VAT_DEK.cntx_pop();
E_DEK.cntx_pop();
P.cntx_pop()


\symbol_edek
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula sprawdza czy jest wypelniony symbol dla e-Deklaracji w tabeli urzad skarbowy
::   WE: _a - data - data sprawdzenia danych w tabeli OS_US
::   WY: 1 - tak
::       0 - nie
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(date) || return(0) ?};
_symbol:='';
{? exec('szukaj_us','osoba',_a)
|| _symbol:=OS_US.US().EDEK_SYM
?};
_symbol<>''


\rekrzp_dekl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula na rekord przed tabeli VAT_DEK okno WERGR, ustawia odpowiednie kolory na podstawie
::       definicji w programie. Ze wzgledu na dzialania filtra nie ma zmiany dostepnych akcji
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::----------------------------------------------------------------------------------------------------------------------
exec('rekprzed','color','VAT_DEK#01#')


\obszar_roboczy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula ustawia wartosc opisu dla aktualnego obszaru roboczego
::----------------------------------------------------------------------------------------------------------------------
{? EDIT_VAR.PIT_RODZ='P' | EDIT_VAR.PIT_RODZ='D' | EDIT_VAR.PIT_RODZ='A'
|| 'Jednostka org.: '+OPERATOR.PERM().SYMBOL+'; Pracownicy etatowi: '
   +'Wszyscy'
|| 'Jednostka org.: '+OPERATOR.PERM().SYMBOL+'; Zleceniobiorcy: '
   +'Wszyscy'
?}


\pw_kw14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula Przed wyswietl. dla pol VAT_POZ.KW1..KW4
::   WE: _a - numer pola 1..4
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0) || return('') ?};
_vern:=VAT_DEK.NR().NR;
{? pit_typ='PIT11P' | pit_typ='PIT11Z'
|| {? _vern=1
   || {? ((VAT_POZ.NR=13 | VAT_POZ.NR=14) & (_a=2 | _a=3 | _a=4)) | (VAT_POZ.NR=12 & _a=2)
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=2 | _vern=3 | _vern=4
   || {? ((VAT_POZ.NR=11 | VAT_POZ.NR=12) & (_a=2 | _a=3 | _a=4)) | (VAT_POZ.NR=10 & _a=2)
         | (VAT_POZ.NR=2 & _a=2) | (VAT_POZ.NR=3 & _a=2) | (VAT_POZ.NR=4 & _a=2) | (VAT_POZ.NR=5 & _a=2)
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=5 | _vern=6 | _vern=7 | _vern=8
   || {? ((VAT_POZ.NR=11 | VAT_POZ.NR=12) & (_a=2 | _a=3 | _a=4)) | (VAT_POZ.NR=10 & _a=2)
         | (VAT_POZ.NR=2 & _a=2) | (VAT_POZ.NR=3 & _a=2) | (VAT_POZ.NR=4 & _a=2) | (VAT_POZ.NR=5 & _a=2)
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=8 & _a=2 & VAT_POZ.NRK=0) | (VAT_POZ.NR=8 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | ((VAT_POZ.NR=13 | VAT_POZ.NR=14) & (_a=2 | _a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=9
   || {? ((VAT_POZ.NR=11 | VAT_POZ.NR=12) & (_a=2 | _a=3 | _a=4)) | (VAT_POZ.NR=10 & _a=2)
         | (VAT_POZ.NR=2 & _a=2) | (VAT_POZ.NR=3 & _a=2) | (VAT_POZ.NR=4 & _a=2) | (VAT_POZ.NR=5 & _a=2)
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=8 & _a=2 & VAT_POZ.NRK=0) | (VAT_POZ.NR=8 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=13 & (_a=2 | _a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=10 | _vern=11
   || {? (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=7 & _a=2 & VAT_POZ.NRK=0) | (VAT_POZ.NR=7 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=9 & (_a=2 | _a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=12
   || {? (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=7 & _a=2 & VAT_POZ.NRK=0) | (VAT_POZ.NR=7 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=8 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=9 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=11 & (_a=2 | _a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=13
   || {? (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=4 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=4 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=9 & _a=2 & VAT_POZ.NRK=0) | (VAT_POZ.NR=9 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=11 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=12 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=13 & VAT_POZ.NR<=30 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=31 & (_a=1 | _a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=32 & (_a=2 | _a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=14
   || {? (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=1 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=2 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=3 & VAT_POZ.NRK=2 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=4 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=4 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=9 & _a=2 & VAT_POZ.NRK=0) | (VAT_POZ.NR=9 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=10 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=11 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=12 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=13 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=14 & VAT_POZ.NRK=0 & _a=2)
         | (VAT_POZ.NR=15 & VAT_POZ.NRK=1 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=16 & VAT_POZ.NR<=36 & (_a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR=36 & (_a=1 | _a=2 | _a=3 | _a=4))
         | (VAT_POZ.NR>=37 & (_a=2 | _a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   ?}
|? pit_typ='PIT40'
|| {? _vern=2 | _vern=3
   || {? (VAT_POZ.NR=2 & _a=2) | (VAT_POZ.NR=3 & _a=2) | (VAT_POZ.NR=4 & _a=2)
         | (VAT_POZ.NR>=9 & (_a=1 | _a=2 | _a=3)) | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=4 | _vern=5 | _vern=6
   || {? (VAT_POZ.NR=2 & _a=2) | (VAT_POZ.NR=3 & _a=2) | (VAT_POZ.NR=4 & _a=2)
         | (VAT_POZ.NR>=9 & (_a=1 | _a=2 | _a=3)) | (VAT_POZ.NR=1 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
         | (VAT_POZ.NR=6 & _a=2 & VAT_POZ.NRK=0) | (VAT_POZ.NR=6 & VAT_POZ.NRK=1 & (_a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   ?}
|? pit_typ='PIT8CP' | pit_typ='PIT8CZ'
|| {? _vern>=9
   || {? (VAT_POZ.NR=7 & (_a=1 | _a=2 | _a=3))
         | ((VAT_POZ.NR>=1 & VAT_POZ.NR<=5) & (_a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   || {? (((VAT_POZ.NR>=1 & VAT_POZ.NR<=4) | VAT_POZ.NR=12 ) & (_a=1 | _a=2 | _a=3))
          | ((VAT_POZ.NR>=6 & VAT_POZ.NR<=10) & (_a=3 | _a=4))
      || '192:192:192,192:192:192'
      || ''
      ?}
   ?}
|| ''
?}


\pit_rec11
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Funkcja sprawdza poprawnosc wypelnienia tabeli VAT_DEK deklaracji podatkowych PIT-11
::----------------------------------------------------------------------------------------------------------------------
::Sprawdzenie czy mamy aktualizacja 12.51_66 PIT za 2019 rok
_akt_66:=var_pres('KOR_RODZ',VAT_DEK)>0 & var_pres('NR_INFOR',VAT_DEK)>0;
_spr:=__CHK.record(VAT_DEK,,'NR','OPIS');
{? _spr='' & VAT_DEK.KOR='T'
|| {? __Rok>=2018
   || _spr:=''
   || _spr:=__CHK.record(VAT_DEK,,'OPISKOR')
   ?}
?};
{? _spr=''
|| {? pit_typ='PIT11P' & VAT_DEK.PODATNIK='N' || VAT_DEK.PODATUZ:='N' ?};
   {? VAT_DEK.GIODO='T'
   || _data:=__CHK.record(VAT_DEK,,'GIODODAT');
      {? _data<>'' || return(_data) ?}
   ?}
?};
{? _spr='' || _spr:=__CHK.record(VAT_DEK,,'IMIE','NAZ','STN','DATA') ?};

{? _spr='' & _akt_66 & __Rok>=2019 & VAT_DEK.NR().NR>=10
|| {? VAT_DEK.NR_INFOR<0
   || FUN.emsg('Wartość pola "Numer informacji" nie może być ujemna.'@);
      _spr:='NR_INFOR'
   ?};
   {? VAT_DEK.NR_INFOR>99
   || FUN.emsg('Wartość pola "Numer informacji" nie może być większa od 99.'@);
      _spr:='NR_INFOR'
   ?}
?};

:: czyszczenie pól
{? _spr=''
|| {? VAT_DEK.GIODO='N' & VAT_DEK.GIODODAT<>date(0,0,0)
   || VAT_DEK.GIODODAT:=date(0,0,0)
   ?}
?};
{? _spr=''
|| {? VAT_DEK.KOR='N'
   || VAT_DEK.memo_set(,'OPISKOR')
   ?}
?};
_spr


\podatuzb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Funkcja przed redakcja pola VAT_DEK.PODATUZ deklaracja PIT-11 pracownika
::----------------------------------------------------------------------------------------------------------------------
{? pit_typ='PIT11P'
|| {? VAT_DEK.PODATNIK='T' || 1 || 0 ?}
|| 1
?}


\gpodatuz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Funkcja przed redakcja pola zmiennej PIT_EDIT.PODATUZ deklaracja PIT-11 pracownika
::----------------------------------------------------------------------------------------------------------------------
{? EDIT_VAR.PIT_RODZ='P'
|| {? PIT_EDIT.PODATNIK='T' || 1 || 0 ?}
|| 1
?}


\pitgr_edek_send
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula do wysylania e-deklaracji dla wybranej grupy deklaracji PIT-11
::   WE: _a - opcjonalny np. 'PIT-40', nie podano to 'PIT-11'
::----------------------------------------------------------------------------------------------------------------------
_deklaracja:={? var_pres('_a')=type_of('') || _a || 'PIT-11' ?};
{? ~exec('bgsendek','xml',0,_deklaracja) || return() ?};

P.cntx_psh();
E_DEK.cntx_psh();
E_DEK.index('DATA_ONE');
VAT_DEK.cntx_psh();
VAT_DEK.index('VAT_PITG');
VAT_DEK.prefix(PIT_GRUP.ref());
{? VAT_DEK.first()
|| __ED_SEL:=0;
:: powołujemy obiekt komunikatów
   exec('KOMM','#object');
   KOMM.init(,,'Uwagi wysyłania e-deklaracji'@);
   KOMM.sect_beg('Nie wysłano e-deklaracji.'@,4);
   _komm_err:=0;
   PROGRESS.set(VAT_DEK.size(),'Wysyłanie e-deklaracji %1.'@[_deklaracja]);
   {? var_pres('_p_upr')>100 || obj_del(_p_upr) ?};
   _p_upr:=exec('dostepne_p','schemat','PPL',P_FILTER.F_ZATR().KOD,'*');
   _p_upr.prefix();
   {!
   |? {? _p_upr.find_key($VAT_DEK.P)
::       sprawdzamy czy mamy uprawnienia do pracownika oraz sprawdzamy czy możemy zablokować deklarację
      || {? exec('bepitdek','edeklar',0)
         || E_DEK.prefix(BPMN.SYM_DOM,SKID.TYP_ZAP,VAT_DEK.ref());
            {? E_DEK.first()
            || {!
                |? {? E_DEK.AKC='N'
                   || __ED_SEL+=1;
                      exec('send_edek','xml',0)
                   ?};
                   E_DEK.next()
                !}
            ?}
         || VAT_DEK.P();
            _komm_err+=1;
            _komm:='%1. '[exec('P','#to_string')]+'Deklarację przegląda inny operator.'@+'Zabroniony dostęp.'@;
            KOMM.add(_komm)
         ?}
      ?};
      PROGRESS.next();
      VAT_DEK.next()
   !};
   obj_del(_p_upr);
   PROGRESS.close();
   exec('edek2send','xml',2);
   KOMM.sect_end();
   {? _komm_err || KOMM.select() ?};
   {? ~__ED_SEL
   || FUN.emsg('Brak e-deklaracji do wysłania.'@)
   ?};
   exec('del_tab','xml');

:: odblokowanie wszystkich zablokowanych rekordów w tej funkcji
   {? VAT_DEK.first()
   || {!
      |? VAT_DEK.r_unlock();
         VAT_DEK.next()
      !}
   ?}

|| FUN.emsg('Brak danych do wysłania e-deklaracji.'@)
?};
VAT_DEK.cntx_pop();
E_DEK.cntx_pop();
P.cntx_pop()


\drukpitg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula do drukowania wydruku PIT-11 grupy deklaracji PIT-11
::----------------------------------------------------------------------------------------------------------------------
{? EDIT_VAR.PIT_RODZ='P' | EDIT_VAR.PIT_RODZ='Z' | EDIT_VAR.PIT_RODZ='D' | EDIT_VAR.PIT_RODZ='A' | EDIT_VAR.PIT_RODZ='B'
   | EDIT_VAR.PIT_RODZ='C'
||
:: sprawdzenie czy są jakieś pobrane UPO dla utworzonych deklaracji
   _upo_id:='';
   VAT_DEK.cntx_psh();
   VAT_DEK.clear();
   VAT_DEK.f_set('PIT_GRUP,NAZWISKO,PIERWSZE,PESEL',,
      'VAT_DEK.PIT_GRUP=:_a AND VAT_DEK.P in (select distinct :_b.REF from :_b)',
      PIT_GRUP.ref(),exec('dostepne_p','schemat','PPL',P_FILTER.F_ZATR().KOD,'*'));
   {? VAT_DEK.f_first()
   || {!
      |? _upo_id:=exec('upo_id','xml');
         _upo_id='' & VAT_DEK.f_next()
      !}
   ?};
   VAT_DEK.f_clear();
   VAT_DEK.cntx_pop();

   _pyt:={? +_upo_id
         || FUN.choice('Jaki plik wydrukować?'@,,'Deklaracji'@,'Potwierdzenia'@)
         || 1
         ?};
   {? _pyt=1
   || _vern:=PIT_GRUP.NR().NR;
      {? EDIT_VAR.PIT_RODZ='P' | EDIT_VAR.PIT_RODZ='Z'
      || _file:=
            {? _vern=1 || 'ppl_deg1116'
            |? _vern=2 || 'ppl_deg1117'
            |? _vern=3 || 'ppl_deg1118'
            |? _vern=4 || 'ppl_deg1119'
            |? _vern=5 || 'ppl_deg1120'
            |? _vern=6 || 'ppl_deg1121'
            |? _vern=7 || 'ppl_deg1122'
            |? _vern=8 || 'ppl_deg1123'
            |? _vern=9 || 'ppl_deg1124'
            |? _vern=10 || 'ppl_deg1125'
            |? _vern=11 || 'ppl_deg1126'
            || _nrf:=PIT_GRUP.NR().NRF;
               {? _nrf<>0 || 'ppl_deg11'+$_nrf || '' ?}
            ?};
         {? _file<>''
         || {? _vern<5 | _vern>=8
            || {? _vern>=8
               || exec('ask4File','podpis','png',1,0,'dek')
               ?};
               rep_exec(_file)
            || exec('drukuj','edeklar','pit-11',_file,1)
            ?}
         ?}
      |? EDIT_VAR.PIT_RODZ='D'
      || _file:=
            {? _vern=3 || 'ppl_deg4017'
            |? _vern=4 || 'ppl_deg4019'
            |? _vern=5 || 'ppl_deg4020'
            |? _vern=6 || 'ppl_deg4022'
            || ''
            ?};
            {? _file<>''
            || {? _vern<4 | _vern>=6
               || {? _vern>=6
                  || exec('ask4File','podpis','png',1,0,'dek')
                  ?};

                  rep_exec(_file)
               || exec('drukuj','edeklar','pit-40',_file,1)
               ?}
            ?}
      |? EDIT_VAR.PIT_RODZ='A' | EDIT_VAR.PIT_RODZ='B'
      || _file:=
            {? _vern=6 || 'ppl_deg8c06'
            |? _vern=7 || 'ppl_deg8c07'
            |? _vern=8 || 'ppl_deg8c08'
            |? _vern=9 || 'ppl_deg8c09'
            |? _vern=10 || 'ppl_deg8c10'
            ||  _nrf:=PIT_GRUP.NR().NRF;
               {? _nrf<>0 || 'ppl_deg8c'+$_nrf || '' ?}
            ?};
            {? _file<>''
            || {? _vern<6 | _vern>=8
               || rep_exec(_file)
               || exec('drukuj','edeklar','pit-8c',_file)
               ?}
            ?}
      |? EDIT_VAR.PIT_RODZ='C'
      || _file:=
            {? _vern=10 || 'ppl_degift110'
            |? _vern=11 || 'ppl_degift111'
            |? _vern=12 || 'ppl_degift112'
            |? _vern=13 || 'ppl_degift113'
            |? _vern=14 || 'ppl_degift114'
            |? _vern=15 || 'ppl_degift115'
            |? _vern=16 || 'ppl_degift116'
            || ''
            ?};
            {? _file<>''
            || {? _vern<10 | _vern>=13
               || rep_exec(_file)
               || exec('drukuj','edeklar','ift-1',_file)
               ?}
            ?}
      ?}
   |? _pyt=2
   || rep_exec('ppl_degupo3')
   ?}
?}


\pitgr_przed_upo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Przed akcja w grupie pobierania UPO
::   WE: _a - 'PIT-11' lub 'PIT-40'
::----------------------------------------------------------------------------------------------------------------------
{? -(4+XINFO.EDEKGATE)='test'
|| _bramka:='Bramka testowa: '@+XINFO.EDEKGATE;
   _typ:='EXCLAM'
|| _bramka:='Bramka: '@+XINFO.EDEKGATE;
   _typ:='ASK'
?};
{? XINFO.EDEKGATE=''
|| FUN.info('Nie podano adresu bramki przyjmującej e-Deklaracje.'@)
|? FUN.ask('%1.\n\nCzy na pewno rozpocząć proces pobierania UPO \ndla wysyłanych e-Deklaracji %2?'@
           [_bramka,_a],_typ)
|| exec('edek_tab','xml');
   1
?}


\pitgr_upo_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Formula do pobierania UPO dla grupy deklaracji PIT-11
::   WE: _a - opcjonalny np. 'PIT-40', nie podano to 'PIT-11'
::----------------------------------------------------------------------------------------------------------------------
_deklaracja:={? var_pres('_a')=type_of('') || _a || 'PIT-11' ?};
{? ~exec('pitgr_przed_upo','edeklar',_deklaracja) || return() ?};

P.cntx_psh();
E_DEK.cntx_psh();
E_DEK.index('DATA_ONE');
VAT_DEK.cntx_psh();
VAT_DEK.index('VAT_PITG');
VAT_DEK.prefix(PIT_GRUP.ref());
{? VAT_DEK.first()
|| __ED_SEL:=0;
:: powołujemy obiekt komunikatów
   exec('KOMM','#object');
   KOMM.init(,,'Uwagi pobierania UPO dla e-deklaracji'@);
   KOMM.sect_beg('Nie pobrano UPO dla e-deklaracji.'@,4);
   _komm_err:=0;
   PROGRESS.set(VAT_DEK.size(),'Pobieranie UPO dla e-Deklaracji %1.'@[_deklaracja]);
   {? var_pres('_p_upr')>100 || obj_del(_p_upr) ?};
   _p_upr:=exec('dostepne_p','schemat','PPL',P_FILTER.F_ZATR().KOD,'*');
   _p_upr.prefix();
   {!
   |? {? _p_upr.find_key($VAT_DEK.P)
::    sprawdzamy czy mamy uprawnienia do pracownika oraz sprawdzamy czy możemy zablokować deklarację
      || {? exec('bepitdek','edeklar',0)
         || E_DEK.prefix(BPMN.SYM_DOM,SKID.TYP_ZAP,VAT_DEK.ref);
            {? E_DEK.first()
            || {!
                |? {? E_DEK.AKC='W'
                   || __ED_SEL+=1;
                      exec('send_edek','xml',0)
                   ?};
                   E_DEK.next()
                !}
            ?}
         || VAT_DEK.P();
            _komm_err+=1;
            _komm:='%1. '[exec('P','#to_string')]+'Deklarację przegląda inny operator.'@+'Zabroniony dostęp.'@;
            KOMM.add(_komm)
         ?}
      ?};
      PROGRESS.next();
      VAT_DEK.next()
   !};
   obj_del(_p_upr);
   PROGRESS.close();
   KOMM.sect_end();
   {? _komm_err || KOMM.select() ?};
   {? __ED_SEL
   || exec('edek2send','xml',2)
   || FUN.info('Nie ma do pobrania UPO dla e-Deklaracji w wybranej grupie.'@)
   ?};
   exec('del_tab','xml');

:: odblokowanie wszystkich zablokowanych rekordów w tej funkcji
   {? VAT_DEK.first()
   || {!
      |? VAT_DEK.r_unlock();
         VAT_DEK.next()
      !}
   ?}

|| FUN.emsg('Brak danych do pobrania UPO dla e-Deklaracji w wybranej grupie.'@)
?};
VAT_DEK.cntx_pop();
E_DEK.cntx_pop();
P.cntx_pop()


\color
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Funkcja wywolywana w akcji na Rekord przed ustala kolory na podstawie Miejsc wykorzystania
::       jezeli e-deklaracja wyslana i potwierdzona to kolor 'Standard', jak tylko wyslana
::       to wyswietla '~Ostrzezenie', jesli nie ma e-deklaracji lub tylko utworzona to brak koloru
::----------------------------------------------------------------------------------------------------------------------
E_DEK.index('DATA_ONE');
E_DEK.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,VAT_DEK.ref);
{? E_DEK.first
|| {? E_DEK.AKC='T'
   || 'VAT_DEK#01#01'
   |? E_DEK.AKC='W'
   || 'VAT_DEK#01#02'
   ?}
?}


\czy_opiskor
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Funkcja przed redakcja pola VAT_DEK.OPISKOR, jezeli pole VAT_DEK.KOR='T' to mozna redagowac
::----------------------------------------------------------------------------------------------------------------------
return(1);
VAT_DEK.KOR='T'


\opis_korekty
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2009+]
:: OPIS: Funkcja zwraca opis korekty. W pliku xml pole ma obecnie 2000 (3500) znakow i funkcja moze tyle znakow zwrocic
::   WE: _a - akronim pola z tabeli VAT_DEK typu SYS_MEMO, domyslnie 'OPISKOR'
::   WY: Opis korekty [String] do 3500 znakow
::       Od wersji ORD-ZU 8 tylko 2000 znaków
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')=type_of('') & _a<>'' || _pole:=_a || _pole:='OPISKOR' ?};
_text:=VAT_DEK.memo_txt(,1,_pole);
{? _text<>''
|| {? _text*'\n' || _text:=gsub(_text,'\n',' ') ?};
   {? _text*'\t' || _text:=gsub(_text,'\t',' ') ?};
   {!
   |? _text*'  '
   |! _text:=gsub(_text,'  ',' ')
   !}
?};
{? +_text>2000 || _text:=2000+_text ?};
_text


\spr_poz36_17
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2010]
:: OPIS: Sprawdzenie czy sa kwoty z wiersza 1 do wyslania do pliku xml
::   WE: _a - nr pozycji
::       _b - nr wiersza w pozycji
::   WY: Wartosc sumy dla wiersza
::----------------------------------------------------------------------------------------------------------------------
_suma:=0;
_vern:=VAT_DEK.NR().NR;
_nazwa:=VAT_DEK.NR().NAZWA;
{? _nazwa='PIT11' & _vern>=1
|| VAT_POZ.index('NR_NRK');
   VAT_POZ.prefix(VAT_DEK.ref(),_a,_b);
   {? VAT_POZ.first
   || _suma+=(VAT_POZ.KW1+VAT_POZ.KW2+VAT_POZ.KW3+VAT_POZ.KW4)
   ?}
|? _nazwa='PIT40' & _vern>=2
|| VAT_POZ.index('NR_NRK');
   VAT_POZ.prefix(VAT_DEK.ref(),_a,_b);
   {? VAT_POZ.first
   || _suma+=(VAT_POZ.KW1+VAT_POZ.KW2+VAT_POZ.KW3+VAT_POZ.KW4)
   ?}
|? _nazwa='PIT8AR' & _vern>=3
|| VAT_POZ.index('NR_NRK');
   VAT_POZ.prefix(VAT_DEK.ref(),_a,_b);
   {? VAT_POZ.first
   || _suma+=(VAT_POZ.K1+VAT_POZ.K2+VAT_POZ.K3+VAT_POZ.K4+VAT_POZ.K5+VAT_POZ.K6)
   ?}
|? _nazwa='PIT4R' & _vern>=4
|| VAT_POZ.index('NR_NRK');
   VAT_POZ.prefix(VAT_DEK.ref(),_a,_b);
   {? VAT_POZ.first
   || _suma+=(VAT_POZ.K1+VAT_POZ.K2+VAT_POZ.K3+VAT_POZ.K4+VAT_POZ.K5+VAT_POZ.K6)
   ?}
|? _nazwa='PIT8C' & _vern>=6
|| VAT_POZ.index('NR_NRK');
   VAT_POZ.prefix(VAT_DEK.ref(),_a,_b);
   {? VAT_POZ.first
   || _suma+=(VAT_POZ.KW1+VAT_POZ.KW2+VAT_POZ.KW3+VAT_POZ.KW4)
   ?}
|? (_nazwa='IFT1' | _nazwa='IFT1R') & _vern>=10
|| VAT_POZ.index('NR_NRK');
   VAT_POZ.prefix(VAT_DEK.ref(),_a,_b);
   {? VAT_POZ.first
   || _suma+=(VAT_POZ.KW1+VAT_POZ.KW2+VAT_POZ.KW3+VAT_POZ.KW4)
   ?}
?};
_suma


\spr_wymagane
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Sprawdzenie danych wymagamych do wygenerowania e-deklaracji (xml)
::   WE: _a - rodzaj deklaracji podatkowej: 'PIT11P' lub 'PIT11Z' lub 'PIT40'
::       _b - rok deklaracji
::       _c - alias do tabeli tymczasowej do rejestracji bledow
::   WY: 0/1 Wynik sprawdzenia czy pola wymagane sa wypelnione
::----------------------------------------------------------------------------------------------------------------------
_czy_ift:={? _a='IFT1' | _a='IFT1R' || 1 || 0 ?};
_czy_p11:={? _a='PIT11P' | _a='PIT11Z' || 1 || 0 ?};
_czy_p40:={? _a='PIT40' || 1 || 0 ?};
_spr:=1;
_tab_err:=_c;
_danead:="{? OS_ADRES.KRAJ().KODISO='PL'
          || {? |OS_ADRES.WOJEWODZ='' || _a.EL:='Województwo'@; _a.add() ?};
             {? |OS_ADRES.POWIAT='' || _a.EL:='Powiat'@; _a.add() ?};
             {? |OS_ADRES.GMINA='' || _a.EL:='Gmina'@; _a.add() ?};
             {? |OS_ADRES.DOM='' || _a.EL:='Nr domu'@; _a.add() ?};
             {? |OS_ADRES.MIASTO='' || _a.EL:='Miejscowość'@; _a.add() ?};
             {? |OS_ADRES.KOD='' || _a.EL:='Kod pocztowy'@; _a.add() ?};
             {? |OS_ADRES.POCZTA='' || _a.EL:='Poczta'@; _a.add() ?}
          || {? |OS_ADRES.MIASTO='' || _a.EL:='Miejscowość'@; _a.add() ?}
          ?}";
{? |OSOBA.NAZWISKO='' || _tab_err.EL:='Nazwisko aktualne'@; _tab_err.add() ?};
{? |OSOBA.PIERWSZE='' || _tab_err.EL:='Pierwsze imię'@; _tab_err.add() ?};
{? OSOBA.UR_DATA=date(0,0,0) || _tab_err.EL:='Data urodzenia'@; _tab_err.add() ?};
{? ~_czy_ift & |OSOBA.PESEL='' & |OSOBA.NIP='' || _tab_err.EL:='PESEL lub NIP'@; _tab_err.add() ?};
{? _czy_ift
|| {? |OSOBA.UR_MIEJ='' || _tab_err.EL:='Miejsce urodzenia'@; _tab_err.add() ?}
?};
P.OSOBA().NAZWISKO;
{? ~_czy_ift & |OSOBA.NIP='' & exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
|| _tab_err.EL:='NIP'; _tab_err.add()
?};
{? (1+exec('adresdous','osoba',_b))='1'
|| {? _czy_ift
   || {? OS_ADRES.KRAJ=null
      || _tab_err.EL:='Adres-brak Kraju'@; _tab_err.add()
      |? OS_ADRES.KRAJ().KODISO='PL'
      || _tab_err.EL:='wymagany adres "zagraniczny" (inny niż Polska)'@; _tab_err.add()
      ?};
      {? |OS_ADRES.MIASTO='' || _tab_err.EL:='Miejscowość'@; _tab_err.add() ?}
   |? (_czy_p11 | _czy_p40) & _b>=2015
   || {? OS_ADRES.KRAJ=null || _tab_err.EL:='Adres-brak Kraju'@; _tab_err.add() ?};
      {? |OS_ADRES.MIASTO='' || _tab_err.EL:='Adres-brak Miejscowości'@; _tab_err.add() ?};
      _czyzagr:=0; _krajwyd:='';
      {? exec('szukaj_osznip','edeklar',P.OSOBA,date(__Rok,12,0)) & OS_ZNIP.REZYDENT='N'
      || _czyzagr:=1; _krajwyd:=OS_ZNIP.KRAJZNIP().KODISO
      ?};
      {? _czyzagr & OS_ADRES.KRAJ<>null
      || _kraj:=OS_ADRES.KRAJ().KODISO;
         {? _kraj='PL' || _tab_err.EL:='wymagany adres "zagraniczny" (inny niż Polska)'@; _tab_err.add() ?};
         {? _kraj<>'PL' & _kraj<>_krajwyd
         || _tab_err.EL:='Kraj adresu nie jest zgodny krajem wydania numeru identyfikacyjnego'@;
            _tab_err.add()
         ?}
      ?}
   || _danead(_tab_err)
   ?}
|| _tab_err.EL:='Brak danych adresowych'@; _tab_err.add()
?};
{? _tab_err.first || _spr:=0 ?};
_spr


\text_err
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Zapisanie tekstu wymaganych pol do deklaracji PIT-11 lub 'PIT40', ktore nie sa wypelnione
::   WE: _a - alias do tabeli tymczasowej do rejestracji bledow
::   WY: Tekst opisujacy brakujace dane
::----------------------------------------------------------------------------------------------------------------------
_tab_err:=_a;
_textb:='';
{? _tab_err.first
|| {!
   |? _textb+=_tab_err.EL+', ';
      _tab_err.next
   !};
   _textb:=(_textb-2)
?};
_textb


\usun_przed_gr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula na Usun przed okna WERGR w akcji grupowej
::----------------------------------------------------------------------------------------------------------------------
{? VAT_DEK.sel_size()
|| 1
|| FUN.ask('Usunąć bieżący wiersz?'@)
?}


\usun_po_gr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula na Usun po okna WERGR w akcji grupowej
::----------------------------------------------------------------------------------------------------------------------
{? exec('is_edek','xml',SKID.DEKL_NAZ)
|| {? ~VAT_DEK.sel_size()
   || FUN.emsg('Istnieją e-Deklaracje.\nUsunięcie zabronione.'@)
   ?};
   {? var_pres('__ile_bl')>0 || __ile_bl+=1 ?};
   return(0)
?};
{? VAT_DEK.r_lock(1,1,1)
|| {? VAT_DEK.get
   || _usu_dek:=0; _pit11:=0;
      {? 5+VAT_DEK.TYP='PIT11' | (5+VAT_DEK.TYP='PIT8C')
      || DEKL_POD.use('pod_'+$__Rok); _usu_dek:=1; _v_data:=VAT_DEK.DATA;
         {? VAT_DEK.TYP='PIT11P' | VAT_DEK.TYP='PIT8CP'
         || _rodz:='E'
         || _rodz:='Z'
         ?};
         {? 5+VAT_DEK.TYP='PIT11'
         || _pit11:=1
         || _pit11:=0
         ?};
         _dek_p:=VAT_DEK.P; _dek_o:=VAT_DEK.P().OSOBA
      ?};
      {? VAT_DEK.TYP='PIT40'
      || _pit12:=exec('pit12_get','osoba',VAT_DEK.P().OSOBA,__Rok)
      ?};
      do();
      VAT_POZ.index('VAT_POZ');
      VAT_POZ.prefix(VAT_DEK.ref);
      {? VAT_POZ.first || {! |? VAT_POZ.del !} ?};
      {? _usu_dek
      || _akt_147:=exec('akt_147','edeklar');
         {? VAT_DEK.PODATNIK='T'
         || DEKL_POD.index('DEKL_OSO');
            {? _pit11
            || {? __Rok>=2022 & _akt_147
               || DEKL_POD.prefix(_dek_o,'(E)PIT-11','(E)PIT-11',)
               || DEKL_POD.prefix(_dek_o,'(E)PIT-11','(E)PIT-11',_v_data)
               ?}
            || DEKL_POD.prefix(_dek_o,'(E)PIT-8C','(E)PIT-8C',_v_data)
            ?};
            {? _pit11 & __Rok>=2022 & _akt_147
            || {? DEKL_POD.first()
               || {!
                  |? {? DEKL_POD.VAT_DEK<>null()
                     || {? DEKL_POD.VAT_DEK=VAT_DEK.ref()
                        || DEKL_POD.del()
                        || DEKL_POD.next()
                        ?}
                     || DEKL_POD.del()
                     ?}
                  !}
               ?}
            || {? DEKL_POD.first || {! |? DEKL_POD.del !} ?}
            ?}
         || {? _pit11 & __Rok>=2022 & _akt_147
            || DEKL_POD.index('DEKL_OSO');
               DEKL_POD.prefix(_dek_o,'(E)PIT-11','(E)PIT-11',);
               {? DEKL_POD.first()
               || {!
                  |? {? DEKL_POD.VAT_DEK<>null() & DEKL_POD.VAT_DEK=VAT_DEK.ref()
                     || DEKL_POD.del()
                     || DEKL_POD.next()
                     ?}
                  !}
               ?}
            || DEKL_POD.index('DEKL_PED');
               {? _pit11
               || DEKL_POD.prefix(_rodz,_dek_p,'(E)PIT-11','(E)PIT-11',_v_data)
               || DEKL_POD.prefix(_rodz,_dek_p,'(E)PIT-8C','(E)PIT-8C',_v_data)
               ?};
               {? DEKL_POD.first || {! |? DEKL_POD.del !} ?}
            ?}
         ?}
      ?};
      {? VAT_DEK.TYP='PIT40' & _pit12.JEST>1
      || _ret:=exec('pit12_set','osoba',VAT_DEK.P().OSOBA,__Rok,'UO');
         {? _ret<>'' & var_pres('__ile_pit12')>0 || __ile_pit12+=1 ?}
      ?};
      {? exec('del_ndx','#table',ZALACZ,'NAG',VAT_DEK.uidref())
      || VAT_DEK.del(1);
         {? ~VAT_DEK.sel_size() & VAT_DEK.f_active()>0 || VAT_DEK.f_rfresh() ?}
      || undo()
      ?};
      _koniec:=end();
      {? _koniec || {? var_pres('__ile_us')>0 || __ile_us+=1 ?} ?}
   || VAT_DEK.r_unlock;
     {? ~VAT_DEK.sel_size()
     || FUN.emsg('Deklarację przegląda inny operator.'@+'\n'+'Zabroniony dostęp.'@)
     ?};
     {? var_pres('__ile_bl')>0 || __ile_bl+=1 ?};
     {? var_pres('__ile_lk')>0 || __ile_lk+=1 ?};
     0
   ?}
|| {? ~VAT_DEK.sel_size()
   || FUN.emsg('Deklarację przegląda inny operator.'@+'\n'+'Zabroniony dostęp.'@)
   ?};
   {? var_pres('__ile_bl')>0 || __ile_bl+=1 ?};
   {? var_pres('__ile_lk')>0 || __ile_lk+=1 ?};
   0
?}


\usun_gr_przed
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula na akcje grupowa Usun przed okna WERGR w akcji grupowej
::----------------------------------------------------------------------------------------------------------------------
{? FUN.ask('Czy usunąć zaznaczone deklaracje?'@)
|| __ile_bl:=__ile_lk:=__ile_us:=__ile_pit12:=0;
   1
?}


\usun_gr_po
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula na akcje grupowa Usun po okna WERGR w akcji grupowej
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__ile_bl')
|| FUN.info({? __ile_us>0
            || 'Operacja zakończona.'@+'\n'+'Liczba usuniętych deklaracji: %1'@[$__ile_us]
            || 'Nie usunięto żadnej deklaracji.'@
            ?}+
            {? __ile_pit12
            || '\n\n'+'Liczba deklaracji, dla których nie udało się zaktualizować oświadczeń PIT-12: %1.'@[$__ile_pit12]
            || ''
            ?}+
            {? __ile_bl
            || '\n\n'+'Liczba deklaracji, dla których operacja się nie powiodła: %1'@[$__ile_bl]+
               {? __ile_lk>0
               || '\n'+'w tym deklaracje obsługiwane przez innych operatorów: %1'@[$__ile_lk]
               || ''
               ?}
            || ''
            ?});
   &__ile_pit12;
   &__ile_us;
   &__ile_bl;
   &__ile_lk
?};
{? VAT_DEK.f_active()>0 || VAT_DEK.f_rfresh() ?}


\inipit40_select
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula przygotowujaca system do wyswietlenia okna deklaracji PIT-40 dla pracownika
::   WE: _a - String oznaczenie rodzaju deklaracji np. 'PIT40'
::      [_b] [integer]  - rok dla deklaracji
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || '' ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0  ?};

{? _pitTyp='' || return(0) ?};

_wynik:=1;
_TPAR:=exec('tab_rok','edeklar','Deklaracje'@);
_TPAR.ROK:={? _rok || _rok || date()~1 ?};
params_set('TPAR',_TPAR);

{? _rok=0
|| _okedit:=_TPAR.edit("_par:=params_get(); _TPAR:=_par.TPAR;
               {? _TPAR.ROK>=2009
               || 1
               || FUN.emsg('E-deklaracje są dostępne tylko od 2009 roku.'@);
                  return('ROK')
               ?}")
|| _TPAR.ROK:=_rok;
   _okedit:=1
?};
{? _okedit
|| {? _TPAR.ROK=2013
   || datapoc:=date(_TPAR.ROK,11,25);
      datakon:=date(_TPAR.ROK,12,0)
   |? _TPAR.ROK=2014
   || {? date>=date(2015,1,1)
      || datapoc:=date(_TPAR.ROK,12,12);
         datakon:=date(_TPAR.ROK,12,0)
      || datapoc:=date(_TPAR.ROK,1,1);
         datakon:=date(_TPAR.ROK,12,0)
      ?}
   || datapoc:=date(_TPAR.ROK,1,1);
      datakon:=date(_TPAR.ROK,12,0)
   ?};
   okres:=$_TPAR.ROK;
   pit_typ:=_a;
   rodzdekl:='R';
   SKID.DEKL_NAZ:='PIT40';
   __Rok:=_TPAR.ROK;
:: Dla danych za rok 2011 tworzonych w 2012 roku i danych 2012 ustalamy wersja 3 e-deklaracji
:: Dla danych za rok 2014 tworzonych w 2014 roku ustalamy 4 wersje
:: Dla danych za rok 2014 tworzonych w 2015 roku ustalamy 5 wersje
   __datver:={? __Rok=2011 & date>=date(2012,1,1)
             || date(2012,12,0)
             |? __Rok=2012
             || date(2012,12,0)
             |? __Rok=2013
             || date(2013,12,0)
             |? __Rok=2014
             || {? date>=date(2015,1,1) || date(2014,12,0) || date(2013,12,0) ?}
             |? __Rok>=2015
             || date(2015,12,0)
             || date(_TPAR.ROK,1,1)
             ?};
   rok_dekp:=date(0,0,0);
   TP.index('TABPODAT');
   TP.prefix(__Rok);
   {? ~TP.first
   || FUN.emsg('Brak tabeli podatkowej w roku: %1.\nZdefiniuj brakujące dane.'@[$__Rok]);
      _wynik:=0
   ?}
?};
_wynik


\end_inipit40
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula zwiazana z funkcja \inipit40_select usuwajaca zmienne tworzone w tej funkcji
::----------------------------------------------------------------------------------------------------------------------
undefine();
VAR_DEL.delete('datapoc','datakon','okres','rodzdekl','__Rok','pit_typ','rok_dekp','__datver')


\pit40_dod
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula dla akcji Dolacz okna deklaracji PIT-40 dla pracownika
::   WE: _a - opcjonalny 1 Dolacz w grupie, 0 zwykla akcja Dolacz
::----------------------------------------------------------------------------------------------------------------------
_grupa:={? var_pres('_a')=type_of(0) & _a || _a || 0 ?};
EDIT_VAR.NR_EDIT:=1;
_dalej:=1;
P.cntx_psh();
{? _grupa
||
:: wybranie pracowników do dalszego przetwarzania
   _args:=exec('wybierz_args','pracownik');
   _args.WIELU:=0;
   _args.DOMAIN:='PPL';
   _args.UD_SCH:=UD_DEF.UD_SCH;
   _args.UD_SKL:=UD_DEF.UD_SKL;
   _args.F_ZATR:=P_FILTER.F_ZATR().KOD;
   _args.VIEW:=P_FILTER.STATUS;
   _args.SQL_FROM:='';
   _args.HDR_SEL:='Wybór pracowników'@;

   _wyb:=exec('wybierz','pracownik',_args);

   {? _wyb.STATUS<>''
   || FUN.info(_wyb.STATUS)
   ?};

   {? _wyb.P.SQL<>''
   || P.prefix();
      {? P.seek(_wyb.P.SQL)
      || P.OSOBA()
      || _dalej:=0
      ?}
   || _dalej:=0
   ?};
   EDIT_VAR.NR_EDIT:=0
?};
{? _dalej & P.F_ZATR().KOD<>'P'
|| FUN.emsg('Deklaracja PIT-40 dostępna jest tylko dla pracowników.'@);
   _dalej:=0
?};
{? ~_dalej
|| P.cntx_pop();
   return(0)
?};
{? ~exec('symbol_edek','edeklar',date(__Rok,12,0))
|| FUN.emsg('Symbol urzędu dla e-Deklaracji nie jest wypełniony.'@+
           '\n'+'Dodanie deklaracji %1 nie jest możliwe.'@[SKID.DEKL_NAZ]+
           '\n'+'Uzupełnij brakujące informacje w kartotece Urzędy skarbowe.'@);
   P.cntx_pop();
   return(0)
?};
::Zmiana 2015 rok 70 znakow
_tab_err:=tab_tmp(1,'EL','STRING[70]','Element'@);
{? ~exec('spr_wymagane','edeklar',pit_typ,__Rok,_tab_err)
|| _textb:=exec('text_err','edeklar',_tab_err);
   FUN.emsg(|P.T+' '+OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE+
            '\nDodanie deklaracji '@+SKID.DEKL_NAZ+' nie jest możliwe.'@+
            '\nBrak wypełnionych wymaganych danych:'@+
            '\n'+_textb+'.');
   P.cntx_pop();
   return(0)
?};
VAT_DEK.win_edit('PIT40');
VAT_DEK.hdr_edit();
VAT_DEK.hdr_edit(': '+P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE);
VAT_DEK.blank();
::ustawienie * do pola Numer wersji
VAT_DEK.efld_opt('PIT40','mark=%1'[$EDIT_VAR.NR_EDIT],VAT_DEK,'NR');
{? _grupa || VAT_DEK.PIT_GRUP:=PIT_GRUP.ref ?};
VAT_DEK.P:=P.ref;
VAT_DEK.OS_PODAT:=P.OSOBA;
VAT_DEK.ROK:=null();
VAT_DEK.RODZAJ:=rodzdekl;
VAT_DEK.TYP:=pit_typ;
VAT_DEK.OKRES:=$__Rok;
VAT_DEK.OPIS:={? _grupa || PIT_GRUP.OPIS || 'Deklaracja '+SKID.DEKL_NAZ ?};
_use:=userdata;
VAT_DEK.IMIE:=~-{? _im:=_use*' ' || (_im-1)+_use || _use ?};
VAT_DEK.NAZ:=~-{? _im || _im-_use || '' ?};
VAT_DEK.DATA:=date;
VAT_DEK.PIT12:='T';
_ver:=1;
VAT_DEK.cntx_psh;
VAT_DEK.index('VAT_PRAC');
VAT_DEK.prefix(P.ref,rodzdekl,rok_dekp,$__Rok,pit_typ);
{? VAT_DEK.last || _ver:=VAT_DEK.WER+1 ?};
VAT_DEK.cntx_pop;
VAT_DEK.WER:=_ver;

_refnr:=null;
{? _grupa
|| _refnr:=PIT_GRUP.NR
|| VAT_VER.index('VER_OD');
   VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ);
   {? VAT_VER.find_le(__datver)
   || {? __datver~1=VAT_VER.OD~1
      || _refnr:=VAT_VER.ref
      ?}
   ?}
?};
VAT_DEK.NR:=_refnr;
VAT_DEK.memo_set(,'OPISKOR');

exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,VAT_DEK.win_edit('?'));

{? VAT_DEK.edit("exec('pit_rec40','edeklar')")
|| _vern:=VAT_DEK.NR().NR;
   _pit12:=exec('pit12_get','osoba',P.OSOBA,__Rok);
   {? VAT_DEK.PIT12='T' & _pit12.JEST<2
   || FUN.emsg('Podatnik nie złożył oświadczenia PIT-12 za rok %1.\nDeklaracja PIT-40 nie została utworzona.'@[$__Rok])
   |? _vern=2 | _vern=3 | _vern=4 | _vern=5 | _vern=6
   || exec('init_pit40p_'+$_vern,'pit',VAT_DEK.NR().NR);
      _dane:=exec('obl_pit40p'+'_'+$_vern,'pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.PITR,
                  VAT_DEK.KOR,VAT_DEK.GIODO,VAT_DEK.GIODODAT,_pit12);
      {? _dane>0
      || {? _vern=2
      || VAT_DEK.US:=us_podat;
         VAT_DEK.NIP:=pit[19]; VAT_DEK.NAZWISKO:=pit[20]; VAT_DEK.PIERWSZE:=pit[21];
         VAT_DEK.DATA_UR:=pit[22]; VAT_DEK.PESEL:=pit[23];
         VAT_DEK.WOJEWODZ:=pit[25]; VAT_DEK.POWIAT:=pit[26];
         VAT_DEK.GMINA:=pit[27]; VAT_DEK.ULICA:=pit[28]; VAT_DEK.DOM:=pit[29];
         VAT_DEK.LOKAL:=pit[30]; VAT_DEK.MIASTO:=pit[31]; VAT_DEK.KOD:=pit[32]; VAT_DEK.POCZTA:=pit[33];
            VAT_DEK.PKU:=$pit[36]
         |? _vern=3
         || VAT_DEK.US:=us_podat;
            P.OSOBA().NAZWISKO;
            {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
            || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
            || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
            ?};
            VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
            VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
            VAT_DEK.KRAJ:={? type_of(pit[23])=type_of(null) || pit[23] || null ?};
            VAT_DEK.WOJEWODZ:=pit[24]; VAT_DEK.POWIAT:=pit[25];
            VAT_DEK.GMINA:=pit[26]; VAT_DEK.ULICA:=pit[27]; VAT_DEK.DOM:=pit[28];
            VAT_DEK.LOKAL:=pit[29]; VAT_DEK.MIASTO:=pit[30]; VAT_DEK.KOD:=pit[31]; VAT_DEK.POCZTA:=pit[32];
            VAT_DEK.PKU:=$pit[34]
         |? _vern=4 | _vern=5
         || VAT_DEK.US:=us_podat;
            P.OSOBA().NAZWISKO;
            {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
            || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
            || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
            ?};
            VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
            VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
            VAT_DEK.KRAJ:={? type_of(pit[13])=type_of(null) || pit[13] || null ?};
            VAT_DEK.WOJEWODZ:=pit[14]; VAT_DEK.POWIAT:=pit[15];
            VAT_DEK.GMINA:=pit[16]; VAT_DEK.ULICA:=pit[17]; VAT_DEK.DOM:=pit[18];
            VAT_DEK.LOKAL:=pit[19]; VAT_DEK.MIASTO:=pit[20]; VAT_DEK.KOD:=pit[21]; VAT_DEK.POCZTA:=pit[22];
            VAT_DEK.PKU:=$pit[24];
            VAT_DEK.POD:=pit[76]
         |? _vern=6
         || VAT_DEK.US:=us_podat;
            P.OSOBA().NAZWISKO;
            {? OSOBA.PESEL='' | exec('spr_nip','pit',OSOBA.ref,date(__Rok,12,0))
            || VAT_DEK.NIP:=OSOBA.NIP; VAT_DEK.PESEL:=''
            || VAT_DEK.PESEL:=OSOBA.PESEL; VAT_DEK.NIP:=''
            ?};
::          Pole dodane w wersji 12.41 od wersji PIT-40(22)
            VAT_DEK.REZYDENT:=pit[9];
            VAT_DEK.ZNIP:=pit[11];
            VAT_DEK.RZNIP:={? var_pres('[12]',pit)=type_of(null) || pit[12] || null ?};
            VAT_DEK.KRAJZNIP:={? var_pres('[13]',pit)=type_of(null) || pit[13] || null ?};
            VAT_DEK.NAZWISKO:=OSOBA.NAZWISKO; VAT_DEK.PIERWSZE:=OSOBA.PIERWSZE;
            VAT_DEK.DATA_UR:=OSOBA.UR_DATA;
            VAT_DEK.KRAJ:={? type_of(pit[17])=type_of(null) || pit[17] || null ?};
            VAT_DEK.WOJEWODZ:=pit[18]; VAT_DEK.POWIAT:=pit[19];
            VAT_DEK.GMINA:=pit[20]; VAT_DEK.ULICA:=pit[21]; VAT_DEK.DOM:=pit[22];
            VAT_DEK.LOKAL:=pit[23]; VAT_DEK.MIASTO:=pit[24]; VAT_DEK.KOD:=pit[25]; VAT_DEK.POCZTA:=pit[26];
            VAT_DEK.PKU:=$pit[28];
            VAT_DEK.POD:=pit[80]
         ?};
         {? VAT_DEK.add
         || VAT_DEK.memo_put(,'OPISKOR');
            {? _grupa
            || {? VAT_DEK.f_active()>0 || VAT_DEK.f_rfresh() ?}
            ?};
            VAT_POZ.index('VAT_POZ');
            VAT_POZ.prefix(VAT_DEK.ref);
            exec('poz_pit40p_'+$_vern,'edeklar')
         ?}
      |? _dane<0
      || FUN.emsg('Deklaracja PIT-40 została już %1\n Nie dodano kolejnej deklaracji.'
            [{? _dane=-1 || 'wykonana.' || 'wydrukowana.' ?}])
      || FUN.emsg('Brak informacji do wykazania na deklaracji PIT-40\n (zerowe kwoty dochodu i podatku).'@)
      ?};
      exec('end_pit40p_2','pit')
   ?}
?};
P.cntx_pop()


\poz_pit40p_2
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-40 dla 2 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! {? _d>=9
              || ($('VAT_POZ.P'+$(_ind+3)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind+3)))():=($('pit['+$(_c+_ind)+']'))()
              || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=44 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=47 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=50 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=12 || VAT_POZ.RODZ:=pit[71] ?};
              {? _d=20 || VAT_POZ.RODZ:=pit[80] ?}

           !};
           VAT_POZ.add";

_dod_zap('F. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',36,1,0,'A',4);
_dod_zap('F. 1.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',40,1,1,'A',2);
_dod_zap('F. 2','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',42,2,0,'A',4);
_dod_zap('F. 3','3. Emerytury - renty zagraniczne',45,3,0,'A',4);
_dod_zap('F. 4','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',48,4,0,'A',4);
_dod_zap('F. 5','5. Przychody z osobiście wykonywanej dział., o której mowa w art.13 pkt 2, 4, 6 i 7-9',51,5,0,'A',4);
_dod_zap('F. 6','6. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',55,6,0,'A',4);
_dod_zap('F. 7','7. Inne źródła',59,7,0,'A',4);
_dod_zap('F. 8','8. RAZEM Suma kwot z wierszy od 1 do 7.',63,8,0,'A',4);
_dod_zap('G. 1','Składki na ubezpieczenia społeczne',67,9,0,'A',1);
_dod_zap('G. 2',' w tym zagraniczne, o których mowa w art.26 ust.1 pkt 2a ustawy',68,10,0,'A',1);
_dod_zap('G. 3','Zwrot nienależnie pobranych świadczeń',69,11,0,'A',1);
_dod_zap('G. 4','Inne odliczenia od dochodu, niewymienione w poz.68 i 70',71,12,0,'A',1);
_dod_zap('H.1.1','Podstawa obliczenia podatku (po zaokrągleniu do pełnych złotych)',72,13,0,'A',1);
_dod_zap('H.1.2','Obliczony podatek - zgodnie z art.27 ustawy. Podatek od podstawy z poz.73.',73,14,0,'A',1);
_dod_zap('H.1.3','Doliczenie do podatku',74,15,0,'A',1);
_dod_zap('H.1.4','Podatek. Do kwoty z poz.74 należy dodać kwotę z poz.75.',75,16,0,'A',1);
_dod_zap('H.2.1','Składki na ubezpieczenie zdrowotne',76,17,0,'A',1);
_dod_zap('H.2.2',' w tym zagraniczne, o których mowa w art.27b ust.1 pkt 2 ustawy',77,18,0,'A',1);
_dod_zap('H.2.3','Kwota składek z poz.77, możliwa do odliczenia w roku podatkowym',78,19,0,'A',1);
_dod_zap('H.2.4','Inne odliczenia od podatku,niewymienione w poz.77',80,20,0,'A',1);
_dod_zap('H.3.1','Podatek należny (po zaokrągleniu do pełnych złotych)',81,21,0,'A',1);
_dod_zap('H.3.2','Różnica pomiędzy podatkiem należnym a sumą zaliczek pobranych przez płatnika - DO ZAPŁATY',82,22,0,'A',1);
_dod_zap('H.3.3','Różnica pomiędzy sumą zaliczek pobranych przez płatnika a podatkiem należnym - NADPŁATA',83,23,0,'A',1)


\poz_pit40p_3
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [11.22]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-40 dla 3 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! {? _d>=9
              || ($('VAT_POZ.P'+$(_ind+3)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind+3)))():=($('pit['+$(_c+_ind)+']'))()
              || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=42 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=45 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=48 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=12 || VAT_POZ.RODZ:=pit[69] ?};
              {? _d=20 || VAT_POZ.RODZ:=pit[78] ?}

           !};
           VAT_POZ.add";

_dod_zap('F. 1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',34,1,0,'A',4);
_dod_zap('F. 1.2','   W poz.39 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',38,1,1,'A',2);
_dod_zap('F. 2','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',40,2,0,'A',4);
_dod_zap('F. 3','3. Emerytury - renty zagraniczne',43,3,0,'A',4);
_dod_zap('F. 4','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',46,4,0,'A',4);
_dod_zap('F. 5','5. Przychody z osobiście wykonywanej dział., o której mowa w art.13 ustawy',49,5,0,'A',4);
_dod_zap('F. 6','6. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',53,6,0,'A',4);
_dod_zap('F. 7','7. Inne źródła',57,7,0,'A',4);
_dod_zap('F. 8','8. RAZEM Suma kwot z wierszy od 1 do 7.',61,8,0,'A',4);
_dod_zap('G. 1','Składki na ubezpieczenia społeczne',65,9,0,'A',1);
_dod_zap('G. 2',' w tym zagraniczne, o których mowa w art.26 ust.1 pkt 2a ustawy',66,10,0,'A',1);
_dod_zap('G. 3','Zwrot nienależnie pobranych świadczeń',67,11,0,'A',1);
_dod_zap('G. 4','Inne odliczenia od dochodu, niewymienione w poz.66 i 68 3)',69,12,0,'A',1);
_dod_zap('H.1.1','Podstawa obliczenia podatku (po zaokrągleniu do pełnych złotych)',70,13,0,'A',1);
_dod_zap('H.1.2','Obliczony podatek - zgodnie z art.27 ustawy. Podatek od podstawy z poz.71.',71,14,0,'A',1);
_dod_zap('H.1.3','Doliczenie do podatku',72,15,0,'A',1);
_dod_zap('H.1.4','Podatek. Do kwoty z poz.72 należy dodać kwotę z poz.73.',73,16,0,'A',1);
_dod_zap('H.2.1','Składki na ubezpieczenie zdrowotne',74,17,0,'A',1);
_dod_zap('H.2.2',' w tym zagraniczne, o których mowa w art.27b ust.1 pkt 2 ustawy',75,18,0,'A',1);
_dod_zap('H.2.3','Kwota składek z poz.77, możliwa do odliczenia w roku podatkowym',76,19,0,'A',1);
_dod_zap('H.2.4','Inne odliczenia od podatku,niewymienione w poz.75 3)',78,20,0,'A',1);
_dod_zap('H.3.1','Podatek należny (po zaokrągleniu do pełnych złotych)',79,21,0,'A',1);
_dod_zap('H.3.2','Różnica pomiędzy podatkiem należnym a sumą zaliczek pobranych przez płatnika - DO ZAPŁATY',80,22,0,'A',1);
_dod_zap('H.3.3','Różnica pomiędzy sumą zaliczek pobranych przez płatnika a podatkiem należnym - NADPŁATA',81,23,0,'A',1)


\pit_rec40
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Funkcja sprawdza poprawnosc wypelnienia tabeli VAT_DEK deklaracji podatkowych PIT-40
::----------------------------------------------------------------------------------------------------------------------
_spr:=__CHK.record(VAT_DEK,,'NR','OPIS');
{? _spr='' & VAT_DEK.KOR='T' || _spr:=__CHK.record(VAT_DEK,,'OPISKOR') ?};
{? _spr=''
|| {? VAT_DEK.GIODO='T'
   || _spr:=__CHK.record(VAT_DEK,,'GIODODAT')
   ?}
?};
{? _spr='' || _spr:=__CHK.record(VAT_DEK,,'IMIE','NAZ','DATA') ?};

:: czyszczenie pól
{? _spr=''
|| {? VAT_DEK.GIODO='N' & VAT_DEK.GIODODAT<>date(0,0,0)
   || VAT_DEK.GIODODAT:=date(0,0,0)
   ?}
?};
{? _spr=''
|| {? VAT_DEK.KOR='N'
   || VAT_DEK.memo_set(,'OPISKOR')
   ?}
?};
_spr


\poz_edek_txt
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Wartosc tekstowych opisow pozycji e-Deklaracji PIT-40
::   WE: [_a] - nr pozycji
::   WY: Wartosc pozycji (napis)
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.index('NR_NRK');
VAT_POZ.prefix(VAT_DEK.ref(),_a,_b);
{? VAT_POZ.first
|| return(exec('konwersja_xml','xml',VAT_POZ.RODZ))
|| return('')
?}


\pw_rodz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [2011]
:: OPIS: Formula Przed wyswietl dla pola VAT_POZ.RODZ
::----------------------------------------------------------------------------------------------------------------------
{? BPMN.SYM_DOM='PPL' & pit_typ='PIT40'
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=2 | _vern=3 | _vern=4 | _vern=5 | _vern=6
   || {? (VAT_POZ.NR>=1 & VAT_POZ.NR<=11) | (VAT_POZ.NR>=13 & VAT_POZ.NR<=19) | (VAT_POZ.NR>=21 & VAT_POZ.NR<=23)
      || '192:192:192,192:192:192'
      || ''
      ?}
   ?}
|? BPMN.SYM_DOM='PPL' & (5+pit_typ='PIT8C')
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=6 | _vern=7 | _vern=8
   || {? (VAT_POZ.NR>=4 & VAT_POZ.NR<=12)
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=9 | _vern=10 | _vern=11
   || {? VAT_POZ.NR>=1
      || '192:192:192,192:192:192'
      || ''
      ?}
   ?}
|? BPMN.SYM_DOM='PPL' & (5+pit_typ='PIT11')
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=9
   || {? (VAT_POZ.NR>=1 & VAT_POZ.NR<=13) | (VAT_POZ.NR>=17 & VAT_POZ.NR<=20)
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=10 | _vern=11
   || {? (VAT_POZ.NR>=1 & VAT_POZ.NR<=14) | (VAT_POZ.NR>=19 & VAT_POZ.NR<=25)
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=12
   || {? (VAT_POZ.NR>=1 & VAT_POZ.NR<=16) | (VAT_POZ.NR>=21 & VAT_POZ.NR<=28)
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=13
   || {? (VAT_POZ.NR>=1 & VAT_POZ.NR<=15) | (VAT_POZ.NR>=21 & VAT_POZ.NR<=33)
      || '192:192:192,192:192:192'
      || ''
      ?}
   |? _vern=14
   || {? (VAT_POZ.NR>=1 & VAT_POZ.NR<=18) | (VAT_POZ.NR>=23 & VAT_POZ.NR<=38)
      || '192:192:192,192:192:192'
      || ''
      ?}
   ?}
|| ''
?}


\update_form
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [11.22]
:: OPIS: Formula poprawia dla wybranej deklaracji podane pole w schemacie pliku xml
::   WE: [_a] - _a - String (wymagany) oznaczenie rodzaju deklaracji np. 'PIT-40 (16)'
::       [_b] - _b - String (wymagany) oznaczenie nazwy pola w schemacie np. 'P_83'
::----------------------------------------------------------------------------------------------------------------------
{? _<>2 || return('Niepoprawna liczba parametrów.'@) ?};
{? var_pres('_a')=type_of('') & +_a || _a || return('Niepoprawny parametr: _a'@) ?};
{? var_pres('_b')=type_of('') & +_b || _b || return('Niepoprawny parametr: _b'@) ?};
_popraw:=0;
ISTDEF.index('VER'); ISTDEF.prefix(BPMN.SYM_DOM,'D',_a);
{? ISTDEF.first()
|| ISTDEFS.index('OPIS');
   {!
   |? ISTDEFS.prefix(ISTDEF.ref(),_b,'N');
      {? ISTDEFS.first()
      || {? ISTDEFS.REGULY*'{? exec(\'spr_poz36_17\',\'edeklar\',22,0)>0'
         || ISTDEFS.REGULY:='{? exec(\'spr_poz36_17\',\'edeklar\',22,0)>=0 & exec(\'spr_poz36_17\',\'edeklar\',23,0)=0 || exec(\'poz_edek\',\'skid_xml\',22,0,4) || \'\' ?}';
            ISTDEFS.put;
            _popraw+=1
         ?}
      ?};
      ISTDEF.next()
   !}
?};
{? _popraw
|| FUN.emsg('Poprawiono schemat edeklaracji: %1 pozycja schematu: %2.'@[_a,_b])
?};
1


\pit40_grup
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula wyswietla grupy deklaracji podatkowych PIT-40
::   WE: _a - String oznaczenie rodzaju deklaracji np. 'PIT40'
::       [_b] [INTEGER] - rok deklaracji podatkowej
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || return(~~) ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0          ?};
{? exec('inipit40_select','edeklar',_pitTyp,_rok)
|| USERS.cntx_psh();
   OGRANICZ.blank(1);
   SKID.TYP_ZAP:=SKID.DEKL_NAZ;
   PIT_GRUP.clear();
   PIT_GRUP.index('RODZAJP');
   EDIT_VAR.cntx_psh();
   EDIT_VAR.PIT_RODZ:='D';
   EDIT_VAR.OBSZAR:='Pracownicy etatowi';
   PIT_GRUP.prefix(EDIT_VAR.PIT_RODZ,__Rok);
   PIT_GRUP.win_sel('WER40');
   PIT_GRUP.hdr_sel();
   PIT_GRUP.hdr_sel(': %1 z roku %2'@['PIT-40',$__Rok]);
   PIT_GRUP.select(,1,10);
   EDIT_VAR.cntx_pop();
   USERS.cntx_pop()
?}


\ustal_kraj_adr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.10]
:: OPIS: Funkcja dla PIT-11 pracownikow lub zleceniobiorcow ustala kraj adresu do edeklaracji
::   WE: _a - [INTEGER] 1 - kod kraju, 0 - nazwa kraju
::   WY: Wartosc String (napis) po konwersji
::----------------------------------------------------------------------------------------------------------------------
OSOBA.cntx_psh;
P.cntx_psh;
VAT_DEK.P().OSOBA();
_wynik:='';
_adus:=exec('adresdous','osoba',#VAT_DEK.OKRES);
{? #(1+_adus)
|| _wynik:={? OS_ADRES.KRAJ<>null
           || {? _a || ~-OS_ADRES.KRAJ().KODISO || ~-OS_ADRES.KRAJ().NAZ ?}
           || ''
           ?}
?};
P.cntx_pop;
OSOBA.cntx_pop;
_wynik


\poz_pit4r_4
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-4R (4) dla 4 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 4
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 4 ?};
_vern:=_a;
exec('obl_'+(-pit_typ)+'_'+$_vern,'pit');
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                    {? _d=6
                    || _poz:=($('VAT_POZ.P'+$_ind))();
                       {? _poz=85 | _poz=86 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                    ?}
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','Liczba podatników',8,0,0,'A');
   _dod_zap('C. 1.2','Liczba podatników',20,0,6,'A');
   _dod_zap('C. 1.3','Należne zaliczki',14,1,0,'A');
   _dod_zap('C. 1.4','Należne zaliczki',26,1,6,'A');

   _dod_zap('C. 2.1','2. Zaliczki na podatek obliczone przez płatników, o których mowa',32,2,0,'R');
   _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',38,2,6,'R');

   _dod_zap('C. 3.1','3. Suma należnych zaliczek za poszczególne miesiące roku podatkowego',44,3,0,'S');
   _dod_zap('C. 3.2','wykazanych w wierszach 1 i 2',50,3,6,'S');

   _dod_zap('C. 4.1','4. Zaliczki na podatek, których pobór został ograniczony',56,4,0,'R');
   _dod_zap('C. 4.2','na podstawie art.32 ust.2 ustawy',62,4,6,'R');

   _dod_zap('C. 5.1','5. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',68,5,0,'R');
   _dod_zap('C. 5.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',74,5,6,'R');

   _dod_zap('C. 6.1','6. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',80,6,0,'A');

   _dod_zap('C. 7.1','7. Nadpłaty wynikające z rozliczenia za rok ubiegły oraz zwrot nadpłat',84,7,0,'A');
   _dod_zap('C. 7.2','w gotówce zaliczone na poczet należnej zaliczki',90,7,6,'A');

   _dod_zap('C. 8.1','8. Pobrany podatek, przekazany na PFRON',96,8,0,'R');
   _dod_zap('C. 8.2','oraz zak. fun. rehab. osób niepełnos.',102,8,6,'R');

   _dod_zap('C. 9.1','9. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',108,9,0,'R');
   _dod_zap('C. 9.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy',114,9,6,'R');

   _dod_zap('C.10.1','10. Zaliczki na podatek pobrane od innych należności,',120,10,0,'R');
   _dod_zap('C.10.2','w tym wynikających z umowy aktywizacyjnej 4)',126,10,6,'R');

   _dod_zap('C.11.1','11. Pobrany podatek do przekazania do urzędu skarbowego za',132,11,0,'S');
   _dod_zap('C.11.2','poszczególne miesiące roku podatkowego',138,11,6,'S');

   _dod_zap('C.12.1','12. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',144,12,0,'R');
   _dod_zap('C.12.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',150,12,6,'R');

   _dod_zap('C.13.1','13. Należne kwoty do wpłaty za poszczególne miesiące roku podatkowego',156,13,0,'S');
   _dod_zap('C.13.2','',162,13,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\poz_pit8ar_4
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (3) dla 4 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 4
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 4 ?};
_vern:=_a;
exec('obl_'+(-pit_typ)+'_'+$_vern,'pit');
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',8,1,0,'A');
   _dod_zap('C. 1.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',14,1,6,'A');
   _dod_zap('C. 2.1','2. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',20,2,0,'A');
   _dod_zap('C. 2.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',26,2,6,'A');
   _dod_zap('C. 3.1','3. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',32,3,0,'A');
   _dod_zap('C. 3.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',38,3,6,'A');
   _dod_zap('C. 4.1','4. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia wypłacane żołnie-',44,4,0,'A');
   _dod_zap('C. 4.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',50,4,6,'A');
   _dod_zap('C. 5.1','5. Należności osób zagranicznych, wymienione w art. 29 ustawy',56,5,0,'A');
   _dod_zap('C. 5.2','',62,5,6,'A');
   _dod_zap('C. 6.1','6. Odsetki od pożyczek, odsetki i dyskonto od papierów wartościowych',68,6,0,'A');
   _dod_zap('C. 6.2','   (art. 30a ust. 1 pkt 1 i 2 ustawy)',74,6,6,'A');
   _dod_zap('C. 7.1','7. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na',80,7,0,'A');
   _dod_zap('C. 7.2','   rachunku podatnika (art. 30a ust. 1 pkt 3 ustawy)',86,7,6,'A');
   _dod_zap('C. 8.1','8. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',92,8,0,'A');
   _dod_zap('C. 8.2','   (art. 30a ust. 1 pkt 4 ustawy)',98,8,6,'A');
   _dod_zap('C. 9.1','9. Dochód z tytułu udziału w funduszach kapitałowych',104,9,0,'A');
   _dod_zap('C. 9.2','   (art. 30a ust. 1 pkt 5 ustawy)',110,9,6,'A');
   _dod_zap('C.10.1','10. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego',116,10,0,'A');
   _dod_zap('C.10.2','   (art. 30a ust. 1 pkt 6 ustawy)',122,10,6,'A');
   _dod_zap('C.11.1','11. Dochody członka pracowniczego funduszu emerytalnego z tytułu',128,11,0,'A');
   _dod_zap('C.11.2','    przeniesienia akcji (art. 30a ust. 1 pkt 7 ustawy)',134,11,6,'A');
   _dod_zap('C.12.1','12. Przychody z tytułu zbycia prawa poboru akcji',140,12,0,'A');
   _dod_zap('C.12.2','    art. 30a ust. 1 pkt 8 ustawy)',146,12,6,'A');
   _dod_zap('C.13.1','13. Inne należności niewymienione w wierszach 1-12',152,13,0,'A');
   _dod_zap('C.13.2','',158,13,6,'A');
   _dod_zap('C.14.1','14. Suma pobranego zryczałtowanego podatku za poszczególne',164,14,0,'S');
   _dod_zap('C.14.2','    miesiące z wierszy 1-13',170,14,6,'S');
   _dod_zap('C.15.1','15. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',176,15,0,'R');
   _dod_zap('C.15.2','    za poszczególne miesiące - zgodnie z art. 28 Ordynacji podatkowej',182,15,6,'R');
   _dod_zap('C.16.1','16. Kwoty do wpłaty za poszczególne miesiące roku podatkowego',188,16,0,'S');
   _dod_zap('C.16.2','    Od kwot z wiersza 14 należy odpowiednio odjąć kwoty z wiersza 15 ',194,16,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\poz_pit11p_5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (20) dla 5 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=33 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=36 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=40 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=5 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=43 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=5 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=8 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=54 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=8 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=10 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=63 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=10 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=10 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',24,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.30 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',29,1,1,'A',2);
_dod_zap('E. 2.1','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',31,2,0,'A',4);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',34,3,0,'A',4);
_dod_zap('E. 4.1','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',38,4,0,'A',4);
_dod_zap('E. 5.1','5. Świadczenia wypłacone z Funduszów: Pracy i Gwarantowanych Świadczeń Pracown.',41,5,0,'A',4);
_dod_zap('E. 6.1','6. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4, 6 i 7-9',44,6,0,'A',4);
_dod_zap('E. 7.1','7. Czynności związane z pełnieniem obowiązków społecznych lub obywatelskich',48,7,0,'A',4);
_dod_zap('E. 8.1','8. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',52,8,0,'A',4);
_dod_zap('E. 8.2','   W poz.56 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3 ustawy.',55,8,1,'A',2);
_dod_zap('E. 9.11','9. Należności wynikające z umowy aktywizacyjnej',57,9,0,'A',4);
_dod_zap('E.10.1','10. Inne źródła',61,10,0,'A',4);

_dod_zap('F. 1','Składki na ubezpieczenia społeczne, o których mowa w przepisach ustawy',65,11,0,'A',1);
_dod_zap('F. 2','Składki na ubezpieczenie zdrowotne, o których mowa w przepisach ustawy',67,12,0,'A',1)


\poz_pit40p_4
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-40 dla 4 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! {? _d>=9
              || ($('VAT_POZ.P'+$(_ind+3)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind+3)))():=($('pit['+$(_c+_ind)+']'))()
              || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=32 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=35 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=38 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=6 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=45 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=6 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=12 || VAT_POZ.RODZ:=pit[60] ?};
              {? _d=20 || VAT_POZ.RODZ:=pit[69] ?}

           !};
           VAT_POZ.add";

_dod_zap('F. 1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',24,1,0,'A',4);
_dod_zap('F. 1.2','   W poz.29 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',28,1,1,'A',2);
_dod_zap('F. 2','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',30,2,0,'A',4);
_dod_zap('F. 3','3. Emerytury - renty zagraniczne',33,3,0,'A',4);
_dod_zap('F. 4','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',36,4,0,'A',4);
_dod_zap('F. 5','5. Przychody z osobiście wykonywanej dział., o której mowa w art.13 ustawy',39,5,0,'A',4);
_dod_zap('F. 6','6. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',43,6,0,'A',4);
_dod_zap('F. 6.2','   W poz.47 należy wykazać przychody, do których zastosowano 50% koszty art.22',46,6,1,'A',2);
_dod_zap('F. 7','7. Inne źródła',48,7,0,'A',4);
_dod_zap('F. 8','8. RAZEM Suma kwot z wierszy od 1 do 7.',52,8,0,'A',4);
_dod_zap('G. 1','Składki na ubezpieczenia społeczne',56,9,0,'A',1);
_dod_zap('G. 2',' w tym zagraniczne, o których mowa w art.26 ust.1 pkt 2a ustawy',57,10,0,'A',1);
_dod_zap('G. 3','Zwrot nienależnie pobranych świadczeń',58,11,0,'A',1);
_dod_zap('G. 4','Inne odliczenia od dochodu, niewymienione w poz.57 i 59 3)',60,12,0,'A',1);
_dod_zap('H.1.1','Podstawa obliczenia podatku (po zaokrągleniu do pełnych złotych)',61,13,0,'A',1);
_dod_zap('H.1.2','Obliczony podatek - zgodnie z art.27 ustawy. Podatek od podstawy z poz.62.',62,14,0,'A',1);
_dod_zap('H.1.3','Doliczenie do podatku',63,15,0,'A',1);
_dod_zap('H.1.4','Podatek. Do kwoty z poz.63 należy dodać kwotę z poz.64.',64,16,0,'A',1);
_dod_zap('H.2.1','Składki na ubezpieczenie zdrowotne',65,17,0,'A',1);
_dod_zap('H.2.2',' w tym zagraniczne, o których mowa w art.27b ust.1 pkt 2 ustawy',66,18,0,'A',1);
_dod_zap('H.2.3','Kwota składek z poz.66, możliwa do odliczenia w roku podatkowym',67,19,0,'A',1);
_dod_zap('H.2.4','Inne odliczenia od podatku,niewymienione w poz.66 3)',69,20,0,'A',1);
_dod_zap('H.3.1','Podatek należny (po zaokrągleniu do pełnych złotych)',70,21,0,'A',1);
_dod_zap('H.3.2','Różnica pomiędzy podatkiem należnym a sumą zaliczek pobranych przez płatnika - DO ZAPŁATY',71,22,0,'A',1);
_dod_zap('H.3.3','Różnica pomiędzy sumą zaliczek pobranych przez płatnika a podatkiem należnym - NADPŁATA',72,23,0,'A',1)


\drukuj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: GS [12.30]
:: OPIS: Formula wyswietla menu popup umozliwiajace wydrukowanie pitu i zmiane trybu drukowania
::   WE: _a [STRING]  - identyfikator formularza
::       _b [STRING]  - nazwa pliku zawierajacego definicje wydruku
::       _c [INTEGER] - czy wyświetlać pytanie o podpis (domyślnie nie)
::       _d [INTEGER] - czy pełna ścieżka do pliku czy tylko sama nazwa
::----------------------------------------------------------------------------------------------------------------------
_tekst:="~-_a+' '+exec('form_opis','pit',_a)+' '+exec('tryb_nazwa','pit',_a)";
_podpis:={? var_pres('_c')=type_of(0)  || _c || 0  ?};

_ask:={? _podpis
      || "_ext:='bmp';
         {? exec('tryb_pdf','pit','"+_a+"')='T'
         || _ext:='png'
         ?};
         exec('ask4File','podpis',_ext,1,0,'dek');"
      || ''
      ?};

{!
|? __zostaw:=0;
   popup(0,'Wzorce sprawozdań'@,
      _tekst(_a),,$(_ask+'rep_exec(\''+_b+'\');__zostaw:=1'),
      '---',,,
      'Zmiana ustawień trybu drukowania formularza'@,,$('exec(\'tryb_ustaw\',\'pit\',\''+_a+'\');__zostaw:=1')
   );
   __zostaw
!};
&__zostaw


\pit8c_ini
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula do wyswietlenia okna deklaracji PIT-8C dla pracownika lub zleceniobiorcy
::   WE: _a - String oznaczenie rodzaju deklaracji
::      [_b] [integer]  - rok dla deklaracji
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || '' ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0  ?};

{? _pitTyp='' || return(0) ?};

_wynik:=0;
_TPAR:=exec('tab_rok','edeklar','Deklaracje'@);
_TPAR.ROK:={? _rok || _rok || date()~1 ?};
params_set('TPAR',_TPAR);

{? _rok=0
|| _okedit:=_TPAR.edit("_par:=params_get(); _TPAR:=_par.TPAR;
               {? _TPAR.ROK>=2013
               || 1
               || FUN.emsg('E-deklaracje są dostępne tylko od 2013 roku.'@);
                  return('ROK')
               ?}")
|| _TPAR.ROK:=_rok;
   _okedit:=1
?};
{? _okedit
|| {? _TPAR.ROK=2013
   || datapoc:=date(2013,10,10);
      datakon:=date(_TPAR.ROK,12,0)
   |? _TPAR.ROK=2014
   || datapoc:=date(2014,12,5);
      datakon:=date(_TPAR.ROK,12,0)
   || datapoc:=date(_TPAR.ROK,1,1);
      datakon:=date(_TPAR.ROK,12,0)
   ?};
   okres:=$_TPAR.ROK;
   pit_typ:=_a;
   SKID.DEKL_NAZ:='PIT8C';
   {? _a='PIT8CZ'
   || rodzdekl:='L'
   || rodzdekl:='K'
   ?};
   __Rok:=_TPAR.ROK;
   __datver:={? __Rok=2013
             || date(2013,12,0)
             |? __Rok=2014
             || {? date>=date(2015,1,1) || date(2014,12,0) || date(2013,12,0) ?}
             |? __Rok>=2015 & __Rok<=2017
             || {? date>=date(2016,1,1) || date(2016,1,1) || date(2014,12,0) ?}
             |? __Rok=2018
             || {? date>=date(2019,1,1) || date(2018,1,1) || date(2016,1,1) ?}
:: Dla danych za rok 2020 ustalamy 10 wersje
             |? __Rok=2020
             || date(2019,1,1)
:: Dla danych za rok 2022 ustalamy 11 wersje
             |? __Rok>=2022
             || date(2022,8,10)
             || date(_TPAR.ROK,1,1)
             ?};
   rok_dekp:=date(0,0,0);
   _wynik:=1
?};
_wynik


\pit8c_end
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula zwiazana z funkcja pit8c_ini usuwajaca zmienne tworzone w tej funkcji
::----------------------------------------------------------------------------------------------------------------------
undefine;
VAR_DEL.delete('datapoc','datakon','okres','rodzdekl','__Rok','rok_dekp','__datver')


\pit8c_dod
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dla akcji Dolacz okna deklaracji PIT-8C dla pracownika/zleceniobiorcy
::   WE: _a - opcjonalny 1 Dolacz w grupie, 0 zwykla akcja Dolacz
::----------------------------------------------------------------------------------------------------------------------
_grupa:={? var_pres('_a')=type_of(0) & _a || _a || 0 ?};
EDIT_VAR.NR_EDIT:=1;
_dalej:=1;

P.cntx_psh();
{? _grupa
||
:: wybranie pracowników do dalszego przetwarzania
   _args:=exec('wybierz_args','pracownik');
   _args.WIELU:=0;
   _args.DOMAIN:='PPL';
   _args.UD_SCH:=UD_DEF.UD_SCH;
   _args.UD_SKL:=UD_DEF.UD_SKL;
   _args.F_ZATR:=P_FILTER.F_ZATR().KOD;
   _args.VIEW:=P_FILTER.STATUS;
   _args.SQL_FROM:='';
   _args.HDR_SEL:={? P_FILTER.F_ZATR().KOD='P' || 'Wybór pracowników'@ || 'Wybór zleceniobiorców'@ ?};

   _wyb:=exec('wybierz','pracownik',_args);

   {? _wyb.STATUS<>''
   || FUN.info(_wyb.STATUS)
   ?};

   {? _wyb.P.SQL<>''
   || P.prefix();
      {? P.seek(_wyb.P.SQL)
      || P.OSOBA()
      || _dalej:=0
      ?}
   || _dalej:=0
   ?};
   EDIT_VAR.NR_EDIT:=0
?};
{? _dalej & P.F_ZATR().KOD<>'P' & P.F_ZATR().KOD<>'Z'
|| FUN.emsg('Deklaracja PIT-8C dostępna jest tylko dla pracowników i zleceniobiorców.'@);
   _dalej:=0
?};
{? ~_dalej
|| P.cntx_pop();
   return(0)
?};
{? ~exec('symbol_edek','edeklar',date(__Rok,12,0))
|| FUN.emsg('Symbol urzędu dla e-Deklaracji nie jest wypełniony.'@
           +'\nDodanie deklaracji %1 nie jest możliwe.'@[SKID.DEKL_NAZ]
           +'\nUzupełnij brakujące informacje w kartotece Urzędy skarbowe.'@);
   P.cntx_pop();
   return(0)
?};
_tab_err:=tab_tmp(1,'EL','STRING[50]','Element'@);
{? ~exec('spr_wymagane','edeklar',pit_typ,__Rok,_tab_err)
|| _textb:=exec('text_err','edeklar',_tab_err);
   _kto:={? pit_typ='PIT8CP' || P.T || '' ?}+' '+OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE;
   FUN.emsg('%1\nDodanie deklaracji %2 nie jest możliwe.\nBrak wypełnionych wymaganych danych: \n%3.'@
            [_kto,SKID.DEKL_NAZ,_textb]);
   P.cntx_pop();
   return(0)
?};

_ok:=0;
VAT_DEK.win_edit('PIT8C');
VAT_DEK.hdr_edit();
_tytokno:={? pit_typ='PIT8CP' || ' pracownika: '@ || ' zleceniobiorcy: '@ ?};
VAT_DEK.hdr_edit(_tytokno+P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE);
VAT_DEK.blank();
::ustawienie * do pola Numer wersji
VAT_DEK.efld_opt(VAT_DEK.win_edit('?'),'mark=%1'[$EDIT_VAR.NR_EDIT],VAT_DEK,'NR');
:: ustawienie pól
exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,VAT_DEK.win_edit('?'));
{?_grupa || VAT_DEK.PIT_GRUP:=PIT_GRUP.ref() ?};
VAT_DEK.P:=P.ref;
VAT_DEK.OS_PODAT:=P.OSOBA;
VAT_DEK.ROK:=null();
VAT_DEK.RODZAJ:=rodzdekl;
VAT_DEK.TYP:=pit_typ;
VAT_DEK.OKRES:=okres;
VAT_DEK.OPIS:={? _grupa || PIT_GRUP.OPIS || 'Deklaracja '+SKID.DEKL_NAZ ?};
_use:=userdata;
VAT_DEK.IMIE:=~-{? _im:=_use*' ' || (_im-1)+_use || _use ?};
VAT_DEK.NAZ:=~-{? _im || _im-_use || '' ?};
VAT_DEK.STN:=exec('stanowisko','edeklar');
VAT_DEK.DATA:=date;
_ver:=1;
VAT_DEK.cntx_psh;
VAT_DEK.index('VAT_PRAC');
VAT_DEK.prefix(P.ref,rodzdekl,rok_dekp,okres,pit_typ);
{? VAT_DEK.last || _ver:=VAT_DEK.WER+1 ?};
VAT_DEK.cntx_pop;
VAT_DEK.WER:=_ver;

_refnr:=null;
{? _grupa
|| _refnr:=PIT_GRUP.NR
|| VAT_VER.index('VER_OD');
   VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ);
   {? VAT_VER.find_le(__datver)
   || {? __datver~1=VAT_VER.OD~1
      || _refnr:=VAT_VER.ref
      ?}
   ?}
?};
VAT_DEK.NR:=_refnr;

VAT_DEK.memo_set(,'OPISKOR');
{? VAT_DEK.edit("exec('pit8c_rec','edeklar')")
|| exec('stanowisko','edeklar','set',VAT_DEK.STN);
   _vern:=VAT_DEK.NR().NR;
   {? _vern=6 | _vern=7 | _vern=8 | _vern=9 | _vern=10 | _vern=11
   || {? _vern=7 | _vern=8
      || exec('init_pit8c_6','pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.GIODO,VAT_DEK.GIODODAT);
         _dane:=exec('obl_pit8c_6','pit')
      ||
::       Ustalenie pliku fml dla wersji 11 od 2022 roku i wyższych jest to pit1.fml dla poprzednich pit.fml
         _fml:={? _vern>=11 || 'pit1' || 'pit' ?};
         exec('init_pit8c_'+$_vern,_fml,pit_typ,VAT_DEK.TWORZ,VAT_DEK.GIODO,VAT_DEK.GIODODAT);
         _dane:=exec('obl_pit8c_'+$_vern,_fml)
      ?};
      {? _dane>0
      || {? _vern=6 | _vern=7 | _vern=8 | _vern=9
         || VAT_DEK.US:=pit[5];
            {? 1+pit[10]='P'
            || VAT_DEK.PESEL:=1-pit[10]
            |? 1+pit[10]='N'
            || VAT_DEK.NIP:=1-pit[10]
            ?};
            VAT_DEK.NAZWISKO:=pit[11]; VAT_DEK.PIERWSZE:=pit[12]; VAT_DEK.DATA_UR:=pit[13];
            VAT_DEK.KRAJ:={? type_of(pit[14])=type_of(null) || pit[14] || null ?};
            VAT_DEK.WOJEWODZ:=pit[15]; VAT_DEK.POWIAT:=pit[16]; VAT_DEK.GMINA:=pit[17];
            VAT_DEK.ULICA:=pit[18]; VAT_DEK.DOM:=pit[19]; VAT_DEK.LOKAL:=pit[20];
            VAT_DEK.MIASTO:=pit[21]; VAT_DEK.KOD:=pit[22]; VAT_DEK.POCZTA:=pit[23];
            VAT_DEK.POD:={? _vern<9 || pit[51] || pit[40] ?}
         |? _vern=10 | _vern=11
         || VAT_DEK.US:=pit[5];
            {? 1+pit[10]='P'
            || VAT_DEK.PESEL:=1-pit[10]
            |? 1+pit[10]='N'
            || VAT_DEK.NIP:=1-pit[10]
            ?};
            VAT_DEK.NAZWISKO:=pit[11]; VAT_DEK.PIERWSZE:=pit[12]; VAT_DEK.DATA_UR:=pit[13];
            VAT_DEK.KRAJ:={? type_of(pit[14])=type_of(null) || pit[14] || null ?};
            VAT_DEK.WOJEWODZ:=pit[15]; VAT_DEK.POWIAT:=pit[16]; VAT_DEK.GMINA:=pit[17];
::          Ze względu na ograniczenie po stronie PITów, pole ulica może przyjmować maksymalnie 65 znaków
            VAT_DEK.ULICA:={? +pit[18]<=65 || pit[18] || STR.split(pit[18]); STR.line(65) ?};
            VAT_DEK.DOM:=pit[19]; VAT_DEK.LOKAL:=pit[20];
            VAT_DEK.MIASTO:=pit[21]; VAT_DEK.KOD:=pit[22];
            VAT_DEK.POD:=pit[39]
         ?};
         {? VAT_DEK.add
         || VAT_DEK.memo_put(,'OPISKOR');
            {? _grupa
            || {? VAT_DEK.f_active()>0 || VAT_DEK.f_rfresh() ?}
            ?};
            {? _vern=8
            || exec('pit8c_7_poz','edeklar')
            || exec('pit8c_'+$_vern+'_poz','edeklar')
            ?}
         ?}
      |? _dane<0
      || FUN.emsg('Deklaracja PIT-8C została już %1\n Nie dodano kolejnej deklaracji.'@
            [{? _dane=-1 || ' wykonana.' || ' wydrukowana.' ?}])
      || FUN.emsg('Brak informacji do wykazania na deklaracji PIT-8C\n (brak przychodów do wykazania).'@)
      ?};
      exec('end_pit8c_6','pit')
   ?}
?};
P.cntx_pop()


\pit8c_dod_gr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula generuje deklaracje podatkowe dla danej grupy
::----------------------------------------------------------------------------------------------------------------------
{? ~FUN.ask('Czy na pewno rozpocząć proces tworzenia deklaracji PIT-8C?'@) || return() ?};
_grpit:=0;
VAT_DEK.cntx_psh;
VAT_DEK.index('VAT_PITG');
VAT_DEK.prefix(PIT_GRUP.ref);
{? VAT_DEK.first || _grpit:=1 ?};
VAT_DEK.cntx_pop;
{? _grpit & ~FUN.ask('Istnieją Deklaracje PIT-8C wygenerowane w wybranej grupie.\nCzy kontynuować?'@) || return() ?};
PIT_EDIT.win_edit('PIT8C');
PIT_EDIT.blank;
PIT_EDIT.ROK:=PIT_GRUP.ROK;
PIT_EDIT.TYP:=PIT_GRUP.TYP;
PIT_EDIT.NR:=PIT_GRUP.NR;
PIT_EDIT.DATA:=PIT_GRUP.DATA_UTW;
PIT_EDIT.OPIS:=PIT_GRUP.OPIS;
_use:=userdata;
PIT_EDIT.IMIE:=~-{? _im:=_use*' ' || (_im-1)+_use || _use ?};
PIT_EDIT.NAZ:=~-{? _im || _im-_use || '' ?};
PIT_EDIT.STN:=exec('stanowisko','edeklar');
exec('vat_dek_efld_opt','edeklar','*',PIT_EDIT,PIT_EDIT.win_edit('?'));
_ok:=PIT_EDIT.edit("exec('pit8c_rec_gr','edeklar')");
{? ~_ok || return() ?};
exec('stanowisko','edeklar','set',PIT_EDIT.STN);
_opiskor:={? PIT_EDIT.KOR='T' || PIT_EDIT.OPISKOR || '' ?};
:: wybranie pracowników do dalszego przetwarzania
_args:=exec('wybierz_args','pracownik');
_args.DOMAIN:='PPL';
_args.UD_SCH:=UD_DEF.UD_SCH;
_args.UD_SKL:=UD_DEF.UD_SKL;
_args.F_ZATR:=P_FILTER.F_ZATR().KOD;
_args.VIEW:='W';
_args.SQL_FROM:='';
_args.HDR_SEL:='Wybór pracowników'@;

_wyb:=exec('wybierz','pracownik',_args);
{? _wyb.STATUS<>''
|| FUN.info(_wyb.STATUS)
?};

_test:="1";
_tab:=_wyb.P;
OSOBA.cntx_psh();
P.cntx_psh();
P.prefix();
_tab.cntx_psh();
_bledy:=0;
_vern:=PIT_GRUP.NR().NR;
_ile:=0;
::Ustalenie pliku fml dla wersji 11 od 2022 roku i wyższych jest to pit1.fml dla poprzednich pit.fml
_fml:={? _vern>=11 || 'pit1' || 'pit' ?};

{? _tab.first
|| {? _vern=6 | _vern=7 | _vern=8 | _vern=9 | _vern=10 | _vern=11
   || {? _vern=7 | _vern=8
      || exec('init_pit8c_6','pit',PIT_GRUP.TYP,PIT_EDIT.TWORZ,PIT_EDIT.GIODO,PIT_EDIT.GIODODAT)
      || exec('init_pit8c_'+$_vern,_fml,PIT_GRUP.TYP,PIT_EDIT.TWORZ,PIT_EDIT.GIODO,PIT_EDIT.GIODODAT)
      ?};
      VAT_DEK.clear;
      RAPLS.ustaw(1);
      _tab_err:=tab_tmp(1,'EL','STRING[50]','Element'@);
      _licz:=0;
      _size:=_tab.size;
      _prgs:=100*_licz/_size;
      progress(_prgs,'Tworzenie deklaracji PIT-8C.'@,'Proszę czekać...'@);
      {!
      |? {? P.seek(_tab.SQL)
         || P.OSOBA();
            _licz+=1;
            _prgs:=100*_licz/_size;
            progress(_prgs,'Tworzenie deklaracji PIT-8C.'@,'Proszę czekać...'@);
            {? _test()
            || _symb:=exec('symbol_edek','edeklar',date(__Rok,12,0));
               _tab_err.erase;
               _wymdane:=exec('spr_wymagane','edeklar',pit_typ,__Rok,_tab_err);

               {? _vern=7 | _vern=8
               || _kw_dek:=exec('obl_pit8c_6','pit',_symb & _wymdane)
               || _kw_dek:=exec('obl_pit8c_'+$_vern,_fml,_symb & _wymdane)
               ?};
               {? _kw_dek>0 & _symb & _wymdane
               || VAT_DEK.blank;
                  VAT_DEK.memo_set(,'OPISKOR');
                  VAT_DEK.ROK:=null();
                  VAT_DEK.RODZAJ:=rodzdekl;
                  VAT_DEK.TYP:=pit_typ;
                  VAT_DEK.OKRES:=okres;
                  VAT_DEK.OPIS:=PIT_EDIT.OPIS;
                  VAT_DEK.IMIE:=PIT_EDIT.IMIE;
                  VAT_DEK.NAZ:=PIT_EDIT.NAZ;
                  VAT_DEK.STN:=PIT_EDIT.STN;
                  VAT_DEK.DATA:=PIT_EDIT.DATA;
                  VAT_DEK.TWORZ:=PIT_EDIT.TWORZ;
                  VAT_DEK.PODATNIK:=PIT_EDIT.PODATNIK;
                  VAT_DEK.KOR:=PIT_EDIT.KOR;
                  VAT_DEK.GIODO:=PIT_EDIT.GIODO;
                  VAT_DEK.GIODODAT:=PIT_EDIT.GIODODAT;
                  _ver:=1;
                  VAT_DEK.cntx_psh;
                  VAT_DEK.index('VAT_PRAC');
                  VAT_DEK.prefix(P.ref,rodzdekl,rok_dekp,okres,pit_typ);
                  {? VAT_DEK.last || _ver:=VAT_DEK.WER+1 ?};
                  VAT_DEK.cntx_pop;
                  VAT_DEK.WER:=_ver;
                  VAT_DEK.NR:=PIT_EDIT.NR;
                  P.OSOBA().NAZWISKO;

                  {? _vern=6 | _vern=7 | _vern=8 | _vern=9
                  || VAT_DEK.US:=pit[5];
                     {? 1+pit[10]='P'
                     || VAT_DEK.PESEL:=1-pit[10]
                     |? 1+pit[10]='N'
                     || VAT_DEK.NIP:=1-pit[10]
                     ?};
                     VAT_DEK.NAZWISKO:=pit[11]; VAT_DEK.PIERWSZE:=pit[12]; VAT_DEK.DATA_UR:=pit[13];
                     VAT_DEK.KRAJ:={? type_of(pit[14])=type_of(null) || pit[14] || null ?};
                     VAT_DEK.WOJEWODZ:=pit[15]; VAT_DEK.POWIAT:=pit[16];
                     VAT_DEK.GMINA:=pit[17]; VAT_DEK.ULICA:=pit[18]; VAT_DEK.DOM:=pit[19]; VAT_DEK.LOKAL:=pit[20];
                     VAT_DEK.MIASTO:=pit[21]; VAT_DEK.KOD:=pit[22]; VAT_DEK.POCZTA:=pit[23];
                     VAT_DEK.POD:={? _vern<9 || pit[51] || pit[40] ?}
                  |? _vern=10 | _vern=11
                  || VAT_DEK.US:=pit[5];
                     {? 1+pit[10]='P'
                     || VAT_DEK.PESEL:=1-pit[10]
                     |? 1+pit[10]='N'
                     || VAT_DEK.NIP:=1-pit[10]
                     ?};
                     VAT_DEK.NAZWISKO:=pit[11]; VAT_DEK.PIERWSZE:=pit[12]; VAT_DEK.DATA_UR:=pit[13];
                     VAT_DEK.KRAJ:={? type_of(pit[14])=type_of(null) || pit[14] || null ?};
                     VAT_DEK.WOJEWODZ:=pit[15]; VAT_DEK.POWIAT:=pit[16]; VAT_DEK.GMINA:=pit[17];
::                   Ze względu na ograniczenie po stronie PITów, pole ulica może przyjmować maksymalnie 65 znaków
                     VAT_DEK.ULICA:={? +pit[18]<=65 || pit[18] || STR.split(pit[18]); STR.line(65) ?};
                     VAT_DEK.DOM:=pit[19]; VAT_DEK.LOKAL:=pit[20];
                     VAT_DEK.MIASTO:=pit[21]; VAT_DEK.KOD:=pit[22];
                     VAT_DEK.POD:=pit[39]
                  ?};

                  VAT_DEK.PIT_GRUP:=PIT_GRUP.ref;
                  VAT_DEK.P:=P.ref;
                  VAT_DEK.OS_PODAT:=OSOBA.ref;
                  {? VAT_DEK.add
                  || VAT_DEK.memo_set(_opiskor,'OPISKOR');
                     VAT_DEK.memo_put(,'OPISKOR');
                     {? _vern=8
                     || exec('pit8c_7_poz','edeklar')
                     || exec('pit8c_'+$_vern+'_poz','edeklar')
                     ?};
                     _ile+=1
                  ?}
               || {? _kw_dek>0 & ~_symb
                  || _bledy:=1;
                     RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,
                               'Symbol urzędu dla e-Deklaracji nie jest wypełniony.',
                               'Dodanie deklaracji '+SKID.DEKL_NAZ+' nie jest możliwe.')
                  |? _kw_dek<0 & _kw_dek=-2
                  || _bledy:=1;
                     RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,
                               'Deklaracja PIT-8C została już wydrukowana.',
                               'Nie dodano kolejnej deklaracji.')
                  |? _kw_dek & _wymdane=0
                  || _bledy:=1;
                     _textb:=exec('text_err','edeklar',_tab_err);
                     RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,
                               'Dodanie deklaracji '+SKID.DEKL_NAZ+' nie jest możliwe.',
                               'Brak wypełnionych wymaganych danych: ',
                               _textb+'.')
                  ?}
               ?}
            ?}
         ?};
         ~{? escape
          || FUN.ask('\nCzy przerwać tworzenie deklaracji PIT-8C?'@)
          ?}
          & _tab.next
      !};
      prgs_clr();
      exec('end_pit8c_6','pit')
   ?}
?};
P.cntx_pop();
OSOBA.cntx_pop();
_tab.cntx_pop();
RAPLS.raport({? PIT_GRUP.RODZAJ='A' || 7 || 8 ?});
RAPLS.ustaw(0);
FUN.emsg('Zakończono proces tworzenia deklaracji PIT-8C.\nIlość utworzonych deklaracji: %1.'@[$_ile])


\pit8c_grup
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula wyswietla grupy deklaracji podatkowych PIT-8C
::   WE: _a - String oznaczenie rodzaju deklaracji np. 'PIT8C'
::       [_b] [INTEGER] - rok deklaracji podatkowej
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || return(~~) ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0          ?};
{? exec('pit8c_ini','edeklar',_pitTyp,_rok)
|| USERS.cntx_psh();
   OGRANICZ.blank(1);
   SKID.TYP_ZAP:=SKID.DEKL_NAZ;
   PIT_GRUP.clear();
   PIT_GRUP.index('RODZAJP');
   EDIT_VAR.cntx_psh();
   EDIT_VAR.PIT_RODZ:={? _a='PIT8CP' || 'A' || 'B' ?};
   {? EDIT_VAR.PIT_RODZ='A'
   || _tytul:='Płace'; EDIT_VAR.OBSZAR:='Pracownicy etatowi'
   || _tytul:='Umowy/Zlecenia'; EDIT_VAR.OBSZAR:='Zleceniobiorcy'
   ?};
   PIT_GRUP.prefix(EDIT_VAR.PIT_RODZ,__Rok);
   PIT_GRUP.win_sel('PIT8C');
   PIT_GRUP.hdr_sel();
   PIT_GRUP.hdr_sel(': %1 z roku %2'@[_tytul,$__Rok]);
   PIT_GRUP.select(,1,10);
   EDIT_VAR.cntx_pop();
   USERS.cntx_pop()
?}


\pit8c_rec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula sprawdza poprawnosc danych w rekordzie tabeli VAT_DEK dla PIT-8C
::----------------------------------------------------------------------------------------------------------------------
_spr:=__CHK.record(VAT_DEK,,'NR','OPIS');
{? _spr=''
|| {? VAT_DEK.KOR='T'
   || {? __Rok>=2018
      || _spr:=''
      || _spr:=__CHK.record(VAT_DEK,,'OPISKOR')
      ?}
   ?}
?};
{? _spr=''
|| {? VAT_DEK.GIODO='T'
   || _spr:=__CHK.record(VAT_DEK,,'GIODODAT')
   ?}
?};
{? _spr='' || _spr:=__CHK.record(VAT_DEK,,'IMIE','NAZ','STN','DATA') ?};

:: czyszczenie pól
{? _spr=''
|| {? VAT_DEK.GIODO='N' & VAT_DEK.GIODODAT<>date(0,0,0)
   || VAT_DEK.GIODODAT:=date(0,0,0)
   ?}
?};
{? _spr=''
|| {? VAT_DEK.KOR='N'
   || VAT_DEK.memo_set(,'OPISKOR')
   ?}
?};
_spr


\pit8c_rec_gr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Funkcja sprawdza poprawnosc wypelnienia zmiennej PIT_EDIT - parametrow tworzenia grupowych deklaracji PIT-8C
::----------------------------------------------------------------------------------------------------------------------
_spr:=__CHK.record(PIT_EDIT,,'OPIS');
{? _spr=''
|| {? PIT_EDIT.KOR='T'
   || {? __Rok>=2018 || _spr:='' || _spr:=__CHK.record(PIT_EDIT,,'OPISKOR') ?}
   || PIT_EDIT.OPISKOR:='';
      win_disp()
   ?}
?};
{? _spr=''
|| {? PIT_EDIT.GIODO='T'
   || _spr:=__CHK.record(PIT_EDIT,,'GIODODAT')
   ?}
?};
{? _spr=''
|| {? PIT_EDIT.GIODO='N' & PIT_EDIT.GIODODAT<>date(0,0,0)
   || PIT_EDIT.GIODODAT:=date(0,0,0);
      win_disp
   ?}
?};
{? _spr='' || _spr:=__CHK.record(PIT_EDIT,,'IMIE','NAZ','STN','DATA') ?};
_spr


\pit8c_6_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8C (6) dla wersji 6
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! {? (_d=1 | _d=2 | _d=3 | _d=4) & _ind=4
          || {? _d<4 || VAT_POZ.RODZ:=pit[_c-1] ?};
             VAT_POZ.P4:=_c;
             VAT_POZ.KW4:=pit[_c]
          |? _d=5
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d>=6 & _d<=10 & (_ind=1 | _ind=2)
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=11
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=12 & _ind=4
          || VAT_POZ.P4:=_c;
             VAT_POZ.KW4:=pit[_c]
          ?}
       !};VAT_POZ.add()";

_dod_zap('D.  1','1. Rodzaj przychodu',25,1,0,'A');
_dod_zap('D.  2','2. Rodzaj przychodu',27,2,0,'A');
_dod_zap('D.  3','3. Rodzaj przychodu',29,3,0,'A');
_dod_zap('D.  4','4. Razem',30,4,0,'S');
_dod_zap('E.  5','5. Informacja o wysokości wypłaconego stypendium, o którym mowa w art. 21 ust. 1 punkt 40b ustawy ',31,5,0,'A');
_dod_zap('F.  6','6. Odpłatne zbycie papierów wartościowych',35,6,0,'A');
_dod_zap('F.  7','7. Realizacja praw wynikających z papierów wartościowych',37,7,0,'A');
_dod_zap('F.  8','8. Odpłatne zbycie pochodnych instrumentów finansowych oraz realizacja praw z nich wynikających',39,8,0,'A');
_dod_zap('F.  9','9. Odpłatne zbycie udziałów w spólkach mających osobowość prawną',41,9,0,'A');
_dod_zap('F. 10','10. Objęcie udziałów (akcji) w spółkach mających osobowość prawną albo wkładów spółdzielniach'+
         ' w zamian za wkład niepieniężny w innej postaci niż przędsiębiorstwo lub jego zorganizowana część',43,10,0,'A');
_dod_zap('F. 11','11. Razem. Suma kwot wierszy 9-13. ',45,11,0,'S');
_dod_zap('G. 12','12.Przychód z odpłatnego zbycia papierów wartościowych',49,12,0,'A')


\ift1_ini
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula do wyswietlenia okna deklaracji IFT-1/IFT-1R dla zleceniobiorcy
::   WE: _a - String oznaczenie rodzaju deklaracji
::      [_b] [integer]  - rok dla deklaracji
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || '' ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0  ?};

{? _pitTyp='' || return(0) ?};

_wynik:=0;
_TPAR:=exec('tab_rok','edeklar','Deklaracje'@);
_TPAR.ROK:={? _rok || _rok || date()~1 ?};
params_set('TPAR',_TPAR);

{? _rok=0
|| _okedit:=_TPAR.edit("_par:=params_get(); _TPAR:=_par.TPAR;
               {? _TPAR.ROK>=2013
               || 1
               || FUN.emsg('E-deklaracje są dostępne tylko od 2013 roku.'@);
                  return('ROK')
               ?}")
|| _TPAR.ROK:=_rok;
   _okedit:=1
?};
{? _okedit
|| {? _TPAR.ROK=2013
   || datapoc:=date(2013,10,10);
      datakon:=date(_TPAR.ROK,12,0)
   |? _TPAR.ROK=2014
   || {? date>=date(2015,1,1)
      || datapoc:=date(_TPAR.ROK,12,22);
         datakon:=date(_TPAR.ROK,12,0)
      || datapoc:=date(_TPAR.ROK,1,1);
         datakon:=date(_TPAR.ROK,12,0)
      ?}
   || datapoc:=date(_TPAR.ROK,1,1);
      datakon:=date(_TPAR.ROK,12,0)
   ?};
   okres:=$_TPAR.ROK;
   pit_typ:=_a;
   SKID.DEKL_NAZ:='IFT1';
   rodzdekl:='F';
   __Rok:=_TPAR.ROK;
   __datver:={? __Rok=2013
             || date(2013,12,0)
             |? __Rok=2014
             || {? date>=date(2015,1,1) || date(2014,12,0) || date(2013,12,0) ?}
             |? __Rok>=2015 & __Rok<=2017
             || {? date>=date(2016,1,1) || date(2016,1,1) || date(2015,2,13) ?}
             |? __Rok=2018
             || {? date>=date(2019,1,1) || date(2018,1,1) || date(2016,1,1) ?}
:: Dla danych za rok 2020 ustalamy 15 wersje oraz 16 wersje rozporzadzenie 28.12.2020
             |? __Rok=2020
             || {? date>=date(2021,1,1) || date(2021,1,1) || date(2019,1,1) ?}
:: Dla danych za rok 2022 ustalamy 16 wersje ale 2 wersja schemy
             |? __Rok=2022
             || date(2021,1,1)
             || date(_TPAR.ROK,1,1)
             ?};
   rok_dekp:=date(0,0,0);
   _wynik:=1
?};
_wynik


\ift1_end
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula zwiazana z funkcja ift1_ini usuwajaca zmienne tworzone w tej funkcji
::----------------------------------------------------------------------------------------------------------------------
undefine;
VAR_DEL.delete('datapoc','datakon','pit_typ','okres','rodzdekl','__Rok','rok_dekp','__datver')


\ift1_dod
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dla akcji Dolacz okna deklaracji IFT-1/R dla zleceniobiorcy
::   WE: _a - opcjonalny 1 Dolacz w grupie, 0 zwykla akcja Dolacz
::----------------------------------------------------------------------------------------------------------------------
_grupa:={? var_pres('_a')=type_of(0) & _a || _a || 0 ?};
EDIT_VAR.NR_EDIT:=1;
_dalej:=1;

P.cntx_psh();
{? _grupa
||
:: wybranie pracowników do dalszego przetwarzania
   _args:=exec('wybierz_args','pracownik');
   _args.WIELU:=0;
   _args.DOMAIN:='PPL';
   _args.UD_SCH:=UD_DEF.UD_SCH;
   _args.UD_SKL:=UD_DEF.UD_SKL;
   _args.F_ZATR:=P_FILTER.F_ZATR().KOD;
   _args.VIEW:=P_FILTER.STATUS;
   _args.SQL_FROM:='';
   _args.HDR_SEL:='Wybór zleceniobiorców'@;

   _wyb:=exec('wybierz','pracownik',_args);

   {? _wyb.STATUS<>''
   || FUN.info(_wyb.STATUS)
   ?};

   {? _wyb.P.SQL<>''
   || P.prefix();
      {? P.seek(_wyb.P.SQL)
      || P.OSOBA()
      || _dalej:=0
      ?}
   || _dalej:=0
   ?};
   EDIT_VAR.NR_EDIT:=0
?};
{? _dalej & P.F_ZATR().KOD<>'Z'
|| FUN.emsg('Deklaracja IFT1/IFT1R dostępna jest tylko dla zleceniobiorców.'@);
   _dalej:=0
?};
{? ~_dalej
|| P.cntx_pop();
   return(0)
?};
{? _grupa
|| {? pit_typ='IFT1'
   || _choice:=1
   |? pit_typ='IFT1R'
   || _choice:=2
   || P.cntx_pop();
      return(0)
   ?}
|| _choice:=FUN.choice('Wybierz rodzaj deklaracji'@,,'I) IFT-1','R) IFT-1R')
?};
{? _choice=1
|| VAT_DEK.win_edit('IFT1');
   pit_typ:='IFT1';
   SKID.DEKL_NAZ:='IFT1'
|? _choice=2
|| VAT_DEK.win_edit('IFT1R');
   pit_typ:='IFT1R';
   SKID.DEKL_NAZ:='IFT1R'
|| P.cntx_pop();
   return(0)
?};

{? ~exec('symbol_edek','edeklar',date(__Rok,12,0))
|| FUN.emsg('Symbol urzędu dla e-Deklaracji nie jest wypełniony.'
            '\nDodanie deklaracji %1 nie jest możliwe.'
            '\nUzupełnij brakujące informacje w kartotece Urzędy skarbowe.'@[SKID.DEKL_NAZ]);
   P.cntx_pop();
   return(0)
?};
_tab_err:=tab_tmp(1,'EL','STRING[50]','Element'@);
{? ~exec('spr_wymagane','edeklar',pit_typ,__Rok,_tab_err)
|| _textb:=exec('text_err','edeklar',_tab_err);
   _kto:=P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE;
   FUN.emsg('%1\nDodanie deklaracji %2 nie jest możliwe.\nBrak wypełnionych wymaganych danych: \n%3.'@
            [_kto,SKID.DEKL_NAZ,_textb]);
   P.cntx_pop();
   return(0)
?};
::dodanie sprawdzenia czy sa informacje w kartotece OS_ZNIP
OS_ZNIP.index('OSOBAOD');
OS_ZNIP.prefix(OSOBA.ref);
{? ~OS_ZNIP.first
|| FUN.emsg('Dane dotyczące zagranicznych numerów identyfikacji nie są wypełnione.'@
        +'\nDodanie deklaracji %1 nie jest możliwe.'@[SKID.DEKL_NAZ]
        +'\nUzupełnij brakujące informacje w kartotece: \n"Zagraniczny numer identyfikacyjny podatnika."'@);
   P.cntx_pop();
   return(0)
?};

VAT_DEK.hdr_edit();
VAT_DEK.hdr_edit(': '+P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE);

VAT_DEK.blank();

::ustawienie * do pola Numer wersji
VAT_DEK.efld_opt(VAT_DEK.win_edit('?'),'mark=%1'[$EDIT_VAR.NR_EDIT],VAT_DEK,'NR');
:: ustawienie pozostałych pól
exec('vat_dek_efld_opt','edeklar','*',VAT_DEK,VAT_DEK.win_edit('?'));

{? _grupa || VAT_DEK.PIT_GRUP:=PIT_GRUP.ref() ?};
VAT_DEK.D1:={? _choice=2 || date(0,0,0) || date ?};
VAT_DEK.D2:=date;
VAT_DEK.OD:={? _choice=2 || date(#okres,1,1) || date(#okres,date~2,1) ?};
VAT_DEK.DO:={? _choice=2 || date(#okres,12,0) || date(#okres,date~2,0) ?};
VAT_DEK.P:=P.ref;
VAT_DEK.OS_PODAT:=P.OSOBA;
VAT_DEK.ROK:=null();
VAT_DEK.RODZAJ:=rodzdekl;
VAT_DEK.TYP:=pit_typ;
VAT_DEK.OKRES:=okres;
VAT_DEK.OPIS:={? _grupa || PIT_GRUP.OPIS || 'Deklaracja '+SKID.DEKL_NAZ ?};
_use:=userdata;
VAT_DEK.IMIE:=~-{? _im:=_use*' ' || (_im-1)+_use || _use ?};
VAT_DEK.NAZ:=~-{? _im || _im-_use || '' ?};
VAT_DEK.STN:=exec('stanowisko','edeklar');
VAT_DEK.DATA:=date;
_ver:=1;
VAT_DEK.cntx_psh;
VAT_DEK.index('VAT_PRAC');
VAT_DEK.prefix(P.ref,rodzdekl,rok_dekp,okres,pit_typ,);
{? VAT_DEK.last || _ver:=VAT_DEK.WER+1 ?};
VAT_DEK.cntx_pop;
VAT_DEK.WER:=_ver;
_dekl_naz:=SKID.DEKL_NAZ;
_refnr:=null;
{? _grupa
|| _refnr:=PIT_GRUP.NR
|| VAT_VER.index('VER_OD');
   VAT_VER.prefix(BPMN.SYM_DOM,SKID.DEKL_NAZ,SKID.DEKL_NAZ);
   {? VAT_VER.find_le(__datver)
   || {? __datver~1=VAT_VER.OD~1
      || _refnr:=VAT_VER.ref
      ?}
   ?}
?};
VAT_DEK.NR:=_refnr;

VAT_DEK.memo_set(,'OPISKOR');
{? VAT_DEK.edit("exec('ift1_rec','edeklar',1)")
|| exec('stanowisko','edeklar','set',VAT_DEK.STN);
   _vern:=VAT_DEK.NR().NR;
   {? _vern=10 | _vern=11 | _vern=12 | _vern=13 | _vern=14 | _vern=15 | _vern=16
   || {? __Rok>=2015 & _vern>=12 & ~exec('szukaj_osznip','edeklar',OSOBA.ref,VAT_DEK.DO)
      || FUN.emsg('Dane dotyczące zagranicznych numerów identyfikacji nie są wypełnione.'
                  '\nDodanie deklaracji %1 nie jest możliwe.'
                  '\nUzupełnij brakujące informacje lub zweryfikuj zakres obowiązywania danych '
                  '\nw kartotece: "Zagraniczny numer identyfikacyjny podatnika".'@[SKID.DEKL_NAZ]);
         P.cntx_pop();
         return(0)
      ?};
      {? _vern=11
      || exec('init_ift1_10','pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.GIODO,VAT_DEK.GIODODAT);
         _dane:=exec('obl_ift_10','pit',pit_typ,VAT_DEK.OD,VAT_DEK.DO)
      |? _vern=13 | _vern=14
      || exec('init_ift1_12','pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.GIODO,VAT_DEK.GIODODAT);
         _dane:=exec('obl_ift_12','pit',pit_typ,VAT_DEK.OD,VAT_DEK.DO)
      || exec('init_ift1_'+$_vern,'pit',pit_typ,VAT_DEK.TWORZ,VAT_DEK.GIODO,VAT_DEK.GIODODAT);
         _dane:=exec('obl_ift_'+$_vern,'pit',pit_typ,VAT_DEK.OD,VAT_DEK.DO)
      ?};
      {? _dane>0
      || {? _vern=10 | _vern=11
         || VAT_DEK.PAR1:=pit[79]; VAT_DEK.US:=pit[6];
            VAT_DEK.NAZWISKO:=pit[20]; VAT_DEK.PIERWSZE:=pit[21];
            VAT_DEK.OJCIEC:=pit[22]; VAT_DEK.MATKA:=pit[23]; VAT_DEK.DATA_UR:=pit[24]; VAT_DEK.UR_MIEJ:=pit[25];
            {? +pit[26]>13
            || VAT_DEK.ZNIP:=pit[26]
            || VAT_DEK.NIP:=pit[26]
            ?};
            VAT_DEK.KRAJPASZ:={? var_pres('[27]',pit)=type_of(null) || pit[27] || null ?};
            VAT_DEK.KRAJ:={? var_pres('[28]',pit)=type_of(null) || pit[28] || null ?};
            VAT_DEK.MIASTO:=pit[29]; VAT_DEK.KOD:=pit[30];
            VAT_DEK.ULICA:=pit[31]; VAT_DEK.DOM:=pit[32]; VAT_DEK.LOKAL:=pit[33]
         |? _vern=12 | _vern=13 | _vern=14
         || VAT_DEK.US:=pit[6];
            VAT_DEK.NAZWISKO:=pit[20]; VAT_DEK.PIERWSZE:=pit[21];
            VAT_DEK.OJCIEC:=pit[22]; VAT_DEK.MATKA:=pit[23]; VAT_DEK.DATA_UR:=pit[24]; VAT_DEK.UR_MIEJ:=pit[25];
            VAT_DEK.ZNIP:=pit[26];
            VAT_DEK.RZNIP:={? var_pres('[27]',pit)=type_of(null) || pit[27] || null ?};
            VAT_DEK.KRAJZNIP:={? var_pres('[28]',pit)=type_of(null) || pit[28] || null ?};
            VAT_DEK.KRAJ:={? var_pres('[29]',pit)=type_of(null) || pit[29] || null ?};
            VAT_DEK.MIASTO:=pit[30]; VAT_DEK.KOD:=pit[31];
            VAT_DEK.ULICA:=pit[32]; VAT_DEK.DOM:=pit[33]; VAT_DEK.LOKAL:=pit[34];
            VAT_DEK.POD:=pit[80]
         |? _vern=15 | _vern=16
         || VAT_DEK.US:=pit[6];
            VAT_DEK.NAZWISKO:=pit[19]; VAT_DEK.PIERWSZE:=pit[20];
            VAT_DEK.OJCIEC:=pit[21]; VAT_DEK.MATKA:=pit[22]; VAT_DEK.DATA_UR:=pit[23]; VAT_DEK.UR_MIEJ:=pit[24];
            VAT_DEK.ZNIP:=pit[25];
            VAT_DEK.RZNIP:={? var_pres('[26]',pit)=type_of(null) || pit[26] || null ?};
            VAT_DEK.KRAJZNIP:={? var_pres('[27]',pit)=type_of(null) || pit[27] || null ?};
            VAT_DEK.KRAJ:={? var_pres('[28]',pit)=type_of(null) || pit[28] || null ?};
            VAT_DEK.MIASTO:=pit[29]; VAT_DEK.KOD:=pit[30];
::          Ze względu na ograniczenie po stronie PITów, pole ulica może przyjmować maksymalnie 65 znaków
            VAT_DEK.ULICA:={? +pit[31]<=65 || pit[31] || STR.split(pit[31]); STR.line(65) ?};
            VAT_DEK.DOM:=pit[32]; VAT_DEK.LOKAL:=pit[33];
            {? _vern=16 || VAT_DEK.POD:=pit[87] || VAT_DEK.POD:=pit[79] ?}
         ?};
         {? VAT_DEK.add
         || VAT_DEK.memo_put(,'OPISKOR');
            {? _grupa
            || {? VAT_DEK.f_active()>0 || VAT_DEK.f_rfresh() ?}
            ?};
            {? _vern=13 | _vern=14
            || exec('poz_ift1_12','edeklar')
            || exec('poz_ift1_'+$_vern,'edeklar')
            ?}
         ?}
      |? _dane<0
      || FUN.emsg('Deklaracja %1 została już wykonana.\n Nie dodano kolejnej deklaracji.'@[SKID.DEKL_NAZ])
      || FUN.emsg('Brak informacji do wykazania na informacji %1. \n(zerowe kwoty dochodu i podatku)'@[SKID.DEKL_NAZ])
      ?}
   ?};
   exec('end_ift1_10','pit')
?};
P.cntx_pop()


\ift1_grup
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula wyswietla grupy deklaracji podatkowych IFT-1/IFT-1R
::   WE: _a - String oznaczenie rodzaju deklaracji np. 'IFT1'
::       [_b] [INTEGER] - rok deklaracji podatkowej
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || return(~~) ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0          ?};

{? exec('ift1_ini','edeklar',_pitTyp,_rok)
|| USERS.cntx_psh();
   OGRANICZ.blank(1);
   SKID.TYP_ZAP:=SKID.DEKL_NAZ;
   PIT_GRUP.clear();
   PIT_GRUP.index('RODZAJP');
   EDIT_VAR.cntx_psh();
   EDIT_VAR.PIT_RODZ:='C';
   _tytul:='Umowy/Zlecenia';
   EDIT_VAR.OBSZAR:='Zleceniobiorcy';
   PIT_GRUP.prefix(EDIT_VAR.PIT_RODZ,__Rok);
   PIT_GRUP.win_sel('IFT1');
   PIT_GRUP.hdr_sel();
   PIT_GRUP.hdr_sel(': %1 z roku %2'@[_tytul,$__Rok]);
   PIT_GRUP.select(,1,10);
   EDIT_VAR.cntx_pop();
   USERS.cntx_pop()
?}


\ift1_rec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula sprawdza poprawnosc danych w rekordzie tabeli VAT_DEK
::   WE: _a - 1-sprawdzenie przy Dolacz pola NR, 0-akcja Popraw nie sprawdza
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0) || _a:=0 ?};
{? _a
|| {? pit_typ='IFT1R'
   || _spr:=__CHK.record(VAT_DEK,,'NR','OPIS')
   || _spr:=__CHK.record(VAT_DEK,,'NR','OPIS','OD','DO')
   ?}
|| _spr:=__CHK.record(VAT_DEK,,'OPIS')
?};

{? pit_typ='IFT1' & _spr=''
|| {? VAT_DEK.OD=date(0,0,0)
   || FUN.emsg('Wypełnienie pola "Od" obowiązkowe.'@);
      _spr:='OD'
   |? VAT_DEK.DO=date(0,0,0) | VAT_DEK.OD~1<>VAT_DEK.DO~1 | VAT_DEK.OD~1<VAT_DEK.DO~1
   || FUN.emsg('Pole "Do" wypełnione nieprawidłową wartością.'@);
      _spr:='DO'
   |? #VAT_DEK.OKRES<>VAT_DEK.OD~1
   || FUN.emsg('Pole "Od" wypełnione nieprawidłową wartością. Należy podać z roku: %1.'@[VAT_DEK.OKRES]);
      _spr:='OD'
   |? #VAT_DEK.OKRES<>VAT_DEK.DO~1
   || FUN.emsg('Pole "Do" wypełnione nieprawidłową wartością. Należy podać z roku: %1.'@[VAT_DEK.OKRES]);
      _spr:='OO'
   |? VAT_DEK.DO<VAT_DEK.OD
   || FUN.emsg('Błędnie podany zakres dat.'@);
      _spr:='OD'
   ?}
?};
{? _spr=''
|| {? VAT_DEK.KOR='T'
   || {? __Rok>=2018
      || _spr:=''
      || _spr:=__CHK.record(VAT_DEK,,'OPISKOR')
      ?}
   ?}
?};
{? _a & _spr=''
|| {? pit_typ='IFT1R'
   || _spr:=__CHK.record(VAT_DEK,,'D2')
   || _spr:=__CHK.record(VAT_DEK,,'D1','D2')
   ?}
?};
{? _spr=''
|| {? VAT_DEK.GIODO='T' || _spr:=__CHK.record(VAT_DEK,,'GIODODAT') ?}
?};
{? _spr=''
|| _spr:=__CHK.record(VAT_DEK,,'IMIE','NAZ','STN','DATA')
?};

:: czyszczenie pól
{? _spr=''
|| {? VAT_DEK.GIODO='N' & VAT_DEK.GIODODAT<>date(0,0,0)
   || VAT_DEK.GIODODAT:=date(0,0,0)
   ?}
?};
{? _spr=''
|| {? VAT_DEK.KOR='N'
   || VAT_DEK.memo_set(,'OPISKOR')
   ?}
?};
_spr


\poz_ift1_10
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej IFT-1/IFT1R dla wersji 10
::----------------------------------------------------------------------------------------------------------------------
_akt:={? var_pres('_a')=type_of(1) & _a || 1 || 0 ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
          ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
       !}; VAT_POZ.add()";

_dod_zap('D.  1','1. Dochody z żeglugi morskiej, żeglugi śródlądowej i transportu lotniczego',34,1,0,'R');
_dod_zap('D.  2','2. Dywidendy ',38,2,0,'A');
_dod_zap('D.  3','3. Odsetki',42,3,0,'R');
_dod_zap('D.  4','4. Należności licencyjne',46,4,0,'R');
_dod_zap('D.  5','5. Dochód z wykonywania wolnego zawodu',50,5,0,'A');
_dod_zap('D.  6','6. Wynagrodzenie dyrektorów',54,6,0,'R');
_dod_zap('D.  7','7. Dochód z działalności artystycznej lub sportowej',58,7,0,'R');
_dod_zap('D.  8','8. Dochód z emerytury lub renty i innych podobnych świadczeń',62,8,0,'R');
_dod_zap('D.  9','9. Inne dochody',66,9,0,'R');
_dod_zap('D. 10','10. Przychód określony zgodnie z art.29-30a ustawy',70,10,0,'A')


\ift1_RodzajNrId
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula ustalajaca wartosc pola RodzajNrId w strukturze e-deklaracji IFT1/IFT1R
::   WE: _a - 1 - ustalenie kodu 0-podanie nazwy
::----------------------------------------------------------------------------------------------------------------------
_kod:=''; _nazwa:='';
{? VAT_DEK.PAR1='P'
|| {? _a=1
   || _kod:='3'
   || _nazwa:='PASZPORT'
   ?}
|? VAT_DEK.PAR1='N'
|| {? _a=1
   || _kod:='8'
   || _nazwa:='NIP'
   ?}
?};
{? _a=1 || _kod || _nazwa ?}


\ift1_NrId
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula ustalajaca wartosc pola NrId w strukturze e-deklaracji IFT1/IFT1R
::----------------------------------------------------------------------------------------------------------------------
_nip:=STR.gsub(VAT_DEK.NIP,'-','');STR.gsub(_nip,' ','')


\ift1_rekp_vat
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula na rekord przed okienka IFT1 tabeli PIT_GRUP e-deklaracji IFT1/IFT1R
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::----------------------------------------------------------------------------------------------------------------------
SKID.DEKL_NAZ:=VAT_DEK.TYP;
exec('rekprzed','color','VAT_DEK#01#')


\ift1_rekp_grup
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula na rekord przed okienka WERIFT1 e-deklaracji IFT1/IFT1R
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::----------------------------------------------------------------------------------------------------------------------
pit_typ:=PIT_GRUP.TYP;
SKID.DEKL_NAZ:=PIT_GRUP.TYP;
SKID.TYP_ZAP:=SKID.DEKL_NAZ;
0


\opiskotredit
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Funkcja przed redakcja pola PIT_EDIT.OPISKOR, jezeli pole PIT_EDIT.KOR='T' to mozna redagowac
::----------------------------------------------------------------------------------------------------------------------
PIT_EDIT.KOR='T'


\poz_pit4r_5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-4R (5) dla 5 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 5
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 5 ?};
::Dla wersji 5 wykonujemy obliczenia funkcja \obl_pit4r_4 powstala dla wersji 4
::Dla wersji 6 wykonujemy obliczenia funkcja \obl_pit4r_4 powstala dla wersji 4
{? _a=6 || _a:=5 ?};
exec('obl_pit4r_4','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                    {? _d=6
                    || _poz:=($('VAT_POZ.P'+$_ind))();
                       {? _poz=85 | _poz=86 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                    ?}
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','Liczba podatników',8,0,0,'A');
   _dod_zap('C. 1.2','Liczba podatników',20,0,6,'A');
   _dod_zap('C. 1.3','Należne zaliczki',14,1,0,'A');
   _dod_zap('C. 1.4','Należne zaliczki',26,1,6,'A');

   _dod_zap('C. 2.1','2. Zaliczki na podatek obliczone przez płatników, o których mowa',32,2,0,'R');
   _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',38,2,6,'R');

   _dod_zap('C. 3.1','3. Suma należnych zaliczek za poszczególne miesiące roku podatkowego',44,3,0,'S');
   _dod_zap('C. 3.2','wykazanych w wierszach 1 i 2',50,3,6,'S');

   _dod_zap('C. 4.1','4. Zaliczki na podatek, których pobór został ograniczony',56,4,0,'R');
   _dod_zap('C. 4.2','na podstawie art.32 ust.2 ustawy',62,4,6,'R');

   _dod_zap('C. 5.1','5. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',68,5,0,'R');
   _dod_zap('C. 5.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',74,5,6,'R');

   _dod_zap('C. 6.1','6. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',80,6,0,'A');

   _dod_zap('C. 7.1','7. Nadpłaty wynikające z rozliczenia za rok ubiegły oraz zwrot nadpłat',84,7,0,'A');
   _dod_zap('C. 7.2','w gotówce zaliczone na poczet należnej zaliczki',90,7,6,'A');

   _dod_zap('C. 8.1','8. Pobrany podatek, przekazany na PFRON',96,8,0,'R');
   _dod_zap('C. 8.2','oraz zak. fun. rehab. osób niepełnos.',102,8,6,'R');

   _dod_zap('C. 9.1','9. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',108,9,0,'A');
   _dod_zap('C. 9.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy',114,9,6,'A');

   _dod_zap('C.10.1','10. Zaliczki na podatek pobrane od innych należności,',120,10,0,'R');
   _dod_zap('C.10.2','w tym wynikających z umowy aktywizacyjnej 4)',126,10,6,'R');

   _dod_zap('C.11.1','11. Pobrany podatek do przekazania do urzędu skarbowego za',132,11,0,'S');
   _dod_zap('C.11.2','poszczególne miesiące roku podatkowego',138,11,6,'S');

   _dod_zap('C.12.1','12. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',144,12,0,'R');
   _dod_zap('C.12.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',150,12,6,'R');

   _dod_zap('C.13.1','13. Należne kwoty do wpłaty za poszczególne miesiące roku podatkowego',156,13,0,'S');
   _dod_zap('C.13.2','',162,13,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\poz_pit8ar_5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (5) dla 5 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 5
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 5 ?};
::Dla wersji 5 wykonujemy obliczenia funkcja \obl_pit8ar_4 powstala dla wersji 4
exec('obl_pit8ar_4','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',8,1,0,'A');
   _dod_zap('C. 1.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',14,1,6,'A');
   _dod_zap('C. 2.1','2. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',20,2,0,'A');
   _dod_zap('C. 2.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',26,2,6,'A');
   _dod_zap('C. 3.1','3. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',32,3,0,'A');
   _dod_zap('C. 3.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',38,3,6,'A');
   _dod_zap('C. 4.1','4. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia wypłacane żołnie-',44,4,0,'A');
   _dod_zap('C. 4.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',50,4,6,'A');
   _dod_zap('C. 5.1','5. Należności osób zagranicznych, wymienione w art. 29 ustawy',56,5,0,'A');
   _dod_zap('C. 5.2','',62,5,6,'A');
   _dod_zap('C. 6.1','6. Odsetki od pożyczek, odsetki i dyskonto od papierów wartościowych',68,6,0,'A');
   _dod_zap('C. 6.2','   (art. 30a ust. 1 pkt 1 i 2 ustawy)',74,6,6,'A');
   _dod_zap('C. 7.1','7. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na',80,7,0,'A');
   _dod_zap('C. 7.2','   rachunku podatnika (art. 30a ust. 1 pkt 3 ustawy)',86,7,6,'A');
   _dod_zap('C. 8.1','8. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',92,8,0,'A');
   _dod_zap('C. 8.2','   (art. 30a ust. 1 pkt 4 ustawy)',98,8,6,'A');
   _dod_zap('C. 9.1','9. Dochód z tytułu udziału w funduszach kapitałowych',104,9,0,'A');
   _dod_zap('C. 9.2','   (art. 30a ust. 1 pkt 5 ustawy)',110,9,6,'A');
   _dod_zap('C.10.1','10. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego',116,10,0,'A');
   _dod_zap('C.10.2','   (art. 30a ust. 1 pkt 6 ustawy)',122,10,6,'A');
   _dod_zap('C.11.1','11. Dochody członka pracowniczego funduszu emerytalnego z tytułu',128,11,0,'A');
   _dod_zap('C.11.2','    przeniesienia akcji (art. 30a ust. 1 pkt 7 ustawy)',134,11,6,'A');
   _dod_zap('C.12.1','12. Przychody z tytułu zbycia prawa poboru akcji',140,12,0,'A');
   _dod_zap('C.12.2','    art. 30a ust. 1 pkt 8 ustawy)',146,12,6,'A');
   _dod_zap('C.13.1','13. Inne należności niewymienione w wierszach 1-12',152,13,0,'A');
   _dod_zap('C.13.2','',158,13,6,'A');
   _dod_zap('C.14.1','14. Suma pobranego zryczałtowanego podatku za poszczególne',164,14,0,'S');
   _dod_zap('C.14.2','    miesiące z wierszy 1-13',170,14,6,'S');
   _dod_zap('C.15.1','15. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',176,15,0,'R');
   _dod_zap('C.15.2','    za poszczególne miesiące - zgodnie z art. 28 Ordynacji podatkowej',182,15,6,'R');
   _dod_zap('C.16.1','16. Kwoty do wpłaty za poszczególne miesiące roku podatkowego',188,16,0,'S');
   _dod_zap('C.16.2','    Od kwot z wiersza 14 należy odpowiednio odjąć kwoty z wiersza 15 ',194,16,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\poz_pit11p_6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (21) dla 6 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=33 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=36 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=40 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=5 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=43 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=5 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=8 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=54 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=8 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=10 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=63 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=10 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=10 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',24,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.30 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',29,1,1,'A',2);
_dod_zap('E. 1.3','   W poz.28 należy wykazać dochód zwolniony od podatku 4)',27,1,2,'A',1);
_dod_zap('E. 2.1','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',31,2,0,'A',4);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',34,3,0,'A',4);
_dod_zap('E. 4.1','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',38,4,0,'A',4);
_dod_zap('E. 5.1','5. Świadczenia wypłacone z Funduszów: Pracy i Gwarantowanych Świadczeń Pracown.',41,5,0,'A',4);
_dod_zap('E. 6.1','6. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4, 6 i 7-9',44,6,0,'A',4);
_dod_zap('E. 7.1','7. Czynności związane z pełnieniem obowiązków społecznych lub obywatelskich',48,7,0,'A',4);
_dod_zap('E. 8.1','8. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',52,8,0,'A',4);
_dod_zap('E. 8.2','   W poz.56 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3 ustawy.',55,8,1,'A',2);
_dod_zap('E. 9.11','9. Należności wynikające z umowy aktywizacyjnej',57,9,0,'A',4);
_dod_zap('E.10.1','10. Inne źródła',61,10,0,'A',4);

_dod_zap('F. 1','Składki na ubezpieczenia społeczne, o których mowa w przepisach ustawy',65,11,0,'A',1);
_dod_zap('F. 2','Składki na ubezpieczenie zdrowotne, o których mowa w przepisach ustawy',67,12,0,'A',1)


\poz_pit40p_5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.30]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-40 dla 5 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! {? _d>=9
              || ($('VAT_POZ.P'+$(_ind+3)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind+3)))():=($('pit['+$(_c+_ind)+']'))()
              || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=32 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=35 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=38 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=6 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=45 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=6 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=12 || VAT_POZ.RODZ:=pit[60] ?};
              {? _d=20 || VAT_POZ.RODZ:=pit[69] ?}

           !};
           VAT_POZ.add";

_dod_zap('F. 1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',24,1,0,'A',4);
_dod_zap('F. 1.2','   W poz.29 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',28,1,1,'A',2);
_dod_zap('F. 2','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',30,2,0,'A',4);
_dod_zap('F. 3','3. Emerytury - renty zagraniczne',33,3,0,'A',4);
_dod_zap('F. 4','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',36,4,0,'A',4);
_dod_zap('F. 5','5. Przychody z osobiście wykonywanej dział., o której mowa w art.13 ustawy',39,5,0,'A',4);
_dod_zap('F. 6','6. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',43,6,0,'A',4);
_dod_zap('F. 6.2','   W poz.47 należy wykazać przychody, do których zastosowano 50% koszty art.22',46,6,1,'A',2);
_dod_zap('F. 7','7. Inne źródła',48,7,0,'A',4);
_dod_zap('F. 8','8. RAZEM Suma kwot z wierszy od 1 do 7.',52,8,0,'A',4);
_dod_zap('G. 1','Składki na ubezpieczenia społeczne',56,9,0,'A',1);
_dod_zap('G. 2',' w tym zagraniczne, o których mowa w art.26 ust.1 pkt 2a ustawy',57,10,0,'A',1);
_dod_zap('G. 3','Zwrot nienależnie pobranych świadczeń',58,11,0,'A',1);
_dod_zap('G. 4','Inne odliczenia od dochodu, niewymienione w poz.57 i 59 3)',60,12,0,'A',1);
_dod_zap('H.1.1','Podstawa obliczenia podatku (po zaokrągleniu do pełnych złotych)',61,13,0,'A',1);
_dod_zap('H.1.2','Obliczony podatek - zgodnie z art.27 ustawy. Podatek od podstawy z poz.62.',62,14,0,'A',1);
_dod_zap('H.1.3','Doliczenie do podatku',63,15,0,'A',1);
_dod_zap('H.1.4','Podatek. Do kwoty z poz.63 należy dodać kwotę z poz.64.',64,16,0,'A',1);
_dod_zap('H.2.1','Składki na ubezpieczenie zdrowotne',65,17,0,'A',1);
_dod_zap('H.2.2',' w tym zagraniczne, o których mowa w art.27b ust.1 pkt 2 ustawy',66,18,0,'A',1);
_dod_zap('H.2.3','Kwota składek z poz.66, możliwa do odliczenia w roku podatkowym',67,19,0,'A',1);
_dod_zap('H.2.4','Inne odliczenia od podatku,niewymienione w poz.66 3)',69,20,0,'A',1);
_dod_zap('H.3.1','Podatek należny (po zaokrągleniu do pełnych złotych)',70,21,0,'A',1);
_dod_zap('H.3.2','Różnica pomiędzy podatkiem należnym a sumą zaliczek pobranych przez płatnika - DO ZAPŁATY',71,22,0,'A',1);
_dod_zap('H.3.3','Różnica pomiędzy sumą zaliczek pobranych przez płatnika a podatkiem należnym - NADPŁATA',72,23,0,'A',1)


\pit8c_7_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8C (7) dla wersji 7
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! {? (_d=1 | _d=2 | _d=3 | _d=4) & _ind=4
          || {? _d<4 || VAT_POZ.RODZ:=pit[_c-1] ?};
             VAT_POZ.P4:=_c;
             VAT_POZ.KW4:=pit[_c]
          |? _d=5
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d>=6 & _d<=10 & (_ind=1 | _ind=2)
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=11
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=12 & _ind=4
          || VAT_POZ.P4:=_c;
             VAT_POZ.KW4:=pit[_c]
          ?}
       !};VAT_POZ.add()";

_dod_zap('D.  1','1. Rodzaj przychodu',25,1,0,'A');
_dod_zap('D.  2','2. Rodzaj przychodu',27,2,0,'A');
_dod_zap('D.  3','3. Rodzaj przychodu',29,3,0,'A');
_dod_zap('D.  4','4. Razem',30,4,0,'S');
_dod_zap('E.  5','5. Informacja o wysokości wypłaconego stypendium, o którym mowa w art. 21 ust. 1 punkt 40b ustawy ',31,5,0,'A');
_dod_zap('F.  6','6. Odpłatne zbycie papierów wartościowych',35,6,0,'A');
_dod_zap('F.  7','7. Realizacja praw wynikających z papierów wartościowych',37,7,0,'A');
_dod_zap('F.  8','8. Odpłatne zbycie pochodnych instrumentów finansowych oraz realizacja praw z nich wynikających',39,8,0,'A');
_dod_zap('F.  9','9. Odpłatne zbycie niebędących papierami wartościowymi udziałów (akcji) w spółkach',41,9,0,'A');
_dod_zap('F. 10','10. Objęcie udziałów (akcji) w spółkach albo wkładów w spółdzielniach w zamian za wkład niepieniężny'+
         ' w innej postaci niż przedsiębiorstwo lub jego zorganizowana część',43,10,0,'A');
_dod_zap('F. 11','11. Razem. Suma kwot wierszy 6-10. ',45,11,0,'S');
_dod_zap('G. 12','12.Przychód z odpłatnego zbycia papierów wartościowych',49,12,0,'A')


\poz_ift1_11
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej IFT-1/IFT1R dla wersji 11
::----------------------------------------------------------------------------------------------------------------------
_akt:={? var_pres('_a')=type_of(1) & _a || 1 || 0 ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
          ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
       !}; VAT_POZ.add()";

_dod_zap('D.  1','1. Dochody z żeglugi morskiej, żeglugi śródlądowej i transportu lotniczego',34,1,0,'R');
_dod_zap('D.  2','2. Dywidendy ',38,2,0,'A');
_dod_zap('D.  3','3. Odsetki',42,3,0,'R');
_dod_zap('D.  4','4. Należności licencyjne',46,4,0,'R');
_dod_zap('D.  5','5. Dochód z wykonywania wolnego zawodu',50,5,0,'A');
_dod_zap('D.  6','6. Wynagrodzenie dyrektorów',54,6,0,'R');
_dod_zap('D.  7','7. Dochód z działalności artystycznej lub sportowej',58,7,0,'R');
_dod_zap('D.  8','8. Dochód z emerytury lub renty i innych podobnych świadczeń',62,8,0,'R');
_dod_zap('D.  9','9. Inne dochody',66,9,0,'R');
_dod_zap('D. 10','10. Przychód określony zgodnie z art.29-30a ustawy',70,10,0,'A')



\edek_stru
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Import struktury e-deklaracji
::   WE: _a - Nazwa
::       _b - Wersja
::       _c - Plik
::      [_d] - Data obowiazywania struktury e-deklaracji
::   WY: 1 - import poprawny, 0 - import nieudany
::----------------------------------------------------------------------------------------------------------------------
_ret:=0;
SKID.DEKL_NAZ:=_a;
VAT_VER.cntx_psh();
VAT_VER.index('VER_NR');
VAT_VER.prefix('PPL',SKID.DEKL_NAZ,SKID.DEKL_NAZ,_b);
{? VAT_VER.first()
|| ISTDEF.cntx_psh();
   ISTDEF.index('DATA');
   {? var_pres('_d')<>type_of(date)
   || ISTDEF.prefix('PPL','D',SKID.DEKL_NAZ,VAT_VER.ref())
   || ISTDEF.prefix('PPL','D',SKID.DEKL_NAZ,VAT_VER.ref(),_d)
   ?};
   {? ~ISTDEF.first()
   || _ret:=exec('edek_imp','xml',_c)
   ?};
   ISTDEF.cntx_pop()
?};
VAT_VER.cntx_pop();
_ret


\edek_stru_del
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Kasowanie istniejacej struktury e-deklaracji
::   WE: _a - Nazwa
::       _b - Wersja
::      [_c] - Data obowiazywania struktury e-deklaracji
::       [_d] - Data obowiazywania wersja e-deklaracji
::       [_e] - Dziedzina, domyślnie PPL
::   WY:
::----------------------------------------------------------------------------------------------------------------------
SKID.DEKL_NAZ:=_a;
_dver:={? var_pres('_d')=type_of(date()) || _d || date(0,0,0) ?};
_dom:={? var_pres('_e')=type_of('') || _e || 'PPL' ?};
VAT_VER.cntx_psh(); ISTDEF.cntx_psh();
{? _dver<>date(0,0,0)
|| VAT_VER.index('VER_OD');
   VAT_VER.prefix(_dom,SKID.DEKL_NAZ,SKID.DEKL_NAZ,_dver,_b)
|| VAT_VER.index('VER_NR');
   VAT_VER.prefix(_dom,SKID.DEKL_NAZ,SKID.DEKL_NAZ,_b)
?};
{? VAT_VER.first()
|| ISTDEF.index('DATA');
   {? var_pres('_c')<>type_of(date)
   || ISTDEF.prefix(_dom,'D',SKID.DEKL_NAZ,VAT_VER.ref())
   || ISTDEF.prefix(_dom,'D',SKID.DEKL_NAZ,VAT_VER.ref(),_c)
   ?};
   {? ISTDEF.first()
   || {? ISTDEF.r_lock(1,1,1)
      || ISTDEFS.index('DRZEWO');
         ISTDEFS.prefix(ISTDEF.ref(),0);
         {? ISTDEFS.first()
         || {!
            |? exec('del_el','xml');
               ISTDEFI.index('LP');
               ISTDEFI.prefix(ISTDEFS.ref());
               {? ISTDEFI.first() || {! |? ISTDEFI.del() !} ?};
               ISTDEFS.del()
            !}
         ?};
         {? ~ISTDEF.del(,1) || ISTDEF.r_unlock() ?}
      ?}
   ?}
?};
VAT_VER.cntx_pop(); ISTDEF.cntx_pop();
1


\poz_pit8ar_6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (6) dla 6 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 6
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 6 ?};
exec('obl_pit8ar_6','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',8,1,0,'R');
   _dod_zap('C. 1.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',14,1,6,'R');
   _dod_zap('C. 2.1','2. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',20,2,0,'A');
   _dod_zap('C. 2.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',26,2,6,'A');
   _dod_zap('C. 3.1','3. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',32,3,0,'R');
   _dod_zap('C. 3.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',38,3,6,'R');
   _dod_zap('C. 4.1','4. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia wypłacane żołnie-',44,4,0,'R');
   _dod_zap('C. 4.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',50,4,6,'R');
   _dod_zap('C. 5.1','5. Kwoty wypłat z indywidualnego konta zabezpieczenia emerytalnego',56,5,0,'R');
   _dod_zap('C. 5.2','   (art. 30 ust.1 pkt 14 ustawy)',62,5,6,'R');
   _dod_zap('C. 6.1','6. Należności osób zagranicznych, wymienione w art. 29 ustawy',68,6,0,'A');
   _dod_zap('C. 6.2','',74,6,6,'A');
   _dod_zap('C. 7.1','7. Odsetki od pożyczek, odsetki i dyskonto od papierów wartościowych',80,7,0,'R');
   _dod_zap('C. 7.2','   (art. 30a ust. 1 pkt 1 i 2 ustawy)',86,7,6,'R');
   _dod_zap('C. 8.1','8. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na',92,8,0,'R');
   _dod_zap('C. 8.2','   rachunku podatnika (art. 30a ust. 1 pkt 3 ustawy)',98,8,6,'R');
   _dod_zap('C. 9.1','9. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',104,9,0,'R');
   _dod_zap('C. 9.2','   (art. 30a ust. 1 pkt 4 ustawy)',110,9,6,'R');
   _dod_zap('C.10.1','10. Dochód z tytułu udziału w funduszach kapitałowych',116,10,0,'R');
   _dod_zap('C.10.2','   (art. 30a ust. 1 pkt 5 ustawy)',122,10,6,'R');
   _dod_zap('C.11.1','11. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego',128,11,0,'R');
   _dod_zap('C.11.2','   (art. 30a ust. 1 pkt 6 ustawy)',134,11,6,'R');
   _dod_zap('C.12.1','12. Dochody członka pracowniczego funduszu emerytalnego z tytułu',140,12,0,'R');
   _dod_zap('C.12.2','    przeniesienia akcji (art. 30a ust. 1 pkt 7 ustawy)',146,12,6,'R');
   _dod_zap('C.13.1','13. Przychody z tytułu zbycia prawa poboru akcji',152,13,0,'R');
   _dod_zap('C.13.2','    art. 30a ust. 1 pkt 8 ustawy)',158,13,6,'R');
   _dod_zap('C.14.1','14. Inne należności niewymienione w wierszach 1-13',164,14,0,'A');
   _dod_zap('C.14.2','',170,14,6,'A');
   _dod_zap('C.15.1','15. Suma pobranego zryczałtowanego podatku za poszczególne',176,15,0,'S');
   _dod_zap('C.15.2','    miesiące z wierszy 1-14',182,15,6,'S');
   _dod_zap('C.16.1','16. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',188,16,0,'R');
   _dod_zap('C.16.2','    za poszczególne miesiące - zgodnie z art. 28 Ordynacji podatkowej',194,16,6,'R');
   _dod_zap('C.17.1','17. Kwoty do wpłaty za poszczególne miesiące roku podatkowego',200,17,0,'S');
   _dod_zap('C.17.2','    Od kwot z wiersza 15 należy odpowiednio odjąć kwoty z wiersza 16',206,17,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit8ar6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.41]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw
::       dla deklaracji PIT 8AR wersja 6
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh;
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh; VAT_POZ.prefix;
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put
       ?}; VAT_POZ.cntx_pop";

_czyblank:=0;
{! _ix:=1..14
|! VAT_POZ.prefix(VAT_DEK.ref,_ix);
   {? VAT_POZ.first
   || {!
      |? {? _ix>1 || _czyblank+=1 ?};
         _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,15,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
      !}
   ?}
!};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,15);
{? VAT_POZ.first
|| {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,17,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,16);
{? VAT_POZ.first
|| {! |? _czyblank+=1;
         _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,17,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,17);
{? VAT_POZ.first
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put; VAT_POZ.next
   !}
?};
VAT_POZ.cntx_pop()


\poz_ift1_12
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej IFT-1/IFT1R dla wersji 12
::----------------------------------------------------------------------------------------------------------------------
_akt:={? var_pres('_a')=type_of(1) & _a || 1 || 0 ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
          ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
       !}; VAT_POZ.add()";

_dod_zap('D.  1','1. Dochody z żeglugi morskiej, żeglugi śródlądowej i transportu lotniczego',35,1,0,'R');
_dod_zap('D.  2','2. Dywidendy ',39,2,0,'A');
_dod_zap('D.  3','3. Odsetki',43,3,0,'R');
_dod_zap('D.  4','4. Należności licencyjne',47,4,0,'R');
_dod_zap('D.  5','5. Dochód z wykonywania wolnego zawodu',51,5,0,'A');
_dod_zap('D.  6','6. Wynagrodzenie dyrektorów',55,6,0,'R');
_dod_zap('D.  7','7. Dochód z działalności artystycznej lub sportowej',59,7,0,'R');
_dod_zap('D.  8','8. Dochód z emerytury lub renty i innych podobnych świadczeń',63,8,0,'R');
_dod_zap('D.  9','9. Inne dochody',67,9,0,'R');
_dod_zap('D. 10','10. Przychód określony zgodnie z art.29-30a ustawy',71,10,0,'A')


\poz_pit11p_7
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (22) dla 7 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=37 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=40 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=44 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=5 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=47 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=5 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=8 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=58 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=8 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=10 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=67 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=10 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=10 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',28,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.34 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',33,1,1,'A',2);
_dod_zap('E. 1.3','   W poz.32 należy wykazać dochód zwolniony od podatku 7)',31,1,2,'A',1);
_dod_zap('E. 2.1','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',35,2,0,'A',4);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',38,3,0,'A',4);
_dod_zap('E. 3.2','   W poz.41 należy wykazać dochód zwolniony od podatku 7)',40,3,1,'A',1);
_dod_zap('E. 4.1','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',42,4,0,'A',4);
_dod_zap('E. 5.1','5. Świadczenia wypłacone z Funduszów: Pracy i Gwarantowanych Świadczeń Pracown.',45,5,0,'A',4);
_dod_zap('E. 6.1','6. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4, 6 i 7-9',48,6,0,'A',4);
_dod_zap('E. 7.1','7. Czynności związane z pełnieniem obowiązków społecznych lub obywatelskich',52,7,0,'A',4);
_dod_zap('E. 8.1','8. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',56,8,0,'A',4);
_dod_zap('E. 8.2','   W poz.60 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3 ustawy.',59,8,1,'A',2);
_dod_zap('E. 9.11','9. Należności wynikające z umowy aktywizacyjnej',61,9,0,'A',4);
_dod_zap('E.10.1','10. Inne źródła',65,10,0,'A',4);
_dod_zap('E.10.2','    W poz.68 należy wykazać dochód zwolniony od podatku 7)',67,10,1,'A',1);

_dod_zap('E.11.1.1','Składki na ubezpieczenia społeczne, o których mowa w przepisach ustawy',69,11,0,'A',1);
_dod_zap('E.11.1.2','  w tym zagraniczne, o których mowa w art. 26 ust. 1 pkt 2a ustawy',70,11,1,'A',1);
_dod_zap('E.12.2.1','Składki na ubezpieczenie zdrowotne, o których mowa w przepisach ustawy',71,12,0,'A',1);
_dod_zap('E.12.2.2','  w tym zagraniczne, o których mowa w art. 27b ust. 1 pkt 2 ustawy',72,12,1,'A',1);

_dod_zap('F. 1.1','Przychody otrzymywane z zagranicy, o których mowa w art. 21 ust. 1 pkt 74 ustawy',73,13,0,'A',1);
_dod_zap('F. 2.1','Przychody pochodzące ze środków bezzwrotnej pomocy zagranicznej, art. 21',74,14,0,'A',1)


\szukaj_osznip
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.41]
:: OPIS: Wyszukuje odpowiedni adres osoby.
::   WE: _a - "ref" OSOBA (domyslnie jezel nie podano)
::       _b - data (domyslnie biezaca)
::   WY: "ref" rekordu jesli wyszukanie OS_ZNIP powiodlo sie null jesli OS_ZNIP nie zostal odnaleziony
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(null) || _a:=OSOBA.ref() ?};
{? var_pres('_b')<>type_of(date) || _b:=date ?};
OS_ZNIP.index('OSOBAOD');
OS_ZNIP.prefix(_a);
{? OS_ZNIP.find_le(_b) & (OS_ZNIP.DO=date(0,0,0) | OS_ZNIP.DO>=_b) || OS_ZNIP.ref || null ?}


\poz_pit40p_6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-40 dla 6 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {! _ind:=1.._g
           |! {? _d>=9
              || ($('VAT_POZ.P'+$(_ind+3)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind+3)))():=($('pit['+$(_c+_ind)+']'))()
              || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=36 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=39 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=42 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=6 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=49 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=6 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=12 || VAT_POZ.RODZ:=pit[64] ?};
              {? _d=20 || VAT_POZ.RODZ:=pit[73] ?}

           !};
           VAT_POZ.add";

_dod_zap('F. 1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',28,1,0,'A',4);
_dod_zap('F. 1.2','   W poz.33 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',32,1,1,'A',2);
_dod_zap('F. 2','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',34,2,0,'A',4);
_dod_zap('F. 3','3. Emerytury - renty zagraniczne',37,3,0,'A',4);
_dod_zap('F. 4','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',40,4,0,'A',4);
_dod_zap('F. 5','5. Przychody z osobiście wykonywanej dział., o której mowa w art.13 ustawy',43,5,0,'A',4);
_dod_zap('F. 6','6. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',47,6,0,'A',4);
_dod_zap('F. 6.2','   W poz.51 należy wykazać przychody, do których zastosowano 50% koszty art.22',50,6,1,'A',2);
_dod_zap('F. 7','7. Inne źródła',52,7,0,'A',4);
_dod_zap('F. 8','8. RAZEM Suma kwot z wierszy od 1 do 7.',56,8,0,'A',4);
_dod_zap('G. 1','Składki na ubezpieczenia społeczne',60,9,0,'A',1);
_dod_zap('G. 2',' w tym zagraniczne, o których mowa w art.26 ust.1 pkt 2a ustawy',61,10,0,'A',1);
_dod_zap('G. 3','Zwrot nienależnie pobranych świadczeń',62,11,0,'A',1);
_dod_zap('G. 4','Inne odliczenia od dochodu, niewymienione w poz.61 i 63 6)',64,12,0,'A',1);
_dod_zap('H.1.1','Podstawa obliczenia podatku (po zaokrągleniu do pełnych złotych)',65,13,0,'A',1);
_dod_zap('H.1.2','Obliczony podatek - zgodnie z art.27 ustawy. Podatek od podstawy z poz.66.',66,14,0,'A',1);
_dod_zap('H.1.3','Doliczenie do podatku',67,15,0,'A',1);
_dod_zap('H.1.4','Podatek. Do kwoty z poz.67 należy dodać kwotę z poz.68.',68,16,0,'A',1);
_dod_zap('H.2.1','Składki na ubezpieczenie zdrowotne',69,17,0,'A',1);
_dod_zap('H.2.2',' w tym zagraniczne, o których mowa w art.27b ust.1 pkt 2 ustawy',70,18,0,'A',1);
_dod_zap('H.2.3','Kwota składek z poz.70, możliwa do odliczenia w roku podatkowym',71,19,0,'A',1);
_dod_zap('H.2.4','Inne odliczenia od podatku,niewymienione w poz.70 6)',73,20,0,'A',1);
_dod_zap('H.3.1','Podatek należny (po zaokrągleniu do pełnych złotych)',74,21,0,'A',1);
_dod_zap('H.3.2','Różnica pomiędzy podatkiem należnym a sumą zaliczek pobranych przez płatnika - DO ZAPŁATY',75,22,0,'A',1);
_dod_zap('H.3.3','Różnica pomiędzy sumą zaliczek pobranych przez płatnika a podatkiem należnym - NADPŁATA',76,23,0,'A',1)


\tab_rok
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.00]
:: OPIS: Tworzy tabelę tymczasową do wyboru roku deklaracji
::   WE:
::   WY: tabela tymczasowa
::----------------------------------------------------------------------------------------------------------------------
_title:={? var_pres('_a')=type_of('') || _a || '' ?};

_TPAR:=tab_tmp(1,
         'ROK','INTEGER','Rok podatkowy deklaracji'@
      );

_we:=_TPAR.mk_edit('%1'[_title]);
_TPAR.win_esep(_we,'Za rok podatkowy'@);
_TPAR.win_efld(_we,,'ROK',,,,,,'Rok'@,0,'Rok podatkowy deklaracji'@);
_TPAR.efld_opt(_we,'mark=1',_TPAR,'ROK');
exec('ok_esc','#window',_TPAR,_we);
_TPAR.win_edit(_we);

_TPAR


\edit_var_p_format
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.00]
:: OPIS: Formatuje sposób wyświetlania pól zmiennej EDIT_VAR dla deklaracji podatkowych
::   WE: _a [STRING] - typ deklaracji
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
_typ:={? var_pres('_a')=type_of('') || _a || return(~~) ?};

{? _typ='PIT11P' | _typ='PIT11Z' | _typ='PIT40' | _typ='PIT8CP' | _typ='PIT8CZ' | _typ='IFT1' | _typ='IFT1R'
|| {! _ind:=1..4
   |! EDIT_VAR.fld_fml('PW'+$_ind,'DISPLAY_FORMAT',"'alignment=left'")
   !}
|? _typ='PIT4R' | _typ='PIT8AR'
|| {! _ind:=1..6
   |! EDIT_VAR.fld_fml('P'+$_ind,'DISPLAY_FORMAT',"'alignment=left'")
   !};
   {? _typ='PIT4R'
   || _fml:="_vern:=params_get.ver;
             _nrw:=VAT_POZ.NR;
             {? _vern>=13
             || {? _nrw=13 | _nrw=14
                || 'in_prec=2'
                || 'in_prec=0'
                ?}
             || 'in_prec=0'
             ?}";
      _edi:="_vern:=params_get.ver;
             _nrw:=VAT_POZ.NR;
             {? _vern>=13
             || {? _nrw=13 | _nrw=14
                || 'out_prec=2'
                || 'out_prec=0'
                ?}
             || 'out_prec=0'
             ?}";
      {! _ind:=1..6
      |! VAT_POZ.fld_fml('K'+$_ind,'EDIT_FORMAT',_fml);
         VAT_POZ.fld_fml('K'+$_ind,'DISPLAY_FORMAT',_edi)
      !}
   ?};
   {? _typ='PIT8AR'
   || _fml:="{? params_get.ver>=14
             || _nrw:=VAT_POZ.NR;
                {? _nrw=14 | _nrw=15 | _nrw=16 | _nrw=36 | _nrw=38 | _nrw=39 | _nrw=40
                || 'in_prec=2'
                || 'in_prec=0'
                ?}
             |? params_get.ver=13
             || _nrw:=VAT_POZ.NR;
                {? _nrw=12 | _nrw=13 | _nrw=14 | _nrw=34 | _nrw=36
                || 'in_prec=2'
                || 'in_prec=0'
                ?}
             |? params_get.ver>=10 & params_get.ver<13
             || _nrw:=VAT_POZ.NR;
                {? _nrw=12 | _nrw=13 | _nrw=14 | _nrw=33 | _nrw=35
                || 'in_prec=2'
                || 'in_prec=0'
                ?}
             |? params_get.ver>=8 & params_get.ver<10
             || _nrw:=VAT_POZ.NR;
                {? _nrw=12 | _nrw=13 | _nrw=14 | _nrw=27 | _nrw=29
                || 'in_prec=2'
                || 'in_prec=0'
                ?}
             |? params_get.ver>=6 & params_get.ver<8
             || _nrw:=VAT_POZ.NR;
                {? _nrw=7 | _nrw=8 | _nrw=15 | _nrw=17
                || 'in_prec=2'
                || 'in_prec=0'
                ?}
             |? params_get.ver>=3 & params_get.ver<6
             || _nrw:=VAT_POZ.NR;
                {? _nrw=6 | _nrw=7 | _nrw=14 | _nrw=16
                || 'in_prec=2'
                || 'in_prec=0'
                ?}
             || 'in_prec=0'
             ?}";
      {! _ind:=1..6
      |! VAT_POZ.fld_fml('K'+$_ind,'EDIT_FORMAT',_fml)
      !};
      _edi:="{? params_get.ver>=14
             || _nrw:=VAT_POZ.NR;
                {? _nrw=14 | _nrw=15 | _nrw=16 | _nrw=36 | _nrw=38 | _nrw=39 | _nrw=40
                || 'out_prec=2'
                || 'out_prec=0'
                ?}
             |? params_get.ver=13
             || _nrw:=VAT_POZ.NR;
                {? _nrw=12 | _nrw=13 | _nrw=14 | _nrw=34 | _nrw=36
                || 'out_prec=2'
                || 'out_prec=0'
                ?}
             |? params_get.ver>=10 & params_get.ver<13
             || _nrw:=VAT_POZ.NR;
                {? _nrw=12 | _nrw=13 | _nrw=14 | _nrw=33 | _nrw=35
                || 'out_prec=2'
                || 'out_prec=0'
                ?}
             |? params_get.ver>=8 & params_get.ver<10
             || _nrw:=VAT_POZ.NR;
                {? _nrw=12 | _nrw=13 | _nrw=14 | _nrw=27 | _nrw=29
                || 'out_prec=2'
                || 'out_prec=0'
                ?}
             |? params_get.ver>=6 & params_get.ver<8
             || _nrw:=VAT_POZ.NR;
                {? _nrw=7 | _nrw=8 | _nrw=15 | _nrw=17
                || 'out_prec=2'
                || 'out_prec=0'
                ?}
             |? params_get.ver>=3 & params_get.ver<6
             || _nrw:=VAT_POZ.NR;
                {? _nrw=6 | _nrw=7 | _nrw=14 | _nrw=16
                || 'out_prec=2'
                || 'out_prec=0'
                ?}
             || 'out_prec=0'
             ?}";
      {! _ind:=1..6
      |! VAT_POZ.fld_fml('K'+$_ind,'DISPLAY_FORMAT',_edi)
      !}
   ?}
?};
~~


\vat_dek_kor_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [12.41]
:: OPIS: Po redagowaniu pola KOR tabeli VAT_DEK
::----------------------------------------------------------------------------------------------------------------------
_we:=VAT_DEK.win_edit('?');
{? _we='POD_KL' | _we='PIT4R' | _we='PIT11P' | _we='PIT11Z' | _we='PIT40' | _we='PIT8C' | _we='IFT1' | _we='IFT1R' |
   _we='POD_KL19' | _we='PIT4R_19' | _we='PIT11P19' | _we='PIT11Z19' | _we='PIT11_19' | _we='POD_KL21' | _we='PIT4R_21'
|| exec('vat_dek_efld_opt','edeklar')
|| 1
?}


\pit_edit_kor_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [12.41]
:: OPIS: Po redagowaniu pola KOR tabeli VAT_DEK
::----------------------------------------------------------------------------------------------------------------------
exec('vat_dek_efld_opt','edeklar')


\vat_dek_efld_opt
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.00]
:: OPIS: Formuła odpowiedzialna za dynamiczne ustawianie właściwości pól tabeli VAT_DEK.
::       Formuła wywoływana jest w dwóch kontekstach pracy:
::          - Po redagowaniu konkretnego pola, które determinuje właściwości wyświetlania innych pól.
::          - Przed wyświetleniem okna redagowania (przed właściwymi akcjami Dołącz, Popraw, Wyświetl), ustawia
::            właściwości wszystkich pól (wymagających tego).
::       Kontekst pracy jest określany na podstawie argumentu wywołania.
::   WE: [_a] [STRING] - Kontekst pracy:
::             '1' - Obsługa jednego pola [domyślnie].
::             '*' - Obsługa wszystkich pól.
::       [_b] [TABLE]  - Uchwyt tabeli, w oknie redagowania której znajdują sie pola. Jeżeli _a='1', parametr jest
::             opcjonalny - zostanie przyjęta bieżąca tabela.
::       [_c] [STRING] - Akronim okna, w którym mają być ustawione właściwości pól. Jeżeli _a='1', parametr jest
::             opcjonalny - zostanie przyjęte bieżące okno.
::       [_d] [STRING] - Akronim pola, którego wartość determinuje właściwości wyświetlania innych pól. Parametr ma
::             znaczenie wyłącznie dla _a='1'. [Domyślnie: bieżące pole].
::   WY: 0 - Błąd argumentów wywołania.
::       1 - Argumenty poprawne (właściwości ustawione).
::----------------------------------------------------------------------------------------------------------------------
_tryb:={? var_pres('_a')=type_of('') & (_a='1' | _a='*') || _a || '1' ?};
{? var_pres('_b')=type_of(G)
|| _tab:=_b
|? _tryb='1'
|| _tab:=cur_tab(1,1)
|| return(0)
?};
{? var_pres('_c')=type_of('')
|| _we:=_c
|? _tryb='1'
|| _we:=cur_win(1,1)
|| return(0)
?};
{? var_pres('_d')=type_of('')
|| _fld:=_d
|? _tryb='1'
|| _fld:=cur_afld()
|| _fld:=''
?};

:: opis korekty
{? var_pres('KOR',_tab)>0 & (_fld='' | _fld='KOR')
|| {? _we='POD_KL19' | _we='PIT4R_19'
   || {? #_tab.OKRES>=2019 & var_pres('OKRES',_tab)>0 & var_pres('KOR_RODZ',_tab)>0
      || _tab.efld_opt(_we,'enable=%1'[$(_tab.KOR='T')],_tab,'KOR_RODZ');
         {? _fld<>''
         || exec('vat_dek_efld_opt','edeklar','1',_tab,_we,'KOR_RODZ')
         ?}
      ?}
   || _tab.efld_opt(_we,'enable=%1,mark=%2'[$(_tab.KOR='T'),$(__Rok<2018)],_tab,'OPISKOR')
   ?}
?};

:: rodzaj korekty dla PIT-4R i PIT-8AR od 2019 roku w oknach 'PIT4R_19', 'POD_KL19'
:: od 2021 roku w oknach 'PIT4R_21', 'POD_KL21'
{? var_pres('KOR_RODZ',_tab)>0 & var_pres('KOR',_tab)>0 & (_fld='' | _fld='KOR_RODZ')
|| {? _we='POD_KL19' | _we='PIT4R_19' | _we='POD_KL21' | _we='PIT4R_21'
   || _tab.efld_opt(_we,'enable=%1,mark=%2'[$(_tab.KOR='T'),$(_tab.KOR='T' & _tab.KOR_RODZ='2')],_tab,'OPISKOR')
   ?}
?};

:: w 2020 PIT-4R i PIT-8AR w oknach 'PIT4R_19', 'POD_KL19' dodano nowe pola dotyczące COVID-19
:: przesunięcie wpłat zaliczek podatku AK 20.42_06
:: przesunięcie wpłat zaliczek podatku AK 20.42_08 dodatkowe pola PAR4, PAR5 oraz ZAL1 brak transferu
{? MS.fld_len(VAT_VER,'WIERSZ')=120 & (_fld='' | 3+_fld='PAR')
|| {? _we='POD_KL19' | _we='PIT4R_19'
   || {? #_tab.OKRES>=2019 & var_pres('OKRES',_tab)>0
      || _tab.efld_opt(_we,'enable=%1'[$(#_tab.OKRES=2020)],_tab,'PAR1');
         _tab.efld_opt(_we,'enable=%1'[$(#_tab.OKRES=2020)],_tab,'PAR2');
         _tab.efld_opt(_we,'enable=%1'[$(#_tab.OKRES=2020)],_tab,'PAR3');
         _tab.efld_opt(_we,'enable=%1'[$(#_tab.OKRES=2020)],_tab,'PAR4');
         _tab.efld_opt(_we,'enable=%1'[$(#_tab.OKRES=2020)],_tab,'PAR5');
         _tab.efld_opt(_we,'enable=%1'[$(#_tab.OKRES=2020)],_tab,'ZAL1')
      ?}
   ?}
?};

:: data przekazania danych osobowych
{? var_pres('GIODO',_tab)>0 & (_fld='' | _fld='GIODO')
|| _tab.efld_opt(_we,'enable=%1,mark=%1'[$(_tab.GIODO='T')],_tab,'GIODODAT')
?};

:: deklaracja zbiorcza - sumowanie umów
{? var_pres('PODATNIK',_tab)>0 & (_fld='' | _fld='PODATNIK')
|| _tab.efld_opt(_we,'enable=%1'[$(_tab.PODATNIK='T')],_tab,'PODATUZ')
?};

:: od roku 2017 pole PIT-12 będzie niedostępne do redakcji ponieważ nie ma deklaracji PIT-40
:: od roku 2019 pol PIT-12 nie ma w oknach PIT-11
{? var_pres('PIT12',_tab)>0 & (_fld='' | _fld='PIT12')
|| {? __Rok<2019
   || {? var_pres('OKRES',_tab)>0
      || _mod:=#_tab.OKRES<2017
      || _mod:=__Rok<2017
      ?};
      {? (6+_we='PIT11P' & #_tab.OKRES>=2017) | (_we='RED' & __Rok>=2017)
      || _tab.efld_opt(_we,'enable=%1'[$_mod],_tab,'PIT12')
      || _tab.efld_opt(_we,'enable=1',_tab,'PIT12')
      ?}
   ?}
?};
1


\grp_edisp_vat_dek_nag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.00]
:: OPIS: Aktualizacja nagłówka okienka deklaracji.
::----------------------------------------------------------------------------------------------------------------------
grp_edisp(VAT_DEK,'NAG')


\leg_vat_dek
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.00]
:: OPIS: Akcja "Legenda" w oknie VAT_DEK
::   WE: ~~
::   WY: ~~
::  OLD: \leg_vat_dek/menu.fml
::----------------------------------------------------------------------------------------------------------------------
exec('legenda','color','VAT_DEK#01#01','VAT_DEK#01#02')


\poz_pit4r_7
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-4R (7) dla 7 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 7
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 7 ?};
exec('obl_pit4r_7','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first()
|| VAT_POZ.prefix();
   __TAB.prefix();
   _dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add()";

   _dod_zap('C. 1.1','Liczba podatników',8,0,0,'A');
   _dod_zap('C. 1.2','Liczba podatników',20,0,6,'A');
   _dod_zap('C. 1.3','Należne zaliczki',14,1,0,'A');
   _dod_zap('C. 1.4','Należne zaliczki',26,1,6,'A');

   _dod_zap('C. 2.1','2. Zaliczki na podatek obliczone przez płatników, o których mowa',32,2,0,'R');
   _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',38,2,6,'R');

   _dod_zap('C. 3.1','3. Suma należnych zaliczek za poszczególne miesiące roku podatkowego',44,3,0,'S');
   _dod_zap('C. 3.2','wykazanych w wierszach 1 i 2',50,3,6,'S');

   _dod_zap('C. 4.1','4. Zaliczki na podatek, których pobór został ograniczony',56,4,0,'R');
   _dod_zap('C. 4.2','na podstawie art.32 ust.2 ustawy',62,4,6,'R');

   _dod_zap('C. 5.1','5. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',68,5,0,'R');
   _dod_zap('C. 5.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',74,5,6,'R');

   _dod_zap('C. 6.1','6. Pobrany podatek, przekazany na PFRON',80,6,0,'R');
   _dod_zap('C. 6.2','oraz zak. fun. rehab. osób niepełnos.',86,6,6,'R');

   _dod_zap('C. 7.1','7. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',92,7,0,'A');
   _dod_zap('C. 7.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy',98,7,6,'A');

   _dod_zap('C. 8.1','8. Zaliczki na podatek pobrane od innych należności,',104,8,0,'R');
   _dod_zap('C. 8.2','w tym wynikających z umowy aktywizacyjnej',110,8,6,'R');

   _dod_zap('C. 9.1','9. Pobrany podatek do przekazania do urzędu skarbowego za',116,9,0,'S');
   _dod_zap('C. 9.2','poszczególne miesiące roku podatkowego',122,9,6,'S');

   _dod_zap('C.10.1','10. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',128,10,0,'R');
   _dod_zap('C.10.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',134,10,6,'R');

   _dod_zap('C.11.1','11. Należne kwoty do wpłaty za poszczególne miesiące roku podatkowego',140,11,0,'S');
   _dod_zap('C.11.2','',146,11,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit4r7
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 4R wersja 7
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,1);
{? VAT_POZ.first()
|| {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,3,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,2);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,3,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,3);
{? VAT_POZ.first()
|| {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,9,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,5);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,9,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,7);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,9,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,8);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,9,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,4);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,9,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,6);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,9,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,9);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,10);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,11);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


\poz_pit11p_9
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (24) dla 9 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {? _d=14 || VAT_POZ.OP+=pit[75] ?};
           {? _d=15 || VAT_POZ.OP+=pit[77] ?};
           {? _d=16 || VAT_POZ.OP+=pit[79] ?};
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=37 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=2 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=40 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=44 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=5 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=47 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=5 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=8 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=58 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=8 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=10 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=67 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=10 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=10 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=13 || VAT_POZ.RODZ:='Wynagrodzenie z tytułu umowy o pomocy przy zbiorach' ?};
              {? _d=14 || VAT_POZ.RODZ:=pit[75] ?};
              {? _d=15 || VAT_POZ.RODZ:=pit[77] ?};
              {? _d=16 || VAT_POZ.RODZ:=pit[79] ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',28,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.34 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',33,1,1,'A',2);
_dod_zap('E. 1.3','   W poz.32 należy wykazać dochód zwolniony od podatku 10)',31,1,2,'A',1);
_dod_zap('E. 2.1','2. Należności z tytułu członkostwa w rolniczej sp.prod. lub innej ....',35,2,0,'A',4);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',38,3,0,'A',4);
_dod_zap('E. 3.2','   W poz.41 należy wykazać dochód zwolniony od podatku 10)',40,3,1,'A',1);
_dod_zap('E. 4.1','4. Należności za pracę przypadające tymczasowo aresztowanym lub skazanym',42,4,0,'A',4);
_dod_zap('E. 5.1','5. Świadczenia wypłacone z Funduszów: Pracy i Gwarantowanych Świadczeń Pracown.',45,5,0,'A',4);
_dod_zap('E. 6.1','6. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4, 6 i 7-9',48,6,0,'A',4);
_dod_zap('E. 7.1','7. Czynności związane z pełnieniem obowiązków społecznych lub obywatelskich',52,7,0,'A',4);
_dod_zap('E. 8.1','8. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',56,8,0,'A',4);
_dod_zap('E. 8.2','   W poz.60 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3 ustawy.',59,8,1,'A',2);
_dod_zap('E. 9.11','9. Należności wynikające z umowy aktywizacyjnej',61,9,0,'A',4);
_dod_zap('E.10.1','10. Inne źródła',65,10,0,'A',4);
_dod_zap('E.10.2','    W poz.68 należy wykazać dochód zwolniony od podatku 10)',67,10,1,'A',1);

_dod_zap('E.11.1.1','Składki na ubezpieczenia społeczne, o których mowa w przepisach ustawy',69,11,0,'A',1);
_dod_zap('E.11.1.2','  w tym zagraniczne, o których mowa w art. 26 ust. 1 pkt 2a ustawy',70,11,1,'A',1);
_dod_zap('E.12.2.1','Składki na ubezpieczenie zdrowotne, o których mowa w przepisach ustawy',71,12,0,'A',1);
_dod_zap('E.12.2.2','  w tym zagraniczne, o których mowa w art. 27b ust. 1 pkt 2 ustawy',72,12,1,'A',1);

_dod_zap('F. 1.1','Wynagrodzenie z tytułu umowy o pomocy przy zbiorach',73,13,0,'A',1);
_dod_zap('F. 2.1','75. ',75,14,0,'A',1);
_dod_zap('F. 3.1','77. ',77,15,0,'A',1);
_dod_zap('F. 4.1','79. ',79,16,0,'A',1);
_dod_zap('F. 5.1','Razem. Suma kwot z poz.: 74, 76, 78, 80.',80,17,0,'A',1);


_dod_zap('G. 1.1','Przychody z tytułu stypendium, o którym mowa w art. 21 ust. 1 pkt 40b ustawy',81,18,0,'A',1);
_dod_zap('G. 2.1','Przychody otrzymywane z zagranicy, o których mowa w art. 21 ust. 1 pkt 74 ustawy',82,19,0,'A',1);
_dod_zap('G. 3.1','Przychody pochodzące ze środków bezzwrotnej pomocy zagranicznej, art. 21',83,20,0,'A',1)


\pit8c_9_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8C (9) dla wersji 9
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! {? _d>=1 & _d<=5 & (_ind=1 | _ind=2)
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=6
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=7 & _ind=4
          || VAT_POZ.P4:=_c;
             VAT_POZ.KW4:=pit[_c]
          ?}
       !};VAT_POZ.add()";

_dod_zap('D.  1','1. Odpłatne zbycie papierów wartościowych',24,1,0,'A');
_dod_zap('D.  2','2. Realizacja praw wynikających z papierów wartościowych',26,2,0,'A');
_dod_zap('D.  3','3. Odpłatne zbycie pochodnych instrumentów finansowych oraz realizacja praw ...',28,3,0,'A');
_dod_zap('D.  4','4. Odpłatne zbycie niebędących papierami wartościowymi udziałów (akcji)',30,4,0,'A');
_dod_zap('D.  5','5. Objęcie udziałów (akcji) w spółkach albo wkładów w spółdzielniach ...',32,5,0,'A');
_dod_zap('D.  6','   Razem. Suma kwot z wierszy od 1 do 5.',34,6,0,'S');
_dod_zap('E.  7','   Przychód z odpłatnego zbycia papierów wartościowych',38,7,0,'A')


\poz_pit4r_8
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-4R (8) dla 8 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 8
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 8 ?};
exec('obl_pit4r_8','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first()
|| VAT_POZ.prefix();
   __TAB.prefix();
   _dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                    {? _d=8
                    || _poz:=($('VAT_POZ.P'+$_ind))();
                       {? _poz=109 | _poz=110 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                    ?}
                 !}
              ?}; VAT_POZ.add()";

   _dod_zap('C. 1.1','Liczba podatników',8,0,0,'A');
   _dod_zap('C. 1.2','Liczba podatników',20,0,6,'A');
   _dod_zap('C. 1.3','Należne zaliczki',14,1,0,'A');
   _dod_zap('C. 1.4','Należne zaliczki',26,1,6,'A');

   _dod_zap('C. 2.1','2. Zaliczki pobrane przez płatników, o których mowa',32,2,0,'R');
   _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',38,2,6,'R');

   _dod_zap('C. 3.1','3. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',44,3,0,'A');
   _dod_zap('C. 3.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy',50,3,6,'A');

   _dod_zap('C. 4.1','4. Zaliczki na podatek pobrane od innych należności,',56,4,0,'R');
   _dod_zap('C. 4.2','w tym wynikających z umowy aktywizacyjnej',62,4,6,'R');

   _dod_zap('C. 5.1','5. Suma pobranych zaliczek wykazanych w wierszach 1-4',68,5,0,'S');
   _dod_zap('C. 5.2','',74,5,6,'S');

   _dod_zap('C. 6.1','6. Zaliczki na podatek, których pobór został ograniczony',80,6,0,'R');
   _dod_zap('C. 6.2','na podstawie art.32 ust.2 ustawy',86,6,6,'R');

   _dod_zap('C. 7.1','7. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',92,7,0,'R');
   _dod_zap('C. 7.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',98,7,6,'R');

   _dod_zap('C. 8.1','8. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',104,8,0,'R');

   _dod_zap('C. 9.1','9. Nadpłaty wynikające z rozliczenia za rok ubiegły oraz zwrot nadpłat',108,9,0,'R');
   _dod_zap('C. 9.2','w gotówce zaliczone na poczet należnej zaliczki',114,9,6,'R');

   _dod_zap('C.10.1','10. Pobrany podatek, przekazany na PFRON',120,10,0,'R');
   _dod_zap('C.10.2','oraz zak. fun. rehab. osób niepełnos.',126,10,6,'R');

   _dod_zap('C.11.1','11. Pobrany podatek do przekazania do urzędu skarbowego za',132,11,0,'S');
   _dod_zap('C.11.2','poszczególne miesiące roku podatkowego 8)',138,11,6,'S');

   _dod_zap('C.12.1','12. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',144,12,0,'R');
   _dod_zap('C.12.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',150,12,6,'R');

   _dod_zap('C.13.1','13. Należne kwoty do wpłaty za poszczególne miesiące roku podatkowego 9)',156,13,0,'S');
   _dod_zap('C.13.2','',162,13,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit4r8
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 4R wersja 8
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,1);
{? VAT_POZ.first()
|| {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,2);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,3);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,4);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,5);
{? VAT_POZ.first()
|| {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,7);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,8);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,6);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,9);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,10);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,11,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,11);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,13,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,12);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,13,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,13);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


\poz_pit8ar_8
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (7) dla 8 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 8
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 8 ?};
exec('obl_pit8ar_8','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Należności osób zagranicznych, wymienione w art. 29 ustawy',8,1,0,'A');
   _dod_zap('C. 1.2','',14,1,6,'A');
   _dod_zap('C. 2.1','2. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',20,2,0,'R');
   _dod_zap('C. 2.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',26,2,6,'R');
   _dod_zap('C. 3.1','3. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',32,3,0,'A');
   _dod_zap('C. 3.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',38,3,6,'A');
   _dod_zap('C. 4.1','4. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',44,4,0,'R');
   _dod_zap('C. 4.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',50,4,6,'R');
   _dod_zap('C. 5.1','5. Świadczenia otrzymane od banków, SKOK-ów lub instytucji finansowych,',56,5,0,'R');
   _dod_zap('C. 5.2','   w związku z promocjami (art. 30 ust. 1 pkt 4b ustawy)',62,5,6,'R');
   _dod_zap('C. 6.1','6. Należności z tytułu, o którym mowa w art. 13 pkt 2 i 5-9 ustawy z umów',68,6,0,'R');
   _dod_zap('C. 6.2','   zawartych z osobą niebędącą pracownikiem płatnika (art. 30 ust. 1 pkt 5a..)',74,6,6,'R');
   _dod_zap('C. 7.1','7. Gromadzenie oszczędności na więcej niż jednym indywidualnym',80,7,0,'R');
   _dod_zap('C. 7.2','   koncie emerytalnym (art. 30 ust. 1 pkt 7a ustawy)',86,7,6,'R');
   _dod_zap('C. 8.1','8. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia,wypłacone żołnie-',92,8,0,'R');
   _dod_zap('C. 8.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',98,8,6,'R');
   _dod_zap('C. 9.1','9. Kwoty wypłat z indywidualnego konta zabezpieczenia emerytalnego',104,9,0,'R');
   _dod_zap('C. 9.2','   (art. 30 ust.1 pkt 14 ustawy)',110,9,6,'R');
   _dod_zap('C.10.1','10. Odszkodowania przyznane na podstawie przepisów o zakazie konkurencji',116,10,0,'R');
   _dod_zap('C.10.2','    (art. 30 ust. 1 pkt 15 ustawy)',122,10,6,'R');
   _dod_zap('C.11.1','11. Odprawy lub odszkodowania z tytułu skrócenia okresu wypowiedzenia umowy',128,11,0,'R');
   _dod_zap('C.11.2','    o pracę lub umowy o świadczenie usług zarządzania (art. 30 ust. 1 pkt 16..)',134,11,6,'R');
   _dod_zap('C.12.1','12. Odsetki od pożyczek (z wyjątkiem gdy udzielanie pożyczek jest przedmiotem',140,12,0,'R');
   _dod_zap('C.12.2','    działalności gospodarczej), (art. 30a ust. 1 pkt. 1 ustawy)',146,12,6,'R');
   _dod_zap('C.13.1','13. Odsetki i dyskonto od papierów wartościowych',152,13,0,'R');
   _dod_zap('C.13.2','    (art. 30a ust. 1 pkt 1 i 2 ustawy)',158,13,6,'R');
   _dod_zap('C.14.1','14. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na rachunku',164,14,0,'R');
   _dod_zap('C.14.2','    podatnika lub w innych formach ...(art. 30a ust. 1 pkt 3 ustawy)',170,14,6,'R');
   _dod_zap('C.15.1','15. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',176,15,0,'R');
   _dod_zap('C.15.2','    (art. 30a ust. 1 pkt 4 ustawy)',182,15,6,'R');
   _dod_zap('C.16.1','16. Dochód z tytułu udziału w funduszach kapitałowych',188,16,0,'R');
   _dod_zap('C.16.2','   (art. 30a ust. 1 pkt 5 ustawy)',194,16,6,'R');
   _dod_zap('C.17.1','17. Dochód z tytułu umów ubezpieczenia, o którym mowa w art. 24 ust. 15a',200,17,0,'R');
   _dod_zap('C.17.2','    (art. 30a ust. 1 pkt 5a ustawy)',206,17,6,'R');
   _dod_zap('C.18.1','18. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego ',212,18,0,'R');
   _dod_zap('C.18.2','    (art. 30a ust 1 pkt 6 ustawy)',218,18,6,'R');
   _dod_zap('C.19.1','19. Dochód członka pracowniczego funduszu emerytalnego z tytułu',224,19,0,'R');
   _dod_zap('C.19.2','    przeniesienia akcji (art. 30a ust. 1 pkt 7 ustawy)',230,19,6,'R');
   _dod_zap('C.20.1','20. Przychody z tytułu zbycia prawa poboru akcji',236,20,0,'R');
   _dod_zap('C.20.2','    (art. 30a ust 1 pkt 8 ustawy)',242,20,6,'R');
   _dod_zap('C.21.1','21. Kwoty jednorazowo wypłacane przez otwarty fundusz emerytalny, w związku',248,21,0,'R');
   _dod_zap('C.21.2','    ze śmiercią współmałżonka (art. 30a ust. 1 pkt 9 ustawy)',254,21,6,'R');
   _dod_zap('C.22.1','22. Kwoty jednorazowo wypłacane przez ZUS, w związku ze śmiercią współmałżonka)',260,22,0,'R');
   _dod_zap('C.22.2','    (art. 30a ust. 1 pkt 9a ustawy)',266,22,6,'R');
   _dod_zap('C.23.1','23. Dochód oszczędzającego na indywidualnym koncie emerytalnym z tytułu zwrotu',272,23,0,'R');
   _dod_zap('C.23.2','    lub częściowego zwrotu zgromadzonych środków (art. 30a ust. 1 pkt 10 ustawy)',278,23,6,'R');
   _dod_zap('C.24.1','24. Dochód uczestnika pracowniczego programu emerytalnego z tytułu zwrotu',284,24,0,'R');
   _dod_zap('C.24.2','    zgromadzonych środków (art. 30a ust. 1 pkt 11 ustawy)',290,24,6,'R');
   _dod_zap('C.25.1','25. Kwoty wypłaty gwarantowanej (art. 30a ust. 1 pkt 12 ustawy)',296,25,0,'R');
   _dod_zap('C.25.2','',302,25,6,'R');
   _dod_zap('C.26.1','26. Inne należności niewymienione w wierszach 1-25',308,26,0,'A');
   _dod_zap('C.26.2','',314,26,6,'A');
   _dod_zap('C.27.1','27. Suma pobranego zryczałtowanego podatku do przekazania do urzędu skarbowego',320,27,0,'S');
   _dod_zap('C.27.2','    za poszczególne miesiące z wierszy 1-26',326,27,6,'S');
   _dod_zap('C.28.1','28. Wynagrodzenie płatnika za poszczególne miesiące',332,28,0,'R');
   _dod_zap('C.28.2','    - zgodnie z art. 28 Ordynacji podatkowej',338,28,6,'R');
   _dod_zap('C.29.1','29. Kwoty do wpłaty za poszczególne miesiące',344,29,0,'S');
   _dod_zap('C.29.2','    Od kwot za poszczególne miesiące z wiersza 27 należy odpowiednio odjąć kwoty z wiersza 28.',350,29,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit8ar8
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 8AR wersja 7
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
{! _ix:=1..26
|! VAT_POZ.prefix(VAT_DEK.ref,_ix);
   {? VAT_POZ.first()
   || {!
      |? {? _ix>1 || _czyblank+=1 ?};
         _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,27,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?}
!};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,27);
{? VAT_POZ.first()
|| {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,29,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,28);
{? VAT_POZ.first()
|| {! |? _czyblank+=1;
         _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,29,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,29);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


\vat_dek_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [19.42]
:: OPIS: Wyzwalacz "Usuń - przed" dla tabeli VAT_DEK.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
DOKUM.cntx_psh();
DOKUM.index('STAN');
DOKUM.prefix(REF.FIRMA,$VAT_DEK.ref());
{? DOKUM.first()
|| {! |? _uid:=DOKUM.uidref(); _rr:=DOKUM.del(); exec('dokumlog_del','zbl_dok',_uid); _rr !}
?};
DOKUM.cntx_pop();
exec('del_ndx','#table',ZALACZ,'NAG',VAT_DEK.uidref())


\vat_dek_zalaczniki_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [19.42]
:: OPIS: Obsługa akcji "Załączniki - przed" w oknach tabeli VAT_DEK.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_ws:=cur_win(1,1);
_act:=
   {? _ws='PIT8CGR' | _ws='WER8C'
   || 'PPL_ZDR_D8CD'
   |? _ws='PITIFTGR' | _ws='WERIFT1'
   || 'PPL_ZDR_DIFD'
   |? _ws='WERGR' |_ws='WERP'
   || 'PPL_ZDR_D11D'
   |? _ws='WERGR40' | _ws='WERP40'
   || 'PPL_ZDR_D40D'
   || ''
   ?};
_modify:={? _act='' || 0 || exec('chk_role','#b__box',OPERATOR.USER,_act) ?};
exec('show_zalacz','zalacz','OSOBA','VAT_DEK',_modify)


\stanowisko
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [19.42]
:: OPIS: Formuła do obsługi stanowiska osoby tworzącej deklarację podatkową.
::   WE: [_a] [STRING] - Kod akcji: get*/set.
::       [_b] [STRING] - Nazwa stanowiska do zapamiętania (parametr obowiązkowy dla _a='set').
::   WY: W zależności od _a.
::----------------------------------------------------------------------------------------------------------------------
_akcja:={? var_pres('_a')=type_of('') & (_a='get' | _a='set') || _a || 'get' ?};

_sekcja:='PIT';
_parametr:='Stanowisko';

{? _akcja='get'
|| _stn:=exec('get','#profile',,_sekcja,_parametr);
   {? _stn<>''
   || return(_stn)
   ?};

   USERS.cntx_psh();
   USERS.prefix();
   {? USERS.seek(OPERATOR.USER) & USERS.OSOBA<>null()
   || _d0:=date(0,0,0);
      _dt:=date();
      P.cntx_psh();
      P.index('OSOZATR');
      P.prefix(exec('ref_firma','ustawienia'),USERS.OSOBA);
      _loop:=P.first();
      {!
      |? _stn='' & _loop
      |! {? P.DZA<_dt & (P.DZ=_d0 | P.DZ>_dt)
         || STN.cntx_psh();
            _stn:=P.ST().ST;
            STN.cntx_pop()
         ?};
         _loop:=P.next()
      !};
      P.cntx_pop()
   ?};
   USERS.cntx_pop();

   ~-_stn

|? _akcja='set'
|| {? var_pres('_b')=type_of('')
   || exec('set','#profile',,_sekcja,_parametr,~-_b)
   ?}
?}


\poz_pit4r_9
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-4R (9) dla 9 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 9
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 9 ?};
exec('obl_pit4r_9','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first()
|| VAT_POZ.prefix();
   __TAB.prefix();
   _dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                    {? _d=8
                    || _poz:=($('VAT_POZ.P'+$_ind))();
                       {? _poz=110 | _poz=111 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                    ?}
                 !}
              ?}; VAT_POZ.add()";

   _dod_zap('C. 1.1','Liczba podatników',9,0,0,'A');
   _dod_zap('C. 1.2','Liczba podatników',21,0,6,'A');
   _dod_zap('C. 1.3','Należne zaliczki',15,1,0,'A');
   _dod_zap('C. 1.4','Należne zaliczki',27,1,6,'A');

   _dod_zap('C. 2.1','2. Zaliczki pobrane przez płatników, o których mowa',33,2,0,'R');
   _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',39,2,6,'R');

   _dod_zap('C. 3.1','3. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',45,3,0,'A');
   _dod_zap('C. 3.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy',51,3,6,'A');

   _dod_zap('C. 4.1','4. Zaliczki na podatek pobrane od innych należności,',57,4,0,'R');
   _dod_zap('C. 4.2','w tym wynikających z umowy aktywizacyjnej',63,4,6,'R');

   _dod_zap('C. 5.1','5. Suma pobranych zaliczek wykazanych w wierszach 1-4',69,5,0,'S');
   _dod_zap('C. 5.2','',75,5,6,'S');

   _dod_zap('C. 6.1','6. Zaliczki na podatek, których pobór został ograniczony',81,6,0,'R');
   _dod_zap('C. 6.2','na podstawie art.32 ust.2 ustawy',87,6,6,'R');

   _dod_zap('C. 7.1','7. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',93,7,0,'R');
   _dod_zap('C. 7.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',99,7,6,'R');

   _dod_zap('C. 8.1','8. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',105,8,0,'R');

   _dod_zap('C. 9.1','9. Nadpłaty wynikające z rozliczenia za rok ubiegły oraz zwrot nadpłat',109,9,0,'R');
   _dod_zap('C. 9.2','w gotówce zaliczone na poczet należnej zaliczki',115,9,6,'R');

   _dod_zap('C.10.1','10. Pobrany podatek, przekazany na PFRON',121,10,0,'R');
   _dod_zap('C.10.2','oraz zak. fun. rehab. osób niepełnos.',127,10,6,'R');

   _dod_zap('C.11.1','11. Pobrany podatek do przekazania do urzędu skarbowego za',133,11,0,'S');
   _dod_zap('C.11.2','poszczególne miesiące roku podatkowego 9)',139,11,6,'S');

   _dod_zap('C.12.1','12. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',145,12,0,'R');
   _dod_zap('C.12.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',151,12,6,'R');

   _dod_zap('C.13.1','13. Należne kwoty do wpłaty za poszczególne miesiące roku podatkowego 10)',157,13,0,'S');
   _dod_zap('C.13.2','',163,13,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\poz_pit8ar_9
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (8) dla 9 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 9
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 9 ?};
exec('obl_pit8ar_9','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Należności osób zagranicznych, wymienione w art. 29 ustawy',9,1,0,'A');
   _dod_zap('C. 1.2','',15,1,6,'A');
   _dod_zap('C. 2.1','2. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',21,2,0,'R');
   _dod_zap('C. 2.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',27,2,6,'R');
   _dod_zap('C. 3.1','3. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',33,3,0,'A');
   _dod_zap('C. 3.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',39,3,6,'A');
   _dod_zap('C. 4.1','4. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',45,4,0,'R');
   _dod_zap('C. 4.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',51,4,6,'R');
   _dod_zap('C. 5.1','5. Świadczenia otrzymane od banków, SKOK-ów lub instytucji finansowych,',57,5,0,'R');
   _dod_zap('C. 5.2','   w związku z promocjami (art. 30 ust. 1 pkt 4b ustawy)',63,5,6,'R');
   _dod_zap('C. 6.1','6. Należności z tytułu, o którym mowa w art. 13 pkt 2 i 5-9 ustawy z umów',69,6,0,'R');
   _dod_zap('C. 6.2','   zawartych z osobą niebędącą pracownikiem płatnika (art. 30 ust. 1 pkt 5a..)',75,6,6,'R');
   _dod_zap('C. 7.1','7. Gromadzenie oszczędności na więcej niż jednym indywidualnym',81,7,0,'R');
   _dod_zap('C. 7.2','   koncie emerytalnym (art. 30 ust. 1 pkt 7a ustawy)',87,7,6,'R');
   _dod_zap('C. 8.1','8. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia,wypłacone żołnie-',93,8,0,'R');
   _dod_zap('C. 8.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',99,8,6,'R');
   _dod_zap('C. 9.1','9. Kwoty wypłat z indywidualnego konta zabezpieczenia emerytalnego',105,9,0,'R');
   _dod_zap('C. 9.2','   (art. 30 ust.1 pkt 14 ustawy)',111,9,6,'R');
   _dod_zap('C.10.1','10. Odszkodowania przyznane na podstawie przepisów o zakazie konkurencji',117,10,0,'R');
   _dod_zap('C.10.2','    (art. 30 ust. 1 pkt 15 ustawy)',123,10,6,'R');
   _dod_zap('C.11.1','11. Odprawy lub odszkodowania z tytułu skrócenia okresu wypowiedzenia umowy',129,11,0,'R');
   _dod_zap('C.11.2','    o pracę lub umowy o świadczenie usług zarządzania (art. 30 ust. 1 pkt 16..)',135,11,6,'R');
   _dod_zap('C.12.1','12. Odsetki od pożyczek (z wyjątkiem gdy udzielanie pożyczek jest przedmiotem',141,12,0,'R');
   _dod_zap('C.12.2','    działalności gospodarczej), (art. 30a ust. 1 pkt. 1 ustawy)',147,12,6,'R');
   _dod_zap('C.13.1','13. Odsetki i dyskonto od papierów wartościowych',153,13,0,'R');
   _dod_zap('C.13.2','    (art. 30a ust. 1 pkt 1 i 2 ustawy)',159,13,6,'R');
   _dod_zap('C.14.1','14. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na rachunku',165,14,0,'R');
   _dod_zap('C.14.2','    podatnika lub w innych formach ...(art. 30a ust. 1 pkt 3 ustawy)',171,14,6,'R');
   _dod_zap('C.15.1','15. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',177,15,0,'R');
   _dod_zap('C.15.2','    (art. 30a ust. 1 pkt 4 ustawy)',183,15,6,'R');
   _dod_zap('C.16.1','16. Dochód z tytułu udziału w funduszach kapitałowych',189,16,0,'R');
   _dod_zap('C.16.2','   (art. 30a ust. 1 pkt 5 ustawy)',195,16,6,'R');
   _dod_zap('C.17.1','17. Dochód z tytułu umów ubezpieczenia, o którym mowa w art. 24 ust. 15a',201,17,0,'R');
   _dod_zap('C.17.2','    (art. 30a ust. 1 pkt 5a ustawy)',207,17,6,'R');
   _dod_zap('C.18.1','18. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego ',213,18,0,'R');
   _dod_zap('C.18.2','    (art. 30a ust 1 pkt 6 ustawy)',219,18,6,'R');
   _dod_zap('C.19.1','19. Dochód członka pracowniczego funduszu emerytalnego z tytułu',225,19,0,'R');
   _dod_zap('C.19.2','    przeniesienia akcji (art. 30a ust. 1 pkt 7 ustawy)',231,19,6,'R');
   _dod_zap('C.20.1','20. Przychody z tytułu zbycia prawa poboru akcji',237,20,0,'R');
   _dod_zap('C.20.2','    (art. 30a ust 1 pkt 8 ustawy)',243,20,6,'R');
   _dod_zap('C.21.1','21. Kwoty jednorazowo wypłacane przez otwarty fundusz emerytalny, w związku',249,21,0,'R');
   _dod_zap('C.21.2','    ze śmiercią współmałżonka (art. 30a ust. 1 pkt 9 ustawy)',255,21,6,'R');
   _dod_zap('C.22.1','22. Kwoty jednorazowo wypłacane przez ZUS, w związku ze śmiercią współmałżonka)',261,22,0,'R');
   _dod_zap('C.22.2','    (art. 30a ust. 1 pkt 9a ustawy)',267,22,6,'R');
   _dod_zap('C.23.1','23. Dochód oszczędzającego na indywidualnym koncie emerytalnym z tytułu zwrotu',273,23,0,'R');
   _dod_zap('C.23.2','    lub częściowego zwrotu zgromadzonych środków (art. 30a ust. 1 pkt 10 ustawy)',279,23,6,'R');
   _dod_zap('C.24.1','24. Dochód uczestnika pracowniczego programu emerytalnego z tytułu zwrotu',285,24,0,'R');
   _dod_zap('C.24.2','    zgromadzonych środków (art. 30a ust. 1 pkt 11 ustawy)',291,24,6,'R');
   _dod_zap('C.25.1','25. Kwoty wypłaty gwarantowanej (art. 30a ust. 1 pkt 12 ustawy)',297,25,0,'R');
   _dod_zap('C.25.2','',303,25,6,'R');
   _dod_zap('C.26.1','26. Inne należności niewymienione w wierszach 1-25',309,26,0,'A');
   _dod_zap('C.26.2','',315,26,6,'A');
   _dod_zap('C.27.1','27. Suma pobranego zryczałtowanego podatku do przekazania do urzędu skarbowego',321,27,0,'S');
   _dod_zap('C.27.2','    za poszczególne miesiące z wierszy 1-26',327,27,6,'S');
   _dod_zap('C.28.1','28. Wynagrodzenie płatnika za poszczególne miesiące',333,28,0,'R');
   _dod_zap('C.28.2','    - zgodnie z art. 28 Ordynacji podatkowej',339,28,6,'R');
   _dod_zap('C.29.1','29. Kwoty do wpłaty za poszczególne miesiące',345,29,0,'S');
   _dod_zap('C.29.2','    Od kwot za poszczególne miesiące z wiersza 27 należy odpowiednio odjąć kwoty z wiersza 28.',351,29,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\pit8c_10_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8C (10) dla wersji 10
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('pit')<100 || return(0) ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! {? _d>=1 & _d<=5 & (_ind=1 | _ind=2)
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=6
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=7 & _ind=4
          || VAT_POZ.P4:=_c;
             VAT_POZ.KW4:=pit[_c]
          ?}
       !};VAT_POZ.add()";

_dod_zap('D.  1','1. Odpłatne zbycie papierów wartościowych',23,1,0,'A');
_dod_zap('D.  2','2. Realizacja praw wynikających z papierów wartościowych',25,2,0,'A');
_dod_zap('D.  3','3. Odpłatne zbycie pochodnych instrumentów finansowych oraz realizacja praw ...',27,3,0,'A');
_dod_zap('D.  4','4. Odpłatne zbycie niebędących papierami wartościowymi udziałów (akcji)',29,4,0,'A');
_dod_zap('D.  5','5. Objęcie udziałów (akcji) w spółkach albo wkładów w spółdzielniach ...',31,5,0,'A');
_dod_zap('D.  6','   Razem. Suma kwot z wierszy od 1 do 5.',33,6,0,'S');
_dod_zap('E.  7','   Przychód z odpłatnego zbycia papierów wartościowych',37,7,0,'A')


\poz_ift1_15
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej IFT-1/IFT1R dla wersji 12
::----------------------------------------------------------------------------------------------------------------------
_akt:={? var_pres('_a')=type_of(1) & _a || 1 || 0 ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
          ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
       !}; VAT_POZ.add()";

_dod_zap('D.  1','1. Dochody z żeglugi morskiej, żeglugi śródlądowej i transportu lotniczego',34,1,0,'R');
_dod_zap('D.  2','2. Dywidendy ',38,2,0,'A');
_dod_zap('D.  3','3. Odsetki',42,3,0,'R');
_dod_zap('D.  4','4. Należności licencyjne',46,4,0,'R');
_dod_zap('D.  5','5. Dochód z wykonywania wolnego zawodu',50,5,0,'A');
_dod_zap('D.  6','6. Wynagrodzenie dyrektorów',54,6,0,'R');
_dod_zap('D.  7','7. Dochód z działalności artystycznej lub sportowej',58,7,0,'R');
_dod_zap('D.  8','8. Dochód z emerytury lub renty i innych podobnych świadczeń',62,8,0,'R');
_dod_zap('D.  9','9. Inne dochody',66,9,0,'R');
_dod_zap('D. 10','10. Przychód określony zgodnie z art.29-30a ustawy',70,10,0,'A')


\poz_pit11p_10
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (25) dla 10 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix;
VAT_POZ.blank;
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {? _d=16 || VAT_POZ.OP+=pit[76] ?};
           {? _d=17 || VAT_POZ.OP+=pit[78] ?};
           {? _d=18 || VAT_POZ.OP+=pit[80] ?};
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=44 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=7 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=60 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=7 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=8 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=15 || VAT_POZ.RODZ:='Wynagrodzenie z tytułu umowy o pomocy przy zbiorach' ?};
              {? _d=16 || VAT_POZ.RODZ:=pit[76] ?};
              {? _d=17 || VAT_POZ.RODZ:=pit[78] ?};
              {? _d=18 || VAT_POZ.RODZ:=pit[80] ?}
           !};
           VAT_POZ.add";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',28,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.34 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',33,1,1,'A',2);
_dod_zap('E. 1.3','   W poz.32 należy wykazać dochód zwolniony od podatku 12)',31,1,2,'A',1);
{? #VAT_DEK.OKRES=2019
|| _dod_zap('E. 2.1','2. Należności z tytułów wymienionych w wierszu 1, otrzymane od dnia 1.08.2019 r.',35,2,0,'A',4)
|| _dod_zap('E. 2.1','2. Należności z tytułów wymienionych w wierszu 1, otrzymane do ukończenia 26 r.',35,2,0,'A',4)
?};
_dod_zap('E. 2.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',40,2,1,'A',2);
_dod_zap('E. 2.3','   W poz.39 należy wykazać dochód zwolniony od podatku 12)',38,2,2,'A',1);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',42,3,0,'A',4);
_dod_zap('E. 3.2','   W poz.45 należy wykazać dochód zwolniony od podatku 12)',44,3,1,'A',1);
_dod_zap('E. 4.1','4. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4-9',46,4,0,'A',4);
_dod_zap('E. 5.1','5. Należności z tytułu umowy zlecenia, o której mowa w art. 13 pkt 8 ustawy ...',50,5,0,'A',4);
{? #VAT_DEK.OKRES=2019
|| _dod_zap('E. 6.1','6. Należności z tytułu wymienionego w wierszu 5, otrzymane ... od dnia 1.08.2019 r.',54,6,0,'A',4)
|| _dod_zap('E. 6.1','6. Należności z tytułu wymienionego w wierszu 5, otrzymane do ukończenia 26 r.',54,6,0,'A',4)
?};
_dod_zap('E. 7.1','7. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',58,7,0,'A',4);
_dod_zap('E. 7.2','   W poz.62 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3 ustawy.',61,7,1,'A',2);
_dod_zap('E. 8.1','8. Inne źródła',63,8,0,'A',4);
_dod_zap('E. 8.2','   W poz.67 należy wykazać dochód zwolniony od podatku 12)',66,8,1,'A',1);

_dod_zap('E. 9.1','Skł. na ub. społ., o których mowa w art. 26 ust. 1 pkt 2a ustawy, bez poz. 70',68,9,0,'A',1);
_dod_zap('E.10.1','Skł. na ub. społ., podstawę stanowi przychód wymieniony w wierszach 2 i 6 cz. E',69,10,0,'A',1);
_dod_zap('E.11.1','Skł. na ub. społ., stanowi przychód zwolniony na podstawie art. 21 ust. 1 pkt 148 ustawy, w poz. 86',70,11,0,'A',1);
_dod_zap('E.12.1','Skł. na ub. zdrow., o których mowa w art. 27b ust. 1 pkt 2 ustawy, bez poz. 73',71,12,0,'A',1);
_dod_zap('E.13.1','Skł. na ub. zdrow., których podstawę stanowi przychód w wierszach 2 i 6 części E',72,13,0,'A',1);
_dod_zap('E.14.1','Skł. na ub. zdrow., prz. zwol. na podst. art. 21 ust. 1 pkt 148 ust., w poz. 86',73,14,0,'A',1);

_dod_zap('F. 1.1','Wynagrodzenie z tytułu umowy o pomocy przy zbiorach',74,15,0,'A',1);
_dod_zap('F. 2.1','76. ',76,16,0,'A',1);
_dod_zap('F. 3.1','78. ',78,17,0,'A',1);
_dod_zap('F. 4.1','80. ',80,18,0,'A',1);
_dod_zap('F. 5.1','Razem. Suma kwot z poz.: 75, 77, 79 i 81.',81,19,0,'S',1);


_dod_zap('G. 1.1','Przychody z tytułu stypendium, o którym mowa w art. 21 ust. 1 pkt 40b ustawy',82,20,0,'A',1);
_dod_zap('G. 2.1','Przychody otrzymywane z zagranicy, o których mowa w art. 21 ust. 1 pkt 74 ustawy',83,21,0,'A',1);
_dod_zap('G. 3.1','Przychody pochodzące ze środków bezzwrotnej pomocy zagranicznej, art. 21',84,22,0,'A',1);
_dod_zap('G. 4.1','Przychody ze stosunku pracy i stosunków pokrewnych oraz z umów zlecenia',85,23,0,'S',1);
_dod_zap('G. 4.1.1','  W tym przychody ze stosunku pracy i stosunków pokrewnych',86,24,0,'A',1);
_dod_zap('G. 4.1.2','  W tym przychody z umów zlecenia',87,25,0,'A',1)


\kor_rodz_xml
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja do określenia pola Rodzaj korekty P_7 dla PIT-4R, PIT-8AR. Jeśli pole Cel złożenia określa korekta
::       VAT_DEK.KOR='T' to wyznaczamy wartość tego pola 1 brak ORD-ZU lub 2 wypełnione ORD-ZU
::   WY: '1', '2' lub '' gdy VAT_DEK.KOR='N'
::----------------------------------------------------------------------------------------------------------------------
{? VAT_DEK.KOR='T'
|| {? var_pres('KOR_RODZ',VAT_DEK)>0
   || VAT_DEK.KOR_RODZ
   || {? exec('konwersja_xml','xml',exec('opis_korekty','edeklar'))<>''
      || '2'
      || '1'
      ?}
   ?}
|| ''
?}


\popraw_pit11b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Popraw przed dla okienek wertowania tabeli VAT_POZ dla PIT-11
::----------------------------------------------------------------------------------------------------------------------
{? exec('is_edek','xml',SKID.DEKL_NAZ)
|| FUN.emsg('Istnieją e-Deklaracje.\nModyfikowanie zabronione.'@);
   _edycja:=0
|? VAT_POZ.TYP='S'
|| FUN.emsg('Wiersz będący podsumowaniem.\nModyfikacje zabronione.'@);
   _edycja:=0
|? VAT_POZ.TYP='A'
|| _edycja:=FUN.choice('Wiersz wyliczany automatycznie na podstawie danych z systemu.'@+'\nKontynuować?'@,,'Tak','Nie')=1
|| _edycja:=1
?};
{? _edycja
|| _vern:=VAT_DEK.NR().NR;
   {? _vern=10 | _vern=11
   || exec('edycja_PIT11','edeklar')
   |? _vern=12
   || exec('edycja_PIT11_12','edeklar')
   |? _vern=13
   || exec('edycja_PIT11_13','edeklar')
   |? _vern=14
   || exec('edycja_PIT11_14','edeklar')
   ?}
?};
_edycja


\popraw_pit11a
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Popraw po dla okienek wertowania tabeli VAT_POZ dla PIT-11
::----------------------------------------------------------------------------------------------------------------------
_vern:=VAT_DEK.NR().NR;
{? _vern=10 | _vern=11
|| VAT_POZ.cntx_psh();
   VAT_POZ.index('NR_NRK');
   _suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
          {? VAT_POZ.find_key(VAT_DEK.ref(),_[5],_[6])
          || {? _[7]=0 || {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+':=0'))() !} ?};
             {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
          ?}; VAT_POZ.cntx_pop()";

   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),15);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,19,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),16);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,19,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),17);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,19,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),18);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,19,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),24);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,23,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),25);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,23,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.cntx_pop()
|? _vern=12
|| VAT_POZ.cntx_psh();
   VAT_POZ.index('NR_NRK');
   _suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
          {? VAT_POZ.find_key(VAT_DEK.ref(),_[5],_[6])
          || {? _[7]=0 || {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+':=0'))() !} ?};
             {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
          ?}; VAT_POZ.cntx_pop()";

   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),17);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,21,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),18);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,21,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),19);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,21,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),20);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,21,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),26);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,25,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),27);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,25,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),28);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,25,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.cntx_pop()
|? _vern=13
|| VAT_POZ.cntx_psh();
   VAT_POZ.index('NR_NRK');
   _suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
          {? VAT_POZ.find_key(VAT_DEK.ref(),_[5],_[6])
          || {? _[7]=0 || {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+':=0'))() !} ?};
             {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
          ?}; VAT_POZ.cntx_pop()";

   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),16);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,20,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),17);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,20,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),18);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,20,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),19);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,20,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),25);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,24,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),26);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,24,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),27);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,24,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),29);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,28,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),30);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,28,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.cntx_pop()
|? _vern=14
|| exec('popraw_pit11po','edeklar',_vern)
?}


\edycja_PIT11
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Popraw przed, gdy edycja możliwa ustawiamy edycja pól VAT_POZ.KW1-KW4 oraz VAT_POZ.RODZ
::----------------------------------------------------------------------------------------------------------------------
:: Ustawienie edycji pola VAT_POZ.RODZ
{? (VAT_POZ.NR>=1 & VAT_POZ.NR<=15) | (VAT_POZ.NR>=19 & VAT_POZ.NR<=25)
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"0")
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"1")
?};
:: Ustawienie formatu pola VAT_POZ.KW4 tylko pełne złote
VAT_POZ.fld_fml('KW4','EDIT_FORMAT',"'in_prec=0'");
VAT_POZ.fld_fml('KW4','DISPLAY_FORMAT',"'out_prec=0'");
:: Ustawienie edycji pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
VAT_POZ.fld_fml('KW1','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"*");
:: Ustawienie odpowiednich blokad edycji dla wybranego wiersza pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
{? VAT_POZ.NR=1 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=1 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=7 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=7 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=8 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR>=9
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
?}


\vat_poz_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Rekord po dla okienek wertowania tabeli VAT_POZ dla PIT-11
::----------------------------------------------------------------------------------------------------------------------
{? VAT_POZ.KW1<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$VAT_POZ.P1]);
   return('KW1')
?};
{? VAT_POZ.KW2<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$VAT_POZ.P2]);
   return('KW2')
?};
{? VAT_POZ.KW3<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$VAT_POZ.P3]);
   return('KW3')
?};
{? VAT_POZ.KW4<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$VAT_POZ.P4]);
   return('KW4')
?};
_vern:=VAT_POZ.VAT_DEK().NR().NR;
{? _vern=10 | _vern=11
|| {? VAT_POZ.NR>=16 & VAT_POZ.NR<=18
   || _spr:=__CHK.record2(VAT_POZ,'RODZ','Rodzaj przychodu'@,'KW1','Kwota'@);
      return(_spr)
   ?}
|? _vern=12
|| {? VAT_POZ.NR>=18 & VAT_POZ.NR<=20
   || {? VAT_POZ.RODZ<>''
      || _spr:=__CHK.record2(VAT_POZ,'KW1','Kwota'@);
         return(_spr)
      ?};
      {? VAT_POZ.KW1
      || _spr:=__CHK.record2(VAT_POZ,'RODZ','Rodzaj przychodu'@);
         return(_spr)
      ?}
   ?}
|? _vern=13
|| {? VAT_POZ.NR>=18 & VAT_POZ.NR<=20
   || {? VAT_POZ.RODZ<>''
      || _spr:=__CHK.record2(VAT_POZ,'KW1','Kwota'@);
         return(_spr)
      ?};
      {? VAT_POZ.KW1
      || _spr:=__CHK.record2(VAT_POZ,'RODZ','Rodzaj przychodu'@);
         return(_spr)
      ?}
   ?}
|? _vern=14
|| {? VAT_POZ.NR>=19 & VAT_POZ.NR<=22
   || {? VAT_POZ.RODZ<>''
      || _spr:=__CHK.record2(VAT_POZ,'KW1','Kwota'@);
         return(_spr)
      ?};
      {? VAT_POZ.KW1
      || _spr:=__CHK.record2(VAT_POZ,'RODZ','Rodzaj przychodu'@);
         return(_spr)
      ?}
   ?};
   {? VAT_POZ.NR>=33 & VAT_POZ.NR<=35
   || {? VAT_POZ.KW1>0
      || _nr:={? VAT_POZ.NR=33
              || 115
              |? VAT_POZ.NR=34
              || 116
              || 117
              ?};
         FUN.emsg('W pozycji %1 jest wykazywany przychód zwolniony od podatku.'
            '\nNależy uzupełnić podstawę prawną dla tego zwolnienia.'
            '\nW pozycji %2 należy wybrać odpowiednią podstawę zwolnienia – pkt 152, 153 lub 154.'@[$_nr,$118])
      ?}
   ?}
?};
''


\nr_infor
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja przed redakcją pola VAT_DEK.NR_INFOR - obecnie zawsze można edytować
::----------------------------------------------------------------------------------------------------------------------
1


\pit11_popraw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja na Rekord po dla deklaracji PIT-11 dla okienka redagowania PIT11_19
::----------------------------------------------------------------------------------------------------------------------
 _spr:=__CHK.record(VAT_DEK,,'OPIS','IMIE','NAZ','STN','DATA');
{? _spr=''
|| {? VAT_DEK.NR_INFOR<0
   || FUN.emsg('Wartość pola "Numer informacji" nie może być ujemna.'@);
      _spr:='NR_INFOR'
   ?};
   {? VAT_DEK.NR_INFOR>99
   || FUN.emsg('Wartość pola "Numer informacji" nie może być większa od 99.'@);
      _spr:='NR_INFOR'
   ?}
?};
_spr


\nr_inforedit
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja przed redakcją pola PIT_EDIT.NR_INFOR - obecnie zawsze można edytować
::----------------------------------------------------------------------------------------------------------------------
1


\nr_infor_xml
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja do określenia pola Numer informacji P_5 dla PIT-11(25) od 10 wersja e-deklaracji,
::       pole nie jest obowiazkowe w edeklaracji.
::   WY: Kolejny numer jako '1', '2' lub '' gdy nie jest podane
::----------------------------------------------------------------------------------------------------------------------
_ret:='';
{? var_pres('NR_INFOR',VAT_DEK)>0
|| {? VAT_DEK.NR_INFOR>0 || _ret:=$VAT_DEK.NR_INFOR || _ret:='' ?}
|| _ret:=''
?};
_ret


\poz_pit4r_10
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-4R (10) dla 10 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 10
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 10 ?};
exec('obl_pit4r_10','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first()
|| VAT_POZ.prefix();
   __TAB.prefix();
   _dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                    {? _d=8
                    || _poz:=($('VAT_POZ.P'+$_ind))();
                       {? _poz=110 | _poz=111 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                    ?}
                 !}
              ?}; VAT_POZ.add()";

   _dod_zap('C. 1.1','Liczba podatników',9,0,0,'A');
   _dod_zap('C. 1.2','Liczba podatników',21,0,6,'A');
   _dod_zap('C. 1.3','Należne zaliczki',15,1,0,'A');
   _dod_zap('C. 1.4','Należne zaliczki',27,1,6,'A');

   _dod_zap('C. 2.1','2. Zaliczki pobrane przez płatników, o których mowa',33,2,0,'R');
   _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',39,2,6,'R');

   _dod_zap('C. 3.1','3. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',45,3,0,'A');
   _dod_zap('C. 3.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy',51,3,6,'A');

   _dod_zap('C. 4.1','4. Zaliczki na podatek pobrane od innych należności,',57,4,0,'R');
   _dod_zap('C. 4.2','w tym wynikających z umowy aktywizacyjnej',63,4,6,'R');

   _dod_zap('C. 5.1','5. Suma pobranych zaliczek wykazanych w wierszach 1-4',69,5,0,'S');
   _dod_zap('C. 5.2','',75,5,6,'S');

   _dod_zap('C. 6.1','6. Zaliczki na podatek, których pobór został ograniczony',81,6,0,'R');
   _dod_zap('C. 6.2','na podstawie art.32 ust.2 ustawy',87,6,6,'R');

   _dod_zap('C. 7.1','7. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',93,7,0,'R');
   _dod_zap('C. 7.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',99,7,6,'R');

   _dod_zap('C. 8.1','8. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',105,8,0,'R');

   _dod_zap('C. 9.1','9. Pobrany podatek, przekazany na PFRON',109,9,0,'R');
   _dod_zap('C. 9.2','oraz zak. fun. rehab. osób niepełnos.',115,9,6,'R');

   _dod_zap('C.10.1','10. Pobrany podatek do przekazania do urzędu skarbowego za poszczególne',121,10,0,'S');
   _dod_zap('C.10.2','miesiące roku podatkowego 9)',127,10,6,'S');

   _dod_zap('C.11.1','11. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',133,11,0,'R');
   _dod_zap('C.11.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',139,11,6,'R');

   _dod_zap('C.12.1','12. Należny podatek do wpłaty za poszczególne miesiące roku podatkowego 10)',145,12,0,'S');
   _dod_zap('C.12.2','',151,12,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit4r10
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 4R wersja 10
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,1);
{? VAT_POZ.first()
|| {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,2);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,3);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,4);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,5);
{? VAT_POZ.first()
|| {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,7);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,8);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,6);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,9);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,10);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,12,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,11);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,12,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,12);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


\poz_pit8ar_10
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (9) dla 10 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 10
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 9 ?};
exec('obl_pit8ar_10','pit',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Należności osób zagranicznych, wymienione w art. 29 ustawy',9,1,0,'A');
   _dod_zap('C. 1.2','',15,1,6,'A');
   _dod_zap('C. 2.1','2. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',21,2,0,'R');
   _dod_zap('C. 2.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',27,2,6,'R');
   _dod_zap('C. 3.1','3. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',33,3,0,'A');
   _dod_zap('C. 3.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',39,3,6,'A');
   _dod_zap('C. 4.1','4. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',45,4,0,'R');
   _dod_zap('C. 4.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',51,4,6,'R');
   _dod_zap('C. 5.1','5. Świadczenia otrzymane od banków, SKOK-ów lub instytucji finansowych,',57,5,0,'R');
   _dod_zap('C. 5.2','   w związku z promocjami (art. 30 ust. 1 pkt 4b ustawy)',63,5,6,'R');
   _dod_zap('C. 6.1','6. Należności z tytułu, o którym mowa w art. 13 pkt 2 i 5-9 ustawy z umów',69,6,0,'R');
   _dod_zap('C. 6.2','   zawartych z osobą niebędącą pracownikiem płatnika (art. 30 ust. 1 pkt 5a..)',75,6,6,'R');
   _dod_zap('C. 7.1','7. Gromadzenie oszczędności na więcej niż jednym indywidualnym',81,7,0,'R');
   _dod_zap('C. 7.2','   koncie emerytalnym (art. 30 ust. 1 pkt 7a ustawy)',87,7,6,'R');
   _dod_zap('C. 8.1','8. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia,wypłacone żołnie-',93,8,0,'R');
   _dod_zap('C. 8.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',99,8,6,'R');
   _dod_zap('C. 9.1','9. Kwoty wypłat z indywidualnego konta zabezpieczenia emerytalnego',105,9,0,'R');
   _dod_zap('C. 9.2','   (art. 30 ust.1 pkt 14 ustawy)',111,9,6,'R');
   _dod_zap('C.10.1','10. Odszkodowania przyznane na podstawie przepisów o zakazie konkurencji',117,10,0,'R');
   _dod_zap('C.10.2','    (art. 30 ust. 1 pkt 15 ustawy)',123,10,6,'R');
   _dod_zap('C.11.1','11. Odprawy lub odszkodowania z tytułu skrócenia okresu wypowiedzenia umowy',129,11,0,'R');
   _dod_zap('C.11.2','    o pracę lub umowy o świadczenie usług zarządzania (art. 30 ust. 1 pkt 16..)',135,11,6,'R');
   _dod_zap('C.12.1','12. Odsetki od pożyczek (z wyjątkiem gdy udzielanie pożyczek jest przedmiotem',141,12,0,'R');
   _dod_zap('C.12.2','    działalności gospodarczej), (art. 30a ust. 1 pkt. 1 ustawy)',147,12,6,'R');
   _dod_zap('C.13.1','13. Odsetki i dyskonto od papierów wartościowych',153,13,0,'R');
   _dod_zap('C.13.2','    (art. 30a ust. 1 pkt 1 i 2 ustawy)',159,13,6,'R');
   _dod_zap('C.14.1','14. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na rachunku',165,14,0,'R');
   _dod_zap('C.14.2','    podatnika lub w innych formach ...(art. 30a ust. 1 pkt 3 ustawy)',171,14,6,'R');
   _dod_zap('C.15.1','15. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',177,15,0,'R');
   _dod_zap('C.15.2','    (art. 30a ust. 1 pkt 4 ustawy)',183,15,6,'R');
   _dod_zap('C.16.1','16. Dochód z tytułu udziału w funduszach kapitałowych',189,16,0,'R');
   _dod_zap('C.16.2','   (art. 30a ust. 1 pkt 5 ustawy)',195,16,6,'R');
   _dod_zap('C.17.1','17. Dochód z tytułu umów ubezpieczenia, o którym mowa w art. 24 ust. 15a',201,17,0,'R');
   _dod_zap('C.17.2','    (art. 30a ust. 1 pkt 5a ustawy)',207,17,6,'R');
   _dod_zap('C.18.1','18. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego ',213,18,0,'R');
   _dod_zap('C.18.2','    (art. 30a ust 1 pkt 6 ustawy)',219,18,6,'R');
   _dod_zap('C.19.1','19. Dochód członka pracowniczego funduszu emerytalnego z tytułu',225,19,0,'R');
   _dod_zap('C.19.2','    przeniesienia akcji (art. 30a ust. 1 pkt 7 ustawy)',231,19,6,'R');
   _dod_zap('C.20.1','20. Przychody z tytułu zbycia prawa poboru akcji',237,20,0,'R');
   _dod_zap('C.20.2','    (art. 30a ust 1 pkt 8 ustawy)',243,20,6,'R');
   _dod_zap('C.21.1','21. Kwoty jednorazowo wypłacane przez otwarty fundusz emerytalny, w związku',249,21,0,'R');
   _dod_zap('C.21.2','    ze śmiercią współmałżonka (art. 30a ust. 1 pkt 9 ustawy)',255,21,6,'R');
   _dod_zap('C.22.1','22. Kwoty jednorazowo wypłacane przez ZUS, w związku ze śmiercią współmałżonka)',261,22,0,'R');
   _dod_zap('C.22.2','    (art. 30a ust. 1 pkt 9a ustawy)',267,22,6,'R');
   _dod_zap('C.23.1','23. Dochód oszczędzającego na indywidualnym koncie emerytalnym z tytułu zwrotu',273,23,0,'R');
   _dod_zap('C.23.2','    lub częściowego zwrotu zgromadzonych środków (art. 30a ust. 1 pkt 10 ustawy)',279,23,6,'R');
   _dod_zap('C.24.1','24. Dochód uczestnika pracowniczego programu emerytalnego z tytułu zwrotu',285,24,0,'R');
   _dod_zap('C.24.2','    zgromadzonych środków (art. 30a ust. 1 pkt 11 ustawy)',291,24,6,'R');
   _dod_zap('C.25.1','25. Dochód uczestnika pracowniczego planu kapitałowego uzyskany w związku',297,25,0,'R');
   _dod_zap('C.25.2','    z wypłatą dokonaną na podstawie art. 98 ustawy o PPK',303,25,6,'R');
   _dod_zap('C.26.1','26. Dochód uczestnika pracowniczego planu kapitałowego uzyskany w związku',309,26,0,'R');
   _dod_zap('C.26.2','    z wypłatą dokonaną na podstawie art. 99 ust. 1 pkt 2 ustawy o PPK',315,26,6,'R');
   _dod_zap('C.27.1','27. Dochód małżonka lub byłego małżonka uczestnika PPK z tytułu zwrotu',321,27,0,'R');
   _dod_zap('C.27.2','    środków (art. 30a ust. 1 pkt 11c ustawy)',327,27,6,'R');
   _dod_zap('C.28.1','28. Dochód uczestnika pracowniczego planu kapitałowego z tytułu zwrotu',333,28,0,'R');
   _dod_zap('C.28.2','    środków (art. 30a ust. 1 pkt 11d ustawy)',339,28,6,'R');
   _dod_zap('C.29.1','29. Dochód małżonka lub byłego małżonka z tytułu wypłaty 75% środków, które',345,29,0,'R');
   _dod_zap('C.29.2','    mu przekazano w formie wypłaty transferowej (art. 30a ust. 1 pkt 11e ustawy)',351,29,6,'R');
   _dod_zap('C.30.1','30. Dochód uczestnika pracowniczego planu kapitałowego z tytułu wypłaty 75%',357,30,0,'R');
   _dod_zap('C.30.2','    mu przekazane w formie wypłaty transferowej (art. 30a ust. 1 pkt 11f)',363,30,6,'R');
   _dod_zap('C.31.1','31. Kwoty wypłaty gwarantowanej (art. 30a ust. 1 pkt 12 ustawy)',369,31,0,'R');
   _dod_zap('C.31.2','',375,31,6,'R');
   _dod_zap('C.32.1','32. Inne należności niewymienione w wierszach 1-31',381,32,0,'A');
   _dod_zap('C.32.2','',387,32,6,'A');
   _dod_zap('C.33.1','33. Suma pobranego zryczałtowanego podatku do przekazania do urzędu skarbowego',393,33,0,'S');
   _dod_zap('C.33.2','    za poszczególne miesiące z wierszy 1-32',399,33,6,'S');
   _dod_zap('C.34.1','34. Wynagrodzenie płatnika za poszczególne miesiące',405,34,0,'R');
   _dod_zap('C.34.2','    - zgodnie z art. 28 Ordynacji podatkowej',411,34,6,'R');
   _dod_zap('C.35.1','35. Kwoty do wpłaty za poszczególne miesiące',417,35,0,'S');
   _dod_zap('C.35.2','    Od kwot za poszczególne miesiące z wiersza 33 należy odpowiednio odjąć kwoty z wiersza 34.',423,35,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit8ar10
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 8AR wersja 10
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
{! _ix:=1..32
|! VAT_POZ.prefix(VAT_DEK.ref,_ix);
   {? VAT_POZ.first()
   || {!
      |? {? _ix>1 || _czyblank+=1 ?};
         _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,33,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?}
!};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,33);
{? VAT_POZ.first()
|| {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,35,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,34);
{? VAT_POZ.first()
|| {! |? _czyblank+=1;
         _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,35,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,35);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


\dodatkowe_covid
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja do sprawdzenia czy mamy wypełnione Informacje dodatkowe dotyczące COVID-19 do edeklaracja.
::       Analiza pól VAT_DEK.PAR1, VAT_DEK.PAR2, VAT_DEK.PAR3, VAT_DEK.PAR4, VAT_DEK.PAR5, VAT_DEK.ZAL1,
::       ze wzgledu na brak czasu i zmiany w PIT-4R i PIT-8AR jako pole grudzien 2020 uzywamy
::       pole VAT_DEK.ZAL1 nie VAT_DEK.PAR6
::       które mamy w VAT_DEK lub należy dodać w aktualizacja.
::       Dla roku 2021 i późniejszych dodano obsługę sprawdzania nowych pól: VAT_DEK.PDOF1, VAT_DEK.PDOF2,
::       VAT_DEK.PDOF3, VAT_DEK.PDOF4, VAT_DEK.PDOF5, VAT_DEK.PDOF6. Ze względu na ograniczenia techniczne
::       pola VAT_DEK.PAR[1-5] oznaczają miesiące styczeń-maj, pole VAT_DEK.ZAL1 - miesiąc czerwiec,
::       natomiast nowe pola VAT_DEK.PDOF[1-6] - miesiące lipiec-grudzień.
::----------------------------------------------------------------------------------------------------------------------
VAT_DEK.PAR1='T' | VAT_DEK.PAR2='T' | VAT_DEK.PAR3='T' | VAT_DEK.PAR4='T' | VAT_DEK.PAR5='T' | VAT_DEK.ZAL1=1
|
{? var_pres('PDOF1',VAT_DEK)<0
|| return(0)
|| VAT_DEK.PDOF1='T'
?}
|
{? var_pres('PDOF2',VAT_DEK)<0
|| return(0)
|| VAT_DEK.PDOF2='T'
?}
|
{? var_pres('PDOF3',VAT_DEK)<0
|| return(0)
|| VAT_DEK.PDOF3='T'
?}
|
{? var_pres('PDOF4',VAT_DEK)<0
|| return(0)
|| VAT_DEK.PDOF4='T'
?}
|
{? var_pres('PDOF5',VAT_DEK)<0
|| return(0)
|| VAT_DEK.PDOF5='T'
?}
|
{? var_pres('PDOF6',VAT_DEK)<0
|| return(0)
|| VAT_DEK.PDOF6='T'
?}


\pole_covid
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja sprawdza wartość pola VAT_DEK.PAR1, VAT_DEK.PAR2, VAT_DEK.PAR, VAT_DEK.PAR4,
::       VAT_DEK.PAR5, VAT_DEK.ZAL1.
::       ze wzgledu na brak czasu i zmiany w PIT-4R i PIT-8AR jako pole grudzien 2020 uzywamy
::       pole VAT_DEK.ZAL1 nie VAT_DEK.PAR6
::       Jeżeli jest równe 'T' lub 1 dla VAT_DEK.ZAL1 to zwraca '1' w przeciwnym przypadku ''
::       zgodnie z wymaganiami xsd dla e-deklaracji
::       W wyniku zmian w 2021 roku (obsługa przesunięć zaliczek dla całego roku) dla PIT-4R i
::       PIT-8AR wprowadzono nowe pola VAT_DEK.PDOF1, VAT_DEK.PDOF2, VAT_DEK.PDOF3,
::       VAT_DEK.PDOF4, VAT_DEK.PDOF5, VAT_DEK.PDOF6, które odpowiadają odpowiednio miesiącom
::       lipiec-grudzień. Dotychczas wykorzystywanym polom VAT_DEK.PAR[1-5] przyporządkowano
::       miesiące styczeń-maj, a w przypadku pola VAT_DEK.ZAL1 - miesiąc czerwiec.
::   WE: _a - 1 do 12
::   WY: '1' lub ''
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 1 ?};
{? _a>12 | _a<0 || return('') ?};
{? _a<6
|| {? var_pres('PAR'+$_a,VAT_DEK)<0 || return('') ?};
   _wyn:=($('VAT_DEK.PAR'+$_a))();
   {? _wyn='T' || '1' || '' ?}
|? _a=6
|| {? var_pres('ZAL1',VAT_DEK)<0 || return('') ?};
   {? VAT_DEK.ZAL1=1 || '1' || '' ?}
|| {? var_pres('PDOF'+$(_a-6),VAT_DEK)<0 || return('') ?};
   _wyn:=($('VAT_DEK.PDOF'+$(_a-6)))();
   {? _wyn='T' || '1' || '' ?}
?}


\poz_ift1_16
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej IFT-1/IFT1R dla wersji 16
::----------------------------------------------------------------------------------------------------------------------
_akt:={? var_pres('_a')=type_of(1) & _a || 1 || 0 ?};
VAT_POZ.index('VAT_POZ');
VAT_POZ.prefix(VAT_DEK.ref);

{? var_pres('pit')<100 || return(0) ?};
_dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
       VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
       VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
       {! _ind:=1..4
       |! {? _d=11
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c-4,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          |? _d=12
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c-8,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          || ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind-1);
             ($('VAT_POZ.KW'+$_ind))():=pit[_c+_ind-1]
          ?}
       !}; VAT_POZ.add()";

_dod_zap('D.  1','1. Dochody z żeglugi morskiej, żeglugi śródlądowej i transportu lotniczego',34,1,0,'R');
_dod_zap('D.  2','2. Dywidendy ',38,2,0,'A');
_dod_zap('D.  3','3. Odsetki',42,3,0,'R');
_dod_zap('D.  4','4. Należności licencyjne',46,4,0,'R');
_dod_zap('D.  5','5. Dochód z wykonywania wolnego zawodu',50,5,0,'A');
_dod_zap('D.  6','6. Wynagrodzenie dyrektorów',54,6,0,'R');
_dod_zap('D.  7','7. Dochód z działalności artystycznej lub sportowej',58,7,0,'R');
_dod_zap('D.  8','8. Dochód z emerytury lub renty i innych podobnych świadczeń',62,8,0,'R');
_dod_zap('D.  9','9. Inne dochody',66,9,0,'R');
_dod_zap('D. 10.1','10(10). Przychód określony zgodnie z art.29-30a ustawy',70,10,0,'A');
_dod_zap('D. 10.2','10(11). Przychód określony zgodnie z art.29-30a ustawy',74,11,0,'A');
_dod_zap('D. 10.3','10(12). Przychód określony zgodnie z art.29-30a ustawy',78,12,0,'A')


\poz_pit11p_12
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (27) dla 12 wersji
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix();
VAT_POZ.blank();
_dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {? _d=18 || VAT_POZ.OP+=pit[82] ?};
           {? _d=19 || VAT_POZ.OP+=pit[84] ?};
           {? _d=20 || VAT_POZ.OP+=pit[86] ?};
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=3 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=44 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=3 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=7 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=60 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=7 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? (_d=8 | _d=9) & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? {? _d=8 || _poz=65 || _poz=68 ?} || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? (_d=8 | _d=9) & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? (_d=8 | _d=9) & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=10 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=17 || VAT_POZ.RODZ:='Wynagrodzenie z tytułu umowy o pomocy przy zbiorach' ?};
              {? _d=18 || VAT_POZ.RODZ:=pit[82] ?};
              {? _d=19 || VAT_POZ.RODZ:=pit[84] ?};
              {? _d=20 || VAT_POZ.RODZ:=pit[86] ?}
           !};
           VAT_POZ.add()";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',28,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.34 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',33,1,1,'A',2);
_dod_zap('E. 1.3','   W poz.32 należy wykazać dochód zwolniony od podatku 12)',31,1,2,'A',1);
_dod_zap('E. 2.1','2. Należności z tytułów wymienionych w wierszu 1, otrzymane do ukończenia 26 r.',35,2,0,'A',4);
_dod_zap('E. 2.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3 ustawy.',40,2,1,'A',2);
_dod_zap('E. 2.3','   W poz.39 należy wykazać dochód zwolniony od podatku 12)',38,2,2,'A',1);
_dod_zap('E. 3.1','3. Emerytury - renty zagraniczne',42,3,0,'A',4);
_dod_zap('E. 3.2','   W poz.45 należy wykazać dochód zwolniony od podatku 12)',44,3,1,'A',1);
_dod_zap('E. 4.1','4. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4-9',46,4,0,'A',4);
_dod_zap('E. 5.1','5. Należności z tytułu umowy zlecenia, o której mowa w art. 13 pkt 8 ustawy ...',50,5,0,'A',4);
_dod_zap('E. 6.1','6. Należności z tytułu wymienionego w wierszu 5, otrzymane do ukończenia 26 r.',54,6,0,'A',4);
_dod_zap('E. 7.1','7. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',58,7,0,'A',4);
_dod_zap('E. 7.2','   W poz.62 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3 ustawy.',61,7,1,'A',2);
_dod_zap('E. 8.1','8. Należności z tytułu praktyk absolwenckich lub staży uczniowskich, ...',63,8,0,'A',4);
_dod_zap('E. 9.1','9. Należności z tytułu wymienionego w wierszu 8, otrzymane przez podatn. do 26r.',66,9,0,'A',4);
_dod_zap('E.10.1','10. Inne źródła',69,10,0,'A',4);
_dod_zap('E.10.2','   W poz.73 należy wykazać dochód zwolniony od podatku 12)',72,10,1,'A',1);

_dod_zap('E.11.1','Skł. na ub. społ., o których mowa w art. 26 ust. 1 pkt 2a ustawy, z wyj. poz. 76',74,11,0,'A',1);
_dod_zap('E.12.1','Skł. na ub. społ., podst. stanowi przychód wymieniony w wierszach 2, 6 i 9 cz. E',75,12,0,'A',1);
_dod_zap('E.13.1','Skł. na ub. społ., stanowi prz. zwol. na podstawie art. 21 ust. 1 pkt 148 ustawy, w poz. 92',76,13,0,'A',1);
_dod_zap('E.14.1','Skł. na ub. zdrow., o których mowa w art. 27b ust. 1 pkt 2 ustawy, bez poz. 79',77,14,0,'A',1);
_dod_zap('E.15.1','Skł. na ub. zdrow., których podstawę stanowi przychód w wierszach 2, 6 i 9 cz. E',78,15,0,'A',1);
_dod_zap('E.16.1','Skł. na ub. zdrow., prz. zwol. na podst. art. 21 ust. 1 pkt 148 ust., w poz. 92',79,16,0,'A',1);

_dod_zap('F. 1.1','Wynagrodzenie z tytułu umowy o pomocy przy zbiorach',80,17,0,'A',1);
_dod_zap('F. 2.1','82. ',82,18,0,'A',1);
_dod_zap('F. 3.1','84. ',84,19,0,'A',1);
_dod_zap('F. 4.1','86. ',86,20,0,'A',1);
_dod_zap('F. 5.1','Razem. Suma kwot z poz.: 81, 83, 85 i 87.',87,21,0,'S',1);


_dod_zap('G. 1.1','Przychody z tytułu stypendium, o którym mowa w art. 21 ust. 1 pkt 40b ustawy',88,22,0,'A',1);
_dod_zap('G. 2.1','Przychody otrzymywane z zagranicy, o których mowa w art. 21 ust. 1 pkt 74 ustawy',89,23,0,'A',1);
_dod_zap('G. 3.1','Przychody pochodzące ze środków bezzwrotnej pomocy zagranicznej, art. 21',90,24,0,'A',1);
_dod_zap('G. 4.1','Przychody ze stosunku pracy i stosunków pokrewnych z umów zlecenia ...',91,25,0,'S',1);
_dod_zap('G. 4.1.1','  W tym przychody ze stosunku pracy i stosunków pokrewnych',92,26,0,'A',1);
_dod_zap('G. 4.1.2','  W tym przychody z umów zlecenia',93,27,0,'A',1);
_dod_zap('G. 4.1.3','  W tym przychody z tytułu praktyk absolwenckich lub staży uczniowskich',94,28,0,'A',1)


\edycja_PIT11_12
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Popraw przed dla 12 wersja, gdy edycja możliwa ustawiamy edycja pól VAT_POZ.KW1-KW4 oraz VAT_POZ.RODZ
::----------------------------------------------------------------------------------------------------------------------
:: Ustawienie edycji pola VAT_POZ.RODZ
{? (VAT_POZ.NR>=1 & VAT_POZ.NR<=17) | (VAT_POZ.NR>=21 & VAT_POZ.NR<=28)
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"0")
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"1")
?};
:: Ustawienie formatu pola VAT_POZ.KW4 tylko pełne złote
VAT_POZ.fld_fml('KW4','EDIT_FORMAT',"'in_prec=0'");
VAT_POZ.fld_fml('KW4','DISPLAY_FORMAT',"'out_prec=0'");
:: Ustawienie edycji pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
VAT_POZ.fld_fml('KW1','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"*");
:: Ustawienie odpowiednich blokad edycji dla wybranego wiersza pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
{? VAT_POZ.NR=1 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=1 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=7 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=7 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? (VAT_POZ.NR=8 | VAT_POZ.NR=9) & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=10 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR>=11
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
?}


\poz_pit11p_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (28) dla 13 wersji od 01.01.2022
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix();
VAT_POZ.blank();
_dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {? _d=17 || VAT_POZ.OP+=pit[90] ?};
           {? _d=18 || VAT_POZ.OP+=pit[92] ?};
           {? _d=19 || VAT_POZ.OP+=pit[94] ?};
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=51 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=4 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=9 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=71 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=9 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? (_d=10 | _d=11) & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? {? _d=10 || _poz=76 || _poz=79 ?} || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? (_d=10 | _d=11) & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? (_d=10 | _d=11) & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? _d=12 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=16 || VAT_POZ.RODZ:='Wynagrodzenie z tytułu umowy o pomocy przy zbiorach' ?};
              {? _d=17 || VAT_POZ.RODZ:=pit[90] ?};
              {? _d=18 || VAT_POZ.RODZ:=pit[92] ?};
              {? _d=19 || VAT_POZ.RODZ:=pit[94] ?};
::            Zmiany 2022 Rodzaj (podstawa prawna) przychodu zwolnionego od podatku, wykazanego w poz. 104
::            wykazanego w poz 107 w wierszu 31 tabeli VAT_POZ wersja 13 edeklaracji
              {? _d=31 & exec('akt_147','edeklar')
              || VAT_POZ.ZP152:=__P_107.PKT_152;
                 VAT_POZ.ZP153:=__P_107.PKT_153;
                 VAT_POZ.ZP154:=__P_107.PKT_154
              ?}
           !};
           VAT_POZ.add()";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',28,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.34 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3',33,1,1,'A',2);
_dod_zap('E. 1.3','   W poz.32 należy wykazać dochód zwolniony od podatku 12)',31,1,2,'A',1);
_dod_zap('E. 2.1','2. Należności z tytułów wymienionych w wierszu 1, otrzymane do ukończenia 26 r.',35,2,0,'A',4);
_dod_zap('E. 2.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3',40,2,1,'A',2);
_dod_zap('E. 2.3','   W poz.39 należy wykazać dochód zwolniony od podatku 12)',38,2,2,'A',1);
_dod_zap('E. 3.1','3. Należności z tytułów wymienionych w wierszu 1, od ukończenia wieku emerytal.',42,3,0,'A',4);
_dod_zap('E. 3.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3',47,3,1,'A',2);
_dod_zap('E. 3.3','   W poz.46 należy wykazać dochód zwolniony od podatku 12)',45,3,2,'A',1);
_dod_zap('E. 4.1','4. Emerytury - renty zagraniczne',49,4,0,'A',4);
_dod_zap('E. 4.2','   W poz.52 należy wykazać dochód zwolniony od podatku 12)',51,4,1,'A',1);
_dod_zap('E. 5.1','5. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4-9',53,5,0,'A',4);
_dod_zap('E. 6.1','6. Należności z tytułu umowy zlecenia, o której mowa w art. 13 pkt 8 ustawy ...',57,6,0,'A',4);
_dod_zap('E. 7.1','7. Należności z tytułu wymienionego w wierszu 6, otrzymane do ukończenia 26 r.',61,7,0,'A',4);
_dod_zap('E. 8.1','8. Należności z tytułu wymienionego w wierszu 6, od ukończenia wieku emerytal.',65,8,0,'A',4);
_dod_zap('E. 9.1','9. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',69,9,0,'A',4);
_dod_zap('E. 9.2','   W poz.73 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3.',72,9,1,'A',2);
_dod_zap('E.10.1','10. Należności z tytułu praktyk absolwenckich lub staży uczniowskich, ...',74,10,0,'A',4);
_dod_zap('E.11.1','11. Należności z tytułu wymienionego w wier. 10, otrzymane przez podatn. do 26r.',77,11,0,'A',4);
_dod_zap('E.12.1','12. Inne źródła',80,12,0,'A',4);
_dod_zap('E.12.2','   W poz.84 należy wykazać dochód zwolniony od podatku 12)',83,12,1,'A',1);

_dod_zap('E.13.1','Skł. na ub. społ., o których mowa w art. 26 ust. 1 pkt 2a ustawy, z wyj. poz. 87',85,13,0,'A',1);
_dod_zap('E.14.1','Skł. na ub. społ., podst. stanowi przychód wymieniony w wierszach 2,3,7,8,11',86,14,0,'A',1);
_dod_zap('E.15.1','Skł. na ub. społ., stanowi prz. zwol. na pod. art. 21 ust. 1 pkt 148, 152-154',87,15,0,'A',1);

_dod_zap('F. 1.1','Wynagrodzenie z tytułu umowy o pomocy przy zbiorach',88,16,0,'A',1);
_dod_zap('F. 2.1','90. ',90,17,0,'A',1);
_dod_zap('F. 3.1','92. ',92,18,0,'A',1);
_dod_zap('F. 4.1','94. ',94,19,0,'A',1);
_dod_zap('F. 5.1','Razem. Suma kwot z poz.: 89, 91, 93 i 95.',95,20,0,'S',1);


_dod_zap('G. 1.1','Przychody z tytułu stypendium, o którym mowa w art. 21 ust. 1 pkt 40b ustawy',96,21,0,'A',1);
_dod_zap('G. 2.1','Przychody otrzymywane z zagranicy, o których mowa w art. 21 ust. 1 pkt 74 ustawy',97,22,0,'A',1);
_dod_zap('G. 3.1','Przychody pochodzące ze środków bezzwrotnej pomocy zagranicznej, art. 21',98,23,0,'A',1);
_dod_zap('G. 4.1','Przychody ze stosunku pracy i stosunków pokrewnych z umów zlecenia ...',99,24,0,'S',1);
_dod_zap('G. 4.1.1','  W tym przychody ze stosunku pracy i stosunków pokrewnych',100,25,0,'A',1);
_dod_zap('G. 4.1.2','  W tym przychody z umów zlecenia',101,26,0,'A',1);
_dod_zap('G. 4.1.3','  W tym przychody z tytułu praktyk absolwenckich lub staży uczniowskich',102,27,0,'A',1);
_dod_zap('G. 5.1','Przychody ze stosunku pracy i stosunków pokrewnych z umów zlecenia pkt 152-154',103,28,0,'S',1);
_dod_zap('G. 5.1.1','  W tym przychody ze stosunku pracy i stosunków pokrewnych',104,29,0,'A',1);
_dod_zap('G. 5.1.2','  W tym przychody z umów zlecenia',105,30,0,'A',1);
_dod_zap('G. 6.1','Rodzaj (podstawa prawna) przychodu zwolnionego od podatku, wykazanego w poz. 104',106,31,0,'A',1);
_dod_zap('G. 7.1','Składki na ubezpieczenie zdrowotne pobrane przez płatnika 22)',108,32,0,'A',1);
_dod_zap('G. 8.1','Składki członkowskie na rzecz związków zawodowych pobrane przez płatnika',109,33,0,'A',1)


\edycja_PIT11_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Popraw przed dla 13 wersja, gdy edycja możliwa ustawiamy edycja pól VAT_POZ.KW1-KW4 oraz VAT_POZ.RODZ
::----------------------------------------------------------------------------------------------------------------------
:: Ustawienie edycji pola VAT_POZ.RODZ
{? (VAT_POZ.NR>=1 & VAT_POZ.NR<=15) | (VAT_POZ.NR>=21 & VAT_POZ.NR<=33)
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"0")
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"1")
?};
:: Ustawienie formatu pola VAT_POZ.KW4 tylko pełne złote
VAT_POZ.fld_fml('KW4','EDIT_FORMAT',"'in_prec=0'");
VAT_POZ.fld_fml('KW4','DISPLAY_FORMAT',"'out_prec=0'");
:: Ustawienie edycji pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
VAT_POZ.fld_fml('KW1','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"*");
:: Ustawienie odpowiednich blokad edycji dla wybranego wiersza pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
{? VAT_POZ.NR=1 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=1 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=4 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=4 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=9 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=9 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? (VAT_POZ.NR=10 | VAT_POZ.NR=11) & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=12 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR>=13 & VAT_POZ.NR<=30
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=31
|| VAT_POZ.fld_fml('KW1','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR>=32
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
?};
:: Dla aktualizacja 12.51_147 ustawiamy edycję pól VAT_POZ.ZP152..ZP154
:: możliwa tylko dla 31 wiersza tabeli VAT_POZ
_akt_147:=exec('akt_147','edeklar');
{? _akt_147
|| {? VAT_POZ.NR=31
   || {! _ind:=152..154
      |! VAT_POZ.fld_fml('ZP'+$_ind,'BEFORE_EDIT',"{? __Rok>=2022 || 1 || 0 ?}")
      !}
   || {! _ind:=152..154
      |! VAT_POZ.fld_fml('ZP'+$_ind,'BEFORE_EDIT',"0")
      !}
   ?}
?}


\poz_pit8ar_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (13) dla 12 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 13
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 13 ?};
exec('obl_pit8ar_13','pit1',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Należności osób zagranicznych, wymienione w art. 29 ustawy',9,1,0,'A');
   _dod_zap('C. 1.2','',15,1,6,'A');
   _dod_zap('C. 2.1','2. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',21,2,0,'R');
   _dod_zap('C. 2.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',27,2,6,'R');
   _dod_zap('C. 3.1','3. Świadczenia otrzymane przez emerytów lub rencistów będących byłymi',33,3,0,'A');
   _dod_zap('C. 3.2','   pracownikami (art.30 ust.1 pkt 4 ustawy)',39,3,6,'A');
   _dod_zap('C. 4.1','4. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',45,4,0,'R');
   _dod_zap('C. 4.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',51,4,6,'R');
   _dod_zap('C. 5.1','5. Świadczenia otrzymane od banków, SKOK-ów lub instytucji finansowych,',57,5,0,'R');
   _dod_zap('C. 5.2','   w związku z promocjami (art. 30 ust. 1 pkt 4b ustawy)',63,5,6,'R');
   _dod_zap('C. 6.1','6. Należności z tytułu, o którym mowa w art. 13 pkt 2 i 5-9 ustawy z umów',69,6,0,'R');
   _dod_zap('C. 6.2','   zawartych z osobą niebędącą pracownikiem płatnika (art. 30 ust. 1 pkt 5a..)',75,6,6,'R');
   _dod_zap('C. 7.1','7. Gromadzenie oszczędności na więcej niż jednym indywidualnym',81,7,0,'R');
   _dod_zap('C. 7.2','   koncie emerytalnym (art. 30 ust. 1 pkt 7a ustawy)',87,7,6,'R');
   _dod_zap('C. 8.1','8. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia,wypłacone żołnie-',93,8,0,'R');
   _dod_zap('C. 8.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',99,8,6,'R');
   _dod_zap('C. 9.1','9. Kwoty wypłat z indywidualnego konta zabezpieczenia emerytalnego',105,9,0,'R');
   _dod_zap('C. 9.2','   (art. 30 ust.1 pkt 14 ustawy)',111,9,6,'R');
   _dod_zap('C.10.1','10. Odszkodowania przyznane na podstawie przepisów o zakazie konkurencji',117,10,0,'R');
   _dod_zap('C.10.2','    (art. 30 ust. 1 pkt 15 ustawy)',123,10,6,'R');
   _dod_zap('C.11.1','11. Odprawy lub odszkodowania z tytułu skrócenia okresu wypowiedzenia umowy',129,11,0,'R');
   _dod_zap('C.11.2','    o pracę lub umowy o świadczenie usług zarządzania (art. 30 ust. 1 pkt 16..)',135,11,6,'R');
   _dod_zap('C.12.1','12. Odsetki od pożyczek (z wyjątkiem gdy udzielanie pożyczek jest przedmiotem',141,12,0,'R');
   _dod_zap('C.12.2','    działalności gospodarczej), (art. 30a ust. 1 pkt. 1 ustawy)',147,12,6,'R');
   _dod_zap('C.13.1','13. Odsetki i dyskonto od papierów wartościowych',153,13,0,'R');
   _dod_zap('C.13.2','    (art. 30a ust. 1 pkt 1 i 2 ustawy)',159,13,6,'R');
   _dod_zap('C.14.1','14. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na rachunku',165,14,0,'R');
   _dod_zap('C.14.2','    podatnika lub w innych formach ...(art. 30a ust. 1 pkt 3 ustawy)',171,14,6,'R');
   _dod_zap('C.15.1','15. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',177,15,0,'R');
   _dod_zap('C.15.2','    (art. 30a ust. 1 pkt 4 ustawy)',183,15,6,'R');
   _dod_zap('C.16.1','16. Dochód z tytułu udziału w funduszach kapitałowych',189,16,0,'R');
   _dod_zap('C.16.2','   (art. 30a ust. 1 pkt 5 ustawy)',195,16,6,'R');
   _dod_zap('C.17.1','17. Dochód z tytułu umów ubezpieczenia, o którym mowa w art. 24 ust. 15a',201,17,0,'R');
   _dod_zap('C.17.2','    (art. 30a ust. 1 pkt 5a ustawy)',207,17,6,'R');
   _dod_zap('C.18.1','18. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego ',213,18,0,'R');
   _dod_zap('C.18.2','    (art. 30a ust 1 pkt 6 ustawy)',219,18,6,'R');
   _dod_zap('C.19.1','19. Dochód członka pracowniczego funduszu emerytalnego z tytułu',225,19,0,'R');
   _dod_zap('C.19.2','    przeniesienia akcji (art. 30a ust. 1 pkt 7 ustawy)',231,19,6,'R');
   _dod_zap('C.20.1','20. Przychody z tytułu zbycia prawa poboru akcji',237,20,0,'R');
   _dod_zap('C.20.2','    (art. 30a ust 1 pkt 8 ustawy)',243,20,6,'R');
   _dod_zap('C.21.1','21. Kwoty jednorazowo wypłacane przez otwarty fundusz emerytalny, w związku',249,21,0,'R');
   _dod_zap('C.21.2','    ze śmiercią współmałżonka (art. 30a ust. 1 pkt 9 ustawy)',255,21,6,'R');
   _dod_zap('C.22.1','22. Kwoty jednorazowo wypłacane przez ZUS, w związku ze śmiercią współmałżonka)',261,22,0,'R');
   _dod_zap('C.22.2','    (art. 30a ust. 1 pkt 9a ustawy)',267,22,6,'R');
   _dod_zap('C.23.1','23. Dochód oszczędzającego na indywidualnym koncie emerytalnym z tytułu zwrotu',273,23,0,'R');
   _dod_zap('C.23.2','    lub częściowego zwrotu zgromadzonych środków (art. 30a ust. 1 pkt 10 ustawy)',279,23,6,'R');
   _dod_zap('C.24.1','24. Dochód uczestnika pracowniczego programu emerytalnego z tytułu zwrotu',285,24,0,'R');
   _dod_zap('C.24.2','    zgromadzonych środków (art. 30a ust. 1 pkt 11 ustawy)',291,24,6,'R');
   _dod_zap('C.25.1','25. Dochód uczestnika pracowniczego planu kapitałowego uzyskany w związku',297,25,0,'R');
   _dod_zap('C.25.2','    z wypłatą dokonaną na podstawie art. 98 ustawy o PPK',303,25,6,'R');
   _dod_zap('C.26.1','26. Dochód uczestnika pracowniczego planu kapitałowego uzyskany w związku',309,26,0,'R');
   _dod_zap('C.26.2','    z wypłatą dokonaną na podstawie art. 99 ust. 1 pkt 2 ustawy o PPK',315,26,6,'R');
   _dod_zap('C.27.1','27. Dochód małżonka lub byłego małżonka uczestnika PPK z tytułu zwrotu',321,27,0,'R');
   _dod_zap('C.27.2','    środków (art. 30a ust. 1 pkt 11c ustawy)',327,27,6,'R');
   _dod_zap('C.28.1','28. Dochód uczestnika pracowniczego planu kapitałowego z tytułu zwrotu',333,28,0,'R');
   _dod_zap('C.28.2','    środków (art. 30a ust. 1 pkt 11d ustawy)',339,28,6,'R');
   _dod_zap('C.29.1','29. Dochód małżonka lub byłego małżonka z tytułu wypłaty 75% środków, które',345,29,0,'R');
   _dod_zap('C.29.2','    mu przekazano w formie wypłaty transferowej (art. 30a ust. 1 pkt 11e ustawy)',351,29,6,'R');
   _dod_zap('C.30.1','30. Dochód uczestnika pracowniczego planu kapitałowego z tytułu wypłaty 75%',357,30,0,'R');
   _dod_zap('C.30.2','    mu przekazane w formie wypłaty transferowej (art. 30a ust. 1 pkt 11f)',363,30,6,'R');
   _dod_zap('C.31.1','31. Kwoty wypłaty gwarantowanej (art. 30a ust. 1 pkt 12 ustawy)',369,31,0,'R');
   _dod_zap('C.31.2','',375,31,6,'R');
   _dod_zap('C.32.1','32. Dochód z tytułu otrzymania składników majątku w związku z likwidacją,',381,32,0,'R');
   _dod_zap('C.32.2','    spółki niebędącej osobą prawną wystąpieniem wspólnika z takiej spółki ...',387,32,6,'R');
   _dod_zap('C.33.1','33. Inne należności niewymienione w wierszach 1-32',393,33,0,'A');
   _dod_zap('C.33.2','',399,33,6,'A');
   _dod_zap('C.34.1','34. Suma pobranego zryczałtowanego podatku do przekazania do urzędu skarbowego',405,34,0,'S');
   _dod_zap('C.34.2','    za poszczególne miesiące z wierszy 1-33',411,34,6,'S');
   _dod_zap('C.35.1','35. Wynagrodzenie płatnika za poszczególne miesiące',417,35,0,'R');
   _dod_zap('C.35.2','    - zgodnie z art. 28 Ordynacji podatkowej',423,35,6,'R');
   _dod_zap('C.36.1','36. Kwoty do wpłaty za poszczególne miesiące. Od kwot za poszczególne miesiące',429,36,0,'S');
   _dod_zap('C.36.2','    z wiersza 34 należy odpowiednio odjąć kwoty z wiersza 35.',435,36,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit8ar13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 8AR wersja 13
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
{! _ix:=1..33
|! VAT_POZ.prefix(VAT_DEK.ref,_ix);
   {? VAT_POZ.first()
   || {!
      |? {? _ix>1 || _czyblank+=1 ?};
         _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,34,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?}
!};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,34);
{? VAT_POZ.first()
|| {! |? _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,36,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,35);
{? VAT_POZ.first()
|| {! |? _czyblank+=1;
         _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,36,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,36);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


\akt_147
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula sprawdzająca czy jest wgrana AK 12.51_147 PIT-2022
::----------------------------------------------------------------------------------------------------------------------
_akt_147:=var_pres('ZP152',VAT_POZ)>0 & var_pres('ZP153',VAT_POZ)>0 & var_pres('ZP154',VAT_POZ)>0 &
   var_pres('VAT_DEK',DEKL_POD)>0;
_akt_147


\zp_par_bd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formuła przed wyświetleniem pól VAT_POZ.ZP152..ZP154 dla deklaracji podatkowej PIT-11(28)
::       dodanych w aktualizacja 12.51_147 PIT-2022
::   WE:
::   WY: 1/0
::----------------------------------------------------------------------------------------------------------------------
{? BPMN.SYM_DOM='FKS' || return(1) ?};
{? SKID.DEKL_NAZ='PIT11'
|| {? __Rok>=2022
   || _vern:=VAT_DEK.NR().NR;
      {? _vern=13
      || {? VAT_POZ.NR=31 || 1 || 0 ?}
      |? _vern=14
      || {? VAT_POZ.NR=36 || 1 || 0 ?}
      || 1
      ?}
   || 0
   ?}
|| 1
?}


\zp_par_be
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formuła przed redakcją pól VAT_POZ.ZP152..ZP154 dla deklaracji podatkowej PIT-11(28)
::       dodanych w aktualizacja 12.51_147 PIT-2022
::   WE:
::   WY: 1/0
::----------------------------------------------------------------------------------------------------------------------
{? BPMN.SYM_DOM='FKS' || return(1) ?};
{? SKID.DEKL_NAZ='PIT11'
|| {? __Rok>=2022
   || _vern:=VAT_DEK.NR().NR;
      {? _vern=13
      || {? VAT_POZ.NR=31 || 1 || 0 ?}
      |? _vern=14
      || {? VAT_POZ.NR=36 || 1 || 0 ?}
      || 0
      ?}
   || 0
   ?}
|| 0
?}


\zp_par_xml
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula wyznaczająca wartość rodzaju zwolnionego przychodu dla pkt 152-154
::       przy tworzeniu pliku xml dla e-deklaracji PIT-11 od 2022 roku.
::   WE: [_a] - [INTEGER] (wymagany) numer wiersza tabeli VAT_POZ
::       [_b] - [STRING] (wymagany) akronim pola do sprawdzenia np. 'ZP152', 'ZP153', 'ZP154'
::   WY: '' lub '1'
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('ZP152',VAT_POZ)<0 || return('') ?};
{? var_pres('ZP153',VAT_POZ)<0 || return('') ?};
{? var_pres('ZP154',VAT_POZ)<0 || return('') ?};
_wynik:='';
_wiersz:=_a;
_pole:=_b;
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
VAT_POZ.prefix(VAT_DEK.ref(),_wiersz);
{? VAT_POZ.first()
|| _wart:=($('VAT_POZ.'+_pole))();
   _wynik:={? _wart='T' || '1' || '' ?}
?};
VAT_POZ.cntx_pop();
_wynik


\wiersz1_xml
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Sprawdzająca czy są dane, aby wykazać wiersz 1, w którym jest podany rodzaj kosztów uzyskania.
::       Dla wiersza 2 lub 3 od 2022 roku należy wykazać również wiersz 1 z określonym polem P_28
::       oraz zerowymi kwotami.
::   WE:
::   WY: 1/0
::----------------------------------------------------------------------------------------------------------------------
exec('spr_poz36_17','edeklar',1,0)| exec('spr_poz36_17','edeklar',1,1) | exec('spr_poz36_17','edeklar',1,2) |
exec('spr_poz36_17','edeklar',2,0) | exec('spr_poz36_17','edeklar',2,1) | exec('spr_poz36_17','edeklar',2,2) |
exec('spr_poz36_17','edeklar',3,0) | exec('spr_poz36_17','edeklar',3,1) | exec('spr_poz36_17','edeklar',3,2)


\vatdek_dekl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Funkcja wypełnia nowe pole DEKL_POD.VAT_DEK po dodaniu rekordu tabeli VAT_DEK
::   WE: [_a] - [REFERENCE] (wymagany) ref wiersza tabeli VAT_DEK
::       [_b] - [INTEGER] (wymagany) rok deklaracji do określenia maski tabeli DEKL_POD
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('akt_147','edeklar') || return() ?};
{? var_pres('DEKL_REF',__par)<0 || return() ?};
{? var_pres('_a')<>type_of(null()) || return() ?};
{? var_pres('_b')<>type_of(0) || return() ?};
_vat_ref:=_a;
_rok:=_b;
{? _rok=0 || _rok:=__Rok ?};
DEKL_POD.cntx_psh();
DEKL_POD.use('pod_'+$_rok);
DEKL_POD.prefix();
{? __par.first()
|| {!
   |? {? DEKL_POD.seek(__par.DEKL_REF,)
      || DEKL_POD.VAT_DEK:=_vat_ref;
         DEKL_POD.put()
      ?};
      __par.next()
   !}
?};
DEKL_POD.cntx_pop()


\poz_pit11p_14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-11 (29) dla 14 wersji od 18.08.2022
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.prefix();
VAT_POZ.blank();
_dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
           VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
           VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
           {? _d=20 || VAT_POZ.OP+=pit[99] ?};
           {? _d=21 || VAT_POZ.OP+=pit[101] ?};
           {? _d=22 || VAT_POZ.OP+=pit[103] ?};
           {! _ind:=1.._g
           |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
              ($('VAT_POZ.KW'+$_ind))():=($('pit['+$(_c+_ind)+']'))();
              {? _d=1 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=2 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=3 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=4 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=51 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=4 & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? _d=4 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind)+']'))()
              ?};
              {? _d=9 & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? _poz=71 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? _d=9 & (_ind=3 | _ind=4)
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? (_d=10 | _d=11) & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? {? _d=10 || _poz=76 || _poz=79 ?} || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0 ?}
              |? (_d=10 | _d=11) & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? (_d=10 | _d=11) & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
              {? (_d=12 | _d=13 | _d=14) & _ind=2
              || _poz:=($('VAT_POZ.P'+$_ind))();
                 {? {? _d=12 || _poz=82 |? _d=13 || _poz=85 ||_poz=88 ?}
                 || ($('VAT_POZ.P'+$_ind))():=0; ($('VAT_POZ.KW'+$_ind))():=0
                 ?}
              |? (_d=12 | _d=13 | _d=14) & _ind=3
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              |? (_d=12 | _d=13 | _d=14) & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind-1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind-1)+']'))()
              ?};
::wiersz 12 to 15
              {? _d=15 & _ind=4
              || ($('VAT_POZ.P'+$(_ind)+':=(_a+_b)'))(_c,_ind+1);
                 ($('VAT_POZ.KW'+$(_ind)))():=($('pit['+$(_c+_ind+1)+']'))()
              ?};
              {? _d=19 || VAT_POZ.RODZ:='Wynagrodzenie z tytułu umowy o pomocy przy zbiorach' ?};
              {? _d=20 || VAT_POZ.RODZ:=pit[99] ?};
              {? _d=21 || VAT_POZ.RODZ:=pit[101] ?};
              {? _d=22 || VAT_POZ.RODZ:=pit[103] ?};
::            Zmiany 2022 Rodzaj (podstawa prawna) przychodu zwolnionego od podatku, wykazanego w poz. 114
::            wykazanego w poz 117 w wierszu 36 tabeli VAT_POZ wersja 14 edeklaracji
              {? _d=36 & exec('akt_147','edeklar')
              || VAT_POZ.ZP152:=__P_107.PKT_152;
                 VAT_POZ.ZP153:=__P_107.PKT_153;
                 VAT_POZ.ZP154:=__P_107.PKT_154
              ?}
           !};
           VAT_POZ.add()";

_dod_zap('E. 1.1','1. Należności ze stosunku: pracy, służbowego, spółdzielczego i z pracy nakładcz.',28,1,0,'A',4);
_dod_zap('E. 1.2','   W poz.34 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3',33,1,1,'A',2);
_dod_zap('E. 1.3','   W poz.32 należy wykazać dochód zwolniony od podatku 12)',31,1,2,'A',1);
_dod_zap('E. 2.1','2. Należności z tytułów wymienionych w wierszu 1, otrzymane do ukończenia 26 r.',35,2,0,'A',4);
_dod_zap('E. 2.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3',40,2,1,'A',2);
_dod_zap('E. 2.3','   W poz.39 należy wykazać dochód zwolniony od podatku 12)',38,2,2,'A',1);
_dod_zap('E. 3.1','3. Należności z tytułów wymienionych w wierszu 1, od ukończenia wieku emerytal.',42,3,0,'A',4);
_dod_zap('E. 3.2','   W poz.41 należy wykazać przychody, do których zastosowano art.22 ust.9 pkt 3',47,3,1,'A',2);
_dod_zap('E. 3.3','   W poz.46 należy wykazać dochód zwolniony od podatku 12)',45,3,2,'A',1);
_dod_zap('E. 4.1','4. Emerytury - renty zagraniczne',49,4,0,'A',4);
_dod_zap('E. 4.2','   W poz.52 należy wykazać dochód zwolniony od podatku 12)',51,4,1,'A',1);
_dod_zap('E. 5.1','5. Działalność wykonywana osobiście, o której mowa w art.13 pkt 2, 4-9',53,5,0,'A',4);
_dod_zap('E. 6.1','6. Należności z tytułu umowy zlecenia, o której mowa w art. 13 pkt 8 ustawy ...',57,6,0,'A',4);
_dod_zap('E. 7.1','7. Należności z tytułu wymienionego w wierszu 6, otrzymane do ukończenia 26 r.',61,7,0,'A',4);
_dod_zap('E. 8.1','8. Należności z tytułu wymienionego w wierszu 6, od ukończenia wieku emerytal.',65,8,0,'A',4);
_dod_zap('E. 9.1','9. Prawa autorskie i inne prawa, o których mowa w art.18 ustawy',69,9,0,'A',4);
_dod_zap('E. 9.2','   W poz.73 należy wykazać przych., do których zastosowano art.22 ust.9 pkt 1-3.',72,9,1,'A',2);
_dod_zap('E.10.1','10. Należności z tytułu praktyk absolwenckich lub staży uczniowskich, ...',74,10,0,'A',4);
_dod_zap('E.11.1','11. Należności z tytułu wymienionego w wier. 10, otrzymane przez podatn. do 26r.',77,11,0,'A',4);
_dod_zap('E.12.1','12. Zasiłki macierzyńskie, z wyjątkiem zasiłków wykazanych w wierszu 13 albo 14',80,12,0,'A',4);
_dod_zap('E.13.1','13. Zasiłki macierzyńskie otrzymane przez podatników do ukończenia 26. roku 17)',83,13,0,'A',4);
_dod_zap('E.14.1','14. Zasiłki macierzyńskie otrzymane przez podatników od ukończenia wieku emeryt',86,14,0,'A',4);
_dod_zap('E.15.1','15. Inne źródła',89,15,0,'A',4);
_dod_zap('E.15.2','   W poz.93 należy wykazać dochód zwolniony od podatku 12)',92,15,1,'A',1);

_dod_zap('E.16.1','Skł. na ub. społ., o których mowa w art. 26 ust. 1 pkt 2a ustawy, z wyj. poz. 96',94,16,0,'A',1);
_dod_zap('E.17.1','Skł. na ub. społ., podst. stanowi przychód wymieniony w wierszach 2,3,7,8,11',95,17,0,'A',1);
_dod_zap('E.18.1','Skł. na ub. społ., stanowi prz. zwol. na pod. art. 21 ust. 1 pkt 148, 152-154',96,18,0,'A',1);

_dod_zap('F. 1.1','Wynagrodzenie z tytułu umowy o pomocy przy zbiorach',97,19,0,'A',1);
_dod_zap('F. 2.1','99. ',99,20,0,'A',1);
_dod_zap('F. 3.1','101. ',101,21,0,'A',1);
_dod_zap('F. 4.1','103. ',103,22,0,'A',1);
_dod_zap('F. 5.1','Razem. Suma kwot z poz.: 98, 100, 102 i 104.',104,23,0,'S',1);


_dod_zap('G. 1.1','Przychody z tytułu stypendium, o którym mowa w art. 21 ust. 1 pkt 40b ustawy',105,24,0,'A',1);
_dod_zap('G. 2.1','Przychody otrzymywane z zagranicy, o których mowa w art. 21 ust. 1 pkt 74 ustawy',106,25,0,'A',1);
_dod_zap('G. 3.1','Przychody pochodzące ze środków bezzwrotnej pomocy zagranicznej, art. 21',107,26,0,'A',1);
_dod_zap('G. 4.1','Przychody ze stosunku pracy i stosunków pokrewnych z umów zlecenia ...',108,27,0,'S',1);
_dod_zap('G. 4.1.1','  W tym przychody ze stosunku pracy i stosunków pokrewnych',109,28,0,'A',1);
_dod_zap('G. 4.1.2','  W tym przychody z umów zlecenia',110,29,0,'A',1);
_dod_zap('G. 4.1.3','  W tym przychody z tytułu praktyk absolwenckich lub staży uczniowskich',111,30,0,'A',1);
_dod_zap('G. 4.1.4','  W tym przychody z zasiłków macierzyńskich',112,31,0,'A',1);
_dod_zap('G. 5.1','Przychody ze stosunku pracy i stosunków pokrewnych z umów zlecenia pkt 152-154',113,32,0,'S',1);
_dod_zap('G. 5.1.1','  W tym przychody ze stosunku pracy i stosunków pokrewnych',114,33,0,'A',1);
_dod_zap('G. 5.1.2','  W tym przychody z umów zlecenia',115,34,0,'A',1);
_dod_zap('G. 5.1.3','  W tym przychody z zasiłków macierzyńskich',116,35,0,'A',1);
_dod_zap('G. 6.1','Rodzaj (podstawa prawna) przychodu zwolnionego od podatku, wykazanego w poz. 114',117,36,0,'A',1);
_dod_zap('G. 7.1','Składki na ubezpieczenie zdrowotne pobrane przez płatnika 22)',121,37,0,'A',1);
_dod_zap('G. 8.1','Składki członkowskie na rzecz związków zawodowych pobrane przez płatnika',122,38,0,'A',1)


\edycja_PIT11_14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Popraw przed dla 14 wersja, gdy edycja możliwa ustawiamy edycja pól VAT_POZ.KW1-KW4 oraz VAT_POZ.RODZ
::----------------------------------------------------------------------------------------------------------------------
:: Ustawienie edycji pola VAT_POZ.RODZ
{? (VAT_POZ.NR>=1 & VAT_POZ.NR<=18) | (VAT_POZ.NR>=24 & VAT_POZ.NR<=38)
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"0")
|| VAT_POZ.fld_fml('RODZ','BEFORE_EDIT',"1")
?};
:: Ustawienie formatu pola VAT_POZ.KW4 tylko pełne złote
VAT_POZ.fld_fml('KW4','EDIT_FORMAT',"'in_prec=0'");
VAT_POZ.fld_fml('KW4','DISPLAY_FORMAT',"'out_prec=0'");
:: Ustawienie edycji pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
VAT_POZ.fld_fml('KW1','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"*");
VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"*");
:: Ustawienie odpowiednich blokad edycji dla wybranego wiersza pól VAT_POZ.KW1, VAT_POZ.KW2, VAT_POZ.KW3, VAT_POZ.KW4
{? VAT_POZ.NR=1 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=1 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=2 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=3 & VAT_POZ.NRK=2
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=4 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=4 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=9 & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=9 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? (VAT_POZ.NR=10 | VAT_POZ.NR=11) & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? (VAT_POZ.NR=12 | VAT_POZ.NR=13 | VAT_POZ.NR=14) & VAT_POZ.NRK=0
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0")
|? VAT_POZ.NR=15 & VAT_POZ.NRK=1
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR>=16 & VAT_POZ.NR<=35
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR=36
|| VAT_POZ.fld_fml('KW1','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
|? VAT_POZ.NR>=37
|| VAT_POZ.fld_fml('KW2','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW3','BEFORE_EDIT',"0");
   VAT_POZ.fld_fml('KW4','BEFORE_EDIT',"0")
?};
:: Dla aktualizacja 12.51_147 ustawiamy edycję pól VAT_POZ.ZP152..ZP154
:: możliwa tylko dla 36 wiersza tabeli VAT_POZ
_akt_147:=exec('akt_147','edeklar');
{? _akt_147
|| {? VAT_POZ.NR=36
   || {! _ind:=152..154
      |! VAT_POZ.fld_fml('ZP'+$_ind,'BEFORE_EDIT',"{? __Rok>=2022 || 1 || 0 ?}")
      !}
   || {! _ind:=152..154
      |! VAT_POZ.fld_fml('ZP'+$_ind,'BEFORE_EDIT',"0")
      !}
   ?}
?}


\popraw_pit11po
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Popraw po dla okienek wertowania tabeli VAT_POZ dla PIT-11 funkcja wyliczająca
::   WE: [_a] - [INTEGER] (wymagany)
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0) || return() ?};
_vern:=_a;
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref(),_[5],_[6])
       || {? _[7]=0 || {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+':=0'))() !} ?};
          {! _ind:=1..4 |! ($('VAT_POZ.KW'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";
{? _vern=14
|| _czyblank:=0;
:: sumowania zasiłków wiersze 19-22 do wiersza 23
   VAT_POZ.prefix(VAT_DEK.ref(),19);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,23,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),20);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,23,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),21);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,23,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),22);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,23,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
:: sumowania podpozycji ZP do pozycji 109 wiersz 27
   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),28);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,27,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),29);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,27,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),30);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,27,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),31);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,27,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
:: sumowania podpozycji ZP do pozycji 114 wiersz 32
   _czyblank:=0;
   VAT_POZ.prefix(VAT_DEK.ref(),33);
   {? VAT_POZ.first()
   || {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,32,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),34);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,32,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?};
   VAT_POZ.prefix(VAT_DEK.ref(),35);
   {? VAT_POZ.first()
   || _czyblank+=1;
      {!
      |? _suma(VAT_POZ.KW1,VAT_POZ.KW2,VAT_POZ.KW3,VAT_POZ.KW4,32,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?}
?};
VAT_POZ.cntx_pop()


\pit8c_11_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8C (11) dla wersji 11 dla przychodów od 2022
::----------------------------------------------------------------------------------------------------------------------
::Ze względu na brak zmian ilości wierszy korzystamy z funkcji dla 10 wersji
exec('pit8c_10_poz','edeklar')


\pit11_podpis
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MicKoc [22.26]
:: OPIS: Uruchomienie podpisu
::----------------------------------------------------------------------------------------------------------------------
_rok:={? var_pres('__Rok')>0 || __Rok || 0 ?};
_pitTyp:=
   {? P_FILTER.F_ZATR().KOD='P'
   || 'PIT11P'
   |? P_FILTER.F_ZATR().KOD='Z'
   || 'PIT11Z'
   || _tx:='Grupowe podpisywanie załączników deklaracji PIT-11 dostępne są tylko dla pracowników i zleceniobiorców'@;
      FUN.emsg(_tx);
      return(~~)
   ?};

BPMN.SYM_DOM:='PPL';
exec('pit11_grup_pe','edeklar',_pitTyp,_rok)


\pit11_grup_pe
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MicKoc [22.26]
:: OPIS: Okno z deklaracjami do podpisu
::   WE: _a  [STRING]  - oznaczenie rodzaju deklaracji np. 'PIT11P'
::       [_b] [INTEGER] - rok deklaracji podatkowej
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_pitTyp:={? var_pres('_a')=type_of('') || _a || return(~~) ?};
   _rok:={? var_pres('_b')=type_of(0)  || _b || 0          ?};
{? exec('inipit11_select','edeklar',_pitTyp,_rok)
|| _ws:=exec('okno_podpis','edeklar');
   USERS.cntx_psh();
   OGRANICZ.blank(1);
   SKID.TYP_ZAP:=SKID.DEKL_NAZ;
   PIT_GRUP.clear();
   PIT_GRUP.index('RODZAJP');
   EDIT_VAR.cntx_psh();
   EDIT_VAR.PIT_RODZ:=P_FILTER.F_ZATR().KOD;
   {? EDIT_VAR.PIT_RODZ='P'
   || _tytul:='Pracownicy'; EDIT_VAR.OBSZAR:='Pracownicy etatowi'
   || _tytul:='Zleceniobiorcy'; EDIT_VAR.OBSZAR:='Zleceniobiorcy'
   ?};
   PIT_GRUP.prefix(EDIT_VAR.PIT_RODZ,_rok);
   PIT_GRUP.win_sel(_ws);
   PIT_GRUP.hdr_sel();
   PIT_GRUP.hdr_sel(': PIT-11 %1 z roku %2'@[_tytul,$_rok]);
   PIT_GRUP.select(,1,10);
   EDIT_VAR.cntx_pop();
   USERS.cntx_pop()
?}


\okno_podpis
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MicKoc [22.26]
:: OPIS: Okno podpisu
::   WY: akronim okna
::----------------------------------------------------------------------------------------------------------------------
_ws:=PIT_GRUP.mk_sel('Deklaracje PIT-11 tworzone poprzez grupę'@,'P',0,'#pit_grup167025',,,,,'U','T');
PIT_GRUP.win_fld(_ws,,'ROK',,,5,0,,'Rok'@,,'Rok podatkowy'@);
PIT_GRUP.win_fld(_ws,,'NR','NR',,11,0,,'Nr wersji'@,,'Nr wersji deklaracji'@);
PIT_GRUP.win_fld(_ws,,'DATA_UTW',,,16,0,,'Data utworzenia'@,,'Data utworzenia'@);
PIT_GRUP.win_fld(_ws,,'USER','DANE',,30,0,,'Użytkownik'@,,'Użytkownik, który utworzył zapis'@);
PIT_GRUP.win_fld(_ws,,'OPIS',,,50,0,,'Opis'@,,'Opis'@);
_fb:=""; _fa:="exec('podpis','gen_zal')"; _fbg:=""; _fag:="";
PIT_GRUP.win_act(_ws,0,'Formuła','&Podpis'@@,,'Podpis elektroniczny',_fb,_fa,1,,_fbg,_fag);
PIT_GRUP.win_btn(_ws,'text=%1'['&Podpis'@],'menu:P');
_fb:=""; _fa:="exec('pitpozyc','edeklar')"; _fbg:=""; _fag:="";
PIT_GRUP.win_act(_ws,0,'Formuła','D&eklaracje'@@,,,_fb,_fa,,,_fbg,_fag);
PIT_GRUP.win_btn(_ws,'text=%1'['D&eklaracje'@],'menu:E');
PIT_GRUP.win_act(_ws,0,'Szukaj');
PIT_GRUP.win_act(_ws,0,'Kolejność');
_ws


\poz_pit4r_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-4R (13) dla 13 wersji dla przychodów od 2023
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 13 ?};
exec('obl_pit4r_13','pit1',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first()
|| VAT_POZ.prefix();
   __TAB.prefix();
   _dod_zap:="VAT_POZ.blank(); VAT_POZ.VAT_DEK:=VAT_DEK.ref();
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))();
                    {? _d=8
                    || _poz:=($('VAT_POZ.P'+$_ind))();
                       {? _poz=110 | _poz=111 || ($('VAT_POZ.P'+$_ind))():=0 ?}
                    ?}
                 !}
              ?}; VAT_POZ.add()";

   _dod_zap('C. 1.1','Liczba podatników',9,0,0,'A');
   _dod_zap('C. 1.2','Liczba podatników',21,0,6,'A');
   _dod_zap('C. 1.3','Należne zaliczki',15,1,0,'A');
   _dod_zap('C. 1.4','Należne zaliczki',27,1,6,'A');

   _dod_zap('C. 2.1','2. Zaliczki pobrane przez płatników, o których mowa',33,2,0,'R');
   _dod_zap('C. 2.2','w art.33-35 ustawy, od dochodów wymienionych w tych przepisach',39,2,6,'R');

   _dod_zap('C. 3.1','3. Zaliczki na podatek pobrane od świadczeń z tytułu działalności',45,3,0,'A');
   _dod_zap('C. 3.2','określonej w art.13 pkt 2 i 4-9 oraz art.18 ustawy',51,3,6,'A');

   _dod_zap('C. 4.1','4. Zaliczki na podatek pobrane od innych należności,',57,4,0,'R');
   _dod_zap('C. 4.2','w tym wynikających z umowy aktywizacyjnej',63,4,6,'R');

   _dod_zap('C. 5.1','5. Suma pobranych zaliczek wykazanych w wierszach 1-4',69,5,0,'S');
   _dod_zap('C. 5.2','',75,5,6,'S');

   _dod_zap('C. 6.1','6. Zaliczki na podatek, których pobór został ograniczony',81,6,0,'R');
   _dod_zap('C. 6.2','na podstawie art.32 ust.2 ustawy',87,6,6,'R');

   _dod_zap('C. 7.1','7. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',93,7,0,'R');
   _dod_zap('C. 7.2','zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',99,7,6,'R');

   _dod_zap('C. 8.1','8. Dodatkowo pobrany podatek wynikający z rozliczenia za rok ubiegły',105,8,0,'R');

   _dod_zap('C. 9.1','9. Pobrany podatek, przekazany na PFRON',109,9,0,'R');
   _dod_zap('C. 9.2','oraz zak. fun. rehab. osób niepełnos.',115,9,6,'R');

   _dod_zap('C.10.1','10. Pobrany podatek do przekazania do urzędu skarbowego za poszczególne',121,10,0,'S');
   _dod_zap('C.10.2','miesiące roku podatkowego 9)',127,10,6,'S');

   _dod_zap('C.11.1','11. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',133,11,0,'R');
   _dod_zap('C.11.2','za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',139,11,6,'R');

   _dod_zap('C.12.1','12. Podatek podlegający przekazaniu do urzędu skarbowego za poszczególne miesiące',145,12,0,'S');
   _dod_zap('C.12.2','',151,12,6,'S');

::Zmiany 2023
::Nowy blok D
::POMNIEJSZENIE PODLEGAJĄCYCH PRZEKAZANIU NA RACHUNEK URZĘDU SKARBOWEGO ZALICZEK ZGODNIE Z ART. 26EB USTAWY
::LUB ART. 18DB USTAWY O PODATKU DOCHODOWYM OD OSÓB PRAWNYCH9)
::do określenia nowe w VAT_DEK
  _opD:='D.Pomniejszenie podlegających przekazaniu na rachunek urzędu skarbowego zaliczek';
  _dod_zap('D.1.1',_opD,158,13,0,'R');
  _opD:='na podatek z art. 26eb lub art. 18db ust. o pod. doch. od osób prawnych';
  _dod_zap('D.1.2',_opD,164,13,6,'R');
::E. PODATEK DO WPŁATY DO URZĘDU SKARBOWEGO
   _dod_zap('E.1.1','E. Podatek do wpłaty do urzędu skarbowego za poszczególne miesiące',170,14,0,'S');
   _dod_zap('E.1.2','',176,14,6,'S')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit4r13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 4R wersja 13
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,1);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,2);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,3);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,4);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,5,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,5);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,7);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,8);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,6);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,9);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,10,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,10);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,12,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,11);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6 |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?} !};
      VAT_POZ.put();
      _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,12,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,12);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,14,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,13);
{? VAT_POZ.first()
|| _czyblank+=1;
   {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,14,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,14);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


\czy_pomn_cit
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Funkcja ustala czy podatnik podatku fizycznego dokonał w PIT-4R, PIT-8AR pomniejszenia podatku CIT
::   WE: _a - string typ deklaracji 'PIT4R', 'PIT8AR'
::   WY: '1'/'2'
::----------------------------------------------------------------------------------------------------------------------
_wynik:='2';
{? var_pres('_a')<>type_of('') || return(_wynik) ?};
{? _a='PIT4R'
|| {? exec('spr_poz36_17','edeklar',13,0)>0 | exec('spr_poz36_17','edeklar',13,6)>0
   || _wynik:='1'
   ?}
|? _a='PIT8AR'
|| {? exec('spr_poz36_17','edeklar',39,0)>0 | exec('spr_poz36_17','edeklar',39,6)>0
   || _wynik:='1'
   ?}
?};
_wynik


\poz_pit8ar_14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dodaje pozycje dla deklaracji podatkowej PIT-8AR (14) dla 13 wersji
::   WE: [_a] - _a - INTEGER (wymagany) numer wersji e-deklaracji: 14
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 14 ?};
exec('obl_pit8ar_14','pit1',_a);
{? var_pres('__TAB')<100 || return(0) ?};
{? __TAB.first
|| VAT_POZ.prefix; __TAB.prefix;
   _dod_zap:="VAT_POZ.blank; VAT_POZ.VAT_DEK:=VAT_DEK.ref;
              VAT_POZ.LP:=_a; VAT_POZ.OP:=_b; VAT_POZ.NR:=_d;
              VAT_POZ.NRK:=_e; VAT_POZ.TYP:=_f;
              {? __TAB.find_key(VAT_POZ.NR,VAT_POZ.NRK)
              || {! _ind:=1..6
                 |! ($('VAT_POZ.P'+$_ind+':=(_a+_b)'))(_c,_ind);
                    ($('VAT_POZ.K'+$_ind))():=($('__TAB.K'+$_ind))()
                 !}
              ?}; VAT_POZ.add";

   _dod_zap('C. 1.1','1. Należności osób fizycznych, które nie mają na terytorium',9,1,0,'A');
   _dod_zap('C. 1.2','   Rzeczypospolitej Polskiej miejsca zamieszkania, wymienione w art. 29 ustawy',15,1,6,'A');
   _dod_zap('C. 2.1','2. Wygrane w konkursach, grach i zakładach wzajemnych oraz nagrody związane',21,2,0,'R');
   _dod_zap('C. 2.2','   ze sprzedażą premiową (art. 30 ust. 1 pkt 2 ustawy)',27,2,6,'R');
   _dod_zap('C. 3.1','3. Świadczenia otrzymane przez emerytów, rencistów będących byłymi lub osoby',33,3,0,'A');
   _dod_zap('C. 3.2','   pobierające nauczycielskie świa. komp. pracownikami (art.30 ust.1 pkt 4 ust.)',39,3,6,'A');
   _dod_zap('C. 4.1','4. Świadczenia pieniężne otrzymane przez funkcjonariuszy służb mundurowych',45,4,0,'R');
   _dod_zap('C. 4.2','   oraz żołnierzy, wymienione w art. 30 ust. 1 pkt 4a ustawy',51,4,6,'R');
   _dod_zap('C. 5.1','5. Świadczenia otrzymane od banków, SKOK-ów lub instytucji finansowych,',57,5,0,'R');
   _dod_zap('C. 5.2','   w związku z promocjami (art. 30 ust. 1 pkt 4b ustawy)',63,5,6,'R');
   _dod_zap('C. 6.1','6. Należności z tytułu, o którym mowa w art. 13 pkt 2 i 5-9 ustawy z umów',69,6,0,'R');
   _dod_zap('C. 6.2','   zawartych z osobą niebędącą pracownikiem płatnika (art. 30 ust. 1 pkt 5a..)',75,6,6,'R');
   _dod_zap('C. 7.1','7. Jednorazowe odszkodowania za skrócenie okresu wypowiedzenia,wypłacone żołnie-',81,7,0,'R');
   _dod_zap('C. 7.2','   rzom zwalnianym z zawodowej służby wojskowej (art. 30 ust. 1 pkt 13 ustawy)',87,7,6,'R');
   _dod_zap('C. 8.1','8. Wypłaty z indywidualnego konta zabezpieczenia emerytalnego',93,8,0,'R');
   _dod_zap('C. 8.2','   (art. 30 ust.1 pkt 14 ustawy)',99,8,6,'R');
   _dod_zap('C. 9.1','9. Świadczenia z tytułu gromadzenia oszczędności na subkoncie ogólnoeuropejsk.',105,9,0,'R');
   _dod_zap('C. 9.2','   indywidualnego produktu emerytalnego ... (art. 30 ust. 1 pkt 14a ustawy)',111,9,6,'R');
   _dod_zap('C.10.1','10. Odszkodowania przyznane na podstawie przepisów o zakazie konkurencji',117,10,0,'R');
   _dod_zap('C.10.2','    (art. 30 ust. 1 pkt 15 ustawy)',123,10,6,'R');
   _dod_zap('C.11.1','11. Odprawy lub odszkodowania z tytułu skrócenia okresu wypowiedzenia umowy',129,11,0,'R');
   _dod_zap('C.11.2','    o pracę lub umowy o świadczenie usług zarządzania (art. 30 ust. 1 pkt 16..)',135,11,6,'R');
   _dod_zap('C.12.1','12. Przychody otrzymane z fundacji rodzinnej przez osobę będącą w stosunku',141,12,0,'R');
   _dod_zap('C.12.2','    do fundatora osobą zaliczoną do I lub II grupy podatkowej w rozumieniu',147,12,6,'R');
   _dod_zap('C.13.1','13. Przychody otrzymane z fundacji rodzinnej przez beneficjenta lub fundatora',153,13,0,'R');
   _dod_zap('C.13.2','    w innych przypadkach niż wymienione w wierszu 12 art. 30 ust. 1 pkt 17 lit.',159,13,6,'R');
   _dod_zap('C.14.1','14. Odsetki od pożyczek (z wyjątkiem gdy udzielanie pożyczek jest przedmiotem',165,14,0,'R');
   _dod_zap('C.14.2','    działalności gospodarczej), (art. 30a ust. 1 pkt 1 ustawy)',171,14,6,'R');
   _dod_zap('C.15.1','15. Odsetki i dyskonto od papierów wartościowych',177,15,0,'R');
   _dod_zap('C.15.2','    (art. 30a ust. 1 pkt 2 ustawy)',183,15,6,'R');
   _dod_zap('C.16.1','16. Odsetki lub inne przychody od środków pieniężnych zgromadzonych na rachunku',189,16,0,'R');
   _dod_zap('C.16.2','   podatnika lub w innych formach oszczędzania (art. 30a ust. 1 pkt 3 ustawy)',195,16,6,'R');
   _dod_zap('C.17.1','17. Dywidendy i inne przychody z tytułu udziału w zyskach osób prawnych',201,17,0,'R');
   _dod_zap('C.17.2','    (art. 30a ust. 1 pkt 4 ustawy)',207,17,6,'R');
   _dod_zap('C.18.1','18. Dochód z tytułu udziału w funduszach kapitałowych',213,18,0,'R');
   _dod_zap('C.18.2','    (art. 30a ust. 1 pkt 5 ustawy)',219,18,6,'R');
   _dod_zap('C.19.1','19. Dochód z tytułu umów ubezpieczenia, o którym mowa w art. 24 ust. 15a',225,19,0,'R');
   _dod_zap('C.19.2','    (art. 30a ust. 1 pkt 5a ustawy)',231,19,6,'R');
   _dod_zap('C.20.1','20. Kwoty wypłacane po śmierci członka otwartego funduszu emerytalnego',237,20,0,'R');
   _dod_zap('C.20.2','    (art. 30a ust. 1 pkt 6 ustawy)',243,20,6,'R');
   _dod_zap('C.21.1','21. Dochód członka pracowniczego funduszu emerytalnego z tytułu przeniesienia',249,21,0,'R');
   _dod_zap('C.21.2','    akcji (art. 30a ust. 1 pkt 7 ustawy)',255,21,6,'R');
   _dod_zap('C.22.1','22. Przychody z tytułu zbycia prawa poboru akcji',261,22,0,'R');
   _dod_zap('C.22.2','    (art. 30a ust. 1 pkt 8 ustawy)',267,22,6,'R');
   _dod_zap('C.23.1','23. Kwoty jednorazowo wypłacane przez otwarty fundusz emerytalny, w związku',273,23,0,'R');
   _dod_zap('C.23.2','    ze śmiercią współmałżonka (art. 30a ust. 1 pkt 9 ustawy)',279,23,6,'R');
   _dod_zap('C.24.1','24. Kwoty jednorazowo wypłacane przez ZUS, w związku ze śmiercią współmałżonka',285,24,0,'R');
   _dod_zap('C.24.2','    (art. 30a ust. 1 pkt 9a ustawy',291,24,6,'R');
   _dod_zap('C.25.1','25. Dochód oszczędzającego na indywidualnym koncie emerytalnym z tytułu zwrotu',297,25,0,'R');
   _dod_zap('C.25.2','    lub częściowego zwrotu zgromadzonych środków (art. 30a ust. 1 pkt 10 ustawy)',303,25,6,'R');
   _dod_zap('C.26.1','26. Dochód oszczędzającego na subkoncie ogólnoeuropejskiego indywidualnego',309,26,0,'R');
   _dod_zap('C.26.2','    produktu emerytalnego prowadzonym zgodnie z przepisami art. 30a ust. 1 pkt',315,26,6,'R');
   _dod_zap('C.27.1','27. Dochód uczestnika pracowniczego programu emerytalnego z tytułu zwrotu',321,27,0,'R');
   _dod_zap('C.27.2','    zgromadzonych środków (art. 30a ust. 1 pkt 11 ustawy)',327,27,6,'R');
   _dod_zap('C.28.1','28. Dochód uczestnika pracowniczego planu kapitałowego z tytułu wypłaty środków,',333,28,0,'R');
   _dod_zap('C.28.2','    o których mowa w art. 99 ust. 1 pkt 2 ustawy o PPK (art. 30a ust. 1 pkt 11b)',339,28,6,'R');
   _dod_zap('C.29.1','29. Dochód małżonka lub byłego małżonka uczestnika pracowniczego planu',345,29,0,'R');
   _dod_zap('C.29.2','    kapitałowego z tytułu zwrotu środków (art. 30a ust. 1 pkt 11c ustawy)',351,29,6,'R');
   _dod_zap('C.30.1','30. Dochód uczestnika pracowniczego planu kapitałowego z tytułu zwrotu środków',357,30,0,'R');
   _dod_zap('C.30.2','    (art. 30a ust. 1 pkt 11d ustawy)',363,30,6,'R');
   _dod_zap('C.31.1','31. Dochód małżonka lub byłego małżonka z tytułu wypłaty 75% środków, które',369,31,0,'R');
   _dod_zap('C.31.2','    zostały mu przekazane w formie wypłaty transferowej art. 30a ust. 1 pkt 11e',375,31,6,'R');
   _dod_zap('C.32.1','32. Dochód uczestnika pracowniczego planu kapitałowego z tytułu wypłaty 75%',381,32,0,'R');
   _dod_zap('C.32.2','    środków zgromadzonych na rachunku w PPK (art. 30a ust. 1 pkt 11f ustawy)',387,32,6,'R');
   _dod_zap('C.33.1','33. Kwoty wypłaty gwarantowanej (art. 30a ust. 1 pkt 12 ustawy)',393,33,0,'R');
   _dod_zap('C.33.2','',399,33,6,'R');
   _dod_zap('C.34.1','34. Dochód z tytułu otrzymania składników majątku w związku z likwidacją spółki',405,34,0,'R');
   _dod_zap('C.34.2','    niebędącej osobą prawną ... (art. 30a ust. 1 pkt 13 ustawy)',411,34,6,'R');
   _dod_zap('C.35.1','35. Inne należności niewymienione w wierszach 1-34',417,35,0,'A');
   _dod_zap('C.35.2','',423,35,6,'A');
   _dod_zap('C.36.1','36. Suma pobranego zryczałtowanego podatku do przekazania do urzędu skarbowego',429,36,0,'S');
   _dod_zap('C.36.2','    za poszczególne miesiące z wierszy 1-35',435,36,6,'S');
   _dod_zap('C.37.1','37. Wynagrodzenie płatnika za poszczególne miesiące',441,37,0,'R');
   _dod_zap('C.37.2','    - zgodnie z art. 28 Ordynacji podatkowej',447,37,6,'R');
   _dod_zap('C.38.1','38. Zryczałtowany podatek podlegający przekazaniu do urzędu skarbowego',453,38,0,'S');
   _dod_zap('C.38.2','    z wiersza 36 należy odpowiednio odjąć kwoty z wiersza 37.',459,38,6,'S');
::D.Pomniejszenie podlegających przekazaniu na rachunek urzędu skarbowego zaliczek
::na podatek z art. 26eb lub art. 18db ust. o pod. doch. od osób prawnych
::ponieważ decydują czy wypełniać wiersz 14 - E. PODATEK DO WPŁATY DO URZĘDU SKARBOWEGO
  _opD:='D.Pomniejszenie podlegających przekazaniu na rachunek urzędu skarbowego zaliczek';
  _dod_zap('D.1.1',_opD,466,39,0,'R');
  _opD:='  na podatek z art. 26eb lub art. 18db ust. o pod. doch. od osób prawnych';
  _dod_zap('D.1.2',_opD,472,39,6,'R');
::E. PODATEK DO WPŁATY DO URZĘDU SKARBOWEGO
   _dod_zap('E.1.1','E. Podatek do wpłaty do urzędu skarbowego za poszczególne miesiące',478,40,0,'S');
   _dod_zap('E.1.2','   Od kwot za poszczególne miesiące z wiersza 36 należy odjąć kwoty z wiersza 37',484,40,6,'S');
::F. ODSETKI, O KTÓRYCH MOWA W ART. 8 UST. 2 PKT 2 USTAWY O POMOCY PAŃSTWA W OSZCZĘDZANIU NA CELE MIESZKANIOWE9)
   _dod_zap('F.1.1','F. Odsetki od zaległości podatkowych pomniejszające środki przenoszone z konta',490,41,0,'R');
   _dod_zap('F.1.2','   mieszkaniowego lub lokaty mieszkaniowej na wskazany rachunek',496,41,6,'R')
?};
{? var_pres('__TAB')>100 || obj_del(__TAB); &__TAB ?}


\oblpit8ar14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula obliczajaca wartosci pol w tabeli VAT_POZ po Popraw dla deklaracji PIT 8AR wersja 14
::----------------------------------------------------------------------------------------------------------------------
VAT_POZ.cntx_psh();
VAT_POZ.index('NR_NRK');
_suma:="VAT_POZ.cntx_psh(); VAT_POZ.prefix();
       {? VAT_POZ.find_key(VAT_DEK.ref,_[7],_[8])
       || {? _[9]=0 || {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+':=0'))() !} ?};
          {! _ind:=1..6 |! ($('VAT_POZ.K'+$_ind+'+=_a'))(_[_ind]) !}; VAT_POZ.put()
       ?}; VAT_POZ.cntx_pop()";

_czyblank:=0;
{! _ix:=1..35
|! VAT_POZ.prefix(VAT_DEK.ref,_ix);
   {? VAT_POZ.first()
   || {!
      |? {? _ix>1 || _czyblank+=1 ?};
         {! _ind:=1..6
         |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
         !};
         VAT_POZ.put();
         _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,36,VAT_POZ.NRK,_czyblank);
         VAT_POZ.next()
      !}
   ?}
!};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,36);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,38,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,37);
{? VAT_POZ.first()
|| {!
   |? _czyblank+=1;
      {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,38,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
_czyblank:=0;
VAT_POZ.prefix(VAT_DEK.ref,38);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      _suma(VAT_POZ.K1,VAT_POZ.K2,VAT_POZ.K3,VAT_POZ.K4,VAT_POZ.K5,VAT_POZ.K6,40,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,39);
{? VAT_POZ.first()
|| {!
   |? _czyblank+=1;
      {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      _suma(-VAT_POZ.K1,-VAT_POZ.K2,-VAT_POZ.K3,-VAT_POZ.K4,-VAT_POZ.K5,-VAT_POZ.K6,40,VAT_POZ.NRK,_czyblank);
      VAT_POZ.next()
   !}
?};
VAT_POZ.prefix(VAT_DEK.ref,40);
{? VAT_POZ.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('VAT_POZ.K'+$_ind+'<0'))() || ($('VAT_POZ.K'+$_ind+':=0'))() ?}
      !};
      VAT_POZ.put();
      VAT_POZ.next()
   !}
?};
VAT_POZ.cntx_pop()


:Sign Version 2.0 jowisz:1045 2024/01/30 07:09:40 09ddfd4577e7b817830340e82f61ae8a6d664f1f1b2d19adc0e91575bd4aff10e9fc0cf663dd3bfbfbb0a18156b0d7c4e6eabb900b973610be34550fc43cbcff542f68f469c94b638363612c97bc04583bf866eb8f9f93955878e74f5e7cc511fb1e8e7e736221101c14acdf07e32ad697739365935a3b102e7786958f944672
