:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: etypyatt.fml
:: Utworzony: 09.06.2022
:: Autor: RWR
::======================================================================================================================
:: Zawartosc: Formuły do obslugi załączników wniosków.
::======================================================================================================================


\add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [22.26]
:: OPIS: Formuła definiująca typ załącznik dla wniosku.
::   WE:  _a  [REFERENCE]        - Typ wniosku.
::        _b  [STRING/REFERENCE] - Typ załącznika.
::       [_c] [STRING]           - Lista kodów typów podpisu.
::   WY: Wynik operacji: 1/0 lub ~~ w przypadku błędnych parametrów wywołania.
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')=type_of(null()) & _a<>null() & ref_tab(_a)=ETYPY
|| _etypy:=_a
|| return()
?};
{? var_pres('_b')=type_of('')
|| {? (_slo_naz:=exec('slo_naz','ext_slo','ZAL',_b,1))=null()
   || return()
   ?}
|? var_pres('_b')=type_of(null()) & _b<>null() & ref_tab(_b)=SLO_NAZ
|| _slo_naz:=_b
|| return()
?};
_typesign:={? var_pres('_c')=type_of('') || _c || '' ?};

_ret:=0;
ETYPYATT.cntx_psh();
ETYPYATT.index('SLO_NAZ');
ETYPYATT.prefix(_etypy,_slo_naz);
{? ETYPYATT.first()
|| {? _typesign<>ETYPYATT.memo_txt(,1,'TYPESIGN')
   || ETYPYATT.memo_set(_typesign,'TYPESIGN');
      _ret:=ETYPYATT.memo_put(,'TYPESIGN')
   || _ret:=1
   ?}
|| ETYPYATT.blank();
   ETYPYATT.ETYPY:=_etypy;
   ETYPYATT.SLO_NAZ:=_slo_naz;
   ETYPYATT.memo_set(_typesign,'TYPESIGN');
   _ret:=ETYPYATT.add() & ETYPYATT.memo_put(,'TYPESIGN')
?};
ETYPYATT.cntx_pop();
_ret

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:17 e4e246825f55152e436e074d51115800ad84c92f4fd656a976a7b97453a42071fa8ffc0eb0b881310d81ca49104c7cc0b2415979ac901473d716e864a043506766e2409f1aa506952373ee2ba1ebdafa2e33ff5a2660e3c70ae42ea1a6ff7dea0fb5dcc7a8175412c3dd88c6ec2cb5adf0b42afeb4882eb856c0c54647ac2c9b
