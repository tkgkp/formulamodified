:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: ppk_xel.fml [12.51]
:: Utworzony: 2019/05/08
:: Autor: jaws
:: Systemy: PPK
::======================================================================================================================
:: Zawartość: Formuły odpowiedzialne za obsługę elementów raportów PPK.
::======================================================================================================================


\_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.51]
:: OPIS: Wyzwalacz "po popraw" tabeli PPK_XEL.
::   WE: _a INTEGER - zgodny ze specyfikacją narzędzi
::   WY: zgodny ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
:: podstawowy warunek dalszego działania
{? ~_a | do_state()<>1 || return() ?};

:: obsługa anomalii
{? PPK_XEL.OPIS<>bfld('OPIS')
|| PPK_XRA.cntx_psh();
   PPK_XRA.index('FK_1');
   PPK_XRA.prefix(PPK_XEL.ref());
   _loop:=PPK_XRA.first();
   {!
   |? _loop
   |! PPK_XRA.OPIS:=PPK_XEL.OPIS;
      PPK_XRA.put();
      _loop:=PPK_XRA.next()
   !};
   PPK_XRA.cntx_pop()
?};
~~


\szukaj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.51]
:: OPIS: Wyszukuje informacje o elemencie.
::   WE: _a STRING - symbol elementu
::   WY: wskazanie istniejącego zapisu lub null
::----------------------------------------------------------------------------------------------------------------------
:: mapa argumentów
_symbol:=_a;

_ref:=null;

PPK_XEL.index('SYMBOL');
PPK_XEL.prefix();
{? PPK_XEL.find_key(_symbol,)
|| _ref:=PPK_XEL.ref()
?};

_ref


\dodaj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.51]
:: OPIS: Dodaje informacje o elemencie.
::   WE: _a STRING - symbol elementu
::       _b STRING - opis elementu
::       _c [STRING] - treść komentarza
::   WY: wskazanie dodanego/istniejącego zapisu lub null
::----------------------------------------------------------------------------------------------------------------------
:: mapa argumentów
_symbol:=_a;
_opis:=_b;
_uwagi:={? var_pres('_c')=type_of('') || _c || '' ?};

:: sprawdź, czy element już istnieje
_ref:=exec('szukaj','ppk_xel',_symbol);
{? _ref<>null
:: znaleziono
|| return(_ref)
?};

PPK_XEL.blank();
PPK_XEL.SYMBOL:=_symbol;
PPK_XEL.OPIS:=_opis;
{? PPK_XEL.add()
|| {? _uwagi<>''
   || PPK_XEL.memo_set(_uwagi,'UWAGI');
      PPK_XEL.memo_put(,'UWAGI')
   ?};
   _ref:=PPK_XEL.ref()
?};

_ref


\popraw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.51]
:: OPIS: Zmienia informacje o elemencie.
::   WE: _a STRING - symbol elementu
::       _b [STRING] - nowy symbol elementu
::       _c [STRING] - opis elementu
::       _d [STRING] - treść komentarza
::   WY: 0/1 - porażka/sukces
::----------------------------------------------------------------------------------------------------------------------
:: mapa argumentów
_symbol:=_a;
_ret:=1;

{? exec('szukaj','ppk_xel',_symbol)=null
|| {? var_pres('_b')=type_of('') & _b<>''
   || {? var_pres('szukaj','ppk_xel',_b)=null
      || _ret:=0
      ?}
   ?};
   return(_ret)
?};

_mod:=0;
{? var_pres('_b')=type_of('') & _b<>''
|| PPK_XEL.SYMBOL:=_b;
   _mod+=1
?};
{? var_pres('_c')=type_of('') & _c<>''
|| PPK_XEL.OPIS:=_c;
   _mod+=1
?};
{? var_pres('_d')=type_of('')
|| PPK_XEL.memo_set(_d,'UWAGI');
   PPK_XEL.memo_put(,'UWAGI');
   _mod+=1
?};

{? _mod<>0
|| _ret:=PPK_XEL.put()
?};

_ret


\usun
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.51]
:: OPIS: Usuwa dane elementu.
::   WE: _a STRING - symbol elementu
::   WY: 0/1 - porażka/sukces
::----------------------------------------------------------------------------------------------------------------------
:: mapa argumentów
_symbol:=_a;

_ref:=exec('szukaj','ppk_xel',_symbol);
{? _ref=null
|| return(0)
?};

PPK_XEL.del(,1)<>0


\dane_sys
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.51]
:: OPIS: Uzupełnia dane wersji plików PPK.
::   WE:
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
exec('dodaj','ppk_xel','PPK','Plik wymiany danych');
exec('dodaj','ppk_xel','wersja','Numer wersji pliku');

exec('dodaj','ppk_xel','WERSJA','Numer wersji dokumentacji');
exec('dodaj','ppk_xel','GENERACJA','Data i godzina utworzenia pliku');

exec('dodaj','ppk_xel','PRACODAWCA','Dane identyfikacyjne pracodawcy');
exec('dodaj','ppk_xel','NIP','Numer Identyfikacji Podatkowej');
exec('dodaj','ppk_xel','REGON','Numer REGON');
exec('dodaj','ppk_xel','DOK_TOZ_TYP','Rodzaj dokumentu tożsamości');
exec('dodaj','ppk_xel','DOK_TOZ_SYM','Numer dokumentu tożsamości');
exec('dodaj','ppk_xel','NR_UMOWY_PPK','Numer umowy PPK');
exec('dodaj','ppk_xel','KONTAKT','Dane kontaktowe');

exec('dodaj','ppk_xel','DANE_UCZESTNIKA','Uczestnicy PPK');
exec('dodaj','ppk_xel','UCZESTNIK','Uczestnik PPK');
exec('dodaj','ppk_xel','ID_KADRY','Identyfikator w systemie kadrowym');
exec('dodaj','ppk_xel','IMIE','Pierwsze imię');
exec('dodaj','ppk_xel','IMIE_2','Drugie imię');
exec('dodaj','ppk_xel','NAZWISKO','Aktualne nazwisko');
exec('dodaj','ppk_xel','PLEC','Płeć');
exec('dodaj','ppk_xel','OBYW','Obywatelstwo');
exec('dodaj','ppk_xel','NR_PESEL','Numer PESEL');
exec('dodaj','ppk_xel','DATA_UR','Data urodzenia');
exec('dodaj','ppk_xel','ID_PPK','Identyfikator w ewidencji');
exec('dodaj','ppk_xel','PZIF_RACH_PPK','Numer rachunku');

exec('dodaj','ppk_xel','REJESTRACJA','Rejestracja uczestnika');
exec('dodaj','ppk_xel','DATA_OBOWIAZKU','Data powstania obowiązku zgłoszenia');
exec('dodaj','ppk_xel','DATA_ZATRUDNIENIA','Data zatrudnienia');
exec('dodaj','ppk_xel','KONTAKT_EMAIL','Adres poczty elektronicznej');
exec('dodaj','ppk_xel','KONTAKT_TEL','Numer telefonu');
exec('dodaj','ppk_xel','ADR_ZAM_KRAJ','Adres zamieszkania: kraj');
exec('dodaj','ppk_xel','ADR_ZAM_KOD_POCZ','Adres zamieszkania: kod pocztowy');
exec('dodaj','ppk_xel','ADR_ZAM_MSC','Adres zamieszkania: miejscowość');
exec('dodaj','ppk_xel','ADR_ZAM_ULICA','Adres zamieszkania: ulica');
exec('dodaj','ppk_xel','ADR_ZAM_NR_DOMU','Adres zamieszkania: numer dom');
exec('dodaj','ppk_xel','ADR_ZAM_NR_MIESZ','Adres zamieszkania: numer lokalu');
exec('dodaj','ppk_xel','ADR_KOR_KRAJ','Adres korespondencji: kraj');
exec('dodaj','ppk_xel','ADR_KOR_KOD_POCZ','Adres korespondencji: kod pocztowy');
exec('dodaj','ppk_xel','ADR_KOR_MSC','Adres korespondencji: miejscowość');
exec('dodaj','ppk_xel','ADR_KOR_ULICA','Adres korespondencji: ulica');
exec('dodaj','ppk_xel','ADR_KOR_NR_DOMU','Adres korespondencji: numer domu');
exec('dodaj','ppk_xel','ADR_KOR_NR_MIESZ','Adres korespondencji: numer lokalu');
exec('dodaj','ppk_xel','FIR_SKL_DOD_PROCENT','Procent wpłaty dodatkowej zatrudniającego');
exec('dodaj','ppk_xel','FIR_SKL_DOD_OPIS','Opis wpłaty dodatkowej zatrudniającego');

exec('dodaj','ppk_xel','SKLADKA','Wpłaty uczestnika i zatrudniającego');
exec('dodaj','ppk_xel','SKL_ZA_OKRES','Okres, za który naliczono wpłaty');
exec('dodaj','ppk_xel','UCZ_WAR_POD','Wpłata podstawowa uczestnika');
exec('dodaj','ppk_xel','UCZ_WAR_DOD','Wpłata dodatkowa uczestnika');
exec('dodaj','ppk_xel','FIR_WAR_POD','Wpłata podstawowa zatrudniającego');
exec('dodaj','ppk_xel','FIR_WAR_DOD','Wpłata dodatkowa zatrudniającego');
exec('dodaj','ppk_xel','UCZ_OBNIZ_SKL_POD','Obniżenie wpłaty podstawowej uczestnika');

exec('dodaj','ppk_xel','DANE_KOREKT','Korekty wpłat');
exec('dodaj','ppk_xel','KOREKTA','Korekta wpłat');

exec('dodaj','ppk_xel','DANE_DEKLARACJI','Deklaracje uczestnika');
exec('dodaj','ppk_xel','DEKLARACJA','Deklaracja uczestnika');
exec('dodaj','ppk_xel','DATA_DEKLARACJI','Data deklaracji');
exec('dodaj','ppk_xel','TYP_DEKLARACJI','Typ deklaracji');
exec('dodaj','ppk_xel','PROCENT_SKLADKI','Procent składki');
exec('dodaj','ppk_xel','POP_PZIF_ID','Nazwa poprzedniej instytucji finansowej');

exec('dodaj','ppk_xel','DANE_ZMIANA','Zmiana danych kontaktu elektronicznego');
exec('dodaj','ppk_xel','DATA_ZMIANY','Data zmiany');

exec('dodaj','ppk_xel','UCZESTNIK_ZMIANA','Zmiana danych identyfikacyjnych');

exec('dodaj','ppk_xel','ZWOLNIENIE','Zakończenie współpracy z uczestnikiem');
exec('dodaj','ppk_xel','DATA_ZWOLNIENIA','Data zakończenia współpracy');

exec('dodaj','ppk_xel','LISTA_TRANSFEROW','Transfery uczestnika');
exec('dodaj','ppk_xel','TRANSFER','Transfer PPK');
exec('dodaj','ppk_xel','TYP_TRANSFERU','Typ transferu');
exec('dodaj','ppk_xel','NUMER_RACHUNKU_PPK_Z','Numer Rachunku Uczestnika w IF');
exec('dodaj','ppk_xel','PZIF_WYPLACAJACA_NAZWA','Nazwa instytucji finansowej');
exec('dodaj','ppk_xel','PZIF_WYPLACAJACA_NIP','NIP instytucji finansowej');

~~

:Sign Version 2.0 jowisz:1048 2020/10/16 15:22:56 b796c20b39d91333c70f903081922a8c0789bced40c031e7cc4b6009bc559dabc850994124718cc7ec7c9316322d0740e406151084d4b2f398495aefd8c7693494f7ef9359c84b90151a4b75709a2315570fb9ac387fc40a7adfc7bb95b912d52b5c561360695ae3ea4e707bfd438424f55b62ee7f80f012fbdb3d41dc21af65
