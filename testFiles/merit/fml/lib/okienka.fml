:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: okienka.fml [17.00]
:: Utworzony: 2015.07.02
:: Autor: [rr]
::======================================================================================================================
:: Zawartosc: formuły wspólne do obsługi pól z ikonkami
::======================================================================================================================


\eanx_wys
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.00]
:: OPIS: Wyświetla ikony na polach
::----------------------------------------------------------------------------------------------------------------------
_formikon:="{? EANX.WYS='T'
            || EANX.WYS:=''; 'xwin16.png:166'
            |? EANX.WYS='S'
            || EANX.WYS:=''; 'xwin16.png:62'
            |? EANX.WYS='W'
            || EANX.WYS:=''; 'xwin16.png:165'
            |? EANX.WYS='A'
            || EANX.WYS:=''; 'xwin16.png:164'
            |? EANX.WYS='R'
            || EANX.WYS:=''; 'xwin16.png:167'
            |? EANX.WYS='J'
            || EANX.WYS:=''; 'xwin16.png:164'
            |? EANX.WYS='I'
            || EANX.WYS:=''; 'xwin16.png:167'
            |? EANX.WYS='K'
            || EANX.WYS:=''; 'xwin16.png:168'
            || ''
            ?}";
ZK_N.win_fml('WERZ',EANX,'WYS',,'ICON_BEFORE',_formikon);
ZK_N.win_fml('WERW',EANX,'WYS',,'ICON_BEFORE',_formikon);
ZD_NAG.win_fml('WER',EANX,'WYS',,'ICON_BEFORE',_formikon);
ZDP_NAG.win_fml('WER',EANX,'WYS',,'ICON_BEFORE',_formikon);
DK_LN.win_fml('WER',EANX,'WYS',,'ICON_BEFORE',_formikon);
ND.win_fml('WERP',EANX,'WYS',,'ICON_BEFORE',_formikon);
_formikon:="{? EANX.INFPAL='N'
            || EANX.INFPAL:=''; 'xwin16.png:42'
            |? EANX.INFPAL='X'
            || EANX.INFPAL:=''; 'xwin16.png:81'
            |? EANX.INFPAL='Y'
            || EANX.INFPAL:=''; 'xwin16.png:52'
            |? EANX.INFPAL='J'
            || EANX.INFPAL:=''; 'xwin16.png:61'
            |? EANX.INFPAL='T'
            || EANX.INFPAL:=''; 'xwin16.png:38'
            |? EANX.INFPAL='R'
            || EANX.INFPAL:=''; 'xwin16.png:163'
            |? EANX.INFPAL='B'
            || EANX.INFPAL:=''; 'xwin16.png:198'
            |? EANX.INFPAL='W'
            || EANX.INFPAL:=''; 'xwin16.png:162'
            |? EANX.INFPAL='O'
            || EANX.INFPAL:=''; 'xwin16.png:122'
            |? EANX.INFPAL='I'
            || EANX.INFPAL:=''; 'xwin16.png:110'
            |? EANX.INFPAL='A'
            || EANX.INFPAL:=''; 'xwin16.png:68'
            || ''
            ?}";
PAL.win_fml('SEL',EANX,'INFPAL',,'ICON_BEFORE',_formikon);
PAL.win_fml('BEZ',EANX,'INFPAL',,'ICON_BEFORE',_formikon);
PAL.win_fml('SLO',EANX,'INFPAL',,'ICON_BEFORE',_formikon);
PAL.win_fml('NOPAL',EANX,'INFPAL',,'ICON_BEFORE',_formikon);
_formikon:="{? EANX.STZAD='N'
            || EANX.STZAD:=''; 'xwin16.png:42'
            |? EANX.STZAD='T'
            || EANX.STZAD:=''; 'xwin16.png:61'
            |? EANX.STZAD='R'
            || EANX.STZAD:=''; 'xwin16.png:33'
            |? EANX.STZAD='W'
            || EANX.STZAD:=''; 'xwin16.png:38'
            |? EANX.STZAD='A'
            || EANX.STZAD:=''; 'xwin16.png:185'
            || ''
            ?}";
_formikon:=exec('ATR_INDATR','magdok_poz');
DK.win_fml('WER',ATR,'INDATR',,'ICON_BEFORE',_formikon);
DK.win_fml('WER_DOK',ATR,'INDATR',,'ICON_BEFORE',_formikon);
_formikon:="{? exec('FindInSet','#table','FAP_K','TAXS',DK.uidref())<>null()
            || 'xwin16.png:10'
            || exec('pusta','#icon')
            ?}";
DK.win_fml('WER',DK,'WAR',,'ICON_BEFORE',_formikon);
DK.win_fml('WER_DOK',DK,'WAR',,'ICON_BEFORE',_formikon);
DK.win_fml('WER_REA',DK,'WAR',,'ICON_BEFORE',_formikon);
_formikon:="{? BEER.NREA='T'
            || BEER.NREA:=''; 'xwin16.png:56'
            |? BEER.NREA='W'
            || BEER.NREA:=''; 'xwin16.png:70'
            |? BEER.NREA='N'
            || BEER.NREA:=''; 'xwin16.png:18'
            || ''
            ?}";
ZK_N.win_fml('WERZ',BEER,'NREA',,'ICON_BEFORE',_formikon);
ZK_N.win_fml('WERW',BEER,'NREA',,'ICON_BEFORE',_formikon);
_formikon:="{? BEER.NKLK='T'
            || BEER.NKLK:=''; 'xwin16.png:184'
            || ''
            ?}";
ZK_N.win_fml('WERZ',BEER,'NKLK',,'ICON_BEFORE',_formikon);
ZK_N.win_fml('WERW',BEER,'NKLK',,'ICON_BEFORE',_formikon);
_formikon:="{? ZK_N.REA='T'
            || ZK_N.REA:=''; 'xwin16.png:144'
            || ZK_N.REA:=''; ''
            ?}";
ZK_N.win_fml('WERZ',ZK_N,'REA',,'ICON_BEFORE',_formikon);
ZK_N.win_fml('WERW',ZK_N,'REA',,'ICON_BEFORE',_formikon);
_formikon:="{? ZK_N.BRK='T'
            || ZK_N.BRK:=''; 'xwin16.png:16'
            || ZK_N.BRK:=''; ''
            ?}";
ZK_N.win_fml('WERZ',ZK_N,'BRK',,'ICON_BEFORE',_formikon);
ZK_N.win_fml('WERW',ZK_N,'BRK',,'ICON_BEFORE',_formikon);
_formikon:="{? ZK_N.ZNR='T'
            || ZK_N.ZNR:=''; 'xwin16.png:38'
            || ZK_N.ZNR:=''; ''
            ?}";
ZK_N.win_fml('WERZ',ZK_N,'ZNR',,'ICON_BEFORE',_formikon);
ZK_N.win_fml('WERW',ZK_N,'ZNR',,'ICON_BEFORE',_formikon);
_formikon:="{? ZK_P.ILRB>0
            || 'xwin16.png:61'
            || ''
            ?}";
ZK_P.win_fml('ZAMZ',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMZ_PRJ',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW_PRJ',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZ',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZW',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('DZAM',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ALLZ',ZK_P,'ILRB',,'ICON_BEFORE',_formikon);
_formikon:="{? ZK_P.ILRD>0
            || 'xwin16.png:16'
            || ''
            ?}";
ZK_P.win_fml('ZAMZ',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMZ_PRJ',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW_PRJ',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZ',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZW',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('DZAM',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ALLZ',ZK_P,'ILRD',,'ICON_BEFORE',_formikon);
_formikon:="{? ZK_P.ILRW>0
            || {? exec('czyRezZlzam','zamsiw_wspolne',ZK_P.ref())
               || 'xwin16.png:92'
               || 'xwin16.png:83'
               ?}
            || ''
            ?}";
ZK_P.win_fml('ZAMZ',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMZ_PRJ',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW_PRJ',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZ',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZW',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('DZAM',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ALLZ',ZK_P,'ILRW',,'ICON_BEFORE',_formikon);
_formikon:="
               _result:='';
               ZLZAM.cntx_psh();
               ZLZAM.index('ZMZL');
               ZLZAM.prefix($ZK_P.ref());
               {? ZLZAM.first()
               || _result:='xwin16.png:188'
               ?};
               ZLZAM.cntx_pop();

               {? _result=''
               || PX_OBJ.cntx_psh();
                  _px_obj:=exec('get_zkp_object','px_obj',ZK_P.ref());
                  PX_OBJ.prefix();
                  {? _px_obj<>null() & PX_OBJ.seek(_px_obj)
                  || {? PX_OBJ.IL_PLAN>0
                     || _result:=exec('px_plan','icon')
                     ?}
                  ?};
                  PX_OBJ.cntx_pop()
               ?};
               {? _result=''
               ||
                  PL_PART.cntx_psh();
                  PL_PART.index('ZK_P');
                  PL_PART.prefix(ZK_P.ref());
                  {? PL_PART.first()
                  || _result:=exec('pl_plan','icon')
                  ?};
                  PL_PART.cntx_pop()
               ?};
               _result
            ";
ZK_P.win_fml('ZAMZ',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMZ_PRJ',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAMW_PRJ',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZ',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ZAM_PRZW',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('DZAM',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
ZK_P.win_fml('ALLZ',ZK_P,'ILP',,'ICON_BEFORE',_formikon);
~~


\btn_EndPosition
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.00]
:: OPIS: Klawisz zakończ dla pozycji
::   WE: _a - ACT_UID czynności
::       _b - uidref
::       _c - tabela
::       _d - akcja
::       _e - treść pytania
:: Uwaga. Zakładamy, że tabela posiada pole STAT_REJ
::----------------------------------------------------------------------------------------------------------------------
{? ~BPMN.END
|| _params:=exec('mp_run_a','#b__box');
   _params.ACT_UID:=_a;
   _params.UIDREF:=_b;
   _params.AKCJA:=_d;

   exec('mp_run','#b__box',_params);
   {? exec('FindAndGet','#table',_c,_params.UIDREF,,"STAT_REJ",'N')<>'N' || sel_exit() ?}
|? FUN.ask(_e)
|| BPMN.END:=2;
   sel_exit()
?};
~~


\dispWithNag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.00]
:: OPIS: okienko do wyświetlania z tabelką FAKSO
::   WE: _a - akronim tabeli
::       _b - akronim okienka pozycji
::       _c - akronim tabeli nagłówka
::       _d - akronim pola nagłówka
::       _e - akronim okienka nagłówka
::       [_f] - tytuł okienka
::----------------------------------------------------------------------------------------------------------------------
{? _>=6 || {? type_of(_f)<>2 || _title:='' || _title:=_f ?} || _title:='' ?};

_tab:=($_a);
_fld:=$(_a+'.'+_d);
_nag:=($_c);
_small:=-~_a;

_dokum_view:=0;
{? _tab()=ZK_P & _nag()=ZK_N
|| _dokum:=exec('bl_dokum_seek','zbl',ZK_N) | exec('dokum_seek','zbl',ZK_N);
   _dokum_view:=_dokum & DOKUM.DOKUMI
?};

{| _tab()
|! _fld();

   _win_red:=mk_edit(_title,,'disp_grpn'+_small);
   win_etab(_win_red,'Pozycje'@);
   win_ewin(_win_red,,_b);
   win_etab(_win_red,'Nagłówek'@);
   win_ewin(_win_red,_nag(),_e);
   {? _dokum_view
   || win_etab(_win_red,'Podgląd'@);
      win_ewin(_win_red,DOKUM,'DOKUMI')
   ?};
   win_edit(_win_red);
   display()
|};
~~


\dselWithNag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.00]
:: OPIS: okienko do wyświetlania z tabelką FAKSO
::   WE: _a - akronim tabeli
::       _b - akronim okienka pozycji - selekcja
::       _c - akronim tabeli nagłówka
::       _d - akronim okienka nagłówka - edycja
::       [_f] - tytuł okienka
::       [_g] - bez informacji dodatkowych domyślnie z
::----------------------------------------------------------------------------------------------------------------------
{? _>=6 || {? type_of(_f)<>2 || _title:='' || _title:=_f ?} || _title:='' ?};

_tab:=($_a);
_nag:=($_c);
_small:=-~_a;
{? (+_small)>6 || _small:=6+_small ?};
_ref:=$(_c+'.ref');
{| _nag()
|! _isFAKSO:=';ND;DK;FAKS;FAP;ZD_POZ;ZD_NAG;ZK_N;ZK_P;'*(';'+_c+';');
   _win_grp:=grp_make(_title,,'disp_grp_'+_small);
   grp_sel(_win_grp,_tab(),_b,'Pozycje'@,,,,23,,,,,'maximized','position_'+_small,1);
   grp_edit(_win_grp,,_d,'Nagłówek',,,,,'maximized');

   _actions:=@.FAKSO.actions('WERF','puLA:A');
   @.FAKSO.cntx_psh();
   @.FAKSO.use('fakto'+(ref_name(_ref())+3));
   @.FAKSO.prefix();
   {? _isFAKSO & exec('FindInSet','#table','FAKSO',_c,_ref())<>null()
   || grp_sel(_win_grp,FAKSO,'WERF','Informacje dodatkowe'@,,,,23,,,,,'maximized','infdodn_'+_small);
      @.FAKSO.index(_c);
      @.FAKSO.prefix(_ref());
      @.FAKSO.first()
   ?};
   win_sel(_win_grp);
   select();
   FAKSO.actions('WERF',_actions);
   @.FAKSO.cntx_pop()
|};
~~

:Sign Version 2.0 jowisz:1048 2023/06/23 14:14:36 9d4770edf36c4affaf015fb63ca88c211db92790ba9fb7505079c141b23fe33d613044e6cc2cec05ca8782122c641f70599e47bf248adce8faa6cc0d5685923af4607120aa8768ec50a6cec70e774987ba781a5f8899e0c504cd8c124334a1f214412e99acd3c65fa0c5de64d61a2a69d6acc17c50a339c317dfa2340ec068f8
