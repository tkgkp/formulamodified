:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: szablon_fks.fml
:: Utworzony:
:: Autor: KN
::======================================================================================================================
:: Zawartość: Formuły wykorzystywane w szablonach dokumentów WORD w obaszarach finansowych
::======================================================================================================================


\ser_nag_prolog
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KN [23.25]
:: OPIS: Prolog funkcji pobrania korespondencji z rozrachunków
::   WE:
::----------------------------------------------------------------------------------------------------------------------
SER_NAG.cntx_psh();
SER_NAG.prefix()


\ser_nag_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KN [23.25]
:: OPIS: Funkcja pobrania korespondencji z rozrachunków
::   WE: _a - obiekt z parametrami wywołania
::----------------------------------------------------------------------------------------------------------------------
{? SER_NAG.seek(_a.SER_NAG,,1)
|| SER_NAG
|| ~~
?}


\ser_nag_epilog
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KN [23.25]
:: OPIS: Epilog funkcji pobrania korespondencji z rozrachunków
::   WE:
::----------------------------------------------------------------------------------------------------------------------
SER_NAG.cntx_pop()


\sposob_zaplaty_bank
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca informacje o sposobie zapłaty
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_kontoBank:='';
SKID_RBK.index('WEKTOR');
RACHBANK.KB_1R:=RB.get_rbel(2,RACHBANK.KB_1R);
{? RACHBANK.KB_1R<>'' & SKID_RBK.find_key(REF.INFO,RACHBANK.KB_1R,RACHBANK.KB_1R)
|| _kontoBank:=RB.get_rbtx(1,SKID_RBK.ref(),SKID_RBK.KRAJ().KODISO)
?};
{? _kontoBank='' || _kontoBank:=exec('get_rb','rozrach_kor') ?};
'Przelew do: '+
SKID_RBK.BANK().NB+{? SKID_RBK.BANK().KODISO<>XINFO.KRAJ || ', SWIFT (BIC): '+
SKID_RBK.BANK().SWIFT || '' ?}


\sposob_zaplaty_konto
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca informacje o sposobie zapłaty
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_kontoBank:='';
SKID_RBK.index('WEKTOR');
RACHBANK.KB_1R:=RB.get_rbel(2,RACHBANK.KB_1R);
{? RACHBANK.KB_1R<>'' & SKID_RBK.find_key(REF.INFO,RACHBANK.KB_1R,RACHBANK.KB_1R)
|| _kontoBank:=RB.get_rbtx(1,SKID_RBK.ref(),SKID_RBK.KRAJ().KODISO)
?};
{? _kontoBank='' || _kontoBank:=exec('get_rb','rozrach_kor') ?};
'Na konto: '+_kontoBank


\ser_poz_prolog
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KN [23.25]
:: OPIS: Prolog funkcji pobrania pozycji korespondencji z rozrachunków
::   WE: _a - obiekt z parametrami wywołania
::----------------------------------------------------------------------------------------------------------------------
SER_POZ.cntx_psh()


\ser_poz_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Prolog funkcji pobrania pozycji korespondencji z rozrachunków
::   WE: _a - obiekt z parametrami wywołania
::----------------------------------------------------------------------------------------------------------------------
_sumaods:=_sumaraz:=_sumaodsPrz:=_sumaodsPo:=_w3:=0;
_cntsamedok:=1;
_dokument:=_oddzial:=''; _tp:=date(0,0,0); _kontosp:=''; _sumapf:=0; _kwp:=_sumaods1:=_sumaods2:=_sumaods3:=0;
_ind_spoz:=SER_POZ.ndx_tmp('',1,'REF','FIRMA',0,'REF',,0,'ODD','OD',0,'WAL','KOD',0,'DATA',,0,'SYM_ROK',,0,'KON',,0,'PRZEDPO',,0);
_prevdok:='';

SERPOZ:=tab_tmp(1,'REF','STRING[16]','',
                 'T','STRING[1]','',
                 'ST','INTEGER','',
                 'DOK','STRING[50]','',
                 'DATA','STRING[10]','',
                 'TERM','STRING[10]','',
                 'KW','STRING[12]','',
                 'DATW','DATE','',
                 'KWP','REAL','',
                 'DNASZ','REAL','',
                 'DWASZ','REAL','',
                 'ZWL','INTEGER','',
                 'ODS','REAL','',
                 'KON','STRING[35]','',
                 'ODD','STRING[16]','',
                 'WAL','STRING[16]','',
                 'ZWLPRTER','INTEGER','',
                 'ZWLPOTER','INTEGER','',
                 'PRZEDPO','INTEGER','',
                 'POTWIER','INTEGER','',
                 'KOMEN','STRING[60]','',
                 'UMORZNOT','INTEGER','',
                 'USER_UM','STRING[10]','',
                 'OPISNOTU','STRING[100]','',
                 'SYM_ROK','STRING[54]','',
                 'SYM_ZEW','STRING[50]','',
                 'POZDOZAP','REAL','',
                 'RAZEM','REAL','',
                 'ODSRAZPR','REAL','',
                 'ODSRAZPO','REAL',''
              );

SER_POZ.index(_ind_spoz);
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a.SER_NAG,OPERATOR.DEPT().OD);
{? SER_POZ.first()
|| {! |?
      {? (SER_POZ.PRZEDPO & PAR_WYDR.PAR15 & ROZNE.UT_DOK) | ~SER_POZ.PRZEDPO
      || {? _prevdok=''
         || SERPOZ.REF:=$SER_POZ.REF;
            SERPOZ.T:=SER_POZ.T;
            SERPOZ.ST:=SER_POZ.ST;
            SERPOZ.DOK:=SER_POZ.DOK;
            SERPOZ.DATA:=$SER_POZ.DATA;
            SERPOZ.TERM:=$SER_POZ.TERM;
            SERPOZ.KW:=exec('real2str','szablon_fks',SER_POZ.KW);
            SERPOZ.DATW:=SER_POZ.DATW;
            SERPOZ.KWP:=SER_POZ.KWP;
            SERPOZ.DNASZ:=SER_POZ.DNASZ;
            SERPOZ.DWASZ:=SER_POZ.DWASZ;
            SERPOZ.ZWL:=SER_POZ.ZWL;
            SERPOZ.ODS:=SER_POZ.ODS;
            SERPOZ.KON:=SER_POZ.KON;
            SERPOZ.ODD:=$SER_POZ.ODD;
            SERPOZ.WAL:=$SER_POZ.WAL;
            SERPOZ.ZWLPRTER:=SER_POZ.ZWLPRTER;
            SERPOZ.ZWLPOTER:=SER_POZ.ZWLPOTER;
            SERPOZ.PRZEDPO:=SER_POZ.PRZEDPO;
            SERPOZ.POTWIER:=SER_POZ.POTWIER;
            SERPOZ.KOMEN:=SER_POZ.KOMEN;
            SERPOZ.UMORZNOT:=SER_POZ.UMORZNOT;
            SERPOZ.USER_UM:=SER_POZ.USER_UM;
            SERPOZ.OPISNOTU:=SER_POZ.OPISNOTU;
            SERPOZ.SYM_ROK:=SER_POZ.SYM_ROK;
            SERPOZ.SYM_ZEW:=SER_POZ.SYM_ZEW;
            SERPOZ.RAZEM:=0;
            SERPOZ.ODSRAZPR:=0;
            SERPOZ.ODSRAZPO:=0;
            _sumapf+=SER_POZ.KWP;
            SERPOZ.POZDOZAP:=SER_POZ.KW-_sumapf;
            _tp:=SER_POZ.TERM;
            {? SER_POZ.PRZEDPO || _sumaodsPrz+=SER_POZ.ODS || _sumaodsPo+=SER_POZ.ODS ?}
         |? _prevdok=SER_POZ.DOK
         || _cntsamedok:=_cntsamedok+1;
            SERPOZ.REF:=$SER_POZ.REF;
            SERPOZ.T:=SER_POZ.T;
            SERPOZ.ST:=SER_POZ.ST;
            SERPOZ.DOK:='';
            SERPOZ.DATA:='';
            SERPOZ.TERM:='';
            SERPOZ.KW:='';
            SERPOZ.DATW:=SER_POZ.DATW;
            SERPOZ.KWP:=SER_POZ.KWP;
            SERPOZ.DNASZ:=SER_POZ.DNASZ;
            SERPOZ.DWASZ:=SER_POZ.DWASZ;
            SERPOZ.ZWL:=SER_POZ.ZWL;
            SERPOZ.ODS:=SER_POZ.ODS;
            SERPOZ.KON:=SER_POZ.KON;
            SERPOZ.ODD:=$SER_POZ.ODD;
            SERPOZ.WAL:=$SER_POZ.WAL;
            SERPOZ.ZWLPRTER:=SER_POZ.ZWLPRTER;
            SERPOZ.ZWLPOTER:=SER_POZ.ZWLPOTER;
            SERPOZ.PRZEDPO:=SER_POZ.PRZEDPO;
            SERPOZ.POTWIER:=SER_POZ.POTWIER;
            SERPOZ.KOMEN:=SER_POZ.KOMEN;
            SERPOZ.UMORZNOT:=SER_POZ.UMORZNOT;
            SERPOZ.USER_UM:=SER_POZ.USER_UM;
            SERPOZ.OPISNOTU:=SER_POZ.OPISNOTU;
            SERPOZ.SYM_ROK:=SER_POZ.SYM_ROK;
            SERPOZ.SYM_ZEW:=SER_POZ.SYM_ZEW;
            SERPOZ.RAZEM:=0;
            SERPOZ.ODSRAZPR:=0;
            SERPOZ.ODSRAZPO:=0;
            _sumapf+=SER_POZ.KWP;
            SERPOZ.POZDOZAP:=SER_POZ.KW-_sumapf;
            _tp:=SER_POZ.TERM;
            {? SER_POZ.PRZEDPO || _sumaodsPrz+=SER_POZ.ODS || _sumaodsPo+=SER_POZ.ODS ?}
         |? _prevdok<>SER_POZ.DOK
         || {? SER_POZ.prev() & _cntsamedok>1
            || SERPOZ.REF:=$SER_POZ.REF;
               SERPOZ.T:='';
               SERPOZ.ST:=0;
               SERPOZ.DOK:='RAZEM';
               SERPOZ.DATA:='';
               SERPOZ.TERM:='';
               SERPOZ.KW:='';
               SERPOZ.DATW:=date(0,0,0);
               SERPOZ.KWP:=_sumapf;
               SERPOZ.DNASZ:=0;
               SERPOZ.DWASZ:=0;
               _w3:={? exec('get_par','#parametr',26)='T'
                    || exec('dzienRob','kalendarz',_tp,1,1)
                    || _tp
                    ?};
               SERPOZ.ZWL:={? SER_POZ.T='W' || exec('FindAndGet','#table',SER_NAG,_a.SER_NAG,,"SER_NAG.DATA",null())-_w3 || 0 ?};
               SERPOZ.ODS:={? SER_POZ.PRZEDPO || _sumaods3 || _sumaods1 ?};
               SERPOZ.KON:='';
               SERPOZ.ODD:='';
               SERPOZ.WAL:='';
               SERPOZ.ZWLPRTER:=0;
               SERPOZ.ZWLPOTER:=0;
               SERPOZ.PRZEDPO:=0;
               SERPOZ.POTWIER:=0;
               SERPOZ.KOMEN:='';
               SERPOZ.UMORZNOT:=0;
               SERPOZ.USER_UM:='';
               SERPOZ.OPISNOTU:='';
               SERPOZ.SYM_ROK:='';
               SERPOZ.SYM_ZEW:='';
               SERPOZ.RAZEM:=_sumaraz;
               SERPOZ.ODSRAZPR:=_sumaodsPrz;
               SERPOZ.ODSRAZPO:=_sumaodsPo;
               _sumaodsPrz:=_sumaodsPo:=0;
               SERPOZ.add()
            ?};
            {? SER_POZ.next()
            || SERPOZ.REF:=$SER_POZ.REF;
               SERPOZ.T:=SER_POZ.T;
               SERPOZ.ST:=SER_POZ.ST;
               SERPOZ.DOK:=SER_POZ.DOK;
               SERPOZ.DATA:=$SER_POZ.DATA;
               SERPOZ.TERM:=$SER_POZ.TERM;
               SERPOZ.KW:=exec('real2str','szablon_fks',SER_POZ.KW);
               SERPOZ.DATW:=SER_POZ.DATW;
               SERPOZ.KWP:=SER_POZ.KWP;
               SERPOZ.DNASZ:=SER_POZ.DNASZ;
               SERPOZ.DWASZ:=SER_POZ.DWASZ;
               SERPOZ.ZWL:=SER_POZ.ZWL;
               SERPOZ.ODS:=SER_POZ.ODS;
               SERPOZ.KON:=SER_POZ.KON;
               SERPOZ.ODD:=$SER_POZ.ODD;
               SERPOZ.WAL:=$SER_POZ.WAL;
               SERPOZ.ZWLPRTER:=SER_POZ.ZWLPRTER;
               SERPOZ.ZWLPOTER:=SER_POZ.ZWLPOTER;
               SERPOZ.PRZEDPO:=SER_POZ.PRZEDPO;
               SERPOZ.POTWIER:=SER_POZ.POTWIER;
               SERPOZ.KOMEN:=SER_POZ.KOMEN;
               SERPOZ.UMORZNOT:=SER_POZ.UMORZNOT;
               SERPOZ.USER_UM:=SER_POZ.USER_UM;
               SERPOZ.OPISNOTU:=SER_POZ.OPISNOTU;
               SERPOZ.SYM_ROK:=SER_POZ.SYM_ROK;
               SERPOZ.SYM_ZEW:=SER_POZ.SYM_ZEW;
               _sumapf:=SER_POZ.KWP;
               SERPOZ.POZDOZAP:=SER_POZ.KW-_sumapf;
               SERPOZ.RAZEM:=0;
               SERPOZ.ODSRAZPR:=0;
               SERPOZ.ODSRAZPO:=0;
               _cntsamedok:=1;
               _tp:=SER_POZ.TERM;
               {? SER_POZ.PRZEDPO || _sumaodsPrz:=SER_POZ.ODS || _sumaodsPo:=SER_POZ.ODS ?}
            ?}
         ?};
         SERPOZ.add();
         _prevdok:=SER_POZ.DOK
      ?};
      SER_POZ.next()
   !};
   {? _prevdok=SER_POZ.DOK & _cntsamedok>1
   || SERPOZ.REF:=$SER_POZ.REF;
      SERPOZ.T:='';
      SERPOZ.ST:=0;
      SERPOZ.DOK:='RAZEM';
      SERPOZ.DATA:='';
      SERPOZ.TERM:='';
      SERPOZ.KW:='';
      SERPOZ.DATW:=date(0,0,0);
      SERPOZ.KWP:=_sumapf;
      SERPOZ.DNASZ:=0;
      SERPOZ.DWASZ:=0;
      _w3:={? exec('get_par','#parametr',26)='T'
           || exec('dzienRob','kalendarz',_tp,1,1)
           || _tp
           ?};
      SERPOZ.ZWL:={? SER_POZ.T='W' || exec('FindAndGet','#table',SER_NAG,_a.SER_NAG,,"SER_NAG.DATA",null())-_w3 || 0 ?};
      SERPOZ.ODS:={? SER_POZ.PRZEDPO || _sumaods3 || _sumaods1 ?};
      SERPOZ.KON:='';
      SERPOZ.ODD:='';
      SERPOZ.WAL:='';
      SERPOZ.ZWLPRTER:=0;
      SERPOZ.ZWLPOTER:=0;
      SERPOZ.PRZEDPO:=0;
      SERPOZ.POTWIER:=0;
      SERPOZ.KOMEN:='';
      SERPOZ.UMORZNOT:=0;
      SERPOZ.USER_UM:='';
      SERPOZ.OPISNOTU:='';
      SERPOZ.SYM_ROK:='';
      SERPOZ.SYM_ZEW:='';
      SERPOZ.RAZEM:=_sumaraz;
      SERPOZ.ODSRAZPR:=_sumaodsPrz;
      SERPOZ.ODSRAZPO:=_sumaodsPo;
      SERPOZ.add()
   ?}
?};
SERPOZ


\ser_poz_epilog
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KN [23.25]
:: OPIS: Prolog funkcji pobrania pozycji korespondencji z rozrachunków
::   WE: _a - obiekt z parametrami wywołania
::----------------------------------------------------------------------------------------------------------------------
SER_POZ.cntx_pop(); SER_POZ.ndx_drop(); obj_del(SERPOZ)


\ser_nag_id
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca numer wezwania w postaci tekstu
::   WE: _a - SER_NAG
::   WY: numer
::----------------------------------------------------------------------------------------------------------------------
{? _a.KOD().T='W'
|| {? _a.ID<>''
   || 'WEZWANIE DO ZAPŁATY NR '+_a.ID+' Z DNIA'
   || 'WEZWANIE DO ZAPŁATY'
   ?}
|? _a.KOD().T='N'
|| {? _a.ID<>''
   || 'NOTA ODSETKOWA NR '+_a.ID+' Z DNIA'
   || 'NOTA ODSETKOWA'
   ?}
?}


\ser_nag_wal
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca kod i nazwę waluty
::   WE: _a - SLO.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
exec('FindAndGet','#table',SLO,_a,,"'%1 — %2'[SLO.KOD,SLO.TR]",'')


\ser_poz_kw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca kwotę należności na termin płatności
::   WE: _a - kwota
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
form({? _a<>'' || #_a || '' ?},,2,' ,')


\ser_poz_datw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca datę wpłaty
::   WE: _a - data wpłaty
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
{? _a<>date(0,0,0) & SERPOZ.KWP$2<>0 || $_a || '' ?}


\ser_poz_kwp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca kwotę wpłaty
::   WE: _a - kwota wpłaty
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
form(_a,,2,' ,')


\ser_poz_zwl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca zwłokę dni
::   WE: _a - zwłoka
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
{? _a<>0 || form(_a,,,'1') || '' ?}


\ser_poz_pozdozap_old
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość pozostało do zapłaty
::   WE: _a - SER_NAG
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_next:=1;
_curSerPozDom:=_a.ref();
_curSerPozDok:=_a.DOK;
_sumaPf:=0;

SERPOZ.cntx_psh();
SERPOZ.index('?');
SERPOZ.prefix(_a.REF,);

{? SERPOZ.first()
|| {!
   |? {? SERPOZ.ref()=_curSerPozDom || _next:=0 ?};
      {? SERPOZ.DOK=_curSerPozDok || _sumaPf+=SERPOZ.KWP ?};
      _next & SERPOZ.next()
   !}
?};
SERPOZ.cntx_pop();
form(SERPOZ.KW-_sumaPf,,2,' ,')


\ser_poz_pozdozap_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość ogółem pozostało do zapłaty
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_sumaWpl:=0;
_sumaFakt:=0;
_dokument:=_oddzial:=kontosp:='';
_tp:=date(0,0,0);

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? _sumaWpl+=SER_POZ.KWP;
      {? SER_POZ.SYM_ROK<>_dokument | SER_POZ.TERM<>_tp | SER_POZ.KON<>_kontosp | SER_POZ.ODD().OD<>_oddzial
      || _sumaFakt+=SER_POZ.KW
      ?};
      _dokument:=SER_POZ.SYM_ROK; _tp:=SER_POZ.TERM; _kontosp:=SER_POZ.KON; _oddzial:=SER_POZ.ODD().OD;

      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
form(_sumaFakt-_sumaWpl,,2,' ,')


\ser_poz_kwp_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca ogółem kwotę wpłaty
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_sumaWpl:=0;

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? _sumaWpl+=SER_POZ.KWP;

      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
form(_sumaWpl,,2,' ,')


\ser_poz_pozdozap_ogsl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość słownie ogółem pozostało do zapłaty
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_sumaWpl:=0;
_sumaFakt:=0;
_dokument:=_oddzial:=kontosp:='';
_tp:=date(0,0,0);

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? _sumaWpl+=SER_POZ.KWP;
      {? SER_POZ.SYM_ROK<>_dokument | SER_POZ.TERM<>_tp | SER_POZ.KON<>_kontosp | SER_POZ.ODD().OD<>_oddzial
      || _sumaFakt+=SER_POZ.KW
      ?};
      _dokument:=SER_POZ.SYM_ROK; _tp:=SER_POZ.TERM; _kontosp:=SER_POZ.KON; _oddzial:=SER_POZ.ODD().OD;

      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
STR.kwota_sł(_sumaFakt-_sumaWpl)+'.'


\ser_poz_ods_po
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca kwotę odsetek po terminie płatności
::   WE: _a - SER_POZ
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
{? _a.DOK='RAZEM'
|| form(_a.ODSRAZPO,,2,' ,')
|| {? _a.PRZEDPO || form(0,,2,' ,') || form(_a.ODS,,2,' ,') ?}
?}


\ser_poz_kwodspoter_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość ogółem kolumny kwota odsetek po terminie płatności
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_sumaOds:=0;

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? {? ~SER_POZ.PRZEDPO || _sumaOds+=SER_POZ.ODS ?};
      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
form(_sumaOds,,2,' ,')


\ser_poz_kwodsprter_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość ogółem kolumny kwota odsetek przed terminie płatności
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_sumaOds:=0;

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? {? SER_POZ.PRZEDPO || _sumaOds+=SER_POZ.ODS ?};
      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
form(_sumaOds,,2,' ,')


\ser_poz_ods_pr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca kwotę odsetek przed terminem płatności
::   WE: _a - SER_POZ
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
{? _a.DOK='RAZEM'
|| form(_a.ODSRAZPR,,2,' ,')
|| {? _a.PRZEDPO || form(_a.ODS,,2,' ,') || form(0,,2,' ,')?}
?}


\ser_poz_kw_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca ogółem kwotę faktury
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_sumaFakt:=0;
_dokument:=_oddzial:=kontosp:='';
_tp:=date(0,0,0);

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? {? SER_POZ.SYM_ROK<>_dokument | SER_POZ.TERM<>_tp | SER_POZ.KON<>_kontosp | SER_POZ.ODD().OD<>_oddzial
      || _sumaFakt+=SER_POZ.KW
      ?};
      _dokument:=SER_POZ.SYM_ROK; _tp:=SER_POZ.TERM; _kontosp:=SER_POZ.KON; _oddzial:=SER_POZ.ODD().OD;

      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
form(_sumaFakt,,2,' ,')


\ser_poz_kwods_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość ogółem kolumny kwota faktury noty odsetkowej
::   WE: _a - SER_NAG.ref()
::   WY: Wartość
::----------------------------------------------------------------------------------------------------------------------
_sumaOds:=0;
_sumaOds1:=0;

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? {? SER_POZ.PRZEDPO || _sumaOds1+=SER_POZ.ODS || _sumaOds+=SER_POZ.ODS ?};
      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
_sumaOds+{? PAR_WYDR.PAR15 || _sumaOds1 || 0 ?}


\ser_poz_dnasz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość kolumny na dobro nasze
::   WE: _a - SER_POZ
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_v_n:=_a.DNASZ$2; _v_w:=_a.DWASZ$2;
form(F.SWn(_v_n,_v_w),,2,' ,')


\ser_poz_dwasz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość kolumny na dobro wasze
::   WE: _a - SER_POZ
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_v_n:=_a.DNASZ$2; _v_w:=_a.DWASZ$2;
form(F.SMa(_v_n,_v_w),,2,' ,')


\ser_poz_dnasz_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość kolumny na dobro nasze ogółem
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_suma3:=0;
_suma4:=0;

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? _suma3+=F.SWn(SER_POZ.DNASZ$2,SER_POZ.DWASZ$2);
      _suma4+=F.SMa(SER_POZ.DNASZ$2,SER_POZ.DWASZ$2);
      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
form(F.SWn(_suma3,_suma4),,2,' ,')


\ser_poz_dwasz_og
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość kolumny na dobro wasze ogółem
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_suma3:=0;
_suma4:=0;

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? _suma3+=F.SWn(SER_POZ.DNASZ$2,SER_POZ.DWASZ$2);
      _suma4+=F.SMa(SER_POZ.DNASZ$2,SER_POZ.DWASZ$2);
      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();
form(F.SMa(_suma3,_suma4),,2,' ,')


\ser_poz_rozrach
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość kolumny rozrachunek
::   WE: _a - SER_POZ
::   WY: Symbol rozrachunku lub słowo RAZEM
::----------------------------------------------------------------------------------------------------------------------
_ret:=_a.DOK+{? _a.SYM_ZEW<>'' & _a.SYM_ZEW<>_a.DOK || ' ('+_a.SYM_ZEW+')' || '' ?};
_nast:=(_a.KWP$2<>0 & _a.DATW<>_a.REF().DATA);
_ind_spoz:=SER_POZ.ndx_tmp('',1,'REF','FIRMA',0,'REF',,0,'ODD','OD',0,'WAL','KOD',0,'DATA',,0,'SYM_ROK',,0,'KON',,0,'PRZEDPO',,0);

SER_POZ.cntx_psh();
SER_POZ.index(_ind_spoz);
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a.REF,'',);

{? ~_nast
|| SER_POZ.cntx_psh();
   SER_POZ.index(_ind_spoz);
   {? PAR_WYDR.PAR15 & ROZNE.UT_DOK
   || SER_POZ.prefix(REF.FIRMA,_a.REF,_a.ODD().OD,_a.WAL().KOD,_a.DATA,_a.SYM_ROK,_a.KON)
   || SER_POZ.prefix(REF.FIRMA,_a.REF,_a.ODD().OD,_a.WAL().KOD,_a.DATA,_a.SYM_ROK,_a.KON,0)
   ?};
   _nast:=(SER_POZ.size()>1);
   SER_POZ.cntx_pop()
?};
{? _nast & {? SER_POZ.next()
           || _a.SYM_ROK<>dokument | _a.TERM<>tp | _a.KON<>kontosp | _a.ODD().OD<>_a.ODD().OD
           || 1
           ?}
|| _ret:='RAZEM'
|? ~_nast
|| ''
?};

SER_POZ.cntx_pop();

_ret


\ser_poz_pozdozap
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca wartość pozostało do zapłaty
::   WE: _a - SERPOZ
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
form(_a.POZDOZAP,,2,' ,')


\real2str
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AJ [2008]
:: OPIS: zamienia wartosc numeryczna na postac znakowa z kropka oddzielajaca postac dziesietna
::   WE: _a - wartosc numeryczna
::   WY: string
::  OLD: \real2str/fis_drukarka.fml
::----------------------------------------------------------------------------------------------------------------------
_wart:=$_a;
_pos:=_wart*',';
{? _pos
|| _wynik:=(_pos-1)+_wart;
   _wynik+='.';
   _wynik+=_pos-_wart
|| _wynik:=_wart
?};
_wynik


\ser_nag_ureg_zap
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [23.25]
:: OPIS: Formuła zwracająca informacje o sposobie zapłaty
::   WE: _a - SER_NAG.ref()
::   WY: sformatowana wartość
::----------------------------------------------------------------------------------------------------------------------
_suma3:=0;
_suma4:=0;

SER_POZ.cntx_psh();
SER_POZ.index('SER_POZO');
SER_POZ.prefix(exec('ref_firma','ustawienia'),_a,);
{? SER_POZ.first()
|| {!
   |? _suma3+=F.SWn(SER_POZ.DNASZ$2,SER_POZ.DWASZ$2);
      _suma4+=F.SMa(SER_POZ.DNASZ$2,SER_POZ.DWASZ$2);
      SER_POZ.next()
   !}
?};
SER_POZ.cntx_pop();

{? F.SWn(_suma3,_suma4)>0
|| _kontoBank:='';
   SKID_RBK.index('WEKTOR');
   RACHBANK.KB_1R:=RB.get_rbel(2,RACHBANK.KB_1R);
   {? RACHBANK.KB_1R<>'' & SKID_RBK.find_key(REF.INFO,RACHBANK.KB_1R,RACHBANK.KB_1R)
   || _kontoBank:=RB.get_rbtx(1,SKID_RBK.ref(),SKID_RBK.KRAJ().KODISO)
   ?};
   {? _kontoBank='' || _kontoBank:=exec('get_rb','rozrach_kor') ?};
   'Prosimy o uregulowanie w/w należności. Przelew do: '+
   SKID_RBK.BANK().NB+{? SKID_RBK.BANK().KODISO<>XINFO.KRAJ || ', SWIFT (BIC): '+
   SKID_RBK.BANK().SWIFT || '' ?}+' Na konto: '+_kontoBank
|| ''
?}

:Sign Version 2.0 jowisz:1048 2023/06/23 14:14:39 b18e0b64401e9072aaaea78c5eb52a93764fd9a719a520a5f52cb47ae27e004d42992f7c058b7a9e439bcb9d69de2caf47de4a8fa972f1c2acf7fcdada614f740624c69e972f359811cb1f7485c24bad0ac486f623841a91536a40648c526a820d77d32704eb8aa80c3cc4218750852a49a68e16fc886a48abdadc44521af3ee
