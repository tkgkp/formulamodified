:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: wt_tree.fml
:: Utworzony: 27.09.2017
:: Autor: RWR
::======================================================================================================================
:: Zawartość: Formuły do obsługi uniwersalnej struktury hierarchicznej i uniwersalnego słownika - tabeli WT_TREE.
::            Plik zawiera jedynie część wspólną (uniwersalną) formuł. Formuły związane z konkretnym zastosowaniem
::            są umieszczone w plikach danego rozwiązania.
::            Jedynym wyjątkiem jest formuła wyzwalacza "Usuń - przed", która może (i powinna) zawierać instrukcje
::            usuwające rekordy powiązane.
::======================================================================================================================


\wt_tree_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Wyzwalacz "Dołącz - przed" dla tabeli WT_TREE.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('wt_tree_modb','wt_tree')


\wt_tree_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Wyzwalacz "Popraw - przed" dla tabeli WT_TREE.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('wt_tree_modb','wt_tree')


\wt_tree_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Wyzwalacz "Usuń - przed" dla tabeli WT_TREE.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',WT_ZOS,'NI',WT_TREE.ref())


\wt_tree_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Przed modyfikacją rekordu.
::       Formuła wywoływana z wyzwalaczy "Dołącz - przed" i "Popraw - przed" dla tabeli WT_TREE.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? WT_TREE.KEY=''
|| WT_TREE.KEY:=WT_TREE.NAME
?};
1


\clean
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Kasowanie danych w tabeli WT_TREE.
::   WE: _a [INTEGER] - Moment wywołania:
::                      1 - Start TOMCATA - kasowane są wszystkie rekordy związane z identyfikatorem serwera.
::                      2 - Zakończenie sesji webTerma - kasowane są tylko rekordy związane z daną sesją.
::                      3 - Zamknięcie zakładki - kasowane są tylko rekordy związane z daną zakładką.
::       [_b] [STRING]  - Identyfikator zestawu danych (parametr ma znaczenie wyłącznie dla _a=3).
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')=type_of(0) & (0<_a & _a<4)
|| _tryb:=_a
|| return(0)
?};

WT_TREE.cntx_psh();
WT_TREE.index('KEY');
{? _tryb=1
|| WT_TREE.prefix(app_info('web_tcid'),)
|? _tryb=2
|| WT_TREE.prefix(app_info('web_tcid'),app_info('web_sesid'),)
|? _tryb=3
|| {? var_pres('_b')=type_of('')
   || WT_TREE.prefix(app_info('web_tcid'),app_info('web_sesid'),app_info('web_tabid'),_b,)
   || WT_TREE.prefix(app_info('web_tcid'),app_info('web_sesid'),app_info('web_tabid'),)
   ?}
?};
{? WT_TREE.first()
|| _del:=
      "  _del:=_a;
         WT_TREE.cntx_psh();
         WT_TREE.prefix(WT_TREE.TCID,WT_TREE.SESID,WT_TREE.TABID,WT_TREE.SETID,#WT_TREE.ref());
         {? WT_TREE.first()
         || {!
            |? _del(_del)
            !}
         ?};
         WT_TREE.cntx_pop();
         WT_TREE.del()
      ";
   {!
   |? _del(_del)
   !}
?};
_ret:=~WT_TREE.first();
WT_TREE.cntx_pop();
_ret


\wt_tree_wyb1f_wybierz_a
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [18.02]
:: OPIS: Obsługa akcji "Wybierz" z okna WYB1F tabeli WT_TREE.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
params_set(_par:=web_params_get());
{? obj_ntab(_par) & var_pres('WT_TREE_WYB1F_WYBIERZ_A',_par)=type_of("")
|| _par.WT_TREE_WYB1F_WYBIERZ_A()
|| FUN.emsg('Błąd parametryzacji - brak parametru %1.'@ ['WT_TREE_WYB1F_WYBIERZ_A'])
?};
~~

:Sign Version 2.0 jowisz:1028 2019/06/07 16:00:04 9f1b4c99a9d19146a329c50e6bef2e22f25825c47816ad94d719fccfdea167f3760239c81308f61ce29e3cf8509f5bc8071f561f42180a087097ff90155c1d4296abbf984b14fc0b9f7364849f8d01b36e17d730f78fdd4b6f7c509039edac8b8b55f7714932e2c3bc55df95203db83e449ce04610a693c46e5406522164c657
