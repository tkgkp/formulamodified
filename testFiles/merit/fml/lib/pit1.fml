:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: pit1.fml
:: Utworzony: 16.02.2022
:: Autor: DAROKR
:: Systemy:
::======================================================================================================================
:: Zawartosc: Funkcje do obslugi obliczen deklaracji podatkowych od 2022
::======================================================================================================================


\init_pit11p_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dla akcji Dolacz okna deklaracji PIT-11 dla pracownika lub zleceniobiorcy
::       dla 13 wersji e-deklaracji obowiazujacej od 1.1.2022 roku dotyczy przychodow od 1.1.2022 roku
::       (wymagana zmienna globalna __Rok-rok za ktory tworzona jest e-deklaracja)
::   WE: _a - string typ deklaracji PIT11P
::       _b - string T lub N czy tworzyc deklaracje jezeli podatnik ma juz
::       _c - string T lub N czy tworzyc deklaracje zbiorcza dla podatnika
::       _d - string T lub N czy sumowac umowy zlecenia sprzed zatrudnienia
::       _e - string T lub N czy dolaczono informacje PIT-R
::       _f - string T korekta lub N zlozenie deklaracji
::       _g - string T lub N przetwarzanie danych osobowych lub nie
::       _h - data przekazania danych osobowych
::       _i - string T lub N czy umozliwiac zmiane informacji o kosztach uzyskania
::       _j - numer wersji e-deklaracji pole VAT_DEK.NR().NR lub PIT_GRUP.NR().NR
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_j')<>type_of(0) || _j:=13 ?};
VAR_DEL.delete('pit','__PIT','__WER','__wk','__transl','us_podat','__par','__NdPOD','__P_107');
pit:=obj_new(114);
{! _nx:=1..27 |! pit[_nx]:='' !};
{! _nx:=28..obj_len(pit) |! pit[_nx]:=0 !};
::Tablica do określenia rodzaju zwolnionego przychodu wykazanego w poz 104 od 2022 roku
__P_107:=obj_new('PKT_152','PKT_153','PKT_154');
__P_107.PKT_152:=__P_107.PKT_153:=__P_107.PKT_154:='N';
_pom:=pit[3]:=obj_new(11);
_pom[2]:={? _a='PIT11P' || 'P' || 'Z' ?};
_pom[1]:=__Rok;

::tabela do zapisu w wydrukowanych deklaracjach
__par:=tab_tmp(2,'RODZAJ','STRING[1]','Rodzaj','REF','INTEGER','Ref','DEKL_REF','INTEGER','Ref DEKL_POD');

::czy wydruk dla podatnika?
_pom[4]:={? _pom[3]:=(_c='T')
         || tab_tmp(1,'OSOBA','INTEGER','Podatnik')
         || ~~
         ?};
::czy sumowac umowy zlecenie sprzed zatrudnienia'
{? _pom[3] & _pom[2]='P'
|| _pom[10]:=(_d='T')
|| _pom[10]:=0
?};
::czy przychody pochodza z wiecej niz jednego stosunku pracy
_pom[5]:=0;
::czy umozliwiac zmiane informacji o kosztach uzyskania?
_pom[6]:=_i;
::czy rejestrowac przekazanie danych osobowych?
{? _g='T'
|| _pom[9]:=_h
|| _pom[9]:=date(0,0,0)
?};

exec('czytaj','#stalesys',date(__Rok,12,0),KST);

::wysokosc kosztow uzyskania
_pom[7]:=KST.KU;
_pom[8]:=(_b='T');

pit[7]:=_f;

pit[108]:=_e;

KP.cntx_psh(); KP.index('_KARTAPO');
RH.cntx_psh(); RH.index('RACHDATA');
O.cntx_psh(); O.index('LISTYPLP');
KT.cntx_psh();
LS.cntx_psh();
O_P.cntx_psh();
us_podat:=null();
DEKL_POD.cntx_psh();
DEKL_POD.use('pod_'+$_pom[1]);
DEKL_POD.index('DEKL_PED');
ZC_N.cntx_psh();
ZC_N.index('ZC_H');
ZC.cntx_psh();
{? var_pres('ZC_INFO')>0
|| ZC_INFO.cntx_psh()
?};

__wk:=obj_new(12);
{! _nx:=1..obj_len(__wk)
|! __wk[_nx]:=obj_new(7);
   {! _ny:=1..obj_len(__wk[_nx])
   |! __wk[_nx][_ny]:=0
   !}
!};
::Wiersze ,3,4,5,7,8,10 poprzednio
::Wiersze ,4,5,6,9,10,12
::wiersz 7 dodany dla wykazania ZP dla umowy cywilnoprawnej w parametryzacji wykazywania w PIT-11
::wiersz 11 dodany dla wykazania ZP dla umowy cywilnoprawnej w parametryzacji wykazywania w PIT-11
::Należności z tytułu wymienionego w wierszu 10, otrzymane przez podatników do ukończenia 26 roku życia
::Zmiany 2022
::wiersz 8 dodany dla wykazania emerytura/renta dla umowy cywilnoprawnej w parametryzacji wykazywania w PIT-11
__transl:="{? RU_DEKL.DEKL().NR=__WER
           || __wk[1][2]:=29;  __wk[1][3]:=30; __wk[1][4]:=31;  __wk[1][5]:=32;  __wk[1][6]:=33;
              __wk[4][2]:=50;  __wk[4][3]:=0;  __wk[4][4]:=51;  __wk[4][5]:=52;  __wk[4][6]:=53;
              __wk[5][2]:=54;  __wk[5][3]:=55; __wk[5][4]:=56;  __wk[5][5]:=0;   __wk[5][6]:=57;
              __wk[6][2]:=58;  __wk[6][3]:=59; __wk[6][4]:=60;  __wk[6][5]:=0;   __wk[6][6]:=61;
              __wk[7][2]:=62;  __wk[7][3]:=63; __wk[7][4]:=64;  __wk[7][5]:=0;   __wk[7][6]:=65;
              __wk[8][2]:=66;  __wk[8][3]:=67; __wk[8][4]:=68;  __wk[8][5]:=0;   __wk[8][6]:=69;
              __wk[9][2]:=70;  __wk[9][3]:=74; __wk[9][4]:=71;  __wk[9][5]:=0;   __wk[9][6]:=72; __wk[9][7]:=73;
              __wk[10][2]:=75; __wk[10][3]:=0; __wk[10][4]:=76; __wk[10][5]:=0;  __wk[10][6]:=77;
              __wk[11][2]:=78; __wk[11][3]:=0; __wk[11][4]:=79; __wk[11][5]:=0;  __wk[11][6]:=80;
              __wk[12][2]:=81; __wk[12][3]:=82;__wk[12][4]:=83; __wk[12][5]:=84; __wk[12][6]:=85;
              RU_DEKL.WIERSZ
           || 0
           ?}
           ";
__PIT:='PIT11';
__WER:=_j;
::tabela pomocnicza dla wykrywania pokrywajacych sie okresow zatrudnienia
_pom[11]:=tab_tmp(2,'OD','DATE',,'DO','DATE',);
{? var_pres('PPK_POD')>0
|| __NdPOD:=PPK_POD.ndx_tmp('PPK_POD_OS',0,'POD_RH',,0,'OSOBA',,0,'POD_LICZ',,0,'POD_R',,0)
|| __NdPOD:=''
?}


\end_pit11p_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula zwiazana z formula \init_pit11p_13 usuwa utworzone zmienne i przywraca konteksty tabel
::----------------------------------------------------------------------------------------------------------------------
undefine();
ZC.cntx_pop();
ZC_N.cntx_pop();
DEKL_POD.cntx_pop();
RH.cntx_pop();
KP.cntx_pop();
O.cntx_pop();
KT.cntx_pop();
LS.cntx_pop();
O_P.cntx_pop();
{? var_pres('ZC_INFO')>0
|| ZC_INFO.cntx_pop()
?};
{? var_pres('PPK_POD')>0
|| PPK_POD.ndx_drop(__NdPOD)
?};
VAR_DEL.delete('pit','__PIT','__WER','__wk','__transl','us_podat','__par','__NdPOD','__P_107');
exec('stalesys','#stalesys')


\obl_pit11p_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula wylicza dane do deklaracji PIT-11 z systemu dla 13 wersji ale dotyczy przychodow od 1.1.2022 roku
::       UWAGA: Procedura korzysta z numerow rubryk!
::   WE: _a - 1 - jesli jest prawidlowy symbol i wymagane dane do utworzenia deklaracji
::       _b - numer wersji e-deklaracji pole VAT_DEK.NR().NR lub PIT_GRUP.NR().NR
::       _c - 1 - ustawienie pracownika zatrudnionego przy sumowaniu zbiorczym
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 1 ?};
_b:={? var_pres('_b')>0 & type_of(_b)=type_of(0) || _b || 13 ?};
_c:={? var_pres('_c')>0 & type_of(_c)=type_of(0) || _c || 0 ?};
_prac_up:={? var_pres('_d')>100 || _d || null() ?};
_wynik:=0;
_pom:=pit[3];
us_podat:=null;
__par.erase;
::Tablica do określenia rodzaju zwolnionego przychodu wykazanego w poz 104 od 2022 roku
__P_107.PKT_152:=__P_107.PKT_153:=__P_107.PKT_154:='N';

:: sprawdzenie czy ze wzgledu na date urodzin dla osob mlodych nalezy ustalac na podstawie list plac/rachunkow
_ur_data:=P.OSOBA().UR_DATA;
{? _ur_data<>date(0,0,0)
|| _po_list:={? exec('kiedy_26ur','pit',_ur_data)<=date(_pom[1]-1,12,0) || 0 || 1 ?};
   _26ur:=exec('kiedy_26ur','pit',_ur_data);
:: Ustalenienie wieku emeryta 60 lat kobieta lub 65 mężczyzna
   _em_data:=exec('kiedy_emeryt','pit1',_ur_data,OSOBA.PLEC)
|| _26ur:=date(0,0,0);
   _po_list:=0;
   _em_data:=date(0,0,0)
?};

::wyczysc rubryki formularza wlasciwe dla podatnika
{! _nx:=11..27 |! pit[_nx]:='' !};
{! _nx:=28..obj_len(pit) |! pit[_nx]:=0 !};
pit[18]:=date(0,0,0);
pit[19]:=null;
pit[90]:=pit[92]:=pit[94]:='';
::Zmienna określająca czy mamy sumę przychodów i wystawiamy PIT-11 -> pit[113]
::Ustalenie rodzaju Podatnika zmienna pit[114]

::Tablica do wyliczania zasilkow od umow-zlecen
_zasilek:=obj_new(5);
{! _nx:=1..obj_len(_zasilek) |! _zasilek[_nx]:=0 !};

_jest_pit:=_jestwyd:=0;
VAT_DEK.cntx_psh();
VAT_DEK.index('VAT_PRAC');
VAT_DEK.prefix(P.ref(),rodzdekl,rok_dekp,okres,pit_typ);
{? VAT_DEK.last() || _jest_pit:=1 ?};
VAT_DEK.cntx_pop();
::sprawdzenie czy byla drukowana deklaracja poprzez wydruk bez e-deklaracji
{? ~_jest_pit
|| {? _pom[2]='P'
   || DEKL_POD.prefix('E',P.ref(),'(E)PIT-11','(E)PIT-11')
   || DEKL_POD.prefix('Z',P.ref(),'(E)PIT-11','(E)PIT-11')
   ?};
   {? DEKL_POD.first()
   || _jest_pit:=1
   ?}
?};
{? ~_jest_pit
|| {? _pom[2]='P'
   || DEKL_POD.prefix('E',P.ref(),'PIT-11','PIT-11')
   || DEKL_POD.prefix('Z',P.ref(),'PIT-11','PIT-11')
   ?};
   {? DEKL_POD.first()
   || _jest_pit:=_jestwyd:=1
   ?}
?};
{? ~_pom[8] & _jest_pit
|| {? _jestwyd || return(-2) || return(-1) ?}
?};

{? _pom[3]
|| {? _pom[2]='P'
   || {? ~_c
      || KP.cntx_psh();
         KP.prefix();
         {? ~KP.find_key(P.ref(),_pom[1])
         ||
::          sprawdzenie czy jest nierozliczony przychód z PPK w danym roku podatkowym
            _czy_ppk:=1;
            {? var_pres('PPK_POD')>0
            || PPK_POD.index('POD_O');
               PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
               {? PPK_POD.first()
               || _czy_ppk:=0
               ?}
            ?};
            {? ~(P.DZA~1<=_pom[1] & (P.DZ~1=0 | P.DZ~1>=_pom[1])) & _czy_ppk
            || KP.cntx_pop();
               return(0)
            || _wyn:=exec('spr_oso','pit',_jest_pit,_pom[8]);
               {? _wyn<0
               || KP.cntx_pop();
                  return(_wyn)
               ?}
            ?}
         ?};
         KP.cntx_pop()
      || P.cntx_psh();
         P.index('PRACOSOB');
         P.prefix(exec('ref_firma','ustawienia'),'P',P.OSOBA);
         {? P.first
         || _jest_P:=0;
            {!
            |? {? P.ZA='T' & P.DZA~1<=_pom[1] & (P.DZ~1=0 | P.DZ~1>=_pom[1])
               || {? var_pres('P',_prac_up)>100 & var_pres('Ndx',_prac_up)=type_of('')
                  || _prac_up.P.cntx_psh();
                     _prac_up.P.index(_prac_up.Ndx);
                     _prac_up.P.prefix();
                     {? _prac_up.P.find_key(#P.ref)
                     || _jest_P:=1
                     ?};
                     _prac_up.P.cntx_pop()
                  || _jest_P:=1
                  ?}
               ?};
               P.next & ~_jest_P
            !};
            P.cntx_pop();
            {? _jest_P & P.ZA<>'T'
            || return(0)
            || KP.cntx_psh();
               KP.prefix();
               {? ~KP.find_key(P.ref(),_pom[1])
               ||
::                sprawdzenie czy jest nierozliczony przychód z PPK w danym roku podatkowym
                  _czy_ppk:=1;
                  {? var_pres('PPK_POD')>0
                  || PPK_POD.index('POD_O');
                     PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
                     {? PPK_POD.first()
                     || _czy_ppk:=0
                     ?}
                  ?};
                  {? ~(P.DZA~1<=_pom[1] & (P.DZ~1=0 | P.DZ~1>=_pom[1])) & _czy_ppk
                  || KP.cntx_pop();
                     return(0)
                  || _wyn:=exec('spr_oso','pit',_jest_pit,_pom[8]);
                     {? _wyn<0
                     || KP.cntx_pop();
                        return(_wyn)
                     ?}
                  ?}
               ?};
               KP.cntx_pop()
            ?}
         || P.cntx_pop()
         ?}
      ?}
   || RH.index('RACHPRZ');
      RH.prefix();
      {? ~RH.find_key(P.ref,_pom[1])
      || RH.index('RACHDATA');
::       sprawdzenie czy jest nierozliczony przychód z PPK w danym roku podatkowym
         _czy_ppk:=1;
         {? var_pres('PPK_POD')>0
         || PPK_POD.index('POD_RH');
            PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
            {? PPK_POD.first()
            || _czy_ppk:=0
            ?}
         ?};
         {? _czy_ppk || return(0) ?}
      ||
::       sprawdzenie czy sa rachunki nie sa to tylko rachunki ryczałtowe w danym roku podatkowycm
::       KOD BŁĘDU: ER/WRT/XP/12.51/1802/0001 KOD ZGŁOSZENIA: NL/WRT/KALI/12.30/0741
::       Wiele deklaracji PIT-11 dla zleceniobiorcy w kilku jednostkach org. (w jednej jednostce tylko z rachunkiem
::       ryczaltowym w roku podatkowym)
         RH.prefix(P.ref(),_pom[1]);
         {? RH.first()
         || _rach:=RH.size();
            _rycz:=0;
            {!
            |? {? exec('licz_rhs','lista_licz',31) & (~exec('czy_prac','osoba',P.OSOBA,RH.DWY))
               || _rycz+=1
               ?};
               RH.next()
            !};
            RH.prefix();
::          jesli wszystkie rachunki sa ryczaltowe to nie bedzie robiony PIT-11
            {? _rach=_rycz
            || RH.index('RACHDATA');
               return(0)
            ?};
            &_rach; &_rycz
         ?}
      ?};
      RH.index('RACHDATA')
   ?}
?};

::jezeli informacja drukowana jest dla podatnika (osoby), to nie drukuj
::zwielokrotnionych informacji - kolejne wystapienia w kartotekach
{? _pom[3]
|| {? ~_pom[4].find_key(#P.OSOBA)
   || _pom[4].OSOBA:=#P.OSOBA;
      _pom[4].add
   || return(_wynik)
   ?}
?};
::data do ustalenia danych identyfikacyjnych osoby zagranicznej oraz znacznika "nierezydent"
_Zagrdat:=date(0,0,0);
_pom[5]:=0;
_liczmies:=0;
:: sprawdzenie czy sa przychody-karty podatkowe z etatu-wykonane tylko dla warunku _pom[2]='P'
_spr_et:=0;
:: kwota zasiłków z etatu
_et_zas:=0;
:: kwota podatku od zasiłku z etatu
_pd_zas:=0;
:: kwota zasiłków z etatu poniżej 26 roku życia
_et_zs26:=0;
:: kwota podatku od zasiłku z etatu poniżej 26 roku życia
_pd_zs26:=0;
:: kwota zasiłków z etatu powyżej wieku emerytalnego
_et_zsEM:=0;
:: kwota podatku od zasiłku z etatu powyżej wieku emerytalnego
_pd_zsEM:=0;
:: określenie limitu ZP jeżeli w stałych systemu mamy pole KST.ZWPOD
{? var_pres('ZWPOD',KST)>0
|| _lim_ZP:=KST.ZWPOD
|| _lim_ZP:=85528
?};
:: Limit odliczenia od dochodu składek członkowskich KST.LIM_SKZW od stycznia 2022 roku 300zł
{? var_pres('LIM_SKZW',KST)>0
|| _lim_skz:=KST.LIM_SKZW
|| _lim_skz:=300
?};
:: Tablice do rodzajów zwolnionego przychodu do 26 lat oraz w 2022 roku art. 21 pkt 152-154
:: analiza atrybutów z linii 901 w Merit 902 do zmiany
_zp_atr:=obj_new('ZP_BZ_26','ZP_BZ_152','ZP_BZ_153','ZP_BZ_154','ZP_ZP','ZP_SKL');
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 148
_zp_atr.ZP_BZ_26:=9021;
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 152
_zp_atr.ZP_BZ_152:=9028;
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 153
_zp_atr.ZP_BZ_153:=9029;
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 154
_zp_atr.ZP_BZ_154:=90201;
:: ZP: przychód podlegający zwolnieniu
_zp_atr.ZP_ZP:=9022;
:: ZP: składki społeczne od zwolnionego przychodu
_zp_atr.ZP_SKL:=9026;

::uwzgledniaj przychody ze stosunku pracy
{? _pom[2]='P'
|| P.cntx_psh();
::informacja dla podatnika
   {? _pom[3]
   || P.index('PRACOSOB');
      P.prefix(exec('ref_firma','ustawienia'),'P',P.OSOBA);
      P.first();
      _pom[11].erase()
   ?};
   {!
   |? KP.prefix(P.ref(),_pom[1]);
      {? KP.first()
      || {? ~__par.find_key('E',#P.ref())
         || __par.blank(); __par.RODZAJ:='E'; __par.REF:=#P.ref(); __par.add(1)
         ?};
         _od:=date(_pom[1],KP.M,1);
         {!
         |? {? ~_po_list
            || O_P.index('P_RMP');
               O_P.prefix('T',P.ref(),KP.R,KP.M);
               {? O_P.first()
               || {!
                  |? O_P.O().LT;
::                   Ustawienie bufora tabeli O dla poprawnego działania innych funkcji
::                   Wyliczenie elementów wspólnych dla obydwu warunków
::                   Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                   nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                   sumuje również rubryka 7124 Skl. ZUS opod. zag.
                     _zw_skl:=exec('licza_ls','pit',582);
::                   Składki społeczne wyliczane ponieważ doliczamy do przychodu
                     _skl:=exec('licza_ls','pit',5711,5721);
::                   Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
                     _skl-=exec('licz_ls','pit',951);
::                   Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                     _skl_zagr:=exec('licza_ls','pit',9015);
::                   Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                     _odd_zagr:=exec('licza_ls','pit',9011)+exec('licza_ls','pit',9012)+exec('licza_ls','pit',9013);
::                   Przychód prawa autorskie atrybutu pobieramy wg rubryki 7002
                     _prz_50:=exec('licz_ls','pit',7002);
::                   Koszty uzyskania prawa autorskie brak atrybutu pobieramy wg rubryki 7004
                     _koszt50:=exec('licz_ls','pit',7004);
::                   Składki od zwolnionego przychodu
                     _zp_skl:=exec('licza_ls','pit',_zp_atr.ZP_SKL);
::                   Przychód
                     _przych:=exec('licza_ls','pit',92)+_skl-_zp_skl-_prz_50-_zw_skl-_odd_zagr-_skl_zagr;
::                   Koszty od przychodu
                     _koszt:=exec('licza_ls','pit',931);
::                   Podatek z listy
                     _pd_list:=exec('licza_ls','pit',961);
                     {? O.D>_em_data
                     ||
::                      Przychód wiersz 3. Wyliczenie danych do 3 wiersza od 2022 roku dla emeryta
::                      kobieta 60 lat lub mężczyzna 65 lat.
::                      Przychód uzyskany po ukończeniu wieku emerytalnego, trafia do wiersza 3 z wyjątkiem
::                      przychodu, który nie podlega zwolnieniu (atrybut 9011),
::                      ten trafia do wiersza 1 poza zasiłkami rubryka 650
                        _zs_lis:=0;
                        _pd_zsls:=0;
                        _pd_zwol:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
                        {? _kod_zwol<>''
                        || _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ||
::                         ZP: brak zwolnienia przychodu art.21 ust.1 pkt 154 bez oświadczenia
                           _bez_rodz:=_zp_atr.ZP_BZ_154
                        ?};
                        _bez_zwol:=exec('licza_ls','pit',_bez_rodz);
                        {? _bez_zwol
                        ||
::                         kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
                           _przych-=_bez_zwol;
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania składników w "Inne źródła"
::                         jest składową atrybutu 9011 odejmujemy rubryki 7018, 7071,
::                         które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           || _et_zsEM+=_zs_lis;
::                            Jeżeli kwota z zasiłku jest pełną kwotą atrybutu 9011
                              {? _zs_lis=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu 9011
                                 _pd_zsEM+=_pd_zwol;
                                 _pd_zsls:=_pd_zwol
                              ||
::                               Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy inne składniki
::                               w atrybucie 9011
                                 {? _zs_lis>0 || _pd_zsls:=_zs_lis$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie
::                               czy nie jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu dla emeryta
                                 _pd_zsEM+=_pd_zsls
                              ?}
                           ?}
                        ?};
::                      Przychód z etatu wiersz 1
                        pit[29]+=(_bez_zwol-_zs_lis);
::                      Podatek z etatu wiersz 1 dla kwot, które nie podlegają zwolnieniu bez zasiłku
                        pit[33]+=(_pd_zwol-_pd_zsls);
::                      Zwolnione przychody od 2022 dla emeryta z etatu w wierszu 3 bez oświadczenia
::                      Przychód wiersz 3
                        pit[43]+=_przych;
::                      Koszty uzyskania wiersz 3
                        {? _przych
                        || pit[44]+=_koszt
                        || pit[30]+=_koszt
                        ?};
::                      Przychód prawa autorskie wiersz 3 brak atrybutu pobieramy wg rubryki 7002
                        pit[48]+=_prz_50;
::                      Zaliczka podatkowa wiersz 3
                        {? _zs_lis=_bez_zwol | _pd_zsls=_pd_zwol
                        || _kw_pod:=_pd_list-_pd_zsls
                        || {? _pd_list=_pd_zwol
                           || _kw_pod:=0
                           || _kw_pod:=_pd_list-_pd_zwol-_pd_zsls
                           ?}
                        ?};
                        pit[47]+=_kw_pod;
::                      Koszty uzyskania prawa autorskie wiersz 3 brak atrybutu pobieramy wg rubryki 7004
                        pit[49]+=_koszt50;
::                      Składki społeczne do wiersza 3
                        pit[87]+=(_skl-_zp_skl-_zw_skl);
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
                        {? _kod_zwol<>''
                        || {? _kod_zwol='ZWPOD'
                           || pit[101]+=exec('licza_ls','pit',_zp_atr.ZP_ZP)
                           || pit[105]+=exec('licza_ls','pit',_zp_atr.ZP_ZP)
                           ?}
                        ?}
                     ||
::                      Przychód wiersz 1
::                      Pobranie danych dla pracowników, którzy na koniec poprzedniego roku ukończyli 26 lat
::                      oraz nie ukończyli wieku emerytalnego 60 lat kobieta oraz 65 mężczyzna
::                      Zasiłki chorobowe obecnie wykazujemy w wierszu 12 Inne źródła, natomiast podatek od zasiłku
::                      w wierszu 12, gdy nie ma przychodów z etatu lub łącznie wierszu 1, gdy mamy łączne przychody
::                      z etatu i zasiłków. Zwolniony przychód uzyskany z art 152-154,
::                      sprawdzenie czy mamy zasiłki ZUS, które nie podlegają zwolnieniu z odpowiednich atrybutów,
::                      pozostałe składniki, które nie podlegają ZP art 152-154, te trafią do wiersza 1
::                      poza zasiłkami ZUS.
                        _zs_lis:=0;
                        _pd_zsls:=0;
                        _pd_zwol:=0;
                        _bez_zwol:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
                        _bez_rodz:=0;
                        {? _kod_zwol<>''
                        || _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ?};
                        {? _bez_rodz<>0 & (_bez_zwol:=exec('licza_ls','pit',_bez_rodz); _bez_zwol<>0)
                        ||
::                         kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania
::                         składników w "Inne źródła" jest składową z odpowiedniego atrybutu np. 9011
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           || _et_zas+=_zs_lis;
::                            Jeżeli kwota z zasiłku jest pełną kwotą atrybutu np. 9011
                              {? _zs_lis=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu np. 9011
                                 _pd_zas+=_pd_zwol
                              ||
::                               Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy inne składniki
::                               w tym atrybucie
                                 {? _zs_lis>0 || _pd_zsls:=_zs_lis$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie
::                               czy nie jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu
                                 _pd_zas+=_pd_zsls
                              ?}
                           ?}
                        ||
::                         Kwota zasiłków z etatu składnik 650 do wykazywania składników w "Inne źródła"
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-exec('licz_ls','pit',7018)$2;
                           _zs_lis-=exec('licz_ls','pit',7071)$2;
                           {? _zs_lis
                           || _et_zas+=_zs_lis;
::                            Podatek od kwot zasiłku ulga podatkowa nie jest pobrana do wyliczeń
::                            Procent podatku z listy
                              _pr_pod:=exec('licza_ls','pit',91);
                              {? _zs_lis>0 || _pd_zsls:=_zs_lis$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                            Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie jest wyższy
::                            od całkowitego podatku z listy. Jeżeli większy to ograniczamy do kwoty podatku
::                            z listy płac
                              {? _pd_zsls>_pd_list || _pd_zsls:=_pd_list ?};
::                            Łączna kwota podatku od zasiłku z etatu
                              _pd_zas+=_pd_zsls
                           ?}
                        ?};
::                      Przychód wiersz 1 z etatu
                        pit[29]+=_przych;
::                      Koszty uzyskania wiersz 1
                        pit[30]+=_koszt;
::                      Zaliczka podatkowa wiersz 1
                        pit[33]+=_pd_list;
::                      Przychód prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7002
                        pit[34]+=_prz_50;
::                      Koszty uzyskania prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7004
                        pit[35]+=_koszt50;
::                      Składki społeczne do wiersza 1
                        pit[86]+=(_skl-_zp_skl-_zw_skl);
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
                        {? _kod_zwol<>''
                        || {? _kod_zwol='ZWPOD'
                           || pit[101]+=exec('licza_ls','pit',_zp_atr.ZP_ZP)
                           || pit[105]+=exec('licza_ls','pit',_zp_atr.ZP_ZP)
                           ?}
                        ?}
                     ?};
::                   Składki społeczne do zwolniony przychód
                     pit[88]+=_zp_skl;
::                   Składki zdrowotne pobrane przez płatnika wykazane w poz. 109 od 2022 roku
                     pit[109]+=exec('licza_ls','pit',57411);
::                   Składki członkowskie w poz. 110 na rzecz związków zawodowych pobrane przez płatnika od 2022
::                   podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 300 zł rocznie
                     pit[110]+=exec('licza_ls','pit',1006);
                     O_P.next()
                  !}
               ?}
            || O_P.index('P_RMP');
               O_P.prefix('T',P.ref(),KP.R,KP.M);
               {? O_P.first()
               || {!
                  |? O_P.O().LT;
::                   Ustawienie bufora tabeli O dla poprawnego działania innych funkcji
                     {? O.D>_26ur
                     ||
::                      Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                      nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                      sumuje również rubryka 7124 Skl. ZUS opod. zag.
                        _zw_skl:=exec('licza_ls','pit',582);
                        _bez_zwol:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
                        _bez_rodz:=0;
                        {? _kod_zwol<>''
                        || _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ?};
                        {? _bez_rodz<>0 & (_bez_zwol:=exec('licza_ls','pit',_bez_rodz); _bez_zwol<>0)
                        ||
::                         Podatek z listy
                           _pd_list:=exec('licza_ls','pit',961);
::                         Kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
                           {? _bez_zwol<0 || _bez_zwol:=0 ?};
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
                           _przych:=_bez_zwol;
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania
::                         składników w "Inne źródła" jest składową z odpowiedniego atrybutu np. 9011
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           || _et_zas+=_zs_lis;
::                            Jeżeli kwota z zasiłku jest pełną kwotą atrybutu np. 9011
                              {? _zs_lis=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu np. 9011
                                 _pd_zas+=_pd_zwol
                              ||
::                                Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy inne składniki
::                                w tym atrybucie
                                 {? _zs_lis>0 || _pd_zsls:=_zs_lis$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie
::                               jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu
                                 _pd_zas+=_pd_zsls
                              ?}
                           ?}
                        ||
::                         Kwota zasiłków z etatu składnik 650 do wykazywania składników w "Inne źródła"
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-exec('licz_ls','pit',7018)$2;
                           _zs_lis-=exec('licz_ls','pit',7071)$2;
                           {? _zs_lis
                           || _et_zas+=_zs_lis;
::                            Podatek z listy
                              _pd_list:=exec('licza_ls','pit',961);
::                            Podatek od kwot zasiłku ulga podatkowa nie jest pobrana do wyliczeń
::                            Procent podatku z listy
                              _pr_pod:=exec('licza_ls','pit',91);
                              {? _zs_lis>0 || _pd_zsls:=_zs_lis$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                            Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie jest wyższy
::                            od całkowitego podatku z listy. Jeżeli większy to ograniczamy do kwoty podatku
::                            z listy płac
                              {? _pd_zsls>_pd_list || _pd_zsls:=_pd_list ?};
::                            Łączna kwota podatku od zasiłku z etatu
                              _pd_zas+=_pd_zsls
                           ?}
                        ?};
::                      Składki społeczne wyliczane ponieważ doliczamy do przychodu
                        _skl:=exec('licza_ls','pit',5711,5721);
::                      Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
                        _skl-=exec('licz_ls','pit',951);
::                      Składki od zwolnionego przychodu
                        _zp_skl:=exec('licza_ls','pit',_zp_atr.ZP_SKL);
::                      Przychód prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7002
                        _prz_50:=exec('licz_ls','pit',7002);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _skl_zagr:=exec('licza_ls','pit',9015);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _odd_zagr:=exec('licza_ls','pit',9011)+exec('licza_ls','pit',9012)+exec('licza_ls','pit',9013);
                        _przych:=exec('licza_ls','pit',92)+_skl-_zp_skl-_prz_50-_zw_skl-_odd_zagr-_skl_zagr;
::                      Przychód uzyskany po 26 urodzinach trafia do wiersza 1
::                      Przychód wiersz 1 z etatu
                        pit[29]+=_przych;
::                      Koszty uzyskania wiersz 1
                        pit[30]+=exec('licza_ls','pit',931);
::                      Zaliczka podatkowa wiersz 1
                        pit[33]+=exec('licza_ls','pit',961);
::                      Przychód prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7002
                        pit[34]+=_prz_50;
::                      Koszty uzyskania prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7004
                        pit[35]+=exec('licz_ls','pit',7004);
::                      Składki społeczne do wiersza 1
                        pit[86]+=(_skl-_zp_skl-_zw_skl);
::                      Składki społeczne do zwolniony przychód
                        pit[88]+=_zp_skl;
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
                        pit[105]+=exec('licza_ls','pit',_zp_atr.ZP_ZP);
::                      Składki zdrowotne pobrane przez płatnika wykazane w poz. 109 od 2022 roku
                        pit[109]+=exec('licza_ls','pit',57411);
::                      Składki członkowskie w poz. 110 na rzecz związków zawodowych pobrane przez płatnika od 2022
::                      podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 300 zł rocznie
                        pit[110]+=exec('licza_ls','pit',1006)

                     |? O.D<=_26ur
                     ||
::                      Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                      nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                      sumuje również rubryka 7124 Skl. ZUS opod. zag.
                        _zw_skl:=exec('licza_ls','pit',582);
::                      Składki społeczne wyliczane ponieważ doliczamy do przychodu
                        _skl:=exec('licza_ls','pit',5711,5721);
::                      Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
                        _skl-=exec('licz_ls','pit',951);
::                      Przychód prawa autorskie wiersz 2 brak atrybutu pobieramy wg rubryki 7002
                        _prz_50:=exec('licz_ls','pit',7002);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _skl_zagr:=exec('licza_ls','pit',9015);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _odd_zagr:=exec('licza_ls','pit',9011)+exec('licza_ls','pit',9012)+exec('licza_ls','pit',9013);
::                      składki od zwolnionego przychodu
                        _zp_skl:=exec('licza_ls','pit',_zp_atr.ZP_SKL);
                        _przych:=exec('licza_ls','pit',92)+_skl-_zp_skl-_prz_50-_zw_skl-_odd_zagr-_skl_zagr;
::                      Podatek z listy
                        _pd_list:=exec('licza_ls','pit',961);
::                      Przychód uzyskany przed ukończeniem 26 roku zycia, trafia do wiersza 2 z wyjątkiem przychodu
::                      który nie podlega zwolnieniu (atrybut 9011), ten trafia do wiersza 1
::                      poza zasiłkamu rubryka 650
                        _zs_lis:=0;
                        _pd_zsls:=0;
                        _pd_zwol:=0;
                        _bez_zwol:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
                        _bez_rodz:=0;
                        {? _kod_zwol<>''
                        || _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ||
::                         ZP: brak zwolnienia przychodu art.21 ust.1 pkt 148 rezygnacja z ZP <26 roku życia
                           _bez_rodz:=_zp_atr.ZP_BZ_26
                        ?};
                        _bez_zwol:=exec('licza_ls','pit',_bez_rodz);
                        {? _bez_zwol
                        ||
::                         kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
                           {? _bez_zwol<0 || _bez_zwol:=0 ?};
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
                           _przych-=_bez_zwol;
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania
::                         składników w "Inne źródła" jest składową atrybutu 9011
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           || _et_zs26+=_zs_lis;
::                            Jeżeli kwota z zasiłku jest pełną kwotą atrybutu 9011
                              {? _zs_lis=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu 9011
                                 _pd_zs26+=_pd_zwol;
                                 _pd_zsls:=_pd_zwol
                              ||
::                               Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy
::                               inne składniki w atrybucie 9011
                                 {? _zs_lis>0 || _pd_zsls:=_zs_lis$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie
::                               czy nie jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu poniżej 26 roku życia
                                 _pd_zs26+=_pd_zsls
                              ?}
                           ?}
                        ?};

::                      Przychód z etatu wiersz 1
                        pit[29]+=(_bez_zwol-_zs_lis);
::                      Podatek z etatu wiersz 1 dla kwot, które nie podlegają zwolnieniu bez zasiłku
                        pit[33]+=(_pd_zwol-_pd_zsls);
::                      Zwolnione przychody od 1.08.2019 z etatu w wierszu 2
::                      Przychód wiersz 2
                        pit[36]+=_przych;
::                      Koszty uzyskania wiersz 2
                        {? _przych
                        || pit[37]+=exec('licza_ls','pit',931)
                        || pit[30]+=exec('licza_ls','pit',931)
                        ?};
::                      Przychód prawa autorskie wiersz 2 brak atrybutu pobieramy wg rubryki 7002
                        pit[41]+=_prz_50;
::                      Zaliczka podatkowa wiersz 2
                        {? _zs_lis=_bez_zwol | _pd_zsls=_pd_zwol
                        || _kw_pod:=_pd_list-_pd_zsls
                        || {? _pd_list=_pd_zwol
                           || _kw_pod:=0
                           || _kw_pod:=_pd_list-_pd_zwol-_pd_zsls
                           ?}
                        ?};
                        pit[40]+=_kw_pod;
::                      Koszty uzyskania prawa autorskie wiersz 2 brak atrybutu pobieramy wg rubryki 7004
                        pit[42]+=exec('licz_ls','pit',7004);
::                      Składki społeczne do wiersza 2
                        pit[87]+=(_skl-_zp_skl-_zw_skl);
::                      Składki społeczne do zwolniony przychód
                        pit[88]+=_zp_skl;
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
                        {? _kod_zwol='ZWPOD'
                        || pit[101]+=exec('licza_ls','pit',_zp_atr.ZP_ZP)
                        || pit[105]+=exec('licza_ls','pit',_zp_atr.ZP_ZP)
                        ?};
::                      Składki zdrowotne pobrane przez płatnika wykazane w poz. 109 od 2022 roku
                        pit[109]+=exec('licza_ls','pit',57411);
::                      Składki członkowskie w poz. 110 na rzecz związków zawodowych pobrane przez płatnika od 2022
::                      podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 300 zł rocznie
                        pit[110]+=exec('licza_ls','pit',1006)
                     ?};
                     O_P.next()
                  !}
               ?}
            ?};
            _liczmies+=((KP.S2$2)<>0);
            _spr_et+=1;
            _dakp:=date(KP.R,KP.M,0);
            {? _Zagrdat<_dakp || _Zagrdat:=_dakp ?};
            KP.next()
         !};
         {? _pom[3] & ~pit[28]
         || _do:=date(_pom[1],KP.M,0);
            {? (_od~1=P.DZA~1) & (_od~2=P.DZA~2) || _od:=P.DZA ?};
            {? (_do~1=P.DZ~1) & (_do~2=P.DZ~2) || _do:=P.DZ ?};
            {? P.DZA~1<=_pom[1] & (P.DZ~1>=_pom[1] | P.DZ=date(0,0,0))
            || {? P.DZA~1=_pom[1]
               || {? P.DZA<_od | _od=date(0,0,0) || _od:=P.DZA ?}
               || _od:=date(_pom[1],1,1)
               ?};
               {? P.DZ~1=_pom[1]
               || {? P.DZ>_do || _do:=P.DZ ?}
               || _do:=date(_pom[1],12,0)
               ?}
            ?};
            {? ~_pom[11].find_tab(0,'OD',,'<=',_do,'DO',,'>=',_od)
            || _pom[11].OD:=_od;
               _pom[11].DO:=_do;
               _pom[11].add()
            || _pom[5]:=1
            ?}
         ?}
      ?};
::    Sprawdzenie nierozliczonych przychodow z PPK dla etatu do określenia czy mamy takie przychody
      {? var_pres('PPK_POD')>0
      || PPK_POD.index('POD_O');
         PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
         {? PPK_POD.first()
         || _spr_et+=1
         ?}
      ?};
      _pom[3] & P.next()
   !};
   P.cntx_pop();
:: Jeżeli składki społeczne od przychodu są ujemne to zwiększamy przychód, gdy jest dodatni
   {? pit[86]<0
   || {? pit[29]>0
      || pit[29]-=pit[86];
         pit[86]:=0
      ?}
   ?};
:: jeżeli mamy ujemny przychód w 2 wierszu i mamy koszty to "przenosimy" do wiersza źródła przychodów
   {? pit[36]<0 & pit[29]>0
   || pit[29]+=pit[36];
      pit[30]+=pit[37]
   ?};
   {? pit[29]<0 & pit[36]>0
   || pit[36]+=pit[29];
      pit[37]+=pit[30]
   ?};
   {? pit[29]<0 || pit[29]:=0 ?};
   {? pit[29]=0 & pit[30]<>0 || pit[30]:=0 ?};
   {? pit[34]<0 || pit[34]:=0 ?};
   {? pit[34]=0 & pit[35]<>0 || pit[35]:=0 ?};
   {? pit[36]<0 || pit[36]:=0 ?};
   {? pit[36]=0 & pit[37]<>0 || pit[37]:=0 ?};
   {? pit[41]<0 || pit[41]:=0 ?};
   {? pit[41]=0 & pit[42]<>0 || pit[42]:=0 ?};
   _zku:=KST.KUZ$2;
   pit[28]:={? _pom[5]
            || {? _zku*_liczmies=pit[30]
               || 4
               |? _pom[7]*_liczmies$2=pit[30]
               || 2
               ?}
            |? _liczmies>0
            || {? _pom[7]*_liczmies$2 = pit[30] || 1
               |? _zku*_liczmies      = pit[30] || 3
               ?}
            ?};
   &_zku;
   {? ~pit[28]
   || P_IPOD.index('OD');
      P_IPOD.prefix(P.ref);
      {? P_IPOD.last()
      || _p_ipod:=1;
         {!
         |? {? P_IPOD.OD>=date(_pom[1],1,1) & P_IPOD.OD<=date(_pom[1],12,0)
            || {? P_IPOD.KU='Z'
               || {? _pom[5] || pit[28]:=4 || pit[28]:=3 ?}; _p_ipod:=0
               ?}
            |? P_IPOD.OD<date(_pom[1],1,1)
            || {? P_IPOD.KU='Z'
               || {? _pom[5] || pit[28]:=4 || pit[28]:=3 ?}
               ?};
               _p_ipod:=0
            ?};
            _p_ipod & P_IPOD.prev()
         !}
      ?}
   ?};
   {? pit[28]=0
   ||  {? _pom[5] || pit[28]:=2 || pit[28]:=1 ?}
   ?};
   {? _spr_et & _pom[6]='T'
   || _kto:=P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE;
      popup(,'Koszty uzyskania: '+&_kto,
             'określone na koniec roku '+$_pom[1]+': ('+$pit[28]+') '+
            {? pit[28]=1 | pit[28]=2 || 'podstawowe' || 'zwiększone' ?},,"pit[28]",
            '--',,,
            '1. z jednego stosunku pracy (stosunków pokrewnych)',,"pit[28]:=1",
            '3. z jednego stosunku pracy (stosunków pokrewnych), zwiększone',,"pit[28]:=3",
            '2. z więcej niż jednego stosunku pracy (stosunków pokrewnych)',,"pit[28]:=2",
            '4. z więcej niż jednego stosunku pracy (stosunków pokrewnych), zwiększone',,"pit[28]:=4")
   ?}
?};

RH.prefix(exec('ref_firma','ustawienia'),P.OSOBA,_pom[1]);
{? RH.first()
|| {? var_pres('RU_DEKL')=var_pres('SYSLOG') || RU_DEKL.prefix() ?};
   {!
   |? _um:=RH.ZLE().RU().K;
      {? {? _pom[1]>=2009 || ~exec('licz_rhs','lista_licz',31) || 1 ?} & (~(',7,8,'*(','+_um+','))) &
      {? _pom[2]='Z'
      || {? ~exec('czy_prac','osoba',ZC.OSOBA,RH.DWY)
         || {? ~_pom[3] || ZC.P=P.ref() || 1 ?}
         ||
::         obsluga przypadkow ze dany pracownik nie ma wyplaty z etatu w roku-kart podatkowych
::         to nalezy PIT-11 ze zlecen wykonac dla rachunkow wystawionych podczas zatrudnienia pracownika
           _ok:=0;
           _dalej:=1;
           P.cntx_psh();
           P.index('PRACOSOB');
           P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
           {? P.first
           || KP.cntx_psh();
              KP.prefix();
              {!
              |? {? KP.find_key(P.ref(),_pom[1])
                 || _dalej:=0
                 |? P.DZA<=RH.DWY
                    & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                 || {? ~KP.find_key(P.ref(),_pom[1])
                    || _ok+=1
                    ?}
                 ?};
                 P.next() & _dalej
              !};
              KP.cntx_pop()
           ?};
           P.cntx_pop();
           &_dalej;
           &_ok
         ?}
      || {? ~_pom[3]
         || _pref:=P.ref();
            _ok:=0;
            P.cntx_psh();
            P.index('PRACOSOB');
            P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
            {? P.first()
            || {!
               |? {? P.DZA<=RH.DWY
                     & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                  || _ok:=(_pref=P.ref() & _spr_et); 0
                  || P.next()
                  ?}
               !}
            ?};
            P.cntx_pop();
            &_ok
         || _pom[10] & _spr_et | exec('czy_prac','osoba',P.OSOBA,RH.DWY) & _spr_et
         ?}
      ?}
      || _src:=
            {? var_pres('RU_DEKL')=var_pres('SYSLOG') &
               RU_DEKL.find_tab(,'RU',,'=',RH.ZLE().RU,'DEKL','NAZWA','=',__PIT,'DEKL','NR','=',__WER)
            || RU_DEKL.WIERSZ<>0
            || 2
            ?};
         {? _src
         || {? ~__par.find_key('Z',#ZC.P)
            || __par.blank(); __par.RODZAJ:='Z'; __par.REF:=#ZC.P; __par.add(1)
            ?};
            {? _Zagrdat<RH.DWY || _Zagrdat:=RH.DWY  ?};
            _skl:=exec('licza_rhs','lista_licz',5711,5721);
::          Wyliczenie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
            _951skl:=exec('licz_rhs','lista_licz',951);
            _skl_kor:=0;
            KORN_Z.index('RH');
            KORN_Z.prefix(RH.ref(),_pom[1]);
            {? KORN_Z.first()
            || {? var_pres('_tabrub')>100 || obj_del(_tabrub) ?};
               _tabrub:=__RUB.sys_rub(5711,RH.DWY);
               {? var_pres('_tabch')>100 || obj_del(_tabch) ?};
               _tabch:=__RUB.sys_rub(5721,RH.DWY);
               _ZP:=_uzp:=0;
                  {? '1'*_um | {? var_pres('ZWPOD',RU)>0 || RH.ZLE().RU().ZWPOD='T' || 0 ?}
                  || _kod_zwol:=exec('find_kod_zp','pit1',RH.DWY);
                     {? _kod_zwol<>''
                     || _uzp:=_kod_zwol='ZWPOD';
                        _ZP:=1
                     ?}
                  ?};
               KOR_Z.index('KORN_Z');
               {!
               |? {? KORN_Z.DW~1=_pom[1]
                  || {? _tabrub.first()
                     || {!
                        |? KOR_Z.prefix(KORN_Z.ref(),__RUB.ref(_tabrub.RN));
                           {? KOR_Z.first
                           || {? ~_ZP
                              || _skl_kor+=KOR_Z.KW
                              || {? _uzp
                                 || pit[102]+=KOR_Z.KW
                                 || pit[106]+=KOR_Z.KW
                                 ?};
                                 pit[88]+=KOR_Z.KW
                              ?};
::                            W przypadku nadpłaconych składek z bieżącego roku to nie odejmujemy
::                            nadpłaconych składek z korekt (wartość ujemna)
                              {? _951skl>0 & KOR_Z.KW<0
                              || _951skl+=KOR_Z.KW
                              ?}
                           ?};
                           _tabrub.next()
                        !}
                     ?};
                     {? _tabch.first()
                     || {!
                        |? KOR_Z.prefix(KORN_Z.ref(),__RUB.ref(_tabch.RN));
                           {? KOR_Z.first
                           || {? ~_ZP
                              || _skl_kor+=KOR_Z.KW
                                 || {? _uzp
                                    || pit[102]+=KOR_Z.KW
                                    || pit[106]+=KOR_Z.KW
                                    ?};
                                    pit[88]+=KOR_Z.KW
                              ?};
::                            W przypadku nadpłaconych składek z bieżącego roku to nie odejmujemy
::                            nadpłaconych składek z korekt (wartość ujemna)
                              {? _951skl>0 & KOR_Z.KW<0
                              || _951skl+=KOR_Z.KW
                              ?}
                           ?};
                           _tabch.next()
                        !}
                     ?}
                  ?};
                  KORN_Z.next()
               !};
               {? var_pres('_tabrub')>100 || obj_del(_tabrub); &_tabrub ?};
               {? var_pres('_tabch')>100 || obj_del(_tabch); &_tabch ?};
               &_ZP; &_uzp
            ?};
            {? _951skl<0 || _951skl:=0 ?};
::          Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
            _skl-=_951skl;
            {? _src=1
            || __transl();
               _wiersz:=RU_DEKL.WIERSZ;
::             sprawdzenie czy mamy ZP dla wybranego wiersza w 2019 roku to wiersz 6 dla umowy-zlecenia
               _czy_zp:=0;
::             Składki od zwolnionego przychodu atrybut 9016 mają wpływ na przychód i składki od przychodu
               _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
               {? _wiersz=6 | _wiersz=10
               || {? ~_po_list
                  || {?  RH.DWY>_em_data
                     || {? _wiersz=6
                        || _wiersz:=8;
                           _czy_zp:=1
                        || _wiersz:=10
                        ?}
                     || {? _wiersz=6 || _wiersz:=6 || _wiersz:=10 ?}
                     ?};
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 100 i 102 lub 104 i 106
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
::                   Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                     _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
                     {? _kod_zwol<>''
                     || {? _kod_zwol='ZWPOD'
                        || pit[102]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                        || pit[106]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?}
                  || {? RH.DWY>_26ur
                     || {? _wiersz=6 || _wiersz:=6 || _wiersz:=10 ?}
                     |? RH.DWY<=_26ur
                     || {? _wiersz=6 || _wiersz:=7 || _wiersz:=11 ?};
                        _czy_zp:=1
                     ?};
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 101, 102 i 103 dla praktyk
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
                     {? _wiersz=6 | _wiersz=7
                     || pit[102]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                     || pit[103]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                     ?}
                  ?}
               ?};
               _len:=obj_len(__wk[_wiersz]);
               _ra_92:=exec('licza_rhs','lista_licz',92);
               _ra_93:=exec('licza_rhs','lista_licz',93);
::             Koszty 50% sa liczone tylko na 7-ej pozycji.
::             Jezeli biezacy wiersz nie ma 7-ej pozycji - kosztow nie liczymy
               _ku:=RH.ZLE().RU().PKU;
               _przy50:={? _len>6 & __wk[_wiersz][7] & _ku=50 || _skl+_ra_92+_skl_kor ?};
               {! _nx:=2.._len
               |! _poz:=__wk[_wiersz][_nx];
                  {? _poz
                  || pit[_poz]+=
                        {? _nx=2 || {? _len>6 & __wk[_wiersz][7] & _ku=50 || 0 || _skl+_ra_92+_skl_kor-_zp_skl ?}
                        |? _nx=3 || _ra_93
                        |? _nx=4 || _skl+_ra_92-_ra_93+_skl_kor-_zp_skl
                        |? _nx=5 || 0
                        |? _nx=6 || exec('licza_rhs','lista_licz',961)
                        |? _nx=7 || _przy50
                        || 'przypadki nieuwzglednione'; 0
                        ?}
                  ?}
               !};
               &_len; &_przy50; &_wiersz;
               {? ~_czy_zp
               ||
::                Składki społeczne
                  pit[86]+=(_skl-_skl_kor)
               ||
::                Składki społeczne do wiersza 6
                  pit[87]+=(_skl-_zp_skl-_skl_kor)
               ?};
::             Składki społeczne do limitu ZP atrybut 9016
               pit[88]+=_zp_skl
            |? '456'*_um
            ||
::             umowy o dzielo, rada nadzorcza
               pit[54]+=(_skl+exec('licza_rhs','lista_licz',92)+_skl_kor);
               pit[55]+=exec('licza_rhs','lista_licz',93);
               pit[57]+=exec('licza_rhs','lista_licz',961);
::             Składki społeczne
               pit[86]+=(_skl+_skl_kor)
            |? '1'*_um
            ||
::             umowy zlecenia od 2019 roku
               {? ~_po_list
               ||
::                Składki od zwolnionego przychodu atrybut 9016 mają wpływ na przychód i składki od przychodu
                  _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
::                Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 100 i 102 lub 104 i 106
::                Przychód ZP do limitu ZP pobieramy atrybut 9012
::                Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                  _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
                  {? _kod_zwol<>''
                  || {? _kod_zwol='ZWPOD'
                     || pit[102]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                     || pit[106]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                     ?};
::                   Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                     exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                  ?};
                  {?  RH.DWY>_em_data & {? var_pres('ZC_INFO')>0 || RH.ZC_INFO().ZUS='T' || RH.ZLE().ZUS='T' ?}
                  ||
::                   Przychód wiersz 8. Wyliczenie danych do 8 wiersza od 2022 roku dla emeryta
::                   kobieta 60 lat lub mężczyzna 65 lat oraz podlega obowiązkowym ubezpieczeniom społecznym
::                   w rozumieniu ustawy z dnia 13 października 1998 r. o systemie ubezpieczeń społecznych
::                   (Dz. U. z 2021 r. poz. 423, z późn. zm.).
::                   Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                   nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                   sumuje również rubryka 7124 Skl. ZUS opod. zag.
::                   Przychód wiersz 8
                     pit[66]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                   Koszty uzyskania wiersz 8
                     pit[67]+=exec('licza_rhs','lista_licz',93);
::                   Podatek wiersz 8
                     pit[69]+=exec('licza_rhs','lista_licz',961);
::                   Składki społeczne wiersz 8
                     pit[87]+=(_skl-_zp_skl+_skl_kor)
                  ||
::                   W przypadku korekty nadpłaconych składek od rachunków dla emeryta musimy skorygować przychody
::                   w wierszu 8 jeżeli były rachunki dla niego z opłacanym. Korygujemy przychód i składki ZUS.
                     {?  RH.DWY>_em_data & RH.KOR='T'
                     ||
::                      Przychód wiersz 8
                        pit[66]+=_skl_kor;
::                      Składki społeczne wiersz 8
                        pit[87]+=_skl_kor;
::                      Po korekta wiersz 8 zerujemy zmienna i wyliczamy wiersz 6
                        _skl_kor:=0;
::                      Przychód wiersz 6
                        pit[58]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl);
::                      Koszty uzyskania wiersz 6
                        pit[59]+=exec('licza_rhs','lista_licz',93);
::                      Podatek wiersz 6
                        pit[61]+=exec('licza_rhs','lista_licz',961);
::                      Składki społeczne wiersz 6
                        pit[86]+=(_skl-_zp_skl)
                     ||
::                      Przychód wiersz 6
                        pit[58]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                      Koszty uzyskania wiersz 6
                        pit[59]+=exec('licza_rhs','lista_licz',93);
::                      Podatek wiersz 6
                        pit[61]+=exec('licza_rhs','lista_licz',961);
::                      Składki społeczne wiersz 6
                        pit[86]+=(_skl-_zp_skl+_skl_kor)
                     ?}
                  ?};
::                Składki społeczne do limitu ZP atrybut 9016
                  pit[88]+=_zp_skl
               ||
::                Składki od zwolnionego przychodu atrybut 9016
                  _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
                  {? RH.DWY>_26ur
                  ||
::                   Przychody z rachunków wypłaconych po ukończeniu 26 roku życia do wiersza 6
::                   Przychód wiersz 6
                     pit[58]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                   Koszty uzyskania wiersz 6
                     pit[59]+=exec('licza_rhs','lista_licz',93);
::                   Podatek wiersz 6
                     pit[61]+=exec('licza_rhs','lista_licz',961);
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 100 i 102 lub 104 i 106
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
::                   Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                     _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
                     {? _kod_zwol<>''
                     || {? _kod_zwol='ZWPOD'
                        || pit[102]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                        || pit[106]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?};
::                   Składki społeczne wiersz 6
                     pit[86]+=(_skl-_zp_skl+_skl_kor)
                  |? RH.DWY<=_26ur
                  ||
::                   Przychody z rachunków wypłaconych do ukończenia 26 roku życia włącznie do wiersza 7
                     pit[62]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                   Koszty uzyskania wiersz 7
                     pit[63]+=exec('licza_rhs','lista_licz',93);
::                   Zaliczka podatkowa wiersz 7
                     pit[65]+=exec('licza_rhs','lista_licz',961);
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 100 i 102 lub 104 i 106
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
::                   Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                     _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
::                   Jeżeli złożył oświadczenie o rezygnacja ZP dla <26 lat to trzeba pobrać kwoty ZP
                     {? _kod_zwol='' || _kod_zwol:='ZWPOD' ?};
                     {? _kod_zwol='ZWPOD'
                     || pit[102]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                     || pit[106]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                     ?};
::                   Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                     exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr);
::                   Składki społeczne do wiersza 6
                     pit[87]+=(_skl-_zp_skl+_skl_kor)
                  ?};
::                Składki społeczne do limitu ZP atrybut 9016
                  pit[88]+=_zp_skl
               ?}
            |? '23m'*_um
            ||
::             prawa autorskie
               _ra_92:=exec('licza_rhs','lista_licz',92);
               _ra_93:=exec('licza_rhs','lista_licz',93);
               {? RH.ZLE().RU().PKU=50
               || pit[73]+=_skl+_ra_92+_skl_kor
               || pit[70]+=_skl+_ra_92+_skl_kor
               ?};
               pit[74]+=_ra_93;
               pit[72]+=exec('licza_rhs','lista_licz',961);
::             Składki społeczne
               pit[86]+=(_skl+_skl_kor)
            |? 'yv'*_um
            ||
::             od 2022 nowe wiersze 10 i 11 jako ZP dla staże uczniowskie, praktyki absolwenckie
::             Przychód ZP do limitu ZP pobieramy atrybut 9012
::             Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
::             Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 100 i 103
               _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
               {? _kod_zwol<>''
               || {? _kod_zwol='ZWPOD'
                  || pit[103]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                  || pit[106]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                  ?};
::                Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                  exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
               ?};
::             Składki od zwolnionego przychodu atrybut 9016 mają wpływ na przychód i składki od przychodu
               _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
::             Przychód PIT
               _przych:=exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor;
               {? ~_po_list
               || pit[75]+=_przych;
::                Zaliczka podatkowa wiersz 10
                  pit[77]+=exec('licza_rhs','lista_licz',961);
::                Składki społeczne
                  pit[86]+=(_skl-_zp_skl+_skl_kor)
               || {? RH.DWY>_26ur
                  ||
::                   Przychody z rachunków wypłaconych po ukończeniu 26 roku życia do wiersza 10
                     pit[75]+=_przych;
::                   Zaliczka podatkowa wiersz 10
                     pit[77]+=exec('licza_rhs','lista_licz',961);
::                   Składki społeczne
                     pit[86]+=(_skl-_zp_skl+_skl_kor)
                  |? RH.DWY<=_26ur
                  ||
::                   Przychody z rachunków wypłaconych do ukończenia 26 roku życia włącznie do wiersza 11
                     pit[78]+=_przych;
::                   Zaliczka podatkowa wiersz 11
                     pit[80]+=exec('licza_rhs','lista_licz',961);
::                   Składki społeczne do wiersza 11
                     pit[87]+=(_skl-_zp_skl+_skl_kor)
                  ?}
               ?};
::             Składki społeczne do limitu ZP atrybut 9016
               pit[88]+=_zp_skl
            ||
::             inne zrodla wiersz 12
               pit[81]+=(_skl+exec('licza_rhs','lista_licz',92)+_skl_kor);
               pit[82]+=exec('licza_rhs','lista_licz',93);
               pit[85]+=exec('licza_rhs','lista_licz',961);
::             Składki społeczne
               pit[86]+=(_skl+_skl_kor)
            ?};
::          Składki zdrowotne pobrane przez płatnika wykazane w poz. 109 od 2022 roku
            pit[109]+=exec('licza_rhs','lista_licz',57411);
::          Składki członkowskie w poz. 110 na rzecz związków zawodowych pobrane przez płatnika od 2022
::          podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 300 zł rocznie
            pit[110]+=exec('licza_rhs','lista_licz',1006)
         ?};
::       obsluga zasilkow dla zleceniobiorcy od 2018 blok F od wersji PIT-11(24)-poprzednio na PIT-8C do 2017 roku
         {? RH.ZAS='T'
         || ZC_N.prefix(RH.ref());
            {? ZC_N.first()
            || {!
               |? 'wyplacone zasilki:';
                  _zas_kod:=ZC_N.R().RN;
                  {? __RUB.sys_attr(_zas_kod,1221,ZC_N.OD) | _zas_kod>=510 & _zas_kod<=517
                  || 'chorobowe';
                     _zasilek[1]+=ZC_N.KW
                  |? __RUB.sys_attr(_zas_kod,1227,ZC_N.OD) | _zas_kod=524
                  || 'macierzynskie';
                     _zasilek[2]+=ZC_N.KW
                  |? __RUB.sys_attr(_zas_kod,1225,ZC_N.OD) | _zas_kod=530
                  || 'opiekuncze';
                     _zasilek[3]+=ZC_N.KW
                  |? __RUB.sys_attr(_zas_kod,1222,ZC_N.OD) | _zas_kod=537
                  || 'swiadczenia reh.';
                     _zasilek[5]+=ZC_N.KW
                  ?};
                  ZC_N.next()
               !}
            ?}
         ?}
      ?};
      RH.next()
   !};
:: przepisanie wartosci do pozycji pit, jesli są zasilki to szukamy wolnej pozycji, a jak brak to do ostatniej
   _zas_kw:=0;
   {! _nx:=1..obj_len(_zasilek) |! _zas_kw+=_zasilek[_nx] !};
   {? _zas_kw
   || {! _nx:=1..obj_len(_zasilek)
      |! _zas_kw:=0;
         _zas_op:='';
         _zas_kw+=_zasilek[_nx];
         _zas_op+={? _zasilek[_nx]
                  || {? _nx=1 || 'zasiłki chorobowe, '
                     |? _nx=2 || 'zasiłki macierzyńskie, '
                     |? _nx=3 || 'zasiłki opiekuńcze, '
                     |? _nx=5 || 'świadczenia rehabilitacyjne, '
                     || ''
                     ?}
                  || ''
                  ?};
         {? +_zas_op || _zas_op:=_zas_op-2 ?};
         {? _zas_kw
         || {! _ix:=1..3
            |? _zas_kw
            |! {? pit[90+(_ix-1)*2]='' & pit[91+(_ix-1)*2]=0
               || pit[90+(_ix-1)*2]:=_zas_op;
                  pit[91+(_ix-1)*2]:=_zas_kw;
                  _zas_kw:=0
               ?}
            !};
            {? _zas_kw
            || pit[94]+=', '+_zas_op;
               pit[95]+=_zas_kw
            ?}
         ?}
      !}
   ?}
?};
::Po zliczeniu zwolnionych przychodów z etatu i zleceń ze względu na możliwość przekroczenia kwoty limitów
::Dodanie przychodów z PPK które nie zostały rozliczone na listach płac
::dla pracowników do 26 roku życia zapis do wiersz 2 poz. 36
{? _pom[2]='P' & var_pres('PPK_POD')>0
|| P.cntx_psh();
::informacja dla podatnika
   {? _pom[3]
   || P.index('PRACOSOB');
      P.prefix(exec('ref_firma','ustawienia'),'P',P.OSOBA);
      P.first()
   ?};
   {!
   |? PPK_POD.index('POD_O');
      PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
      {? PPK_POD.first()
      || {!
         |? _kod_zwol:=exec('find_kod_zp','pit1',PPK_POD.PRZ_DATA);
            {? _kod_zwol<>''
            || _uzp:=_kod_zwol='ZWPOD';
               _sum_ZP:=pit[101]+pit[102]+pit[103]+pit[105]+pit[106];
::             Sprawdzenie czy mamy ZP dla <26 lat
               {? _uzp
               || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                  || pit[101]+=PPK_POD.WYL_KW
                  || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                     || {? PPK_POD.WYL_KW>=_dop
                        || pit[101]+=_dop;
                           {? PPK_POD.PRZ_DATA>_em_data
                           || pit[43]+=(PPK_POD.WYL_KW-_dop)
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[36]+=(PPK_POD.WYL_KW-_dop)
                           || pit[29]+=(PPK_POD.WYL_KW-_dop)
                           ?}
                        ?}
                     || {? PPK_POD.PRZ_DATA>_em_data
                        || pit[43]+=PPK_POD.WYL_KW
                        |? PPK_POD.PRZ_DATA<=_26ur
                        || pit[36]+=PPK_POD.WYL_KW
                        || pit[29]+=PPK_POD.WYL_KW
                        ?}
                     ?}
                  ?}
               || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                  || pit[105]+=PPK_POD.WYL_KW
                  || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                     || {? PPK_POD.WYL_KW>=_dop
                        || pit[105]+=_dop;
                           {? PPK_POD.PRZ_DATA>_em_data
                           || pit[43]+=(PPK_POD.WYL_KW-_dop)
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[36]+=(PPK_POD.WYL_KW-_dop)
                           || pit[29]+=(PPK_POD.WYL_KW-_dop)
                           ?}
                        ?}
                     || {? PPK_POD.PRZ_DATA>_em_data
                        || pit[43]+=PPK_POD.WYL_KW
                        |? PPK_POD.PRZ_DATA<=_26ur
                        || pit[36]+=PPK_POD.WYL_KW
                        || pit[29]+=PPK_POD.WYL_KW
                        ?}
                     ?}
                  ?};
::                Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                  exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
               ?};
               &_uzp
            || {? PPK_POD.PRZ_DATA>_em_data
               || pit[43]+=PPK_POD.WYL_KW
               |? PPK_POD.PRZ_DATA<=_26ur
               || pit[36]+=PPK_POD.WYL_KW
               || pit[29]+=PPK_POD.WYL_KW
               ?}
            ?};
            _spr_et+=1;
            PPK_POD.next()
         !}
      ?};
      _pom[3] & P.next()
   !};
   P.cntx_pop();
   {? pit[36]<0 || pit[36]:=0 ?};
   {? pit[36]=0 & pit[37]<>0 || pit[37]:=0 ?}
?};

:: Dodanie przychodów z PPK które nie zostały rozliczone z rachunkow
{? var_pres('PPK_POD')>0
|| PPK_POD.cntx_psh();
   PPK_POD.index(__NdPOD);
   PPK_POD.prefix(null(),P.OSOBA,'T',_pom[1]);
   {? PPK_POD.first()
   || RH.cntx_psh();
      {!
      |? {? PPK_POD.WYL_RH<>null()
         || _um:=PPK_POD.WYL_RH().ZLE().RU().K;
            {? {? _pom[1]>=2009 || ~exec('licz_rhs','lista_licz',31) || 1 ?} & (~(',7,8,'*(','+_um+','))) &
               {? _pom[2]='Z'
               || {? ~exec('czy_prac','osoba',ZC.OSOBA,RH.DWY)
                  || {? ~_pom[3] || ZC.P=P.ref() || 1 ?}
                  ||
::         obsluga przypadkow ze dany pracownik nie ma wyplaty z etatu w roku-kart podatkowych
::         to nalezy PIT-11 ze zlecen wykonac dla rachunkow wystawionych podczas zatrudnienia pracownika
                    _ok:=0;
                    _dalej:=1;
                    P.cntx_psh();
                    P.index('PRACOSOB');
                    P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
                    {? P.first
                    || KP.cntx_psh();
                       KP.prefix();
                       {!
                       |? {? KP.find_key(P.ref(),_pom[1])
                          || _dalej:=0
                          |? P.DZA<=RH.DWY
                             & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                          || {? ~KP.find_key(P.ref(),_pom[1])
                             || _ok+=1
                             ?}
                          ?};
                          P.next() & _dalej
                       !};
                       KP.cntx_pop()
                    ?};
                    P.cntx_pop();
                    &_dalej;
                    &_ok
                  ?}
               || {? ~_pom[3]
                  || _pref:=P.ref();
                     _ok:=0;
                     P.cntx_psh();
                     P.index('PRACOSOB');
                     P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
                     {? P.first()
                     || {!
                        |? {? P.DZA<=RH.DWY
                              & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                           || _ok:=(_pref=P.ref() & _spr_et); 0
                           || P.next()
                           ?}
                        !}
                     ?};
                     P.cntx_pop();
                     &_ok
                  || _pom[10] & _spr_et | exec('czy_prac','osoba',P.OSOBA,RH.DWY) & _spr_et
                  ?}
               ?}
            || {? '456'*_um
               ||
::                umowy o dzielo 20%, rady nadzorcze
                  pit[54]+=PPK_POD.WYL_KW
               |? '1'*_um | {? var_pres('ZWPOD',RU)>0 || _um<>'y' & _um<>'v' & RH.ZLE().RU().ZWPOD='T' || 0 ?}
               ||
::                umowy - zlecenia dla zleceniobiorców do 26 roku życia zapis do wiersz 7 poz. 62
::                powyżej wieku emerytalnego zapis oraz opłacane składki społeczne do wiersz 8 poz. 66
                  _rh_ZUS:=PPK_POD.WYL_RH().ZC_INFO().ZUS='T';
                  _kod_zwol:=exec('find_kod_zp','pit1',PPK_POD.PRZ_DATA);
                  {? _kod_zwol<>''
                  || _uzp:=_kod_zwol='ZWPOD';
                     _sum_ZP:=pit[101]+pit[102]+pit[103]+pit[105]+pit[106];
::                   Sprawdzenie czy mamy ZP dla <26 lat
                     {? _uzp
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                           || pit[66]+=PPK_POD.WYL_KW
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[102]+=PPK_POD.WYL_KW
                           || pit[62]+=PPK_POD.WYL_KW
                           ?}
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[102]+=_dop;
                                 {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[62]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[62]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?}
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || pit[106]+=PPK_POD.WYL_KW
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[106]+=_dop;
                                 {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[58]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[58]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?};
                     &_uzp
                  || {? PPK_POD.PRZ_DATA<=_26ur
                     || pit[62]+=PPK_POD.WYL_KW
                     || pit[58]+=PPK_POD.WYL_KW
                     ?}
                  ?}
               |? '23m'*_um
               ||
::                prawa autorskie
                  pit[73]+=PPK_POD.WYL_KW
               |? 'yv'*_um
               ||
::                staże uczniowskie, praktyki absolwenckie do 26 roku życia zapis do wiersz 11 poz. 78
::                powyżej wieku emerytalnego zapis oraz opłacane składki społeczne do wiersz 8 poz. 66
                  _rh_ZUS:=PPK_POD.WYL_RH().ZC_INFO().ZUS='T';
                  _kod_zwol:=exec('find_kod_zp','pit1',PPK_POD.PRZ_DATA);
                  {? _kod_zwol<>''
                  || _uzp:=_kod_zwol='ZWPOD';
                     _sum_ZP:=pit[101]+pit[102]+pit[103]+pit[105]+pit[106];
::                   Sprawdzenie czy mamy ZP dla <26 lat
                     {? _uzp
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                           || pit[66]+=PPK_POD.WYL_KW
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[103]+=PPK_POD.WYL_KW
                           || pit[78]+=PPK_POD.WYL_KW
                           ?}
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[103]+=_dop;
                                 {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[78]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[78]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?}
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || pit[103]+=PPK_POD.WYL_KW
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[103]+=_dop;
                                 {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[75]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[75]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?};
                     &_uzp
                  || {? PPK_POD.PRZ_DATA<=_26ur
                     || pit[78]+=PPK_POD.WYL_KW
                     || pit[75]+=PPK_POD.WYL_KW
                     ?}
                  ?}
               ||
::                inne zrodla wiersz 12
                  pit[81]+=PPK_POD.WYL_KW
               ?}
            ?}
         ?};
         PPK_POD.next()
      !};
      RH.cntx_pop()
   ?};
   PPK_POD.cntx_pop()
?};

:: dla osób do 26 roku życia w wierszu 2 nie mogą być ujemne składki społeczne
:: lub po przekroczeniu wieku emerytalnego w wierszu 3 nie mogą być ujemne składki społeczne
:: w pozycji 87, 88 czyli muszą być kwoty z etatu sprawdzane ze zmienna _spr_et
:: dotyczy to tylko pracowników
{? _pom[2]='P'
|| {? _spr_et & (pit[36]+pit[41])=0 & (pit[43]+pit[48])=0 & (pit[87]<>0 | pit[88]<0)
   || {? pit[87]<>0
      || {? pit[86]
         || pit[86]+=pit[87];
            pit[87]:=0
         |? pit[88]
         || pit[88]+=pit[87];
            pit[87]:=0
         ?}
      ?};
      {? pit[88]<0 || pit[86]+=pit[88]; pit[88]:=0 ?}
   ?}
?};
{? pit[86]<0 || pit[86]:=0 ?};
{? pit[87]<0 || pit[87]:=0 ?};
{? pit[88]<0 || pit[88]:=0 ?};
:: kwota zasiłków z etatu wykazywana w wierszu 12 Inne źródła. Nie wykazujemy ujemnych kwot zasiłków razem
{? _et_zas<0
|| _et_zas:=0
?};
{? _et_zs26<0
|| _et_zs26:=0
?};
{? _pd_zs26<0
|| _pd_zs26:=0
?};
::jeżeli kwota zasiłków jest wyższa od kwoty przychodu z etatu
::to nie pobieramy pełnej kwoty zasiłku tylko obniżamy do wysokości przychodu na listach płac
{? pit[29]<>0 & pit[29]<_et_zas || _et_zas:=pit[29] ?};
pit[81]+=_et_zas;
:: kwota zasiłków z etatu wykazywana w wierszu 12 Inne źródła do ukończenia 26 roku życia
pit[81]+=_et_zs26;
:: kwota zasiłków z etatu wykazywana w wierszu 12 Inne źródła do ukończenia dla wieku emrytalnego
pit[81]+=_et_zsEM;
:: przychód z pozycji 29 z etatu pomniejszamy o kwota zasiłków z etatu
pit[29]-=_et_zas;
{? pit[29]<0 || pit[29]:=0 ?};
:: kwota podatku od zasiłku z etatu wykazujemy w wierszu 1 jeżeli mamy przychody z etatu, jeżeli nie to w wierszu 12
{? _et_zas & (pit[29]+pit[34])=0
|| pit[33]-=_pd_zas;
   pit[85]+=_pd_zas
?};
:: kwota podatku od zasiłku z etatu wykazujemy w wierszu 1 jeżeli mamy przychody z etatu, jeżeli nie to w wierszu 12
:: otrzymanych od 1.08.2019 do ukończenia 26 roku życia. Dla przekroczenia lub oświadczeniu o braku ZP
:: w przypadku, gdy kwoty przychodów 2 wiersza są podatek od zasiłku wykazujemy w tym wierszu łącznie
{? _et_zs26 | _pd_zs26>0
|| {? pit[29]+pit[34]=0
   || {? pit[36]+pit[41]>0
      || pit[40]+=_pd_zs26
      || pit[85]+=_pd_zs26
      ?}
   || pit[33]+=_pd_zs26
   ?}
?};
::jeżeli kwota zasiłków jest wyższa od kwoty przychodu z po przekroczeniu wieku emerytalnego
::to nie pobieramy pełnej kwoty zasiłku tylko obniżamy do wysokości przychodu na listach płac
{? pit[43]<>0 & pit[43]<_et_zsEM || _et_zsEM:=pit[43] ?};
:: kwota podatku od zasiłku z etatu wykazujemy w wierszu 1 jeżeli mamy przychody z etatu, jeżeli nie to w wierszu 12
:: Po przekoroczeniu wieku emerytalnego lub dla przekroczenia ZP z pkt 153 lub braku oświadczeniu o ZP
:: w przypadku, gdy kwoty przychodów 3 wiersza są podatek od zasiłku wykazujemy w tym wierszu łącznie
{? _et_zsEM | _pd_zsEM>0
|| {? pit[29]+pit[34]=0
   || {? pit[43]+pit[48]>0
      || pit[47]+=_pd_zsEM
      || pit[85]+=_pd_zsEM
      ?}
   || pit[33]+=_pd_zsEM
   ?}
?};
:: Po korektach ZP 12.51_71 dla wiersza 2 mamy tylko podatek bez przychodu
:: to kwota podatku przepiszemy do pit[33] jeżeli mamy przychód pozycja 29 i 34
:: lub do wiersza 12 pozycja 81 jeżeli mamy kwota w pozycji 85
{? pit[40]<>0 & (pit[36]+pit[41])=0
|| {? (pit[29]+pit[34])>0
   || pit[33]+=pit[40];
      pit[40]:=0
   |? pit[81]>0
   || pit[85]+=pit[40];
      pit[40]:=0
   ?}
?};
:: Jeżeli mamy zerowy przychód pit[29] oraz koszty pit[30] oraz pit[33]
:: to zerujemy koszty pit[30] oraz kwota pit[33] trzeba przepisać do kwoty zaliczki od zasiłku pit[85]
{? pit[29]=0 & pit[30]<>0 & pit[33]<>0
|| pit[30]:=0;
   {? pit[85]
   || pit[85]+=pit[33];
      pit[33]:=0
   ?}
?};
{? pit[33]<0 || pit[33]:=0 ?};
{? pit[40]<0 || pit[40]:=0 ?};
{? pit[85]<0 || pit[85]:=0 ?};
:: Po korektach ZP 12.51_71 dla wiersza 7 mamy tylko podatek bez przychodu
:: to kwota podatku przepiszemy do pit[61] jeżeli mamy przychód pozycja 58
{? pit[65]<>0 & pit[62]=0
|| {? pit[58]>0
   || pit[61]+=pit[65];
      pit[65]:=0
   ?}
?};
{? pit[61]<0 || pit[61]:=0 ?};
{? pit[65]<0 || pit[65]:=0 ?};
:: Po korektach ZP 12.51_71 dla wiersza 7 mamy tylko ujemny przychod
:: to kwota przychod przepiszemy do pit[88] jeżeli mamy kwota
{? pit[62]<0 & pit[88]<>0
|| {? pit[88]>0
   || pit[88]+=pit[62];
      pit[62]:=0
   ?}
?};
{? pit[88]<0 || pit[88]:=0 ?};
pit[31]:=pit[29]+pit[34]-pit[30]-pit[35]; {? pit[31]<0 || pit[31]:=0 ?};
pit[38]:=pit[36]+pit[41]-pit[37]-pit[42]; {? pit[38]<0 || pit[38]:=0 ?};
pit[45]:=pit[43]+pit[48]-pit[44]-pit[49]; {? pit[45]<0 || pit[45]:=0 ?};
pit[51]:=pit[50]; {? pit[51]<0 || pit[51]:=0 ?};
{? pit[53]<0 || pit[53]:=0 ?};
pit[56]:=pit[54]-pit[55]; {? pit[56]<0 || pit[56]:=0 ?};
pit[60]:=pit[58]-pit[59]; {? pit[60]<0 || pit[60]:=0 ?};
pit[64]:=pit[62]-pit[63]; {? pit[64]<0 || pit[64]:=0 ?};
pit[68]:=pit[66]-pit[67]; {? pit[68]<0 || pit[68]:=0 ?};
pit[71]:=pit[70]+pit[73]-pit[74]; {? pit[71]<0 || pit[71]:=0 ?};
{? pit[75]<0 || pit[75]:=0 ?};
pit[76]:=pit[75]; {? pit[76]<0 || pit[76]:=0 ?};
{? pit[78]<0 || pit[78]:=0 ?};
pit[79]:=pit[78]; {? pit[79]<0 || pit[79]:=0 ?};
pit[83]:=pit[81]-pit[82]; {? pit[83]<0 || pit[83]:=0 ?};
::Blok F suma zasilkow
pit[96]:=pit[89]+pit[91]+pit[93]+pit[95]; {? pit[96]<0 || pit[96]:=0 ?};
::Blok G sumy zwolnionych przychodów pkt 148 oraz 152-154
{? pit[101]<0 || pit[101]:=0 ?};
{? pit[102]<0 || pit[102]:=0 ?};
{? pit[103]<0 || pit[103]:=0 ?};
pit[100]:=pit[101]+pit[102]+pit[103];
{? pit[100]<0 || pit[100]:=0 ?};
:: Zmiany 2022
:: Przychody ze stosunku pracy i stosunków pokrewnych oraz z umów zlecenia, o których mowa
:: w art. 21 ust. 1 pkt 152-154 ustawy
{? pit[105]<0 || pit[105]:=0 ?};
{? pit[106]<0 || pit[106]:=0 ?};
pit[104]:=pit[105]+pit[106];
{? pit[104]<0 || pit[104]:=0 ?};
:: Zwolnione przychody z okresleniem limitu w danym roku 2019 i kolejne lata na podstawie stalych systemu
{? pit[101]>_lim_ZP
||
:: Jeżeli mamy przekroczenie limitu to różnica do pozycji 36 oraz komunikat o błędnym PIT-11
   _ZP_rozn:=pit[101]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 101 o wartość: %2.\nWykazano w pozycji 36.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot skł. na ubezp. społeczne oraz zdrowotne.'@);
   pit[36]+=_ZP_rozn;
   pit[38]:=pit[36]+pit[41]-pit[37]-pit[42];
   {? pit[38]<0 || pit[38]:=0 ?};
   pit[101]:=_lim_ZP
?};
{? pit[102]>_lim_ZP
||
:: Jeżeli mamy przekroczenie limitu to różnica do pozycji 62 oraz komunikat o błędnym PIT-11
   _ZP_rozn:=pit[102]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 102 o wartość: %2.\nWykazano w pozycji 62.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot skł. na ubezp. społeczne oraz zdrowotne.'@);
   pit[62]+=_ZP_rozn;
   pit[64]:=pit[62]-pit[63];
   {? pit[64]<0 || pit[64]:=0 ?};
   pit[102]:=_lim_ZP
?};
{? pit[103]>_lim_ZP
||
:: Jeżeli mamy przekroczenie limitu to różnica do pozycji 67 oraz komunikat o błędnym PIT-11
   _ZP_rozn:=pit[103]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.',
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 103 o wartość: %2.\nWykazano w pozycji 67.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot skł. na ubezp. społeczne oraz zdrowotne.'@);
   pit[78]+=_ZP_rozn;
   pit[79]:=pit[78];
   {? pit[79]<0 || pit[79]:=0 ?};
   pit[103]:=_lim_ZP
?};
{? pit[100]>_lim_ZP
||
::    Jeżeli mamy przekroczenie sumy limitów to  komunikat o błędnym PIT-11
   _ZP_rozn:=pit[100]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 92 o wartość: %2.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot przychodów, skł. na ubezpieczenie społeczne oraz zdrowotne.'@);
   pit[100]:=_lim_ZP
?};
{? pit[104]>_lim_ZP
||
:: Jeżeli mamy przekroczenie sumy limitów pkt 152-154 to komunikat o błędnym PIT-11
   _ZP_rozn:=pit[104]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 104 o wartość: %2.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot przychodów, skł. na ubezpieczenie społeczne oraz zdrowotne.'@);
   pit[104]:=_lim_ZP
?};
{? pit[100]+pit[104]>_lim_ZP
||
:: Jeżeli mamy przekroczenie sumy limitów pkt 152-154 to komunikat o błędnym PIT-11
   _ZP_rozn:=pit[100]+pit[104]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' suma poz. 101+104 o wartość: %2.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot przychodów, skł. na ubezpieczenie społeczne oraz zdrowotne.'@);
  {? pit[100]>_ZP_rozn
  || pit[100]-=_ZP_rozn
  |? pit[104]>_ZP_rozn
  || pit[104]-=_ZP_rozn
  ?}
?};
:: Składki członkowskie na rzecz związków zawodowych pobrane przez płatnika, podlegające odliczeniu od
:: dochodu, o których mowa w art. 26 ust. 1 pkt 2c ustawy w wysokości nieprzekraczającej w roku podatkowym kwoty 300 zł
{? pit[110]<0 || pit[110]:=0 ?};
{? pit[110]>_lim_skz || pit[110]:=_lim_skz ?};

obj_del(_zp_atr); &_zp_atr;
obj_del(_zasilek); &_zasilek;

_dochzw:=pit[32]+pit[39]+pit[46]+pit[52]+pit[84];
_blokG:=pit[97]+pit[98]+pit[99]+pit[100]+pit[104]+pit[109]+pit[110];
_przych:=pit[29]+pit[34]+pit[36]+pit[41]+pit[43]+pit[48]+pit[50]+pit[54]+pit[58]+pit[62]+pit[66];
_przych+=pit[70]+pit[73]+pit[75]+pit[78]+pit[81];
_blskzdr:=pit[86]+pit[87]+pit[88];

{? ~(pit[113]:=_przych+pit[96]+_dochzw+_blokG+_blskzdr)
|| return(_wynik)
?};

_adus:=exec('adresdous','osoba',_pom[1]);
{? #(_adus+1)
|| pit[6]:=OS_US.US().NU+
           {? +US.UU || ', '+US.UU || '' ?}+
           {? +US.UK & +US.MU || ', '+(6+US.UK)+' '+US.MU || '' ?};
   us_podat:=OS_US.US
|| pit[6]:='';
   us_podat:=null()
?};
::Ustalenie pola VAT_DEK.POD rodzaj Podatnika
{? var_pres('PODFIZ',KST)>0
|| pit[114]:=KST.PODFIZ
?};
::Ustalenie pola VAT_DEK.REZYDENT pole dodane w wersji 12.41 od wersji PIT-11(22)
:: jesli rezydent placi podatki w Polsce to 'T' dla nierezydenta 'N'
::ustalenie na podstawie kartoteki OS_ZNIP
::ustawienie daty sprawdzenia danych w OS_ZNIP na podstawie _Zagrdat uzyskanych przychodow z etatu i zlecen
::Brak obsługi zmiany danych identyfikacyjnych w roku podatkowym
_dataBad:={? _Zagrdat<>date(0,0,0) & _Zagrdat<date(__Rok,12,0) || _Zagrdat || date(__Rok,12,0) ?};
{? exec('szukaj_osznip','edeklar',P.OSOBA,_dataBad)
||
:: Zagraniczny numer identyfikacyjny podatnika
   pit[11]:='N';
   pit[13]:=OS_ZNIP.ZNIP;
:: Rodzaj numeru identyfikacyjnego
   pit[14]:=OS_ZNIP.RZNIP;
:: Kraj wydania numeru identyfikacyjnego
   pit[15]:=OS_ZNIP.KRAJZNIP
|| pit[11]:='T';
   pit[14]:=null();
   pit[15]:=null()
?};
{? #(1+_adus)
|| pit[19]:=OS_ADRES.KRAJ;
   pit[20]:=OS_ADRES.WOJEWODZ;
   pit[21]:=OS_ADRES.POWIAT;
   pit[22]:=OS_ADRES.GMINA;
   pit[23]:=OS_ADRES.ULICA;
   pit[24]:=OS_ADRES.DOM;
   pit[25]:=OS_ADRES.LOKAL;
   pit[26]:=OS_ADRES.MIASTO;
   pit[27]:=OS_ADRES.KOD
|| {! _nx:=19..27 |! pit[_nx]:='' !};
   pit[19]:=null
?};
&_dataBad; &_adus;

{? _a
|| P.cntx_psh();
   P.clear();
   DEKL_POD.cntx_psh();
   DEKL_POD.clear();
   {? __par.first()
   || {!
      |? DEKL_POD.blank();
         DEKL_POD.PIT:='(E)PIT-11';
         {? __par.RODZAJ='E' & P.seek(__par.REF,)
         || DEKL_POD.RODZAJ:='E'; DEKL_POD.PRAC_ET:=P.ref; DEKL_POD.OS_PODAT:=P.OSOBA
         |? P.seek(__par.REF,)
         || DEKL_POD.RODZAJ:='Z'; DEKL_POD.PRAC_ET:=P.ref; DEKL_POD.OS_PODAT:=P.OSOBA
         ?};
         {? EDIT_VAR.PIT_RODZ=''
         || DEKL_POD.DATA:=VAT_DEK.DATA
         || DEKL_POD.DATA:={? PIT_EDIT.DATA<>date(0,0,0) || PIT_EDIT.DATA || VAT_DEK.DATA ?}
         ?};
         DEKL_POD.S1:=_przych;
         DEKL_POD.S2:=pit[30]+pit[35]+pit[37]+pit[42]+pit[44]+pit[49]+pit[55]+pit[59];
         DEKL_POD.S2+=pit[63]+pit[67]+pit[74]+pit[82];
         DEKL_POD.S3:=pit[33]+pit[40]+pit[47]+pit[53]+pit[57]+pit[61]+pit[65]+pit[69];
         DEKL_POD.S3+=pit[72]+pit[77]+pit[80]+pit[85];
         DEKL_POD.USER:=OPERATOR.USER;
         {? DEKL_POD.add()
         || __par.DEKL_REF:=#DEKL_POD.ref();
            __par.put()
         ?};
         __par.next()
      !}
   ?};
   DEKL_POD.cntx_pop();
   P.cntx_pop()
?};
obj_del(_pom); &_pom;

{? pit[113]
|| {? _a & pit[3][9]<>date(0,0,0)
   || exec('przekaz','giodo',pit[3][9],
           'Przekazanie danych na formularzu PIT-11',
           'odbiorcą danych jest:',
           pit[6])
   ?};
   _wynik:=1
?};
_wynik


\zlicz_zp_rodz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Wyznaczenie kodu rodzaju zwolnionego przychodu na podstawie tabeli OS_ZWPOZ Pozycje zwolnionego przychodu
::   WE: _a [REFERENCE] - ref Pracownika
::       _b [INTEGER] - rok podatkowy
::       _c [INTEGER] - miesiąc podatkowy
::       _d [REFERENCE ]- ref Listy płac z etatu lub null() dla wywołania dla rachunku
::       _e [REFERENCE] - ref Rachunku od umowy cywilnoprawnej lub null() dla list płac
::   WY: Kod [STRING] rodzaju zwolnionego przychodu lub '', jeżeli nie ma tabeli OS_ZWPOZ to zwraca ''
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('OS_ZWPOZ')<0 || return('') ?};
{? var_pres('_a')<>type_of(null()) || return('') ?};
{? var_pres('_b')<>type_of(0) || return('') ?};
{? var_pres('_c')<>type_of(0) || return('') ?};
{? var_pres('_d')<>type_of(null()) || return('') ?};
{? var_pres('_e')<>type_of(null()) || return('') ?};
_prac:=_a;
_rok:=_b;
_mc:=_c;
_refO:=_d;
_refRH:=_e;
_kod_zwol:='';
{? var_pres('OS_ZWPOZ')>0
|| OS_ZWPOZ.index('PRACROK');
   OS_ZWPOZ.prefix(_prac,_rok,_mc,_refO,_refRH);
   {? OS_ZWPOZ.first()
   || _kod_zwol:=OS_ZWPOZ.OS_ZWSLO().KOD
   ?}
?};
_kod_zwol


\find_kod_zp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Wyznaczenie kodu rodzaju zwolnionego przychodu na podstawie tabeli OS_ZWPOD
::       W przypadku brak zmian w tabeli OS_ZWPOD w Polski Ład 12.51_139 zwracany jest ''
::   WE: _a [DATE] - data
::   WY: Kod [STRING] rodzaju zwolnionego przychodu lub ''
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('OS_ZWSLO',OS_ZWPOD)<0 || return('') ?};
{? var_pres('_a')<>type_of(date()) || return('') ?};
_jest_a167:=var_pres('UL2',KST)=20;
_data:=_a;
_rok:=_data~1;
_mc:=_data~2;
_firma:=exec('ref_firma','ustawienia');
_ref_typ:="_ref:=null();
   _kod:=_a;
   _firma:=_b;
   OS_ZWSLO.index('KOD');
   OS_ZWSLO.prefix(_firma);
   {? OS_ZWSLO.find_key(_kod)
   || _ref:=OS_ZWSLO.ref()
   ?};
   _ref";
_26ur:=26;
{? var_pres('ZWPODW',KST)>0
|| _26ur:=KST.ZWPODW
?};

_ret:='';
OS_ZWPOD.cntx_psh();
{? _jest_a167
|| {? var_pres('__ZW_PRZ')>100 & __ZW_PRZ.JEST_PL
   || __ZW_PRZ.WIEK:=_26ur
   ?};
   {? exec('czy_ulga_U26','lista_licz',_data)
   || _ret:='ZWPOD'
   ?}
|| OS_ZWPOD.index('OS_ZWPOD');
   OS_ZWPOD.prefix(_firma,P.OSOBA,_rok,_ref_typ('ZWPOD',_firma));
   {? P.OSOBA().UR_DATA>=(date(_rok-_26ur,_mc,{? _mc=2 & _data~3=29 || 0 || _data~3 ?}))
   || {? OS_ZWPOD.first() & OS_ZWPOD.D_OB<=_data
      || {? OS_ZWPOD.REZYGN<>'T'
         || _ret:='ZWPOD'
         ?}
      || _ret:='ZWPOD'
      ?}
   ?}
?};
{? _ret=''
|| {? _jest_a167
   || {? exec('os_zwpod_find','overlap',_data)='ZWPODP'
      || _ret:='ZWPODP'
      ?}
   || OS_ZWPOD.index('TYP');
      OS_ZWPOD.prefix(_firma,P.OSOBA,_ref_typ('ZWPODP',_firma));
      {? OS_ZWPOD.last()
      || {!
         |? {? OS_ZWPOD.AKTYWNY='T' & OS_ZWPOD.D_OB<=_data & (OS_ZWPOD.D_OW=date(0,0,0) | OS_ZWPOD.D_OW>=_data) &
               _rok>=OS_ZWPOD.ROK & _rok<=OS_ZWPOD.ROK_Z
            || _ret:='ZWPODP'
            ?};
            _ret='' & OS_ZWPOD.prev()
         !}
      ?}
   ?}
?};
{? _ret=''
|| {? _jest_a167
   || _ret:=exec('os_zwpod_find','overlap',_data)
   || OS_ZWPOD.index('OSDT');
      OS_ZWPOD.prefix(_firma,P.OSOBA,_rok);
      {? OS_ZWPOD.find_le(_data)
      || {!
         |? {? OS_ZWPOD.AKTYWNY='T' & (OS_ZWPOD.D_OW=date(0,0,0) | OS_ZWPOD.D_OW>=_data)
            || _ret:=OS_ZWPOD.OS_ZWSLO().KOD
            ?};
            _ret='' & OS_ZWPOD.prev()
         !}
      ?}
   ?}
?};
OS_ZWPOD.cntx_pop();
_ret


\kiedy_emeryt
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Zwraca datę ukończenia wieku emerytalnego
::   WE: _a [DATE] - data urodzenia
::       _b [STRING] - płeć osoby
::   WY: Zwraca datę ukończenia wieku emerytalnego
::----------------------------------------------------------------------------------------------------------------------
_dataur:=_a;
_plec:=_b;
_data_em:=date(0,0,0);
{? _plec='K'
|| _dat_em:=KST.WEK
|| _dat_em:=KST.WEM
?};
_rok:=_dataur~1;
_mc:=_dataur~2;
_dzien:=_dataur~3;
_data_em:=date(_rok+_dat_em,_mc,{? _mc=2 & _dzien=29 || 0 || _dzien ?});
_data_em


\kod_zwol_atr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Wyznaczenie kodu atrybutu rodzaju zwolnionego przychodu oraz ustalenie tablicy __P_107
::       Wymagane istnienie tablicy nazwanej __P_107 w przypadku jej braku zwracane jest 0
::   WE: _a [STRING] - kod
::       _b [OBJECT] - tablica nazwana _zp_atr
::   WY: Rodzaj atrybutu do wyliczenia kwot, które nie są Zwolnionym Przychodem w zależności o pkt
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of('') || return(0) ?};
{? var_pres('__P_107')<100 || return(0) ?};
_kod_zwol:=_a;
_zp_atr:=_b;
_bez_rodz:=0;
{? _kod_zwol='ZWPOD'
||
::ZP: brak zwolnienia przychodu art.21 ust.1 pkt 148
   _bez_rodz:=_zp_atr.ZP_BZ_26
|? _kod_zwol='ZWPODP'
||
::ZP: brak zwolnienia przychodu art.21 ust.1 pkt 152
   _bez_rodz:=_zp_atr.ZP_BZ_152;
   __P_107.PKT_152:='T'
|? _kod_zwol='ZWPODD'
||
::ZP: brak zwolnienia przychodu art.21 ust.1 pkt 153
   _bez_rodz:=_zp_atr.ZP_BZ_153;
   __P_107.PKT_153:='T'
|? _kod_zwol='ZWPODE'
||
::ZP: brak zwolnienia przychodu art.21 ust.1 pkt 154
   _bez_rodz:=_zp_atr.ZP_BZ_154;
   __P_107.PKT_154:='T'
?};
_bez_rodz


\obl_pit8ar_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula wyliczajaca dane z systemu do tabeli tymczasowej __TAB przed
::       zapisem do tabeli VAT_POZ dla pitu PIT-8AR
::       UWAGA: Procedura korzysta z numerow rubryk!
::   WE: _a - opcjonalny numer wersji e-deklaracji.
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 13 ?};
_vern:=_a;
_Msc:=1; _Rok:=__Rok; _podatek:=0;
exec('czytaj','#stalesys',date(_Rok,12,0),KST);

exec('init_tab_1','pit');

_dod_zap:="__TAB.blank; __TAB.LP:=_a; __TAB.O:=_b; __TAB.NR:=_d; __TAB.NRK:=_e;
           {! _ind:=1..6 |! ($('__TAB.P'+$_ind+':=(_a+_b)'))(_c,_ind) !};
           __TAB.add";

_dod_zap(35,'35. Wynagrodzenie płatnika za poszczególne miesiące',417,35,0);
_dod_zap(35,'    - zgodnie z art. 28 Ordynacji podatkowej',423,35,6);
{! _lp:=1..6
|! __TAB.fld_fml('K'+$_lp,'EDIT_FORMAT',"'in_prec=0'");
   __TAB.fld_fml('K'+$_lp,'DISPLAY_FORMAT',"'out_prec=0'")
!};
__TAB.select();

{! _lp:=1..36
|! {? _lp<>35
   || _kom:=8+(_lp-1)*12;
      _dod_zap(_lp,'',_kom,_lp,0);
      _dod_zap(_lp,'',_kom+6,_lp,6)
   ?}
!};

RH.cntx_psh();
RH.index('DOK');
{!
|? RH.prefix(exec('ref_firma','ustawienia'),_Rok,_Msc);
   {? RH.first()
   || {!
      |? {? exec('licz_rhs','lista_licz',31)
         || _src:=
               {? var_pres('RU_DEKL')=var_pres('SYSLOG') &
                  RU_DEKL.find_tab(,'RU',,'=',RH.ZLE().RU,'DEKL','NAZWA','=','PIT8AR','DEKL','NR','=',_vern)
               || RU_DEKL.WIERSZ
               |? RH.ZLE().RU().K='7'
               || 3
               |? RU.K='8'
               || 1
               |? '12456'*RU.K
               || 6
               || 33
               ?};
            {? _src
            || _kw:=(exec('licza_rhs','lista_licz',961));
               {? _src=12 | _src=13 | _src=14
               || _kw:=_kw$2
               || _kw:=_kw$0
               ?};
               _podatek+=_kw;
               {? __TAB.find_key(_src,{? _Msc<7 || 0 || 6 ?})
               || ($('__TAB.K'+$(_Msc-__TAB.NRK)+'+='+$_kw))();
                  __TAB.put()
               ?}
            ?}
         ?};
         RH.next()
      !}
   ?};
   _Msc+=1;
   _Msc<=12
!};
RH.cntx_pop();
_suma:="__TAB.cntx_psh(); __TAB.prefix();
       {? __TAB.find_key(_[7],_[8])
       || {! _ind:=1..6 |! ($('__TAB.K'+$_ind+'+=_a'))(_[_ind]) !}; __TAB.put()
       ?}; __TAB.cntx_pop()";
{! _lp:=1..33
|! __TAB.prefix(_lp);
   {? __TAB.first()
   || {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,34,__TAB.NRK); __TAB.next() !}
   ?}
!};
__TAB.prefix(34);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,36,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(35);
{? __TAB.first()
|| {! |? _suma(-__TAB.K1,-__TAB.K2,-__TAB.K3,-__TAB.K4,-__TAB.K5,-__TAB.K6,36,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(36);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      __TAB.next()
   !}
?};
__TAB.prefix();
_wyn:={? ~(_podatek>0)
      || FUN.emsg('\nBrak informacji do wykazania na deklaracji \n (zerowe kwoty dochodu i podatku).'@);
         0
      || 1
      ?};
undefine();
exec('stalesys','#stalesys');
_wyn


\init_pit11p_14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula dla akcji Dolacz okna deklaracji PIT-11 dla pracownika lub zleceniobiorcy
::       dla 14 wersji e-deklaracji obowiazujacej od 18.08.2022 roku dotyczy przychodow od 1.1.2022 roku
::       (wymagana zmienna globalna __Rok-rok za ktory tworzona jest e-deklaracja)
::   WE: _a - string typ deklaracji PIT11P
::       _b - string T lub N czy tworzyc deklaracje jezeli podatnik ma juz
::       _c - string T lub N czy tworzyc deklaracje zbiorcza dla podatnika
::       _d - string T lub N czy sumowac umowy zlecenia sprzed zatrudnienia
::       _e - string T lub N czy dolaczono informacje PIT-R
::       _f - string T korekta lub N zlozenie deklaracji
::       _g - string T lub N przetwarzanie danych osobowych lub nie
::       _h - data przekazania danych osobowych
::       _i - string T lub N czy umozliwiac zmiane informacji o kosztach uzyskania
::       _j - numer wersji e-deklaracji pole VAT_DEK.NR().NR lub PIT_GRUP.NR().NR
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_j')<>type_of(0) || _j:=14 ?};
VAR_DEL.delete('pit','__PIT','__WER','__wk','__transl','us_podat','__par','__NdPOD','__P_107');
pit:=obj_new(127);
{! _nx:=1..27 |! pit[_nx]:='' !};
{! _nx:=28..obj_len(pit) |! pit[_nx]:=0 !};
::Tablica do określenia rodzaju zwolnionego przychodu wykazanego w poz 114 od 2022 roku
__P_107:=obj_new('PKT_152','PKT_153','PKT_154');
__P_107.PKT_152:=__P_107.PKT_153:=__P_107.PKT_154:='N';
_pom:=pit[3]:=obj_new(11);
_pom[2]:={? _a='PIT11P' || 'P' || 'Z' ?};
_pom[1]:=__Rok;

::tabela do zapisu w wydrukowanych deklaracjach
__par:=tab_tmp(2,'RODZAJ','STRING[1]','Rodzaj','REF','INTEGER','Ref','DEKL_REF','INTEGER','Ref DEKL_POD');

::czy wydruk dla podatnika?
_pom[4]:={? _pom[3]:=(_c='T')
         || tab_tmp(1,'OSOBA','INTEGER','Podatnik')
         || ~~
         ?};
::czy sumowac umowy zlecenie sprzed zatrudnienia'
{? _pom[3] & _pom[2]='P'
|| _pom[10]:=(_d='T')
|| _pom[10]:=0
?};
::czy przychody pochodza z wiecej niz jednego stosunku pracy
_pom[5]:=0;
::czy umozliwiac zmiane informacji o kosztach uzyskania?
_pom[6]:=_i;
::czy rejestrowac przekazanie danych osobowych?
{? _g='T'
|| _pom[9]:=_h
|| _pom[9]:=date(0,0,0)
?};

exec('czytaj','#stalesys',date(__Rok,12,0),KST);

::wysokosc kosztow uzyskania
_pom[7]:=KST.KU;
_pom[8]:=(_b='T');

pit[7]:=_f;

pit[121]:=_e;

KP.cntx_psh(); KP.index('_KARTAPO');
RH.cntx_psh(); RH.index('RACHDATA');
O.cntx_psh(); O.index('LISTYPLP');
KT.cntx_psh();
LS.cntx_psh();
O_P.cntx_psh();
us_podat:=null();
DEKL_POD.cntx_psh();
DEKL_POD.use('pod_'+$_pom[1]);
DEKL_POD.index('DEKL_PED');
ZC_N.cntx_psh();
ZC_N.index('ZC_H');
ZC.cntx_psh();
{? var_pres('ZC_INFO')>0
|| ZC_INFO.cntx_psh()
?};

__wk:=obj_new(15);
{! _nx:=1..obj_len(__wk)
|! __wk[_nx]:=obj_new(7);
   {! _ny:=1..obj_len(__wk[_nx])
   |! __wk[_nx][_ny]:=0
   !}
!};
::Wiersze ,3,4,5,7,8,10 poprzednio
::Wiersze ,4,5,6,9,10,15
::wiersz 7 dodany dla wykazania ZP dla umowy cywilnoprawnej w parametryzacji wykazywania w PIT-11
::wiersz 11 dodany dla wykazania ZP dla umowy cywilnoprawnej w parametryzacji wykazywania w PIT-11
::Należności z tytułu wymienionego w wierszu 10, otrzymane przez podatników do ukończenia 26 roku życia
::Zmiany 2022
::wiersz 8 dodany dla wykazania emerytura/renta dla umowy cywilnoprawnej w parametryzacji wykazywania w PIT-11
__transl:="{? RU_DEKL.DEKL().NR=__WER
           || __wk[1][2]:=29;  __wk[1][3]:=30; __wk[1][4]:=31;  __wk[1][5]:=32;  __wk[1][6]:=33;
              __wk[4][2]:=50;  __wk[4][3]:=0;  __wk[4][4]:=51;  __wk[4][5]:=52;  __wk[4][6]:=53;
              __wk[5][2]:=54;  __wk[5][3]:=55; __wk[5][4]:=56;  __wk[5][5]:=0;   __wk[5][6]:=57;
              __wk[6][2]:=58;  __wk[6][3]:=59; __wk[6][4]:=60;  __wk[6][5]:=0;   __wk[6][6]:=61;
              __wk[7][2]:=62;  __wk[7][3]:=63; __wk[7][4]:=64;  __wk[7][5]:=0;   __wk[7][6]:=65;
              __wk[8][2]:=66;  __wk[8][3]:=67; __wk[8][4]:=68;  __wk[8][5]:=0;   __wk[8][6]:=69;
              __wk[9][2]:=70;  __wk[9][3]:=74; __wk[9][4]:=71;  __wk[9][5]:=0;   __wk[9][6]:=72; __wk[9][7]:=73;
              __wk[10][2]:=75; __wk[10][3]:=0; __wk[10][4]:=76; __wk[10][5]:=0;  __wk[10][6]:=77;
              __wk[11][2]:=78; __wk[11][3]:=0; __wk[11][4]:=79; __wk[11][5]:=0;  __wk[11][6]:=80;
              __wk[15][2]:=90; __wk[15][3]:=91;__wk[15][4]:=92; __wk[15][5]:=93; __wk[15][6]:=94;
              RU_DEKL.WIERSZ
           || 0
           ?}
           ";
__PIT:='PIT11';
__WER:=_j;
::tabela pomocnicza dla wykrywania pokrywajacych sie okresow zatrudnienia
_pom[11]:=tab_tmp(2,'OD','DATE',,'DO','DATE',);
{? var_pres('PPK_POD')>0
|| __NdPOD:=PPK_POD.ndx_tmp('PPK_POD_OS',0,'POD_RH',,0,'OSOBA',,0,'POD_LICZ',,0,'POD_R',,0)
|| __NdPOD:=''
?}


\obl_pit11p_14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula wylicza dane do deklaracji PIT-11 z systemu dla 14 wersji ale dotyczy przychodow od 1.1.2022 roku
::       UWAGA: Procedura korzysta z numerow rubryk!
::   WE: _a - 1 - jesli jest prawidlowy symbol i wymagane dane do utworzenia deklaracji
::       _b - numer wersji e-deklaracji pole VAT_DEK.NR().NR lub PIT_GRUP.NR().NR
::       _c - 1 - ustawienie pracownika zatrudnionego przy sumowaniu zbiorczym
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 1 ?};
_b:={? var_pres('_b')>0 & type_of(_b)=type_of(0) || _b || 14 ?};
_c:={? var_pres('_c')>0 & type_of(_c)=type_of(0) || _c || 0 ?};
_prac_up:={? var_pres('_d')>100 || _d || null() ?};
_wynik:=0;
_pom:=pit[3];
us_podat:=null;
__par.erase;
::Tablica do określenia rodzaju zwolnionego przychodu wykazanego w poz 114 od 2022 roku
__P_107.PKT_152:=__P_107.PKT_153:=__P_107.PKT_154:='N';

:: sprawdzenie czy ze wzgledu na date urodzin dla osob mlodych nalezy ustalac na podstawie list plac/rachunkow
_ur_data:=P.OSOBA().UR_DATA;
{? _ur_data<>date(0,0,0)
|| _po_list:={? exec('kiedy_26ur','pit',_ur_data)<=date(_pom[1]-1,12,0) || 0 || 1 ?};
   _26ur:=exec('kiedy_26ur','pit',_ur_data);
:: Ustalenienie wieku emeryta 60 lat kobieta lub 65 mężczyzna
   _em_data:=exec('kiedy_emeryt','pit1',_ur_data,OSOBA.PLEC)
|| _26ur:=date(0,0,0);
   _po_list:=0;
   _em_data:=date(0,0,0)
?};

::wyczysc rubryki formularza wlasciwe dla podatnika
{! _nx:=11..27 |! pit[_nx]:='' !};
{! _nx:=28..obj_len(pit) |! pit[_nx]:=0 !};
pit[18]:=date(0,0,0);
pit[19]:=null();
pit[99]:=pit[101]:=pit[103]:='';
::Zmienna określająca czy mamy sumę przychodów i wystawiamy PIT-11 -> pit[126]
::Ustalenie rodzaju Podatnika zmienna pit[127]

::Tablica do wyliczania zasilkow od umow-zlecen
_zasilek:=obj_new(5);
{! _nx:=1..obj_len(_zasilek) |! _zasilek[_nx]:=0 !};
::Poprawka do błędu SPIS ER/WRT/XP/12.51/2211/0054
::zmienna do sumowania zasiłków od lipca 2022 do sprawdzenia poprawności rachunków z ZP od macierzyński
_rh_MAC:=0;

_jest_pit:=_jestwyd:=0;
VAT_DEK.cntx_psh();
VAT_DEK.index('VAT_PRAC');
VAT_DEK.prefix(P.ref(),rodzdekl,rok_dekp,okres,pit_typ);
{? VAT_DEK.last() || _jest_pit:=1 ?};
VAT_DEK.cntx_pop();
::sprawdzenie czy byla drukowana deklaracja poprzez wydruk bez e-deklaracji
{? ~_jest_pit
|| {? _pom[2]='P'
   || DEKL_POD.prefix('E',P.ref(),'(E)PIT-11','(E)PIT-11')
   || DEKL_POD.prefix('Z',P.ref(),'(E)PIT-11','(E)PIT-11')
   ?};
   {? DEKL_POD.first()
   || _jest_pit:=1
   ?}
?};
{? ~_jest_pit
|| {? _pom[2]='P'
   || DEKL_POD.prefix('E',P.ref(),'PIT-11','PIT-11')
   || DEKL_POD.prefix('Z',P.ref(),'PIT-11','PIT-11')
   ?};
   {? DEKL_POD.first()
   || _jest_pit:=_jestwyd:=1
   ?}
?};
{? ~_pom[8] & _jest_pit
|| {? _jestwyd || return(-2) || return(-1) ?}
?};

{? _pom[3]
|| {? _pom[2]='P'
   || {? ~_c
      || KP.cntx_psh();
         KP.prefix();
         {? ~KP.find_key(P.ref(),_pom[1])
         ||
::          sprawdzenie czy jest nierozliczony przychód z PPK w danym roku podatkowym
            _czy_ppk:=1;
            {? var_pres('PPK_POD')>0
            || PPK_POD.index('POD_O');
               PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
               {? PPK_POD.first()
               || _czy_ppk:=0
               ?}
            ?};
            {? ~(P.DZA~1<=_pom[1] & (P.DZ~1=0 | P.DZ~1>=_pom[1])) & _czy_ppk
            || KP.cntx_pop();
               return(0)
            || _wyn:=exec('spr_oso','pit',_jest_pit,_pom[8]);
               {? _wyn<0
               || KP.cntx_pop();
                  return(_wyn)
               ?}
            ?}
         ?};
         KP.cntx_pop()
      || P.cntx_psh();
         P.index('PRACOSOB');
         P.prefix(exec('ref_firma','ustawienia'),'P',P.OSOBA);
         {? P.first
         || _jest_P:=0;
            {!
            |? {? P.ZA='T' & P.DZA~1<=_pom[1] & (P.DZ~1=0 | P.DZ~1>=_pom[1])
               || {? var_pres('P',_prac_up)>100 & var_pres('Ndx',_prac_up)=type_of('')
                  || _prac_up.P.cntx_psh();
                     _prac_up.P.index(_prac_up.Ndx);
                     _prac_up.P.prefix();
                     {? _prac_up.P.find_key(#P.ref)
                     || _jest_P:=1
                     ?};
                     _prac_up.P.cntx_pop()
                  || _jest_P:=1
                  ?}
               ?};
               P.next & ~_jest_P
            !};
            P.cntx_pop();
            {? _jest_P & P.ZA<>'T'
            || return(0)
            || KP.cntx_psh();
               KP.prefix();
               {? ~KP.find_key(P.ref(),_pom[1])
               ||
::                sprawdzenie czy jest nierozliczony przychód z PPK w danym roku podatkowym
                  _czy_ppk:=1;
                  {? var_pres('PPK_POD')>0
                  || PPK_POD.index('POD_O');
                     PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
                     {? PPK_POD.first()
                     || _czy_ppk:=0
                     ?}
                  ?};
                  {? ~(P.DZA~1<=_pom[1] & (P.DZ~1=0 | P.DZ~1>=_pom[1])) & _czy_ppk
                  || KP.cntx_pop();
                     return(0)
                  || _wyn:=exec('spr_oso','pit',_jest_pit,_pom[8]);
                     {? _wyn<0
                     || KP.cntx_pop();
                        return(_wyn)
                     ?}
                  ?}
               ?};
               KP.cntx_pop()
            ?}
         || P.cntx_pop()
         ?}
      ?}
   || RH.index('RACHPRZ');
      RH.prefix();
      {? ~RH.find_key(P.ref,_pom[1])
      || RH.index('RACHDATA');
::       sprawdzenie czy jest nierozliczony przychód z PPK w danym roku podatkowym
         _czy_ppk:=1;
         {? var_pres('PPK_POD')>0
         || PPK_POD.index('POD_RH');
            PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
            {? PPK_POD.first()
            || _czy_ppk:=0
            ?}
         ?};
         {? _czy_ppk || return(0) ?}
      ||
::       sprawdzenie czy sa rachunki nie sa to tylko rachunki ryczałtowe w danym roku podatkowycm
::       KOD BŁĘDU: ER/WRT/XP/12.51/1802/0001 KOD ZGŁOSZENIA: NL/WRT/KALI/12.30/0741
::       Wiele deklaracji PIT-11 dla zleceniobiorcy w kilku jednostkach org. (w jednej jednostce tylko z rachunkiem
::       ryczaltowym w roku podatkowym)
         RH.prefix(P.ref(),_pom[1]);
         {? RH.first()
         || _rach:=RH.size();
            _rycz:=0;
            {!
            |? {? exec('licz_rhs','lista_licz',31) & (~exec('czy_prac','osoba',P.OSOBA,RH.DWY))
               || _rycz+=1
               ?};
               RH.next()
            !};
            RH.prefix();
::          jesli wszystkie rachunki sa ryczaltowe to nie bedzie robiony PIT-11
            {? _rach=_rycz
            || RH.index('RACHDATA');
               return(0)
            ?};
            &_rach; &_rycz
         ?}
      ?};
      RH.index('RACHDATA')
   ?}
?};

::jezeli informacja drukowana jest dla podatnika (osoby), to nie drukuj
::zwielokrotnionych informacji - kolejne wystapienia w kartotekach
{? _pom[3]
|| {? ~_pom[4].find_key(#P.OSOBA)
   || _pom[4].OSOBA:=#P.OSOBA;
      _pom[4].add
   || return(_wynik)
   ?}
?};
::data do ustalenia danych identyfikacyjnych osoby zagranicznej oraz znacznika "nierezydent"
_Zagrdat:=date(0,0,0);
_pom[5]:=0;
_liczmies:=0;
:: sprawdzenie czy sa przychody-karty podatkowe z etatu-wykonane tylko dla warunku _pom[2]='P'
_spr_et:=0;
:: kwota zasiłków z etatu bez macierzyńskich
_et_zas:=0;
:: kwota podatku od zasiłku bez macierzyńskich z etatu
_pd_zas:=0;
:: kwota zasiłków z etatu bez macierzyńskich poniżej 26 roku życia
_et_zs26:=0;
:: kwota podatku od zasiłku bez macierzyńskich z etatu poniżej 26 roku życia
_pd_zs26:=0;
:: kwota zasiłków z etatu bez macierzyńskich powyżej wieku emerytalnego
_et_zsEM:=0;
:: kwota podatku od zasiłku bez macierzyńskich z etatu powyżej wieku emerytalnego
_pd_zsEM:=0;
::Zmiany PIT-11(29) od 1 lipca 2022
_mac_kw:=obj_new('ET_MAC','PD_ET_MAC','ET_MAC26','PD_MAC26','ET_MAC_EM','PD_MAC_EM');
:: kwota zasiłków macierzyńskich z etatu
_mac_kw.ET_MAC:=0;
:: kwota podatku od zasiłku macierzyńskich z etatu
_mac_kw.PD_ET_MAC:=0;
:: kwota zasiłków macierzyńskich z etatu poniżej 26 roku życia
_mac_kw.ET_MAC26:=0;
:: kwota podatku od zasiłku macierzyńskich z etatu poniżej 26 roku życia
_mac_kw.PD_MAC26:=0;
:: kwota zasiłków macierzyńskich z etatu powyżej wieku emerytalnego
_mac_kw.ET_MAC_EM:=0;
:: kwota podatku od zasiłku bez macierzyńskich z etatu powyżej wieku emerytalnego
_mac_kw.PD_MAC_EM:=0;

:: określenie limitu ZP jeżeli w stałych systemu mamy pole KST.ZWPOD
{? var_pres('ZWPOD',KST)>0
|| _lim_ZP:=KST.ZWPOD
|| _lim_ZP:=85528
?};
:: Sprawdzenie czy w Rozliczeniu zwolnionych przychodów nie mamy już danych o jego wykorzystaniu
{? var_pres('OS_ZWPOZ')>0
|| OS_ZWPOZ.index('OS_RWR');
   OS_ZWPOZ.prefix(exec('ref_firma','ustawienia'),P.OSOBA,_pom[1],'T');
   {? OS_ZWPOZ.first()
   || {!
      |? _lim_ZP-=OS_ZWPOZ.WYK_KW;
         OS_ZWPOZ.next()
      !}
   ?}
?};
{? _lim_ZP<0 || _lim_ZP:=0 ?};
:: Na podstawie art. 26 ust. 1 pkt 2c u.p.d.o.f. odliczeniu od dochodu podlegają składki członkowskie zapłacone
:: na rzecz związków zawodowych, w wysokości nieprzekraczającej w roku podatkowym kwoty 500 zł
::(do 30.06.2022 r. limit ten wynosił 300 zł; przy czym limit w nowej wysokości stosuje się
:: do przychodów uzyskanych od 1.01.2022 r.).
::Dla przychodów od 01.01.2023 r. limit ten wynosi 840 zł
{? var_pres('LIM_SKZW',KST)>0
|| _lim_skz:=KST.LIM_SKZW
|| _lim_skz:={? _pom[1]>=2023 || 840 || 500 ?}
?};
:: Tablice do rodzajów zwolnionego przychodu do 26 lat oraz w 2022 roku art. 21 pkt 152-154
:: analiza atrybutów z linii 901 w Merit 902 do zmiany
_zp_atr:=obj_new('ZP_BZ_26','ZP_BZ_152','ZP_BZ_153','ZP_BZ_154','ZP_ZP','ZP_SKL','ZP_ZP_ET','ZP_ZP_ZL','ZP_ZP_MAC');
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 148
_zp_atr.ZP_BZ_26:=9021;
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 152
_zp_atr.ZP_BZ_152:=9028;
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 153
_zp_atr.ZP_BZ_153:=9029;
:: ZP: brak zwolnienia przychodu art.21 ust.1 pkt 154
_zp_atr.ZP_BZ_154:=90201;
:: ZP: przychód podlegający zwolnieniu
_zp_atr.ZP_ZP:=9022;
:: ZP: składki społeczne od zwolnionego przychodu
_zp_atr.ZP_SKL:=9026;
::Zmiany Polski Ład od 1 lipca 2022
:: ZP: przychód podlegający zwolnieniu z zasiłku macierzyńskiego
_zp_atr.ZP_ZP_MAC:=90203;
:: ZP: przychód podlegający zwolnieniu z etatu
_zp_atr.ZP_ZP_ET:=90204;
:: ZP: przychód podlegający zwolnieniu ze zlecenia
_zp_atr.ZP_ZP_ZL:=90205;
:: Tablica do oddelegowań - atrybuty z gałęzi 902(Xpertis) do zmiany na 901(Merit)
_oz_atr:=obj_new('OZ_SK_NST');
:: OZ: Składki niestanowiące obniżenia podstawy opodatkowania (ER/WRT/XP/23.25/2311/0060)
_oz_atr.OZ_SK_NST:=90104;


::ER/WRT/XP/22.26/2401/0021 PIT-11 - zwrot nadpłaconych składek po przekroczeniu wieku emerytalnego
::Nadpłacone składki bieżący rok
_em_951:=0;

::uwzgledniaj przychody ze stosunku pracy
{? _pom[2]='P'
|| P.cntx_psh();
::informacja dla podatnika
   {? _pom[3]
   || P.index('PRACOSOB');
      P.prefix(exec('ref_firma','ustawienia'),'P',P.OSOBA);
      P.first();
      _pom[11].erase()
   ?};
   {!
   |? KP.prefix(P.ref(),_pom[1]);
      {? KP.first()
      || {? ~__par.find_key('E',#P.ref())
         || __par.blank(); __par.RODZAJ:='E'; __par.REF:=#P.ref(); __par.add(1)
         ?};
         _od:=date(_pom[1],KP.M,1);
         {!
         |? {? ~_po_list
            || O_P.index('P_RMP');
               O_P.prefix('T',P.ref(),KP.R,KP.M);
               {? O_P.first()
               || {!
                  |? O_P.O().LT;
::                   Ustawienie bufora tabeli O dla poprawnego działania innych funkcji
::                   Wyliczenie elementów wspólnych dla obydwu warunków
::                   Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                   nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                   sumuje również rubryka 7124 Skl. ZUS opod. zag.
                     _zw_skl:=exec('licza_ls','pit',582);
::                   Składki społeczne wyliczane ponieważ doliczamy do przychodu
                     _skl:=exec('licza_ls','pit',5711,5721);
::                   Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
                     _951:=exec('licz_ls','pit',951);
::                   Odjęcie składek niestanowiących obniżenia podstawy opodatkowania (ER/WRT/XP/23.25/2311/0060)
                     _skl-=exec('licza_ls','pit',_oz_atr.OZ_SK_NST);
::                   Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                     _skl_zagr:=exec('licza_ls','pit',9015);
::                   Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                     _odd_zagr:=exec('licza_ls','pit',9011)+exec('licza_ls','pit',9012)+exec('licza_ls','pit',9013);
::                   Przychód prawa autorskie atrybutu pobieramy wg rubryki 7002
                     _prz_50:=exec('licz_ls','pit',7002);
::                   Koszty uzyskania prawa autorskie brak atrybutu pobieramy wg rubryki 7004
                     _koszt50:=exec('licz_ls','pit',7004);
::                   Składki od zwolnionego przychodu
                     _zp_skl:=exec('licza_ls','pit',_zp_atr.ZP_SKL);
::                   Przychód
                     _przych:=exec('licza_ls','pit',92)+_skl-_zp_skl-_prz_50-_zw_skl-_odd_zagr-_skl_zagr;
::                   Koszty od przychodu
                     _koszt:=exec('licza_ls','pit',931);
::                   Podatek z listy
                     _pd_list:=exec('licza_ls','pit',961);
::ER/WRT/XP/12.51/2301/0047 PIT-11(29) dla sędziów emerytów, którzy nie podlegają opłacaniu składek ZUS przychody
::wykazywane są wierszu 3 a powinny w wierszu 1
::ER/WRT/XP/12.51/2302/0035 Emeryt ma wypłaty do 10 następny mc i od IV staje się zleceniobiorcą w PIT-11 po poprawce
::ER/WRT/XP/12.51/2301/0047 przychód z IV w wierszu 1 zamiast 3
                     {? O.D>=_em_data & exec('zn_ttub','pracownik',P.OSOBA,O.D)<>null() &
                        (_ttub:=P_INFO.TTUB().KOD; _ttub<>'2010' & _ttub<>'2020')
                     ||
::                      Przychód wiersz 3. Wyliczenie danych do 3 wiersza od 2022 roku dla emeryta
::                      kobieta 60 lat lub mężczyzna 65 lat.
::                      Przychód uzyskany po ukończeniu wieku emerytalnego, trafia do wiersza 3 z wyjątkiem
::                      przychodu, który nie podlega zwolnieniu (atrybut 9011),
::                      ten trafia do wiersza 1 poza zasiłkami rubryka 650
                        _zs_lis:=0;
                        _pd_zsls:=0;
                        _pd_zwol:=0;
                        _zas_pod:=0;
                        _zp_mac:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
::                      Od 01.07.2022 rozliczenie ZP dla atrybut 9022 oraz ZP z zasiłku macierzyńskiego 90203
::                      ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                        {? _kod_zwol<>''
                        || _zp_zpkw:=exec('licza_ls','pit',_zp_atr.ZP_ZP);
                           {? O.D>=date(2022,7,1)
                           || _zp_mac:=exec('licza_ls','pit',_zp_atr.ZP_ZP_MAC);
                              {? _kod_zwol='ZWPOD'
                              || pit[110]+=(_zp_zpkw-_zp_mac);
                                 pit[113]+=_zp_mac
                              || pit[115]+=(_zp_zpkw-_zp_mac);
                                 pit[117]+=_zp_mac
                              ?}
                           || {? _kod_zwol='ZWPOD'
                              || pit[110]+=_zp_zpkw
                              || pit[115]+=_zp_zpkw
                              ?}
                           ?};
                           _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ||
::                         ZP: brak zwolnienia przychodu art.21 ust.1 pkt 154 bez oświadczenia
                           _bez_rodz:=_zp_atr.ZP_BZ_154
                        ?};
::                      Od 01.07.2022 kwota zasiłku macierzyńskiego nie jest już wartością w atrybucie
::                      kwot, które nie stanowią ZP, trzeba dodatkowo pomniejszyć przychód wyliczony z listy
::                      o różnicę kwoty macierzyńskiego oraz kwoty ZP, którą ewentualnie stanowi ta kwota
                        _bez_zwol:=exec('licza_ls','pit',_bez_rodz);
                        {? _bez_zwol
                        ||
::                         kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
                           _przych-=_bez_zwol;
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania składników w "Inne źródła"
::                         jest składową atrybutu 9011 odejmujemy rubryki 7018, 7071,
::                         które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           ||
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
                              _et_zsEM+=(_zs_lis-_mac_lis);
::                            Od 01.07.2022 kwota zasiłku macierzyńskiego stanowi ZP i nie zliczamy
::                            do wiersza 14 w którym wykazujemy zasiłki macierzyńskie w wieku emerytalnym
                              {? O.D>=date(2022,7,1)
                              || _zas_pod:=_zs_lis-_mac_lis;
                                 _przych-=(_mac_lis-_zp_mac)
                              || _zas_pod:=_zs_lis
                              ?};
                              _mac_kw.ET_MAC_EM+=(_mac_lis-_zp_mac);
::                            Jeżeli kwota z zasiłku jest pełną kwotą atrybutu 9011
                              {? _zas_pod=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu 9011
                                 _pd_zsEM+=_pd_zwol;
                                 _pd_zsls:=_pd_zwol
                              ||
::                               Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy inne składniki
::                               w atrybucie 9011
                                    {? _zas_pod>0 || _pd_zsls:=_zas_pod$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie
::                               czy nie jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu dla emeryta
                                 _pd_zsEM+=_pd_zsls
                              ?}
                           ?}
                        ||
::                         Kwota zasiłków z etatu składnik 650 do wykazywania składników w "Inne źródła"
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-exec('licz_ls','pit',7018)$2;
                           _zs_lis-=exec('licz_ls','pit',7071)$2;
                           {? _zs_lis
                           ||
::                            W przypadku, gdy mamy w kwota zasiłku to musimy pomniejszyć przychód
                              _przych-=(_zs_lis-_zp_mac);
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
::                            Trzeba sprawdzać ile kwoty zasiłku jest w ZP kwota _zp_mac wyliczona wcześniej
::                            aby odpowiednią wartość wykazać w wierszu zasiłków macierzyńskich
                              _mac_kw.ET_MAC_EM+=(_mac_lis-_zp_mac);
                              {? O.D>=date(2022,7,1)
                              || _zas_pod:=_zs_lis-_zp_mac
                              || _zas_pod:=_zs_lis
                              ?};
                              _et_zsEM+=(_zs_lis-_mac_lis);
::                            Podatek od kwot zasiłku ulga podatkowa nie jest pobrana do wyliczeń
::                            Procent podatku z listy
                              _pr_pod:=exec('licza_ls','pit',91);
                              {? _zas_pod>0 || _pd_zsls:=_zas_pod$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                            Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie jest wyższy
::                            od całkowitego podatku z listy. Jeżeli większy to ograniczamy do kwoty podatku
::                            z listy płac
                              {? _pd_zsls>_pd_list || _pd_zsls:=_pd_list ?};
::                            Łączna kwota podatku od zasiłku z etatu
                              _pd_zsEM+=_pd_zsls
                           ?}
                        ?};
::                      Przychód z etatu wiersz 1
                        pit[29]+={? _bez_zwol>0 || (_bez_zwol-_zas_pod) ?};
::                      Podatek z etatu wiersz 1 dla kwot, które nie podlegają zwolnieniu bez zasiłku
                        pit[33]+={? _pd_zwol || (_pd_zwol-_pd_zsls) ?};
::                      Zwolnione przychody od 2022 dla emeryta z etatu w wierszu 3 bez oświadczenia
::                      Przychód wiersz 3
                        pit[43]+=_przych;
::                      Koszty uzyskania wiersz 3
                        {? _przych
                        || pit[44]+=_koszt
                        || pit[30]+=_koszt
                        ?};
::                      Przychód prawa autorskie wiersz 3 brak atrybutu pobieramy wg rubryki 7002
                        pit[48]+=_prz_50;
::                      Sprawdzenie czy kwota nadpłaconych składek bieżcy rok rubryka 951 jest większa równa
::                      przychodowi z bieżącej listy to przenosimy do przychodu wiersz 1
                        {? _951<_przych+_prz_50
                        || {? pit[43]<>0
                           || pit[43]-=_951
                           || pit[48]-=_951
                           ?}
                        || {? pit[29]<>0
                           || pit[29]-=_951
                           |? pit[34]<>0
                           || pit[34]-=_951
                           || pit[43]-=_951
                           ?}
                        ?};
::                      Zaliczka podatkowa wiersz 3
                        {? _zas_pod=_bez_zwol | _pd_zsls=_pd_zwol
                        || _kw_pod:=_pd_list-_pd_zsls
                        || {? _pd_list=_pd_zwol
                           || _kw_pod:=0
                           || _kw_pod:=_pd_list-_pd_zwol-_pd_zsls
                           ?}
                        ?};
                        pit[47]+=_kw_pod;
::                      Koszty uzyskania prawa autorskie wiersz 3 brak atrybutu pobieramy wg rubryki 7004
                        pit[49]+=_koszt50;
::                      Składki społeczne do wiersza 3
                        pit[96]+=(_skl-_zp_skl-_zw_skl);
                        _em_951+=_951
                     ||
::                      Przychód wiersz 1
::                      Pobranie danych dla pracowników, którzy na koniec poprzedniego roku ukończyli 26 lat
::                      oraz nie ukończyli wieku emerytalnego 60 lat kobieta oraz 65 mężczyzna
::                      Zasiłki chorobowe obecnie wykazujemy w wierszu 15 Inne źródła, natomiast podatek od zasiłku
::                      w wierszu 15, gdy nie ma przychodów z etatu lub łącznie wierszu 1, gdy mamy łączne przychody
::                      z etatu i zasiłków. Zwolniony przychód uzyskany z art 152-154,
::                      sprawdzenie czy mamy zasiłki ZUS, które nie podlegają zwolnieniu z odpowiednich atrybutów,
::                      pozostałe składniki, które nie podlegają ZP art 152-154, te trafią do wiersza 1
::                      poza zasiłkami ZUS.
                        _zs_lis:=0;
                        _pd_zsls:=0;
                        _pd_zwol:=0;
                        _bez_zwol:=0;
                        _zas_pod:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
                        _bez_rodz:=0;
                        _zp_mac:=0;
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
::                      Od 01.07.2022 rozliczenie ZP dla atrybut 9012 oraz ZP z zasiłku macierzyńskiego 90103
::                      ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                        {? _kod_zwol<>''
                        || _zp_zpkw:=exec('licza_ls','pit',_zp_atr.ZP_ZP);
                           {? O.D>=date(2022,7,1)
                           || _zp_mac:=exec('licza_ls','pit',_zp_atr.ZP_ZP_MAC);
                              {? _kod_zwol='ZWPOD'
                              || pit[110]+=(_zp_zpkw-_zp_mac);
                                 pit[113]+=_zp_mac
                              || pit[115]+=(_zp_zpkw-_zp_mac);
                                 pit[117]+=_zp_mac
                              ?}
                           || {? _kod_zwol='ZWPOD'
                              || pit[110]+=_zp_zpkw
                              || pit[115]+=_zp_zpkw
                              ?}
                           ?};
                           _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ?};
::                      Od 01.07.2022 kwota zasiłku macierzyńskiego nie są opodatkowane w atrybucie
::                      tylko podlegają ZP dlatego trzeba sprawdzać ile kwoty zasiłku jest w ZP kwota _zp_mac
                        {? _bez_rodz<>0 & (_bez_zwol:=exec('licza_ls','pit',_bez_rodz); _bez_zwol<>0)
                        ||
::                         kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania
::                         składników w "Inne źródła" jest składową z odpowiedniego atrybutu np. 9021
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           ||
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
                              _et_zas+=(_zs_lis-_mac_lis);
::                            Od 01.07.2022 kwota zasiłku macierzyńskiego stanowi ZP i nie zliczamy
::                            do wiersza 12 w którym wykazujemy zasiłki macierzyńskie
                              {? O.D>=date(2022,7,1)
                              || _zas_pod:=_zs_lis-_mac_lis
                              || _zas_pod:=_zs_lis;
                                 _mac_kw.ET_MAC+=_mac_lis
                              ?};
::                            Jeżeli kwota z zasiłku jest pełną kwotą atrybutu np. 9011
                              {? _zas_pod=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu np. 9011
                                 _pd_zas+=_pd_zwol
                              ||
::                               Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy inne składniki
::                               w tym atrybucie
                                 {? _zas_pod>0 || _pd_zsls:=_zas_pod$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie
::                               czy nie jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu
                                 _pd_zas+=_pd_zsls
                              ?}
                           ?}
                        ||
::                         Kwota zasiłków z etatu składnik 650 do wykazywania składników w "Inne źródła"
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-exec('licz_ls','pit',7018)$2;
                           _zs_lis-=exec('licz_ls','pit',7071)$2;
                           {? _zs_lis
                           ||
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
::                            Trzeba sprawdzać ile kwoty zasiłku jest w ZP kwota _zp_mac wyliczona wcześniej
::                            aby odpowiednią wartość wykazać w wierszu zasiłków macierzyńskich
                              _mac_kw.ET_MAC+=(_mac_lis-_zp_mac);
                              _et_zas+=(_zs_lis-_mac_lis);
::                            Podatek od kwot zasiłku ulga podatkowa nie jest pobrana do wyliczeń
::                            Procent podatku z listy
                              _pr_pod:=exec('licza_ls','pit',91);
                              {? _zs_lis-_zp_mac>0 || _pd_zsls:=(_zs_lis-_zp_mac)$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                            Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie jest wyższy
::                            od całkowitego podatku z listy. Jeżeli większy to ograniczamy do kwoty podatku
::                            z listy płac
                              {? _pd_zsls>_pd_list || _pd_zsls:=_pd_list ?};
::                            Łączna kwota podatku od zasiłku z etatu
                              _pd_zas+=_pd_zsls
                           ?}
                        ?};
::                      Przychód wiersz 1 z etatu
                        pit[29]+=_przych;
::                      Odjęcie od przychodu nadpłaconych składek bieżący rok rubryka 951
                        pit[29]-=_951;
::                      Koszty uzyskania wiersz 1
                        pit[30]+=_koszt;
::                      Zaliczka podatkowa wiersz 1
                        pit[33]+=_pd_list;
::                      Przychód prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7002
                        pit[34]+=_prz_50;
::                      Koszty uzyskania prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7004
                        pit[35]+=_koszt50;
::                      Składki społeczne do wiersza 1
                        pit[95]+=(_skl-_zp_skl-_zw_skl-_951)
                     ?};
::                   Składki społeczne do zwolniony przychód
                     pit[97]+=_zp_skl;
::                   Składki zdrowotne pobrane przez płatnika wykazane w poz. 122 od 2022 roku
::                   789 Skł.zdrow.pobr. ZUS przy rozliczaniu nadpłaconych składek ZUS przez pracownika
                     pit[122]+=(exec('licza_ls','pit',57411)+exec('licz_ls','pit',789));
::                   Składki członkowskie w poz. 123 na rzecz związków zawodowych pobrane przez płatnika od 2022
::                   podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 500 zł rocznie
                     pit[123]+=exec('licza_ls','pit',1006);
                     O_P.next()
                  !}
               ?}
            || O_P.index('P_RMP');
               O_P.prefix('T',P.ref(),KP.R,KP.M);
               {? O_P.first()
               || {!
                  |? O_P.O().LT;
::                   Ustawienie bufora tabeli O dla poprawnego działania innych funkcji
                     {? O.D>_26ur
                     ||
::                      Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                      nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                      sumuje również rubryka 7124 Skl. ZUS opod. zag.
                        _zw_skl:=exec('licza_ls','pit',582);
                        _bez_zwol:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
                        _bez_rodz:=0;
                        _zp_mac:=0;
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
::                      Od 01.07.2022 rozliczenie ZP dla atrybut 9022 oraz ZP z zasiłku macierzyńskiego 90203
::                      ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                        {? _kod_zwol<>''
                        || _zp_zpkw:=exec('licza_ls','pit',_zp_atr.ZP_ZP);
                           _zp_mac:=exec('licza_ls','pit',_zp_atr.ZP_ZP_MAC);
                           {? O.D>=date(2022,7,1)
                           || pit[115]+=(_zp_zpkw-_zp_mac);
                              pit[117]+=_zp_mac
                           || pit[115]+=_zp_zpkw
                           ?};
                           _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ?};
                        {? _bez_rodz<>0 & (_bez_zwol:=exec('licza_ls','pit',_bez_rodz); _bez_zwol<>0)
                        ||
::                         Podatek z listy
                           _pd_list:=exec('licza_ls','pit',961);
::                         Kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
                           {? _bez_zwol<0 || _bez_zwol:=0 ?};
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
                           _przych:=_bez_zwol;
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania
::                         składników w "Inne źródła" jest składową z odpowiedniego atrybutu np. 9011
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           ||
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
                              _et_zas+=(_zs_lis-_mac_lis);
::                            Od 01.07.2022 kwota zasiłku macierzyńskiego stanowi ZP i nie zliczamy
::                            do wiersza 12 w którym wykazujemy zasiłki macierzyńskie
                              {? O.D>=date(2022,7,1)
                              || _zas_pod:=_zs_lis-_mac_lis
                              || _zas_pod:=_zs_lis
                              ?};
                              _mac_kw.ET_MAC+=(_mac_lis-_zp_mac);
::                            Jeżeli kwota z zasiłku jest pełną kwotą atrybutu np. 9011
                              {? _zas_pod=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu np. 9011
                                 _pd_zas+=_pd_zwol
                              ||
::                                Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy inne składniki
::                                w tym atrybucie
                                 {? _zas_pod>0 || _pd_zsls:=_zas_pod$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie
::                               jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu
                                 _pd_zas+=_pd_zsls
                              ?}
                           ?}
                        ||
::                         Kwota zasiłków z etatu składnik 650 do wykazywania składników w "Inne źródła"
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-exec('licz_ls','pit',7018)$2;
                           _zs_lis-=exec('licz_ls','pit',7071)$2;
                           {? _zs_lis
                           ||
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
::                            Trzeba sprawdzać ile kwoty zasiłku jest w ZP kwota _zp_mac wyliczona wcześniej
::                            aby odpowiednią wartość wykazać w wierszu zasiłków macierzyńskich
                              _mac_kw.ET_MAC+=(_mac_lis-_zp_mac);
                              _et_zas+=(_zs_lis-_mac_lis);
::                            Podatek z listy
                              _pd_list:=exec('licza_ls','pit',961);
::                            Podatek od kwot zasiłku ulga podatkowa nie jest pobrana do wyliczeń
::                            Procent podatku z listy
                              _pr_pod:=exec('licza_ls','pit',91);
                              {? _zs_lis-_zp_mac>0 || _pd_zsls:=(_zs_lis-_zp_mac)$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                            Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie jest wyższy
::                            od całkowitego podatku z listy. Jeżeli większy to ograniczamy do kwoty podatku
::                            z listy płac
                              {? _pd_zsls>_pd_list || _pd_zsls:=_pd_list ?};
::                            Łączna kwota podatku od zasiłku z etatu
                              _pd_zas+=_pd_zsls
                           ?}
                        ?};
::                      Składki społeczne wyliczane ponieważ doliczamy do przychodu
                        _skl:=exec('licza_ls','pit',5711,5721);
::                      Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
                        _skl-=exec('licz_ls','pit',951);
::                      Odjęcie składek niestanowiących obniżenia podstawy opodatkowania (ER/WRT/XP/23.25/2311/0060)
                        _skl-=exec('licza_ls','pit',_oz_atr.OZ_SK_NST);
::                      Składki od zwolnionego przychodu
                        _zp_skl:=exec('licza_ls','pit',_zp_atr.ZP_SKL);
::                      Przychód prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7002
                        _prz_50:=exec('licz_ls','pit',7002);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _skl_zagr:=exec('licza_ls','pit',9015);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _odd_zagr:=exec('licza_ls','pit',9011)+exec('licza_ls','pit',9012)+exec('licza_ls','pit',9013);
                        _przych:=exec('licza_ls','pit',92)+_skl-_zp_skl-_prz_50-_zw_skl-_odd_zagr-_skl_zagr;
::                      Przychód uzyskany po 26 urodzinach trafia do wiersza 1
::                      Przychód wiersz 1 z etatu
                        pit[29]+=_przych;
::                      Koszty uzyskania wiersz 1
                        pit[30]+=exec('licza_ls','pit',931);
::                      Zaliczka podatkowa wiersz 1
                        pit[33]+=exec('licza_ls','pit',961);
::                      Przychód prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7002
                        pit[34]+=_prz_50;
::                      Koszty uzyskania prawa autorskie wiersz 1 brak atrybutu pobieramy wg rubryki 7004
                        pit[35]+=exec('licz_ls','pit',7004);
::                      Składki społeczne do wiersza 1
                        pit[95]+=(_skl-_zp_skl-_zw_skl);
::                      Składki społeczne do zwolniony przychód
                        pit[97]+=_zp_skl;
::                      Składki zdrowotne pobrane przez płatnika wykazane w poz. 122 od 2022 roku
::                      789 Skł.zdrow.pobr. ZUS przy rozliczaniu nadpłaconych składek ZUS przez pracownika
                        pit[122]+=(exec('licza_ls','pit',57411)+exec('licz_ls','pit',789));
::                      Składki członkowskie w poz. 123 na rzecz związków zawodowych pobrane przez płatnika od 2022
::                      podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 500 zł rocznie
                        pit[123]+=exec('licza_ls','pit',1006)

                     |? O.D<=_26ur
                     ||
::                      Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                      nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                      sumuje również rubryka 7124 Skl. ZUS opod. zag.
                        _zw_skl:=exec('licza_ls','pit',582);
::                      Składki społeczne wyliczane ponieważ doliczamy do przychodu
                        _skl:=exec('licza_ls','pit',5711,5721);
::                      Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
                        _skl-=exec('licz_ls','pit',951);
::                      Odjęcie składek niestanowiących obniżenia podstawy opodatkowania (ER/WRT/XP/23.25/2311/0060)
                        _skl-=exec('licza_ls','pit',_oz_atr.OZ_SK_NST);
::                      Przychód prawa autorskie wiersz 2 brak atrybutu pobieramy wg rubryki 7002
                        _prz_50:=exec('licz_ls','pit',7002);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _skl_zagr:=exec('licza_ls','pit',9015);
::                      Składki społeczne od przychodu zagranicznego ponieważ nie są odliczane do przychodu
                        _odd_zagr:=exec('licza_ls','pit',9011)+exec('licza_ls','pit',9012)+exec('licza_ls','pit',9013);
::                      składki od zwolnionego przychodu
                        _zp_skl:=exec('licza_ls','pit',_zp_atr.ZP_SKL);
                        _przych:=exec('licza_ls','pit',92)+_skl-_zp_skl-_prz_50-_zw_skl-_odd_zagr-_skl_zagr;
::                      Podatek z listy
                        _pd_list:=exec('licza_ls','pit',961);
::                      Przychód uzyskany przed ukończeniem 26 roku zycia, trafia do wiersza 2 z wyjątkiem przychodu
::                      który nie podlega zwolnieniu (atrybut 9011), ten trafia do wiersza 1
::                      poza zasiłkami rubryka 650 oraz oddzielnie wykazujemy zasiłki macierzyńskie
                        _zs_lis:=0;
                        _pd_zsls:=0;
                        _pd_zwol:=0;
                        _bez_zwol:=0;
                        _mac_lis:=0;
                        _zas_pod:=0;
::                      Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                        _kod_zwol:=exec('zlicz_zp_rodz','pit1',P.ref(),O.RP,O.MP,O.ref(),null());
                        _bez_rodz:=0;
                        _zp_mac:=0;
::                      Zwolniony przychód na podstawie atrybutów do analizy jaki rodzaj wykorzystany
::                      Od 01.07.2022 rozliczenie ZP dla atrybut 9012 oraz ZP z zasiłku macierzyńskiego 90203
::                      ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                        {? _kod_zwol<>''
                        || _zp_zpkw:=exec('licza_ls','pit',_zp_atr.ZP_ZP);
                           {? O.D>=date(2022,7,1)
                           || _zp_mac:=exec('licza_ls','pit',_zp_atr.ZP_ZP_MAC);
                              {? _kod_zwol='ZWPOD'
                              || pit[110]+=(_zp_zpkw-_zp_mac);
                                 pit[113]+=_zp_mac
                              || pit[115]+=(_zp_zpkw-_zp_mac);
                                 pit[117]+=_zp_mac
                              ?}
                           || {? _kod_zwol='ZWPOD'
                              || pit[110]+=_zp_zpkw
                              || pit[115]+=_zp_zpkw
                              ?}
                           ?}
                        ?};
                        {? _kod_zwol<>''
                        || _bez_rodz:=exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ||
::                         ZP: brak zwolnienia przychodu art.21 ust.1 pkt 148 rezygnacja z ZP <26 roku życia
                           _bez_rodz:=_zp_atr.ZP_BZ_26
                        ?};
                        _bez_zwol:=exec('licza_ls','pit',_bez_rodz);
                        {? _bez_zwol
                        ||
::                         kwoty podwyższenia zasiłku macierzyńskiego są bez podatku ale zsumowane z 650
                           _pod_mac:=exec('licz_ls','pit',7018)$2+exec('licz_ls','pit',7071)$2;
                           {? _bez_zwol<0 || _bez_zwol:=0 ?};
::                         Podatek od kwot, które nie podlegają zwolnieniu
                           _pr_pod:=exec('licza_ls','pit',91);
                           {? _bez_zwol>0 || _pd_zwol:=_bez_zwol$0*_pr_pod/100$0 || _pd_zwol:=0 ?};
                           {? _pd_zwol>_pd_list || _pd_zwol:=_pd_list ?};
                           _przych-=_bez_zwol;
::                         Kwota zasiłków rubryka 650 z etatu do wykazywania
::                         składników w "Inne źródła" jest składową atrybutu 9011
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-_pod_mac;
                           {? _zs_lis
                           ||
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
::                            Trzeba sprawdzać ile kwoty zasiłku jest w ZP kwota _zp_mac wyliczona wcześniej
::                            aby odpowiednią wartość wykazać w wierszu zasiłków macierzyńskich
                              _et_zs26+=(_zs_lis-_mac_lis);
::                            Od 01.07.2022 kwota zasiłku macierzyńskiego stanowi ZP i nie zliczamy
::                            do wiersza 13 w którym wykazujemy zasiłki macierzyńskie do 26 rż.
                              {? O.D>=date(2022,7,1)
                              || _zas_pod:=_zs_lis-_mac_lis
                              || _zas_pod:=_zs_lis
                              ?};
                              _mac_kw.ET_MAC26+=(_mac_lis-_zp_mac);
::                               Jeżeli kwota z zasiłku jest pełną kwotą atrybutu 9011
                              {? _zas_pod=_bez_zwol
                              ||
::                               Kwota podatku jest wyliczona dla atrybutu 9011
                                 _pd_zs26+=_pd_zwol;
                                 _pd_zsls:=_pd_zwol
                              ||
::                               Wyliczenia podatku oddzielnie dla zasiłku, ponieważ mamy
::                               inne składniki w atrybucie 9011
                                 {? _zas_pod>0 || _pd_zsls:=_zas_pod$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                               Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie
::                               czy nie jest wyższy od całkowitego podatku z atrybutu.
::                               Jeżeli większy to ograniczamy do kwoty tego podatku
                                 {? _pd_zsls>_pd_zwol || _pd_zsls:=_pd_zwol ?};
::                               Łączna kwota podatku od zasiłku z etatu poniżej 26 roku życia
                                 _pd_zs26+=_pd_zsls
                              ?}
                           ?}
                        ||
::                         Kwota zasiłków z etatu składnik 650 do wykazywania składników w "Inne źródła"
::                         odejmujemy rubryki 7018, 7071, które nie są opodatkowane są w kwota rubryki 650
                           _zs_lis:=exec('licz_ls','pit',650)$2-exec('licz_ls','pit',7018)$2;
                           _zs_lis-=exec('licz_ls','pit',7071)$2;
                           {? _zs_lis
                           ||
::                            W przypadku, gdy mamy w kwota zasiłku to musimy pomniejszyć przychód
::                            Poprawka SPIS ER/WRT/XP/12.51/2301/0028
::                            PIT-11(29) pracownica <26lat zasiłek macierzyński potem rezygnacja ze zwolnienia
::                            z podatku kwota poz. 36 błędnie odejmowany zas. mac. po 1 lipca 2022
                              _przych-=(_zs_lis-_zp_mac);
::                            Wyliczenie kwot zasiłków do wykazania w odpowiednie pozycje z atrybutu 552
                              _mac_lis:=exec('licza_ls','pit',552)$2;
::                            Trzeba sprawdzać ile kwoty zasiłku jest w ZP kwota _zp_mac wyliczona wcześniej
::                            aby odpowiednią wartość wykazać w wierszu zasiłków macierzyńskich
                              _mac_kw.ET_MAC26+=(_mac_lis-_zp_mac);
                              _et_zs26+=(_zs_lis-_mac_lis);
::                            Podatek z listy
                              _pd_list:=exec('licza_ls','pit',961);
::                            Podatek od kwot zasiłku ulga podatkowa nie jest pobrana do wyliczeń
::                            Procent podatku z listy
                              _pr_pod:=exec('licza_ls','pit',91);
                              {? _zs_lis-_zp_mac>0 || _pd_zsls:=(_zs_lis-_zp_mac)$0*_pr_pod/100$0 || _pd_zsls:=0 ?};
::                            Podatek policzony z kwoty zasiłku bez ulgi podatkowej sprawdzenie czy nie jest wyższy
::                            od całkowitego podatku z listy. Jeżeli większy to ograniczamy do kwoty podatku
::                            z listy płac
                              {? _pd_zsls>_pd_list || _pd_zsls:=_pd_list ?};
::                            Łączna kwota podatku od zasiłku z etatu
                              _pd_zs26+=_pd_zsls
                           ?}
                        ?};

::                      Przychód z etatu wiersz 1
                        pit[29]+={? _bez_zwol>0 || (_bez_zwol-_zas_pod) ?};
::                      Podatek z etatu wiersz 1 dla kwot, które nie podlegają zwolnieniu bez zasiłku
                        pit[33]+={? _pd_zwol>0 || (_pd_zwol-_pd_zsls) ?};
::                      Zwolnione przychody od 1.08.2019 z etatu w wierszu 2
::                      Przychód wiersz 2
                        pit[36]+=_przych;
::                      Koszty uzyskania wiersz 2
                        {? _przych
                        || pit[37]+=exec('licza_ls','pit',931)
                        || pit[30]+=exec('licza_ls','pit',931)
                        ?};
::                      Przychód prawa autorskie wiersz 2 brak atrybutu pobieramy wg rubryki 7002
                        pit[41]+=_prz_50;
::                      Zaliczka podatkowa wiersz 2
                        {? _zs_lis=_bez_zwol | _pd_zsls=_pd_zwol
                        || _kw_pod:=_pd_list-_pd_zsls
                        || {? _pd_list=_pd_zwol
                           || _kw_pod:=0
                           || _kw_pod:=_pd_list-_pd_zwol-_pd_zsls
                           ?}
                        ?};
                        pit[40]+=_kw_pod;
::                      Koszty uzyskania prawa autorskie wiersz 2 brak atrybutu pobieramy wg rubryki 7004
                        pit[42]+=exec('licz_ls','pit',7004);
::                      Składki społeczne do wiersza 2
                        pit[96]+=(_skl-_zp_skl-_zw_skl);
::                      Składki społeczne do zwolniony przychód
                        pit[97]+=_zp_skl;
::                      Składki zdrowotne pobrane przez płatnika wykazane w poz. 122 od 2022 roku
::                      789 Skł.zdrow.pobr. ZUS przy rozliczaniu nadpłaconych składek ZUS przez pracownika
                        pit[122]+=(exec('licza_ls','pit',57411)+exec('licz_ls','pit',789));
::                      Składki członkowskie w poz. 123 na rzecz związków zawodowych pobrane przez płatnika od 2022
::                      podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 500 zł rocznie
                        pit[123]+=exec('licza_ls','pit',1006)
                     ?};
                     O_P.next()
                  !}
               ?}
            ?};
            _liczmies+=((KP.S2$2)<>0);
            _spr_et+=1;
            _dakp:=date(KP.R,KP.M,0);
            {? _Zagrdat<_dakp || _Zagrdat:=_dakp ?};
            KP.next()
         !};
         {? _pom[3] & ~pit[28]
         || _do:=date(_pom[1],KP.M,0);
            {? (_od~1=P.DZA~1) & (_od~2=P.DZA~2) || _od:=P.DZA ?};
            {? (_do~1=P.DZ~1) & (_do~2=P.DZ~2) || _do:=P.DZ ?};
            {? P.DZA~1<=_pom[1] & (P.DZ~1>=_pom[1] | P.DZ=date(0,0,0))
            || {? P.DZA~1=_pom[1]
               || {? P.DZA<_od | _od=date(0,0,0) || _od:=P.DZA ?}
               || _od:=date(_pom[1],1,1)
               ?};
               {? P.DZ~1=_pom[1]
               || {? P.DZ>_do || _do:=P.DZ ?}
               || _do:=date(_pom[1],12,0)
               ?}
            ?};
            {? ~_pom[11].find_tab(0,'OD',,'<=',_do,'DO',,'>=',_od)
            || _pom[11].OD:=_od;
               _pom[11].DO:=_do;
               _pom[11].add()
            || _pom[5]:=1
            ?}
         ?}
      ?};
::    Sprawdzenie nierozliczonych przychodow z PPK dla etatu do określenia czy mamy takie przychody
      {? var_pres('PPK_POD')>0
      || PPK_POD.index('POD_O');
         PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
         {? PPK_POD.first()
         || _spr_et+=1
         ?}
      ?};
      _pom[3] & P.next()
   !};
   P.cntx_pop();
:: Jeżeli składki społeczne od przychodu są ujemne to zwiększamy przychód, gdy jest dodatni
   {? pit[95]<0
   || {? pit[29]>0
      || pit[29]-=pit[95];
         pit[95]:=0
      ?}
   ?};
:: jeżeli mamy ujemny przychód w 2 wierszu i mamy koszty to "przenosimy" do wiersza źródła przychodów
   {? pit[36]<0 & pit[29]>0
   || pit[29]+=pit[36];
      pit[30]+=pit[37]
   ?};
   {? pit[29]<0 & pit[36]>0
   || pit[36]+=pit[29];
      pit[37]+=pit[30]
   ?};
   {? pit[29]<0 || pit[29]:=0 ?};
   {? pit[29]=0 & pit[30]<>0 || pit[30]:=0 ?};
   {? pit[34]<0 || pit[34]:=0 ?};
   {? pit[34]=0 & pit[35]<>0 || pit[35]:=0 ?};
   {? pit[36]<0 || pit[36]:=0 ?};
   {? pit[36]=0 & pit[37]<>0 || pit[37]:=0 ?};
   {? pit[41]<0 || pit[41]:=0 ?};
   {? pit[41]=0 & pit[42]<>0 || pit[42]:=0 ?};
   _zku:=KST.KUZ$2;
::ER/WRT/XP/12.51/2301/0037
::Pracownik ma zwiększone koszty i w roku staje się emerytem błąd w zaznaczeniu kosztów uzyskania poz. 28 w PIT-11(29)
   _sum_KU:=pit[30]+pit[37]+pit[44];
   pit[28]:={? _pom[5]
            || {? _zku*_liczmies=_sum_KU
               || 4
               |? _pom[7]*_liczmies$2=_sum_KU
               || 2
               ?}
            |? _liczmies>0
            || {? _pom[7]*_liczmies$2 = _sum_KU || 1
               |? _zku*_liczmies      = _sum_KU || 3
               ?}
            ?};
   &_zku; &_sum_KU;
   {? ~pit[28]
   || P_IPOD.index('OD');
      P_IPOD.prefix(P.ref);
      {? P_IPOD.last()
      || _p_ipod:=1;
         {!
         |? {? P_IPOD.OD>=date(_pom[1],1,1) & P_IPOD.OD<=date(_pom[1],12,0)
            || {? P_IPOD.KU='Z'
               || {? _pom[5] || pit[28]:=4 || pit[28]:=3 ?}; _p_ipod:=0
               ?}
            |? P_IPOD.OD<date(_pom[1],1,1)
            || {? P_IPOD.KU='Z'
               || {? _pom[5] || pit[28]:=4 || pit[28]:=3 ?}
               ?};
               _p_ipod:=0
            ?};
            _p_ipod & P_IPOD.prev()
         !}
      ?}
   ?};
   {? pit[28]=0
   ||  {? _pom[5] || pit[28]:=2 || pit[28]:=1 ?}
   ?};
   {? _spr_et & _pom[6]='T'
   || _kto:=P.OSOBA().NAZWISKO+' '+OSOBA.PIERWSZE;
      popup(,'Koszty uzyskania: '+&_kto,
             'określone na koniec roku '+$_pom[1]+': ('+$pit[28]+') '+
            {? pit[28]=1 | pit[28]=2 || 'podstawowe' || 'zwiększone' ?},,"pit[28]",
            '--',,,
            '1. z jednego stosunku pracy (stosunków pokrewnych)',,"pit[28]:=1",
            '3. z jednego stosunku pracy (stosunków pokrewnych), zwiększone',,"pit[28]:=3",
            '2. z więcej niż jednego stosunku pracy (stosunków pokrewnych)',,"pit[28]:=2",
            '4. z więcej niż jednego stosunku pracy (stosunków pokrewnych), zwiększone',,"pit[28]:=4")
   ?}
?};

RH.prefix(exec('ref_firma','ustawienia'),P.OSOBA,_pom[1]);
{? RH.first()
|| {? var_pres('RU_DEKL')=var_pres('SYSLOG') || RU_DEKL.prefix() ?};
   {!
   |? _um:=RH.ZLE().RU().K;
      {? ~exec('licz_rhs','lista_licz',31) & (~(',7,8,'*(','+_um+','))) &
      {? _pom[2]='Z'
      || {? ~exec('czy_prac','osoba',ZC.OSOBA,RH.DWY)
         || {? ~_pom[3] || ZC.P=P.ref() || 1 ?}
         ||
::         obsluga przypadkow ze dany pracownik nie ma wyplaty z etatu w roku-kart podatkowych
::         to nalezy PIT-11 ze zlecen wykonac dla rachunkow wystawionych podczas zatrudnienia pracownika
           _ok:=0;
           _dalej:=1;
           P.cntx_psh();
           P.index('PRACOSOB');
           P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
           {? P.first
           || KP.cntx_psh();
              KP.prefix();
              {!
              |? {? KP.find_key(P.ref(),_pom[1])
                 || _dalej:=0
                 |? P.DZA<=RH.DWY
                    & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                 || {? ~KP.find_key(P.ref(),_pom[1])
                    || _ok+=1
                    ?}
                 ?};
                 P.next() & _dalej
              !};
              KP.cntx_pop()
           ?};
           P.cntx_pop();
           &_dalej;
           &_ok
         ?}
      || {? ~_pom[3]
         || _pref:=P.ref();
            _ok:=0;
            P.cntx_psh();
            P.index('PRACOSOB');
            P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
            {? P.first()
            || {!
               |? {? P.DZA<=RH.DWY
                     & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                  || _ok:=(_pref=P.ref() & _spr_et); 0
                  || P.next()
                  ?}
               !}
            ?};
            P.cntx_pop();
            &_ok
         || _pom[10] & _spr_et | exec('czy_prac','osoba',P.OSOBA,RH.DWY) & _spr_et
         ?}
      ?}
      || _src:=
            {? var_pres('RU_DEKL')=var_pres('SYSLOG') &
               RU_DEKL.find_tab(,'RU',,'=',RH.ZLE().RU,'DEKL','NAZWA','=',__PIT,'DEKL','NR','=',__WER)
            || RU_DEKL.WIERSZ<>0
            || 2
            ?};
         {? _src
         || {? ~__par.find_key('Z',#ZC.P)
            || __par.blank(); __par.RODZAJ:='Z'; __par.REF:=#ZC.P; __par.add(1)
            ?};
            {? _Zagrdat<RH.DWY || _Zagrdat:=RH.DWY  ?};
            _skl:=exec('licza_rhs','lista_licz',5711,5721);
::          Odjęcie składek niestanowiących obniżenia podstawy opodatkowania (ER/WRT/XP/12.51/2310/0063)
            _skl-=exec('licza_rhs','lista_licz',_oz_atr.OZ_SK_NST);
::          Wyliczenie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
            _951skl:=exec('licz_rhs','lista_licz',951);
            _skl_kor:=0;
            KORN_Z.index('RH');
            KORN_Z.prefix(RH.ref(),_pom[1]);
            {? KORN_Z.first()
            || {? var_pres('_tabrub')>100 || obj_del(_tabrub) ?};
               _tabrub:=__RUB.sys_rub(5711,RH.DWY);
               {? var_pres('_tabch')>100 || obj_del(_tabch) ?};
               _tabch:=__RUB.sys_rub(5721,RH.DWY);
               _ZP:=_uzp:=0;
                  {? '1'*_um | {? var_pres('ZWPOD',RU)>0 || RH.ZLE().RU().ZWPOD='T' || 0 ?}
                  || _kod_zwol:=exec('find_kod_zp','pit1',RH.DWY);
                     {? _kod_zwol<>''
                     || _uzp:=_kod_zwol='ZWPOD';
                        _ZP:=1
                     ?}
                  ?};
               KOR_Z.index('KORN_Z');
               {!
               |? {? KORN_Z.DW~1=_pom[1]
                  || {? _tabrub.first()
                     || {!
                        |? KOR_Z.prefix(KORN_Z.ref(),__RUB.ref(_tabrub.RN));
                           {? KOR_Z.first
                           || {? ~_ZP
                              || _skl_kor+=KOR_Z.KW
                              || {? _uzp
                                 || pit[111]+=KOR_Z.KW
                                 || pit[116]+=KOR_Z.KW
                                 ?};
                                 pit[97]+=KOR_Z.KW
                              ?};
::                            W przypadku nadpłaconych składek z bieżącego roku to nie odejmujemy
::                            nadpłaconych składek z korekt (wartość ujemna)
                              {? _951skl>0 & KOR_Z.KW<0
                              || _951skl+=KOR_Z.KW
                              ?}
                           ?};
                           _tabrub.next()
                        !}
                     ?};
                     {? _tabch.first()
                     || {!
                        |? KOR_Z.prefix(KORN_Z.ref(),__RUB.ref(_tabch.RN));
                           {? KOR_Z.first
                           || {? ~_ZP
                              || _skl_kor+=KOR_Z.KW
                                 || {? _uzp
                                    || pit[111]+=KOR_Z.KW
                                    || pit[116]+=KOR_Z.KW
                                    ?};
                                    pit[97]+=KOR_Z.KW
                              ?};
::                            W przypadku nadpłaconych składek z bieżącego roku to nie odejmujemy
::                            nadpłaconych składek z korekt (wartość ujemna)
                              {? _951skl>0 & KOR_Z.KW<0
                              || _951skl+=KOR_Z.KW
                              ?}
                           ?};
                           _tabch.next()
                        !}
                     ?}
                  ?};
                  KORN_Z.next()
               !};
               {? var_pres('_tabrub')>100 || obj_del(_tabrub); &_tabrub ?};
               {? var_pres('_tabch')>100 || obj_del(_tabch); &_tabch ?};
               &_ZP; &_uzp
            ?};
            {? _951skl<0 || _951skl:=0 ?};
::          Odjęcie składek z bieżącego roku w wyniku blokady pobieramy wg rubryki 951
            _skl-=_951skl;
            {? _src=1
            || __transl();
               _wiersz:=RU_DEKL.WIERSZ;
::             sprawdzenie czy mamy ZP dla wybranego wiersza w 2019 roku to wiersz 6 dla umowy-zlecenia
               _czy_zp:=0;
::             Składki od zwolnionego przychodu atrybut 9016 mają wpływ na przychód i składki od przychodu
               _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
               {? _wiersz=6 | _wiersz=10
               || {? ~_po_list
                  || {?  RH.DWY>=_em_data
                     || {? _wiersz=6
                        || _wiersz:=8;
                           _czy_zp:=1
                        || _wiersz:=10
                        ?}
                     || {? _wiersz=6 || _wiersz:=6 || _wiersz:=10 ?}
                     ?};
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 109 i 111 lub 114 i 116
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
::                   Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                     _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
::                   Od 01.07.2022 rozliczenie ZP dla atrybut 9012 oraz ZP z zasiłku macierzyńskiego 90103
::                   ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                     {? _kod_zwol<>''
                     || _zp_zpkw:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP);
                        {? RH.DWY>=date(2022,7,1)
                        || _zp_mac:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP_MAC);
                           {? _kod_zwol='ZWPOD'
                           || pit[111]+=(_zp_zpkw-_zp_mac);
                              pit[113]+=_zp_mac
                           || pit[116]+=(_zp_zpkw-_zp_mac);
                              pit[117]+=_zp_mac
                           ?}
                        || {? _kod_zwol='ZWPOD'
                           || pit[111]+=_zp_zpkw
                           || pit[116]+=_zp_zpkw
                           ?}
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?}
                  || {? RH.DWY>_26ur
                     || {? _wiersz=6 || _wiersz:=6 || _wiersz:=10 ?}
                     |? RH.DWY<=_26ur
                     || {? _wiersz=6 || _wiersz:=7 || _wiersz:=11 ?};
                        _czy_zp:=1
                     ?};
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 110, 111 i 112 dla praktyk
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
                     {? _wiersz=6 | _wiersz=7
                     || _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
::                      Od 01.07.2022 rozliczenie ZP dla atrybut 9012 oraz ZP z zasiłku macierzyńskiego 90103
::                      ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                        {? _kod_zwol<>''
                        || _zp_zpkw:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP);
                           {? RH.DWY>=date(2022,7,1)
                           || _zp_mac:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP_MAC);
                              {? _kod_zwol='ZWPOD'
                              || pit[111]+=(_zp_zpkw-_zp_mac);
                                 pit[113]+=_zp_mac
                              || pit[116]+=(_zp_zpkw-_zp_mac);
                                 pit[117]+=_zp_mac
                              ?}
                           || {? _kod_zwol='ZWPOD'
                              || pit[111]+=_zp_zpkw
                              || pit[116]+=_zp_zpkw
                              ?}
                           ?};
::                         Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                           exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                        ?}
                     || pit[112]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                     ?}
                  ?}
               ?};
               _len:=obj_len(__wk[_wiersz]);
               _ra_92:=exec('licza_rhs','lista_licz',92);
               _ra_93:=exec('licza_rhs','lista_licz',93);
::             Koszty 50% sa liczone tylko na 7-ej pozycji.
::             Jezeli biezacy wiersz nie ma 7-ej pozycji - kosztow nie liczymy
               _ku:=RH.ZLE().RU().PKU;
               _przy50:={? _len>6 & __wk[_wiersz][7] & _ku=50 || _skl+_ra_92+_skl_kor ?};
               {! _nx:=2.._len
               |! _poz:=__wk[_wiersz][_nx];
                  {? _poz
                  || pit[_poz]+=
                        {? _nx=2 || {? _len>6 & __wk[_wiersz][7] & _ku=50 || 0 || _skl+_ra_92+_skl_kor-_zp_skl ?}
                        |? _nx=3 || _ra_93
                        |? _nx=4 || _skl+_ra_92-_ra_93+_skl_kor-_zp_skl
                        |? _nx=5 || 0
                        |? _nx=6 || exec('licza_rhs','lista_licz',961)
                        |? _nx=7 || _przy50
                        || 'przypadki nieuwzglednione'; 0
                        ?}
                  ?}
               !};
               &_len; &_przy50; &_wiersz;
               {? ~_czy_zp
               ||
::                Składki społeczne
                  pit[95]+=(_skl-_skl_kor)
               ||
::                Składki społeczne do wiersza 6
                  pit[96]+=(_skl-_zp_skl-_skl_kor)
               ?};
::             Składki społeczne do limitu ZP atrybut 9016
               pit[97]+=_zp_skl
            |? '456'*_um
            ||
::             umowy o dzielo, rada nadzorcza
               pit[54]+=(_skl+exec('licza_rhs','lista_licz',92)+_skl_kor);
               pit[55]+=exec('licza_rhs','lista_licz',93);
               pit[57]+=exec('licza_rhs','lista_licz',961);
::             Składki społeczne
               pit[95]+=(_skl+_skl_kor)
            |? '1'*_um
            ||
::             umowy zlecenia od 2019 roku
               {? ~_po_list
               ||
::                Składki od zwolnionego przychodu atrybut 9016 mają wpływ na przychód i składki od przychodu
                  _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
::                Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 109 i 111 lub 114 i 116
::                Przychód ZP do limitu ZP pobieramy atrybut 9012
::                Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                  _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
::                Od 01.07.2022 rozliczenie ZP dla atrybut 9012 oraz ZP z zasiłku macierzyńskiego 90103
::                ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                  {? _kod_zwol<>''
                  || _zp_zpkw:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP);
                     {? RH.DWY>=date(2022,7,1)
                     || _zp_mac:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP_MAC);
                        {? _kod_zwol='ZWPOD'
                        || pit[111]+=(_zp_zpkw-_zp_mac);
                           pit[113]+=_zp_mac
                        || pit[116]+=(_zp_zpkw-_zp_mac);
                           pit[117]+=_zp_mac
                        ?}
                     || {? _kod_zwol='ZWPOD'
                        || pit[111]+=_zp_zpkw
                        || pit[116]+=_zp_zpkw
                        ?}
                     ?};
::                   Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                     exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                  ?};
                  {?  RH.DWY>=_em_data & {? var_pres('ZC_INFO')>0 || RH.ZC_INFO().ZUS='T' || RH.ZLE().ZUS='T' ?}
                  ||
::                   Przychód wiersz 8. Wyliczenie danych do 8 wiersza od 2022 roku dla emeryta
::                   kobieta 60 lat lub mężczyzna 65 lat oraz podlega obowiązkowym ubezpieczeniom społecznym
::                   w rozumieniu ustawy z dnia 13 października 1998 r. o systemie ubezpieczeń społecznych
::                   (Dz. U. z 2021 r. poz. 423, z późn. zm.).
::                   Informacje o składkach ZUS, które nie zostały ujęte w przychodzie do opodatkowania
::                   nie są uwzględniane w PIT. Pobieramy z atrybut 582 z list płac ponieważ KP.S15
::                   sumuje również rubryka 7124 Skl. ZUS opod. zag.
::                   Przychód wiersz 8
                     pit[66]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                   Koszty uzyskania wiersz 8
                     pit[67]+=exec('licza_rhs','lista_licz',93);
::                   Podatek wiersz 8
                     pit[69]+=exec('licza_rhs','lista_licz',961);
::                   Składki społeczne wiersz 8
                     pit[96]+=(_skl-_zp_skl+_skl_kor)
                  ||
::                   W przypadku korekty nadpłaconych składek od rachunków dla emeryta musimy skorygować przychody
::                   w wierszu 8 jeżeli były rachunki dla niego z opłacanym. Korygujemy przychód i składki ZUS.
                     {?  RH.DWY>=_em_data & RH.KOR='T'
                     ||
::                      Przychód wiersz 8
                        pit[66]+=_skl_kor;
::                      Składki społeczne wiersz 8
                        pit[96]+=_skl_kor;
::                      Po korekta wiersz 8 zerujemy zmienna i wyliczamy wiersz 6
                        _skl_kor:=0;
::                      Przychód wiersz 6
                        pit[58]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl);
::                      Koszty uzyskania wiersz 6
                        pit[59]+=exec('licza_rhs','lista_licz',93);
::                      Podatek wiersz 6
                        pit[61]+=exec('licza_rhs','lista_licz',961);
::                      Składki społeczne wiersz 6
                        pit[95]+=(_skl-_zp_skl)
                     ||
::                      Przychód wiersz 6
                        pit[58]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                      Koszty uzyskania wiersz 6
                        pit[59]+=exec('licza_rhs','lista_licz',93);
::                      Podatek wiersz 6
                        pit[61]+=exec('licza_rhs','lista_licz',961);
::                      Składki społeczne wiersz 6
                        pit[95]+=(_skl-_zp_skl+_skl_kor)
                     ?}
                  ?};
::                Składki społeczne do limitu ZP atrybut 9016
                  pit[97]+=_zp_skl
               ||
::                Składki od zwolnionego przychodu atrybut 9016
                  _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
                  {? RH.DWY>_26ur
                  ||
::                   Przychody z rachunków wypłaconych po ukończeniu 26 roku życia do wiersza 6
::                   Przychód wiersz 6
                     pit[58]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                   Koszty uzyskania wiersz 6
                     pit[59]+=exec('licza_rhs','lista_licz',93);
::                   Podatek wiersz 6
                     pit[61]+=exec('licza_rhs','lista_licz',961);
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 100 i 102 lub 104 i 106
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
::                   Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                     _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
::                   Od 01.07.2022 rozliczenie ZP dla atrybut 9012 oraz ZP z zasiłku macierzyńskiego 90103
::                   ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                     {? _kod_zwol<>''
                     || _zp_zpkw:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP);
                        {? RH.DWY>=date(2022,7,1)
                        || _zp_mac:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP_MAC);
                           {? _kod_zwol='ZWPOD'
                           || pit[111]+=(_zp_zpkw-_zp_mac);
                              pit[113]+=_zp_mac
                           || pit[116]+=(_zp_zpkw-_zp_mac);
                              pit[117]+=_zp_mac
                           ?}
                        || {? _kod_zwol='ZWPOD'
                           || pit[111]+=_zp_zpkw
                           || pit[116]+=_zp_zpkw
                           ?}
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?};
::                   Składki społeczne wiersz 6
                     pit[95]+=(_skl-_zp_skl+_skl_kor)
                  |? RH.DWY<=_26ur
                  ||
::                   Przychody z rachunków wypłaconych do ukończenia 26 roku życia włącznie do wiersza 7
                     pit[62]+=(exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor);
::                   Koszty uzyskania wiersz 7
                     pit[63]+=exec('licza_rhs','lista_licz',93);
::                   Zaliczka podatkowa wiersz 7
                     pit[65]+=exec('licza_rhs','lista_licz',961);
::                   Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 100 i 102 lub 104 i 106
::                   Przychód ZP do limitu ZP pobieramy atrybut 9012
::                   Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
                     _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
::                   Jeżeli złożył oświadczenie o rezygnacja ZP dla <26 lat to trzeba pobrać kwoty ZP
                     {? _kod_zwol='' || _kod_zwol:='ZWPOD' ?};
::                   Od 01.07.2022 rozliczenie ZP dla atrybut 9012 oraz ZP z zasiłku macierzyńskiego 90103
::                   ZP przychód z etatu jest wyliczany jako różnica między całkowite ZP i ZP od macierzyński
                     {? _kod_zwol<>''
                     || _zp_zpkw:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP);
                        {? RH.DWY>=date(2022,7,1)
                        || _zp_mac:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP_MAC);
                           {? _kod_zwol='ZWPOD'
                           || pit[111]+=(_zp_zpkw-_zp_mac);
                              pit[113]+=_zp_mac
                           || pit[116]+=(_zp_zpkw-_zp_mac);
                              pit[117]+=_zp_mac
                           ?}
                        || {? _kod_zwol='ZWPOD'
                           || pit[111]+=_zp_zpkw
                           || pit[116]+=_zp_zpkw
                           ?}
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?};
::                   Składki społeczne do wiersza 6
                     pit[96]+=(_skl-_zp_skl+_skl_kor)
                  ?};
::                Składki społeczne do limitu ZP atrybut 9016
                  pit[97]+=_zp_skl
               ?}
            |? '23m'*_um
            ||
::             prawa autorskie
               _ra_92:=exec('licza_rhs','lista_licz',92);
               _ra_93:=exec('licza_rhs','lista_licz',93);
               {? RH.ZLE().RU().PKU=50
               || pit[73]+=_skl+_ra_92+_skl_kor
               || pit[70]+=_skl+_ra_92+_skl_kor
               ?};
               pit[74]+=_ra_93;
               pit[72]+=exec('licza_rhs','lista_licz',961);
::             Składki społeczne
               pit[95]+=(_skl+_skl_kor)
            |? 'yv'*_um
            ||
::             od 2022 nowe wiersze 10 i 11 jako ZP dla staże uczniowskie, praktyki absolwenckie
::             Przychód ZP do limitu ZP pobieramy atrybut 9012
::             Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
::             Przychody zwolnione do limitu ZP w danym roku powiązane z pozycjami 109 i 112
               _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
               {? _kod_zwol<>''
               || {? _kod_zwol='ZWPOD'
                  || pit[112]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                  || pit[116]+=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP)
                  ?};
::                Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                  exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
               ?};
::             Składki od zwolnionego przychodu atrybut 9016 mają wpływ na przychód i składki od przychodu
               _zp_skl:=exec('licza_rhs','lista_licz',_zp_atr.ZP_SKL);
::             Przychód PIT
               _przych:=exec('licza_rhs','lista_licz',92)+_skl-_zp_skl+_skl_kor;
               {? ~_po_list
               || pit[75]+=_przych;
::                Zaliczka podatkowa wiersz 10
                  pit[77]+=exec('licza_rhs','lista_licz',961);
::                Składki społeczne
                  pit[95]+=(_skl-_zp_skl+_skl_kor)
               || {? RH.DWY>_26ur
                  ||
::                   Przychody z rachunków wypłaconych po ukończeniu 26 roku życia do wiersza 10
                     pit[75]+=_przych;
::                   Zaliczka podatkowa wiersz 10
                     pit[77]+=exec('licza_rhs','lista_licz',961);
::                   Składki społeczne
                     pit[95]+=(_skl-_zp_skl+_skl_kor)
                  |? RH.DWY<=_26ur
                  ||
::                   Przychody z rachunków wypłaconych do ukończenia 26 roku życia włącznie do wiersza 11
                     pit[78]+=_przych;
::                   Zaliczka podatkowa wiersz 11
                     pit[80]+=exec('licza_rhs','lista_licz',961);
::                   Składki społeczne do wiersza 11
                     pit[96]+=(_skl-_zp_skl+_skl_kor)
                  ?}
               ?};
::             Składki społeczne do limitu ZP atrybut 9016
               pit[97]+=_zp_skl
            ||
::             inne zrodla wiersz 15
               pit[90]+=(_skl+exec('licza_rhs','lista_licz',92)+_skl_kor);
               pit[91]+=exec('licza_rhs','lista_licz',93);
               pit[94]+=exec('licza_rhs','lista_licz',961);
::             Składki społeczne
               pit[95]+=(_skl+_skl_kor)
            ?};
::          Składki zdrowotne pobrane przez płatnika wykazane w poz. 122 od 2022 roku
::          789 Skł.zdrow.pobr. ZUS przy rozliczaniu nadpłaconych składek ZUS przez pracownika
            pit[122]+=(exec('licza_rhs','lista_licz',57411)+exec('licz_rhs','lista_licz',789));
::          Składki członkowskie w poz. 123 na rzecz związków zawodowych pobrane przez płatnika od 2022
::          podlegające odliczeniu od dochodu na podstawie atrybutu do wysokości 500 zł rocznie
            pit[123]+=exec('licza_rhs','pit1',1006)
         ?};
::       obsluga zasilkow dla zleceniobiorcy od 2018 blok F od wersji PIT-11(24)-poprzednio na PIT-8C do 2017 roku
         {? RH.ZAS='T'
         || ZC_N.prefix(RH.ref());
            {? ZC_N.first()
            ||
::             Sprawdzenie jaki rodzaj zwolnionego przychodu na podstawie tabeli OS_ZWPOZ z 2022 roku
               _kod_zwol:=exec('zlicz_zp_rodz','pit1',RH.ZLE().P,RH.R,RH.M,null(),RH.ref());
::             Jeżeli złożył oświadczenie o rezygnacja ZP dla <26 lat to trzeba pobrać kwoty ZP
               {? _kod_zwol='' & RH.DWY<=_26ur || _kod_zwol:='ZWPOD' ?};
::             Kwota ZP dla urlopu macierzyńskiego wyliczana od 2022.07.01
               _zp_mac:=0;
::             Kwota macierzyńskiego liczona od 2022.07.01 w celu ustalenia kwoty ZP i samego zasiłku
               _kw_mac:=0;
               {? _kod_zwol<>''
               || {? RH.DWY>=date(2022,7,1)
                  || _zp_mac:=exec('licza_rhs','lista_licz',_zp_atr.ZP_ZP_MAC)
                  ?};
::                Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                  exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
               ?};
               {!
               |? 'wyplacone zasilki:';
                  _zas_kod:=ZC_N.R().RN;
                  {? __RUB.sys_attr(_zas_kod,1221,ZC_N.OD) | _zas_kod>=510 & _zas_kod<=517
                  || 'chorobowe';
                     _zasilek[1]+=ZC_N.KW
                  |? __RUB.sys_attr(_zas_kod,1227,ZC_N.OD) | _zas_kod=524
                  || 'macierzynskie';
::                   Od 01.07.2022 mamy ZP od urlopu macierzyńskiego i wtedy kwoty zasiłku nie wykazujemy
::                   tej kwoty w bloku F w zasiłkach dla zleceniobiorców
                     {? RH.DWY>=date(2022,7,1) & _zp_mac>0
                     || _kw_mac+=ZC_N.KW;
                        _rh_MAC+=ZC_N.KW
                     || _zasilek[2]+=ZC_N.KW
                     ?}
                  |? __RUB.sys_attr(_zas_kod,1225,ZC_N.OD) | _zas_kod=530
                  || 'opiekuncze';
                     _zasilek[3]+=ZC_N.KW
                  |? __RUB.sys_attr(_zas_kod,1222,ZC_N.OD) | _zas_kod=537
                  || 'swiadczenia reh.';
                     _zasilek[5]+=ZC_N.KW
                  ?};
                  ZC_N.next()
               !};
::             Poprawka do błędu SPIS ER/WRT/XP/12.51/2211/0054
::             Zleceniobiorca wyliczanie rachunku zasiłkowego błędnie wylicza się kwota ZP 7184 ZP: Prz. zas. mac.
::             w przypadku, gdy jest rozliczany inny zasiłek np. chorobowy
               {? RH.DWY>=date(2022,7,1) & _zp_mac>0
               || {? _zp_mac>_kw_mac || _zp_mac:=_kw_mac ?}
               ?};
               _zasilek[2]+=(_kw_mac-_zp_mac);
               &_kw_mac
            ?}
         ?}
      ?};
      RH.next()
   !};
:: przepisanie wartosci do pozycji pit, jesli są zasilki to szukamy wolnej pozycji, a jak brak to do ostatniej
   {! _nx:=1..obj_len(_zasilek) |! {? _zasilek[_nx]<0 || _zasilek[_nx]:=0 ?} !};
   _zas_kw:=0;
   {! _nx:=1..obj_len(_zasilek) |! _zas_kw+=_zasilek[_nx] !};
   {? _zas_kw
   || {! _nx:=1..obj_len(_zasilek)
      |! _zas_kw:=0;
         _zas_op:='';
         _zas_kw+=_zasilek[_nx];
         _zas_op+={? _zasilek[_nx]
                  || {? _nx=1 || 'zasiłki chorobowe, '
                     |? _nx=2 || 'zasiłki macierzyńskie, '
                     |? _nx=3 || 'zasiłki opiekuńcze, '
                     |? _nx=5 || 'świadczenia rehabilitacyjne, '
                     || ''
                     ?}
                  || ''
                  ?};
         {? +_zas_op || _zas_op:=_zas_op-2 ?};
         {? _zas_kw
         || {! _ix:=1..3
            |? _zas_kw
            |! {? pit[99+(_ix-1)*2]='' & pit[100+(_ix-1)*2]=0
               || pit[99+(_ix-1)*2]:=_zas_op;
                  pit[100+(_ix-1)*2]:=_zas_kw;
                  _zas_kw:=0
               ?}
            !};
            {? _zas_kw
            || pit[103]+=', '+_zas_op;
               pit[104]+=_zas_kw
            ?}
         ?}
      !}
   ?}
?};
::Po zliczeniu zwolnionych przychodów z etatu i zleceń ze względu na możliwość przekroczenia kwoty limitów
::Dodanie przychodów z PPK które nie zostały rozliczone na listach płac
::dla pracowników do 26 roku życia zapis do wiersz 2 poz. 36
{? _pom[2]='P' & var_pres('PPK_POD')>0
|| P.cntx_psh();
::informacja dla podatnika
   {? _pom[3]
   || P.index('PRACOSOB');
      P.prefix(exec('ref_firma','ustawienia'),'P',P.OSOBA);
      P.first()
   ?};
   {!
   |? PPK_POD.index('POD_O');
      PPK_POD.prefix(null(),P.ref(),'T',_pom[1]);
      {? PPK_POD.first()
      || {!
         |? _kod_zwol:=exec('find_kod_zp','pit1',PPK_POD.PRZ_DATA);
            {? _kod_zwol<>''
            || _uzp:=_kod_zwol='ZWPOD';
               _sum_ZP:=pit[110]+pit[111]+pit[112]+pit[115]+pit[116];
::             Sprawdzenie czy mamy ZP dla <26 lat
               {? _uzp
               || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                  || pit[110]+=PPK_POD.WYL_KW
                  || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                     || {? PPK_POD.WYL_KW>=_dop
                        || pit[110]+=_dop;
                           {? PPK_POD.PRZ_DATA>=_em_data
                           || pit[43]+=(PPK_POD.WYL_KW-_dop)
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[36]+=(PPK_POD.WYL_KW-_dop)
                           || pit[29]+=(PPK_POD.WYL_KW-_dop)
                           ?}
                        ?}
                     || {? PPK_POD.PRZ_DATA>=_em_data
                        || pit[43]+=PPK_POD.WYL_KW
                        |? PPK_POD.PRZ_DATA<=_26ur
                        || pit[36]+=PPK_POD.WYL_KW
                        || pit[29]+=PPK_POD.WYL_KW
                        ?}
                     ?}
                  ?}
               || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                  || pit[115]+=PPK_POD.WYL_KW
                  || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                     || {? PPK_POD.WYL_KW>=_dop
                        || pit[115]+=_dop;
                           {? PPK_POD.PRZ_DATA>=_em_data
                           || pit[43]+=(PPK_POD.WYL_KW-_dop)
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[36]+=(PPK_POD.WYL_KW-_dop)
                           || pit[29]+=(PPK_POD.WYL_KW-_dop)
                           ?}
                        ?}
                     || {? PPK_POD.PRZ_DATA>=_em_data
                        || pit[43]+=PPK_POD.WYL_KW
                        |? PPK_POD.PRZ_DATA<=_26ur
                        || pit[36]+=PPK_POD.WYL_KW
                        || pit[29]+=PPK_POD.WYL_KW
                        ?}
                     ?}
                  ?};
::                Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                  exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
               ?};
               &_uzp
            || {? PPK_POD.PRZ_DATA>=_em_data
               || pit[43]+=PPK_POD.WYL_KW
               |? PPK_POD.PRZ_DATA<=_26ur
               || pit[36]+=PPK_POD.WYL_KW
               || pit[29]+=PPK_POD.WYL_KW
               ?}
            ?};
            _spr_et+=1;
            PPK_POD.next()
         !}
      ?};
      _pom[3] & P.next()
   !};
   P.cntx_pop();
   {? pit[36]<0 || pit[36]:=0 ?};
   {? pit[36]=0 & pit[37]<>0 || pit[37]:=0 ?}
?};

:: Dodanie przychodów z PPK które nie zostały rozliczone z rachunkow
{? var_pres('PPK_POD')>0
|| PPK_POD.cntx_psh();
   PPK_POD.index(__NdPOD);
   PPK_POD.prefix(null(),P.OSOBA,'T',_pom[1]);
   {? PPK_POD.first()
   || RH.cntx_psh();
      {!
      |? {? PPK_POD.WYL_RH<>null()
         || _um:=PPK_POD.WYL_RH().ZLE().RU().K;
::          ER/WRT/XP/12.51/2401/0024 PIT-11 wiersz "Prawa autorskie i inne prawa, o których mowa w art. 18 ustawy"
::          a nierozliczone składki PPK są zliczane do poz. 73 zamiast 70
            _proc_PKU:=RU.PKU;
            {? ~exec('licz_rhs','lista_licz',31) & (~(',7,8,'*(','+_um+','))) &
               {? _pom[2]='Z'
               || {? ~exec('czy_prac','osoba',ZC.OSOBA,RH.DWY)
                  || {? ~_pom[3] || ZC.P=P.ref() || 1 ?}
                  ||
::         obsluga przypadkow ze dany pracownik nie ma wyplaty z etatu w roku-kart podatkowych
::         to nalezy PIT-11 ze zlecen wykonac dla rachunkow wystawionych podczas zatrudnienia pracownika
                    _ok:=0;
                    _dalej:=1;
                    P.cntx_psh();
                    P.index('PRACOSOB');
                    P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
                    {? P.first
                    || KP.cntx_psh();
                       KP.prefix();
                       {!
                       |? {? KP.find_key(P.ref(),_pom[1])
                          || _dalej:=0
                          |? P.DZA<=RH.DWY
                             & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                          || {? ~KP.find_key(P.ref(),_pom[1])
                             || _ok+=1
                             ?}
                          ?};
                          P.next() & _dalej
                       !};
                       KP.cntx_pop()
                    ?};
                    P.cntx_pop();
                    &_dalej;
                    &_ok
                  ?}
               || {? ~_pom[3]
                  || _pref:=P.ref();
                     _ok:=0;
                     P.cntx_psh();
                     P.index('PRACOSOB');
                     P.prefix(exec('ref_firma','ustawienia'),'P',ZC.OSOBA);
                     {? P.first()
                     || {!
                        |? {? P.DZA<=RH.DWY
                              & (P.DZ=date(0,0,0) | RH.DWY<=P.DZ)
                           || _ok:=(_pref=P.ref() & _spr_et); 0
                           || P.next()
                           ?}
                        !}
                     ?};
                     P.cntx_pop();
                     &_ok
                  || _pom[10] & _spr_et | exec('czy_prac','osoba',P.OSOBA,RH.DWY) & _spr_et
                  ?}
               ?}
            || {? '456'*_um
               ||
::                umowy o dzielo 20%, rady nadzorcze
                  pit[54]+=PPK_POD.WYL_KW
               |? '1'*_um | {? var_pres('ZWPOD',RU)>0 || _um<>'y' & _um<>'v' & RH.ZLE().RU().ZWPOD='T' || 0 ?}
               ||
::                umowy - zlecenia dla zleceniobiorców do 26 roku życia zapis do wiersz 7 poz. 62
::                powyżej wieku emerytalnego zapis oraz opłacane składki społeczne do wiersz 8 poz. 66
                  _rh_ZUS:=PPK_POD.WYL_RH().ZC_INFO().ZUS='T';
                  _kod_zwol:=exec('find_kod_zp','pit1',PPK_POD.PRZ_DATA);
                  {? _kod_zwol<>''
                  || _uzp:=_kod_zwol='ZWPOD';
                     _sum_ZP:=pit[110]+pit[111]+pit[112]+pit[115]+pit[116];
::                   Sprawdzenie czy mamy ZP dla <26 lat
                     {? _uzp
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                           || pit[66]+=PPK_POD.WYL_KW
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[111]+=PPK_POD.WYL_KW
                           || pit[62]+=PPK_POD.WYL_KW
                           ?}
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[111]+=_dop;
                                 {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[62]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[62]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?}
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || pit[116]+=PPK_POD.WYL_KW
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[116]+=_dop;
                                 {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[58]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[58]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?};
                     &_uzp
                  || {? PPK_POD.PRZ_DATA<=_26ur
                     || pit[62]+=PPK_POD.WYL_KW
                     || pit[58]+=PPK_POD.WYL_KW
                     ?}
                  ?}
               |? '23m'*_um
               ||
::                prawa autorskie
                  {? _proc_PKU=50
                  || pit[73]+=PPK_POD.WYL_KW
                  || pit[70]+=PPK_POD.WYL_KW
                  ?}
               |? 'yv'*_um
               ||
::                staże uczniowskie, praktyki absolwenckie do 26 roku życia zapis do wiersz 11 poz. 78
::                powyżej wieku emerytalnego zapis oraz opłacane składki społeczne do wiersz 8 poz. 66
                  _rh_ZUS:=PPK_POD.WYL_RH().ZC_INFO().ZUS='T';
                  _kod_zwol:=exec('find_kod_zp','pit1',PPK_POD.PRZ_DATA);
                  {? _kod_zwol<>''
                  || _uzp:=_kod_zwol='ZWPOD';
                     _sum_ZP:=pit[110]+pit[111]+pit[112]+pit[115]+pit[116];
::                   Sprawdzenie czy mamy ZP dla <26 lat
                     {? _uzp
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                           || pit[66]+=PPK_POD.WYL_KW
                           |? PPK_POD.PRZ_DATA<=_26ur
                           || pit[112]+=PPK_POD.WYL_KW
                           || pit[78]+=PPK_POD.WYL_KW
                           ?}
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[112]+=_dop;
                                 {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[78]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[78]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?}
                     || {? _sum_ZP+PPK_POD.WYL_KW<=_lim_ZP
                        || pit[112]+=PPK_POD.WYL_KW
                        || {? _lim_ZP>=_sum_ZP & (_dop:=_lim_ZP-_sum_ZP; _dop)>0
                           || {? PPK_POD.WYL_KW>=_dop
                              || pit[112]+=_dop;
                                 {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                                 || pit[66]+=(PPK_POD.WYL_KW-_dop)
                                 || pit[75]+=(PPK_POD.WYL_KW-_dop)
                                 ?}
                              ?}
                           || {? PPK_POD.PRZ_DATA>=_em_data & _rh_ZUS
                              || pit[66]+=PPK_POD.WYL_KW
                              || pit[75]+=PPK_POD.WYL_KW
                              ?}
                           ?}
                        ?};
::                      Ustalenie rodzaju zwolnionego przychodu w tablicy __P_107 odpowiednie pola
                        exec('kod_zwol_atr','pit1',_kod_zwol,_zp_atr)
                     ?};
                     &_uzp
                  || {? PPK_POD.PRZ_DATA<=_26ur
                     || pit[78]+=PPK_POD.WYL_KW
                     || pit[75]+=PPK_POD.WYL_KW
                     ?}
                  ?}
               ||
::                inne zrodla wiersz 15
                  pit[90]+=PPK_POD.WYL_KW
               ?}
            ?}
         ?};
         PPK_POD.next()
      !};
      RH.cntx_pop()
   ?};
   PPK_POD.cntx_pop()
?};

:: dla osób do 26 roku życia w wierszu 2 nie mogą być ujemne składki społeczne
:: lub po przekroczeniu wieku emerytalnego w wierszu 3 nie mogą być ujemne składki społeczne
:: w pozycji 96, 97 czyli muszą być kwoty z etatu sprawdzane ze zmienna _spr_et
:: dotyczy to tylko pracowników
{? _pom[2]='P'
|| {? _spr_et & (pit[36]+pit[41])=0 & (pit[43]+pit[48])=0 & (pit[96]<>0 | pit[97]<0)
   || {? pit[96]<>0
      || {? pit[95]
         || pit[95]+=pit[96];
            pit[96]:=0
         |? pit[97]
         || pit[97]+=pit[96];
            pit[96]:=0
         ?}
      ?};
      {? pit[97]<0 || pit[95]+=pit[97]; pit[97]:=0 ?}
   ?}
?};
:: kwota zasiłków z etatu wykazywana w wierszu 15 Inne źródła. Nie wykazujemy ujemnych kwot zasiłków razem
{? _et_zas<0
|| _et_zas:=0
?};
{? _et_zs26<0
|| _et_zs26:=0
?};
{? _pd_zs26<0
|| _pd_zs26:=0
?};
::Wykazywanie kwot zasiłków macierzyńskich
::Kwoty macierzyńskich z etatu z wyjątkiem do 26 roku lub dla wieku emerytalnego wykazujemy w wierszu 12
{? _mac_kw.ET_MAC<0
|| _mac_kw.ET_MAC:=0
?};
pit[81]+=_mac_kw.ET_MAC;
::Kwoty macierzyńskich do 26 roku życia wykazujemy w wierszu 13
{? _mac_kw.ET_MAC26<0
|| _mac_kw.ET_MAC26:=0
?};
pit[84]+=_mac_kw.ET_MAC26;

::Kwoty macierzyńskich po ukończeniu wieku emerytalnego wykazujemy w wierszu 14
{? _mac_kw.ET_MAC_EM<0
|| _mac_kw.ET_MAC_EM:=0
?};
pit[87]+=_mac_kw.ET_MAC_EM;

::jeżeli kwota zasiłków bez macierzyńskich jest wyższa od kwoty przychodu z etatu
::to nie pobieramy pełnej kwoty zasiłku tylko obniżamy do wysokości przychodu na listach płac
{? pit[29]<>0 & pit[29]<_et_zas || _et_zas:=pit[29] ?};
pit[90]+=_et_zas;
:: kwota zasiłków z etatu wykazywana w wierszu 15 Inne źródła do ukończenia 26 roku życia
pit[90]+=_et_zs26;
:: kwota zasiłków z etatu wykazywana w wierszu 15 Inne źródła do ukończenia dla wieku emrytalnego
pit[90]+=_et_zsEM;
:: przychód z pozycji 29 z etatu pomniejszamy o kwota zasiłków bez macierzyńskich z etatu
pit[29]-=_et_zas;
:: przychód z pozycji 29 z etatu pomniejszamy o kwota zasiłków macierzyńskich z etatu
pit[29]-=_mac_kw.ET_MAC;
{? pit[29]<0 || pit[29]:=0 ?};
:: kwota podatku od zasiłku wraz z macierzyński z etatu wykazujemy w wierszu 1 jeżeli mamy przychody z etatu,
:: jeżeli mamy zasiłek macierzyński to w wierszu 12
:: jeżeli pozostałe zasiłki to w wierszu 15
{? (_et_zas | _mac_kw.ET_MAC) & (pit[29]+pit[34])=0
|| pit[33]-=_pd_zas;
   {? _mac_kw.ET_MAC
   || pit[83]+=_pd_zas
   || pit[94]+=_pd_zas
   ?}
?};
:: kwota podatku od zasiłku wraz z macierzyński z etatu wykazujemy w wierszu 1 jeżeli mamy przychody z etatu,
:: jeżeli mamy zasiłek macierzyński to w wierszu 13
:: jeżeli pozostałe zasiłki to w wierszu 15
:: kwota podatku od zasiłku z etatu wykazujemy w wierszu 1 jeżeli mamy przychody z etatu, jeżeli nie to w wierszu 15
:: otrzymanych od 1.08.2019 do ukończenia 26 roku życia. Dla przekroczenia lub oświadczeniu o braku ZP
:: w przypadku, gdy kwoty przychodów 2 wiersza są podatek od zasiłku wykazujemy w tym wierszu łącznie
{? (_et_zs26 | _mac_kw.ET_MAC26) | _pd_zs26>0
|| {? pit[29]+pit[34]=0
   || {? pit[36]+pit[41]>0
      || pit[40]+=_pd_zs26
      |? _mac_kw.ET_MAC26>0
      || pit[86]+=_pd_zs26
      || pit[94]+=_pd_zs26
      ?}
   || pit[33]+=_pd_zs26
   ?}
?};
::jeżeli kwota zasiłków jest wyższa od kwoty przychodu z po przekroczeniu wieku emerytalnego
::to nie pobieramy pełnej kwoty zasiłku tylko obniżamy do wysokości przychodu na listach płac
{? pit[43]<>0 & pit[43]<_et_zsEM || _et_zsEM:=pit[43] ?};
:: kwota podatku od zasiłku z etatu wykazujemy w wierszu 1 jeżeli mamy przychody z etatu, jeżeli nie to w wierszu 15
:: Po przekoroczeniu wieku emerytalnego lub dla przekroczenia ZP z pkt 153 lub braku oświadczeniu o ZP
:: w przypadku, gdy kwoty przychodów 3 wiersza są podatek od zasiłku wykazujemy w tym wierszu łącznie
{? (_et_zsEM | _mac_kw.ET_MAC_EM) | _pd_zsEM>0
|| {? pit[29]+pit[34]=0
   || {? pit[43]+pit[48]>0
      || pit[47]+=_pd_zsEM
      |? _mac_kw.ET_MAC_EM>0
      || pit[89]+=_pd_zsEM
      || pit[94]+=_pd_zsEM
      ?}
   || pit[33]+=_pd_zsEM
   ?}
?};
:: Po korektach ZP 12.51_71 dla wiersza 2 mamy tylko podatek bez przychodu
:: to kwota podatku przepiszemy do pit[33] jeżeli mamy przychód pozycja 29 i 34
:: lub przychód w pit[84] do pit[86] lub do wiersza 15 pozycja 90 jeżeli mamy kwota w pozycji 94
{? pit[40]<>0 & (pit[36]+pit[41])=0
|| {? (pit[29]+pit[34])>0
   || pit[33]+=pit[40];
      pit[40]:=0
   |? pit[84]>0
   || pit[86]+=pit[40];
      pit[40]:=0
   |? pit[90]>0
   || pit[94]+=pit[40];
      pit[40]:=0
   ?}
?};
:: Jeżeli mamy zerowy przychód pit[29] oraz koszty pit[30] oraz pit[33]
:: to zerujemy koszty pit[30] oraz kwota pit[33] trzeba przepisać do kwoty zaliczki od zasiłku pit[94]
{? pit[29]=0 & pit[30]<>0 & pit[33]<>0
|| pit[30]:=0;
   {? pit[94]
   || pit[94]+=pit[33];
      pit[33]:=0
   ?}
?};
:: Po korektach ZP 12.51_71 dla wiersza 7 mamy tylko podatek bez przychodu
:: to kwota podatku przepiszemy do pit[61] jeżeli mamy przychód pozycja 58
{? pit[65]<>0 & pit[62]=0
|| {? pit[58]>0
   || pit[61]+=pit[65];
      pit[65]:=0
   ?}
?};
:: Po korektach ZP 12.51_71 dla wiersza 7 mamy tylko ujemny przychod
:: to kwota przychod przepiszemy do pit[97] jeżeli mamy kwota
{? pit[62]<0 & pit[97]<>0
|| {? pit[97]>0
   || pit[97]+=pit[62];
      pit[62]:=0
   ?}
?};
{? _pom[2]='P'
||
:: Muszą być kwoty z etatu sprawdzane ze zmienna _spr_et dotyczy to tylko pracowników
:: Po korektach KPD w 2022 roku dla wiersza 3 mamy tylko podatek pit[47] bez przychodu to kwota podatku przepiszemy
:: do pit[33] jeżeli mamy przychód pozycja pit[29]+pit[34] lub przychód w pit[87] do pit[89]
:: lub przychód pit[90] z Inne źródła wiersz 15 do pit[94]
:: Dodatkowo możemy mieć kwoty dla wiersza 2 mamy tylko podatek pit[40] bez przychodu to kwota podatku przepiszemy
:: do pit[33] jeżeli mamy przychód pozycja pit[29]+pit[34] lub przychód w pit[84] do pit[86]
:: lub przychód pit[90] z Inne źródła wiersz 15 do pit[94]
   {? _spr_et
   || {? pit[47]<>0 & (pit[43]+pit[48])=0
      || {? pit[29]+pit[34]>0
         || pit[33]+=pit[47];
            pit[47]:=0
         |? pit[87]>0
         || pit[89]+=pit[47];
            pit[47]:=0
         |? pit[90]>0
         || pit[94]+=pit[47];
            pit[47]:=0
         ?}
      ?}
   ?}
?};
::ER/WRT/XP/22.26/2401/0021 : PIT-11 - zwrot nadpłaconych składek po przekroczeniu wieku emerytalnego
::Dla pracowników, którzy mają rozliczone nadpłacone składki w bieżącym roku
::należy zmniejszyć odpowiednio kwoty składek poz. 95 lub 96 ze względu na wartość pełnych składek
::bez odjęcia nadpłaconych w bieżącym roku
{? _pom[2]='P' & _em_951 & pit[43]+pit[48]<>0
|| {? pit[96]<>0 & pit[95]=0
   || pit[96]-=_em_951
   || {? pit[95]<>0 & _em_951<=pit[95]
      || pit[95]-=_em_951
      |? pit[96]<>0 & _em_951<=pit[96]
      || pit[96]-=_em_951
      || {? pit[95]<>0 & pit[95]>pit[96] & _em_951>pit[95]
         || _nadwyzka:=_em_951-pit[95];
            pit[95]:=0;
            pit[96]-=&_nadwyzka
         || _nadwyzka:=_em_951-pit[96];
            pit[96]:=0;
            pit[95]-=&_nadwyzka
         ?}
      ?}
   ?}
?};
{? pit[34]<0 || pit[34]:=0 ?};
{? pit[43]<0 || pit[43]:=0 ?};
{? pit[48]<0 || pit[48]:=0 ?};
:: Sprawdzenie poprawności kolumny podatków. Nie mogą być wartości ujemne
{? pit[33]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 33 nie może być ujemna.'@[$pit[33]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[40]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 40 nie może być ujemna.'@[$pit[40]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[47]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 47 nie może być ujemna.'@[$pit[47]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[53]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 53 nie może być ujemna.'@[$pit[53]],
      '\nWymagane poprawienie danych w systemie do deklaracji.')
?};
{? pit[57]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 57 nie może być ujemna.'@[$pit[57]],
      '\nWymagane poprawienie danych w systemie do deklaracji.')
?};
{? pit[61]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 61 nie może być ujemna.'@[$pit[61]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[65]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 65 nie może być ujemna.'@[$pit[65]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[69]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 69 nie może być ujemna.'@[$pit[69]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[72]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 72 nie może być ujemna.'@[$pit[72]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[77]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 77 nie może być ujemna.'@[$pit[77]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[80]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 80 nie może być ujemna.'@[$pit[80]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[83]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 83 nie może być ujemna.'@[$pit[83]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[86]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 86 nie może być ujemna.'@[$pit[86]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[89]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 89 nie może być ujemna.'@[$pit[89]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[94]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej zaliczki: %1 z pozycji 94 nie może być ujemna.'@[$pit[94]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
::Składki społeczne
{? pit[95]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość składek społecznych: %1 z pozycji 95 nie może być ujemna.'@[$pit[95]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[96]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość składek społecznych: %1 z pozycji 96 nie może być ujemna.'@[$pit[96]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[97]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość składek społecznych: %1 z pozycji 97 nie może być ujemna.'@[$pit[97]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
{? pit[122]<0
|| RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Wartość pobranej składki zdrowotnej: %1 z pozycji 122 nie może być ujemna.'@[$pit[122]],
      '\nWymagane poprawienie danych w systemie.'@)
?};
pit[31]:=pit[29]+pit[34]-pit[30]-pit[35]; {? pit[31]<0 || pit[31]:=0 ?};
pit[38]:=pit[36]+pit[41]-pit[37]-pit[42]; {? pit[38]<0 || pit[38]:=0 ?};
pit[45]:=pit[43]+pit[48]-pit[44]-pit[49]; {? pit[45]<0 || pit[45]:=0 ?};
pit[51]:=pit[50]; {? pit[51]<0 || pit[51]:=0 ?};
{? pit[53]<0 || pit[53]:=0 ?};
pit[56]:=pit[54]-pit[55]; {? pit[56]<0 || pit[56]:=0 ?};
pit[60]:=pit[58]-pit[59]; {? pit[60]<0 || pit[60]:=0 ?};
pit[64]:=pit[62]-pit[63]; {? pit[64]<0 || pit[64]:=0 ?};
pit[68]:=pit[66]-pit[67]; {? pit[68]<0 || pit[68]:=0 ?};
pit[71]:=pit[70]+pit[73]-pit[74]; {? pit[71]<0 || pit[71]:=0 ?};
{? pit[75]<0 || pit[75]:=0 ?};
pit[76]:=pit[75]; {? pit[76]<0 || pit[76]:=0 ?};
{? pit[78]<0 || pit[78]:=0 ?};
pit[79]:=pit[78]; {? pit[79]<0 || pit[79]:=0 ?};
{? pit[81]<0 || pit[81]:=0 ?};
pit[82]:=pit[81]; {? pit[82]<0 || pit[82]:=0 ?};
{? pit[84]<0 || pit[84]:=0 ?};
pit[85]:=pit[84]; {? pit[85]<0 || pit[85]:=0 ?};
{? pit[87]<0 || pit[87]:=0 ?};
pit[88]:=pit[87]; {? pit[88]<0 || pit[88]:=0 ?};
pit[92]:=pit[90]-pit[91]; {? pit[92]<0 || pit[92]:=0 ?};
::Blok F suma zasilkow
pit[105]:=pit[98]+pit[100]+pit[102]+pit[104]; {? pit[105]<0 || pit[105]:=0 ?};
::Błędnie wyliczanie ZP mac od lipca 2022 na rachunkach zasiłkowych poprawka błędu ER/WRT/XP/12.51/2211/0054
_ZP_mac:=pit[113]+pit[117];
{? _rh_MAC<>0 & _ZP_mac>_rh_MAC
||
:: Jeżeli mamy przekroczenie limitu to różnica to komunikat o błędnym PIT-11 tylko, gdy mamy ZP różny rodzaj
:: Poprawka błędnego ZP z pit[113] lub pit[117], gdy nie są jednocześnie
   {? pit[113]>0 & pit[117]=0
   || pit[113]:=_rh_MAC
   |? pit[117]>0 & pit[113]=0
   || pit[117]:=_rh_MAC
   ?};
   {? pit[113]>0 & pit[117]>0
   || RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości PIT-11 w pozycji 113 lub 117 są błędne.'@,
         'Suma wartości z poz. 113 i 117 nie może być wyższa niż kwota zasiłku macierzyńskiego %1.'@[$_rh_MAC],
         '\nWymagane poprawienie danych PIT-11.'@)
   ?}
?};
::Blok G sumy zwolnionych przychodów pkt 148 oraz 152-154
{? pit[110]<0 || pit[110]:=0 ?};
{? pit[111]<0 || pit[111]:=0 ?};
{? pit[112]<0 || pit[112]:=0 ?};
{? pit[113]<0 || pit[113]:=0 ?};
:: Zmiany 2022
:: Przychody ze stosunku pracy i stosunków pokrewnych, z umów zlecenia, oraz z zasiłków macierzyńskich
:: o których mowa w art. 21 ust. 1 pkt 152-154 ustawy
{? pit[115]<0 || pit[115]:=0 ?};
{? pit[116]<0 || pit[116]:=0 ?};
{? pit[117]<0 || pit[117]:=0 ?};
pit[114]:=pit[115]+pit[116]+pit[117];
{? pit[114]<0 || pit[114]:=0 ?};
:: Zwolnione przychody z okresleniem limitu w danym roku 2019 i kolejne lata na podstawie stalych systemu
{? pit[110]>_lim_ZP
||
:: Jeżeli mamy przekroczenie limitu to różnica do pozycji 36 oraz komunikat o błędnym PIT-11
   _ZP_rozn:=pit[110]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 110 o wartość: %2.\nWykazano w pozycji 36.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot skł. na ubezp. społeczne oraz zdrowotne.'@);
   pit[36]+=_ZP_rozn;
   pit[38]:=pit[36]+pit[41]-pit[37]-pit[42];
   {? pit[38]<0 || pit[38]:=0 ?};
   pit[110]:=_lim_ZP
?};
{? pit[111]>_lim_ZP
||
:: Jeżeli mamy przekroczenie limitu to różnica do pozycji 62 oraz komunikat o błędnym PIT-11
   _ZP_rozn:=pit[111]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 111 o wartość: %2.\nWykazano w pozycji 62.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot skł. na ubezp. społeczne oraz zdrowotne.'@);
   pit[62]+=_ZP_rozn;
   pit[64]:=pit[62]-pit[63];
   {? pit[64]<0 || pit[64]:=0 ?};
   pit[111]:=_lim_ZP
?};
{? pit[112]>_lim_ZP
||
:: Jeżeli mamy przekroczenie limitu to różnica do pozycji 78 oraz komunikat o błędnym PIT-11
   _ZP_rozn:=pit[112]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.',
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 112 o wartość: %2.\nWykazano w pozycji 78.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot skł. na ubezp. społeczne oraz zdrowotne.'@);
   pit[78]+=_ZP_rozn;
   pit[79]:=pit[78];
   {? pit[79]<0 || pit[79]:=0 ?};
   pit[112]:=_lim_ZP
?};
{? pit[113]>_lim_ZP
||
:: Jeżeli mamy przekroczenie limitu to różnica do pozycji 84 oraz komunikat o błędnym PIT-11
   _ZP_rozn:=pit[113]-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.',
      'Występuje niedopuszczalne przekroczenie\n limitu zwolnionego przychodu: %1'
      ' w pozycji 113 o wartość: %2.\nWykazano w pozycji 84.'@[$_lim_ZP,$_ZP_rozn],
      '\nWymagane poprawienie kwot skł. na ubezp. społeczne oraz zdrowotne.'@);
   pit[84]+=_ZP_rozn;
   pit[85]:=pit[84];
   {? pit[85]<0 || pit[85]:=0 ?};
   pit[113]:=_lim_ZP
?};
pit[109]:=pit[110]+pit[111]+pit[112]+pit[113];
{? pit[109]<0 || pit[109]:=0 ?};
::Suma kwot ZP z art 21 pkt 148 oraz 152-154
_ZP_sum:=pit[109]+pit[114];
{? _ZP_sum>_lim_ZP
||
:: Jeżeli mamy przekroczenie sumy limitów pkt 148 oraz pkt 152-154 to komunikat o błędnym PIT-11
   _ZP_rozn:=_ZP_sum-_lim_ZP;
   RAPLS.msg(P.T,P.OSOBA().NAZWISKO,OSOBA.PIERWSZE,'Wartości do deklaracji PIT-11 są nieprawidłowe.'@,
      'Występuje niedopuszczalne przekroczenie limitu zwolnionego przychodu: %1'
      '\no wartość: %2 dla sumy: %3 poz. 109+114 '@[$_lim_ZP,$_ZP_rozn,$_ZP_sum],
      '\nWymagane poprawienie kwot przychodów, skł. na ubezpieczenie społeczne oraz zdrowotne.'@)
?};
:: Składki członkowskie na rzecz związków zawodowych pobrane przez płatnika, podlegające odliczeniu od
:: dochodu, o których mowa w art. 26 ust. 1 pkt 2c ustawy w wysokości nieprzekraczającej w roku podatkowym kwoty 500 zł
{? pit[123]<0 || pit[123]:=0 ?};
{? pit[123]>_lim_skz || pit[123]:=_lim_skz ?};

obj_del(_zp_atr); &_zp_atr;
obj_del(_oz_atr); &_oz_atr;
obj_del(_zasilek); &_zasilek;

_dochzw:=pit[32]+pit[39]+pit[46]+pit[52]+pit[93];
_blokG:=pit[106]+pit[107]+pit[108]+_ZP_sum+pit[122]+pit[123];
_przych:=pit[29]+pit[34]+pit[36]+pit[41]+pit[43]+pit[48]+pit[50]+pit[54]+pit[58]+pit[62]+pit[66];
_przych+=pit[70]+pit[73]+pit[75]+pit[78]+pit[81]+pit[84]+pit[87]+pit[90];
_blskzdr:=pit[95]+pit[96]+pit[97];

{? ~(pit[126]:=_przych+pit[105]+_dochzw+_blokG+_blskzdr)
|| return(_wynik)
?};

_adus:=exec('adresdous','osoba',_pom[1]);
{? #(_adus+1)
|| pit[6]:=OS_US.US().NU+
           {? +US.UU || ', '+US.UU || '' ?}+
           {? +US.UK & +US.MU || ', '+(6+US.UK)+' '+US.MU || '' ?};
   us_podat:=OS_US.US
|| pit[6]:='';
   us_podat:=null()
?};
::Ustalenie pola VAT_DEK.POD rodzaj Podatnika
{? var_pres('PODFIZ',KST)>0
|| pit[127]:=KST.PODFIZ
?};
::Ustalenie pola VAT_DEK.REZYDENT pole dodane w wersji 12.41 od wersji PIT-11(22)
:: jesli rezydent placi podatki w Polsce to 'T' dla nierezydenta 'N'
::ustalenie na podstawie kartoteki OS_ZNIP
::ustawienie daty sprawdzenia danych w OS_ZNIP na podstawie _Zagrdat uzyskanych przychodow z etatu i zlecen
::Brak obsługi zmiany danych identyfikacyjnych w roku podatkowym
_dataBad:={? _Zagrdat<>date(0,0,0) & _Zagrdat<date(__Rok,12,0) || _Zagrdat || date(__Rok,12,0) ?};
{? exec('szukaj_osznip','edeklar',P.OSOBA,_dataBad)
||
:: Zagraniczny numer identyfikacyjny podatnika
   pit[11]:='N';
   pit[13]:=OS_ZNIP.ZNIP;
:: Rodzaj numeru identyfikacyjnego
   pit[14]:=OS_ZNIP.RZNIP;
:: Kraj wydania numeru identyfikacyjnego
   pit[15]:=OS_ZNIP.KRAJZNIP
|| pit[11]:='T';
   pit[14]:=null();
   pit[15]:=null()
?};
{? #(1+_adus)
|| pit[19]:=OS_ADRES.KRAJ;
   pit[20]:=OS_ADRES.WOJEWODZ;
   pit[21]:=OS_ADRES.POWIAT;
   pit[22]:=OS_ADRES.GMINA;
   pit[23]:=OS_ADRES.ULICA;
   pit[24]:=OS_ADRES.DOM;
   pit[25]:=OS_ADRES.LOKAL;
   pit[26]:=OS_ADRES.MIASTO;
   pit[27]:=OS_ADRES.KOD
|| {! _nx:=19..27 |! pit[_nx]:='' !};
   pit[19]:=null
?};
&_dataBad; &_adus;

{? _a
|| P.cntx_psh();
   P.clear();
   DEKL_POD.cntx_psh();
   DEKL_POD.clear();
   {? __par.first()
   || {!
      |? DEKL_POD.blank();
         DEKL_POD.PIT:='(E)PIT-11';
         {? __par.RODZAJ='E' & P.seek(__par.REF,)
         || DEKL_POD.RODZAJ:='E'; DEKL_POD.PRAC_ET:=P.ref; DEKL_POD.OS_PODAT:=P.OSOBA
         |? P.seek(__par.REF,)
         || DEKL_POD.RODZAJ:='Z'; DEKL_POD.PRAC_ET:=P.ref; DEKL_POD.OS_PODAT:=P.OSOBA
         ?};
         {? EDIT_VAR.PIT_RODZ=''
         || DEKL_POD.DATA:=VAT_DEK.DATA
         || DEKL_POD.DATA:={? PIT_EDIT.DATA<>date(0,0,0) || PIT_EDIT.DATA || VAT_DEK.DATA ?}
         ?};
         DEKL_POD.S1:=_przych;
         DEKL_POD.S2:=pit[30]+pit[35]+pit[37]+pit[42]+pit[44]+pit[49]+pit[55]+pit[59];
         DEKL_POD.S2+=pit[63]+pit[67]+pit[74]+pit[91];
         DEKL_POD.S3:=pit[33]+pit[40]+pit[47]+pit[53]+pit[57]+pit[61]+pit[65]+pit[69];
         DEKL_POD.S3+=pit[72]+pit[77]+pit[80]+pit[83]+pit[86]+pit[89]+pit[94];
         DEKL_POD.USER:=OPERATOR.USER;
         {? DEKL_POD.add()
         || __par.DEKL_REF:=#DEKL_POD.ref();
            __par.put()
         ?};
         __par.next()
      !}
   ?};
   DEKL_POD.cntx_pop();
   P.cntx_pop()
?};
obj_del(_pom); &_pom;

{? pit[126]
|| {? _a & pit[3][9]<>date(0,0,0)
   || exec('przekaz','giodo',pit[3][9],
           'Przekazanie danych na formularzu PIT-11',
           'odbiorcą danych jest:',
           pit[6])
   ?};
   _wynik:=1
?};
_wynik


\init_pit8c_11
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formula inicjujaca PIT-8C wersja 11 ale dotyczy przychodow od 1.1.2022 roku
::   WE: _a - string typ deklaracji PIT8C
::       _b - string T lub N czy tworzyc dekl. dla zleceniobiorcy, gdy jest juz utworzona
::       _c - string T czy N przetwarzanie danych osobowych lub nie
::       _d - data przekazania danych osobowych
::----------------------------------------------------------------------------------------------------------------------
::Ze względu na brak zmian ilości wierszy korzystamy z funkcji dla 10 wersji
exec('init_pit8c_10','pit',_a,_b,_c,_d)


\obl_pit8c_11
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.51]
:: OPIS: Formula wyliczajaca dane z systemu do tablicy pit przed zapisem do tabeli VAT_POZ dla pitu PIT 8C(11) od 2022
::   WE: _a - 1 - jesli jest prawidlowy symbol i wymagane dane do utworzenia deklaracji
::----------------------------------------------------------------------------------------------------------------------
::Ze względu na brak zmian ilości wierszy korzystamy z funkcji dla 10 wersji
exec('obl_pit8c_10','pit')


\licza_rhs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [12.30]
:: OPIS: Wyliczenie kwoty z LS dla listy atrybutow.
::   WE: _a - symbol atrybutu
::       _b - symbol atrybutu
::       ...
::   WY: suma kwot
::  OLD: \licza_rhs/zlec_rh.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0)
|| return(0)
?};

_odp:=0;
_tn:=type_of(0);
{! _nra:=1.._
|! {? type_of(_[_nra])=_tn
   || _tab:=__RUB.sys_zakres(_[_nra],RH.DWY);
      {? _tab.first()
      || {!
         |? _odp+=exec('licz_rhs','lista_licz',_tab.RN_P,_tab.RN_K);
            _tab.next()
         !}
      ?};
      obj_del(_tab);
      &_tab
   ?}
!};
_odp


\obl_pit4r_13
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula wyliczajaca dane z systemu do tabeli tymczasowej __TAB przed
::       zapisem do tabeli VAT_POZ dla deklaracji PIT 4R
::       UWAGA: Procedura korzysta z numerow rubryk!
::   WE: _a - opcjonalny numer wersji e-deklaracji. W przypadku 13 wersji jest podany jako argument funkcji
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 13 ?};
_vern:=_a;
_Msc:=1; _Rok:=__Rok;
exec('init_tab_1','pit',_vern);

_dod_zap:="__TAB.blank();
      {? var_pres('_f')<>type_of(0) || _f:=0 ?};
      __TAB.LP:=_a;
      __TAB.O:=_b;
      __TAB.NR:=_d;
      __TAB.NRK:=_e;
      {! _ind:=1..6
      |! {? _f>=_ind
         || ($('__TAB.P'+$_ind+':=0'))()
         || ($('__TAB.P'+$_ind+':=(_a+_b)'))(_c,_ind-_f)
         ?}
      !};
      __TAB.add()";

_par293:=PAR_SKID.get(293);

_dod_zap(4,'4. Zaliczki na podatek pobrane od innych należności,',57,4,0);
_dod_zap(4,'w tym wynikających z umowy aktywizacyjnej',63,4,6);
_dod_zap(6,'6. Zaliczki na podatek, których pobór został',81,6,0);
_dod_zap(6,'ograniczony na podstawie art.32 ust.2 ustawy',87,6,6);
_dod_zap(7,'7. Zaliczki, które przypadały do pobrania w związku z ograniczeniem poboru',93,7,0);
_dod_zap(7,'zaliczek w poprzednich miesiącach na podstawie art.32 ust.2 ustawy',99,7,6);
_dod_zap(9,'9. Pobrany podatek, przekazany na PFRON',109,9,0);
_dod_zap(9,'oraz zakładowy fundusz rehabilitacji osób niepełnosprawnych',115,9,6);
:: Jeśli parametr 293 jest wyłączony, to wynagrodzenie z tytułu terminowego wpłacania podatku wypełniamy ręcznie
{? _par293<>'T'
|| _dod_zap(11,'11. Wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego',133,11,0);
   _dod_zap(11,'za poszczególne miesiące, zgodnie z art.28 Ordynacji podatkowej',139,11,6)
?};
_opD:='D.Pomniejszenie podlegających przekazaniu na rachunek urzędu skarbowego zaliczek';
_dod_zap(13,_opD,158,13,0);
_opD:='na podatek z art. 26eb lub art. 18db ust. o pod. doch. od osób prawnych';
_dod_zap(13,_opD,164,13,6);
{? var_pres('K1',__TAB)=20
|| _fml:="{? __TAB.NR=13 | __TAB.NR=14 || 'in_prec=2' || 'in_prec=0' ?}";
   _edi:="{? __TAB.NR=13 | __TAB.NR=14 || 'out_prec=2' || 'out_prec=0' ?}";
   {! _ind:=1..6
   |! __TAB.fld_fml('K'+$_ind,'EDIT_FORMAT',_fml);
      __TAB.fld_fml('K'+$_ind,'DISPLAY_FORMAT',_edi)
   !}
?};
__TAB.select;

_dod_zap(0,'',9,0,0);
_dod_zap(0,'',21,0,6);
_dod_zap(1,'',15,1,0);
_dod_zap(1,'',27,1,6);
_dod_zap(2,'',33,2,0);
_dod_zap(2,'',39,2,6);
_dod_zap(3,'',45,3,0);
_dod_zap(3,'',51,3,6);
_dod_zap(5,'',69,5,0);
_dod_zap(5,'',75,5,6);
_dod_zap(8,'',105,8,0);
_dod_zap(10,'',121,10,0);
_dod_zap(10,'',127,10,6);
:: Jeśli parametr 293 jest włączony, to automatycznie wyliczamy wynagrodzenie z tytułu terminowego wpłacania podatku
:: bez możliwości poprawienia wartości w okienku
{? _par293='T'
|| _dod_zap(11,'',133,11,0);
   _dod_zap(11,'',139,11,6)
?};
_dod_zap(12,'',145,12,0);
_dod_zap(12,'',151,12,6);
_dod_zap(14,'',170,14,0);
_dod_zap(14,'',176,14,6);
__TAB.index(__TAB.ndx_tmp(,1,'NR',,,'NRK',,));
__TAB.prefix();
_czy_rap:=0;
P.cntx_psh();
P.index('PRACOSOB');
P.prefix(exec('ref_firma','ustawienia'),'P');
KP.cntx_psh();
KP.index('_KARTAPO');
RH.cntx_psh();
LS.cntx_psh();
O.cntx_psh();
RH.index('DOK');
{!
|? _osoba:=null; _licz_os:=0;
   {? P.first()
   || {!
      |? {? _osoba<>P.OSOBA || _osoba:=P.OSOBA; _licz_os:=0 ?};
         KP.prefix(P.ref,_Rok,_Msc);
         {? KP.first()
         || {? __TAB.find_key(0,{? _Msc<7 || 0 || 6 ?})
            || {? KP.S4<>0 & ~_licz_os || _licz_os:=1; ($('__TAB.K'+$(_Msc-__TAB.NRK)+'+=1'))(); __TAB.put() ?}
            ?};
            {? __TAB.find_key(1,{? _Msc<7 || 0 || 6 ?})
            || ($('__TAB.K'+$(_Msc-__TAB.NRK)+'+=KP.S4$0'))(); __TAB.put()
            ?};
            _czy_rap+=KP.S4
         ?};
         P.next()
      !}
   ?};
   RH.prefix(exec('ref_firma','ustawienia'),_Rok,_Msc);
   {? RH.first()
   || _suma:="
         _wyn:=0;
         _tab:=__RUB.sys_rub(_a);
         {? _tab.first()
         || {!
            |? LS.prefix(RH.ref(),_tab.RN);
               {? LS.first() || {! |? _wyn+=LS.KW$0; LS.next() !} ?};
               _tab.next()
            !}
         ?};
         obj_del(_tab);
         _wyn
      ";
      {!
      |? {? ~exec('licz_rhs','lista_licz',31)
         || LS.use(RH.O().LT);
            LS.index('ZLEC');
            _src:=
               {? var_pres('RU_DEKL')=var_pres('SYSLOG') &
                  RU_DEKL.find_tab(,'RU',,'=',RH.ZLE().RU,'DEKL','NAZWA','=','PIT4R','DEKL','NR','=',_vern)
               || RU_DEKL.WIERSZ
               || _um:=RH.ZLE().RU().K;
                  {? 'yv'*_um
                  || 2
                  || 3
                  ?}
               ?};
            {? _src
            || {? __TAB.find_key(_src,{? _Msc<7 || 0 || 6 ?})
               || _wyn:=_suma(961);
                  _czy_rap+=_wyn;
                  ($('__TAB.K'+$(_Msc-__TAB.NRK)+'+=_a'))(_wyn);
                  __TAB.put()
               ?}
            ?}
         ?};
         RH.next
      !}
   ?};
   _Msc+=1;
   _Msc<=12
!};
RH.cntx_pop();
LS.cntx_pop();
O.cntx_pop();
KP.cntx_pop();
P.cntx_pop();
_suma:="__TAB.cntx_psh(); __TAB.prefix();
       {? __TAB.find_key(_[7],_[8])
       || {! _ind:=1..6 |! ($('__TAB.K'+$_ind+'+=_a'))(_[_ind]) !}; __TAB.put()
       ?}; __TAB.cntx_pop()";

__TAB.prefix(1);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,5,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(2);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,5,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(3);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,5,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(4);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,5,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(5);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,10,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(7);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,10,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(8);
{? __TAB.first()
|| {! |? _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,10,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(6);
{? __TAB.first()
|| {! |? _suma(-__TAB.K1,-__TAB.K2,-__TAB.K3,-__TAB.K4,-__TAB.K5,-__TAB.K6,10,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(9);
{? __TAB.first()
|| {! |? _suma(-__TAB.K1,-__TAB.K2,-__TAB.K3,-__TAB.K4,-__TAB.K5,-__TAB.K6,10,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(10);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6 |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?} !}; __TAB.put();
         _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,12,__TAB.NRK); __TAB.next()
      !}
?};
:: Automatyczne uzupełnienie wynagrodzenia z tytułu terminowego wpłacania podatku jeśli włączony parametr 293
:: Wartości są ustalane na podstawie pozycji "Pobrany podatek do przekazania do urzędu skarbowego"
:: Nie bierzemy pod uwagę wartości z tabeli DEKL_POD i kwot potrąceń wprowadzonych przez użytkownika
{? _par293='T'
:: Tablica do wyliczania wynagrodzenie z tytułu terminowego wpłacania podatku dochodowego
|| _art28:=obj_new(12);
:: Wyliczenie kwot potrącenia na podstawie wartości pobranego podatku (Pobrany podatek * 0,3%)
:: Zmiany od 1 lipca 2022 (Pobrany podatek * 0,6%)
   _Msc:=0;
   __TAB.prefix(10);
   {? __TAB.first()
   || {!
      |? {! _ind:=1..6
         |! _Msc+=1;
            exec('czytaj','#stalesys',date(_Rok,_Msc,0),KST,'PW_TWP');
            _art28[_Msc]:=($('__TAB.K'+$_ind))()*(KST.PW_TWP/100)
         !};
         __TAB.next()
      !}
   ?};
:: Wypełnienie __TAB wyliczonymi wartościami (zaokrąglamy dodatkowo do pełnych złotych)
   _lp:=0;
   __TAB.prefix(11);
   {? __TAB.first()
   || {!
      |? {! _ind:=1..6 |! ($('__TAB.K'+$_ind+':=_a'))(_art28[_lp+=1]$0) !};
         __TAB.put();
         __TAB.next()
      !}
   ?}
?};
__TAB.prefix(11);
{? __TAB.first()
|| {! |? _suma(-__TAB.K1,-__TAB.K2,-__TAB.K3,-__TAB.K4,-__TAB.K5,-__TAB.K6,12,__TAB.NRK); __TAB.next() !}
?};
__TAB.prefix(12);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,14,__TAB.NRK);
      __TAB.next()
   !}
?};
__TAB.prefix(13);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      _suma(-__TAB.K1,-__TAB.K2,-__TAB.K3,-__TAB.K4,-__TAB.K5,-__TAB.K6,14,__TAB.NRK);
      __TAB.next()
   !}
?};
__TAB.prefix(14);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      __TAB.next()
   !}
?};
_wyn:={? ~(_czy_rap>0)
      || FUN.emsg('\nBrak informacji do wykazania na deklaracji \n (zerowe kwoty podatku).'@); 0
      || 1
      ?};
__TAB.prefix();
_wyn


\obl_pit8ar_14
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula wyliczajaca dane z systemu do tabeli tymczasowej __TAB przed
::       zapisem do tabeli VAT_POZ dla pitu PIT-8AR
::       UWAGA: Procedura korzysta z numerow rubryk!
::   WE: _a - opcjonalny numer wersji e-deklaracji.
::----------------------------------------------------------------------------------------------------------------------
_a:={? var_pres('_a')>0 & type_of(_a)=type_of(0) || _a || 14 ?};
_vern:=_a;
_Msc:=1; _Rok:=__Rok; _podatek:=0;
exec('czytaj','#stalesys',date(_Rok,12,0),KST);

exec('init_tab_1','pit');

_dod_zap:="__TAB.blank; __TAB.LP:=_a; __TAB.O:=_b; __TAB.NR:=_d; __TAB.NRK:=_e;
           {! _ind:=1..6 |! ($('__TAB.P'+$_ind+':=(_a+_b)'))(_c,_ind) !};
           __TAB.add";

_dod_zap(37,'37. Wynagrodzenie płatnika za poszczególne miesiące',441,37,0);
_dod_zap(37,'    - zgodnie z art. 28 Ordynacji podatkowej',447,37,6);
_dod_zap(39,'D.Pomniejszenie podlegających przekazaniu na rachunek urzędu skarbowego zaliczek',466,39,0);
_dod_zap(39,'  na podatek z art. 26eb lub art. 18db ust. o pod. doch. od osób prawnych',472,39,6);
{? var_pres('K1',__TAB)=20
|| _fml:="{? __TAB.NR=39 || 'in_prec=2' || 'in_prec=0' ?}";
   _edi:="{? __TAB.NR=39 || 'out_prec=2' || 'out_prec=0' ?}";
   {! _ind:=1..6
   |! __TAB.fld_fml('K'+$_ind,'EDIT_FORMAT',_fml);
      __TAB.fld_fml('K'+$_ind,'DISPLAY_FORMAT',_edi)
   !}
?};
__TAB.select();

{! _lp:=1..41
|! {? _lp<>37 & _lp<>39
   || _kom:=8+(_lp-1)*12;
      _dod_zap(_lp,'',_kom,_lp,0);
      _dod_zap(_lp,'',_kom+6,_lp,6)
   ?}
!};

RH.cntx_psh();
RH.index('DOK');
{!
|? RH.prefix(exec('ref_firma','ustawienia'),_Rok,_Msc);
   {? RH.first()
   || {!
      |? {? exec('licz_rhs','lista_licz',31)
         || _src:=
               {? var_pres('RU_DEKL')=var_pres('SYSLOG') &
                  RU_DEKL.find_tab(,'RU',,'=',RH.ZLE().RU,'DEKL','NAZWA','=','PIT8AR','DEKL','NR','=',_vern)
               || RU_DEKL.WIERSZ
               |? RH.ZLE().RU().K='7'
               || 3
               |? RU.K='8'
               || 1
               |? '12456'*RU.K
               || 6
               || 35
               ?};
            {? _src
            || _kw:=(exec('licza_rhs','lista_licz',961));
               {? _src=14 | _src=15 | _src=16
               || _kw:=_kw$2
               || _kw:=_kw$0
               ?};
               _podatek+=_kw;
               {? __TAB.find_key(_src,{? _Msc<7 || 0 || 6 ?})
               || ($('__TAB.K'+$(_Msc-__TAB.NRK)+'+='+$_kw))();
                  __TAB.put()
               ?}
            ?}
         ?};
         RH.next()
      !}
   ?};
   _Msc+=1;
   _Msc<=12
!};
RH.cntx_pop();
_suma:="__TAB.cntx_psh(); __TAB.prefix();
       {? __TAB.find_key(_[7],_[8])
       || {! _ind:=1..6 |! ($('__TAB.K'+$_ind+'+=_a'))(_[_ind]) !}; __TAB.put()
       ?}; __TAB.cntx_pop()";
{! _lp:=1..35
|! __TAB.prefix(_lp);
   {? __TAB.first()
   || {!
      |? {! _ind:=1..6
         |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
         !};
         __TAB.put();
         _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,36,__TAB.NRK);
         __TAB.next()
      !}
   ?}
!};
__TAB.prefix(36);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,38,__TAB.NRK);
      __TAB.next()
   !}
?};
__TAB.prefix(37);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      _suma(-__TAB.K1,-__TAB.K2,-__TAB.K3,-__TAB.K4,-__TAB.K5,-__TAB.K6,38,__TAB.NRK);
      __TAB.next()
   !}
?};
__TAB.prefix(38);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      _suma(__TAB.K1,__TAB.K2,__TAB.K3,__TAB.K4,__TAB.K5,__TAB.K6,40,__TAB.NRK);
      __TAB.next()
   !}
?};
__TAB.prefix(39);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      _suma(-__TAB.K1,-__TAB.K2,-__TAB.K3,-__TAB.K4,-__TAB.K5,-__TAB.K6,40,__TAB.NRK);
      __TAB.next()
   !}
?};
__TAB.prefix(40);
{? __TAB.first()
|| {!
   |? {! _ind:=1..6
      |! {? ($('__TAB.K'+$_ind+'<0'))() || ($('__TAB.K'+$_ind+':=0'))() ?}
      !};
      __TAB.put();
      __TAB.next()
   !}
?};
__TAB.prefix();
_wyn:={? ~(_podatek>0)
      || FUN.emsg('\nBrak informacji do wykazania na deklaracji \n (zerowe kwoty dochodu i podatku).'@);
         0
      || 1
      ?};
undefine();
exec('stalesys','#stalesys');
_wyn


\tab_1_rek_po
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [DAROKR] [12.51]
:: OPIS: Formula Rekord po dla okienek wertowania tabeli __TAB dla PIT-4R i PIT-8AR
::   WE:
::   WY: '' lub akronim pola, który posisada wartość ujemną
::----------------------------------------------------------------------------------------------------------------------
_tab:=cur_tab(1,1);
{? var_pres('_tab')<100 || return('') ?};
{? _tab.K1<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$_tab.P1]);
   return('K1')
?};
{? _tab.K2<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$_tab.P2]);
   return('K2')
?};
{? _tab.K3<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$_tab.P3]);
   return('K3')
?};
{? _tab.K4<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$_tab.P4]);
   return('K4')
?};
{? _tab.K5<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$_tab.P5]);
   return('K5')
?};
{? _tab.K6<0
|| FUN.emsg('Kwota pozycji: %1 nie może być ujemna.'@[$_tab.P6]);
   return('K6')
?};
''

:Sign Version 2.0 jowisz:1045 2024/02/06 17:17:45 30fd7857e1a6b70621b1c98e2ff8fa1ffd62356722ac09afb7b37ac25fbd0f6b41c0ace96a3928ccda2c4305cbe11a492aa8967958c84d7b5f072ec5a405181751a2a514ec1e1faa89770a703318db1739aa1e0af16ed429dabc37f8af802e6fcdab9fa1b5c78f2da2c522a244b3a3c092e0e39f6c5b78616c1ffe4e5f6b8c4d
