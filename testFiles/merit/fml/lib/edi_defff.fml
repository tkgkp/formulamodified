:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: edi_defff.fml
:: Utworzony: 18.05.2016
:: Autor: AWI
::======================================================================================================================
:: Zawartość: Definiowanie komunikatów edi - flat file
::======================================================================================================================


\bledigrp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [2010]
:: OPIS: Wartosc poczatkowa EDI_D.G
::  OLD: \bledigrp/edison.fml
::----------------------------------------------------------------------------------------------------------------------
EDI_Z.C


\bl_lpedi
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [2008]
:: OPIS: nadaje kolejny numer LP
::   WY: lp
::  OLD: \bl_lpedi/edison.fml
::----------------------------------------------------------------------------------------------------------------------
EDI_D.cntx_psh();
EDI_D.index('LP');
EDI_D.prefix(EDI_Z.C);
_wyn:={? EDI_D.last() || EDI_D.LP || 0 ?} + 1;
EDI_D.cntx_pop();
_wyn


\pw_edidl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [12.10]
:: OPIS: Przed wyswietleniem pol dla importu
::  OLD: \pw_edidl/edison.fml
::----------------------------------------------------------------------------------------------------------------------
{? 'DL;UPPER'*cur_afld()
|| {? EDI_D.T='S'
   || ''
   |? cur_afld()='UPPER'
   || 0
   || exec('findfnv','#color')
   ?}
|| ''
?}


\pr_edidl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [12.10]
:: OPIS: Przed redakcja pol dla importu
::  OLD: \pr_edidl/edison.fml
::----------------------------------------------------------------------------------------------------------------------
{? 'DL;UPPER'*cur_afld() || EDI_D.T='S' || 1 ?}


\edipozcm
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [2008]
:: OPIS: pozycje zbioru komunikatow
::  OLD: \edipozcm/edison.fml
::----------------------------------------------------------------------------------------------------------------------
EDI_Z.C:=ISTDEF.ref();
EDI_D.index('LP');
EDI_D.prefix(EDI_Z.C);
EDI_D.win_sel('WER');
EDI_D.dnd_sel('WER',,'records.EDI_D',"exec('renumedid','edi_defff')");
{? EDI_D.first()
|| EDI_D.select(,,,':D')
|? FUN.ask('Brak pozycji struktury komunikatu.\nCzy dodać pozycję?'@) & exec('add_edid','edi_defff')
|| EDI_D.select(,,,':D')
?}


\add_edid
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [12.10]
:: OPIS: dodanie pozycji komunikatu jako kolejny numer
::   WY: 1-dodano 0-nie
::  OLD: \add_edid/edison.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=0;
ISTDEF.cntx_psh();
ISTDEF.clear();
ISTDEF.seek(EDI_Z.C);
{!
|? _nr:={? EDI_D.size() || EDI_D.LP+1 || 1 ?};
   EDI_D.blank();
   EDI_D.LP:=_nr;
   EDI_D.memo_set(,'OPIS');
   {? EDI_D.edit("exec('edi_d_wer_rekpo','edi_defff')")
   || exec('mimprenu','edi_imp',1,_nr,1);
      _wyn:=EDI_D.add();
      {? _wyn || EDI_D.memo_put() ?}
   || 0
   ?}
!};
ISTDEF.cntx_pop();
_wyn


\edi_d_wer_rekpo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: awi [2008]
:: OPIS: po rekord okna WER tabel EDI_D
::  OLD: \edi_d_wer_rekpo/edison.fml
::----------------------------------------------------------------------------------------------------------------------
__CHK.record(EDI_D,,'K','OP')


\usun_strukture
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [21.37]
:: OPIS: Usuwa strukturę definicji
::   WE: _a - ISTDEF.ref()
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_istdef:=_a;
EDI_D.cntx_psh();
EDI_D.index('LP');
EDI_D.prefix(_istdef);
_loop:=EDI_D.first();
{!
|? _loop
|!
   _loop:=EDI_D.del()
!};
EDI_D.cntx_pop();
~~


\renumedid
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [22.26]
:: OPIS: renumeracja EDI_D
::   WE: [_a] - ''(domyślnie) - drag&drop, 'U','D','N'-akcja do przenumerowania
::----------------------------------------------------------------------------------------------------------------------
_tryb:={? var_pres('_a')=type_of('') & (';UDN'*_a)>1 || _a || '' ?};

EDI_D.cntx_psh();
{? _tryb=''
|| _ref:=dnd_info('dest_record');
   {? EDI_D.seek(_ref) || exec('zmien_lp','#dragdrop','LP','LP') ?}
|| exec('zmien_lpa','#dragdrop','LP','LP',,,_tryb)
?};
EDI_D.cntx_pop()

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:17 af9eb8de3462bde3309f5263c524d061d1a2f8ff51cd1c5ff297d0c4bb00e1e3eb2fc808ffe8ad066a3b1fcb30a37d6158ff7fae98655cb4177faf1e1083e7358a1f4e1595ec612d50c3f4caac308cee83fb7c43495de5af9f281ab8c1ee7783f9dde750fe9ef306d7aeec6bb53feae1b44fc0eec84f6a320dff9c6b19454eae
