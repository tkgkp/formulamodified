:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: phr_xx_tab.fml
:: Utworzony: 08.03.2017
:: Autor: jaws
::======================================================================================================================
:: Zawartość: Formuły wyzwalaczy dla tabel nie związanych wprost z obszarami POC, PSZ, PRE, PBA.
::======================================================================================================================


\h_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli H.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\h_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli H.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\h_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli H.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\h_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli H.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\h_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli H.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\h_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli H.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\osoba_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli OSOBA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\osoba_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli OSOBA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\osoba_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli OSOBA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\osoba_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli OSOBA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\osoba_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli OSOBA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\osoba_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli OSOBA.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\p_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli P.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
: czy jest PSZ, POC, PRE, PBA?
{? exec('jest_lic','phr_tab')
|| exec('dok_addb','phr_tab',P)
|| 1
?}


\p_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli P.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
: czy jest PSZ, POC, PRE, PBA?
{? exec('jest_lic','phr_tab')
|| exec('dok_putb','phr_tab',P)
|| 1
?}


\p_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli P.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('jest_lic','phr_tab')
|| return(1)
?};

exec('del_ndx','#table',ZZ_OSOBA,'ZZ_LINK',P.NP_DOK,P.ZZ_DOK)


\p_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli P.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
: czy jest PSZ, POC, PRE, PBA?
{? exec('jest_lic','phr_tab')
|| exec('dok_adda','phr_tab',P,_a);
   exec('utworz_osoba','phr_dane',P)
?}


\p_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli P.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
: czy jest PSZ, POC, PRE, PBA?
{? exec('jest_lic','phr_tab')
|| exec('dok_puta','phr_tab',P,_a)
?};
~~


\p_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli P.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
: czy jest PSZ, POC, PRE, PBA?
{? exec('jest_lic','phr_tab')
|| exec('dok_dela','phr_tab',_a)
?};
~~


\stn_gr_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli STN_GR.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('stn_gr_chk','phr_xx_tab',0)


\stn_gr_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli STN_GR.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.STN_GR*'PUTB|'
|| return(1)
?};
exec('stn_gr_chk','phr_xx_tab',1)


\stn_gr_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli STN_GR.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',STN_GRP,'STN_GRP',STN_GR.ref())


\stn_gr_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli STN_GR.
::   WE: zgodne ze specyfikacją narzędzi
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.STN_GR*'PUTA|'
|| return()
?};
{? _a & do_state()=1
|| {? STN_GR.FIRMA<>bfld('FIRMA')
   || STN_GRP.cntx_psh();
      STN_GRP.index('STN_GRP');
      STN_GRP.prefix(STN_GR.ref());
      _loop:=STN_GRP.first();
      {!
      |? _loop
      |! {? STN_GRP.put(1)
         || undo('Niedozwolona modyfikacja danych tabeli STN_GRP.'@);
            STN_GRP.cntx_pop();
            return()
         ?};
         _loop:=STN_GRP.next()
      !};
      STN_GRP.cntx_pop()
   ?}
?};
~~


\stn_gr_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Sprawdza wypelnienie wymaganych pol. Wykorzystywana w wyzwalaczach przed dolacz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::   WY: wynik testu poprawności danych zależny od kontekstu wywołania:
::       - jako formuła "rekord po"
::          - akronim niewypełnionego pola
::          - akronim pola o błędnej wartości
::          - 0 w przypadku powielenia unikalnego klucza
::       - jako formuła sprawdzająca dla wyzwalaczy "dołącz przed" i "popraw przed"
::          - 1 wiersz poprawny
::          - 0 niewypełnione wymagane pole, błędna wartość pola, powielony unikalny klucz
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.STN_GR*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(STN_GR,
   $("_a.table(_b,"+$_mode+",,'FIRMA','GRUPA')")
)


\stn_grp_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli STN_GRP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('stn_grp_modb','phr_xx_tab');

exec('stn_grp_chk','phr_xx_tab',0)


\stn_grp_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli STN_GR.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.STN_GRP*'PUTB|'
|| return(1)
?};
exec('stn_grp_modb','phr_xx_tab');

exec('stn_grp_chk','phr_xx_tab',1)


\stn_grp_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Formuła wyzwalaczy przed dołączeniem i poprawieniem tabeli STN_GRP.
::   WE:
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
STN_GR.cntx_psh();
STN_GRP.FIRMA:=STN_GRP.STN_GR().FIRMA;
STN_GR.cntx_pop();
~~


\stn_grp_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.02]
:: OPIS: Sprawdza wypelnienie wymaganych pol. Wykorzystywana w wyzwalaczach przed dolacz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::   WY: wynik testu poprawności danych zależny od kontekstu wywołania:
::       - jako formuła "rekord po"
::          - akronim niewypełnionego pola
::          - akronim pola o błędnej wartości
::          - 0 w przypadku powielenia unikalnego klucza
::       - jako formuła sprawdzająca dla wyzwalaczy "dołącz przed" i "popraw przed"
::          - 1 wiersz poprawny
::          - 0 niewypełnione wymagane pole, błędna wartość pola, powielony unikalny klucz
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.STN_GRP*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(STN_GRP,
   $("_a.table(_b,"+$_mode+",,'FIRMA','STN_GR','STN')")
)

:Sign Version 2.0 jowisz:1028 2019/06/07 15:59:57 0ff0f93c4188b2d7d7763a5a0c31053efea9438e4def47e627e72fbb6771e44dad36e99dd29c0079dd2b1567cf4dea1224e0823f3c32ca38dd9e476c93a8cf5e4a4a6b1fb71bf1f7db47e99cb66198d0de15a57352d82f0aa817d7e4efd1210806ec3f49b439c2e7c6a8007e45de44f12547e2db83c8ff3a2dc47f25f7f6644f
