:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: st_gen.fml
:: Utworzony: 03.06.2020
:: Autor: WH
::======================================================================================================================
:: Zawartość: Formuły generujące coś w module statystyk
::======================================================================================================================


\gen_obj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [20.42]
:: OPIS: Formuła generująca plik st_obj.fml
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------

_can_continue:=1;
_tab:=exec('legenda_read','st_common');
::exec('select','#table',_tab);

_fml_file:='st_parse_obj.fml';
_rules:='';

_header:=
':!UTF-8\r\n'+
':: (c) Macrologic S.A. Wszelkie prawa zastrzeżone\r\n'+
'::======================================================================================================================\r\n'+
':: Nazwa pliku: '+_fml_file+'\r\n'+
':: Autor: <wygenerowany automatycznie>\r\n'+
'::======================================================================================================================\r\n'+
':: Zawartość: Obiekty do parsowania - PLIK GENEROWANY AUTOMATYCZNIE - przy ponownej generacji zmiany zostaną nadpisane!\r\n'+
'::            NIE MODYFIKOWAĆ RĘCZNIE TEGO PLIKU, BO URWIE RĘCE!!!!\r\n'+
'::======================================================================================================================\r\n'+
'\r\n\r\n';


_rules:=_header;
_ndx:=_tab.ndx_tmp(,,'LEVEL',,, 'KIND',,,'TM_STAMP',,);
_tab.prefix(0);
{? _tab.first()
|| {!
   |?
      _rules+='\\%1\r\n'[_tab.SYMBOL];
      _rules+='::----------------------------------------------------------------------------------------------------------------------\r\n';
      _rules+='::  UTW: [AUTO]\r\n';
      _rules+=':: OPIS: %1.\r\n'[_tab.NAME];
      _rules+='::   WY: obj_new\r\n';
      _rules+='::----------------------------------------------------------------------------------------------------------------------\r\n';
      _rules+='_result:=obj_new(\r\n';
      _rules+='::                Rodzaj obiektu\r\n';
      _rules+='                 \'KIND\'\r\n';
      _rules+='::                Data zdarzenia\r\n';
      _rules+='                 ,\'DATE\'\r\n';
      _rules+='::                Czas zdarzenia\r\n';
      _rules+='                 ,\'TIME\'\r\n';

      _symbol:=_tab.SYMBOL;
      _tab.cntx_psh();
      _tab.index(_ndx);
      _pref:=_tab.SYMBOL;
      _tab.prefix(1,_pref,);
      {? _tab.first()
      || {!
         |?
            {? var_pres('_split')>100
            || obj_del(_split)
            ?};
            _split:=spli_str(_tab.SYMBOL,'.');
            {? obj_len(_split)>1
            ||
               _field:=_split[2];

               {? _field<>''
               ||
                  _rules+='::                %1\r\n'[_tab.NAME];
                  _rules+='                 ,\'%1\'\r\n'[_field]
               ?}
            ?};
            _tab.next()
         !}
      ?};

      _rules+=');\r\n';
      _rules+='_result.KIND:=\'%1\';\r\n'[_symbol];
      _rules+='_result.DATE:=%1;\r\n'['date(0,0,0)'];
      _rules+='_result.TIME:=%1;\r\n'['time(0,0,0)'];

      _tab.prefix(1,_pref,);
      {? _tab.first()
      || {!
         |?
            {? var_pres('_split')>100
            || obj_del(_split)
            ?};
            _split:=spli_str(_tab.SYMBOL,'.');
            {? obj_len(_split)>1
            ||
               _field:=_split[2];

               {? _field<>''
               ||
                  _rules+='_result.%1:=\'\';\r\n'[_field]
               ?}
            ?};
            _tab.next()
         !}
      ?};
      _tab.cntx_pop();

      _rules+='_result\r\n\r\n\r\n';

      _tab.next()
   !}
?};

{? var_pres('_file')>100
|| obj_del(_file)
?};

{? _rules<>''
|| _file:=fopen(_fml_file,'uw',1);
   {? _file>0
   || fwrite(_file,_rules);
      _can_continue:=1;
      fclose(_file)
   || _can_continue:=0;
      FUN.emsg('Nie udało się utworzyć pliku: %1'@[_fml_file])
   ?}
?};
{? _can_continue>0
|| FUN.emsg('Wygenerowano plik: %1'@[_fml_file])
?};
~~


\gen_parse
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [20.42]
:: OPIS: Formuła generująca plik st_parse.fml
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------

_tab:=exec('legenda_read','st_common');

_can_continue:=1;

::exec('select','#table',_tab);

_fml_file:='st_parse2.fml';
_rules:='';

_header:=
':!UTF-8\r\n'+
':: (c) Macrologic S.A. Wszelkie prawa zastrzeżone\r\n'+
'::======================================================================================================================\r\n'+
':: Nazwa pliku: '+_fml_file+'\r\n'+
':: Autor: WH\r\n'+
'::======================================================================================================================\r\n'+
':: Zawartość: Formuły do parsowania plików .mstat\r\n'+
'::======================================================================================================================\r\n'+
'\r\n\r\n';


_rules:=_header;

_tab.prefix(0);
{? _tab.first()
|| {!
   |?
      _rules+='\\%1\r\n'[_tab.SYMBOL];
      _rules+='::----------------------------------------------------------------------------------------------------------------------\r\n';
      _rules+='::  UTW: WH [20.42]\r\n';
      _rules+=':: OPIS: %1.\r\n'[_tab.NAME];
      _rules+='::   WE: _a - obj_new() - środowisko parsera, wynik działania exec(\'env_parse\',\'st_common\')\r\n';
      _rules+='::       _b - obj_new() - obiekt zawierający treść wiersza, wynik działania exec(\'%1\',\'st_parse_obj\')\r\n'[_tab.SYMBOL];
      _rules+='::       _c - STRING - identyfikator grupujący (ST_SRC.UID_GRP)\r\n';
      _rules+='::       _d - STRING - nazwa pliku\r\n';
      _rules+='::   WY: 0 - porażka, przerywa transakcję i oznacza że plik został błędnie sparsowany\r\n';
      _rules+='::       1 - sukces\r\n';
      _rules+='::----------------------------------------------------------------------------------------------------------------------\r\n';
      _rules+='_env:=_a;\r\n';
      _rules+='_obj:=_b;\r\n';
      _rules+='_uid_grp:=_c;\r\n';
      _rules+='_filename:=_d;\r\n';
      _rules+='\r\n';
      _rules+='_result:=0;\r\n';
      _rules+='_can_continue:=1;\r\n';
      _rules+='\r\n';

      _rules+='{? _can_continue>0\r\n';
      _rules+='|| _result:=1\r\n';
      _rules+='?};\r\n';
      _rules+='_result\r\n\r\n\r\n';
      _tab.next()
   !}
?};

{? var_pres('_file')>100
|| obj_del(_file)
?};

{? _rules<>''
|| _file:=fopen(_fml_file,'uw',1);
   {? _file>0
   || fwrite(_file,_rules);
      _can_continue:=1;
      fclose(_file)
   || _can_continue:=0;
      FUN.emsg('Nie udało się utworzyć pliku: %1'@[_fml_file])
   ?}
?};
{? _can_continue>0
|| FUN.emsg('Wygenerowano plik: %1'@[_fml_file])
?};
~~

:Sign Version 2.0 jowisz:1048 2020/10/16 15:22:58 b06ea0c90ae9ac6a6e6d8141368e455015968b52de7b9b4532e865d5744789343a66d31727f925144079a46ee7da05bc022a2fe0d5624e2b35bd5cc8cd109de1d4d16ccbe52623c13188bf4e192e5a404e0845f12ceba63248ce5e989f60289175a14150cef5ca60365fed20b067df5dca0b15028b1e8f32ac2142e27e6eb992
