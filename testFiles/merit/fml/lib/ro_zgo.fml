:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: ro_zgo.fml
:: Utworzony: 13.03.2018
:: Autor: jaws
:: Systemy: RODO
::======================================================================================================================
:: Zawartość: Formuły odpowiedzialne za obsługę zgód na przetwarzanie danych. (RODO)
::======================================================================================================================
:: Do formuł wywoływanych przez silnik przekazywany jest jeden argument - tablica nazwana z następującymi elementami:
::    RODO     - Obiekt klasy RODO.
::    SRC_TAB  - Alias tabeli, z której pochodzi zapis i dla którego będzie rejestrowana zgoda.
::    SRC_REF  - Wskazanie wiersza tabeli SRC_TAB.
::    APP      - Początkowo ~~. Jeśli formuła ma zwrócić załączniki do zapisania, to musi to być tablica n-elementowa,
::               gdzie n jest liczbą załączników. W każdej komórce musi być umieszczone wskazanie na strukturę opisującą
::               załącznik (tablicę nazwaną):
::                NAME [STRING] - nazwa pliku pdf (z rozszerzeniem) zawierającego dokument zgody
::                DESC [STRING] - opis załącznika
::                CODE [STRING] - kod opisu zgody
::               do tworzenia tablicy zaleca się użycie formuły \permission/ro_req.fml
::    RET      - Tablica nazwana (patrz \ret_val/ro_cfg.fml) do umieszczenia statusu wyszukiwania.
::======================================================================================================================


\rp_osoba
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [18.22]
:: OPIS: Tworzy dokumenty zgody dla bieżącego kandydata do pracy.
::   WE: _a [OBJECT] - parametry niezbędne dla utworzenia załączników.
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('RP_OSOBA')<>type_of(SYSLOG)
|| return()
?};

_arg:=_a;
_ref:=_arg.SRC_REF;

RP_OSOBA.cntx_psh();
RP_OSOBA.prefix();
{? ~RP_OSOBA.seek(_ref)
|| RP_OSOBA.cntx_pop();
   return()
?};

exec('stalesys','#stalesys');

_arg.APP:=obj_new('ZGODA','ZOSTAW');

_name:='@'+_arg.RODO.los_str(8,'a')+'.pdf';
{? RP_OSOBA.ZGODA='T' & rep_exec('ro_zgorp',,,_name,1)
|| _arg.APP.ZGODA:=exec('permission','ro_req',_name,'RECRUITMENT_PROCESS')
?};

_name:='@'+_arg.RODO.los_str(8,'a')+'.pdf';
{? RP_OSOBA.ZOSTAW='T' & rep_exec('ro_zgorw',,,_name,1)
|| _arg.APP.ZOSTAW:=exec('permission','ro_req',_name,'RECRUITMENT_RETAIN')
?};

RP_OSOBA.cntx_pop();
~~

:Sign Version 2.0 jowisz:1028 2019/06/07 16:00:01 26e189261ea1d06f5d5a174240ad270bf5b3d058470f94540b4e63608398bcfa6ff69af7877b391d9a729b26ac02f38aade919a611f709b4b9387beb7da330d50673dfe8facfad1cff3169876d74470a23815690d3fa9ee087c359560e4625a638c8a8a6772c2e1de6340c43358d5d3c00861b6ec8de26b1d0d9cd3f88f75898
