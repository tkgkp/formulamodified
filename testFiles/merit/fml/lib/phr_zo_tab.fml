:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: phr_zo_tab.fml
:: Utworzony: 09.03.2017
:: Autor: jaws
::======================================================================================================================
:: Zawartość: Formuły wyzwalaczy dla tabel obszarów POC.
::======================================================================================================================


\zo_arch_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_ARCH.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
ZO_ARCH.NP_DOK:=ref_name(ZO_ARCH.ZZ_LINK);
exec('zo_arch_chk','phr_zo_tab')


\zo_arch_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_ARCH.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_ARCH*'PUTB|'
|| return(1)
?};
ZO_ARCH.NP_DOK:=ref_name(ZO_ARCH.ZZ_LINK);
exec('zo_arch_chk','phr_zo_tab')


\zo_arch_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_ARCH.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_arch_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_ARCH.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_arch_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_ARCH.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_ARCH*'PUTA|'
|| return()
?};
~~


\zo_arch_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_ARCH.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_arch_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE:
::   WY: 1 - rekord poprawny
::       0 - błędne dane
::  OLD: \init_table/zz_setup.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_ARCH*'CHK|'
|| return(1)
?};
__CHK.record(ZO_ARCH)=''


\zo_asp_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_ASP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_asp_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_ASP) & exec('zo_asp_chk','phr_zo_tab')


\zo_asp_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_ASP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_ASP*'PUTB|'
|| return(1)
?};
exec('zo_asp_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_ASP) & exec('zo_asp_chk','phr_zo_tab')


\zo_asp_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_ASP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_asp_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_DOD,'NAZWA',ZO_ASP.ref())


\zo_asp_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_ASP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_ASP,_a);
~~


\zo_asp_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_ASP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_ASP*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_ASP,_a);
~~


\zo_asp_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_ASP.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_asp_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.30]
:: OPIS: Wywolywana z wyzwalaczy przed dolacz i popraw, przed przeprowadzeniem testow poprawnosci rekordu.
::  OLD: \zo_asp_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_ASP.ZZ_MET:=ZO_ASP.ZF_SKL().ZZ_MET;
ZO_ASP.OCENA:={? ZO_ASP.ZZ_MET || 'T' || 'N' ?}


\zo_asp_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.10]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::  OLD: \zo_asp_nn/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_ASP*'CHK|'
|| return(1)
?};
__CHK.record(ZO_ASP,,'ZF_WYK','ZF_SKL')=''


\zo_cel_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_CEL.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_cel_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_CEL) & exec('zo_cel_chk','phr_zo_tab',0)


\zo_cel_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_CEL.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_CEL*'PUTB|'
|| return(1)
?};
exec('zo_cel_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_CEL) & exec('zo_cel_chk','phr_zo_tab',1)


\zo_cel_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_CEL.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_CELK,'UNIQUE',ZO_CEL.ref())


\zo_cel_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_CEL.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_CEL,_a);
~~


\zo_cel_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_CEL.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_CEL*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_CEL,_a);
~~


\zo_cel_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_CEL.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_cel_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywolywana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testow poprawności rekordu.
::  OLD: \zo_cel_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ZO_CEL.ZO_PROC
|| ZO_PROC.cntx_psh();
   ZO_PROC.prefix();
   ZO_CEL.ZO_PROC();
   {? ~(ZO_PROC.OKRES_OD<=ZO_CEL.OKRES_DO & ZO_CEL.OKRES_DO<=ZO_PROC.OKRES_DO)
   || ZO_CEL.ZO_PROC:=null()
   ?};
   ZO_PROC.cntx_pop()
?};
{? ZO_CEL.Z='X'
|| ZO_CEL.KTO_W:=null();
   ZO_CEL.DATA_W:=date(0,0,0)
?};
ZO_CEL.WAGA:=ZO_CEL.WAGA$2;
{? ZO_CEL.Z='T'
|| ZO_CEL.S:=100
|? ZO_CEL.S=100
|| ZO_CEL.Z:='T'
?}


\zo_cel_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: GS [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::   WY: wynik testu poprawności danych
::  OLD: \zo_cel_nn/zz_table.fml
::  OLD: \zo_cel_ck/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_CEL*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_CEL,
   $("_a.table(_b,"+$_mode+",,'ZO_PROG','KOGO','DATA_Z','OKRES_OD','OKRES_DO','OPIS','WYMOG','ROZWOJ','Z')"),
   "  {? _b.OKRES_DO<_b.OKRES_OD
      || _a.err_fld(_b,'OKRES_DO',1,'Data nie może być wcześniejsza od %1'@ [$_b.OKRES_OD])
      |? _b.S<0 | _b.S>100
      || _a.err_fld(_b,'S',1,'Dozwolone wartości z przedziału %1-%2.'@ ['0','100'])
      || 1
      ?}",
   "_a.in_set(_b,'WYMOG',,'T','N')",
   "_a.in_set(_b,'ROZWOJ',,'T','N')",
   "_a.in_set(_b,'Z',,'T','N','X')"
)


\zo_dod_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_DOD.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_dod_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_DOD) & exec('zo_dod_chk','phr_zo_tab',0)


\zo_dod_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_DOD.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_DOD*'PUTB|'
|| return(1)
?};
exec('zo_dod_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_DOD) & exec('zo_dod_chk','phr_zo_tab',1)


\zo_dod_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_DOD.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_dod_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_DOD.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_DOD,_a);
~~


\zo_dod_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_DOD.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_DOD*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_DOD,_a);
~~


\zo_dod_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_DOD.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_dod_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.30]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::  OLD: \zo_dod_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ZO_DOD.DATA=date(0,0,0)
|| ZO_DOD.ZZ_TYP:=ZO_DOD.ZO_FORM().ZZ_TYP
?}


\zo_dod_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: GS [12.10]
:: OPIS: Sprawdza wypelnienie wymaganych pol. Wykorzystywana w wyzwalaczach przed dolacz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::   WY: wynik testu poprawności danych zależny od kontekstu wywołania:
::       - jako formuła "rekord po"
::          - akronim niewypełnionego pola
::          - akronim pola o błędnej wartości
::          - 0 w przypadku powielenia unikalnego klucza
::       - jako formuła sprawdzająca dla wyzwalaczy "dołącz przed" i "popraw przed"
::          - 1 wiersz poprawny
::          - 0 niewypełnione wymagane pole, błędna wartość pola, powielony unikalny klucz
::  OLD: \zo_dod_nn/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_DOD*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_DOD,
   $("_a.table(_b,"+$_mode+",,'ZO_ASP','ZO_FORM')")
)


\zo_form_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_FORM.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_form_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_FORM) & exec('zo_form_chk','phr_zo_tab',0)


\zo_form_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_FORM.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_FORM*'PUTB|'
|| return(1)
?};
exec('zo_form_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_FORM) & exec('zo_form_chk','phr_zo_tab',1)


\zo_form_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_FORM.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_form_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_KOMP,'UNIQUE',ZO_FORM.ref()) &
exec('del_ndx','#table',ZO_DOD,'UNIQUE',ZO_FORM.ref())


\zo_form_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_FORM.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_form_aa/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? exec('dok_adda','phr_tab',ZO_FORM,_a)
|| exec('dx_form','phr_tab',1,'FORM_SUM',ZO_FORM.ZO_OSTYP,ZO_FORM.ZO_TEST)
?};
~~


\zo_form_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_FORM.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_form_ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_FORM*'PUTA|'
|| return()
?};
{? exec('dok_puta','phr_tab',ZO_FORM,_a)
|| {? bfld('Z')<>ZO_FORM.Z
   || _dx:={? ZO_FORM.Z='T' || 1 || -1 ?};
      exec('dx_form','phr_tab',_dx,'FORM_AKC',ZO_FORM.ZO_OSTYP,ZO_FORM.ZO_TEST)
   ?}
?};
~~


\zo_form_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_FORM.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_form_ad/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? exec('dok_dela','phr_tab',_a)
|| exec('dx_form','phr_tab',-1,'FORM_SUM',bfld('ZO_OSTYP'),bfld('ZO_TEST'));
   {? bfld('Z')='T'
   || exec('dx_form','phr_tab',-1,'FORM_AKC',bfld('ZO_OSTYP'),bfld('ZO_TEST'))
   ?}
?};
~~


\zo_form_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::  OLD: \zo_form_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_FORM.ZZ_KTO:=ZO_FORM.ZO_OSTYP().ZZ_OSOBA;
ZO_FORM.ZZ_TYP:=ZO_FORM.ZO_OSTYP().ZZ_TYP;
ZO_FORM.ZZ_KOGO:=ZO_FORM.ZO_TEST().ZZ_OSOBA


\zo_form_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::  OLD: \zo_form_nn/zz_table.fml
::  OLD: \zo_form_ck/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_FORM*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_FORM,
   $("_a.table(_b,"+$_mode+",,'ZO_OSTYP','ZO_TEST','Z')"),
   "_a.in_set(_b,'Z',,'T','N')"
)


\zo_komp_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_KOMP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_komp_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_KOMP) & exec('zo_komp_chk','phr_zo_tab',0)


\zo_komp_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_KOMP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_KOMP*'PUTB|'
|| return(1)
?};
exec('zo_komp_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_KOMP) & exec('zo_komp_chk','phr_zo_tab',1)


\zo_komp_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_KOMP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_komp_del/zz_link.fml
::  OLD: \zo_komp_bd/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_FORM.cntx_psh();
{? ZO_KOMP.ZO_FORM().Z='T'
|| undo('Usunięcie oceny kompetencji z zaakceptowanego formularza nie jest możliwe.'@);
   ZO_FORM.cntx_pop();
   return(0)
?};
ZO_FORM.cntx_pop();

_dok:=ZO_KOMP.ZO_FORM().ZO_TEST().ZZ_DOK;
_typ:=ZO_KOMP.ZO_FORM().ZZ_TYP;
_del:=1;

ZZ_PROFT.cntx_psh();
ZZ_PROFT.index('UNIQUE');
ZZ_PROFT.prefix(ref_name(_dok),_dok);
{? ZZ_PROFT.find_key(_typ)
|| _del:=ZZ_PROFT.del(1,1)
?};
ZZ_PROFT.cntx_pop();

_del & exec('del_ndx','#table',ZO_NOTA,'UNIQUE',ZO_KOMP.ref())


\zo_komp_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_KOMP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_komp_aa/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('dok_adda','phr_tab',ZO_KOMP,_a)
|| return()
?};

exec('ocena_akt','phr_dane',ZO_KOMP.ref());
~~


\zo_komp_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_KOMP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_komp_ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_KOMP*'PUTA|'
|| return()
?};
{? ~exec('dok_puta','phr_tab',ZO_KOMP,_a)
|| return()
|? ZO_KOMP.W_TYP=bfld('W_TYP') &
   ZO_KOMP.W_KOMP=bfld('W_KOMP') &
   ZO_KOMP.POZIOM=bfld('POZIOM') &
   ZO_KOMP.OCENA=bfld('OCENA')
|| return()
?};

exec('for_each','phr_tab',"_a.cntx_psh(); _a.clear()",ZO_FORM,ZO_OCENA);

ZO_OCENA.index('UNIQUE');
ZO_OCENA.prefix(ZO_KOMP.ZO_FORM().ZO_TEST);
{? ~ZO_OCENA.find_key(ZO_KOMP.ZZ_KOMP,ZO_FORM.ZZ_TYP)
|| exec('zo_komp_adda','phr_zo_tab',_a)
|| ZO_OCENA.put
?};

exec('for_each','phr_tab',"_a.cntx_pop()",ZO_FORM,ZO_OCENA);
~~


\zo_komp_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_KOMP.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_komp_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::  OLD: \zo_komp_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_KOMP.WYNIK:={? ZO_KOMP.POZIOM || 100*ZO_KOMP.OCENA/ZO_KOMP.POZIOM ?}$2;
ZO_KOMP.STATUS:=
   {? ZO_KOMP.OCENA=0 || '?'
   |? ZO_KOMP.OCENA<ZO_KOMP.POZIOM || '-'
   |? ZO_KOMP.OCENA=ZO_KOMP.POZIOM || '='
   |? ZO_KOMP.OCENA>ZO_KOMP.POZIOM || '+'
   ?}


\zo_komp_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::  OLD: \zo_komp_nn/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_KOMP*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_KOMP,
   $("_a.table(_b,"+$_mode+",,'ZO_FORM','ZZ_KOMP')"),
   "{? _b.W_TYP<=0 || _a.err_fld(_b,'W_TYP',1,'Wartość musi być większa od 0.'@)
    |? _b.W_KOMP<=0 || _a.err_fld(_b,'W_KOMP',1,'Wartość musi być większa od 0.'@)
    || 1
    ?}"
)


\zo_mob_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_MOB.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('dok_addb','phr_tab',ZO_MOB) & exec('zo_mob_chk','phr_zo_tab')


\zo_mob_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_MOB.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_MOB*'PUTB|'
|| return(1)
?};
exec('dok_putb','phr_tab',ZO_MOB) & exec('zo_mob_chk','phr_zo_tab')


\zo_mob_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_MOB.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_mob_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZZ_GOTW,'LINKPOZ',ZO_MOB.NP_DOK,ZO_MOB.ZZ_DOK)


\zo_mob_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_MOB.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_MOB,_a);
exec('new_gotw','phr_dane',ZO_MOB.ZZ_DOK);
~~


\zo_mob_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_MOB.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_MOB*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_MOB,_a);
~~


\zo_mob_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_MOB.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_mob_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::  OLD: \init_table/zz_setup.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_MOB*'CHK|'
|| return(1)
?};
__CHK.record(ZO_MOB)=''


\zo_nota_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_NOTA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_nota_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_NOTA) & exec('zo_nota_chk','phr_zo_tab',0)


\zo_nota_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_NOTA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTA*'PUTB|'
|| return(1)
?};
exec('zo_nota_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_NOTA) & exec('zo_nota_chk','phr_zo_tab',1)


\zo_nota_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_NOTA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_nota_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_NOTAB,'UNIQUE',ZO_NOTA.ref) &
exec('del_ndx','#table',ZO_NOTAK,'UNIQUE',ZO_NOTA.ref) &
exec('del_ndx','#table',ZO_NOTAO,'UNIQUE',ZO_NOTA.ref) &
exec('del_ndx','#table',ZO_NOTAS,'UNIQUE',ZO_NOTA.ref) &
exec('del_ndx','#table',ZO_ARCH,'ZO_ARCH',ZO_NOTA.NP_DOK,ZO_NOTA.ZZ_DOK)


\zo_nota_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_NOTA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_nota_aa/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('dok_adda','phr_tab',ZO_NOTA,_a)
|| return()
?};

exec('ocena_akt','phr_dane',ZO_NOTA.ZO_KOMP);
exec('dx_nota','phr_tab',1,'NOTA_SUM',ZO_NOTA.ZO_KOMP);
_typ:=($ZO_NOTA.KLASA)();
_typ.clear();
_typ.blank(1);
_typ.ZO_NOTA:=ZO_NOTA.ref();
{? ~_typ.add()
|| undo('Wystąpił błąd podczas tworzenienia oceny cząstkowej.'@);
   return()
?};
~~


\zo_nota_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_NOTA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_nota_ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTA*'PUTA|'
|| return()
?};
{? ~exec('dok_puta','phr_tab',ZO_NOTA,_a)
|| return()
?};
exec('ocena_akt','phr_dane',ZO_NOTA.ZO_KOMP);
{? bfld('DATA')=date(0,0,0) & ZO_NOTA.DATA<>date(0,0,0)
|| exec('dx_nota','phr_tab',1,'NOTA_AKC',ZO_NOTA.ZO_KOMP)
|? bfld('DATA')<>date(0,0,0) & ZO_NOTA.DATA=date(0,0,0)
|| exec('dx_nota','phr_tab',-1,'NOTA_AKC',ZO_NOTA.ZO_KOMP)
|| 1
?};
~~


\zo_nota_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_NOTA.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_nota_ad/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('dok_dela','phr_tab',_a)
|| return()
?};
_zo_komp:=bfld('ZO_KOMP');
exec('dx_nota','phr_tab',-1,'NOTA_SUM',_zo_komp);
{? bfld('DATA')<>date(0,0,0)
|| exec('dx_nota','phr_tab',-1,'NOTA_AKC',_zo_komp)
?};

: aktualizacja oceny całkowitej (ZO_OCENA)
ZO_KOMP.cntx_psh();
ZO_KOMP.prefix();
{? ZO_KOMP.seek(_zo_komp)
|| ZO_FORM.cntx_psh();
   ZO_OCENA.cntx_psh();
   ZO_OCENA.index('UNIQUE');
   _test:=ZO_KOMP.ZO_FORM().ZO_TEST;
   _komp:=ZO_KOMP.ZZ_KOMP;
   _typ:=ZO_FORM.ZZ_TYP;
:  znajdź ocenę właściwą według kompetencji i typu
:  i sprawdź, czy istnieją jakieś noty mierzalne
   ZO_OCENA.prefix(_test,_komp);
   {? ZO_OCENA.find_key(_typ)
   || ZO_NOTA.cntx_psh();
      ZO_NOTA.index('RODZAJ');
      ZO_KOMP.index('OCENA');
      ZO_KOMP.prefix(_test,_komp,_typ);
      _loop:=ZO_KOMP.first();
      _cnt:=0;
      {!
      |? _loop & _cnt=0
      |! ZO_NOTA.prefix(ZO_KOMP.ref());
         _cnt+=ZO_NOTA.find_key('S');
         _loop:=ZO_KOMP.next()
      !};
      ZO_NOTA.cntx_pop();
:     brak not, usuń ocenę
      {? _cnt=0
      || ZO_OCENA.del()
      ?}
   ?};
   ZO_OCENA.cntx_pop();
   ZO_FORM.cntx_pop()
?};
ZO_KOMP.cntx_pop();
~~


\zo_nota_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testow poprawności rekordu.
::  OLD: \zo_nota_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ZO_NOTA.ZZ_MET
|| _met:=ZO_NOTA.ZZ_MET().KOD;
   ZO_NOTA.KLASA:=
      {? _met='WB' || 2-!ZO_NOTAB
      |? _met='OO' || 2-!ZO_NOTAO
      |? _met='SP' || 2-!ZO_NOTAS
      |? _met='KW' || 2-!ZO_NOTAK
      || ''
      ?}
?}


\zo_nota_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypelnienie wymaganych pol. Wykorzystywana w wyzwalaczach przed dolacz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::  OLD: \zo_nota_nn/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTA*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_NOTA,
   $("_a.table(_b,"+$_mode+",,'ZO_KOMP','ZZ_MET')"),
   "{? _b.KLASA<>'' || _a.in_set(_b,'KLASA',,2-!ZO_NOTAB,2-!ZO_NOTAO,2-!ZO_NOTAS,2-!ZO_NOTAK) || 1 ?}"
)


\zo_notab_moda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy po dołącz i popraw.
::  OLD: \zo_notab_aw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ZO_NOTAB.ZO_NOTA().ZO_KOMP().OCENA<>ZO_NOTAB.WARTOSC
|| ZO_KOMP.OCENA:=ZO_NOTAB.WARTOSC;
   ZO_KOMP.cntx_psh();
   ZO_KOMP.clear();
   ZO_KOMP.put();
   ZO_KOMP.cntx_pop()
?}


\zo_notab_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_NOTAB.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAB)


\zo_notab_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_NOTAB.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAB*'PUTB|'
|| return(1)
?};
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAB)


\zo_notab_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_NOTAB.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_notab_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_NOTAB.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_notab_aa/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
exec('zo_notab_moda','phr_zo_tab');

_poziom:=exec('poziom_komp','phr_dane',
   ZO_NOTAB.ZO_NOTA().ZO_KOMP().ZO_FORM().ZO_TEST().ZZ_DOK,
   ZO_KOMP.ZZ_KOMP,
   ZZ_KOMPZ
);
{? ~_poziom
|| _poziom:=exec('poziom_komp','phr_dane',
      ZO_NOTAB.ZO_NOTA().ZO_KOMP().ZZ_KOMP().ZZ_DOK,
      ZO_KOMP.ZZ_KOMP,
      ZZ_KOMPZ
   )
?};
{? ZO_KOMP.POZIOM<_poziom
|| ZO_KOMP.POZIOM:=_poziom;
   ZO_KOMP.put()
?};
~~


\zo_notab_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_NOTAB.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_notab_ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAB*'PUTA|'
|| return()
?};
exec('zo_notab_moda','phr_zo_tab');

_old:=bfld('WARTOSC');
{? _old<>ZO_NOTAB.WARTOSC
|| exec('zo_nota__puta','phr_zo_tab',ZO_NOTAB);
   exec('zo_nota_arch','phr_zo_tab',ZO_NOTAB.ZO_NOTA().ZZ_DOK,_old)
?};
~~


\zo_notab_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_NOTAB.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_notak_moda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.30]
:: OPIS: Wywoływana z wyzwalaczy po dołącz i popraw.
::  OLD: \zo_notak_aw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ZO_NOTAK.ZO_NOTA().ZO_KOMP().OCENA<>ZO_NOTAK.ZZ_KOMPK().WARTOSC
|| ZO_KOMP.OCENA:=ZO_NOTAK.ZZ_KOMPK().WARTOSC;
   ZO_KOMP.cntx_psh();
   ZO_KOMP.clear();
   ZO_KOMP.put();
   ZO_KOMP.cntx_pop()
?}


\zo_notak_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_NOTAK.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAK)


\zo_notak_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_NOTAK.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAK*'PUTB|'
|| return(1)
?};
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAK)


\zo_notak_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_NOTAK.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_notak_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_NOTAK.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_notak_aa/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
exec('zo_notak_moda','phr_zo_tab');

_poziom:=exec('poziom_komp','phr_dane',
   ZO_NOTAK.ZO_NOTA().ZO_KOMP().ZO_FORM().ZO_TEST().ZZ_DOK,
   ZO_KOMP.ZZ_KOMP,
   ZZ_KOMPK
);
{? ~_poziom
|| _poziom:=exec('poziom_komp','phr_dane',
      ZO_NOTAK.ZO_NOTA().ZO_KOMP().ZZ_KOMP().ZZ_DOK,
      ZO_KOMP.ZZ_KOMP,
      ZZ_KOMPK
   )
?};
{? ZO_KOMP.POZIOM<_poziom
|| ZO_KOMP.POZIOM:=_poziom;
   ZO_KOMP.put()
?};
~~


\zo_notak_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_NOTAK.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_notak_ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAK*'PUTA|'
|| return()
?};
exec('zo_notak_moda','phr_zo_tab');

_old:=bfld('ZZ_KOMPK');
{? _old<>ZO_NOTAK.ZZ_KOMPK
|| exec('zo_nota__puta','phr_zo_tab',ZO_NOTAK);
   ZZ_KOMPK.cntx_psh();
   ZZ_KOMPK.clear();
   {? ZZ_KOMPK.seek(_old)
   || exec('zo_nota_arch','phr_zo_tab',ZO_NOTAK.ZO_NOTA().ZZ_DOK,ZZ_KOMPK.WARTOSC)
   ?};
   ZZ_KOMPK.cntx_pop()
?};
~~


\zo_notak_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_NOTAK.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_notao_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_NOTAO.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAO)


\zo_notao_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_NOTAO.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAO*'PUTB|'
|| return(1)
?};
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAO)


\zo_notao_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_NOTAO.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_notao_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_NOTAO.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_notao_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_NOTAO.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAO*'PUTA|'
|| return()
?};
exec('zo_nota__puta','phr_zo_tab',ZO_NOTAO);
~~


\zo_notao_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_NOTAO.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_notao_memoa
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.30]
:: OPIS: Wyzwalacz po poprawieniu noty opisowej.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_notao_memo/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? _a & _b='OPIS'
|| ZO_NOTA.cntx_psh();
   ZO_NOTA.prefix();
   ZO_NOTAO.ZO_NOTA();
   ZO_NOTA.DATA:=date;
   ZO_NOTA.put();
   ZO_NOTA.cntx_pop();
   ZO_NOTAO.ZO_NOTA()
?};
~~


\zo_notas_moda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy po dołącz i popraw.
::  OLD: \zo_notas_aw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? ZO_NOTAS.ZO_NOTA().ZO_KOMP().OCENA<>ZO_NOTAS.ZZ_KOMPS().WARTOSC
|| ZO_KOMP.OCENA:=ZO_NOTAS.ZZ_KOMPS().WARTOSC;
   ZO_KOMP.cntx_psh();
   ZO_KOMP.clear();
   ZO_KOMP.put();
   ZO_KOMP.cntx_pop()
?}


\zo_notas_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_NOTAS.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAS)


\zo_notas_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_NOTAS.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAS*'PUTB|'
|| return(1)
?};
exec('zo_nota__chk','phr_zo_tab',ZO_NOTAS)


\zo_notas_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_NOTAS.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_notas_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_NOTAS.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_notas_aa/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
exec('zo_notas_moda','phr_zo_tab');

_poziom:=exec('poziom_komp','phr_dane',
   ZO_NOTAS.ZO_NOTA().ZO_KOMP().ZO_FORM().ZO_TEST().ZZ_DOK,
   ZO_KOMP.ZZ_KOMP,
   ZZ_KOMPS
);
{? ~_poziom
|| _poziom:=exec('poziom_komp','phr_dane',
      ZO_NOTAS.ZO_NOTA().ZO_KOMP().ZZ_KOMP().ZZ_DOK,
      ZO_KOMP.ZZ_KOMP,
      ZZ_KOMPS
   )
?};
{? ZO_KOMP.POZIOM<_poziom
|| ZO_KOMP.POZIOM:=_poziom;
   ZO_KOMP.put()
?};
~~


\zo_notas_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_NOTAS.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_notas_ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_NOTAS*'PUTA|'
|| return()
?};
exec('zo_notas_moda','phr_zo_tab');

_old:=bfld('ZZ_KOMPS');
{? _old<>ZO_NOTAS.ZZ_KOMPS
|| exec('zo_nota__puta','phr_zo_tab',ZO_NOTAS);
   ZZ_KOMPS.cntx_psh();
   ZZ_KOMPS.clear();
   {? ZZ_KOMPS.seek(_old)
   || exec('zo_nota_arch','phr_zo_tab',ZO_NOTAS.ZO_NOTA().ZZ_DOK,ZZ_KOMPS.WARTOSC)
   ?};
   ZZ_KOMPS.cntx_pop()
?};
~~


\zo_notas_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_NOTAS.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_nota__puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy po poprawieniu.
::   WE: _a [TABLE] - Uchwyt tabeli (ZO_NOTA?), na rzecz której wywoływana jest formuła.
::  OLD: \zo_nota__ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
_a.ZO_NOTA();
ZO_NOTA.DATA:=date();
ZO_NOTA.put()


\zo_nota__chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: _a [TABLE] - Uchwyt tabeli (ZO_NOTA?), na rzecz której wywoływana jest formuła.
::  OLD: \zo_nota__nn/zz_table.fml
::  OLD: \zo_notab_nn/zz_table.fml
::  OLD: \zo_notak_nn/zz_table.fml
::  OLD: \zo_notao_nn/zz_table.fml
::  OLD: \zo_notas_nn/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
__CHK.record(_a,,'ZO_NOTA')=''


\zo_nota_arch
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [12.30]
:: OPIS: Zapisuje wiersz do historii oceny. Wywoływana z wyzwalaczy po.
::   WE: _a - wskazanie na dokument kadrowy
::       _b - poprzednia wartość oceny
::  OLD: \zo_arch/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? _b
|| ZO_ARCH.clear();
   ZO_ARCH.blank(1);
   ZO_ARCH.ZZ_LINK:=_a;
   ZO_ARCH.CZAS:=ZO_ARCH.tm_stamp();
   ZO_ARCH.DATA:=date();
   ZO_ARCH.GODZ:=time();
   ZO_ARCH.WARTOSC:=_b;
   ZO_ARCH.add()
?}


\zo_ocena_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_OCENA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_ocena_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_OCENA) & exec('zo_ocena_chk','phr_zo_tab')


\zo_ocena_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_OCENA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OCENA*'PUTB|'
|| return(1)
?};
exec('zo_ocena_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_OCENA) & exec('zo_ocena_chk','phr_zo_tab')


\zo_ocena_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_OCENA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_ocena_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_OCENA,'ZO_OCENA',ZO_OCENA.ref())


\zo_ocena_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_OCENA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_ocena_aa/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? exec('dok_adda','phr_tab',ZO_OCENA,_a)
|| exec('ocena_nad','phr_dane')
?};
~~


\zo_ocena_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_OCENA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OCENA*'PUTA|'
|| return()
?};
{? ~exec('dok_puta','phr_tab',ZO_OCENA,_a)
|| return()
?};

{? ZO_OCENA.AW<>bfld('AW') | ZO_OCENA.EX<>bfld('EX') |
   ZO_OCENA.AE<>bfld('AE') | ZO_OCENA.TF<>bfld('TF') |
   ZO_OCENA.CLO<>bfld('CLO') | ZO_OCENA.CEX<>bfld('CEX') | ZO_OCENA.CHI<>bfld('CHI')
|| {? ZO_OCENA.ZO_OCENA
   || ZO_OCENA.cntx_psh();
      ZO_OCENA.clear();
      {? ZO_OCENA.seek(ZO_OCENA.ZO_OCENA,)
      || ZO_OCENA.put()
      ?};
      ZO_OCENA.cntx_pop()
   || ZO_TEST.cntx_psh();
      ZO_TEST.clear();
      {? ZO_TEST.seek(ZO_OCENA.ZO_TEST)
      || exec('ocena_licz','phr_dane',ZO_TEST,ZO_TEST.ref());
         ZO_TEST.put()
      ?};
      ZO_TEST.cntx_pop()
   ?}
?};
~~


\zo_ocena_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_OCENA.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('dok_dela','phr_tab',_a)
|| return()
?};

{? bfld('ZO_OCENA')<>0
|| ZO_OCENA.cntx_psh();
   ZO_OCENA.index('NAZWA');
   ZO_OCENA.prefix(bfld('ZO_TEST'),bfld('ZO_OCENA'));
   {? ~ZO_OCENA.first()
   || ZO_OCENA.prefix(bfld('ZO_TEST'));
      {? ZO_OCENA.seek(bfld('ZO_OCENA'),)
      || ZO_OCENA.del()
      ?}
   ?};
   ZO_OCENA.cntx_pop()
?};
~~


\zo_ocena_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::       Wylicza wartości oceny na podstawie ocen kompetencji.
::  OLD: \zo_ocena_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
exec('ocena_licz','phr_dane',ZO_OCENA,ZO_OCENA.ZO_TEST,ZO_OCENA.ZZ_KOMP,ZO_OCENA.ZZ_TYP)


\zo_ocena_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypelnienie wymaganych pol. Wykorzystywana w wyzwalaczach przed dolacz i popraw.
::  OLD: \zo_ocena_nn/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OCENA*'CHK|'
|| return(1)
?};
__CHK.record(ZO_OCENA,,'ZO_TEST','ZZ_KOMP')=''


\zo_osoba_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_OSOBA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_osoba_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_OSOBA) & exec('zo_osoba_chk','phr_zo_tab',0)


\zo_osoba_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_OSOBA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OSOBA*'PUTB|'
|| return(1)
?};
exec('zo_osoba_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_OSOBA) & exec('zo_osoba_chk','phr_zo_tab',1)


\zo_osoba_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_OSOBA.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_osoba_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_OSTYP,'UNIQUE',ZO_OSOBA.ref())


\zo_osoba_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_OSOBA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('dok_adda','phr_tab',ZO_OSOBA,_a)
|| return()
?};

{? ZO_OSOBA.RODZAJ='O'
|| ZO_TEST.cntx_psh();
   ZO_TEST.clear();
   ZO_TEST.blank(1);
   ZO_TEST.ZO_OSOBA:=ZO_OSOBA.ref();
   ZO_TEST.add();
   ZO_TEST.cntx_pop()
?};
~~


\zo_osoba_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_OSOBA.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OSOBA*'PUTA|'
|| return()
?};
{? ~exec('dok_puta','phr_tab',ZO_OSOBA,_a)
|| return()
?};
{? ZO_OSOBA.RODZAJ='O' & ZO_OSOBA.KOMPLET<>bfld('KOMPLET')
|| ZO_TEST.cntx_psh();
   ZO_TEST.index('UNIQUE');
   ZO_TEST.prefix();
   {? ZO_TEST.find_key(ZO_OSOBA.ref())
   || {? ZO_TEST.KOMPLET<>ZO_OSOBA.KOMPLET
      || ZO_TEST.put()
      ?};
:     aktywować kod, gdy dostępne będzie wykonywanie raportow w transakcji
:     {? ZO_OSOBA.KOMPLET='T'
:     || exec('report','phr_kreatory',ZO_TEST,'ocprac1','ocprac1.pdf','Dokument oceny',1,'OCPRAC-1')
:     ?};
      ~~
   ?};
   ZO_TEST.cntx_pop()
?};
~~


\zo_osoba_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_OSOBA.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_osoba_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::  OLD: \zo_osoba_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_OSOBA.POSTEP:={? ZO_OSOBA.FORM_SUM || 100*ZO_OSOBA.FORM_AKC/ZO_OSOBA.FORM_SUM ?}$2;
ZO_OSOBA.KOMPLET:={? ZO_OSOBA.FORM_SUM & ZO_OSOBA.FORM_SUM=ZO_OSOBA.FORM_AKC || 'T' || 'N' ?};
1


\zo_osoba_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::  OLD: \zo_osoba_nn/zz_table.fml
::  OLD: \zo_osoba_ck/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OSOBA*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_OSOBA,
   $("_a.table(_b,"+$_mode+",,'ZO_PROC','ZZ_OSOBA','UD_SKL','STN','RODZAJ','KOMPLET')"),
   "_a.in_set(_b,'RODZAJ',,'E','O')",
   "_a.in_set(_b,'KOMPLET',,'T','N')"
)


\zo_ostyp_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_OSTYP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_ostyp_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_OSTYP) & exec('zo_ostyp_chk','phr_zo_tab')


\zo_ostyp_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_OSTYP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OSTYP*'PUTB|'
|| return(1)
?};
exec('zo_ostyp_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_OSTYP) & exec('zo_ostyp_chk','phr_zo_tab')


\zo_ostyp_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_OSTYP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_ostyp_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_FORM,'ZO_OSTYP',ZO_OSTYP.ref())


\zo_ostyp_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_OSTYP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_OSTYP,_a);
~~


\zo_ostyp_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_OSTYP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OSTYP*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_OSTYP,_a);
~~


\zo_ostyp_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_OSTYP.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_ostyp_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::  OLD: \zo_ostyp_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_OSTYP.ZZ_OSOBA:=ZO_OSTYP.ZO_OSOBA().ZZ_OSOBA


\zo_ostyp_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE:
::   WY: 1 - rekord poprawny
::       0 - błędne dane
::  OLD: \init_table/zz_setup.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_OSTYP*'CHK|'
|| return(1)
?};
__CHK.record(ZO_OSTYP)=''


\zo_proc_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_PROC.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_proc_modb','phr_zo_tab');

{? exec('dok_addb','phr_tab',ZO_PROC) & exec('zo_proc_chk','phr_zo_tab',0)
|| exec('zz_ocena_add','phr_tab',ZO_PROC,'ZZ_OCENA')
?}


\zo_proc_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_PROC.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROC*'PUTB|'
|| return(1)
?};
exec('zo_proc_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_PROC) & exec('zo_proc_chk','phr_zo_tab',1)


\zo_proc_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_PROC.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::  OLD: \zo_proc_del/zz_link.fml
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_TEST,'ZO_TEST',ZO_PROC.ref()) &
exec('del_ndx','#table',ZO_OSOBA,'UNIQUE',ZO_PROC.ref()) &
exec('set_null','#table',ZO_CEL,'ZO_PROC',ZO_PROC.ref()) &
exec('del_ndx','#table',ZA_ZEST,'NAZWA',ZO_PROC.NP_DOK,ZO_PROC.ZZ_DOK) &
exec('del_ndx','#table',ZA_WAR,'OPIS',ZO_PROC.NP_DOK,ZO_PROC.ZZ_DOK)


\zo_proc_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_PROC.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_PROC,_a);
~~


\zo_proc_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_PROC.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_proc_ap/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROC*'PUTA|'
|| return()
?};
{? ~exec('dok_puta','phr_tab',ZO_PROC,_a)
|| return()
?};

_retry:=0;
{? bfld('A')<>ZO_PROC.A & ZO_PROC.A='T' & ZO_PROC.OCENA_OD=date(0,0,0)
|| ZO_PROC.OCENA_OD:=date();
   _retry:=1
?};
{? bfld('Z')<>ZO_PROC.Z
|| ZO_PROC.OCENA_DO:={? ZO_PROC.Z='N' || date(0,0,0) || date() ?};
   _retry:=1
?};
{? _retry
|| ZO_PROC.put();
:  zamknij/otwórz formularze
   ZO_FORM.cntx_psh();
   ZO_FORM.clear();
   ZO_FORM.f_set(
      ,
      'join ZO_TEST using (ZO_FORM.ZO_TEST,ZO_TEST.REFERENCE) '+
      'join ZO_OSOBA using (ZO_TEST.ZO_OSOBA,ZO_OSOBA.REFERENCE)',
      'ZO_OSOBA.ZO_PROC=:_a and ZO_FORM.DATA is null and ZO_FORM.Z<>\':_b\'',
      ZO_PROC.ref(),ZO_PROC.Z
   );
   _loop:=ZO_FORM.f_first();
   {!
   |? _loop
   |! ZO_FORM.Z:=ZO_PROC.Z;
      ZO_FORM.put();
      _loop:=ZO_FORM.f_next()
   !};
   ZO_FORM.f_clear();
   ZO_FORM.cntx_pop()
?};
~~


\zo_proc_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_PROC.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::  OLD: \zo_proc_ad/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
exec('zz_ocena_del','phr_tab');
exec('dok_dela','phr_tab',_a);
~~


\zo_proc_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::  OLD: \zo_proc_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_PROC.R:=ZO_PROC.OKRES_DO~1;
ZO_PROC.M:=ZO_PROC.OKRES_DO~2;
1


\zo_proc_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::  OLD: \zo_proc_nn/zz_table.fml
::  OLD: \zo_proc_ch/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROC*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_PROC,
   $("_a.table(_b,"+$_mode+",,'ZO_PROG','OKRES_OD','OKRES_DO','DATA','PLAN_OD','PLAN_DO','A','Z')"),
   "_a.in_set(_b,'A',,'T','N')",
   "_a.in_set(_b,'Z',,'T','N')",
   "  {? _b.OKRES_DO<_b.OKRES_OD
      || _a.err_fld(_b,'OKRES_OD',1,'Podano niespójne daty okresu oceny.'@)
      || 1
      ?}
   ",
   "  {? _b.PLAN_DO<_b.PLAN_OD
      || _a.err_fld(_b,'PLAN_OD',1,'Podano niespójny okres planowanego przeprowadzenia oceny.'@)
      || 1
      ?}
   ",
   "  {? _b.DATA<_b.OKRES_OD | _b.OKRES_DO<_b.DATA
      || _a.err_fld(_b,'DATA',1,'Podano błędną datę dopasowania osób do profili.'@)
      || 1
      ?}
   "
)


\zo_prof_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_PROF.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_prof_chk','phr_zo_tab')


\zo_prof_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_PROF.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROF*'PUTB|'
|| return(1)
?};
exec('zo_prof_chk','phr_zo_tab')


\zo_prof_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_PROF.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_prof_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_PROF.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_prof_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_PROF.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROF*'PUTA|'
|| return()
?};
~~


\zo_prof_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_PROF.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_prof_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROF*'CHK|'
|| return(1)
?};
__CHK.record(ZO_PROF)=''


\zo_prog_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_PROG.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_prog_modb','phr_zo_tab');
exec('dok_addb','phr_tab',ZO_PROG) & exec('zo_prog_chk','phr_zo_tab',0)


\zo_prog_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_PROG.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROG*'PUTB|'
|| return(1)
?};
exec('zo_prog_modb','phr_zo_tab');
exec('dok_putb','phr_tab',ZO_PROG) & exec('zo_prog_chk','phr_zo_tab',1)


\zo_prog_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_PROG.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZO_PROF,'UNIQUE',ZO_PROG.ref()) &
exec('del_ndx','#table',ZF_WYK,'NAZWA',ZO_PROG.NP_DOK,ZO_PROG.ZZ_DOK) &
exec('del_ndx','#table',ZO_PROC,'OKRES_OD',ZO_PROG.ref()) &
exec('del_ndx','#table',ZO_CEL,'ZO_PROG',ZO_PROG.ref())


\zo_prog_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_PROG.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_PROG,_a);
~~


\zo_prog_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_PROG.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROG*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_PROG,_a);
~~


\zo_prog_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_PROG.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_prog_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: [_a] [NUMBER] - Specyfikacja testu:
::             0 - Dołącz [domyślnie];
::             1 - Popraw
::  OLD: \zo_prog_nn/zz_table.fml
::  OLD: \zo_prog_ck/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_PROG*'CHK|'
|| return(1)
?};
_put:=var_pres('_a')=type_of(0) & _a;

__CHK.validate(ZO_PROG,
   $("_a.table(_b,"+$_put+",,'NAZWA','TYP','RODZAJ','AKTYWNY','WIDOCZNY')"),
   "  {? ZO_PROG.RODZAJ='M' | ZO_PROG.RODZAJ='T'
      || _a.record(_b,,'CZAS')
      || ''
      ?}
   ",
   "  {? ZO_PROG.CZAS<0
      || _a.err_fld(_b,'CZAS',1,'Wartość nie może być ujemna.'@);
         'CZAS'
      |? ZO_PROG.PLAN_D<0
      || _a.err_fld(_b,'PLAN_D',1,'Wartość nie może być ujemna.'@);
         'PLAN_D'
      || 1
      ?}
   ",
   "_a.in_set(_b,'TYP',,'O','R','A')",
   "_a.in_set(_b,'RODZAJ',,'R','P','K','M','T','A')",
   "_a.in_set(_b,'AKTYWNY',,'T','N')",
   "_a.in_set(_b,'WIDOCZNY',,'T','N')"
)


\zo_prog_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Przed modyfikacją rekordu.
::       Formuła wywoływana z wyzwalaczy "Dołącz - przed" i "Popraw - przed" dla tabeli ZO_PROG.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ZO_PROG.RODZAJ='A'
|| ZO_PROG.CZAS:=0
|? ~(ZO_PROG.RODZAJ='M' | ZO_PROG.RODZAJ='T')
|| ZO_PROG.CZAS:=1
?};
1


\zo_sk_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_SK.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('dok_addb','phr_tab',ZO_SK)


\zo_sk_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_SK.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_SK*'PUTB|'
|| return(1)
?};
exec('dok_putb','phr_tab',ZO_SK)


\zo_sk_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_SK.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('del_ndx','#table',ZZ_GOTW,'LINKPOZ',ZO_SK.NP_DOK,ZO_SK.ZZ_DOK)


\zo_sk_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_SK.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_SK,_a);
exec('new_gotw','phr_dane',ZO_SK.ZZ_DOK);
~~


\zo_sk_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_SK.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_SK*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_SK,_a);
~~


\zo_sk_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_SK.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_dela','phr_tab',_a);
~~


\zo_test_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_TEST.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
exec('zo_test_modb','phr_zo_tab');

exec('dok_addb','phr_tab',ZO_TEST) & exec('zo_test_chk','phr_zo_tab',0)


\zo_test_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_TEST.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_TEST*'PUTB|'
|| return(1)
?};
exec('zo_test_modb','phr_zo_tab');

exec('dok_putb','phr_tab',ZO_TEST) & exec('zo_test_chk','phr_zo_tab',1)


\zo_test_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_TEST.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
_cond:=obj_new(3);
_cond[1]:="ZO_OCENA.ZZ_KOMP<>null & ZO_OCENA.ZZ_TYP<>null";
_cond[2]:="ZO_OCENA.ZZ_KOMP<>null & ZO_OCENA.ZZ_TYP=null";
_cond[3]:="1";

_test:=1;
ZO_OCENA.cntx_psh();
ZO_OCENA.index('UNIQUE');
ZO_OCENA.prefix(ZO_TEST.ref());
{! _ni:=1..obj_len(_cond)
|! _loop:=ZO_OCENA.first();
   {!
   |? _loop
   |! {? _cond[_ni]()
      || _state:=ZO_OCENA.del(1,1);
         _loop:=0;
         {? _state=0
         || _test:=0
         |? _state>1
         || _loop:=1
         ?}
      || _loop:=ZO_OCENA.next()
      ?}
   !}
!};
ZO_OCENA.cntx_pop();

_test &
exec('del_ndx','#table',ZO_FORM,'UNIQUE',ZO_TEST.ref()) &
exec('del_ndx','#table',ZZ_PROFK,'NAZWA',ZO_TEST.NP_DOK,ZO_TEST.ZZ_DOK) &
exec('del_ndx','#table',ZZ_PROFT,'UNIQUE',ZO_TEST.NP_DOK,ZO_TEST.ZZ_DOK) &
exec('del_ndx','#table',ZZ_KOMPK,'WARTOSC',ZO_TEST.NP_DOK,ZO_TEST.ZZ_DOK) &
exec('del_ndx','#table',ZZ_KOMPS,'WARTOSC',ZO_TEST.NP_DOK,ZO_TEST.ZZ_DOK) &
exec('del_ndx','#table',ZZ_KOMPZ,'UNIQUE',ZO_TEST.NP_DOK,ZO_TEST.ZZ_DOK) &
exec('del_ndx','#table',ZF_WYK,'NAZWA',ZO_TEST.NP_DOK,ZO_TEST.ZZ_DOK) &
exec('del_ndx','#table',ZO_MOB,'OCENAMOB',ZO_TEST.ref()) &
exec('del_ndx','#table',ZZ_MOBW,'LINKOP',ZO_TEST.NP_DOK,ZO_TEST.ZZ_DOK) &
exec('del_ndx','#table',ZO_SK,'OCENASTN',ZO_TEST.ref()) &
exec('set_null','#table',SZK_ZAP,'ZO_TEST',ZO_TEST.ref())


\zo_test_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_TEST.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('dok_adda','phr_tab',ZO_TEST,_a);
exec('new_mobw','phr_dane',ZO_TEST.ZZ_DOK);
~~


\zo_test_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_TEST.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_TEST*'PUTA|'
|| return()
?};
exec('dok_puta','phr_tab',ZO_TEST,_a);
~~


\zo_test_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.14]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_TEST.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('dok_dela','phr_tab',_a)
|| return()
?};

:  usuwanie osoby ocenianej, dla której brak ocen całkowitych
ZO_OSOBA.cntx_psh();
ZO_OSOBA.clear();
{? ZO_OSOBA.seek(bfld('ZO_OSOBA'))
|| ZO_OSOBA.del()
?};
ZO_OSOBA.cntx_pop();

~~


\zo_test_modb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Wywoływana z wyzwalaczy przed dołącz i popraw, przed przeprowadzeniem testów poprawności rekordu.
::  OLD: \zo_test_bw/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
ZO_TEST.P_FORM:=
   {? ZO_TEST.L_FORM=1 || 'T'
   |? ZO_TEST.L_FORM>1 || 'X'
   || 'N'
   ?};

ZO_OSOBA.cntx_psh();
ZO_TEST.ZO_OSOBA();
ZO_TEST.ZZ_OSOBA:=ZO_OSOBA.ZZ_OSOBA;
ZO_TEST.UD_SKL:=ZO_OSOBA.UD_SKL;
ZO_TEST.STN:=ZO_OSOBA.STN;
ZO_TEST.KOMPLET:=ZO_OSOBA.KOMPLET;
ZO_OSOBA.cntx_pop()


\zo_test_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [2011]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE: _a [INTEGER] - Tryb modyfikacji danych
::          0 - dołączanie (domyślnie)
::          1 - poprawianie
::  OLD: \zo_test_nn/zz_table.fml
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_TEST*'CHK|'
|| return(1)
?};
_mode:={? var_pres('_a')=type_of(0) || _a<>0 ?};

__CHK.validate(ZO_TEST,
   $("_a.table(_b,"+$_mode+",,'ZO_OSOBA','ZZ_OSOBA','UD_SKL','STN')")
)


\zo_hist_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_HIST.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_hist_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_HIST.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_HIST*'PUTB|'
|| return(1)
?};
1


\zo_hist_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_HIST.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_hist_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_HIST.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_hist_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_HIST.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_HIST*'PUTA|'
|| return()
?};
~~


\zo_hist_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_HIST.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_hist_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_HIST*'CHK|'
|| return(1)
?};
1


\zo_celp_addb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "dołącz przed" tabeli ZO_CELP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_celp_putb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "popraw przed" tabeli ZO_CELP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_CELP*'PUTB|'
|| return(1)
?};
1


\zo_celp_delb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "usuń przed" tabeli ZO_CELP.
::   WE:
::   WY: zgodna ze specyfikacją narzędzi
::----------------------------------------------------------------------------------------------------------------------
1


\zo_celp_adda
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "dołącz po" tabeli ZO_CELP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_celp_puta
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "popraw po" tabeli ZO_CELP.
::   WE: zgodne ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_CELP*'PUTA|'
|| return()
?};
~~


\zo_celp_dela
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Formuła wyzwalacza "usuń po" tabeli ZO_CELP.
::   WE: zgodna ze specyfikacją narzędzi
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_celp_chk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [17.42]
:: OPIS: Sprawdza wypełnienie wymaganych pól. Wykorzystywana w wyzwalaczach przed dołącz i popraw.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? TRIG_OFF.ZO_CELP*'CHK|'
|| return(1)
?};
1

:Sign Version 2.0 jowisz:1028 2019/06/07 15:59:57 6a1583d9be57daef675d8610260f1fbb9bd645e2bc0b669bf7f2055d4f81e6cb6790983ee86cd0e6fe3620b89c9a2e5d73ab754f1fe2bbb22603bac59636b078fa60a9bea5ec079ced61c13426ea5518adf97def928023ce95fbe253ae0997eca8d41a76a468ead8466b5d62358a2e235f9deae33bdb9e0256f1cabb2ce60158
