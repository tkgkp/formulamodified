:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: open_tab.fml
:: Utworzony: 2015.03.04
:: Autor: AMK
::======================================================================================================================
:: Zawartość: Otwieranie maskowanych tabel systemu
::======================================================================================================================


\open_tabele
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Na podstawie przekazanych parametrów i zmiennych (SSTALE.AR, SSTALE.AO, APARAM.STANKAS, USRCONST.ROKVAR,
::       VAR.AR) otwiera tabele maskowane
::   WE: _a = 'W' - wszystkie
::            'F' - tabele 'fiksowe'
::            'L' - tabele 'logistyczne'
::       jeśli brak parametru to formuła przyjmuje _a='F'
::       _b - 1 element masek logistycznych - kod oddziału (string[1]) np. PARSES.ODDZ().KOD
::       _c - 2 element masek logistycznych - rok (string[2]) np. form(PARSES.ROK-2000,,0,'99')
::      [_d] - dk/sp - wartości dla maski FAP2DK
::       w przypadku _a='F' parametry _b i _c można pominąć
::  OLD: \open/okresy.fml
::  OLD: \open_op/okresy.fml
::  OLD: \okresy/ml_teren.fml
::  OLD: \openbaz/openbaz.fml
::  OLD: \open_dok/i_o.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_d')<>type_of('') || _d:='dk' ?};
echo('Trwa otwieranie tabel...'@);
{? _=0 || _a:='F' ?};

DOKUM.use('dokum');
DOKTYP.use('doktyp');
DOKUMLOG.use('dolog');
{? exec('upgrade2325_blbc1','zbl')
|| {? SSTALE.AR<>0
   ||
      DOKUMZBC.use('dbc'+REF.FIRMA().SYMBOL+($(SSTALE.AR().POCZ_ROK~1)+2))

   |? ST.ROK<>'' & exec('chkForm','#string',ST.ROK,'%c%c',0)
   ||
      DOKUMZBC.use('dbc'+REF.FIRMA().SYMBOL+ST.ROK)
   ||
      DOKUMZBC.use('dbc'+REF.FIRMA().SYMBOL+form(date()~1-2000,-2,0,'99'))
   ?}
?};


{? _a='W' | _a='F'
|| A_SCPP.use('x_scpi');
   OV_UPR.use('ov_upr');
   PAL.use('palety');
   PAL_POZ.use('paletyp');
   EANLOG.use('elog____');
   PB.use('pbxxxx');
   PB_OP.use('popxxxx');
   PBHIST.use('phxxxx');
   PW.use('pwxxxx');
   PW_OP.use('pwpxxxx');
   SER_POZ.use('ser_pxx');
   SPRLOG.use('sprl____');
   TRANSLAT.use('translat')
?};
{? (_a='W' | _a='F') & SSTALE.AR<>0 & SSTALE.AO<>0
|| ROK_F.cntx_psh(); OKRO_F.cntx_psh();
   _mas1:=SSTALE.AR().KOD;
   _mas2:=_mas1+form(SSTALE.AO().NR,-2);
   _mas3:=$(SSTALE.AO().KON~1);
   _mas4:=($(SSTALE.AR().POCZ_ROK~1)+2);
   {? +_mas3<>4 || _mas3:='____' ?};
   ROK_F.cntx_pop(); OKRO_F.cntx_pop();
   AN.use('koan__'+_mas1);
   AN_SLU.use('koansl'+_mas1);
   D_RB.use('dr__fk'+_mas1);
   DVAT.use('dvat__'+_mas1);
   EDOK_ZAL.use('edokzl'+_mas4);
   EDOKGR.use('skid_c'+_mas4);
   EDOKLOG.use('skid_d'+_mas4);
   EDOKOS.use('skid_y'+_mas4);
   EDOKPAR.use('skidh_'+_mas4);
   EDOKUSER.use('skidk_'+_mas4);
   EDOKRZAP.use('skid_q'+_mas4);
   EDOKUM.use('skid_v'+_mas4);
   EDOK_ATR.use('edokat'+_mas4);
   EDOK_ATK.use('edoknt'+_mas4);
   EDOKUMW.use('skidv1'+_mas4);
   EDOKUMD.use('bdiety'+_mas4);
   EDOKUMP.use('skidpu'+_mas4);
   EDOKUMZ.use('skid_n'+_mas4);
   EDOKUMZS.use('skids_'+_mas4);
   EPODZ.use('skid_j'+_mas4);
   EDOKUMPR.use('skid_i'+_mas4);
   EVAT.use('skid_a'+_mas4);
   FAK.use('fak_'+_mas2);
   K__NOTY.use('notyco'+_mas1);
   K__PNOTY.use('notypo'+_mas1);
   ML_BZAD.use('mlbzad'+_mas1);
   ML_OBRCZ.use('obrcz_'+_mas1);
   ML_OBRDZ.use('obrdz_'+_mas1);
   ML_OBRPG.use('obrpg_'+_mas1);
   ML_OBRPP.use('obrpp_'+_mas1);
   ML_OBRRZ.use('obrrz_'+_mas1);
   ML_OBRTR.use('mlobrt'+_mas1);
   ML_POZB.use('pozb'+_mas2);
   ML_POZTR.use('mlpozt'+_mas1);
   MLCPVDOK.use('cpvdok'+_mas1);
   OBR.use('obroty'+_mas1);
   OP.use('operac'+_mas1);
   OP_PROJ.use('rozpro'+_mas1);
   P_V.use('p_v_'+_mas2);
   P_W.use('p_w_'+_mas2);
   PAR_NAG.use('parnag'+_mas1);
   PAR_POZ.use('parpoz'+_mas1);
   POW.use('pow_'+_mas2);
   POZ.use('pozy'+_mas2);
   POZF.use('pozf'+_mas2);
   PROJ_DOK.use('pjd_'+_mas2);
   PROJ_POZ.use('pjp_'+_mas2);
   PROJ_REF.use('pj_4'+_mas2);
   PVAT.use('pvat__'+_mas1);
   RMK.use('rmkop_'+_mas1);
   ROW_DOC.use('rowd'+_mas2);
   ROW_KON.use('rowk'+_mas2);
   ROW_WYR.use('roww'+_mas2);
   RRMK.use('rozrmk'+_mas1);
   SEKKODP.use('sekkod'+_mas1);
   SEKKON.use('sekkon'+_mas1);
   SEKKUS.use('sekkus'+_mas1);
   SEKREH.use('sekreh'+_mas1);
   SEKREL.use('sekrel'+_mas1);
   SEKRES.use('sekres'+_mas1);
   SEKRET.use('sekret'+_mas1);
   SEKZAL.use('sekzal'+_mas1);
   SKIDXD.use('skxd'+_mas2);
   STANY.use('stany_'+ _mas1);
   TERDOK.use('terd'+_mas3);
   TERPOZ.use('terp'+_mas3);
   VPOW.use('pozw'+_mas2);
   VPOZ.use('pozv'+_mas2);
   VPOZ_ROZ.use('pozr'+_mas2);
   VROZ.use('povr'+_mas2);
   W_ALGPAR.use('walg_'+_mas1);
   WARTOSCI.use('wsik_'+_mas1);
   ZAP_OP.use('rozzap'+ _mas1);
   ZAP_PROJ.use('rozprz'+_mas1);
   DOK.use('doku'+_mas2);
   DOK_JPK.use('dokj'+_mas2);
   DOKN.use('dokn'+_mas2);
   DOKPOLA.use('dokp'+_mas2)
?};
{? (_a='W' | _a='F')
|| _fmaska:={? +REF.FIRMA().SYMBOL>3 || -REF.FIRMA().SYMBOL || 'r'+REF.FIRMA().SYMBOL ?};
   ATR_WYRE.use('ewr_'+_fmaska);
   ATRUSE_E.use('eat_'+_fmaska);
   NKOD.use('kodn'+_fmaska);
   PKOD.use('kodp'+_fmaska);
   TSR.use('typp'+_fmaska);
   TST.use('typs'+_fmaska);
   TSK.use('typl'+_fmaska);
   SRDO.use('srdo'+_fmaska);
   MAGWALP.use('mwp'+_fmaska);
   MAGWALR.use('mwr'+_fmaska);
   SRDT.use('srdt'+_fmaska);
   SRDZ.use('srdz'+_fmaska);
   SRSR.use('srsr'+_fmaska);
   SRST.use('srst'+_fmaska);
   SRSW.use('srsw'+_fmaska);
   SRSP.use('srsp'+_fmaska);
   SRZD.use('srzd'+_fmaska);
   SRZF.use('srzf'+_fmaska);
   SRXI.use('srxi'+_fmaska);
   SRXA.use('srxa'+_fmaska);
   SRXD.use('srxd'+_fmaska);
   SRXK.use('srxk'+_fmaska);
   SRXL.use('srxl'+_fmaska);
   SRXN.use('srxn'+_fmaska);
   SRXP.use('srxp'+_fmaska)
?};
{? (_a='W' | _a='F') & SSTALE.AR
|| KTRWP.use('kontwa'+SSTALE.AR().KOD)
?};
{? (_a='W' | _a='F') & APARAM.MASKA<>''
|| DOKUMENT.use('kdo'+APARAM.MASKA);
   NUM_DOK.use('knd'+APARAM.MASKA);
   OBROTY.use('kob'+APARAM.MASKA);
   POZDOK.use('kpd'+APARAM.MASKA);
   RAPORT.use('krp'+APARAM.MASKA);
   VPD.use('vpd'+APARAM.MASKA)
?};

{? (_a='W' | _a='L') & _b<>'' & _c<>''
|| exec('open','open_tab',_b,_c,_d)
?};

echo()


\open_all_tabele
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2010]
:: OPIS: Otwieranie maskowalnych tabel systemu. Formuła wykonywana wyłącznie raz przy starcie systemu. Ewentualne zmiany
::       masek (otwarcie innych) realizowane są punktowo - otwierane są wyłącznie te maski, które maja ulec zmianie.
::  OLD: \open_all_tabele/system.fml
::----------------------------------------------------------------------------------------------------------------------
:: Ustawienie komentarz w rejestrze zmian
SYSSLG.comm_val('fill',REF.FIRMA().SYMBOL);

:: Najpierw tabele "pseudomaskowalne" czyli takie, które pod MacroBUILDER-em zdefiniowane są jako maskowalne,
:: a w rzeczywistości korzystają z jednej ustalonej maski.

:: Pracownicy i zatrudnienie
P.use('pracowni');
exec('otworz_h_um','pracownik','h_um');
H.use('_hist');
:: Oddelegowania
H_ODDE.use('h_oddet');
:: Wzorce czasu pracy
R_WZCZ.use('r_wzczas');
{? REF.FIRMA=null
|| KAL_DEF.use('kal_d__')
|| KAL_DEF.use('kal_d'+($REF.FIRMA+2))
?};
:: Skład brygad
ZLBS.use('zlbrskll');
:: Dokumenty kadrowe
{? REF.FIRMA<>null
|| ZZ_DOK.use('zz_do'+($REF.FIRMA+1))
?};
:: Plany szkoleń i zapotrzebowania
SZK_PSZK.use('szk_pszk');
SZK_ZAP.use('szk_zap');
:: Dokumenty
DOKUM.use('dokum');
DOKTYP.use('doktyp');
DOKUMLOG.use('dolog');
:: tłumaczenia
TRANSLAT.use('translat');

:: Teraz wszystkie tabele maskowalne.
_il_tab:=tab_num();
{! _ndx:=1 .. _il_tab
|! _TAB:=tab_alias(_ndx);
   {? _TAB.name()='' & tab_real(_ndx)
   || _mask:=gsub(_TAB.name(1),'?','_');
      echo('Otwieranie tabeli %1 (%2/%3)'@[_mask,$_ndx,$_il_tab]);
      _TAB.use(_mask)
   ?};
   &_TAB
!};


echo()


\open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2008]
:: OPIS: Otwarcie tabel maskowalnych systemu
::   WE:  _a - kod oddziału
::        _b - ostatnie dwie cyfry roku
::        [_c] - dk/sp - wartości dla maski FAP2DK
::  OLD: \open/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
{? _a='' | +_a<>1 || _a:='_' ?};
{? _b='' | +_b<>2 || _b:='__'?};
{? var_pres('_c')<>type_of('') || _c:='dk' ?};
:: stany
    SM.use('stm__'+_a+'zb');
    SC.use('stc__'+_a+_b);
    SL.use('stl__'+_a+'zb');
   SLD.use('sld__'+_a+'zb');

:: dokumenty sprzedaż, zakupu
     FAKS.use('faktu'+_a+_b);
   FAKS_K.use('fakkk'+_a+_b);
   FAKSKH.use('fkpf_'+_a+_b);
   FAKSPL.use('fakpl'+_a+_b);
    FAKSO.use('fakto'+_a+_b);
 FAKSPOLA.use('faktp'+_a+_b);
      FAP.use('fakpo'+_a+_b);
    FAP_K.use('fapkk'+_a+_b);
    FAKSV.use('faksv'+_a+_b);
   FAP2DK.use('fapto'+_c+_a);
     TAXJ.use('taxjo'+_a+_b);
 FPACZFAP.use('fpfap'+_a+_b);

:: dokumenty magazynowe
        ND.use('nagdo'+_a+_b);
       N_K.use('nagko'+_a+_b);
        DK.use('dokma'+_a+_b);
      DK_K.use('dokko'+_a+_b);
      DK_C.use('dokce'+_a+'__');
     DK_LN.use('dokln'+_a+_b);
     DK_LI.use('dokli'+_a+_b);
      DK_L.use('doklk'+_a+_b);
     DK_HS.use('dokhs'+_a+_b);
       PAL.use('palety');
   PAL_POZ.use('paletyp');
       INN.use('inw_n'+_a+_b);
       INP.use('inw_p'+_a+_b);
      INPD.use('inw_d'+_a+_b);
       INX.use('inw_x'+_a+_b);
       INY.use('inw_y'+_a+_b);
    INNKOM.use('inkom'+_a+_b);

:: parametry oddziału
   KSTE.use('permane'+_a);
   KSTE.index('KST');
   KSTE.prefix();
   KSTE.first();

:: opakowania
     OPAK_N.use('opakn'+_a+_b);
     OPAK_P.use('opakp'+_a+_b);
   OPAK_SKH.use('opakb'+_a+'__');
    OPAK_SK.use('opakk'+_a+'__');
   OPAK_SKD.use('opakd'+_a+'__');
    OPAK_SM.use('opaks'+_a+'__');
    OPAK_SD.use('opaka'+_a+'__');
   OPAK_ZWR.use('opakz'+_a+_b);
   OPAK_OPT.use('opakopt'+_a);

:: zamówienia klienta
   exec('openz','open_tab',_a+'__');

:: zamówienia do dostawców
   exec('openzd','open_tab',_a+'__');

:: reklamacje
   exec('rek_open','open_tab',_a,'__');

:: intrastat
     IST.use('it____'+_b);
    ISTZ.use('itz___'+_b);
    ISTT.use('itt___'+_b);
   ISTTS.use('itts__'+_b);
    ISTW.use('itw___'+_b);

:: cenniki
     TAP.use('taryfp__');
   TAR_H.use('taryh'+_a+_b);

:: kontroling
   SCH_XD.use('scxd_'+_a+_b);
   CON_KG.use('cog____');

:: edi
   EDI_I.use('edi_i'+'_'+_b);

:: plany sprzedaży
    PS.use('plspr__'+_a);
   PSP.use('psp_____');

:: czytniki kodów
   exec('openean','open_tab',_a+'__');

:: badania
   BADH.use('badh_'+_a+'__');
   BADP.use('badp_'+_a+'__');

:: produkcja
     ZLGD.use('zlgd_'+_a+_b);
     ZLGB.use('zlgb_'+_a+_b);
     ZL_WYRGD.use('zlgw_'+_a+_b);
      KAP.use('kap__'+_a+_b);
      RBP.use('rbp__'+_a+_b);
      RBN.use('rbn__'+_a+_b);
     NKOD.use('kodn_'+_a+_b);
     PKOD.use('kodp_'+_a+_b);
       KE.use('ke__'+_a+_b);
       KM.use('km__'+_a+_b);
    ZPARS.use('zpars'+_a+_b);

:: projekty
   PROJ2FAP.use('pj_2f'+_a+_b);
   PROJ2ZDP.use('pj_2zdp'+_a);

:: remonty
::   exec('rem_open','open_tab','_'+'__');

:: umowy
   exec('zle_open','open_tab',_a,_b);

:: karty przekazania odpadów
   exec('kpo_open','open_tab',_a,_b);

:: zlecenia fakturowania
   FAKZ.use('fz'+REF.FIRMA().SYMBOL+_a+_b);
   FAKZ2FAP.use('fakzf'+_a+_b);

:: pozycje dostaw magazynowych
   DKDOST.use('dm'+REF.FIRMA().SYMBOL+_a+_b);

:: rozrachunki projektów
::   OP_PROJ.use('rozpro__');

:: informacje o operacjach
   L_LOG.use('xllog'+_a+_b);

:: załączniki
   DOKUML.use('atta_'+_a+_b);

:: log-i operacji na urządzeniach mobilnych
   EANLOG.use('elog____');

:: tłumaczenia
   TRANSLAT.use('translat');

:: zlecenia transportu
   exec('opentr','open_tab','____');

:: otwarcie dodatkowych tabel
   Plugin.run('OPEN_MASK_001','open',_a,_b,'');
''


\openz_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2008]
:: OPIS: cntx_psh dla openz
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
 ZK_N.cntx_psh();
 ZK_P.cntx_psh();
ZK_RN.cntx_psh();
ZK_RP.cntx_psh();
ZKW_N.cntx_psh();
ZKW_P.cntx_psh();
  REZ.cntx_psh()


\openz_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2008]
:: OPIS: cntx_pop dla openz
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
 ZK_N.cntx_pop();
 ZK_P.cntx_pop();
ZK_RN.cntx_pop();
ZK_RP.cntx_pop();
ZKW_N.cntx_pop();
ZKW_P.cntx_pop();
  REZ.cntx_pop()


\openz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2008]
:: OPIS: Otwiera tabele dla zamówień sprzedaży
::   WE:  _a  kod oddziału + ostatnie dwie cyfry roku
::  OLD: \openz/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
 ZK_N.use('zknag'+_a);
 ZK_P.use('zkpoz'+_a);
ZK_RN.use('zkhin'+_a);
ZK_RP.use('zkhip'+_a);
ZKW_N.use('zkpwn'+_a);
ZKW_P.use('zkpwp'+_a);
  REZ.use('rezz'+_a);
Plugin.run('OPEN_MASK_001','openz',(1+_a),(1-_a),'');
1


\openzd_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: cntx_psh dla openzd
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
 ZD_NAG.cntx_psh();
 ZD_POZ.cntx_psh();
  ZD_RN.cntx_psh();
  ZD_RP.cntx_psh();
ZDP_NAG.cntx_psh();
ZDP_POZ.cntx_psh()


\openzd_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: cntx_pop dla openzd
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
 ZD_NAG.cntx_pop();
 ZD_POZ.cntx_pop();
  ZD_RN.cntx_pop();
  ZD_RP.cntx_pop();
ZDP_NAG.cntx_pop();
ZDP_POZ.cntx_pop()


\openzd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2008]
:: OPIS: Otwiera tabele dla zamówien dostaw
::   WE:  _a  kod oddziału + ostatnie dwie cyfry roku
::  OLD: \openzd/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
 ZD_NAG.use('zdnag'+_a);
 ZD_POZ.use('zdpoz'+_a);
  ZD_RN.use('zdhin'+_a);
  ZD_RP.use('zdhip'+_a);
ZDP_NAG.use('zdptn'+_a);
ZDP_POZ.use('zdptp'+_a);
Plugin.run('OPEN_MASK_001','openzd',(1+_a),(1-_a),'');
1


\openean
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [2009]
:: OPIS: Otwiera tabele operacji na czytnikach
::   WE:  _a  kod oddziału + ostatnie dwie cyfry roku
::  OLD: \openean/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
PAL.use('palety');
EANN.use('eann'+_a);
EANP.use('eanp'+_a);
EANW.use('eanw'+_a);
Plugin.run('OPEN_MASK_001','openean',(1+_a),(1-_a),'');
1


\mag_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [2009+]
:: OPIS: otwarcie tabel maskowalnych dokumentow magazynowych
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku
::  OLD: \mag_open/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
ND.use('nagdo'+_a+_b);
DK.use('dokma'+_a+_b);
FAKS_K.use('fakkk'+_a+_b);
FAP_K.use('fapkk'+_a+_b);
TAXJ.use('taxjo'+_a+_b);
DK_C.use('dokce'+_a+'__');
DK_LN.use('dokln'+_a+_b);
DK_LI.use('dokli'+_a+_b);
DK_L.use('doklk'+_a+_b);
DK_HS.use('dokhs'+_a+_b);
PAL.use('palety');
PAL_POZ.use('paletyp');
Plugin.run('OPEN_MASK_001','mag_open',_a,_b,'');
1


\inw_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [12.10]
:: OPIS: otwarcie tabel maskowalnych inwentaryzacji
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku
::  OLD: \inw_open/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
INN.use('inw_n'+_a+_b);
INP.use('inw_p'+_a+_b);
INPD.use('inw_d'+_a+_b);
INX.use('inw_x'+_a+_b);
INY.use('inw_y'+_a+_b);
INNKOM.use('inkom'+_a+_b);
Plugin.run('OPEN_MASK_001','inw_open',_a,_b,'');
1


\dkc_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [12.10]
:: OPIS: otwarcie tabel maskowalnych cech dostaw
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku
::  OLD: \dkc_open/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
DK.use('dokma'+_a+_b);
FAP.use('fakpo'+_a+_b);
ZK_P.use('zkpoz'+_a+_b);
REZ.use('rezz'+_a+_b);
ZD_POZ.use('zdpoz'+_a+_b);
PAL.use('palety');
PAL_POZ.use('palet'+_b);
:: PX_OBJ na razie nie jest maskowalny
::PX_OBJ.use('pxobj'+_a+_b);
SC.use('stc__'+_a+_b);
INP.use('inw_p'+_a+_b);
TCHMAT.use('txmac'+'_'+_b);
TMAT.use('txmat'+'_'+_b);
Plugin.run('OPEN_MASK_001','dkc_open',_a,_b,'');
1


\fak_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2001]
:: OPIS: otwarcie tabel maskowalnych dokumentow sprzedazy
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku
::  OLD: \fak_open/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
FAKS.use('faktu'+_a+_b);
FAKSV.use('faksv'+_a+_b);
FAKS_K.use('fakkk'+_a+_b);
FAKSKH.use('fkpf_'+_a+_b);
FAKSPL.use('fakpl'+_a+_b);
FAKSO.use('fakto'+_a+_b);
FAKSPOLA.use('faktp'+_a+_b);
FAP.use('fakpo'+_a+_b);
FAP_K.use('fapkk'+_a+_b);
TAXJ.use('taxjo'+_a+_b);
FPACZFAP.use('fpfap'+_a+_b);
Plugin.run('OPEN_MASK_001','fak_open',_a,_b,'');
1


\prz_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: otwarcie tabel przeceny
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
INN.use('inw_nwyc');
INP.use('inw_pwyc');
INX.use('inw_xwyc');
INY.use('inw_ywyc');
INNKOM.use('inkomwyc')


\prz_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: cntx_psh dla prz_open
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
INN.cntx_psh();
INP.cntx_psh();
INX.cntx_psh();
INY.cntx_psh();
INNKOM.cntx_psh()


\prz_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: cntx_pop dla prz_open
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
INY.cntx_pop();
INX.cntx_pop();
INP.cntx_pop();
INN.cntx_pop();
INNKOM.cntx_pop()


\zlm_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MZ [2009]
:: OPIS: otwarcie tabel maskowalnych miesiecznie zwiazanych ze zgloszeniami
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku
::       [_c] - miesiac obrachunkowy np. '01'
::  OLD: \zlm_open/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
{? _>=3 || {? type_of(_c)<>2 || _c:=form('00'+$ST.AM,-2) ?} || _c:=form('00'+$ST.AM,-2) ?};
ZLP.use('zlp'+_a+_b+_c);
FPACZZLT.use('fpz'+_a+_b+_c);
Plugin.run('OPEN_MASK_001','zlm_open',_a,_b,_c);
1


\open_pkw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.14]
:: OPIS: Otwarcie tabel maskowalnych na potrzeby obszaru PKW (webTerm)
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
:: Pracownicy i zatrudnienie
P.use('pracowni');
exec('otworz_h_um','pracownik','h_um');
H.use('_hist');
:: Wzorce czasu pracy
R_WZCZ.use('r_wzczas');
{? REF.FIRMA=null
|| KAL_DEF.use('kal_d__')
|| KAL_DEF.use('kal_d'+($REF.FIRMA+2))
?};
:: Zestawienia zbiorcze
ZB_DEF.use('d_zb____');
ZB_WART.use('q_______');
:: Tabele kursów i kursy walut
TKRS.use('tabkrs__');
KRS.use('kursy___');
:: Typy dokumentów modyfikujących środki trwałe (wykorzystywane w KST_WAR.WARTOSC)
SRDT.use('srdt____');
1


\open_prc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Otwarcie tabel maskowalnych na potrzeby obszaru PRC (webTerm)
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
:: Pracownicy i zatrudnienie
P.use('pracowni');
exec('otworz_h_um','pracownik','h_um');
H.use('_hist');
:: Dokumenty kadrowe
{? REF.FIRMA<>null
|| ZZ_DOK.use('zz_do'+($REF.FIRMA+1))
?};
:: Wzorce czasu pracy
R_WZCZ.use('r_wzczas');
{? REF.FIRMA=null
|| KAL_DEF.use('kal_d__')
|| KAL_DEF.use('kal_d'+($REF.FIRMA+2))
?};
:: obiekt i maski tabel potrzebnych do prc
exec('MASK','object');
MASK.Init();
:: wstępne ustawienie maski z bieżącego roku
exec('PKALSYND_mask','pkalsync',date()~1);

:: ustawienie domyślnych indexów
R_KARHIS.index('PR_DATA');
R_SPEC.index('R_SPECD');
R_WYK.index('R_WYKDN');
R_WO.index('PORM');
R_WZCZ.index('R_WZCZ');
A_OKRP.index('A_OKRPR');
R_MARG.index('R_MARG');
A_SCPP.index('POD');
A_OKRD.index('POD');
PKALSYNC.index('PRAC');
PKALSYND.index('SYNC');
1


\open_ppk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [19.22]
:: OPIS: Otwarcie tabel maskowalnych na potrzeby obszaru PPK (webTerm)
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
:: Pracownicy i zatrudnienie
P.use('pracowni');
exec('otworz_h_um','pracownik','h_um');
H.use('_hist');
:: Wzorce czasu pracy
R_WZCZ.use('r_wzczas');
{? REF.FIRMA=null
|| KAL_DEF.use('kal_d__')
|| KAL_DEF.use('kal_d'+($REF.FIRMA+2))
?};
1


\mag_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.28]
:: OPIS: Zachowanie kontekstów dla tabel dokumentów magazynowych
::----------------------------------------------------------------------------------------------------------------------
ND.cntx_psh();
N_K.cntx_psh();
DK.cntx_psh();
DK_K.cntx_psh();
DK_C.cntx_psh();
DK_LN.cntx_psh();
DK_LI.cntx_psh();
DK_L.cntx_psh();
DK_HS.cntx_psh();
PAL_POZ.cntx_psh();
FAKS_K.cntx_psh();
FAP_K.cntx_psh();
FAKSV.cntx_psh();
TAXJ.cntx_psh();
1


\mag_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.28]
:: OPIS: Przywrócenie kontekstów dla tabel dokumentów magazynowych
::----------------------------------------------------------------------------------------------------------------------
ND.cntx_pop();
N_K.cntx_pop();
DK.cntx_pop();
DK_K.cntx_pop();
DK_C.cntx_pop();
DK_LN.cntx_pop();
DK_LI.cntx_pop();
DK_L.cntx_pop();
DK_HS.cntx_pop();
PAL_POZ.cntx_pop();
FAKS_K.cntx_pop();
FAP_K.cntx_pop();
FAKSV.cntx_pop();
TAXJ.cntx_pop();
1


\open_edok
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.42]
:: OPIS: Otworzenie masek dla dokumentów w obiegu
::   WE: _a - maska do otwarcia
::----------------------------------------------------------------------------------------------------------------------
EDOK_ZAL.use('edokzl'+_a);
EDOKGR.use('skid_c'+_a);
EDOKLOG.use('skid_d'+_a);
EDOKOS.use('skid_y'+_a);
EDOKPAR.use('skidh_'+_a);
EDOKUSER.use('skidk_'+_a);
EDOKRZAP.use('skid_q'+_a);
EDOKUM.use('skid_v'+_a);
EDOKUMW.use('skidv1'+_a);
EDOKUMD.use('bdiety'+_a);
EDOKUMP.use('skidpu'+_a);
EDOKUMZ.use('skid_n'+_a);
EDOKUMZS.use('skids_'+_a);
EPODZ.use('skid_j'+_a);
EDOKUMPR.use('skid_i'+_a);
EVAT.use('skid_a'+_a);
EDOK_ATR.use('edokat'+_a);
EDOK_ATK.use('edoknt'+_a);
~~


\edok_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.42]
:: OPIS: Zachowanie kontekstów dla dokumentów w obiegu
::----------------------------------------------------------------------------------------------------------------------
EDOK_ZAL.cntx_psh();
EDOKGR.cntx_psh();
EDOKLOG.cntx_psh();
EDOKOS.cntx_psh();
EDOKPAR.cntx_psh();
EDOKUSER.cntx_psh();
EDOKRZAP.cntx_psh();
EDOKUM.cntx_psh();
EDOKUMW.cntx_psh();
EDOKUMD.cntx_psh();
EDOKUMP.cntx_psh();
EDOKUMZ.cntx_psh();
EDOKUMZS.cntx_psh();
EPODZ.cntx_psh();
EDOKUMPR.cntx_psh();
EVAT.cntx_psh();
EDOK_ATR.cntx_psh();
EDOK_ATK.cntx_psh();
~~


\edok_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.42]
:: OPIS: Przywrócenie kontekstów dla dokumentów w obiegu
::----------------------------------------------------------------------------------------------------------------------
EDOK_ZAL.cntx_pop();
EDOKGR.cntx_pop();
EDOKLOG.cntx_pop();
EDOKOS.cntx_pop();
EDOKPAR.cntx_pop();
EDOKUSER.cntx_pop();
EDOKRZAP.cntx_pop();
EDOKUM.cntx_pop();
EDOKUMW.cntx_pop();
EDOKUMD.cntx_pop();
EDOKUMP.cntx_pop();
EDOKUMZ.cntx_pop();
EDOKUMZS.cntx_pop();
EPODZ.cntx_pop();
EDOKUMPR.cntx_pop();
EVAT.cntx_pop();
EDOK_ATR.cntx_pop();
EDOK_ATK.cntx_pop();
~~


\stan_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [12.10]
:: OPIS: otwarcie tabel maskowalnych stanów magazynowych
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku
::----------------------------------------------------------------------------------------------------------------------
SM.use('stm__'+_a+'zb');
SC.use('stc__'+_a+_b);
SL.use('stl__'+_a+'zb');
SLD.use('sld__'+_a+'zb');
Plugin.run('OPEN_MASK_001','stan_open',_a,_b,'');
~~


\fak_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [18.42]
:: OPIS: zachowanie kontekstów
::----------------------------------------------------------------------------------------------------------------------
FAKS.cntx_psh();
FAKSV.cntx_psh();
FAKS_K.cntx_psh();
FAKSPL.cntx_psh();
FAKSO.cntx_psh();
FAP.cntx_psh();
FAP_K.cntx_psh();
TAXJ.cntx_psh();
1


\fak_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [18.42]
:: OPIS: przywrócenie kontekstów
::----------------------------------------------------------------------------------------------------------------------
FAKS.cntx_pop();
FAKSV.cntx_pop();
FAKS_K.cntx_pop();
FAKSPL.cntx_pop();
FAKSO.cntx_pop();
FAP.cntx_pop();
FAP_K.cntx_pop();
TAXJ.cntx_pop();
1


\zle_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MZ [2009]
:: OPIS: otwarcie tabel maskowalnych systemu zwiazanych ze zgloszeniami
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku np. '08'
::      [_c] - miesiac obrachunkowy np. '01'
::  OLD: \zle_open/tr_arch.fml
::----------------------------------------------------------------------------------------------------------------------
{? _>=3 || {? type_of(_c)<>2 || _c:=form('00'+$ST.AM,-2) ?} || _c:=form('00'+$ST.AM,-2) ?};
ZLE.use('zlecen_'+_a);
ZLP.use('zlp'+_a+_b+_c);
FPACZZLT.use('fpz'+_a+_b+_c);
GPODPOZ.use('gpodb'+_a+_b);
BIGB.use('bigb'+_a+_b);
Plugin.run('OPEN_MASK_001','zle_open',_a,_b,_c);
1


::\rem_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.22]
:: OPIS: Otwarcie tabel maskowalnych związnych z obsługą remontów
::   WE: _a  '_' + ('__' albo ostatnie dwie cyfry roku)
::----------------------------------------------------------------------------------------------------------------------
::REM_ZGL.use('rmzgl'+_a);
::REM_PLAN.use('rmzgp'+_a);
::Plugin.run('OPEN_MASK_001','rem_open',(1+_a),(1-_a),'');
::~~


\kpo_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: otwarcie tabel maskowalnych kart przekazania odpadów (KPO, KEO)
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku np. '08'
::----------------------------------------------------------------------------------------------------------------------
KPO.use('kprze'+_a+_b);
KPOZ.use('kprpo'+_a+_b);
KPOT.use('kprpt'+_a+_b);
KEO.use('keodp'+_a+_b);
KEOP.use('keopo'+_a+_b);
Plugin.run('OPEN_MASK_001','kpo_open',_a,_b,'');
1


\opentr_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Markus [19.42]
:: OPIS: cntx_psh dla opentr
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
TR_NZL.cntx_psh();
TR_ZL.cntx_psh();
TR_ZLM.cntx_psh();
TR_NAG.cntx_psh();
TR_LOG.cntx_psh();
TR_KOS.cntx_psh()


\opentr_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Markus [19.42]
:: OPIS: cntx_pop dla opentr
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
TR_NZL.cntx_pop();
TR_ZL.cntx_pop();
TR_ZLM.cntx_pop();
TR_NAG.cntx_pop();
TR_LOG.cntx_pop();
TR_KOS.cntx_pop()


\opentr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Markus [19.42]
:: OPIS: Otwiera tabele dla zleceń transportu
::   WE:  _a ostatnie dwie cyfry roku oraz miesiąc
::----------------------------------------------------------------------------------------------------------------------
TR_NZL.use('trnl'+_a);
TR_ZL.use('trzl'+_a);
TR_ZLM.use('trml'+_a);
TR_NAG.use('trnt'+_a);
TR_LOG.use('trlo'+_a);
TR_KOS.use('trko'+_a);
TR_PACK.use('trpk'+_a);
TR_ZPACK.use('trpz'+_a);
TR_HPACK.use('trph'+_a);
TR_SPACK.use('trpu'+_a);
Plugin.run('OPEN_MASK_001','opentr','_',(2+_a),(2-_a));
1


\zle_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: zachowanie kontekstu dla tabel zwiazanych ze zgloszeniami
::----------------------------------------------------------------------------------------------------------------------
ZLE.cntx_psh();
ZLP.cntx_psh();
FPACZZLT.cntx_psh();
GPODPOZ.cntx_psh();
BIGB.cntx_psh();
1


\zle_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [19.42]
:: OPIS: przywrócenie kontekstu dla tabel zwiazanych ze zgloszeniami
::----------------------------------------------------------------------------------------------------------------------
ZLE.cntx_pop();
ZLP.cntx_pop();
FPACZZLT.cntx_pop();
GPODPOZ.cntx_pop();
BIGB.cntx_pop();
1


\rek_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [21.14]
:: OPIS: otwarcie tabel maskowalnych reklamacji
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku np. '08'
::----------------------------------------------------------------------------------------------------------------------
REK_N.use('rekn'+_a+_b);
REK_D.use('rekd'+_a+_b);
REK_H.use('rekh'+_a+_b);
Plugin.run('OPEN_MASK_001','rek_open',_a,_b,'');
1


\rek_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [21.14]
:: OPIS: zapamiętanie kontekstu dla tabel zwiazanych z reklamacjami
::----------------------------------------------------------------------------------------------------------------------
REK_N.cntx_psh();
REK_D.cntx_psh();
REK_H.cntx_psh();
1


\rek_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [21.14]
:: OPIS: przywrócenie kontekstu dla tabel zwiazanych z reklamacjami
::----------------------------------------------------------------------------------------------------------------------
REK_N.cntx_pop();
REK_D.cntx_pop();
REK_H.cntx_pop();
1


\openod
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [22.26]
:: OPIS: otwiera tabele dla opłat dodatkowych
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku np. '08'
::----------------------------------------------------------------------------------------------------------------------
FAKS.use('faktu'+_a+_b);
FAKS_K.use('fakkk'+_a+_b);
FAP.use('fakpo'+_a+_b);
FAP_K.use('fapkk'+_a+_b);
TAXJ.use('taxjo'+_a+_b);
ND.use('nagdo'+_a+_b);
DK.use('dokma'+_a+_b);
TAXJ.use('taxjo'+_a+_b);
DK_C.use('dokce'+_a+'__');
FPACZFAP.use('fpfap'+_a+_b);
Plugin.run('OPEN_MASK_001','openod',_a,_b,'');
1


\openod_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [22.26]
:: OPIS: zachowanie kontekstu dla opłat dodatkowych
::----------------------------------------------------------------------------------------------------------------------
FAKS.cntx_psh();
FAKS_K.cntx_psh();
FAP.cntx_psh();
FAP_K.cntx_psh();
TAXJ.cntx_psh();
ND.cntx_psh();
DK.cntx_psh();
TAXJ.cntx_psh();
DK_C.cntx_psh();
1


\openod_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [22.26]
:: OPIS: przywrócenie kontekstu dla opłat dodatkowych
::----------------------------------------------------------------------------------------------------------------------
FAKS.cntx_pop();
FAKS_K.cntx_pop();
FAP.cntx_pop();
FAP_K.cntx_pop();
TAXJ.cntx_pop();
ND.cntx_pop();
DK.cntx_pop();
TAXJ.cntx_pop();
DK_C.cntx_pop();
1


\openean_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: Otwiera tabele operacji na czytnikach - zachowuje konteksty
::----------------------------------------------------------------------------------------------------------------------
PAL.cntx_psh();
EANN.cntx_psh();
EANP.cntx_psh();
EANW.cntx_psh();
1


\openean_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: Otwiera tabele operacji na czytnikach - przywraca konteksty
::----------------------------------------------------------------------------------------------------------------------
PAL.cntx_pop();
EANN.cntx_pop();
EANP.cntx_pop();
EANW.cntx_pop();
1


\inw_open_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: otwarcie tabel maskowalnych inwentaryzacji - zachowuje konteksty
::----------------------------------------------------------------------------------------------------------------------
INN.cntx_psh();
INP.cntx_psh();
INPD.cntx_psh();
INX.cntx_psh();
INY.cntx_psh();
INNKOM.cntx_psh();
1


\inw_open_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: otwarcie tabel maskowalnych inwentaryzacji - przywraca konteksty
::----------------------------------------------------------------------------------------------------------------------
INN.cntx_pop();
INP.cntx_pop();
INPD.cntx_pop();
INX.cntx_pop();
INY.cntx_pop();
INNKOM.cntx_pop();
1


\stan_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: zachowanie kontekstów dla stanów
::----------------------------------------------------------------------------------------------------------------------
SM.cntx_psh();
SC.cntx_psh();
SL.cntx_psh();
SLD.cntx_psh();
1


\stan_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: przywrócenie kontekstów dla stanów
::----------------------------------------------------------------------------------------------------------------------
SM.cntx_pop();
SC.cntx_pop();
SL.cntx_pop();
SLD.cntx_pop();
1


\fap2dk_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: otwarcie tabel maskowalnych powiązań faktura-dokument
::   WE: _a - kod oddzialu
::       _b - ostatnie dwie cyfry roku
::       _c - dk/sp - wartości dla maski FAP2DK
::----------------------------------------------------------------------------------------------------------------------
ND.use('nagdo'+_a+_b);
DK.use('dokma'+_a+_b);
FAKS.use('faktu'+_a+_b);
FAP.use('fakpo'+_a+_b);
FAP2DK.use('fapto'+_c+_a);
Plugin.run('OPEN_MASK_001','fap2dk',_a,_b,'');
1


\fap2dk_psh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: zachowanie kontekstu tabel maskowalnych powiązań faktura-dokument
::----------------------------------------------------------------------------------------------------------------------
ND.cntx_psh();
DK.cntx_psh();
FAKS.cntx_psh();
FAP.cntx_psh();
FAP2DK.cntx_psh();
1


\fap2dk_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [23.25]
:: OPIS: przywrócenie kontekstu tabel maskowalnych powiązań faktura-dokument
::----------------------------------------------------------------------------------------------------------------------
ND.cntx_pop();
DK.cntx_pop();
FAKS.cntx_pop();
FAP.cntx_pop();
FAP2DK.cntx_pop();
1

:Sign Version 2.0 jowisz:1045 2023/09/27 10:38:08 4798bd754625ebc87a5f5e2e1c1cc1a70dc3fa513b800c4b1c78135ae14175e87dc3c0ca9321b8e4302e8799efe54d575059d7b3cb6010477f5daeb63e54a281129fe99efd5f3e4b9a14a35599b4d30b6bb87b53d42d92d364a17bc372310d6d6ec91c91c83ff43d3ee6d24e23d80c2aa94110086329605cdc7046bf77d16a30
