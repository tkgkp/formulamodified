:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzezone
::======================================================================================================================
:: Nazwa pliku: pulpit.fml [12.10]
:: Utworzony: 2011/06/08
:: Autor: P. Grochowski
::======================================================================================================================
:: Zawartosc: zawiera formuly sluzace do obslugi aplikacji Pulpit.
:: *********************************************************************************************************************
:: Aby dodac nowe pozycje do drzewa nalezy zmodyfikowac procedure 'links' na koncu pliku.
:: *********************************************************************************************************************
::======================================================================================================================


\start
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Przemyslaw Grochowski [12.10]
:: OPIS: Formula startowa.
::  OLD: \start/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
exec('obj_pul','pulpit');
OBJ_P:=obj_new(@.CLASS.PULPIT);
OBJ_P.TMP:=exec('tab_tmp','pulpit');
title('Pulpit - [Firma: %1]'@[__Firma],'tab',1);
title('Pulpit'@,'title_bar');

:: ustawienie kontekstu dokumentacji
_path:=exec('set_help','#help','');
_jTerm:=app_info('web_sesid')='';
{? _jTerm || set_help(_path) || web_set_help(_path) ?};

_cli_ver:=exec('cli_ver','#system');
{? _cli_ver='jterm'
|| dsk_menu('PULPIT_J','Czy zakończyć program?'@,"exec('panel','pulpit',1)","exec('ctr_callback','pulpit')")
|? _cli_ver='interm'
|| dsk_menu('PULPIT_I','Czy zakończyć program?'@,"exec('panel','pulpit_interm',1)","exec('ctr_callback','pulpit_interm')")
?};
~~


\obj_pul
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Przemyslaw Grochowski [12.10]
:: OPIS: Deklaracja klasy pulpit
::       Pole USER - uzytkownik zalogowany do aplikacji pulpit
::  OLD: \obj_pul/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
obj_decl('PULPIT',
   obj_fld('USER', app_info('app_user')),
   obj_fld('HASH',''),
   obj_fld('HOSTLOTU',''),
   obj_fld('URL_LOTU',''),
   obj_fld('PTH', exec('pth','pulpit')),
   obj_fld('IDENT', app_info('app_ident')),
   obj_fld('GROUP', exec('firma_reload_params','#firma',REF.FIRMA().SYMBOL,FIRMA.APP_IDEN).grp_iden),
   obj_fld('TMP', 0),
   obj_fld('IND1', 0),
   obj_fld('IND2', 0),
   obj_meth('leaf',
   "_field:=obj_new('Rodzic',
                  'Komenda',
                  'Nazwa',
                  'Podpowiedz',
                  'Ikona_m',
                  'Ikona_p',
                   'AdresURL',
                  'Alias_aplikacji',
                  'Alias_grupy',
                  'Akronim_menu',
                   'Parametry',
                  );
     {! _ii:=1 .. obj_len(_field) |!
       _field[_ii]:=''
     !};
     _field[1]:=0;
     _field[2]:=0;
     _field[13]:=0;
     return(_field)
   "),
   obj_meth('blank',
   " {! _ii:=1 .. obj_len(_a) |!
       _a[_ii]:=''
     !};
     _a[1]:=0;
     _a[2]:=0;
     _a[13]:=0
   ",type_of(obj_new(1))),
)


\tab_tmp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Tabela tymczasowa dla kontrolki
::    'PARENT'    - wskazanie na element nadrzędny
::    'TITLE'     - nazwa elementu wyświetlana w drzewku
::    'INIT_FML'  - akronim formuły współdzielonej wyszukującej formułę obsługi
::    'UID_EXE'   - uidref formuły startowej elementu lub dla dziedziny identyfkator wspomagający obsługę skrótów w webTermie
::    'UID_MOD'   - uidref formuły podglądu procesu w modelerze
::    'TYPE'      - typ elementu (kiedyś częściowo w M_ACR):
::                   'report'   - raport
::                   'event'   - zdarzenie startowe
::                   'area'   - obszar roboczy
::    'CMD'       -'Parametr decydujacy o mozliwosci uruchamiania pozycji':
::                   0 = CMD_NONE                  - Pozycji nie mozna uruchomic ani dodac do niej skrotu;
::                   1 = CMD_OPEN_APLICATION         - Pozycja z mozliwoscia uruchomienia i dodania skrotu;
::                   2 = CMD_OPEN_WEBBROWSER_WND   - Pozycja otwierana w zakladce w przegladarce;
::                   3 = CMD_OPEN                  - Pozycja otwierana w domyslnej przegladarce internetowej;
::    'HELP'      - podpowiedź w pasku statusu
::    'DOKUWIKI'  - url do pomocy w DokuWiki
::    'COLOR'     - kolor dla dziedziny
::    'ICON'      - ikona elementu 16x16
::    'BIG_ICON'  - ikona elementu 32x32
::    'URL'       - adres/ścieżka http podawane w przypadku linków
::    'DSK_URL'   - adres/ścieżka http dla przeglądarki wewnętrznej
::    'APP_NAME'  - identyfikator aplikacji
::    'GR_NAME'   - grupa aplikacji
::  OLD: \tab_tmp/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(1,  'PARENT', 'TREE_REF', ,
                  'TITLE','STRING[45]',,
                  'INIT_FML','STRING[35]',,
                  'UID_EXE','STRING[48]',,
                  'UID_MOD','STRING[48]',,
                  'TYPE','STRING[10]',,
                  'CMD', 'INTEGER', ,
                  'HELP','STRING[60]',,
                  'DOKUWIKI','STRING[255]',,
                  'COLOR','STRING[23]',,
                  'ICON', 'STRING[255]', ,
                  'BIG_ICON', 'STRING[255]', ,
                  'URL','STRING[255]', ,
                  'DSK_URL','STRING[255]',,
                  'APP_NAME','STRING[30]',,
                  'GR_NAME','STRING[30]',
                  );
OBJ_P.IND1:=_tab.index('?');
_tab


\panel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Przemyslaw Grochowski [12.30]
:: OPIS: Wywolanie kontrolki pulpitu
::  WE: _a - flaga wypelniania drzewka pulpitu
::       0 - brak wypelnienia
::       1 - wypelnienil
::  OLD: \panel/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
_fill:=_a;

exec('AreaTitle','#object');
AreaTitle.setArea('#PULPIT');
AreaTitle.setTitle();

inst_dsk('@dskmenuctrl');
{? ctr_call('!desktop',,'isRunning')
||
   FUN.info('Pulpit jest już uruchomiony'@);
   break()
?};

_file:=fopen(app_info('pth_name')+'.fml','r',1,0,1);
{? _file.is_open()
||
   __id:=OBJ_P.USER+hash(_file);
   _file.fclose()
|| __id:=''
?};
_saved:=ctr_call('!desktop',,'readTreeData', __id);
{? _saved=0 | _fill
||
   progress(,'Trwa odświeżanie pulpitu'@,exec('nazwa','#system'),1);
   exec('fill_pulpit','#b_desktop');
   OBJ_P.TMP.index(OBJ_P.IND1);
   exec('send_tree','pulpit');
   ctr_set('!desktop',,'saveTreeData', __id)
?};
prgs_clr();

: WYSZUKIWARKA
: dodawanie opcji wyszukiwania, opcja szukania w Pulpicie dodaje się automatycznie i jest wybrana jako domyślna
: SEARCH - formuła startowa dla zakładki z wynikiem, należy podać akronim formuły z definicji
_es:=exec('elastic','elastic');
_es.info();

{? _es.ESERROR=0
||
   ctr_set('!desktop',,'addFilterType','Dane','%'+app_info('app_ident'),app_info('cluster_group'),app_info('app_ident'),
   'SEARCH','%'+app_info('app_ident'))
:   ctr_set('!desktop',,'addFilterType','Dane','%elastic',app_info('cluster_group'),app_info('app_ident'),'SEARCH','%elastic')
?};
:ctr_set('!desktop',,'addFilterType','Dokuwiki','%viki',app_info('cluster_group'),app_info('app_ident'),'SEARCH','%viki');

: gdyby ktoś chciał zmienić nazwę domyślnego szukania w pulpicie
: ctr_set('!desktop',,'setStdFilterTitle','Pitpul');
: WAŻNE: powyższe metody należy wywołać przed initDesktop
: /WYSZUKIWARKA

:Genius
exec('czytaj','#stalesys',,XINFO);
{? XINFO.GEN_PO = 'T' ||
	ctr_call('!desktop',,'addLeftMenuActionActivateApp', 'Asystent', 'Kliknij aby rozpocząć rozmowe z asystentem Genius','@system|genius', app_info('cluster_group'),app_info('app_ident'), 'BOT','%'+app_info('app_ident'))
?};
: /Genius


ctr_call('!desktop',,'initDesktop');

ctr_set('!desktop',,'setTodoInfoKeys','own_0','free_0');

_x1:=1; _y1:=1; _w1:=27;  _h1:=20;

:: tworzenie i zasilanie kontrolki FOTO
ctr_call('!desktop',,'addWindowControl','foto','@dskmenuctrl>userpanel','Użytkownik'@,_x1,_y1,_w1,_h1,'undecorated_frame');

:: tworzenie i zasilanie kontrolki FOTO
:: ustawienie tekstów wyświetlanych na zdjęciu
_obj:=exec('user_ident_desktop','#users');
ctr_set('!desktop','desktop:foto','setTexts',_obj.DANE,_obj.STAN);

:: konfiguracja przycisków bocznych

:: komunikator
ctr_set('!desktop','desktop:foto','setIMButton',1,pth_dir('komunikator.png')+OBJ_P.PTH+'komunikator.png','Komunikator'@);
:: strona WWW
ctr_set('!desktop','desktop:foto','setWWWButton','2@todo_web',pth_dir('web_ikona.png')+OBJ_P.PTH+'web_ikona.png','webTerm',exec('get_webterm_path','pulpit'),'TOKEN_WEB','');
: dokumentacja
ctr_set('!desktop','desktop:foto','setWWWButton',3,pth_dir('dokumentacja.png')+OBJ_P.PTH+'dokumentacja.png','Pomoc',exec('get_adres','#help','proc:pulpit'),'','');

:: zainicjowanie kontrolki FOTO
ctr_call('!desktop','desktop:foto','initControl');

:: tworzenie i zasilanie kontrolki TODO, definiowane elementów
_list_md:=exec('user_list_megad','#users',exec('operatorKod','#users'),'M');
_ilosc_md:=exec('count_substr','#string',_list_md,'|');

_dsk_param:=_w1;
{? _ilosc_md>0
|| _dsk_param:=_w1*2+1
?};
ctr_call('!desktop',,'addWindowControl','todo','@dskmenuctrl>todopanel','Zadania'@,_x1+_w1+1,_y1,_dsk_param,_h1,'undecorated_frame');

ctr_set('!desktop','desktop:todo','addItem','Zadania'@,'own_0','free_0','Przydzielone'@,'Wolne'@,'','Więcej'@);
{? _ilosc_md>0
||
   {? _list_md * 'Finanse'
   ||
      ctr_set('!desktop','desktop:todo','addSmallItem','Ewidencje finansowe'@,'own_1','free_1','21aaaa',1)
   ?};
   {? _list_md * 'Personel'
   ||
      ctr_set('!desktop','desktop:todo','addSmallItem','Personel'@,'own_2','free_2','a954a5',1)
   ?};
   {? _list_md * 'Logistyka i produkcja'
   ||
      ctr_set('!desktop','desktop:todo','addSmallItem','Logistyka i produkcja'@,'own_3','free_3','389848',1)
   ?};
   {? _list_md * 'Zarządzanie'
   ||
      ctr_set('!desktop','desktop:todo','addSmallItem','Zarządzanie'@,'own_4','free_4','f8982a',1)
   ?}
?};
{? _ilosc_md=3 | _ilosc_md=1
|| ctr_set('!desktop','desktop:todo','addSmallEmptyItem')
?};

:: inicjacja kontrolki TODO
ctr_set('!desktop','desktop:todo','initItems');

_lic:=user_info();
{? _lic.UsersInTerm>0 & XINFO.LINK_INT<>''
||
:: Tworzenie i zasilanie kontrolki "Macrologic Anywhere"
   _address:=XINFO.LINK_INT+'/app/'+app_info('cluster_group')+'/'+app_info('app_ident');
   ctr_call('!desktop',,'addWindowControl','qrcode','@dskmenuctrl>qrcode','Macrologic Anywhere'@,_x1+3*(_w1+1),_y1,10+_w1,_h1);
   ctr_set('!desktop','desktop:qrcode','setUrl',_address);
   ctr_set('!desktop','desktop:qrcode','initControl');
   ~~
||
:: Reklama Macrologic Anywhere
   _text:='<div style=\'text-align:center;\'>';
   _text+=
      'Dzięki %1 możesz pracować%2'
      'z systemem z dowolnego miejsca i urządzenia.%2'
      '%2'
      '%3Skontaktuj sie z opiekunem%4 po stronie Asseco BS%2'
      'aby dowiedzieć się więcej i uruchomić Anywhere w Twojej firmie.'@['<b><a href=\'https://assecobs.pl/asseco-anywhere/\'>Macrologic Anywhere</a></b>','<br>','<b>','</b>'];
   _text+='</div>';
   ctr_call('!desktop',,'addWindowControl','infoboard','@dskmenuctrl>infoboard','Macrologic Anywhere',_x1+3*(_w1+1),_y1,10+_w1,_h1);
   ctr_call('!desktop','desktop:infoboard','setHtmlBody', _text);
   ctr_call('!desktop','desktop:infoboard','initControl');
   ~~
:: ctr_call('!desktop',,'addWindowControl','web','@dskmenuctrl>webbrowser','Warto wiedzieć'@,_x1+3*(_w1+1),_y1,10+_w1,_h1)
?};

:: metoda powodująca ustawienie tytułu kontrolki takiego jak tytuł strony
:: ctr_set('!desktop','desktop:web','usePageTitle');

:: wyświetlenie strony:
::ctr_set('!desktop','desktop:web','loadURL','https://wartowiedziec.macrologic.pl/doc?currentuser='+OPERATOR.USER().KOD+';'+user(7));

:: inicjalizacja pozostałych elementów kontrolki
::ctr_set('!desktop','desktop:web','initControl');

_x2:=_x1; _y2:=_y1+_h1+1; _w2:=_w1; _h2:=35;

ctr_call('!desktop',,'addWindowControl','area','@dskmenuctrl>shrtworkspace','Obszary robocze'@,_x2,_y2,_w2,_h2);
ctr_call('!desktop','desktop:area','initWorkspaceControl');

ctr_call('!desktop',,'addWindowControl','event','@dskmenuctrl>shrtactiv','Start procesów'@,_x2+_w2+1,_y2,_w2,_h2);
ctr_call('!desktop','desktop:event','initActivityControl');

ctr_call('!desktop',,'addWindowControl','report','@dskmenuctrl>shrtlist','Raporty'@,_x2+2*(_w2+1),_y2,_w2,_h2);
ctr_call('!desktop','desktop:report','initListControl');

ctr_call('!desktop',,'addWindowControl','shortcut','@dskmenuctrl>shrtpanel','Skróty'@,_x2+3*(_w2+1),_y2,10+_w2,_h2);
ctr_call('!desktop','desktop:shortcut','initShortcutPanel');

ctr_call('!desktop',,'addUserWindows');

:: Zasilam górne cyferki TODO na belce
exec('todo_titlebar_count','pulpit');

:: Panelplus - elementy aplikacyjne
:: Parametry pracy
exec('parses_install','pulpit');

:: Lista TODO
exec('todo_install','pulpit');

:: Karteczki
exec('karteczki_install','pulpit');

:: Ustawienia i parametryzacja
exec('funpar_install','pulpit');

:: Panelplus - elementy wdrożeniowe
{? Plugin.exists('PULPIT_F_001') || Plugin.run('PULPIT_F_001') ?};
~~


\send_tree
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Przemyslaw Grochowski [12.30]
:: OPIS: Wypelnienie tabeli przesylanej do kontrolki pulpitu
::  OLD: \send_tree/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
:: Dodanie dodatkowych pozycji do drzewka
ctr_tab('treeItems','!desktop',,,OBJ_P.TMP)


\pth
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Przemyslaw Grochowski [12.10]
:: OPIS: Sciezka WIN|LINUX
::  OLD: \pth/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
{? sys_name(0)='U_LINUX' || '/' || '\\' ?}


\test_tree
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formula pokazuje drzewo przekazywane do kontrolki
::  OLD: \test_tree/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
OBJ_P.TMP.win_sel(_w:=OBJ_P.TMP.mk_sel(,'P',,,,,,1));
OBJ_P.TMP.win_fld(_w,,'TITLE',,,40,,,'TITLE');
OBJ_P.TMP.win_fld(_w,,'ICON',,,40,,,'ICON');
OBJ_P.TMP.win_fld(_w,,'COLOR',,,10,,,'COLOR');
OBJ_P.TMP.win_fld(_w,,'INIT_FML',,,10,,,'INIT_FML');
OBJ_P.TMP.win_fld(_w,,'UID_EXE',,,40,,,'UID_EXE');
OBJ_P.TMP.win_fld(_w,,'UID_MOD',,,40,,,'UID_MOD');
OBJ_P.TMP.win_act(_w,,'Formuła','Ro/&zwiń',,,,"OBJ_P.TMP.tr_set(~OBJ_P.TMP.tr_state())",,,,,'Z');
OBJ_P.TMP.win_act(_w,,'Formuła','Seek_uidref',,,,"msg('~#UID_EXE: '+{? PROC.seek(OBJ_P.TMP.UID_EXE) || PROC.FML || 'EXE=0' ?}+
                                                      '\nUID_MOD: '+{? PROC.seek(OBJ_P.TMP.UID_MOD) || PROC.FML || 'MOD=0' ?})",1,,,,'S');
OBJ_P.TMP.win_edit(OBJ_P.TMP.mk_edit(,1));
OBJ_P.TMP.select()


\area
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formuła współdzielona obsługująca obszary
::  OLD: \area/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_args:=params_get();
exec('proc_exec','#b_desktop',
   {? type_of(_args)>0 & var_pres('UID_EXE',_args)>0 || _args.UID_EXE || app_info('init_param') ?}
)


\event
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formuła współdzielona obsługująca starty procesów
::  OLD: \event/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
exec('proc_exec','#b_desktop',app_info('init_param'),1)


\report
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formuła współdzielona obsługująca raporty
::  OLD: \report/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
exec('proc_exec','#b_desktop',app_info('init_param'))


\button
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formuła współdzielona obsługująca przyciski
::  OLD: \button/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
exec('proc_exec','#b_desktop',app_info('init_param'))


\todo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formuła współdzielona obsługująca zadania
::  OLD: \todo/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')<>type_of(0) || _a:=1 ?};
_path:=exec('set_help','#help','proc:todo');

{? +app_info('web_sesid')
|| web_set_help(_path);
   {? exec('env_wt_core','#web_srv')
   || exec('select_user_www','#bi_todo');
      web_ses_close()
   ?}
||
   {? _a || exec('start_proces','b_proces',0) ?};
:: ustawienie kontekstu dokumentacji
   set_help(_path);

   exec('title','#bi_todo');
   params_exec('select_user','#bi_todo',app_info('app_user'),_a)
?};
~~


\token_qlik
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formuła współdzielona do obsługi uwierzytelniania QLIK
::  OLD: \token_qlik/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
_qlikTicket:='';
_exists:=exec('qticket_exists','analizy_bi');
{?_exists<>1
||
  REF.FIRMA:=exec('firma_ref','#firma',app_info('app_ident'));
  exec('czytaj','#stalesys',,XINFO,'ANBI_AM','ANBI_URL','ANBI_QUD','ANBI_CER','ANBI_PSW');
:: odczytanie informacji czy autentykacja meritowa w czasie wywołania analiz BI
  _meritAuth:={? +XINFO.ANBI_AM & XINFO.ANBI_AM='T' || 1 || 0 ?};
  {? _meritAuth
  ||
    _qlikTicket:=exec('get_ticket','analizy_bi',XINFO.ANBI_URL,XINFO.ANBI_QUD,XINFO.ANBI_CER,XINFO.ANBI_PSW);
    exec('qticket_set_info','analizy_bi')
  ||
    _qlikTicket:='Token='+sec_token('qlik')
  ?}
||
delay(,int(1000))
?};
{?cli_ver('Client')='interm'
     ||
        _z1:=params_get();
        ctr_call('!application',,'openWebBrowser', _z1.url+{?_z1.url*'?'=0||'?'||'&'?}+_qlikTicket,1)
     ||
   ctr_set('!application',,'addRetCommand','addParamToUrl',_qlikTicket)
?}


\token_web
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: Formuła współdzielona do obsługi uwierzytelniania webTerm
::  OLD: \token_web/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
: Formuła współdzielona do obsługi uwierzytelniania webTerm
ctr_set('!application',,'addRetCommand','addHashParamToUrl','token='+sec_token());
ctr_set('!application',,'addRetCommand','addHashParamToUrl','lang='+lang_language());
ctr_set('!application',,'addRetCommand','addHashParamToUrl','check_user='+app_info('app_user'))


\ctr_callback
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS:
::  OLD: \ctr_callback/#pulpit.fml
:: ~OST: INFORK
::----------------------------------------------------------------------------------------------------------------------
{? ctr_info('INIT_FML')='dsk_export'
|| exec('export_cfg','pulpit');
   return(0)
|? ctr_info('INIT_FML')='dsk_import'
|| exec('import_cfg','pulpit');
   return(0)
|? ctr_info('INIT_FML')='REPORT'
|| {? exec('is_okres','pulpit',__PARSES.getVal('OkresRok').OKRO)
   || exec('proc_exec_mod','#b_desktop',ctr_info('UID_EXE'))
   ?};
   return(0)
|? ctr_info('INIT_FML')='AREA'
||
:: Uruchomienie obszarów roboczych nie przechodzi w interm/webterm przez ctr_callback
:: Jest realizowane przez kontrolkę systemową. Kontrolka systemowa na podstawie
:: pola OBJ_P.TMP.CMD:=1; wie że ma odpalić nową zakładkę i uruchomić jej formułę
:: z MacroBUILDER przekazaną w polu OBJ_P.TMP.INIT_FML:='AREA'
:: Jednocześnie przez params_set ustawia argument UID_EXE czyli uidref() do tabeli BD_EXEC
   {? exec('is_okres','pulpit',__PARSES.getVal('OkresRok').OKRO)
   || _color:='';
      _color:=exec('color_conv','#convert',ctr_info('COLOR'));
      mb_fork(,'AREA','color='+_color,'UID_EXE',ctr_info('UID_EXE'))
   ?};
   return(0)
|? ctr_info('INIT_FML')='EVENT'
|| {? ctr_info('ACTION_TYPE')='modeler'
   || exec('proc_exec_mod','#b_desktop',ctr_info('UID_MOD'))
   || {? exec('is_okres','pulpit',__PARSES.getVal('OkresRok').OKRO,,,1)
      || exec('proc_exec_mod','#b_desktop',ctr_info('UID_EXE'))
      ?}
   ?};
   return(0)
|? ctr_info('INIT_FML')='PANELPLUS'
|| params_set(params_get());
   exec('bridge','#desktop')
|? ctr_info('INIT_FML')='FUNPAR'
|| {? exec('is_okres','pulpit',__PARSES.getVal('OkresRok').OKRO,,,1)
   || exec('proc_exec_mod','#b_desktop',ctr_info('UID_EXE'))
   ?}
|| FUN.info('ctr_callback: '+ctr_info('INIT_FML'))
?}


\export_cfg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: eksport konfiguracji
::  OLD: \export_cfg/#pulpit.fml
:: ~OST: INFCOPY
::----------------------------------------------------------------------------------------------------------------------
ctr_set('!desktop',,'setSaveConfigLocked',1);
::  ustawienia pulpitu
_pth:=ctr_call('!desktop',,'getDskCfgFilePth');
{? _pth<>'' || fcopy('@'+_pth,'dskcfgfile.bin',0,1,1) ?};
:: ustawienia paneli
_pth:=ctr_call('!desktop',,'getDskElementsCfgFilePth');
{? _pth<>'' || fcopy('@'+_pth,'dskelementscfg.bin',0,1,1) ?};
:: skróty użytkownika
_pth:=ctr_call('!desktop',,'getUserShortcutsCfgFilePth');
{? _pth<>'' || fcopy('@'+_pth,'dskusershortcuts.bin',0,1,1) ?};
:: foto użytkownika
_pth:=ctr_call('!desktop','desktop:foto','getImageFilePth');
{? _pth<>'' || fcopy('@'+_pth, 'dskfoto.bin',0,1,1) ?};
:: to dodajemy aby zapisywac czy obrazek dopasowany do okna
_fillIn:=ctr_call('!desktop','desktop:foto','isImageFillIn');
{? _fillIn
 || {? _f:=fopen('dskfillin.bin','w',1) || fwrite(_f,' ');fclose(_f) ?}
 || ferase('dskfillin.bin', 1)
?};
ctr_set('!desktop',,'setSaveConfigLocked',0)


\import_cfg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [17.00]
:: OPIS: import konfiguracji
::  OLD: \import_cfg/#pulpit.fml
:: ~OST: INFCOPY
::----------------------------------------------------------------------------------------------------------------------
ctr_set('!desktop',,'setSaveConfigLocked',1);
:: ustawienia pulpitu
_pth:=ctr_call('!desktop',,'getDskCfgFilePth');
{? _pth<>'' || fcopy('dskcfgfile.bin','@'+_pth,1,0,1) ?};
:: ustawienia paneli
_pth:=ctr_call('!desktop',,'getDskElementsCfgFilePth');
{? _pth<>'' || fcopy('dskelementscfg.bin','@'+_pth,1,0,1) ?};
::  skróty użytkownika
_pth:=ctr_call('!desktop',,'getUserShortcutsCfgFilePth');
{? _pth<>'' || fcopy('dskusershortcuts.bin','@'+_pth,1,0,1) ?};
:: foto użytkownika
_pth:=ctr_call('!desktop','desktop:foto','getImageCacheDirPth')+'\\dsk_user_img.jpg';
{? _pth<>''
||
   fcopy('dskfoto.bin','@'+_pth,1,0,1);
:: wponizszej linni dodany parametr.
   ctr_set('!desktop','desktop:foto','saveImageFileToConfig',_pth,fexists('dskfillin.bin', 1))
?};
ctr_set('!desktop',,'setSaveConfigLocked',0);
ctr_set('!desktop',,'reloadDesktop' )


\get_webterm_path
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PJ [17.00]
:: OPIS: Zwraca adres klienta webTerm (dla kontrolek pulpitu)
::  OLD: \get_webterm_path/zws.fml
::       \get_webterm_path/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
_adres:='http://localhost:8080/webterm/app/'+REF.FIRMA().APP_IDEN;
{? REF.FIRMA().URL<>''
||
   _adres:=REF.FIRMA().URL+'/webterm/app/'+REF.FIRMA().APP_IDEN

?};
_adres


\get_domain
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Zwraca nazwę domeny
::   WE: _a - ref formuły
::  OLD: \get_domain/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
_dom:='';
BD_EXEC.cntx_psh();
BD_EXEC.prefix();
{? BD_EXEC.seek(_a)
|| _dom:=BD_EXEC.DOMAIN
?};
BD_EXEC.cntx_pop();
_dom


\is_okres
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Jest dostępny okres dla obszaru
::   WE: _a - okres
::       _b - UID_EXE
::       _c - rodzaj
::       _d - 0/1 - zmień okres
::  OLD: \is_okres/#pulpit.fml
::----------------------------------------------------------------------------------------------------------------------
_uid:={? var_press('_b')>0 || _b || ctr_info('UID_EXE') ?};
_rdz:={? var_press('_c')>0 & _c<>'' || _c || 'W' ?};
_dz:=exec('get_domain','pulpit',_uid);
_chk_okr:={? var_press('_d')>0 || _d || 0 ?};
{? _rdz<>'W' & ~exec('is_ks_dom','#b__box',_dz)
|| _naz:=exec('name','#b_domain',_dz);
   FUN.info('Brak okresu bilansu '+{? _rdz='O' || 'otwarcia' || 'zamknięcia' ?}+' dla dziedziny \'%1\'.\nZmień parametry pracy.'@[_naz])
|| _jest:=exec('is_okr_dom','#b__box',_a,_dz);
   {? ~_jest
   || {? _a=null
      || FUN.info('Nie wybrano okresu w parametrach pracy.'@)
      || _naz:=exec('name','#b_domain',_dz);
         _okres:='';
         OKRO.cntx_psh();
         OKRO.prefix();
         {? OKRO.seek(_a)
         || _okres:=OKRO.NAZWA+' '+$OKRO.ROK
         ?};
         OKRO.cntx_pop();
         FUN.info('Brak okresu %1 dla dziedziny \'%2\'.\nZmień parametry pracy lub dodaj okres dla obszaru.'@[_okres,_naz])
      ?}
   |? _chk_okr & app_info('web_sesid')='' & 'OBE;OBG'*_dz>0
   || exec('chk_okres','obiegi2',0,_dz<>'OBG')
   ?};
   _jest
?}

::======================================================================================================================
:: Obsługa panelu 'todo'
::======================================================================================================================


\todo_install
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Dodaje na pulpit widget z listą TODO
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_id:='widget_todo';
exec('pulpit_add','#desktop','Lista zadań'@,_id,55,30,,,0);
exec('load','#desktop','desktop:'+_id,_id+'.dsk',,,,,,0,,1);

exec('set_timer','#desktop','','desktop:widget_todo','btn_titlebar_count@widget_todo',exec('get','#params',1250,type_of(0),OPERATOR.USER));

{? exec('pulpit_visible','#desktop','','desktop:widget_todo')>0
|| exec('set_timer','#desktop','','desktop:widget_todo','btn_refresh@widget_todo',exec('get','#params',1250,type_of(0),OPERATOR.USER));
   _elements:=exec('elements_table','#desktop');
   exec('todo_kafelki_visible','pulpit',_elements,0);
   exec('todo_zadania_visible','pulpit',_elements,0);
   exec('todo_przyciski_visible','pulpit',_elements,0);
   exec('todo_kafelki','pulpit',_elements,0);
   exec('todo_selection','pulpit',_elements,0,0);
   exec('todo_translat','pulpit',_elements);
   exec('update','#desktop',_elements,'desktop:widget_todo');
   exec('todo_refresh','pulpit',,,_elements);
   ~~
?};
~~


\todo_help
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.22]
:: OPIS: Akcja 'Opis czynności' na widget TODO
::----------------------------------------------------------------------------------------------------------------------
_tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
{? _tab.first()
|| exec('FindAndGet','#table',BI_TODO,_tab.KEY,,"exec('help','#help',BI_TODO.BI_PREL().B_PREL().B_ELE().SYMBOL)")
?};
exec('todo_refresh','pulpit');
~~


\todo_refresh
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Odświeża widget TODO na pulpicie
::   WE: [_a] - INTEGER - czy zasilać kafelki z liczbami zadań
::       [_b] - INTEGER - czy pobierać tekst z głównego filtra pulpitu
::       [_c]  - tab_tmp - tablica z elementami pulpitu, jeżeli podana to stamtąd są czytane wartości filtrów
::   WY: 0 - nie udało się odświeżyć
::       1 - odświeżono
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
{? exec('pulpit_visible','#desktop','','desktop:widget_todo')=0
|| return(0)
?};
_kafelki:=1;
{? var_pres('_a')=type_of(0)
|| _kafelki:=_a
?};

_filter_get:=1;
{? var_pres('_b')=type_of(0)
|| _filter_get:=_b
?};

_elements:=~~;
{? var_pres('_c')>100
|| _elements:=_c
?};

::exec('refresh_element','#desktop','','desktop:widget_todo','lista@widget_todo');
_data_id:=$SYSLOG.tm_stamp();
exec('param_write','#desktop','','desktop:widget_todo','widget_todo_ntc',$BI_TODO.tm_stamp(),,OPERATOR.USR_KOD);
exec('fetch_data','#desktop',_data_id,'desktop:widget_todo',exec('todo_list','pulpit',_filter_get,_elements),'REF,DESC,ICON,TOOLTIP,COLOR','');
exec('grab_data','#desktop','','desktop:widget_todo','lista@widget_todo',_data_id);
{? _kafelki>0
|| exec('todo_kafelki','pulpit');
   exec('todo_titlebar_count','pulpit')
?};
1


\todo_show
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Formuła wykonywana po przywróceniu listy zadań z ukrycia
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
exec('set_timer','#desktop','','desktop:widget_todo','btn_refresh@widget_todo',exec('get','#params',1250,type_of(0),OPERATOR.USER));
_elements:=exec('elements_table','#desktop');
exec('todo_kafelki_visible','pulpit',_elements,0);
exec('todo_przyciski_visible','pulpit',_elements,0);
exec('todo_kafelki','pulpit',_elements,0);
exec('todo_selection','pulpit',_elements,0,0);
exec('todo_translat','pulpit',_elements);
exec('update','#desktop',_elements,'desktop:widget_todo');

exec('todo_refresh','pulpit');
~~


\todo_hide
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [20.42]
:: OPIS: Formuła wykonywana po ukryciu listy zadań
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
exec('set_timer','#desktop','','desktop:widget_todo','btn_refresh@widget_todo',0);
~~


\todo_selection
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Formuła na zmianę zaznaczenia na widget TODO
::   WE: [_a] - tab_tmp - tabelka z elementami pulpitu
::       [_b] - INTEGER - 0/[1] - czy wykonywać update panelplus
::       [_c] - INTEGER - [-1]/0/1 - 0 - akcje mają być wyszarzone, 1 mają być aktywne
::                                  domyślnie ustalane przez pobranie ilości zazaczeń
::       [_d] - STRING - 'true','false' - czy zmiana zaznaczenia została wykonana programowo
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_single_actions:=~~;
{? var_pres('_a')>100
|| _single_actions:=_a
|| _single_actions:=exec('elements_table','#desktop')
?};
_update:=1;
{? var_pres('_b')=type_of(0)
|| _update:=_b
?};
_active:=-1;
{? var_pres('_c')=type_of(0)
|| _active:=_c
?};
_sel_prog:='';
{? var_pres('_d')=type_of('')
|| _sel_prog:=_d
?};
{? _sel_prog='true'
|| return()
?};
_enabled:='true';
{? _active=-1
||
   _selection:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
   {? _selection.size()=0
   || return()
   ?};

   {? _selection.size()>1
   ||
::    Zaznaczenie grupowe
      _enabled:='false'
   ?}
|? _active=0
|| _enabled:='false'
?};
_single_actions.blank();
_single_actions.ID_SYS:='btn_run@widget_todo';
_single_actions.ENABLED:=_enabled;
_single_actions.add();

{? var_pres('_selection')>100 & _selection.first()
|| {? _selection.KEY=''
   || _enabled:='false'
   ?}
?};
_single_actions.blank();
_single_actions.ID_SYS:='btn_view_belka@widget_todo';
_single_actions.ENABLED:=_enabled;
_single_actions.add();

_single_actions.blank();
_single_actions.ID_SYS:='btn_help@widget_todo';
_single_actions.ENABLED:=_enabled;
_single_actions.add();

_single_actions.blank();
_single_actions.ID_SYS:='btn_prior@widget_todo';
_single_actions.ENABLED:=_enabled;
_single_actions.add();

_single_actions.blank();
_single_actions.ID_SYS:='btn_pers@widget_todo';
_single_actions.ENABLED:=_enabled;
_single_actions.add();

_single_actions.blank();
_single_actions.ID_SYS:='btn_disp@widget_todo';
_single_actions.ENABLED:=_enabled;
_single_actions.add();
::{? _enabled='true'
::|| _tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
::   _prior:=0;
::   {? _tab.first()
::   || _prior:=exec('FindAndGet','#table',BI_TODO,_tab.KEY,,"PRIOR_W")
::   ?};
::   {? _prior=0
::   || _single_actions.NAME:='Usta&w:     %1'@['Pilne'@]
::   |? _prior=1
::   || _single_actions.NAME:='Usta&w: %1'@['Zwykłe'@]
::   ?};
::   ~~
::?};

{? _update>0
|| exec('update','#desktop',_single_actions,'desktop:widget_todo')
?};
~~


\todo_list
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.22]
:: OPIS: Zasila tabelką widget TODO na pulpicie
::       [_a] - INTEGER - czy pobierać tekst z głównego filtra pulpitu
::       [_b]  - tab_tmp - tablica z elementami pulpitu, jeżeli podana to stamtąd są czytane wartości filtrów
::----------------------------------------------------------------------------------------------------------------------
_filter_get:=1;
{? var_pres('_a')=type_of(0)
|| _filter_get:=_a
?};
_elements:=~~;
{? var_pres('_b')>100
|| _elements:=_b
?};
BI_TODO.cntx_psh();
BI_PREL.cntx_psh();
BI_PREL.prefix();
exec('bitodo_zakres','#bi_todo');

_sep:=exec('sep','#file');
{? var_pres('__WT_TAB')<=0
|| __WT_TAB:=tab_tmp(4,
      'PRIOR_W','INTEGER','Priorytet własny',
      'PRIOR_R','INTEGER','Priorytet',
      'DT','DATE','Data',
      'TM','TIME','Godzina',
      'REF','STRING[16]','$BI_TODO.ref()',
      'DESC','STRING[255]','Opis',
      'ICON','STRING[3]','Ikona',
      'COLOR','STRING[30]','Kolor',
      'TOOLTIP','STRING[255]','Podpowiedź',
      'MEGA_NAZ','STRING[30]','Megadziedzina - nazwa'
   );
   _ndx:=__WT_TAB.ndx_tmp(,,'PRIOR_W',,1,'PRIOR_R',,1,'DT',,1,'TM',,1);
   __WT_TAB.index(_ndx);
   ~~
|| __WT_TAB.erase()
?};
_filter:='';
{? _filter_get>0
|| _filter:=exec('pulpit_filter','#desktop','','desktop:widget_todo')
?};

_can_continue:=1;
_can_add:=1;

_p_col1:=Color.fnd_kol('BI_TODO#01#01#01')-1;
_p_col2:=Color.fnd_kol('BI_TODO#01#01#02')-1;
_p_col3:=Color.fnd_kol('BI_TODO#01#01#03')-1;
:: Filtrowanie kafelków
_all:='true';
{? _filter_get>0
|| _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter@zws',,_elements);
   {? _val<>''
   || _all:=_val
   ?}
?};
_fks:='true';
_pkd:='true';
_lmg:='true';
_ctr:='true';
_inne:='true';
_p_filtr0:='true';
_p_filtr1:='true';
_p_filtr2:='true';
_p_filtr3:='true';
{? _all*'true'=0
||
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter@fks',,_elements);
   {? _val<>''
   || _fks:=_val
   ?};
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter@pkd',,_elements);
   {? _val<>''
   || _pkd:=_val
   ?};
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter@lmg',,_elements);
   {? _val<>''
   || _lmg:=_val
   ?};
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter@ctr',,_elements);
   {? _val<>''
   || _ctr:=_val
   ?};
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter@inne',,_elements);
   {? _val<>''
   || _inne:=_val
   ?};

   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter0@priorytety',,_elements);
   {? _val<>''
   || _p_filtr0:=_val
   ?};
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter1@priorytety',,_elements);
   {? _val<>''
   || _p_filtr1:=_val
   ?};
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter2@priorytety',,_elements);
   {? _val<>''
   || _p_filtr2:=_val
   ?};
   _val:=exec('get_value_elements','#desktop','','desktop:widget_todo','filter3@priorytety',,_elements);
   {? _val<>''
   || _p_filtr3:=_val
   ?};
   ~~
?};

_dom_filtr:=0;

{? _fks*'true'>0 |
   _pkd*'true'>0 |
   _lmg*'true'>0 |
   _ctr*'true'>0 |
   _inne*'true'>0
|| _dom_filtr:=1
?};

_pri_filtr:=0;

{? _p_filtr0*'true'>0 |
   _p_filtr1*'true'>0 |
   _p_filtr2*'true'>0 |
   _p_filtr3*'true'>0
|| _pri_filtr:=1
?};

_mega_names:=exec('mega_names','#b_domain');

_todo_lang:=exec('lang','#bi_todo');
_max:=exec('get','#params',1280,type_of(0),OPERATOR.USER);
_lp:=0;
_lp_all:=0;
{? _all*'false'=0 & BI_TODO.first()
|| {!
   |?
      {? _dom_filtr>0 | _pri_filtr>0
      || _can_add:=0
      || _can_add:=1
      ?};
      _lp_all+=1;
      {? BI_TODO.BI_PREL<>null() & BI_PREL.seek(BI_TODO.BI_PREL)
      ||
         _priority:=BI_PREL.PRIOR_R;
         _dom_familiar:=0;
         {? BI_TODO.MEGA_DOM<>''
         ||
            {? BI_TODO.MEGA_DOM=_mega_names.FINANSE
            ||
               _dom_familiar:=1;
               {? _fks*'true'>0
               || {? _pri_filtr>0
                  || {? _priority=0 & _p_filtr0*'true'>0
                     || _can_add:=1
                     |? _priority=1 & _p_filtr1*'true'>0
                     || _can_add:=1
                     |? _priority=2 & _p_filtr2*'true'>0
                     || _can_add:=1
                     |? _priority=3 & _p_filtr3*'true'>0
                     || _can_add:=1
                     ?}
                  || _can_add:=1
                  ?}
               ?}
            ?};
            {? BI_TODO.MEGA_DOM=_mega_names.PERSONEL
            || _dom_familiar:=1;
               {? _pkd*'true'>0
               || {? _pri_filtr>0
                  || {? _priority=0 & _p_filtr0*'true'>0
                     || _can_add:=1
                     |? _priority=1 & _p_filtr1*'true'>0
                     || _can_add:=1
                     |? _priority=2 & _p_filtr2*'true'>0
                     || _can_add:=1
                     |? _priority=3 & _p_filtr3*'true'>0
                     || _can_add:=1
                     ?}
                  || _can_add:=1
                  ?}
               ?}
            ?};
            {? BI_TODO.MEGA_DOM=_mega_names.LOG_PROD
            || _dom_familiar:=1;
               {? _lmg*'true'>0
               || {? _pri_filtr>0
                  || {? _priority=0 & _p_filtr0*'true'>0
                     || _can_add:=1
                     |? _priority=1 & _p_filtr1*'true'>0
                     || _can_add:=1
                     |? _priority=2 & _p_filtr2*'true'>0
                     || _can_add:=1
                     |? _priority=3 & _p_filtr3*'true'>0
                     || _can_add:=1
                     ?}
                  || _can_add:=1
                  ?}
               ?}
            ?};
            {? BI_TODO.MEGA_DOM=_mega_names.ZARZ
            || _dom_familiar:=1;
               {? _ctr*'true'>0
               || {? _pri_filtr>0
                  || {? _priority=0 & _p_filtr0*'true'>0
                     || _can_add:=1
                     |? _priority=1 & _p_filtr1*'true'>0
                     || _can_add:=1
                     |? _priority=2 & _p_filtr2*'true'>0
                     || _can_add:=1
                     |? _priority=3 & _p_filtr3*'true'>0
                     || _can_add:=1
                     ?}
                  || _can_add:=1
                  ?}
               ?}
            ?};
            {? _dom_familiar=0
            || {? _inne*'true'>0
               || {? _pri_filtr>0
                  || {? _priority=0 & _p_filtr0*'true'>0
                     || _can_add:=1
                     |? _priority=1 & _p_filtr1*'true'>0
                     || _can_add:=1
                     |? _priority=2 & _p_filtr2*'true'>0
                     || _can_add:=1
                     |? _priority=3 & _p_filtr3*'true'>0
                     || _can_add:=1
                     ?}
                  || _can_add:=1
                  ?}
               ?}
            ?};
            ~~
         || {? _inne*'true'>0
            || {? _pri_filtr>0
               || {? _priority=0 & _p_filtr0*'true'>0
                  || _can_add:=1
                  |? _priority=1 & _p_filtr1*'true'>0
                  || _can_add:=1
                  |? _priority=2 & _p_filtr2*'true'>0
                  || _can_add:=1
                  |? _priority=3 & _p_filtr3*'true'>0
                  || _can_add:=1
                  ?}
               || _can_add:=1
               ?}
            ?}
         ?};

         {? _dom_filtr=0 & _pri_filtr>0
         ||
            {? _priority=0 & _p_filtr0*'true'>0
            || _can_add:=1
            |? _priority=1 & _p_filtr1*'true'>0
            || _can_add:=1
            |? _priority=2 & _p_filtr2*'true'>0
            || _can_add:=1
            |? _priority=3 & _p_filtr3*'true'>0
            || _can_add:=1
            ?}
         ?};

         _priority:=BI_PREL.PRIOR_R;
         _color:='';
         {? _priority=1
         || _color:=_p_col1
         |? _priority=2
         || _color:=_p_col2
         |? _priority=3
         || _color:=_p_col3
         ?};
         __WT_TAB.blank();
         __WT_TAB.PRIOR_W:=BI_TODO.PRIOR_W;
         __WT_TAB.PRIOR_R:=_priority;
         __WT_TAB.DT:=BI_TODO.DT;
         __WT_TAB.TM:=BI_TODO.TM;
         __WT_TAB.REF:=$BI_TODO.ref();
         __WT_TAB.DESC:=BI_PREL.DESC;
         {? BI_TODO.MEGA_DOM<>''
         || __WT_TAB.MEGA_NAZ:=BI_TODO.MEGA_DOM
         || __WT_TAB.MEGA_NAZ:=_mega_names.ZWS
         ?};

         {? _todo_lang
         ||
            exec('translate','#bi_todo');
            __WT_TAB.DESC:=BI_TODO.DESC
         ?};

         {? _filter<>''
         || {? -BI_PREL.DESC*(-_filter)=0
            || _can_add:=0
            ?}
         ?};

         {? _can_add>0 & _max>0
         || {? _lp>=_max
            || _can_add:=0;
               _can_continue:=0
            ?}
         ?};

         {? _can_add>0
         ||
            __WT_TAB.COLOR:=_color;

            __WT_TAB.ICON:=
               {? BI_TODO.PRIOR_W>0
               || '94'
               || '110'
               ?};
            __WT_TAB.TOOLTIP:='<html>'
                           '<tr><td>%1</td><td>%2</td></tr>'
                           '<tr><td>%3</td><td>%4</td></tr>'
                           '<tr><td>%5</td><td>%6</td></tr>'
                           '<tr><td>%7</td><td><font color=#%8>%9</font></td></tr>'
                           '</html>'
                           [
                              'Utworzono:'@ ,$BI_TODO.DT+' '+$BI_TODO.TM,
                              'Status:'@    ,BI_TODO.BI_STAT().NAME,
                              'Wykonaj do:'@,BI_TODO.DEADLINE,
                              'Dziedzina:'@ ,BI_TODO.B_DOMAIN().COLOR,BI_TODO.B_DOMAIN().NAME
                           ];
            __WT_TAB.add();
            _lp+=1
         ?}
      ?};
      BI_TODO.next() & _can_continue>0
   !};
   {? _max>0 & _lp_all<>_max & _lp>=_max
   || __WT_TAB.blank();
      __WT_TAB.REF:='WIECEJ_'+$_max;
      __WT_TAB.DESC:='(%1…)'['Więcej'@];
      __WT_TAB.ICON:='110';
      __WT_TAB.COLOR:=_p_col3;
      __WT_TAB.add()
   ?}
?};
BI_TODO.cntx_pop();
BI_PREL.cntx_pop();
__WT_TAB


\todo_run
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.22]
:: OPIS: Akcja 'Rozpocznij' w widget TODO
::----------------------------------------------------------------------------------------------------------------------
_tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
{? _tab.first()
|| {? _tab.KEY='WIECEJ'
   ||
::    Sztuczny rekord 'Wiecej'
      params_exec('todo_wiecej','pulpit')
   ||
      exec('FindAndGet','#table',BI_TODO,_tab.KEY,,"exec('todoRun','#bi_todo','Pulpit'@)")
   ?}
?};
exec('AreaTitle','#object');
AreaTitle.setArea('#PULPIT');
AreaTitle.setTitle();
exec('todo_refresh','pulpit');
exec('grab_focus','#desktop','','desktop:widget_todo','lista@widget_todo');
~~


\todo_personalize
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [22.26]
:: OPIS: Akcja 'Personalizuj' w widget TODO
::----------------------------------------------------------------------------------------------------------------------
_tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
{? _tab.first()
|| {? _tab.KEY='WIECEJ'
   ||
::    Sztuczny rekord 'Wiecej'
      ~~
   ||
      exec('FindAndGet','#table',BI_TODO,_tab.KEY,,"params_exec('personalizuj','#bi_todo')")
   ?}
?};
exec('todo_refresh','pulpit');
exec('grab_focus','#desktop','','desktop:widget_todo','lista@widget_todo');
~~


\todo_proc_view
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.22]
:: OPIS: Akcja 'Podgląd procesu' w widget TODO
::----------------------------------------------------------------------------------------------------------------------
_tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
{? _tab.first()
|| exec('FindAndGet','#table',BI_TODO,_tab.KEY,,"exec('proc_view','#bi_todo')")
?};
exec('todo_refresh','pulpit');
~~


\todo_settings
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Ustawienia widgetu TODO
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_old_val:=exec('get','#params',1250,type_of(0),OPERATOR.USER);
_domains:=exec('user_list_megad','#users',OPERATOR.USR_KOD,'M');
_tab:=tab_tmp(1
   ,'TIME','REAL','Wartość'
   ,'NTC_RFR','STRING[1]','Wartość'
   ,'KAF_ALL','STRING[1]','Wartość'
   ,'KAF_PRI','STRING[1]','Wartość'
   ,'KAF_FKS','STRING[1]','Wartość'
   ,'KAF_PKD','STRING[1]','Wartość'
   ,'KAF_LMG','STRING[1]','Wartość'
   ,'KAF_CTR','STRING[1]','Wartość'
   ,'KAF_INN','STRING[1]','Wartość'
   ,'BTN_WIE','STRING[1]','Wartość'
   ,'BTN_RUN' ,'STRING[1]','Wartość'
   ,'BTN_HELP','STRING[1]','Wartość'
   ,'BTN_RFR' ,'STRING[1]','Wartość'
   ,'BTN_MORE','STRING[1]','Wartość'
   ,'BTN_PRI','STRING[1]','Wartość'
   ,'BTN_PERS','STRING[1]','Wartość'
   ,'BTN_DISP','STRING[1]','Wartość'
   ,'MAX','INTEGER','Wartość'
   ,'CHK_PRI0','STRING[1]','Wartość'
   ,'CHK_PRI1','STRING[1]','Wartość'
   ,'CHK_PRI2','STRING[1]','Wartość'
   ,'CHK_PRI3','STRING[1]','Wartość'
   ,'CHK_FKS','STRING[1]','Wartość'
   ,'CHK_PKD','STRING[1]','Wartość'
   ,'CHK_LMG','STRING[1]','Wartość'
   ,'CHK_CTR','STRING[1]','Wartość'
   ,'CHK_INN','STRING[1]','Wartość'
);
_tab.TIME:=exec('get','#params',1250,type_of(0),OPERATOR.USER);
_tab.BTN_WIE:=exec('get','#params',1251,type_of(''),OPERATOR.USER);
_tab.NTC_RFR:=exec('get','#params',1252,type_of(''),OPERATOR.USER);
_tab.KAF_ALL:=exec('get','#params',1260,type_of(''),OPERATOR.USER);
_tab.KAF_PRI:=exec('get','#params',1261,type_of(''),OPERATOR.USER);
_tab.KAF_FKS:=exec('get','#params',1262,type_of(''),OPERATOR.USER);
_tab.KAF_PKD:=exec('get','#params',1263,type_of(''),OPERATOR.USER);
_tab.KAF_LMG:=exec('get','#params',1264,type_of(''),OPERATOR.USER);
_tab.KAF_CTR:=exec('get','#params',1265,type_of(''),OPERATOR.USER);
_tab.KAF_INN:=exec('get','#params',1266,type_of(''),OPERATOR.USER);

_tab.CHK_PRI0:=exec('get','#params',1293,type_of(''),OPERATOR.USER);
_tab.CHK_PRI1:=exec('get','#params',1292,type_of(''),OPERATOR.USER);
_tab.CHK_PRI2:=exec('get','#params',1291,type_of(''),OPERATOR.USER);
_tab.CHK_PRI3:=exec('get','#params',1290,type_of(''),OPERATOR.USER);
_tab.CHK_FKS:=exec('get','#params',1294,type_of(''),OPERATOR.USER);
_tab.CHK_PKD:=exec('get','#params',1295,type_of(''),OPERATOR.USER);
_tab.CHK_LMG:=exec('get','#params',1296,type_of(''),OPERATOR.USER);
_tab.CHK_CTR:=exec('get','#params',1297,type_of(''),OPERATOR.USER);
_tab.CHK_INN:=exec('get','#params',1298,type_of(''),OPERATOR.USER);

_tab.BTN_RUN:=exec('get','#params',1270,type_of(''),OPERATOR.USER);
_tab.BTN_HELP:=exec('get','#params',1272,type_of(''),OPERATOR.USER);
:: Przycisk odśwież zawsze ukryty bo został przeniesiony na belkę, a musi zostać
:: na pulpicie ze względu na timer
_tab.BTN_RFR:='N';
_tab.BTN_MORE:=exec('get','#params',1274,type_of(''),OPERATOR.USER);
_tab.BTN_PRI:=exec('get','#params',1275,type_of(''),OPERATOR.USER);
_tab.BTN_PERS:=exec('get','#params',1276,type_of(''),OPERATOR.USER);
_tab.BTN_DISP:=exec('get','#params',1277,type_of(''),OPERATOR.USER);
_tab.MAX:=exec('get','#params',1280,type_of(0),OPERATOR.USER);

_edit:=_tab.mk_edit(FUN.TYT,0,'#todo_widget');

_tab.win_esep(_edit,'Automatyczne odświeżanie');
_tab.win_efld(_edit,_tab,'TIME',,,20,0,,'Liczba sekund'@);
_tab.efld_opt(_edit, 'mark=1',,'TIME');
_tab.win_efld(_edit,_tab,'NTC_RFR',,,20,0,,'Przez Menadżera Procesów?'@,,,'check-box','left_label=1,check_label="%1"'['tak, po zmianie stanu zadania'@],"'T'","'N'");

_tab.win_esep(_edit,'Kafelki z podsumowaniami'@);
_tab.win_efld(_edit,_tab,'KAF_ALL',,,20,0,,'Zadania'@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'KAF_PRI',,,20,0,,'Priorytety'@,,,'check-box',,"'T'","'N'");
{? _domains*'Finanse|'>0
|| _tab.win_efld(_edit,_tab,'KAF_FKS',,,20,0,,'Finanse'@,,,'check-box',,"'T'","'N'")
?};
{? _domains*'Personel|'>0
|| _tab.win_efld(_edit,_tab,'KAF_PKD',,,20,0,,'Personel'@,,,'check-box',,"'T'","'N'")
?};
{? _domains*'Logistyka i produkcja|'>0
|| _tab.win_efld(_edit,_tab,'KAF_LMG',,,20,0,,'Logistyka i produkcja'@,,,'check-box',,"'T'","'N'")
?};
{? _domains*'Zarządzanie|'>0
|| _tab.win_efld(_edit,_tab,'KAF_CTR',,,20,0,,'Zarządzanie'@,,,'check-box',,"'T'","'N'")
?};
_tab.win_efld(_edit,_tab,'KAF_INN',,,20,0,,'Inne'@,,,'check-box',,"'T'","'N'");

_tab.win_esep(_edit,'Widoczność zadań'@);
_tab.win_efld(_edit,_tab,'CHK_PRI0',,,20,0,,'Priorytet: \'Krytyczny\''@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'CHK_PRI1',,,20,0,,'Priorytet: \'Wysoki\''@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'CHK_PRI2',,,20,0,,'Priorytet: \'Średni\''@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'CHK_PRI3',,,20,0,,'Priorytet: \'Zwykły\''@,,,'check-box',,"'T'","'N'");
{? _domains*'Finanse|'>0
|| _tab.win_efld(_edit,_tab,'CHK_FKS',,,20,0,,'Dziedzina: \'%1\''@['Finanse'@],,,'check-box',,"'T'","'N'");
   ~~
?};
{? _domains*'Personel|'>0
|| _tab.win_efld(_edit,_tab,'CHK_PKD',,,20,0,,'Dziedzina: \'%1\''@['Personel'@],,,'check-box',,"'T'","'N'");
   ~~
?};
{? _domains*'Logistyka i produkcja|'>0
|| _tab.win_efld(_edit,_tab,'CHK_LMG',,,20,0,,'Dziedzina: \'%1\''@['Logistyka i produkcja'@],,,'check-box',,"'T'","'N'");
   ~~
?};
{? _domains*'Zarządzanie|'>0
|| _tab.win_efld(_edit,_tab,'CHK_CTR',,,20,0,,'Dziedzina: \'%1\''@['Zarządzanie'@],,,'check-box',,"'T'","'N'");
   ~~
?};
_tab.win_efld(_edit,_tab,'CHK_INN',,,20,0,,'Dziedzina: \'%1\''@['Inne'@],,,'check-box',,"'T'","'N'");

_tab.win_esep(_edit,'Przyciski'@);
_tab.win_efld(_edit,_tab,'BTN_RUN',,,20,0,,'Rozpocznij'@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'BTN_HELP',,,20,0,,'Opis czynności'@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'BTN_PRI',,,20,0,,'Ustaw'@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'BTN_PERS',,,20,0,,'Personalizuj'@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'BTN_DISP',,,20,0,,'Wyświetl'@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'BTN_MORE',,,20,0,,'Więcej'@,,,'check-box',,"'T'","'N'");

_tab.win_esep(_edit,'Dodatkowe właściwości'@);
_tab.win_efld(_edit,_tab,'BTN_WIE',,,20,0,,'Przycisk \'Więcej\' uruchamia nową zakładkę'@,,,'check-box',,"'T'","'N'");
_tab.win_efld(_edit,_tab,'MAX',,,20,0,,'Maksymalna liczba widocznych zadań'@);

exec('ok_esc','#window',_tab,_edit);
_tab.win_edit(_edit);

_valid:="
   _result:='';
   {? cur_tab(1,1).TIME<1
   || FUN.emsg('Liczba sekund musi być większa od zera.'@);
      _result:='TIME'
   ?};
   {? cur_tab(1,1).MAX<0
   || FUN.emsg('Maksymalna liczba widocznych zadań musi być większa lub równa zero.'@);
      _result:='MAX'
   ?};
   _result
";

{? _tab.edit(_valid)
|| exec('set','#params',1250,_tab.TIME,OPERATOR.USER);
   exec('set_timer','#desktop','','desktop:widget_todo','btn_refresh@widget_todo',_tab.TIME);
   exec('set_timer','#desktop','','desktop:widget_todo','btn_titlebar_count@widget_todo',_tab.TIME);
   exec('set','#params',1251,_tab.BTN_WIE,OPERATOR.USER);
   exec('set','#params',1252,_tab.NTC_RFR,OPERATOR.USER);

   exec('set','#params',1260,_tab.KAF_ALL,OPERATOR.USER);
   exec('set','#params',1261,_tab.KAF_PRI,OPERATOR.USER);

   {? _domains*'Finanse|'>0
   || exec('set','#params',1262,_tab.KAF_FKS,OPERATOR.USER);
      exec('set','#params',1294,_tab.CHK_FKS,OPERATOR.USER)
   ?};
   {? _domains*'Personel|'>0
   || exec('set','#params',1263,_tab.KAF_PKD,OPERATOR.USER);
      exec('set','#params',1295,_tab.CHK_PKD,OPERATOR.USER)
   ?};
   {? _domains*'Logistyka i produkcja|'>0
   || exec('set','#params',1264,_tab.KAF_LMG,OPERATOR.USER);
      exec('set','#params',1296,_tab.CHK_LMG,OPERATOR.USER)
   ?};
   {? _domains*'Zarządzanie|'>0
   || exec('set','#params',1265,_tab.KAF_CTR,OPERATOR.USER);
      exec('set','#params',1297,_tab.CHK_CTR,OPERATOR.USER)
   ?};
   exec('set','#params',1266,_tab.KAF_INN,OPERATOR.USER);
   exec('set','#params',1298,_tab.CHK_INN,OPERATOR.USER);

   exec('set','#params',1270,_tab.BTN_RUN,OPERATOR.USER);
   exec('set','#params',1272,_tab.BTN_HELP,OPERATOR.USER);
   exec('set','#params',1274,_tab.BTN_MORE,OPERATOR.USER);
   exec('set','#params',1275,_tab.BTN_PRI,OPERATOR.USER);
   exec('set','#params',1276,_tab.BTN_PERS,OPERATOR.USER);
   exec('set','#params',1277,_tab.BTN_DISP,OPERATOR.USER);
   exec('set','#params',1280,_tab.MAX,OPERATOR.USER);

   _elements:=exec('elements_table','#desktop');
   exec('todo_kafelki_visible','pulpit',_elements,0);
   exec('todo_zadania_visible','pulpit',_elements,0,1);
   exec('todo_przyciski_visible','pulpit',_elements,0);
   exec('update','#desktop',_elements,'desktop:widget_todo');
   exec('todo_refresh','pulpit');
   ~~
?};
~~


\todo_display
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Akcja 'Spacja' na liście widgetu TODO
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
{? _tab.first() & _tab.KEY*'WIECEJ_'=0
|| exec('FindAndGet','#table',BI_TODO,_tab.KEY,,"params_exec('bi_todo_display','display')")
?};
~~


\todo_kafelki
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Zasila kafelki z liczbą zadań na widget TODO
::   WE: [_a] - tab_tmp - tabelka z elementami pulpitu
::       [_b] - INTEGER - 0/[1] - czy wykonywać update panelplus
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
B_DOMAIN.cntx_psh();
B_DOMAIN.index('SYMBOL');

_elements:=~~;
{? var_pres('_a')>100
|| _elements:=_a
|| _elements:=exec('elements_table','#desktop')
?};
_update:=1;
{? var_pres('_b')=type_of(0)
|| _update:=_b
?};

_sum:=exec('count_todo_group','#bi_todo',REF.FIRMA,OPERATOR.USER);
_sum_prior:=exec('todo_priority_count','#bi_todo');
B_DOMAIN.prefix('ZWS');
{? B_DOMAIN.first()
||
   _desk:='zws';
   _title:='Zadania'@;
   _tt_own:='Liczba wszystkich zadań użytkownika o statusie: %1'@['Przydzielone'@];
   _tt_free:='Liczba wszystkich zadań użytkownika o statusie: %1'@['Wolne'@];
   _tt_filter:='Włącza/wyłącza wszystkie filtry'@;
   exec('todo_kafelek_add','pulpit',_elements,_desk,B_DOMAIN.COLOR,_sum.own_0,_sum.free_0,_title,_tt_own,_tt_free,_tt_filter);
   ~~
?};
_inne_own:=_sum.own_0-_sum.own_1-_sum.own_2-_sum.own_3-_sum.own_4;
_inne_free:=_sum.free_0-_sum.free_1-_sum.free_2-_sum.free_3-_sum.free_4;

{? _inne_own<0
|| _inne_own:=0
?};
{? _inne_free<0
|| _inne_free:=0
?};

B_DOMAIN.prefix('ZWS');
{? B_DOMAIN.first()
||
   _desk:='priorytety';
   _color:='';
   _title:='Priorytety'@;

   _color:=Color.fnd_kol('BI_TODO#01#01#03')-1;
   _elements.blank();
   _elements.ID_SYS:='title@'+_desk;
   _elements.VALUE:='text=%1;color_text=%2'[_title,_color];
   _elements.add();

   _color:=Color.fnd_kol('BI_TODO#01#01#03')-1;
   _elements.blank();
   _elements.ID_SYS:='val_kryt@'+_desk;
   _elements.VALUE:='text=%1;color_text=%2'[$_sum_prior.PRIOR_3,_color];
   _elements.TOOLTIP:='Liczba zadań z priorytetem: %1'@['Krytyczny'@];
   _elements.add();

   _elements.blank();
   _elements.ID_SYS:='filter3@'+_desk;
   _elements.COL_TXT:=_color;
   _elements.TOOLTIP:='Dodaje filtr na zadania o priorytecie: %1.'@['Krytyczny'@];
   _elements.add();


   _color:=Color.fnd_kol('BI_TODO#01#01#02')-1;
   _elements.blank();
   _elements.ID_SYS:='val_wysoki@'+_desk;
   _elements.VALUE:='text=%1;color_text=%2'['/'+$_sum_prior.PRIOR_2,_color];
   _elements.TOOLTIP:='Liczba zadań z priorytetem: %1'@['Wysoki'@];
   _elements.add();

   _elements.blank();
   _elements.ID_SYS:='filter2@'+_desk;
   _elements.COL_TXT:=_color;
   _elements.TOOLTIP:='Dodaje filtr na zadania o priorytecie: %1'@['Wysoki'@];
   _elements.add();

   _color:=Color.fnd_kol('BI_TODO#01#01#01')-1;
   _elements.blank();
   _elements.ID_SYS:='val_normalny@'+_desk;
   _elements.VALUE:='text=%1;color_text=%2'['/'+$_sum_prior.PRIOR_1,_color];
   _elements.TOOLTIP:='Liczba zadań z priorytetem: %1'@['Średni'@];
   _elements.add();

   _elements.blank();
   _elements.ID_SYS:='filter1@'+_desk;
   _elements.COL_TXT:=_color;
   _elements.TOOLTIP:='Dodaje filtr na zadania o priorytecie: %1'@['Średni'@];
   _elements.add();

::   B_DOMAIN.prefix('ZWS');
::   {? B_DOMAIN.first()
::   || _color:='#'+B_DOMAIN.COLOR
::   ?};
   _color:='';
   _elements.blank();
   _elements.ID_SYS:='val_zerowy@'+_desk;
::   _elements.VALUE:='text=%1;color_text=%2'['/'+$_sum_prior.PRIOR_0,_color];
   _elements.VALUE:='text=%1'['/'+$_sum_prior.PRIOR_0];
   _elements.TOOLTIP:='Liczba zadań z priorytetem: %1'@['Zwykły'@];
   _elements.add();

   _elements.blank();
   _elements.ID_SYS:='filter0@'+_desk;
   _elements.TOOLTIP:='Dodaje filtr na zadania o priorytecie: %1'@['Zwykły'@];
   _elements.add();
   ~~
?};

B_DOMAIN.prefix('FKS');
{? B_DOMAIN.first()
||
   _desk:='fks';
   _title:='Finanse'@;
   exec('todo_kafelek_add','pulpit',_elements,_desk,B_DOMAIN.COLOR,_sum.own_1,_sum.free_1,_title);
   ~~
?};

B_DOMAIN.prefix('PKD');
{? B_DOMAIN.first()
||
   _desk:='pkd';
   _title:='Personel'@;
   exec('todo_kafelek_add','pulpit',_elements,_desk,B_DOMAIN.COLOR,_sum.own_2,_sum.free_2,_title);
   ~~
?};

B_DOMAIN.prefix('LMG');
{? B_DOMAIN.first()
||
   _desk:='lmg';
   _title:='Logistyka'@;
   exec('todo_kafelek_add','pulpit',_elements,_desk,B_DOMAIN.COLOR,_sum.own_3,_sum.free_3,_title);
   ~~
?};

B_DOMAIN.prefix('CTR');
{? B_DOMAIN.first()
||
   _desk:='ctr';
   _title:='Zarządzanie'@;
   exec('todo_kafelek_add','pulpit',_elements,_desk,B_DOMAIN.COLOR,_sum.own_4,_sum.free_4,_title);
   ~~
?};

B_DOMAIN.prefix('ZWS');
{? B_DOMAIN.first()
||
   _desk:='inne';
   _title:='Inne'@;
   exec('todo_kafelek_add','pulpit',_elements,_desk,B_DOMAIN.COLOR,_inne_own,_inne_free,_title);
   ~~
?};

{? _update>0
|| exec('update','#desktop',_elements,'desktop:widget_todo')
?};
B_DOMAIN.cntx_pop();
~~


\todo_kafelek_add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Dodaje do tabelki elementów jeden kafelek na widget TODO
::   WE: _a - tab_tmp - tabelka do zasilenia
::       _b - STRING - nazwa pulpitu kafelka
::       _c - STRING - kolor
::       _d - ilość zadań przydzielonych
::       _e - ilość zadań wolnych
::       _f - STRING - tytuł kafelka
::       [_g] - STRING - podpowiedź dla zadań przydzielonych
::       [_h] - STRING - podpowiedź dla zadań wolnych
::       [_i] - STRING - podpowiedź dla filtra
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_elements:=_a;
_desk:=_b;
_color:=_c;
_own:=_d;
_free:=_e;
_title:=_f;

_tt_own:='Liczba przydzielonych zadań grupy tematycznej: %1.'@[_title];
{? var_pres('_g')=type_of('')
|| _tt_own:=_g
?};

_tt_free:='Liczba wolnych zadań grupy tematycznej: %1.'@[_title];
{? var_pres('_h')=type_of('')
|| _tt_free:=_h
?};

_filter:='Dodaje filtr na zadania, które należą do grupy tematycznej: %1.'@[_title];
{? var_pres('_i')=type_of('')
|| _filter:=_i
?};

_elements.blank();
_elements.ID_SYS:='filter@'+_desk;
_elements.COL_TXT:='#'+_color;
_elements.NAME:=_title;
_elements.TOOLTIP:=_filter;
_elements.add();

_elements.blank();
_elements.ID_SYS:='val_own@'+_desk;
_elements.VALUE:='text=%1;color_text=%2'[$_own,'#'+_color];
_elements.TOOLTIP:=_tt_own;
_elements.add();

_elements.blank();
_elements.ID_SYS:='val_free@'+_desk;
_elements.VALUE:='text=/%1'[$_free];
_elements.TOOLTIP:=_tt_free;
_elements.add();

~~


\todo_kafelki_visible
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Na podstawie ustawień i bieżących uprawnień włącza kafelki z podsumami (domyślnie są ukryte)
::   WE: [_a] - tab_tmp - tabelka z elementami pulpitu
::       [_b] - INTEGER - 0/[1] - czy wykonywać update panelplus
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_elements:=~~;
{? var_pres('_a')>100
|| _elements:=_a
|| _elements:=exec('elements_table','#desktop')
?};
_update:=1;
{? var_pres('_b')=type_of(0)
|| _update:=_b
?};

_tab:=tab_tmp(1
   ,'KAF_ALL','STRING[1]','Wartość'
   ,'KAF_PRI','STRING[1]','Wartość'
   ,'KAF_FKS','STRING[1]','Wartość'
   ,'KAF_PKD','STRING[1]','Wartość'
   ,'KAF_LMG','STRING[1]','Wartość'
   ,'KAF_CTR','STRING[1]','Wartość'
   ,'KAF_INN','STRING[1]','Wartość'
);
_tab.KAF_ALL:=exec('get','#params',1260,type_of(''),OPERATOR.USER);
_tab.KAF_PRI:=exec('get','#params',1261,type_of(''),OPERATOR.USER);
_tab.KAF_FKS:=exec('get','#params',1262,type_of(''),OPERATOR.USER);
_tab.KAF_PKD:=exec('get','#params',1263,type_of(''),OPERATOR.USER);
_tab.KAF_LMG:=exec('get','#params',1264,type_of(''),OPERATOR.USER);
_tab.KAF_CTR:=exec('get','#params',1265,type_of(''),OPERATOR.USER);
_tab.KAF_INN:=exec('get','#params',1266,type_of(''),OPERATOR.USER);

_domains:=exec('user_list_megad','#users',OPERATOR.USR_KOD,'M');

_elements.blank();
_elements.ID_SYS:='zws';
_elements.VISIBLE:='false';
{? _tab.KAF_ALL='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='priorytety';
_elements.VISIBLE:='false';
{? _tab.KAF_PRI='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='fks';
_elements.VISIBLE:='false';
{? _tab.KAF_FKS='T' & _domains*'Finanse|'>0
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='pkd';
_elements.VISIBLE:='false';
{? _tab.KAF_PKD='T' & _domains*'Personel|'>0
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='lmg';
_elements.VISIBLE:='false';
{? _tab.KAF_LMG='T' & _domains*'Logistyka i produkcja|'>0
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='ctr';
_elements.VISIBLE:='false';
{? _tab.KAF_CTR='T' & _domains*'Zarządzanie|'>0
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='inne';
_elements.VISIBLE:='false';
{? _tab.KAF_INN='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

{? _update>0
|| exec('update','#desktop',_elements,'desktop:widget_todo')
?};
~~



\todo_zadania_visible
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [23.25]
:: OPIS: Na podstawie ustawień i bieżących uprawnień wyłącza checkboxy w kafelkach z filtrami (domyślnie zaznaczone)
::   WE: [_a] - tab_tmp - tabelka z elementami pulpitu
::       [_b] - INTEGER - 0/[1] - czy wykonywać update panelplus
::       [_c] - INTEGER - [0]/1 - czy dodawać zapis o włączeniu checkboxa
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_elements:=~~;
{? var_pres('_a')>100
|| _elements:=_a
|| _elements:=exec('elements_table','#desktop')
?};
_update:=1;
{? var_pres('_b')=type_of(0)
|| _update:=_b
?};
_chk_on:=1;
{? var_pres('_c')=type_of(0)
|| _chk_on:=_c
?};

_tab:=tab_tmp(1
   ,'CHK_PRI0','STRING[1]','Wartość'
   ,'CHK_PRI1','STRING[1]','Wartość'
   ,'CHK_PRI2','STRING[1]','Wartość'
   ,'CHK_PRI3','STRING[1]','Wartość'
   ,'CHK_FKS','STRING[1]','Wartość'
   ,'CHK_PKD','STRING[1]','Wartość'
   ,'CHK_LMG','STRING[1]','Wartość'
   ,'CHK_CTR','STRING[1]','Wartość'
   ,'CHK_INN','STRING[1]','Wartość'
);
_tab.CHK_PRI0:=exec('get','#params',1293,type_of(''),OPERATOR.USER);
_tab.CHK_PRI1:=exec('get','#params',1292,type_of(''),OPERATOR.USER);
_tab.CHK_PRI2:=exec('get','#params',1291,type_of(''),OPERATOR.USER);
_tab.CHK_PRI3:=exec('get','#params',1290,type_of(''),OPERATOR.USER);
_tab.CHK_FKS:=exec('get','#params',1294,type_of(''),OPERATOR.USER);
_tab.CHK_PKD:=exec('get','#params',1295,type_of(''),OPERATOR.USER);
_tab.CHK_LMG:=exec('get','#params',1296,type_of(''),OPERATOR.USER);
_tab.CHK_CTR:=exec('get','#params',1297,type_of(''),OPERATOR.USER);
_tab.CHK_INN:=exec('get','#params',1298,type_of(''),OPERATOR.USER);

_domains:=exec('user_list_megad','#users',OPERATOR.USR_KOD,'M');

_filtered:=0;
_size:=9;

:: Kafelek priorytety
_elements.blank();
_elements.ID_SYS:='filter0@priorytety';
{? _tab.CHK_PRI0='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

_elements.blank();
_elements.ID_SYS:='filter1@priorytety';
{? _tab.CHK_PRI1='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

_elements.blank();
_elements.ID_SYS:='filter2@priorytety';
{? _tab.CHK_PRI2='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

_elements.blank();
_elements.ID_SYS:='filter3@priorytety';
{? _tab.CHK_PRI3='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

:: Kafelek Finanse
_elements.blank();
_elements.ID_SYS:='filter@fks';
{? _tab.CHK_FKS='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

:: Kafelek Personel
_elements.blank();
_elements.ID_SYS:='filter@pkd';
{? _tab.CHK_PKD='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

:: Kafelek Logistyka i produkcja
_elements.blank();
_elements.ID_SYS:='filter@lmg';
{? _tab.CHK_LMG='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

:: Kafelek Zarządzanie
_elements.blank();
_elements.ID_SYS:='filter@ctr';
{? _tab.CHK_CTR='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

:: Kafelek Inne
_elements.blank();
_elements.ID_SYS:='filter@inne';
{? _tab.CHK_INN='N'
|| _filtered+=1;
   _elements.VALUE:='value=false';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

:: Kafelek Zadania
_elements.blank();
_elements.ID_SYS:='filter@zws';
{? _filtered=_size
|| _elements.VALUE:='value=false';
   _elements.add()
|? _filtered>0
|| _elements.VALUE:='value=middle';
   _elements.add()
|? _chk_on>0
|| _elements.VALUE:='value=true';
   _elements.add()
?};

{? _update>0
|| exec('update','#desktop',_elements,'desktop:widget_todo')
?};
~~


\todo_przyciski_visible
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Na podstawie ustawień i bieżących uprawnień włącza przyciski (domyślnie są ukryte)
::   WE: [_a] - tab_tmp - tabelka z elementami pulpitu
::       [_b] - INTEGER - 0/[1] - czy wykonywać update panelplus
::   WY:
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_elements:=~~;
{? var_pres('_a')>100
|| _elements:=_a
|| _elements:=exec('elements_table','#desktop')
?};
_update:=1;
{? var_pres('_b')=type_of(0)
|| _update:=_b
?};

_tab:=tab_tmp(1
   ,'BTN_RUN' ,'STRING[1]','Wartość'
   ,'BTN_HELP','STRING[1]','Wartość'
   ,'BTN_RFR' ,'STRING[1]','Wartość'
   ,'BTN_MORE','STRING[1]','Wartość'
   ,'BTN_PRI','STRING[1]','Wartość'
   ,'BTN_PERS','STRING[1]','Wartość'
   ,'BTN_DISP','STRING[1]','Wartość'
);
_tab.BTN_RUN:=exec('get','#params',1270,type_of(''),OPERATOR.USER);
_tab.BTN_HELP:=exec('get','#params',1272,type_of(''),OPERATOR.USER);
:: Przycisk odśwież zawsze ukryty bo został przeniesiony na belkę, a musi zostać
:: na pulpicie ze względu na timer
_tab.BTN_RFR:='N';
_tab.BTN_MORE:=exec('get','#params',1274,type_of(''),OPERATOR.USER);
_tab.BTN_PRI:=exec('get','#params',1275,type_of(''),OPERATOR.USER);
_tab.BTN_PERS:=exec('get','#params',1276,type_of(''),OPERATOR.USER);
_tab.BTN_DISP:=exec('get','#params',1277,type_of(''),OPERATOR.USER);

_desk:='widget_todo';

_elements.blank();
_elements.ID_SYS:='btn_run@'+_desk;
_elements.VISIBLE:='false';
{? _tab.BTN_RUN='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='btn_help@'+_desk;
_elements.VISIBLE:='false';
{? _tab.BTN_HELP='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='btn_refresh@'+_desk;
_elements.VISIBLE:='false';
_elements.add();

_elements.blank();
_elements.ID_SYS:='btn_titlebar_count@'+_desk;
_elements.VISIBLE:='false';
_elements.add();

_elements.blank();
_elements.ID_SYS:='btn_more@'+_desk;
_elements.VISIBLE:='false';
{? _tab.BTN_MORE='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='btn_prior@'+_desk;
_elements.VISIBLE:='false';
{? _tab.BTN_PRI='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='btn_pers@'+_desk;
_elements.VISIBLE:='false';
{? _tab.BTN_PERS='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

_elements.blank();
_elements.ID_SYS:='btn_disp@'+_desk;
_elements.VISIBLE:='false';
{? _tab.BTN_DISP='T'
|| _elements.VISIBLE:='true'
?};
_elements.add();

{? _update>0
|| exec('update','#desktop',_elements,'desktop:widget_todo')
?};
~~


\todo_wiecej
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Przycisk 'Wiecej' w widget TODO
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
{? exec('get','#params',1251,type_of(''),OPERATOR.USER)='T'
|| ctr_set('!application',,'run',app_info('cluster_group'),app_info('app_ident'),'TODO','reload',0)
||
   _tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
   _bi_todo:=null;
   {? _tab.first()
   || {? _tab.KEY<>'' & _tab.KEY<>'WIECEJ'
      || _bi_todo:=exec('FindAndGet','#table',BI_TODO,_tab.KEY,,,null())
      ?}
   ?};
   _bi_todo:=exec('select_user','#bi_todo',app_info('app_user'),0,_bi_todo);

   exec('set_value','#desktop','','desktop:widget_todo','lista@widget_todo','select='+$_bi_todo);

   exec('AreaTitle','#object');
   AreaTitle.setArea('#PULPIT');
   AreaTitle.setTitle();
   exec('todo_refresh','pulpit');
   ~~
?};
~~


\todo_focus_lost
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Formuła po utracie focusa widgetu TODO
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
exec('set_value','#desktop','','desktop:widget_todo','lista@widget_todo','select_hide=true');
exec('todo_selection','pulpit',,,0);
~~


\todo_focus_gain
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Formuła po zyskaniu focusa widgetu TODO
::   WE: _a - STRING - 'true'/'false' czy focus został nadany z kliknięcia myszą wewnątrz kontrolki
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_mouseclick:=_a;
{? __WT_TAB.size()>0
|| exec('todo_selection','pulpit',,,1)
|| exec('todo_selection','pulpit',,,0)
?};
::exec('todo_refresh','pulpit');
::exec('grab_focus','#desktop','','desktop:widget_todo','lista@widget_todo');

::exec('repaint','#desktop','','desktop:widget_todo');
{? _mouseclick='' | _mouseclick='false'
||
   _selection:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
   {? _selection.size()=0
   || exec('set_value','#desktop','','desktop:widget_todo','lista@widget_todo','select_first=true')
   || exec('set_value','#desktop','','desktop:widget_todo','lista@widget_todo','select_restore=true')
   ?}
?};
~~


\todo_translat
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Dodaje tłumaczenia dla widget TODO
::   WE: [_a] - tab_tmp - tabelka z elementami pulpitu
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_elements:=_a;

_elements.cntx_psh();
_elements.prefix('btn_run@widget_todo',);
{? _elements.first()
|| _elements.NAME:='&Rozpocznij'@;
   _elements.put()
|| _elements.blank();
   _elements.ID_SYS:='btn_run@widget_todo';
   _elements.NAME:='&Rozpocznij'@;
   _elements.add()
?};

_elements.prefix('btn_view_belka@widget_todo',);
{? _elements.first()
|| _elements.NAME:='Pod&gląd procesu'@;
   _elements.TOOLTIP:='Podgląd definicji procesu'@;
   _elements.put()
||
   _elements.blank();
   _elements.ID_SYS:='btn_view_belka@widget_todo';
   _elements.NAME:='Pod&gląd procesu'@;
   _elements.TOOLTIP:='Podgląd definicji procesu'@;
   _elements.add()
?};

_elements.prefix('btn_help@widget_todo',);
{? _elements.first()
|| _elements.NAME:='Opis &czynności'@;
   _elements.put()
||
   _elements.blank();
   _elements.ID_SYS:='btn_help@widget_todo';
   _elements.NAME:='Opis &czynności'@;
   _elements.add()
?};

_elements.prefix('btn_refresh@widget_todo',);
{? _elements.first()
|| _elements.NAME:='&Odśwież'@;
   _elements.put()
||
   _elements.blank();
   _elements.ID_SYS:='btn_refresh@widget_todo';
   _elements.NAME:='&Odśwież'@;
   _elements.add()
?};

_elements.prefix('btn_more@widget_todo',);
{? _elements.first()
|| _elements.NAME:='&Więcej...'@;
   _elements.put()
||
   _elements.blank();
   _elements.ID_SYS:='btn_more@widget_todo';
   _elements.NAME:='&Więcej...'@;
   _elements.add()
?};

_elements.prefix('btn_prior@widget_todo',);
{? _elements.first()
|| _elements.NAME:='Usta&w'@;
   _elements.put()
||
   _elements.blank();
   _elements.ID_SYS:='btn_prior@widget_todo';
   _elements.NAME:='Usta&w'@;
   _elements.add()
?};
_elements.prefix('btn_pers@widget_todo',);
{? _elements.first()
|| _elements.NAME:='Personalizuj'@;
   _elements.put()
||
   _elements.blank();
   _elements.ID_SYS:='btn_pers@widget_todo';
   _elements.NAME:='Personalizuj'@;
   _elements.add()
?};
_elements.prefix('btn_disp@widget_todo',);
{? _elements.first()
|| _elements.NAME:='Wyświetl'@;
   _elements.put()
||
   _elements.blank();
   _elements.ID_SYS:='btn_disp@widget_todo';
   _elements.NAME:='Wyświetl'@;
   _elements.add()
?};

_elements.cntx_pop();
~~


\todo_priority
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Akcja Priorytet na widget TODO
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_tab:=exec('get_selection','#desktop','','desktop:widget_todo','lista@widget_todo');
_bi_todo:=null;
{? _tab.first()
||
   BI_TODO.cntx_psh();
   {? BI_TODO.name()='' || BI_TODO.use('bi_t____') ?};
   BI_TODO.prefix();
   {? BI_TODO.seek(_tab.KEY)
   ||
      _choice:=FUN.choice('Priorytet użytkownika dla zadania.'@,,'Pilne'@,'Zwykłe'@);
      {? _choice=1
      || exec('bi_todo_prior_set','#bi_todo',0,0)
      |? _choice=2
      || exec('bi_todo_prior_del','#bi_todo',0,0)
      ?}
   ?};
   BI_TODO.cntx_pop();
   exec('todo_selection','pulpit');
   exec('todo_refresh','pulpit');
   ~~
?};
~~


\todo_titlebar_count
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Zasila górne cyferki na belce dotyczące listy zadań
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_app_lst:=exec('firmy_user_list','#firma');
{? ~_app_lst.first() || return(0) ?};

::{? (app_info('app_ident')<>_app_lst.APP_IDEN) | (app_info('cluster_group')<>_app_lst.GRP_IDEN)
::|| ctr_set('!application',,'run',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'','',1)
::?};
FIRMA.cntx_psh();
FIRMA.prefix();
{? _app_lst.first()
||
   {!
   |?
      {? FIRMA.seek(_app_lst.REF)
      ||
         _sum:=exec('count_todo_group','#bi_todo',FIRMA.ref);
::       sumarycznie to-do
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'own_0',_sum.own_0);
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'free_0',_sum.free_0);

::       to-do Finanse
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'own_1',_sum.own_1);
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'free_1',_sum.free_1);

::       to-do Personel
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'own_2',_sum.own_2);
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'free_2',_sum.free_2);

::       to-do Logistyka i Produkcja
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'own_3',_sum.own_3);
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'free_3',_sum.free_3);

::       to-do Zarządzanie
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'own_4',_sum.own_4);
         ctr_set('!desktop',,'setTodoIntData',_app_lst.GRP_IDEN,_app_lst.APP_IDEN,'free_4',_sum.free_4);
         obj_del(_sum)
      ?};
      _app_lst.next()
   !}
?};
FIRMA.cntx_pop();
~~


\todo_ntc_send
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Wysyła do panelplusa komunikat że należy wykonać formułkę zdefiniowaną na głównym pulpicie
::   WE: [_a] - USERS.ref
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_ref:=null();
{? var_pres('_a')=type_of(USERS.ref())
|| _ref:=_a
|| _ref:=BI_TODO.USERS
?};

_result:=0;
_can_continue:=1;
USERS.cntx_psh();
{? _ref<>null()
|| USERS.prefix();
   {? USERS.seek(_ref)
   || _can_continue:=1
   || _can_continue:=0
   ?}
?};

{? _can_continue>0
||
   {? exec('is_logged','#users',USERS.ref(),2) & exec('get','#params',1252,type_of(''),USERS.ref())='T'
   || _info:=exec('firma_reload_params','#firma',REF.FIRMA().SYMBOL,FIRMA.APP_IDEN);
      {? ntc_info(,'wt_rfr_'+USERS.KOD,'count')=0
      || _id:=ntc_ctrl_send(USERS.KOD,_info.app_iden,_info.grp_iden,'widget_todo',,'wt_rfr_'+USERS.KOD)
      ?};
      ~~
   ?}
?};
USERS.cntx_pop();
~~


\todo_ntc_consume
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Reaguje na wysłany komunikat
::   WE: _a - STRING - info
::       _b - STRING - user
::       _c - STRING - group
::       _d - STRING - system
::       _e - STRING - data
::       _f - STRING - czas
::   WY:
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_info:=_a;
_user:=_b;
_can_continue:=1;
_last:=exec('param_read','#desktop','','desktop:widget_todo','widget_todo_ntc',,OPERATOR.USR_KOD);
{? _last<>''
|| _can_continue:=0;
   _last:=#_last;
   _diff:=BI_TODO.tm_stamp()-_last;
   {? _diff>0 & _diff>(2*exec('second','#tm_stamp'))
   || _can_continue:=1
   ?}
?};

{? _can_continue>0 & OPERATOR.USR_KOD=_user
|| {? exec('todo_refresh','pulpit')=0
   ||
::    Jeżeli nie udało się odświeżyć całej listy, to odświeżam tylko liczbę zadań na belce
      exec('todo_titlebar_count','pulpit')
   ?}
?};
~~


\todo_filter
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Formuła wykonywana po zmianie tekstu w polu Wyszukaj na pulpicie
::   WE: _a - STRING - tekst w polu Wyszukaj
::   WY:
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_filter:=_a;
exec('todo_refresh','pulpit',0);
exec('set_value','#desktop','','desktop:widget_todo','lista@widget_todo','mark=%1'[_filter]);
exec('todo_selection','pulpit',,,0);
~~


\todo_kafelek_filter
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Formuła wykonywana po zmianie checkboxa w kafelkach z podsumami
::   WE: [_a] - INTEGER - 0/[1] - czy wykonywać odświeżenie listy
::       [_b] - INTEGER - 0/[1] - czy wykonywać obsługę głównego checkboxa
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------

_refresh:=1;
{? var_pres('_a')=type_of(0)
|| _refresh:=_a
?};
_main:=1;
{? var_pres('_b')=type_of(0)
|| _main:=_b
?};

_size:=9;
_tab:=obj_new(_size);
{! _it:=1.._size
|! _tab[_it]:=0
!};

_tab[1]:={? exec('get_value','#desktop','','desktop:widget_todo','filter@fks')='true'
         || exec('set','#params',1294,'T',OPERATOR.USER);
            1
         || exec('set','#params',1294,'N',OPERATOR.USER);
            0
         ?};
_tab[2]:={? exec('get_value','#desktop','','desktop:widget_todo','filter@pkd')='true'
         || exec('set','#params',1295,'T',OPERATOR.USER);
            1
         || exec('set','#params',1295,'N',OPERATOR.USER);
            0
         ?};
_tab[3]:={? exec('get_value','#desktop','','desktop:widget_todo','filter@lmg')='true'
         || exec('set','#params',1296,'T',OPERATOR.USER);
            1
         || exec('set','#params',1296,'N',OPERATOR.USER);
            0
         ?};
_tab[4]:={? exec('get_value','#desktop','','desktop:widget_todo','filter@ctr')='true'
         || exec('set','#params',1297,'T',OPERATOR.USER);
            1
         || exec('set','#params',1297,'N',OPERATOR.USER);
            0
         ?};
_tab[5]:={? exec('get_value','#desktop','','desktop:widget_todo','filter@inne')='true'
         || exec('set','#params',1298,'T',OPERATOR.USER);
            1
         || exec('set','#params',1298,'N',OPERATOR.USER);
            0
         ?};
_tab[6]:={? exec('get_value','#desktop','','desktop:widget_todo','filter1@priorytety')='true'
         || exec('set','#params',1292,'T',OPERATOR.USER);
            1
         || exec('set','#params',1292,'N',OPERATOR.USER);
            0
         ?};
_tab[7]:={? exec('get_value','#desktop','','desktop:widget_todo','filter2@priorytety')='true'
         || exec('set','#params',1291,'T',OPERATOR.USER);
            1
         || exec('set','#params',1291,'N',OPERATOR.USER);
            0
         ?};
_tab[8]:={? exec('get_value','#desktop','','desktop:widget_todo','filter3@priorytety')='true'
         || exec('set','#params',1290,'T',OPERATOR.USER);
            1
         || exec('set','#params',1290,'N',OPERATOR.USER);
            0
         ?};
_tab[9]:={? exec('get_value','#desktop','','desktop:widget_todo','filter0@priorytety')='true'
         || exec('set','#params',1293,'T',OPERATOR.USER);
            1
         || exec('set','#params',1293,'N',OPERATOR.USER);
            0
         ?};
{? _main>0
||
   _sum:=exec('array_sum','#array',_tab);
   {? _sum=_size
   || exec('set_value','#desktop','','desktop:widget_todo','filter@zws','value=true',1,0)
   |? _sum>0
   || exec('set_value','#desktop','','desktop:widget_todo','filter@zws','value=middle',1,0)
   || exec('set_value','#desktop','','desktop:widget_todo','filter@zws','value=false',1,0)
   ?}
?};
{? _refresh>0
|| exec('todo_refresh','pulpit')
?};
~~


\todo_kafelek_filter_all
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Formuła wykonywana po zmianie checkboxa w kafelkach z podsumami
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_all:=exec('get_value','#desktop','','desktop:widget_todo','filter@zws');
{? _all<>'middle'
||
   exec('set_value','#desktop','','desktop:widget_todo','filter@fks',_all,,0);
   exec('set_value','#desktop','','desktop:widget_todo','filter@pkd',_all,,0);
   exec('set_value','#desktop','','desktop:widget_todo','filter@lmg',_all,,0);
   exec('set_value','#desktop','','desktop:widget_todo','filter@ctr',_all,,0);
   exec('set_value','#desktop','','desktop:widget_todo','filter@inne',_all,,0);

   exec('set_value','#desktop','','desktop:widget_todo','filter0@priorytety',_all,,0);
   exec('set_value','#desktop','','desktop:widget_todo','filter1@priorytety',_all,,0);
   exec('set_value','#desktop','','desktop:widget_todo','filter2@priorytety',_all,,0);
   exec('set_value','#desktop','','desktop:widget_todo','filter3@priorytety',_all,,0);
   ~~
?};
:: Żeby się zapamiętały wartości w FO
exec('todo_kafelek_filter','pulpit',0,0);
:: Odświeżenie listy
exec('todo_refresh','pulpit');
~~


\todo_prior_click
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.22]
:: OPIS: Kliknięcie na napis z priorytetem - powinno też przestawiać wartość combo, żeby
::       nie trzeba było celować w ikonkę tylko
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_element_id:=ctr_info('element_id');
{? _element_id='lbl_kryt@priorytety'
|| exec('set_value','#desktop','','desktop:widget_todo','filter3@priorytety','click=true')
|? _element_id='lbl_wysoki@priorytety'
|| exec('set_value','#desktop','','desktop:widget_todo','filter2@priorytety','click=true')
|? _element_id='lbl_sredni@priorytety'
|| exec('set_value','#desktop','','desktop:widget_todo','filter1@priorytety','click=true')
?};
~~


::======================================================================================================================
:: Obsługa panelu 'parses'
::======================================================================================================================


\parses_install
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Dodaje na pulpit widget z parametrami pracy
::----------------------------------------------------------------------------------------------------------------------
:: Parametry pracy
_id:='widget_parses';

:: Funkcja sprawdzająca uprawnienia do parametru
_upr_par:="_obj:=obj_new(1); _obj[1]:=_a; __PARSES.selectPar('',_obj)=1";

_upr_okres:=_upr_par('OkresRok');
_upr_oddz:=_upr_par('OddzialLogProd');
_upr_mg:=_upr_par('Magazyn');
_upr_sts:=_upr_par('StSprzedazy');
_upr_stz:=_upr_par('StZakupu');
_upr_wyd:=_upr_par('WydzialProd');
_upr_fis:=_upr_par('StFiskalne');
_upr_kasa:=_upr_par('StKasowe');
_upr_mkasa:=_upr_par('Mkasa');
_upr_jks:=_upr_par('JednostkaKsięgowa');
_upr_dog:=_upr_par('GrupaObiegu');
_upr_wal:=_upr_par('AktywnaWaluta');
_upr_fz:=_upr_par('F_ZATR');
_upr_jorg:=_upr_par('JednostkaOrganizacyjna');
_upr_kart:=_upr_par('ZakresDanych');
_upr_lpla:=_upr_par('ListaPłac');
_upr_harm:=_upr_par('OkresRozliczeniowy_Harmonogramy');

_width:=27;
_height:=30;
_visible:=0;
_x:=-1;
_y:=-1;
{? exec('interm','#system')
|| _width:=__default_w;
   _height:=__default_h;
   _visible:=0;
   _x:=0;
   _y:=__default_h*2-2
?};

exec('pulpit_add','#desktop','Parametry pracy'@,_id,_width,_height,_x,_y,_visible);
exec('load','#desktop','desktop:'+_id,_id+'.dsk',,,,,,0);
{? _upr_okres || exec('parses_okres_default','pulpit') ?};
{? _upr_oddz || exec('parses_oddz_default','pulpit') ?};
{? _upr_mg || exec('parses_mg_default','pulpit') ?};
{? _upr_sts || exec('parses_sts_default','pulpit') ?};
{? _upr_stz || exec('parses_stz_default','pulpit') ?};
{? _upr_wyd || exec('parses_wyd_default','pulpit') ?};
{? _upr_fis || exec('parses_fis_default','pulpit') ?};
{? _upr_kasa || exec('parses_kasa_default','pulpit') ?};
{? _upr_mkasa || exec('parses_mkasa_default','pulpit') ?};
{? _upr_wal || exec('parses_waluta_default','pulpit') ?};
{? _upr_jks || exec('parses_jks_default','pulpit') ?};
{? _upr_dog || exec('parses_dog_default','pulpit') ?};
{? _upr_fz || exec('parses_fzatr_default','pulpit') ?};
{? _upr_kart || exec('parses_kart_default','pulpit') ?};
{? _upr_lpla || exec('parses_lpla_default','pulpit') ?};
{? _upr_harm || exec('parses_harm_default','pulpit') ?};
{? _upr_jorg || exec('parses_jorg_default','pulpit') ?};
~~


\parses_config
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Konfiguracja panelu z parametrami sesji
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';

:: Funkcja sprawdzająca uprawnienia do parametru
_upr_par:="_obj:=obj_new(1); _obj[1]:=_a; __PARSES.selectPar('',_obj)=1";

_upr_okres:=_upr_par('OkresRok');
_upr_oddz:=_upr_par('OddzialLogProd');
_upr_mg:=_upr_par('Magazyn');
_upr_sts:=_upr_par('StSprzedazy');
_upr_stz:=_upr_par('StZakupu');
_upr_wyd:=_upr_par('WydzialProd');
_upr_fis:=_upr_par('StFiskalne');
_upr_kasa:=_upr_par('StKasowe');
_upr_mkasa:=_upr_par('Mkasa');
_upr_jks:=_upr_par('JednostkaKsięgowa');
_upr_dog:=_upr_par('GrupaObiegu');
_upr_wal:=_upr_par('AktywnaWaluta');
_upr_fz:=_upr_par('F_ZATR');
_upr_jorg:=_upr_par('JednostkaOrganizacyjna');
_upr_kart:=_upr_par('ZakresDanych');
_upr_lpla:=_upr_par('ListaPłac');
_upr_harm:=_upr_par('OkresRozliczeniowy_Harmonogramy');

{? _upr_okres | _upr_oddz | _upr_mg | _upr_sts | _upr_stz | _upr_wyd | _upr_fis | _upr_kasa | _upr_mkasa | _upr_jks
 | _upr_wal | _upr_fz | _upr_jorg | _upr_kart | _upr_lpla | _upr_harm | _upr_dog
||
   _tab:=tab_tmp(1,
      'OKRES','STRING[1]','Okres'@,
      'JKS','STRING[1]','Jednostka księgowa'@,
      'DOG','STRING[1]','Dokumenty w obiegu z grupy'@,
      'WAL','STRING[1]','Aktywna waluta'@,
      'ODDZ','STRING[1]','Oddział'@,
      'MG','STRING[1]','Magazyn'@,
      'STS','STRING[1]','Stanowisko sprzedaży'@,
      'STZ','STRING[1]','Stanowisko zakupu'@,
      'WYD','STRING[1]','Wydział'@,
      'FIS','STRING[1]','Stanowisko fiskalne'@,
      'KASA','STRING[1]','Stanowisko kasowe'@,
      'MKASA','STRING[1]','Multikasa'@,
      'FZATR','STRING[1]','Forma współpracy'@,
      'JORG','STRING[1]','Jednostka organizacyjna'@,
      'KART','STRING[1]','Kartoteka osobowa'@,
      'LPLA','STRING[1]','Lista płac'@,
      'HARM','STRING[1]','Harmonogramy - okres rozliczeniowy'@,
::    ------------------------------------------
      'SEP','STRING[1]','Wyświetlać separatory'@,
      'EDIT','STRING[1]','Edycja bezpośrednia'@
   );

   _tab.blank();
   _tab.OKRES:=exec('get','#params',1211,type_of(''),OPERATOR.USER);
   _tab.JKS:=exec('get','#params',1220,type_of(''),OPERATOR.USER);
   _tab.WAL:=exec('get','#params',1221,type_of(''),OPERATOR.USER);
   _tab.ODDZ:=exec('get','#params',1212,type_of(''),OPERATOR.USER);
   _tab.MG:=exec('get','#params',1213,type_of(''),OPERATOR.USER);
   _tab.STS:=exec('get','#params',1214,type_of(''),OPERATOR.USER);
   _tab.STZ:=exec('get','#params',1215,type_of(''),OPERATOR.USER);
   _tab.WYD:=exec('get','#params',1216,type_of(''),OPERATOR.USER);
   _tab.FIS:=exec('get','#params',1217,type_of(''),OPERATOR.USER);
   _tab.KASA:=exec('get','#params',1218,type_of(''),OPERATOR.USER);
   _tab.MKASA:=exec('get','#params',1219,type_of(''),OPERATOR.USER);
   _tab.FZATR:=exec('get','#params',1222,type_of(''),OPERATOR.USER);
   _tab.JORG:=exec('get','#params',1223,type_of(''),OPERATOR.USER);
   _tab.KART:=exec('get','#params',1224,type_of(''),OPERATOR.USER);
   _tab.LPLA:=exec('get','#params',1225,type_of(''),OPERATOR.USER);
   _tab.HARM:=exec('get','#params',1226,type_of(''),OPERATOR.USER);
   _tab.DOG:=exec('get','#params',1227,type_of(''),OPERATOR.USER);
:: ----------------------------------------------------------------------------------------------------
   _tab.EDIT:=exec('get','#params',1209,type_of(''),OPERATOR.USER);
   _tab.SEP:=exec('get','#params',1210,type_of(''),OPERATOR.USER);

   _red:=_tab.mk_edit('Konfiguracja panelu parametrów pracy'@,,'parses_config');
   _tab.win_esep(_red,'Dane podstawowe'@);
   _tab.win_efld(_red,,'EDIT',,,,,,,,,'check-box',,"'T'","'N'");
   _tab.win_esep(_red,'Dostępne parametry pracy'@);
   {? _upr_okres || _tab.win_efld(_red,,'OKRES',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_jks || _tab.win_efld(_red,,'JKS',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_dog || _tab.win_efld(_red,,'DOG',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_wal || _tab.win_efld(_red,,'WAL',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_oddz || _tab.win_efld(_red,,'ODDZ',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_mg || _tab.win_efld(_red,,'MG',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_sts || _tab.win_efld(_red,,'STS',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_stz || _tab.win_efld(_red,,'STZ',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_wyd || _tab.win_efld(_red,,'WYD',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_fis || _tab.win_efld(_red,,'FIS',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_kasa || _tab.win_efld(_red,,'KASA',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_mkasa || _tab.win_efld(_red,,'MKASA',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_fz || _tab.win_efld(_red,,'FZATR',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_jorg || _tab.win_efld(_red,,'JORG',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_kart || _tab.win_efld(_red,,'KART',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_lpla || _tab.win_efld(_red,,'LPLA',,,,,,,,,'check-box',,"'T'","'N'") ?};
   {? _upr_harm || _tab.win_efld(_red,,'HARM',,,,,,,,,'check-box',,"'T'","'N'") ?};
   _tab.win_esep(_red,'Dane dodatkowe'@);
   _tab.win_efld(_red,,'SEP',,,,,,,,,'check-box',,"'T'","'N'");
   exec('ok_esc','#window',_tab,_red);
   _tab.win_edit(_red);

   {? _tab.edit()
   || exec('set','#params',1209,_tab.EDIT,OPERATOR.USER);
      exec('set','#params',1210,_tab.SEP,OPERATOR.USER);
      exec('set','#params',1211,_tab.OKRES,OPERATOR.USER);
      exec('set','#params',1220,_tab.JKS,OPERATOR.USER);
      exec('set','#params',1221,_tab.WAL,OPERATOR.USER);
      exec('set','#params',1212,_tab.ODDZ,OPERATOR.USER);
      exec('set','#params',1213,_tab.MG,OPERATOR.USER);
      exec('set','#params',1214,_tab.STS,OPERATOR.USER);
      exec('set','#params',1215,_tab.STZ,OPERATOR.USER);
      exec('set','#params',1216,_tab.WYD,OPERATOR.USER);
      exec('set','#params',1217,_tab.FIS,OPERATOR.USER);
      exec('set','#params',1218,_tab.KASA,OPERATOR.USER);
      exec('set','#params',1219,_tab.MKASA,OPERATOR.USER);
      exec('set','#params',1222,_tab.FZATR,OPERATOR.USER);
      exec('set','#params',1223,_tab.JORG,OPERATOR.USER);
      exec('set','#params',1224,_tab.KART,OPERATOR.USER);
      exec('set','#params',1225,_tab.LPLA,OPERATOR.USER);
      exec('set','#params',1226,_tab.HARM,OPERATOR.USER);
      exec('set','#params',1227,_tab.DOG,OPERATOR.USER);
      exec('parses_on_off','pulpit')
   ?}
|| FUN.info('Brak parametrów dostępnych do skonfigurowania.'@)
?};
~~


\parses_on_off
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Włącza/wyłącza elementy pulpitu z parametrami sesji
::       UWAGA: należy uwzględnić dostępność poszczególnych prametrów dla bieżacego użytkownika
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';

:: Funkcja sprawdzająca uprawnienia do parametru
_upr_par:="_obj:=obj_new(1); _obj[1]:=_a; __PARSES.selectPar('',_obj)=1";

{? _upr_par('OkresRok')
|| _visible_okres:=exec('get','#params',1211,type_of(''),OPERATOR.USER)='T'
|| _visible_okres:=0
?};
{? _upr_par('OddzialLogProd')
|| _visible_oddz:=exec('get','#params',1212,type_of(''),OPERATOR.USER)='T'
|| _visible_oddz:=0
?};
{? _upr_par('Magazyn')
|| _visible_mg:=exec('get','#params',1213,type_of(''),OPERATOR.USER)='T'
|| _visible_mg:=0
?};
{? _upr_par('StSprzedazy')
|| _visible_sts:=exec('get','#params',1214,type_of(''),OPERATOR.USER)='T'
|| _visible_sts:=0
?};
{? _upr_par('StZakupu')
|| _visible_stz:=exec('get','#params',1215,type_of(''),OPERATOR.USER)='T'
|| _visible_stz:=0
?};
{? _upr_par('WydzialProd')
|| _visible_wyd:=exec('get','#params',1216,type_of(''),OPERATOR.USER)='T'
|| _visible_wyd:=0
?};
{? _upr_par('StFiskalne')
|| _visible_fis:=exec('get','#params',1217,type_of(''),OPERATOR.USER)='T'
|| _visible_fis:=0
?};
{? _upr_par('StKasowe')
|| _visible_kasa:=exec('get','#params',1218,type_of(''),OPERATOR.USER)='T'
|| _visible_kasa:=0
?};
{? _upr_par('Mkasa')
|| _visible_mkasa:=exec('get','#params',1219,type_of(''),OPERATOR.USER)='T'
|| _visible_mkasa:=0
?};
{? _upr_par('JednostkaKsięgowa')
|| _visible_jks:=exec('get','#params',1220,type_of(''),OPERATOR.USER)='T'
|| _visible_jks:=0
?};
{? _upr_par('GrupaObiegu')
|| _visible_dog:=exec('get','#params',1227,type_of(''),OPERATOR.USER)='T'
|| _visible_dog:=0
?};
{? _upr_par('AktywnaWaluta')
|| _visible_wal:=exec('get','#params',1221,type_of(''),OPERATOR.USER)='T'
|| _visible_wal:=0
?};
{? _upr_par('F_ZATR')
|| _visible_fzatr:=exec('get','#params',1222,type_of(''),OPERATOR.USER)='T'
|| _visible_fzatr:=0
?};
{? _upr_par('JednostkaOrganizacyjna')
|| _visible_jorg:=exec('get','#params',1223,type_of(''),OPERATOR.USER)='T'
|| _visible_jorg:=0
?};
{? _upr_par('ZakresDanych')
|| _visible_kart:=exec('get','#params',1224,type_of(''),OPERATOR.USER)='T'
|| _visible_kart:=0
?};
{? _upr_par('ListaPłac')
|| _visible_lpla:=exec('get','#params',1225,type_of(''),OPERATOR.USER)='T'
|| _visible_lpla:=0
?};
{? _upr_par('OkresRozliczeniowy_Harmonogramy')
|| _visible_harm:=exec('get','#params',1226,type_of(''),OPERATOR.USER)='T'
|| _visible_harm:=0
?};
::----------------------------------------------------------------------
_visible_sep:=exec('get','#params',1210,type_of(''),OPERATOR.USER)='T';
_editable:='true';
{? exec('get','#params',1209,type_of(''),OPERATOR.USER)<>'T'
|| _editable:='false'
?};

_tab:=exec('elements_table','#desktop');
_empty:='~~empty~~';
_first_sep:='';


::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_okres@desktop';
_tab.NAME:='Okres'@;
_tab.VISIBLE:={? _visible_okres & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_okres@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Okres'@ ?};
_tab.VISIBLE:='true';
{? _visible_okres=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_okres@desktop';
_tab.VISIBLE:={? _visible_okres || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Okres'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_oddz@desktop';
_tab.NAME:='Oddział'@;
_tab.VISIBLE:={? _visible_oddz & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_oddz@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Oddział'@ ?};
_tab.VISIBLE:='true';
{? _visible_oddz=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_oddz@desktop';
_tab.VISIBLE:={? _visible_oddz || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Oddział'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_mg@desktop';
_tab.NAME:='Magazyn'@;
_tab.VISIBLE:={? _visible_mg & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_mg@desktop';
_tab.NAME:={? _visible_sep || 'Symbol'@ || 'Magazyn'@ ?};
_tab.VISIBLE:='true';
{? _visible_mg=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_mg@desktop';
_tab.VISIBLE:={? _visible_mg || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Magazyn'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_sts@desktop';
_tab.NAME:='Stanowisko sprzedaży'@;
_tab.VISIBLE:={? _visible_sts & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_sts@desktop';
_tab.NAME:={? _visible_sep || 'Kod'@ || 'Stanowisko sprzedaży'@ ?};
_tab.VISIBLE:='true';
{? _visible_sts=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? exec('get','#params',2102,type_of(''),OPERATOR.USER)='T' & _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_sts@desktop';
_tab.VISIBLE:={? _visible_sts || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Stanowisko sprzedaży'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_stz@desktop';
_tab.NAME:='Stanowisko zakupu'@;
_tab.VISIBLE:={? _visible_stz & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_stz@desktop';
_tab.NAME:={? _visible_sep || 'Kod'@ || 'Stanowisko zakupu'@ ?};
_tab.VISIBLE:='true';
{? _visible_stz=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? exec('get','#params',6102,type_of(''),OPERATOR.USER)='T' & _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_stz@desktop';
_tab.VISIBLE:={? _visible_stz || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Stanowisko zakupu'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_wyd@desktop';
_tab.NAME:='Wydział'@;
_tab.VISIBLE:={? _visible_wyd & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_wyd@desktop';
_tab.NAME:={? _visible_sep || 'Kod'@ || 'Wydział'@ ?};
_tab.VISIBLE:='true';
{? _visible_wyd=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_wyd@desktop';
_tab.VISIBLE:={? _visible_wyd || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Wydział'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_fis@desktop';
_tab.NAME:='Stanowisko fiskalne'@;
_tab.VISIBLE:={? _visible_fis & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_fis@desktop';
_tab.NAME:={? _visible_sep || 'Stanowisko'@ || 'Stanowisko fiskalne'@ ?};
_tab.VISIBLE:='true';
{? _visible_fis=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_fis@desktop';
_tab.VISIBLE:={? _visible_fis || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Stanowisko fiskalne'@
|| _tab.NAME:=_empty
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_kasa@desktop';
_tab.NAME:='Stanowisko kasowe'@;
_tab.VISIBLE:={? _visible_kasa & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_kasa@desktop';
_tab.NAME:={? _visible_sep || 'Kod'@ || 'Stanowisko kasowe'@ ?};
_tab.VISIBLE:='true';
{? _visible_kasa=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_kasa@desktop';
_tab.VISIBLE:={? _visible_kasa || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Stanowisko kasowe'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_mkasa@desktop';
_tab.NAME:='Multikasa'@;
_tab.VISIBLE:={? _visible_mkasa & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_mkasa@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Multikasa'@ ?};
_tab.VISIBLE:='true';
{? _visible_mkasa=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_mkasa@desktop';
_tab.VISIBLE:={? _visible_mkasa || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Multikasa'@
|| _tab.NAME:=_empty
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_jks@desktop';
_tab.NAME:='Jednostka księgowa'@;
_tab.VISIBLE:={? _visible_jks & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_jks@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Jednostka księgowa'@ ?};
_tab.VISIBLE:='true';
{? _visible_jks=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_jks@desktop';
_tab.VISIBLE:={? _visible_jks || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Jednostka księgowa'@
|| _tab.NAME:=_empty
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_dog@desktop';
_tab.NAME:='Dokumenty w obiegu z grupy'@;
_tab.VISIBLE:={? _visible_dog & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_dog@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Dokumenty w obiegu z grupy'@ ?};
_tab.VISIBLE:='true';
{? _visible_dog=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_dog@desktop';
_tab.VISIBLE:={? _visible_dog || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Grupa obiegu'@
|| _tab.NAME:=_empty
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_waluta@desktop';
_tab.NAME:='Aktywna waluta'@;
_tab.VISIBLE:={? _visible_wal & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_waluta@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Aktywna waluta'@ ?};
_tab.VISIBLE:='true';
{? _visible_wal=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_waluta@desktop';
_tab.VISIBLE:={? _visible_wal || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Aktywna waluta'@
|| _tab.NAME:=_empty
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_fzatr@desktop';
_tab.NAME:='Forma współpracy'@;
_tab.VISIBLE:={? _visible_fzatr & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_fzatr@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Forma współpracy'@ ?};
_tab.VISIBLE:='true';
{? _visible_fzatr=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_fzatr@desktop';
_tab.VISIBLE:={? _visible_fzatr || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Forma współpracy'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_jorg@desktop';
_tab.NAME:='Jednostka organizacyjna'@;
_tab.VISIBLE:={? _visible_jorg & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_jorg@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Jednostka organizacyjna'@ ?};
_tab.VISIBLE:='true';
{? _visible_jorg=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_jorg@desktop';
_tab.VISIBLE:={? _visible_jorg || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Jednostka organizacyjna'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_kart@desktop';
_tab.NAME:='Kartoteka osobowa'@;
_tab.VISIBLE:={? _visible_kart & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_kart@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Kartoteka osobowa'@ ?};
_tab.VISIBLE:='true';
{? _visible_kart=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
{? _editable='true'
|| _tab.VALUE:='mark=1'
|| _tab.VALUE:='mark=0'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_kart@desktop';
_tab.VISIBLE:={? _visible_kart || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Kartoteka osobowa'@
|| _tab.NAME:=_empty
?};
{? _editable='true'
|| _tab.VALUE+=';mark=1'
|| _tab.VALUE+=';mark=0'
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_lpla@desktop';
_tab.NAME:='Lista płac'@;
_tab.VISIBLE:={? _visible_lpla & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_lpla@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Lista płac'@ ?};
_tab.VISIBLE:='true';
{? _visible_lpla=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_lpla@desktop';
_tab.VISIBLE:={? _visible_lpla || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Lista płac'@
|| _tab.NAME:=_empty
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
_tab.blank();
_tab.ID_SYS:='sep_harm@desktop';
_tab.NAME:='Harmonogramy'@;
_tab.VISIBLE:={? _visible_harm & _visible_sep || 'true' || 'false' ?};
{? exec('interm','#system')
|| _tab.VISIBLE:='false'
?};
{? _tab.VISIBLE='true' & _first_sep=''
|| _first_sep:=_tab.ID_SYS
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='label_harm@desktop';
_tab.NAME:={? _visible_sep || 'Nazwa'@ || 'Harmonogramy'@ ?};
_tab.VISIBLE:='true';
{? _visible_harm=0 | (exec('interm','#system') & _visible_sep)
|| _tab.VISIBLE:='false'
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='combo_harm@desktop';
_tab.VISIBLE:={? _visible_harm || 'true' || 'false' ?};
_tab.VALUE:='editable=%1'[_editable];
{? _visible_sep>0 & exec('interm','#system')
|| _tab.NAME:='Harmonogramy'@
|| _tab.NAME:=_empty
?};
_tab.add();
::----------------------------------------------------------------------------------------------------------------------

_tab.blank();
_tab.ID_SYS:='txt@desktop';
{? ~_visible_okres & ~_visible_oddz & ~_visible_mg & ~_visible_sts & ~_visible_stz & ~_visible_wyd & ~_visible_fis &
   ~_visible_kasa & ~_visible_mkasa & ~_visible_jks & ~_visible_wal & ~_visible_fzatr & ~_visible_jorg & ~_visible_kart &
   ~_visible_lpla & ~_visible_harm & ~_visible_dog
|| _tab.VISIBLE:='true';
   _tab.VALUE:='Należy włączyć co najmniej jeden parametr.'@
|| _tab.VISIBLE:='false';
   _tab.VALUE:=_empty
?};
_tab.add();

_tab.blank();
_tab.ID_SYS:='zapychacz';
{? ~_visible_okres & ~_visible_oddz & ~_visible_mg & ~_visible_sts & ~_visible_stz & ~_visible_wyd & ~_visible_fis &
   ~_visible_kasa & ~_visible_mkasa & ~_visible_jks & ~_visible_wal & ~_visible_fzatr & ~_visible_jorg & ~_visible_kart &
   ~_visible_lpla & ~_visible_harm & ~_visible_dog
|| _tab.VISIBLE:='false'
|| _tab.VISIBLE:='true'
?};
_tab.add();

:: Wszystkim separatorom włączam linię
_tab.cntx_psh();
_tab.prefix('sep_');
{? _tab.first()
|| {!
   |? _tab.VALUE:='line=1';
      _tab.put();
      _tab.next()
   !}
?};
_tab.cntx_pop();

{? _first_sep<>''
||
:: Wyłączam linię odzielającą dla pierwszego separatora
   _tab.blank();
   _tab.ID_SYS:=_first_sep;
   _tab.VALUE:='line=0';
   _tab.add()
?};

exec('update','#desktop',_tab,_ctr_id);
exec('parses_update','pulpit');
exec('repaint','#desktop','',_ctr_id);
~~


\parses_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża wartości wszystkich parametrów
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
{? exec('pulpit_visible','#desktop','',_ctr_id)=0
|| return()
?};
_elements:=exec('get_elements','#desktop','',_ctr_id,'');
_ndx:=_elements.ndx_tmp(,,'ID_OWN',,);
_elements.index(_ndx);
_elements.prefix('combo_okres');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_okres_update','pulpit')
   ?}
?};

_elements.prefix('combo_oddz');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_oddz_update','pulpit')
   ?}
?};

_elements.prefix('combo_mg');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_mg_update','pulpit')
   ?}
?};

_elements.prefix('combo_sts');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_sts_update','pulpit')
   ?}
?};

_elements.prefix('combo_stz');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_stz_update','pulpit')
   ?}
?};

_elements.prefix('combo_wyd');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_wyd_update','pulpit')
   ?}
?};

_elements.prefix('combo_fis');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_fis_update','pulpit')
   ?}
?};

_elements.prefix('combo_kasa');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_kasa_update','pulpit')
   ?}
?};

_elements.prefix('combo_mkasa');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_mkasa_update','pulpit')
   ?}
?};

_elements.prefix('combo_fzatr');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_fzatr_update','pulpit')
   ?}
?};

_elements.prefix('combo_lpla');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_lpla_update','pulpit')
   ?}
?};

_elements.prefix('combo_kart');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_kart_update','pulpit')
   ?}
?};

_elements.prefix('combo_harm');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_harm_update','pulpit')
   ?}
?};

_elements.prefix('combo_jorg');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_jorg_update','pulpit')
   ?}
?};

_elements.prefix('combo_jks');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_jks_update','pulpit')
   ?}
?};
_elements.prefix('combo_dog');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_dog_update','pulpit')
   ?}
?};

_elements.prefix('combo_waluta');
{? _elements.first()
|| {? _elements.VISIBLE='true'
   || exec('parses_waluta_update','pulpit')
   ?}
?};

_elements.ndx_drop(_ndx);
~~


\parses_okres_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Okres
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_okres_tab','pulpit'),'REF,SYMBOL','');
exec('grab_data','#desktop','#',_ctr_id,'combo_okres@desktop',_data_id,,exec('parses_okres_default','pulpit',1));
~~


\parses_oddz_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Oddział
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_oddz_tab','pulpit'),'REF,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_oddz@desktop',_data_id,,exec('parses_oddz_default','pulpit',0));
~~


\parses_mg_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Magazyn
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_mg_tab','pulpit'),'REF,SYM','');
exec('grab_data','#desktop','#',_ctr_id,'combo_mg@desktop',_data_id,,exec('parses_mg_default','pulpit',0));
~~


\parses_sts_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Stanowisko sprzedaży
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_sts_tab','pulpit'),'REF,KOD','');
exec('grab_data','#desktop','#',_ctr_id,'combo_sts@desktop',_data_id,,exec('parses_sts_default','pulpit',0));
~~


\parses_stz_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Stanowisko zakupu
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_stz_tab','pulpit'),'REF,KOD','');
exec('grab_data','#desktop','#',_ctr_id,'combo_stz@desktop',_data_id,,exec('parses_stz_default','pulpit',0));
~~


\parses_wyd_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Wydział
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_wyd_tab','pulpit'),'REF,KOD','');
exec('grab_data','#desktop','#',_ctr_id,'combo_wyd@desktop',_data_id,,exec('parses_wyd_default','pulpit',0));
~~


\parses_fis_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Stanowisko fiskalne
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_fis_tab','pulpit'),'REF,KOD','');
exec('grab_data','#desktop','#',_ctr_id,'combo_fis@desktop',_data_id,,exec('parses_fis_default','pulpit',0));
~~


\parses_kasa_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Stanowisko kasowe
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_kasa_tab','pulpit'),'REF,NAZWA','');
exec('grab_data','#desktop','#',_ctr_id,'combo_kasa@desktop',_data_id,,exec('parses_kasa_default','pulpit',0));
~~


\parses_mkasa_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Multikasa
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_mkasa_tab','pulpit'),'REF,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_mkasa@desktop',_data_id,,exec('parses_mkasa_default','pulpit',0));
~~


\parses_fzatr_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Odświeża zawartość parametru
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_fzatr_tab','pulpit'),'REF,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_fzatr@desktop',_data_id,,exec('parses_fzatr_default','pulpit',0));
~~


\parses_lpla_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Odświeża zawartość parametru
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_lpla_tab','pulpit'),'REF,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_lpla@desktop',_data_id,,exec('parses_lpla_default','pulpit',0));
~~


\parses_harm_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Odświeża zawartość parametru
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_harm_tab','pulpit'),'REF,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_harm@desktop',_data_id,,exec('parses_harm_default','pulpit',0));
~~


\parses_jorg_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Odświeża zawartość parametru
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_jorg_tab','pulpit'),'NAZ,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_jorg@desktop',_data_id,,exec('parses_jorg_default','pulpit',0));
~~


\parses_kart_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Odświeża zawartość parametru
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_kart_tab','pulpit'),'KOD,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_kart@desktop',_data_id,,exec('parses_kart_default','pulpit',0));
~~


\parses_waluta_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Odświeża zawartość parametru Okres
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_waluta_tab','pulpit'),'REF,SYMBOL','');
exec('grab_data','#desktop','#',_ctr_id,'combo_waluta@desktop',_data_id,,exec('parses_waluta_default','pulpit',0));
~~


\parses_okres_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Zasila combo okresów
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'ROK','INTEGER','Rok',
   'LP','INTEGER','Lp',
   'SYMBOL','STRING[100]','SYMBOL',
   'REF','STRING[16]','Ref SQL'
);

_hasFKS:=0;
_domain:=exec('domain_ref','#b_domain','FKS');
{? _domain<>null()
|| {? exec('lic','#b_domain',_domain)=1
   || {? exec('auth_domain','#b__box','FKS','M')
      || _hasFKS:=1
      ?}
   ?}
?};
_hasFKS;

{? _hasFKS
|| OKRO_F.cntx_psh(); ROK_F.cntx_psh(); PARSES.cntx_psh();
   OKRO_F.index('FIRMA_NR');
   OKRO_F.prefix(REF.FIRMA);
   {? OKRO_F.first()
   || {!
      |? _tab.blank();
         {? OKRO_F.NAZ='Bilans otwarcia' | OKRO_F.NAZ='Bilans zamknięcia'
         || _tab.SYMBOL:=OKRO_F.NAZ+' '+$OKRO_F.RES;
            _tab.REF:=$OKRO_F.ref();
            {? OKRO_F.NAZ='Bilans otwarcia'
            || _tab.ROK:=OKRO_F.RES;
               _tab.LP:=0
            |? OKRO_F.NAZ='Bilans zamknięcia'
            || _tab.ROK:=OKRO_F.RES;
               _tab.LP:=13
            ?};
            _tab.add()
         ?};
         OKRO_F.next()
      !}
   ?};
   OKRO_F.cntx_pop(); ROK_F.cntx_pop(); PARSES.cntx_pop()
?};

OKRO.cntx_psh();
OKRO.index('NAZ');
OKRO.prefix(REF.FIRMA);
{? OKRO.first()
|| {!
   |? _tab.blank();
      _tab.ROK:=OKRO.ROK;
      _tab.LP:=OKRO.NR_OKR;
      _tab.SYMBOL:=OKRO.NAZWA+' '+$OKRO.ROK;
      _tab.REF:=$OKRO.ref();
      _tab.add();
      OKRO.next()
   !}
?};
OKRO.cntx_pop();
_tab


\parses_waluta_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AF [19.42]
:: OPIS: Zasila combo waluty
::----------------------------------------------------------------------------------------------------------------------
SLO.cntx_psh();
SLO.index('SL');
exec('czytaj','#stalesys',,XINFO,'SLWAL');
SLO.prefix(XINFO.SLWAL);

_tab:=tab_tmp(2,
   'SYMBOL','STRING[100]','SYMBOL',
   'REF','STRING[16]','Ref SQL'
);

{? SLO.first()
|| {!
   |? _tab.blank();
      _tab.SYMBOL:=SLO.KOD+' '+SLO.TR;
      _tab.REF:=$SLO.ref();
      _tab.add();
     SLO.next()
   !}
?};
SLO.cntx_pop();
_tab


\parses_jks_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AF [19.42]
:: OPIS: Zasila combo jednostki ksiegowej
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(1,
   'LP','INTEGER','Lp',
   'SYMBOL','STRING[100]','SYMBOL',
   'REF','STRING[16]','Ref SQL'
);

_lp:=0;
_hasAc:=0;
_hasGrandAc:=Perm.hasFull('FJKS');

{? _hasGrandAc
|| _tab.blank();
   _tab.LP:=_lp;
   _tab.SYMBOL:='Wszystkie';
   _tab.REF:='';
   _tab.add();
   _hasAc:=1
?};

USERSDEP.cntx_psh(); USERSDEP.index('USERSDEP'); USERSDEP.prefix(REF.FIRMA,OPERATOR.USER);
ODD.cntx_psh(); ODD.index('ODDZIALY'); ODD.prefix(REF.FIRMA);
{? ODD.first()
|| {!
   |? exec('get_usersf','users');
      {? _hasGrandAc | USERSDEP.find_key(ODD.OD)
      || _tab.blank();
         _tab.LP:=_lp;
         _tab.SYMBOL:=ODD.OD+' '+ODD.N;
         _tab.REF:=$ODD.ref();
         _tab.add();
         _lp:=_lp+1;
         _hasAc:=1
      ?};
      ODD.next()
   !}
?};
ODD.cntx_pop();
USERSDEP.cntx_pop();

{? ~_hasAc
|| _tab.blank();
   _tab.LP:=_lp;
   _tab.SYMBOL:='';
   _tab.REF:='';
   _tab.add()
?};

_tab


\parses_jks_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AFI [19.42]
:: OPIS: Odświeża zawartość parametru jednostki księgowe
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_jks_tab','pulpit'),'REF,SYMBOL','');
exec('grab_data','#desktop','#',_ctr_id,'combo_jks@desktop',_data_id,,exec('parses_jks_default','pulpit',0));
~~


\parses_dog_update
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MP [22.26]
:: OPIS: Odświeża zawartość parametru Grupy Obiegu
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:='desktop:widget_parses';
_data_id:=$SYSLOG.tm_stamp();
exec('fetch_data','#desktop',_data_id,_ctr_id,exec('parses_dog_tab','pulpit'),'REF,NAZ','');
exec('grab_data','#desktop','#',_ctr_id,'combo_dog@desktop',_data_id,,exec('parses_dog_default','pulpit',0));
~~


\parses_dog_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MP [22.26]
:: OPIS: Zasila combo Grupy Obiegu
::----------------------------------------------------------------------------------------------------------------------
ETYP_GRP.cntx_psh();
ETYP_GRP.prefix();
ETYP_GRP.f_clear();
ETYP_GRP.f_set('N,NAZ',
      'left join USERSOGR using(USERSOGR.OGRP,ETYP_GRP.REFERENCE)',
      '(:_a=1 or USERSOGR.USERS=:_b) and ETYP_GRP.FIRMA=:_c',Perm.hasFull('OGRP'),OPERATOR.USER,REF.FIRMA);

_tab:=tab_tmp(2,
   'NAZ','STRING[50]','Nazwa',
   'N','STRING[8]','Skrót',
   'REF','STRING[16]','Ref SQL'
);

{? ETYP_GRP.f_first()
|| {!
   |? _tab.blank();
      _tab.NAZ:=ETYP_GRP.N+' '+ETYP_GRP.NAZ;
      _tab.N:=ETYP_GRP.N;
      _tab.REF:=$ETYP_GRP.ref();
      _tab.add();
      ETYP_GRP.f_next()
   !}
?};
ETYP_GRP.cntx_pop();
_tab


\parses_dog_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MP [22.26]
:: OPIS: Obsługa po ustawieniu okresu na combo Grupy Obiegu
::----------------------------------------------------------------------------------------------------------------------
ETYP_GRP.cntx_psh(); ETYP_GRP.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_dog');
{? _value<>''
|| {? ETYP_GRP.seek(_value)
   || __PARSES.setVal('GrupaObiegu',ETYP_GRP.ref());
      AreaTitle.setTitle()
   ?}
?};
ETYP_GRP.cntx_pop();
~~


\parses_dog_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MP [22.26]
:: OPIS: Ustawia wartość z aktualnego parametru na combo Grupy Obiegu
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('GrupaObiegu');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_dog@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_okres_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo okresów
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('OkresRok');
_val:={? _args.OKRO_R='W' || $_args.OKRO || $_args.OKRO_F ?};
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_okres@desktop',_val)
?};
_result:=_val;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_okres_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo okresów
::----------------------------------------------------------------------------------------------------------------------
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_okres');

{? _value<>''
|| {? 6+_value='okrobr'
   || OKRO_F.cntx_psh(); OKRO_F.clear();
      OKRO_F.seek(_value);
      PARSES.cntx_psh();
      PARSES.clear();
      {? PARSES.seek(__PARSES.getBID())
      || PARSES.ROK_F:=OKRO_F.ROK;
         _put:=__PARSES.putPARSES();
         __PARSES.setVal('OkresRok',OKRO_F.ref());
         _okres:=__PARSES.args('OkresRodzaj');
         _okres.OBSZAR:='FKS';
         _okres.OKRO_F:=OKRO_F.ref();
         __PARSES.setVal('OkresRodzaj',_okres)
      ?};
      PARSES.cntx_pop();
      OKRO_F.cntx_pop()
   || OKRO.cntx_psh(); OKRO.clear();
      {? OKRO.seek(_value)
      || _args:=__PARSES.args('OkresRok');
         _args.OBSZAR:='LSP';
         _args.AR:=OKRO.ROK;
         _args.AM:=OKRO.NR_OKR;
         __PARSES.setVal('OkresRok',_args);
         __PARSES.setVal('OkresRodzaj','W')
      ?};
      OKRO.cntx_pop()
   ?};
   AreaTitle.setTitle()
?};
~~


\parses_waluta_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Obsługa po ustawieniu waluty na combo walut
::----------------------------------------------------------------------------------------------------------------------
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_waluta');

{? _value<>''
|| SLO.cntx_psh(); SLO.clear();
   {? SLO.seek(_value)
   || _args:=__PARSES.args('AktywnaWaluta');
      _args.REF:=SLO.ref();
      _args.KOD:=SLO.KOD;
      __PARSES.setVal('AktywnaWaluta',_args)
   ?};
   AreaTitle.setTitle();
   SLO.cntx_pop()
?};
~~


\parses_waluta_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo walut
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('AktywnaWaluta');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_waluta@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_jks_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Obsługa po ustawieniu jednostki ksiegowej na combo jednostek
::----------------------------------------------------------------------------------------------------------------------
ODD.cntx_psh(); ODD.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_jks');
{? _value<>''
|| {? ODD.seek(_value)
   || _args:=__PARSES.args('JednostkaKsięgowa');
      _args.REF:=ODD.ref();
      _args.KOD:=ODD.OD;
      __PARSES.setVal('JednostkaKsięgowa',_args)
   ?}
|| {? ~Perm.hasFull('FJKS')
   || {? PARSES.ODD
      || USERSDEP.cntx_psh();
         USERSDEP.index('USERSDEP'); USERSDEP.prefix(REF.FIRMA,OPERATOR.USER,PARSES.ODD().OD,);
         _has:=USERSDEP.first();
         USERSDEP.cntx_pop();
         {? ~_has || PARSES.ODD:=null ?}
      ?}
   || _args:=__PARSES.args('JednostkaKsięgowa');
      _args.REF:=null();
      _args.KOD:=null();
      __PARSES.setVal('JednostkaKsięgowa',_args)
   ?}
?};
AreaTitle.setTitle();
ODD.cntx_pop();
~~


\parses_jks_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo jednostek
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('JednostkaKsięgowa');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_jks@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_oddz_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Zasila combo oddziałów
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'KOD','STRING[100]','Kod',
   'NAZ','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
exec('filtroddz','parses');
{? ODDZ.f_first()
|| {!
   |? _tab.blank();
      _tab.KOD:=ODDZ.KOD;
      _tab.NAZ:=ODDZ.NAZ;
      _tab.REF:=$ODDZ.ref();
      _tab.add();
      ODDZ.f_next()
   !}
?};
_tab


\parses_oddz_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo oddziałów
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('OddzialLogProd');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_oddz@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_oddz_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo oddziałów
::----------------------------------------------------------------------------------------------------------------------
ODDZ.cntx_psh(); ODDZ.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_oddz');
{? _value<>''
|| {? ODDZ.seek(_value)
   || __PARSES.setVal('OddzialLogProd',ODDZ.ref());
      exec('parses_mg_update','pulpit');
      exec('parses_sts_update','pulpit');
      exec('parses_stz_update','pulpit');
      AreaTitle.setTitle()
   ?}
?};
ODDZ.cntx_pop();
~~


\parses_mg_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Zasila combo magazynów
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'SYM','STRING[100]','Symbol',
   'NAZ','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
::====== UWAGA: wymaga poprawnego ustawienia rekordu PARSES - pytać RW
PARSES.cntx_psh();
_args:=__PARSES.getVal('OddzialLogProd');
PARSES.ODDZ:=_args.REF;
exec('filtrmg','parses');
PARSES.cntx_pop();
::====================================================================
{? MG.f_first()
|| {!
   |? _tab.blank();
      _tab.SYM:=MG.SYM;
      _tab.NAZ:=MG.NAZ;
      _tab.REF:=$MG.ref();
      _tab.add();
      MG.f_next()
   !}
?};
MG.f_clear();
_tab


\parses_mg_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo magazynów
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('Magazyn');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_mg@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_mg_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo magazynów
::----------------------------------------------------------------------------------------------------------------------
MG.cntx_psh(); MG.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_mg');
{? _value<>''
|| {? MG.seek(_value)
   || __PARSES.setVal('Magazyn',MG.ref());
      AreaTitle.setTitle()
   ?}
?};
MG.cntx_pop();
~~


\parses_sts_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Zasila combo stanowisk sprzedaży
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'KOD','STRING[100]','Kod',
   'NAZ','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
::====== UWAGA: wymaga poprawnego ustawienia rekordu PARSES - pytać RW
PARSES.cntx_psh();
_args:=__PARSES.getVal('OddzialLogProd');
PARSES.ODDZ:=_args.REF;
exec('filtrsts','parses');
PARSES.cntx_pop();
::====================================================================
{? STS.f_first()
|| {!
   |? _tab.blank();
      _tab.KOD:=STS.KOD;
      _tab.NAZ:=STS.NAZ;
      _tab.REF:=$STS.ref();
      _tab.add();
      STS.f_next()
   !}
?};
STS.f_clear();
:: Dodatkowy zapis z null(), o ile parametr może zostać niewypełniony
_tab.blank();
_tab.KOD:='';
_tab.NAZ:='< brak >';
_tab.REF:='';
_tab.add();
_tab


\parses_sts_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo magazynów
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('StSprzedazy');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_sts@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_sts_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo stanowisk sprzedaży
::----------------------------------------------------------------------------------------------------------------------
STS.cntx_psh(); STS.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_sts');
{? _value<>''
|| {? STS.seek(_value)
   || __PARSES.setVal('StSprzedazy',STS.ref());
      AreaTitle.setTitle()
   ?}
|| __PARSES.setVal('StSprzedazy',null());
   AreaTitle.setTitle()
?};
STS.cntx_pop();
~~


\parses_stz_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Zasila combo stanowisk zakupu
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'KOD','STRING[100]','Kod',
   'NAZ','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
::====== UWAGA: wymaga poprawnego ustawienia rekordu PARSES - pytać RW
PARSES.cntx_psh();
_args:=__PARSES.getVal('OddzialLogProd');
PARSES.ODDZ:=_args.REF;
exec('filtrstz','parses');
PARSES.cntx_pop();
::====================================================================
{? STS.f_first()
|| {!
   |? _tab.blank();
      _tab.KOD:=STS.KOD;
      _tab.NAZ:=STS.NAZ;
      _tab.REF:=$STS.ref();
      _tab.add();
      STS.f_next()
   !}
?};
STS.f_clear();
:: Dodatkowy zapis z null(), o ile parametr może zostać niewypełniony
_tab.blank();
_tab.KOD:='';
_tab.NAZ:='< brak >';
_tab.REF:='';
_tab.add();
_tab


\parses_stz_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo stanowisk zakupu
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('StZakupu');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_stz@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_stz_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo stanowisk zakupu
::----------------------------------------------------------------------------------------------------------------------
STS.cntx_psh(); STS.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_stz');
{? _value<>''
|| {? STS.seek(_value)
   || __PARSES.setVal('StZakupu',STS.ref());
      AreaTitle.setTitle()
   ?}
|| __PARSES.setVal('StZakupu',null());
   AreaTitle.setTitle()
?};
STS.cntx_pop();
~~


\parses_wyd_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Zasila combo wydziałów
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'KOD','STRING[8]','Kod',
   'TR','STRING[80]','Treść',
   'REF','STRING[16]','Ref SQL'
);
SLO.cntx_psh();
SLO.index('SL');
exec('czytaj','#stalesys',,XINFO,'SLWYDZIA');
SLO.prefix(XINFO.SLWYDZIA);
{? SLO.first()
|| {!
   |? _tab.blank();
      _tab.KOD:=SLO.KOD;
      _tab.TR:=SLO.TR;
      _tab.REF:=$SLO.ref();
      _tab.add();
     SLO.next()
   !}
?};
SLO.cntx_pop();
_tab


\parses_wyd_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo wydziałów
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('WydzialProd');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_wyd@desktop',$_args.REF_SLO)
?};
_result:=$_args.REF_SLO;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_wyd_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo wydziałól
::----------------------------------------------------------------------------------------------------------------------
SLO.cntx_psh(); SLO.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_wyd');
{? _value<>''
|| {? SLO.seek(_value)
   || __PARSES.setVal('WydzialProd',SLO.ref());
      AreaTitle.setTitle()
   ?}
?};
SLO.cntx_pop();
~~


\parses_fis_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Zasila combo stanowisk fiskalnych
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'KOD','STRING[20]','Kod',
   'REF','STRING[16]','Ref SQL'
);
FIS.cntx_psh();
FIS.index('KOD');
FIS.prefix();
{? FIS.first()
|| {!
   |? _tab.blank();
      _tab.KOD:=FIS.KOD;
      _tab.REF:=$FIS.ref();
      _tab.add();
      FIS.next()
   !}
?};
FIS.cntx_pop();
:: Dodatkowy zapis z null(), o ile parametr może zostać niewypełniony
_tab.blank();
_tab.KOD:='';
_tab.REF:='';
_tab.add();
_tab


\parses_fis_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo stanowisk fiskalnych
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('StFiskalne');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_fis@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_fis_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo stanowisk fiskalnych
::----------------------------------------------------------------------------------------------------------------------
FIS.cntx_psh(); FIS.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_fis');
{? _value<>''
|| {? FIS.seek(_value)
   || __PARSES.setVal('StFiskalne',FIS.ref());
      AreaTitle.setTitle()
   ?}
|| __PARSES.setVal('StFiskalne',null());
   AreaTitle.setTitle()
?};
FIS.cntx_pop();
~~


\parses_kasa_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Zasila combo stanowisk kasowych
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'KOD','INTEGER','Kod',
   'NAZWA','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
exec('filtstankas','parses');
{? STANKAS.f_first()
|| {!
   |? _tab.blank();
      _tab.KOD:=STANKAS.KOD;
      _tab.NAZWA:=STANKAS.NAZWA;
      _tab.REF:=$STANKAS.ref();
      _tab.add();
      STANKAS.f_next()
   !}
?};
STANKAS.f_clear();
:: Dodatkowy zapis z null(), o ile parametr może zostać niewypełniony
::_tab.blank();
::_tab.KOD:=0;
::_tab.NAZWA:='';
::_tab.REF:='';
::_tab.add();
_tab


\parses_kasa_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo stanowisk kasowych
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('StKasowe');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_kasa@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_kasa_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo stanowisk kasowych
::----------------------------------------------------------------------------------------------------------------------
STANKAS.cntx_psh(); STANKAS.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_kasa');
{? _value<>''
|| {? STANKAS.seek(_value)
   || __PARSES.setVal('StKasowe',STANKAS.ref());
      AreaTitle.setTitle()
   ?}
|| __PARSES.setVal('StKasowe',null());
   AreaTitle.setTitle()
?};
STANKAS.cntx_pop();
~~


\parses_mkasa_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Zasila combo multikas
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'NAZ','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
exec('filtmkasa','parses');
{? MKASA.f_first()
|| {!
   |? _tab.blank();
      _tab.NAZ:=MKASA.NAZ;
      _tab.REF:=$MKASA.ref();
      _tab.add();
      MKASA.f_next()
   !}
?};
MKASA.f_clear();
:: Dodatkowy zapis z null(), o ile parametr może zostać niewypełniony
_tab.blank();
_tab.NAZ:='';
_tab.REF:='';
_tab.add();
_tab


\parses_mkasa_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo multikas
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('Mkasa');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_mkasa@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_mkasa_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [19.42]
:: OPIS: Obsługa po ustawieniu okresu na combo multikas
::----------------------------------------------------------------------------------------------------------------------
MKASA.cntx_psh(); MKASA.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_mkasa');
{? _value<>''
|| {? MKASA.seek(_value)
   || __PARSES.setVal('Mkasa',MKASA.ref());
      AreaTitle.setTitle()
   ?}
|| __PARSES.setVal('Mkasa',null());
   AreaTitle.setTitle()
?};
MKASA.cntx_pop();
~~


\parses_fzatr_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Zasila combo box form współpracy
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
   'NAZ','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
exec('filtrfzatr','parses');
{? F_ZATR.f_first()
|| {!
   |? _tab.blank();
      {? -F_ZATR.KOD <> F_ZATR.KOD
      || _tab.NAZ:=F_ZATR.OPIS;
         _tab.REF:=$F_ZATR.ref();
         _tab.add()
      ?};
      F_ZATR.f_next()
   !}
?};
F_ZATR.f_clear();
_tab


\parses_fzatr_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('F_ZATR');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_fzatr@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_fzatr_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Obsługa po ustawieniu formy zatrudnienia
::----------------------------------------------------------------------------------------------------------------------
F_ZATR.cntx_psh(); F_ZATR.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_fzatr');
{? _value<>''
|| {? F_ZATR.seek(_value)
   || _args:=__PARSES.args('F_ZATR');
      _args.KOD:=F_ZATR.KOD;
      __PARSES.setVal('F_ZATR',_args);
      exec('parses_lpla_update','pulpit')
   ?}
?};
F_ZATR.cntx_pop();
~~


\parses_jorg_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('JednostkaOrganizacyjna');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_jorg@desktop',_args.SYMBOL)
?};
_result:=_args.SYMBOL;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_jorg_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Obsługa po ustawieniu jednostki organizacyjnej
::----------------------------------------------------------------------------------------------------------------------
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_jorg');
_jednostka:=__PARSES.args('JednostkaOrganizacyjna');
_jednostka.SYMBOL:=_value;
__PARSES.setVal('JednostkaOrganizacyjna',_jednostka);
~~


\parses_jorg_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Obsługa po ustawieniu jednostki organizacyjnej
::----------------------------------------------------------------------------------------------------------------------
_skl:=exec('plaski_ud_def','schemat',,'PKD','PODZORG',exec('ref_firma','ustawienia'));
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'NAZ','STRING[20]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);

{? _skl.first()
|| {!
   |? _tab.NAZ:=_skl.SYMBOL;
      _tab.REF:=$_skl.ref();
      _tab.add();
      _skl.next()
   !}
?};
_tab


\parses_kart_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('ZakresDanych');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_kart@desktop',_args)
?};
_result:=_args;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_kart_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
   'NAZ','STRING[100]','Nazwa',
   'KOD','STRING[1]','Kod'
);

_tab.NAZ:='Zatrudnieni / aktywni';
_tab.KOD:='T';
_tab.add();

_tab.NAZ:='Zwolnieni / archiwalni';
_tab.KOD:='N';
_tab.add();

_tab.NAZ:='Wszyscy';
_tab.KOD:='W';
_tab.add();

_tab


\parses_kart_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::----------------------------------------------------------------------------------------------------------------------
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_kart');
__PARSES.setVal('ZakresDanych',_value)


\parses_lpla_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('ListaPłac');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_lpla@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_lpla_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::----------------------------------------------------------------------------------------------------------------------
O.cntx_psh(); O.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_lpla');
{? _value<>''
|| {? O.seek(_value)
   || _args:=__PARSES.args('ListaPłac');
      _args.REF:=O.ref();
      __PARSES.setVal('ListaPłac',_args)
   ?}
|| _args:=__PARSES.args('ListaPłac');
   _args.REF:=null();
   __PARSES.setVal('ListaPłac',_args);
   AreaTitle.setTitle()
?};
O.cntx_pop();
~~


\parses_lpla_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
   'NAZ','STRING[100]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);
O.cntx_psh();
_fzatr:=__PARSES.getVal('F_ZATR').KOD;
_dost_o:=exec('dostepne_o','schemat','PPL',_fzatr);
{? _dost_o.first
|| {!
   |? {? O.seek(_dost_o.REF)
      || _tab.blank();
         _tab.NAZ:=~(-O.LT);
         _tab.REF:=$O.ref();
         _tab.add();
         _dost_o.next()
      ?}
   !}
?};
O.cntx_pop();
_tab.blank();
_tab.NAZ:='';
_tab.REF:='';
_tab.add();
_tab


\parses_harm_default
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::   WE: [_a] - INTEGER - 0/1 czy ustawiać wartość, czy tylko ją zwracać
::   WY: STRING - wartość parametru dla panelplus
::----------------------------------------------------------------------------------------------------------------------
_set:=1;
{? var_pres('_a')=type_of(0)
|| _set:=_a
?};
_args:=__PARSES.getVal('OkresRozliczeniowy_Harmonogramy');
{? _set>0
|| exec('set_value','#desktop','','desktop:widget_parses','combo_harm@desktop',$_args.REF)
?};
_result:=$_args.REF;
{? _result=''
|| _result:='~~empty~~'
?};
_result


\parses_harm_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::----------------------------------------------------------------------------------------------------------------------
A_OKR.cntx_psh(); A_OKR.clear();
_value:=exec('get_value','#desktop','','desktop:widget_parses','combo_harm');
{? _value<>''
|| {? A_OKR.seek(_value)
   || _args:=__PARSES.args('OkresRozliczeniowy_Harmonogramy');
      _args.REF:=A_OKR.ref();
      __PARSES.setVal('OkresRozliczeniowy_Harmonogramy',_args)
   ?}
|| _args:=__PARSES.args('OkresRozliczeniowy_Harmonogramy');
   _args.REF:=null();
   __PARSES.setVal('OkresRozliczeniowy_Harmonogramy',_args)
?};
A_OKR.cntx_pop();
~~


\parses_harm_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: wesos [19.42]
:: OPIS: Ustawia wartość z aktualnego parametru na combo
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(2,
:: 'POLE','TYP','Nazwa w oknie',
   'NAZ','STRING[50]','Nazwa',
   'REF','STRING[16]','Ref SQL'
);

A_OKR.cntx_psh();
{? A_OKR.first()
|| {!
   |? _tab.blank();
      _tab.NAZ:=A_OKR.NAZ().NAZ +' '+ $A_OKR.OD + ' - ' + $A_OKR.DO;
      _tab.REF:=$A_OKR.ref();
      _tab.add();
      A_OKR.next()
   !}
?};
A_OKR.cntx_pop();
_tab.blank();
_tab.NAZ:='';
_tab.REF:='';
_tab.add();
_tab


\karteczki_install
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Dodaje na pulpit widget z karteczkami
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_id:='fins';
exec('pulpit_add','#desktop','Karteczki'@,_id,18,30,,,0);
exec('load','#desktop','desktop:'+_id,'widget_'+_id+'.dsk',,,,,,0,,1);
~~


\karteczki_add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Dodaje nową karteczkę
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_ctr_id:=ctr_info('ctr_id');
exec('clone','#desktop','',_ctr_id,'fin',1);
~~


\karteczki_save
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Zapisuje konfigurację karteczek
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
exec('user_save','#desktop','','desktop:fins');
~~


\karteczki_revert
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Usuwa wszystkie karteczki
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_filename:='widget_fins.dsk';
_filename:=exec('get_user_name','#desktop',_filename);
{? fexists(_filename,1)
||
   {? FUN.ask('Usunąć wszystkie karteczki?'@)
   || exec('user_revert','#desktop','','desktop:fins',0)
   ?}
|| FUN.info('Brak karteczek do usunięcia.'@)
?};
~~


\karteczki_del
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Usuwa karteczkę
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_id:=ctr_info('element_id');
_ctr_id:=ctr_info('ctr_id');
{? _id<>''
|| _split:=spli_str(_id,'@');
   {? obj_len(_split)>1
   || _desk_name:=_split[2];
      {? FUN.ask('Usunąć karteczkę?'@)
      || exec('delete','#desktop','',_ctr_id,_desk_name,1)
      ?}
   ?}
?};
~~


\karteczki_focus_lost
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Po utracie focusa w polu tekstowym karteczki
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_id:=ctr_info('element_id');
_ctr_id:=ctr_info('ctr_id');
{? _id<>''
|| _split:=spli_str(_id,'@');
   {? obj_len(_split)>1
   || _desk_name:=_split[2];
      exec('set_value','#desktop','',_ctr_id,'txt@'+_desk_name,'view=top')
   ?}
?};
exec('user_save','#desktop','',_ctr_id);
~~


\karteczki_color
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Ustawia kolor karteczki
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_id:=ctr_info('element_id');
_ctr_id:=ctr_info('ctr_id');
{? _id<>''
|| _split:=spli_str(_id,'@');
   {? obj_len(_split)>1
   || _desk_name:=_split[2];
      _col:=exec('edit_color','#edit','255:204:0');
      {? _col<>''
      || exec('set_background','#desktop','',_ctr_id,'karteczka@'+_desk_name,_col,1);
         exec('user_save','#desktop','',_ctr_id);
         ~~
      ?}
   ?}
?};
~~


\karteczki_copy
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Kopiuje treść karteczki do schowka
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_id:=ctr_info('element_id');
_ctr_id:=ctr_info('ctr_id');
{? _id<>''
|| _split:=spli_str(_id,'@');
   {? obj_len(_split)>1
   || _desk_name:=_split[2];
      _txt:=exec('get_value','#desktop','',_ctr_id,'txt@'+_desk_name);
      exec('clip_set_txt','#desktop','',_ctr_id,_txt)
   ?}
?};
~~


\karteczki_paste
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [19.42]
:: OPIS: Wkleja treść schowka do karteczki
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_id:=ctr_info('element_id');
_ctr_id:=ctr_info('ctr_id');
{? _id<>''
|| _split:=spli_str(_id,'@');
   {? obj_len(_split)>1
   || _desk_name:=_split[2];

      _can_continue:=1;
      _txt:=exec('get_value','#desktop','',_ctr_id,'txt@'+_desk_name);
      {? _txt<>''
      || _can_continue:=FUN.ask('Zastąpić treść karteczki treścią ze schowka?'@)
      ?};
      {? _can_continue>0
      ||
         _txt:=exec('clip_get_txt','#desktop','',_ctr_id);
         exec('set_value','#desktop','',_ctr_id,'txt@'+_desk_name,_txt);
         exec('user_save','#desktop','',_ctr_id);
         ~~
      ?}
   ?}
?};
~~


\parses_show
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [22.26]
:: OPIS: Obsługa po przywróceniu kafelka z ukrycia na pulpicie
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
exec('parses_on_off','pulpit');
~~


\funpar_install
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [23.25]
:: OPIS: Dodaje na pulpit kontrolkę z parametryzacją
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_x:=-1;
_y:=-1;
_w:=27;
_h:=30;

ctr_call('!desktop',,'addWindowControl','funpar'
                                       ,'@dskmenuctrl>list'
                                       ,'Ustawienia i parametryzacja'@
                                       ,_x
                                       ,_y
                                       ,_w
                                       ,_h
                                       ,0);

exec('funpar_load','pulpit');
~~


\funpar_load
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [23.25]
:: OPIS: Ładuje kontrolkę z parametryzacją
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
exec('czytaj','#stalesys',,XINFO,'DOKUWIKI','DOKU_INT');
{? exec('interm','#system') & XINFO.DOKU_INT<>''
|| _adr_wi:=-(form(XINFO.DOKU_INT))
|| _adr_wi:=-(form(XINFO.DOKUWIKI))
?};

_tab:=exec('get_list','#funpar_wid');
{? _tab.first()
|| {!
   |? _uid:='';
      {? _tab.EXEC<>''
      || _uid:=exec('bdexec_check','#b_desktop',_tab.EXEC,3+_tab.AUID)
      ?};
      _tooltip:='';
      {? _tab.TYPE='C'
      || _tooltip:='Uruchom czynność parametryzacyjną: %1 %2'@[_tab.AUID,_tab.TEXT]
      |? _tab.TYPE='F'
      || _tooltip:='Uruchom formułę parametryzacyjną: %1'@[_tab.TEXT]
      || _tooltip:='Błąd'@
      ?};
::    adres serwera dokumentacyjnego + ścieżka
      _help:='';
      {? _tab.AUID<>''
      || _help:=exec('set_help','#help',_tab.AUID)
      ?};
      ctr_set('!desktop','desktop:funpar','addItemFormula',_tab.TEXT
                                                         ,_tooltip
                                                         ,_help
                                                         ,_tab.ICON
                                                         ,_tab.COLOR
                                                         ,'FUNPAR'
                                                         ,_uid);
      _tab.next()
   !}
?};
ctr_call('!desktop','desktop:funpar','initListControl');
~~


:Sign Version 2.0 jowisz:1048 2023/06/23 14:14:38 0031f01c54ec91726d1a3f3206bf903e27f16fd3521b4ac6f601781629e9024d3fff140cc83a7fd5c360a896cc14139fa183e43f9e001d835f87b22e72c0dc027e7f8a3d8cc79cba283f9933496141ebfd4718ca4f0b852948b3123afaf4a4e17b5a0da576a335293ffd7b8594a83d0cedba76006416a02a1ebb84aae035a205
