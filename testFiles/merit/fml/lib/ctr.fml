:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: ctr.fml
:: Utworzony: 12.11.2015
:: Autor: MB
::======================================================================================================================
:: Zawartość: Formuły obszaru CTR
::======================================================================================================================


\init
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Formuła inicjująca dla obszaru CTR
::----------------------------------------------------------------------------------------------------------------------
K_WERSJE.index('SYM'); K_WERSJE.prefix('Wykonanie');
{? ~K_WERSJE.first() | K_WERSJE.SYM<>'Wykonanie'
|| K_WERSJE.SYM:='Wykonanie';
   K_WERSJE.CZY_SYS:='T';
   K_WERSJE.CZY_KALK:='N';
   K_WERSJE.K_W_OBL:=null;
   K_WERSJE.add()
?};
exec('new_wersje','obe_budz');
~~


\ctr_bha
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Główna formuła obszaru roboczego CTR_BHA - Harmonogramy budżetów
::----------------------------------------------------------------------------------------------------------------------
exec('init','ctr');
exec('init_kharm_var','control');
_grp:=SKID_MBN.grp_make('',"
   exec('init_win','ctr')
",'ctr_bha',,,"exec('exit','zws')");

:: Harmonogramy budżetów
exec('add_tab','!ctr_hbd_zhar','Harmonogramy budżetów'@,SKID_MBN,_grp);
:: Zadania budżetowe
exec('add_tab','ctr_bha','Zadania budżetowe',SKID_MBN,_grp);
:: Szablony widoków budżetowych
exec('add_tab','!ctr_hbd_ddef','Szablony widoków budżetowych'@,SKID_MBN,_grp,1);
:: Wersje planów
exec('add_tab','!ctr_hbd_ddef','Wersje planów'@,SKID_MBN,_grp,2);

SKID_MBN.win_sel(_grp);
AreaTitle.setTabWin(SKID_MBN,~~);
AreaTitle.setTitle();
SKID_MBN.select();
~~


\init_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Na wypełnienie okna grupowego obszaru roboczego
::----------------------------------------------------------------------------------------------------------------------
grp_disp(TT_ROK,TT_ROK.win_sel('?'));
grp_disp(TT_GRUPA,TT_GRUPA.win_sel('?'))


\ctr_bha_www
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Główna formuła obszaru roboczego CTR_HBD - Harmonogramy budżetów
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
::OPERATOR.USER:={? exec('getWebUser','users',app_info('web_user')) || USERS.ref() || null ?};
USERS.index('USR_KKOD'); USERS.prefix(app_info('web_user'),);
{? USERS.first()
|| OPERATOR.USER:=USERS.ref()
?};
exec('AreaTitle','#object');
AreaTitle.setArea('CTR_HBD');
web_title('%1, %2: %3'[exec('nazwa','#system'), 'Firma '@+REF.FIRMA().SYMBOL,AreaTitle.getTitle()],'all');
::web_msg(OPERATOR.USER().KOD+'='+$OPERATOR.USER);
K_HARM_W.index('USERS');
K_HARM_W.prefix(OPERATOR.USER,'U');
exec('set_web_win_title','ctr_bha',0,'U');
K_HARM_W.web_select('WEB');
~~


\ctr_pdm
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Główna formuła obszaru roboczego CTR_PDM - Wartości controllingu
::----------------------------------------------------------------------------------------------------------------------
{? ~SSTALE.AR | ~SSTALE.AO
|| FUN.info('Nie podano parametrów pracy.'@)
|| exec('czytaj','#stalesys');
   exec('F','object');
   exec('RB','object');

   K__PNOTY.fld_fml('WART','AFTER_EDIT',"exec('ae_k_pnoty_wart','control')");
   _firma:=REF.FIRMA; REF.FIRMA:=REF.S_FIRMA;
   _grp:=K__NAG.grp_make('',"",'ctr_pdz',,,"exec('exit','zws')");
:: Aktualizacja danych
   exec('add_tab','!ctr_pdm_patd','Aktualizacja danych'@,K__NAG,_grp);
:: Noty controllingowe
   exec('add_tab','!ctr_pdm_znos','Noty controllingowe'@,K__NAG,_grp);
:: Wskaźniki pomocnicze
   exec('add_tab','!ctr_pdm_zwsk','Wskaźniki pomocnicze'@,K__NAG,_grp);
:: Dokumenty księgowe
   exec('add_tab','!ctr_pco_zdok','Dokumenty księgowe'@,K__NAG,_grp);
:: Godziny pracy
   exec('add_tab','!ctr_pco_zpra','Godziny pracy'@,K__NAG,_grp);
:: Płace
   exec('add_tab','!ctr_pco_zpwn','Płace'@,K__NAG,_grp);
:: Umowy zlecenia
   exec('add_tab','!ctr_pco_zpwz','Umowy zlecenia'@,K__NAG,_grp);
:: Plany amortyzacji
   exec('add_tab','!ctr_pco_zstp','Plany amortyzacji'@,K__NAG,_grp);
:: Amortyzacja
   exec('add_tab','!ctr_pco_zstw','Amortyzacja'@,K__NAG,_grp);
:: Przegląd wartości
   exec('add_tab','!ctr_pdm_zmod','Przegląd wartości dla modeli'@,K__NAG,_grp);
   K__NAG.win_sel(_grp);
   AreaTitle.setTabWin(K__NAG,~~);
   AreaTitle.setTitle();
   K__NAG.select();
   REF.FIRMA:=_firma;
   VAR_DEL.delete('gen_zero','__UDFORM','__UDSCH','__UDWER','wybntree')
?};
~~


\ctr_rpp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Główna formuła obszaru roboczego CTR_RPP - Raporty controllingowe
::----------------------------------------------------------------------------------------------------------------------
exec('czytaj','#stalesys');
USERS.actions('SLO1','S');
__KRTyp:='E';
BPMN.SYM_DOM:='CTR';
_firma:=REF.FIRMA; REF.FIRMA:=REF.S_FIRMA;
_tab:=K_RAPORT;
_grp:=_tab.grp_make(,"exec('bf_k_raporty','ctr')",'ctr_rpp',,,"exec('exit','zws')");
:: Raporty - definicje
exec('add_tab','!ctr_rap_zzad','Definicje raportów'@,_tab,_grp);
:: Uprawnienia do danych
exec('add_tab','!ctr_rap_zzup','Zakresy danych w raportach'@,_tab,_grp);
:: Moje raporty
exec('add_tab','!ctr_rap_zzap','Moje raporty'@,_tab,_grp);
_tab.win_sel(_grp);
AreaTitle.setTabWin(_tab,~~);
AreaTitle.setTitle();
_tab.select();
REF.FIRMA:=_firma;
VAR_DEL.delete('__KRTyp','firstR');
~~


\bf_k_raporty
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [2011]
:: OPIS: Po wyswietleniu okienka grupowego tabeli K_RAPORTY
::  OLD: \bf_k_raporty/skid_con.fml
::----------------------------------------------------------------------------------------------------------------------
UserRap:=exec('usersWithAction','users','CTR_RAP_ZZAP',REF.FIRMA);
USERS.win_sel('SLO2');
USERS.clear();
USERS.f_set('KOD',,'USERS.REFERENCE in (select REF from :_a) ',UserRap);
{? var_press('_a')<=0 | _a
|| grp_disp(USERS,'SLO2')
?};
~~


\ctr_rpp_www
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Główna formuła obszaru roboczego CTR_RPW - Raporty controllingowe przez www
::----------------------------------------------------------------------------------------------------------------------
::OPERATOR.USER:={? exec('getWebUser','users',app_info('web_user')) || USERS.ref() || null ?};
USERS.index('USR_KKOD'); USERS.prefix(app_info('web_user'),);
{? USERS.first()
|| OPERATOR.USER:=USERS.ref()
?};
exec('AreaTitle','#object');
AreaTitle.setArea('CTR_RPP');
web_title('%1, %2: %3'[exec('nazwa','#system'), 'Firma '@+REF.FIRMA().SYMBOL,AreaTitle.getTitle()],'all');
::web_msg(OPERATOR.USER().KOD+'='+$OPERATOR.USER);
K_RAP_U.index('USERS');
K_RAP_U.prefix(OPERATOR.USER,'T');
K_RAP_U.web_win_init('WER_WWW',,'title= '+OPERATOR.USER().KOD);
K_RAP_U.web_select('WER_WWW');
~~

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:16 afcddc31e53697a086e04e4ee22a7a27b43273a8e8d0e6862c04dce9b7b0d350ae988535a7532c65684ccead57e4910767aba788d8461b37573baa48e3ad8a5ee30d5be55aeb3a9c4b616ca0f213c6c33b6f8b9e6efe52c242278d6bf74f624b5fa01eceaf4934756595b5edaa57161dd53aed8ef4d766e932187a98d31c3462
