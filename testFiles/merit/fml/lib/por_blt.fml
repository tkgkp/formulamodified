:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: por_blt.fml
:: Utworzony: 03.12.2019
:: Autor: RWR
::======================================================================================================================
:: Zawartość: Formuły obszaru POR_BLT - Biuletyny.
::======================================================================================================================


\_cfg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [20.42]
:: OPIS: Kastomizacja działania.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_cfg:=exec('_cfg','portal_bip','BIPNAG');

_cfg.area:=1;
_cfg.uid:='POR_BIP_RBLT';
_cfg.funkc:='BLTN';

_cfg.bipkat.wd:='SLO';
_cfg.bipkat.we:=exec('bipkat_we','portal_bip',_cfg.funkc,0);
_cfg.bipkat.wp:=exec('bipkat_we','portal_bip',_cfg.funkc,1);
_cfg.bipkat.SLO_hdr_sel:='Kategorie biuletynów'@;
_cfg.bipkat.RED_hdr_edit:='Kategoria biuletynu'@;

_cfg.bipnag_wnds.nag_ws:=exec('_mk_sel','por_blt',_cfg);
_cfg.bipnag_wnds.nag_edit:=_cfg.funkc+'R';
_cfg.bipnag_wnds.nag_patt:=_cfg.funkc+'S';
_cfg.bipnag_wnds.grp_title:='Biuletyny'@;
_cfg.bipnag_wnds.kryt_tab:='Kryteria dostępu'@;
_cfg.bipnag_wnds.odb_ws:='WER';
_cfg.bipnag_wnds.odb_tab:='Odbiorcy'@;

_cfg.bipnag_main.brak:='Brak odbiorców biuletynu.'@;
_cfg.bipnag_main.id:="'%1 | %2' [BIPNAG.DT1$1,BIPNAG.TYTUL]";
_cfg.bipnag_main.on:='B';
_cfg.bipnag_main.off:='C';

_cfg.bipnag_on.ask1:='Czy opublikować zaznaczony biuletyn?'@;
_cfg.bipnag_on.askn:='Czy opublikować zaznaczone biuletyny?'@;
_cfg.bipnag_on.title:='Raport z publikowania biuletynów'@;
_cfg.bipnag_on.askb:='Czy opublikować bieżący biuletyn?'@;
_cfg.bipnag_on.root_odb:='Biuletyny bez odbiorców'@;
_cfg.bipnag_on.root_ok:='Biuletyny niewymagające opublikowania (opublikowane już wcześniej)'@;

_cfg.bipnag_off.ask1:='Czy wycofać publikację zaznaczonego biuletynu?'@;
_cfg.bipnag_off.askn:='Czy wycofać publikację zaznaczonych biuletynów?'@;
_cfg.bipnag_off.title:='Raport z wycofania publikacji'@;
_cfg.bipnag_off.askb:='Czy wycofać publikację bieżącego biuletynu?'@;
_cfg.bipnag_off.confirm:="1";
_cfg.bipnag_off.root_ok:='Biuletyny niewymagające wycofania publikacji (wycofane już wcześniej)'@;

_cfg.bipodb_usun.ask1:='Czy usunąć zaznaczonego odbiorcę?'@;
_cfg.bipodb_usun.askn:='Czy usunąć zaznaczonych odbiorców?'@;
_cfg.bipodb_usun.title:='Raport z usuwania odbiorców'@;
_cfg.bipodb_usun.askb:='Czy usunąć bieżącego odbiorcę?'@;
_cfg.bipodb_usun.root_r:='Odbiorcy niemogący być usunięci (status inny niż ''R'').'@;

_cfg.bipodb_wyklucz.ask1:='Czy wykluczyć zaznaczonego odbiorcę?'@;
_cfg.bipodb_wyklucz.askn:='Czy wykluczyć zaznaczonych odbiorców?'@;
_cfg.bipodb_wyklucz.title:='Raport z wykluczania odbiorców'@;
_cfg.bipodb_wyklucz.askb:='Czy wykluczyć bieżącego odbiorcę?'@;
_cfg.bipodb_wyklucz.root_a:='Odbiorcy niemogący być wykluczonymi (status inny niż ''A'').'@;

_cfg.bipodb_uwzglednij.ask1:='Czy uwzględnić zaznaczonego odbiorcę?'@;
_cfg.bipodb_uwzglednij.askn:='Czy uwzględnić zaznaczonych odbiorców?'@;
_cfg.bipodb_uwzglednij.title:='Raport z uwzględniania odbiorców'@;
_cfg.bipodb_uwzglednij.askb:='Czy uwzględnić bieżącego odbiorcę?'@;
_cfg.bipodb_uwzglednij.a2r:="
   '%1 %2 (PESEL: %3): odbiorca nie spełnia obecnych kryteriów.\n'
   'Zmiana statusu na ''A'' nie jest możliwa.\n'
   'Odbiorca otrzymał status ''R''.'@
   [OSOBA.NAZWISKO,OSOBA.PIERWSZE,OSOBA.PESEL]";
_cfg.bipodb_uwzglednij.rootr:='Odbiorcy niespełniający obecnych kryteriów - status zmieniony na ''R''.'@;
_cfg.bipodb_uwzglednij.root_w:='Odbiorcy niemogący być uwzględnionymi (status inny niż ''W'').'@;

_cfg


\_mk_sel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [20.42]
:: OPIS: Formuła tworzy dynamiczne okno wertowania dla tabeli BIPNAG.
::   WE: _a [ARRAY] - Tablica elementów nazwanych z parametryzacją.
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_cfg:=_a;

_ws:=BIPNAG.mk_sel(,'P',,'#nag_'+(-_cfg.funkc),,,,,'U');

BIPNAG.win_fld(_ws,,'BIPKAT','KOD',,8,,1,'Kategoria - kod'@,,'Kod kategorii biuletynu'@);
BIPNAG.win_fld(_ws,,'BIPKAT','NAZWA',,16,,1,'Kategoria - nazwa'@,,'Nazwa kategorii biuletynu'@);
BIPNAG.win_fld(_ws,,'TYTUL',,,65,,1,'Tytuł'@,,'Tytuł biuletynu'@);
BIPNAG.win_fld(_ws,EDIT_VAR,'AUTOR',,,37,,1,'Autor'@,,'Autor biuletynu'@);
BIPNAG.win_fld(_ws,,'AKT',,,-3,,1,'Opublikowany'@,,'Biuletyn widoczny na portalu [T/N]'@,2,,"'T'","'N'");
BIPNAG.win_fld(_ws,,'LODB',,,-5,,1,'Liczba odbiorców'@,,'Liczba odbiorców biuletynu'@);
BIPNAG.win_fld(_ws,,'DT1',,,-10,,1,'Data utworzenia'@,,'Data utworzenia biuletynu'@);

{! _empty:=0 .. 1
|! BIPNAG.win_act(_ws,_empty,'Dołącz',,,'Dołączenie nowego zapisu'@,,"0",_empty);
   task_attach(_cfg.uid)
!};
BIPNAG.win_btn(_ws,'text=%1' ['Dołącz'@],'menu:D');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Popraw',,,'Poprawienie bieżącego zapisu'@,,"params_exec('bipnag_popraw_a','portal_bip')");
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Popraw'@],'menu:P',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Usuń',,,'Usunięcie bieżącego zapisu'@);
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Usuń'@],'menu:U',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Formuła','Pu&blikuj'@@,,'Udostępnienie biuletynu na portalu'@,
   "params_exec('bipnag_aktn_b','portal_bip')",,,
   1,
   "params_exec('bipnag_aktn_bg','portal_bip')",
   "params_exec('bipnag_aktn_ag','portal_bip')",
   'B'
);
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Pu&blikuj'@],'menu:B',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Formuła','Wy&cofaj'@@,,'Wycofanie biuletynu z portalu'@,
   "params_exec('bipnag_aktt_b','portal_bip')",,,
   1,
   "params_exec('bipnag_aktt_bg','portal_bip')",
   "params_exec('bipnag_aktt_ag','portal_bip')",
   'C'
);
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Wy&cofaj'@],'menu:C',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Formuła','Zmian&y'@@,,'Informacje o modyfikacjach bieżącego zapisu'@,"mb_exec('ZMIANY()')");
BIPNAG.win_act(_ws,,'Szukaj');
BIPNAG.win_act(_ws,,'Kolejność');
{! _empty:=0 .. 1
|! BIPNAG.win_act(_ws,_empty,'Rekord',,,,
      "params_exec('bipnag_bd','portal_bip',_a)",
      "params_exec('bipnag_ae','portal_bip')
   ")
!};

_ws

:Sign Version 2.0 jowisz:1048 2020/10/16 15:22:56 6cda7ef2c87b4866cb040ee3e237381dc48f6285a3ff92cb45123704705201aa9aaec6692eceacafb102d1973a0903a709111ab5b11d4b39126349dea118e5786797f13a02046d2c29cb9ae54e3d484fc8d3c3f2030ae57eabcda19877f088f69f6396c5908463710e8b49a59eca6d182ad47705fc5d7004ce24e896b7144af5
