:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: prc_ws.fml
:: Utworzony: 08.08.2017
:: Autor: TMR
:: Systemy:
::======================================================================================================================
:: Zawartość: Formuły do obsługi parametrów wykorzystywanych w planowaniu i grafikach
::======================================================================================================================


\set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Ustawia wartość parametru
::   WE: _a  [STRING] - nazwa parametru
::       _b  [STRING] - wartość parametru
::      [_c] [STRING] - źródło parametru
::      [_d] [STRING] - identyfikator tomcata
::      [_e] [STRING] - identyfikator sesji
::      [_f] [STRING] - identyfikator zakładki w przeglądarce
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_result:=0;
   _key:={? var_pres('_a')=type_of('') || _a || return(_result) ?};
   _val:={? var_pres('_b')=type_of('') || _b || return(_result) ?};
_source:={? var_pres('_c')=type_of('') || _c || ''              ?};
  _tcid:={? var_pres('_d')=type_of('') || _d || ''              ?};
 _sesid:={? var_pres('_e')=type_of('') || _e || ''              ?};
 _tabid:={? var_pres('_f')=type_of('') || _f || ''              ?};

_login:=exec('get_user_login','pkw');

PRC_WS.cntx_psh();
PRC_WS.index('UNIQUE');
PRC_WS.prefix(_tcid,_sesid,_tabid,_login,_source,_key);
{? PRC_WS.first()
|| PRC_WS.VAL:=_val;
   _result:=PRC_WS.put(1)
|| PRC_WS.blank(1);
   PRC_WS.TCID:=_tcid;
   PRC_WS.SESID:=_sesid;
   PRC_WS.TABID:=_tabid;
   PRC_WS.LOGIN:=_login;
   PRC_WS.SOURCE:=_source;
   PRC_WS.KEY:=_key;
   PRC_WS.VAL:=_val;
   _result:=PRC_WS.add(1)
?};
PRC_WS.cntx_pop();

_result


\get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Pobiera wartość parametru
::   WE: _a  [STRING] - nazwa parametru
::      [_b] [STRING] - źródło parametru
::      [_c] [STRING] - identyfikator tomcata
::      [_d] [STRING] - identyfikator sesji
::      [_e] [STRING] - identyfikator zakładki w przeglądarce
::   WY:     [STRING] - wartość parametru
::----------------------------------------------------------------------------------------------------------------------
_result:='';
   _key:={? var_pres('_a')=type_of('') || _a || return(_result) ?};
_source:={? var_pres('_b')=type_of('') || _b || ''              ?};
  _tcid:={? var_pres('_c')=type_of('') || _c || ''              ?};
 _sesid:={? var_pres('_d')=type_of('') || _d || ''              ?};
 _tabid:={? var_pres('_e')=type_of('') || _e || ''              ?};

_login:=exec('get_user_login','pkw');

PRC_WS.cntx_psh();
PRC_WS.index('UNIQUE');
PRC_WS.prefix(_tcid,_sesid,_tabid,_login,_source,_key);
{? PRC_WS.first()
|| _result:=PRC_WS.VAL
?};
PRC_WS.cntx_pop();

_result


\prc_ws_del
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Kasowanie danych parametrów sesyjnych
::   WE: _a [INTEGER] - 1 - start TOMCATA
::                      2 - zakończenie sesji webterma
::                      3 - Zamknięcie zakładki - kasowane są tylko rekordy związane z daną zakładką.
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_tryb:={? var_pres('_a')=type_of(0) || _a || return(0) ?};

_tcid:=app_info('web_tcid');
_sesid:=app_info('web_sesid');
_tabid:=app_info('web_tabid');

PRC_WS.index('UNIQUE');
{? _tryb=1
|| PRC_WS.prefix(_tcid,)
|? _tryb=2
|| PRC_WS.prefix(_tcid,_sesid,)
|? _tryb=3
|| PRC_WS.prefix(_tcid,_sesid,_tabid,)
?};
{? PRC_WS.first()
|| {! |? PRC_WS.del() !}
?};
1


\okres_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zapamiętuje wartość wybranego okresu rozliczeniowego
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','okres_rozliczeniowy',_val,_sSource)


\okres_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zwraca wartość zapamiętanego okresu rozliczeniowego
::   WE:
::   WY: [REFERENCE] - wskazanie na okres rozliczeniowy
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
_sOkres:=exec('get','prc_ws','okres_rozliczeniowy',_sSource);
_rOkres:=exec('FindAndGet','#table',A_OKR,_sOkres,,,null());
_rOkres


\prac_z_okresu_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zapamiętuje wartość stanu chceckboxa "Pracownicy z okresu"
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prac_z_okresu',_val,_sSource)


\prac_z_okresu_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zwraca wartość stanu chceckboxa "Pracownicy z okresu"
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prac_z_okresu',_sSource)


\prac_z_bledami_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zapamiętuje wartość stanu chceckboxa "Pracownicy z błędami"
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prac_z_bledami',_val,_sSource)


\prac_z_bledami_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zwraca wartość stanu chceckboxa "Pracownicy z błędami"
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prac_z_bledami',_sSource)


\source4ses_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Ustawia wartość paraetru źródła danych w bieżącej sesji
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_tcid:=app_info('web_tcid');
_sesid:=app_info('web_sesid');
_tabid:=app_info('web_tabid');
exec('set','prc_ws','source',_val,'',_tcid,_sesid,_tabid)


\source4ses_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Pobiera wartość parametru informującego o źródle wywołania (p-planowanie, g-grafik) w bieżącej sesji
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_tcid:=app_info('web_tcid');
_sesid:=app_info('web_sesid');
_tabid:=app_info('web_tabid');
exec('get','prc_ws','source','',_tcid,_sesid,_tabid)


\prezentacja_godzin_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zapamiętuje wartość stanu prezentacji godzin w kafelku
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prezentacja_godzin',_val,_sSource)


\prezentacja_godzin_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zwraca wartość stanu prezentacji godzin w kafelku
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prezentacja_godzin',_sSource)


\prezentacja_rczp_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zapamiętuje wartość stanu checkboxa dot. prezentacji ruchomego czasu pracy
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prezentacja_rczp',_val,_sSource)


\prezentacja_rczp_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [17.42]
:: OPIS: Zwraca wartość stanu checkboxa dot. prezentacji ruchomego czasu pracy
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prezentacja_rczp',_sSource)


\prezentacja_sz_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [22.26]
:: OPIS: Zapamiętuje wartość stanu checkboxa dot. prezentacji symbolu dla zmian w pracy
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prezentacja_sz',_val,_sSource)


\prezentacja_sz_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [22.26]
:: OPIS: Zwraca wartość stanu checkboxa dot. prezentacji symbolu dla zmian w pracy
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prezentacja_sz',_sSource)


\prezentacja_kz_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [22.26]
:: OPIS: Zapamiętuje wartość stanu checkboxa dot. prezentacji koloru dla zmian w pracy
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prezentacja_kz',_val,_sSource)


\prezentacja_kz_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [22.26]
:: OPIS: Zwraca wartość stanu checkboxa dot. prezentacji koloru dla zmian w pracy
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prezentacja_kz',_sSource)


\grafiki_ah_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zapamiętuje wartość sposobu rejestrowania nieobecności ad-hoc
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','grafiki_ah',_val,_sSource)


\grafiki_ah_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zwraca wartość sposobu rejestrowania nieobecności ad-hoc
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','grafiki_ah',_sSource)


\warstwa_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zapamiętuje wartość stanu chceckboxa "Plan"
::   WE: _a [STRING] - nazwa warstwy
::       _b [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_warstwa:={? var_pres('_a')=type_of('') || _a || return(0) ?};
    _val:={? var_pres('_b')=type_of('') || _b || return(0) ?};

_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','warstwa_%1'[_warstwa],_val,_sSource)


\warstwa_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zwraca wartość stanu chceckboxa "Plan"
::   WE: _a [STRING] - nazwa warstwy
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_warstwa:={? var_pres('_a')=type_of('') || _a || return('') ?};

_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','warstwa_%1'[_warstwa],_sSource)


\grafiki_weryfikacja_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zapamiętuje wartość sposobu weryfikacji
::   WE: _a [STRING] - wartość parametru
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','grafiki_weryfikacja',_val,_sSource)


\grafiki_weryfikacja_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zwraca wartość sposobu weryfikacji
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','grafiki_weryfikacja',_sSource)


\prezentacja_normy_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zapamiętuje sposób prezentacji widoku norm (okres/miesiąc)
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prezentacja_normy',_val,_sSource)


\prezentacja_normy_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.02]
:: OPIS: Zwraca sposób prezentacji widoku norm (okres/miesiąc)
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prezentacja_normy',_sSource)


\prezentacja_widoku_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.22]
:: OPIS: Zapamiętuje sposób prezentacji widoku zakładek (tydzień/miesiąc)
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prezentacja_widoku',_val,_sSource)


\prezentacja_widoku_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.22]
:: OPIS: Zwraca sposób prezentacji widoku zakładek (tydzień/miesiąc)
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prezentacja_widoku',_sSource)


\lokalizacja_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.42]
:: OPIS: Zapamiętuje wybraną lokalizację
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','lokalizacja',_val,_sSource)


\lokalizacja_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.42]
:: OPIS: Zwraca wybraną lokalizację
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','lokalizacja',_sSource)


\plob_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.42]
:: OPIS: Zapamiętuje wybrany kontekst pracy (plob - planowany obiekt)
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','plob',_val,_sSource)


\plob_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.42]
:: OPIS: Zwraca wybrany kontekst pracy (plob - planowany obiekt)
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','plob',_sSource)


\prezentacja_podzialy_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.42]
:: OPIS: Zapamiętuje wartość stanu checkboxa dot. prezentacji podziałów w widoku
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','prezentacja_podzialy',_val,_sSource)


\prezentacja_podzialy_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [18.42]
:: OPIS: Zwraca wartość stanu checkboxa dot. prezentacji podziałów w widoku
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','prezentacja_podzialy',_sSource)


\komm_msg_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [19.42]
:: OPIS: Zwraca wartość stanu chceckboxa dot. wyświetlania komunikatów typu błąd
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','komm_msg',_val,_sSource)


\komm_msg_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [19.42]
:: OPIS: Zwraca wartość stanu chceckboxa dot. wyświetlania komunikatów typu błąd
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','komm_msg',_sSource)


\zakres_dat_set
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [19.42]
:: OPIS: Zwraca wartość parametru określającego sposób prezentacji zakresu dat w operacjach grupowych
::   WE: _a [STRING] - wartość parametru
::   WY: 0/1
::----------------------------------------------------------------------------------------------------------------------
_val:={? var_pres('_a')=type_of('') || _a || return(0) ?};
_sSource:=exec('source4ses_get','prc_ws');
exec('set','prc_ws','zakres_dat',_val,_sSource)


\zakres_dat_get
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TMR [19.42]
:: OPIS: Zwraca wartość parametru określającego sposób prezentacji zakresu dat w operacjach grupowych
::   WE:
::   WY: [STRING]
::----------------------------------------------------------------------------------------------------------------------
_sSource:=exec('source4ses_get','prc_ws');
exec('get','prc_ws','zakres_dat',_sSource)

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:22 91812b7fa018378091fb87f5f17ef5371dd714e807299fd4ba3313be468bcda5a032a8018e10ef6538d1c73cb5e4d1e754a9500c150382ed84f56f7d83280af7c1e17c73b75531a8d3916eb56c47bfca262b9c86341ebd270192238731a18b4aa61e719c2ba74f2a40882ae9308824e6c044982e19cbcf57aea6b41cb2119eb3
