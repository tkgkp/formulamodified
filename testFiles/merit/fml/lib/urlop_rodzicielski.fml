:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: urlop_rodzicielski.fml
:: Utworzony: 17.04.2018
:: Autor: areKc
::======================================================================================================================
:: Zawartość: Plik zawiera formuły obsługi informacji o wnioskach do urlopów rodzicielskich do świadectwa pracy.
::======================================================================================================================


\wniosek
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_40]
:: OPIS: Wyświetlenie okienka z informacją o nieobecnościach rodzicielskich do świadectwa pracy.
::       Zakładamy, że formuła jest wywoływana w związku ze zmianami w tabeli N.
::   WE: [_a] opcjonalnie numer rubryki nieobecności
::   WY:
::  OLD: \msg_rodz/kartprac.fml
::----------------------------------------------------------------------------------------------------------------------
_nb:={? var_pres('_a')=type_of(0) & _a || _a || N.NB ?};
{? __RUB.sys_attr(_nb,1151) | __RUB.sys_attr(_nb,1152) || return() ?};
FUN.emsg('%1 %2 %3.\n%4\n%5'
   [  'Dodano lub zmieniono nieobecność rodzicielską pracownika'@,
      P.OSOBA().NAZWISKO,
      OSOBA.PIERWSZE,
      'Należy zweryfikować poprawność danych do świadectwa pracy.'@,
      'Dane można uzupełnić później wybierając akcję "Urlopy rodzicielskie".'@
   ]
);
exec('rd_okr_wer','urlop_rodzicielski');
~~


\rd_okr_wer
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Główne wywołanie okienka z tabeli nieobecności.
::   WE:
::   WY:
::  OLD: \rd_okr/url_rod.fml
::  OLD: \rd_okr_gwin_ST/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_mode:='maximized';
_upr:=exec('chk_role','#b__box',OPERATOR.USER,'PKD_DOS_PRRO') | exec('chk_role','#b__box',OPERATOR.USER,'PKD_DOS_PPRD');
_af_okr:=
   '_gray:=\'\'; '
   '{? RD_OKR.size() '
   '|| _gray+={? ~RD_OKR.DZIECI || \'Z\' || \'\' ?}; '
   '   _gray+={? RD_OKR.ZAT=\'N\' || \'\' || \'UP\' ?}; '
   '   _gray+={? RD_OKR.sel_size() || \'UP\' || {? RD_OKR.ZAT=\'N\' || \'W\' || \'UPZ\' ?} ?} '
   '|| _gray+=\'PUZW\' '
   '?}; '
   'RD_OKR.actions_grayed(\'RD_OKR\',_gray+\':\'); '+
   {? _upr
   || 'grp_disp(RD_DZ,\'WER\')'
   || '~~'
   ?};

Cntx.psh(RD,RD_OKR,RD_DZ);
RD_DZ.index('RD_DZ_OK');
:: Aktualizacja wniosku o urlop rodzicielski na podstawie nieobecności
{? exec('chk_role','#b__box',OPERATOR.USER,'PKD_EZK_ORNN')
|| exec('rd_okr_rd_okr_bfa','urlop_rodzicielski')
?};
:: Definicja okna wertowania wniosków o urlop rodzicielski
_wer:=RD_OKR.grp_make('Wnioski o urlop rodzicielski'@,,'#rd_okr_tmp',,,,,_mode);
:: Zatrudnienie u aktualnego pracodawc
RD_OKR.grp_sel(_wer,RD_OKR,'RD_OKR','Aktualne zatrudnienie'@,$_af_okr,,,15,
   "  {? _a
      || RD_OKR.index('RD_OKR_P');
         RD_OKR.prefix(P.ref())
      ?}
   ",,,1,_mode);
RD_OKR.win_fml('RD_OKR',,'OD_WN',,'ICON_BEFORE',"exec('x_zalacz_icon','zalacz')");
:: Okresy zatrudnienia u poprzednich pracodawców
RD_OKR.grp_sel(_wer,RD_OKR,'RD_STAZ','Okresy zatrudnienia'@,
   "  {? RD_OKR.size()
      || RD_DZ.prefix(RD_OKR.ref())
      || RD_DZ.prefix(null())
      ?};
      RD_OKR.actions_grayed('RD_STAZ','dpu:d');
      RD_DZ.actions_grayed('WER','du:d');
      grp_disp(RD_DZ,'WER')
   ",,,15,
   "  {? _a
      || RD_OKR.index('RD_OKR_O');
         RD_OKR.prefix(OSOBA.ref(),'N')
      ?}
   ",,,1,_mode);
RD_OKR.win_fml('RD_STAZ',,'OD_WN',,'ICON_BEFORE',"exec('x_zalacz_icon','zalacz')");
:: Dzieci
{? _upr
|| RD_OKR.grp_splt(_wer,'panel0','horizontal','panel1');
   RD_OKR.grp_sel(_wer,RD_DZ,'WER',,
      "grp_disp(RD_OKR,'RD_OKR',1,1)",,,
      5,
      "  {? {? RD_OKR.f_active() || RD_OKR.f_size() || RD_OKR.size() ?}
         || RD_DZ.prefix(RD_OKR.ref());
            RD_DZ.actions_grayed('WER',
               {? RD_OKR.STAZ | RD_OKR.ZAT='T' | RD_OKR.sel_size() || 'Du:D' |? ~RD_OKR.size() || ':D' || ':' ?}
            )
         || '#disable'
         ?}
      ",,,,
      _mode
   )
?};

RD_OKR.actions('RD_STAZ',':');
RD_OKR.win_sel(_wer);
RD_OKR.win_edit('RED');
RD_OKR.select();
Cntx.pop(RD,RD_OKR,RD_DZ);
~~


\rd_okr_rd_nd_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Formuła po edycji pola RD_ND w tabeli RD_OKR
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
RD_OKR.RD_PPRAW:=RD_OKR.RD_NB().RD_PPRAW;
~~


\rd_okr_bd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Przed akcją "Dołącz" w rejestrowanym wniosku.
::   WE: _a - [INTEGER] - 1/0 miejsce wywołania: 1 - okno RD_OKR, 0 - okno RD_STAZ.
::   WY:
::  OLD: \rd_okr_be/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_valid:=
   {? _a
   || "exec('rd_okr_rd_okr_ar','urlop_rodzicielski')"
   || "exec('rd_okr_rd_staz_ar','urlop_rodzicielski')"
   ?};

exec('rd_okr_efld','urlop_rodzicielski',_a,0);

RD_OKR.fld_fml('OD_WN','AFTER_EDIT',$('exec(\'rd_okr_efld\',\'urlop_rodzicielski\','+$_a+',0,\'OD_WN\')'));
RD_OKR.fld_fml('DO_WN','AFTER_EDIT',$('exec(\'rd_okr_efld\',\'urlop_rodzicielski\','+$_a+',0,\'DO_WN\')'));
RD_OKR.fld_fml('RD_NB','AFTER_EDIT',
               $('exec(\'rd_okr_efld\',\'urlop_rodzicielski\','+$_a+',0,\'RD_NB\');'
                 'exec(\'rd_okr_rd_nd_ae\',\'urlop_rodzicielski\')')
              );
RD_OKR.blank();
RD_OKR.ZRODLO:={? _a || 'Wniosek' || 'Okresy zatrudnienia' ?};
{? RD_OKR.edit(_valid)
|| RD_OKR.add()
?};
~~


\rd_okr_bp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Przed akcją "Popraw" w rejestrowanym wniosku.
::   WE: _a - [INTEGER] - 1/0 miejsce wywołania: 1 - okno RD_OKR, 0 - okno RD_STAZ.
::   WY:
::  OLD: \rd_okr_be/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
exec('rd_okr_efld','urlop_rodzicielski',_a,1);

RD_OKR.fld_fml('OD_WN','AFTER_EDIT',$('exec(\'rd_okr_efld\',\'urlop_rodzicielski\','+$_a+',1,\'OD_WN\')'));
RD_OKR.fld_fml('DO_WN','AFTER_EDIT',$('exec(\'rd_okr_efld\',\'urlop_rodzicielski\','+$_a+',1,\'DO_WN\')'));
RD_OKR.fld_fml('RD_NB','AFTER_EDIT',
               $('exec(\'rd_okr_efld\',\'urlop_rodzicielski\','+$_a+',1,\'RD_NB\');'
                 'exec(\'rd_okr_rd_nd_ae\',\'urlop_rodzicielski\')')
              );
RD_OKR.ZM:='P';
~~


\rd_okr_rd_okr_bu
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Formuła przed usunięciem wniosku o urlop rodzicielski z usunięciem powiązanych wierszy z tabeli RD_DZ.
::   WE:
::   WY:
::  OLD: \rd_okr_del/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
{? {? RD_OKR.sel_size() || 1 || FUN.ask('Usunąć wniosek?'@) ?}
|| RD_DZ.index('RD_DZ_OK');
   RD_DZ.prefix(RD_OKR.ref());
   {? RD_DZ.first()
   || {! |? RD_DZ.del() !}
   ?};
   {? exec('x_zalacz_icon','zalacz',,'is')
   || FUN.emsg(
         '%1\n%2'
            [  'Do wniosku jest dołączony załącznik.'@,
               'Po usunięciu wniosku załącznik pozostanie w aktach pracownika.'@
            ]
      )
   ?};
   {? RD_DZ.size()=0 || RD_OKR.del() ?}
?};
~~


\rd_okr_rd_okr_gbu
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Formuła przed grupowym usunięciem informacji o wnioskach do urlopu rodzicielskiego.
::   WE:
::   WY:
::  OLD: \rd_okr_gbdel/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
FUN.ask('Usunąć zaznaczone wnioski?'@)


\rd_okr_rd_okr_bfa
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Aktualizacja informacji o wnioskach do urlopu rodzicielskiego na podstawie nieobecności.
::   WE:
::   WY:
::  OLD: \rd_okr_akt/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
:: Nieobecności znormalizowane
_nb:=exec('nb_sql','urlop_rodzicielski');
{? var_pres('_nb')=type_of(~~)
|| FUN.emsg('%1\n%2'
      [  'Słownik nieobecności do wniosków o urlopy rodzicielskie jest pusty.'@,
         'Przed wprowadzeniem wniosku wymagane jest uzupełnienie słownika.'@
      ]
   );
   return(~~)
?};
:: Kasowanie niepowiązanych wniosków
exec('rd_okr_clr','urlop_rodzicielski',_nb);
:: Aktualizacja wniosków
exec('rd_okr_fill','urlop_rodzicielski',_nb);

Cntx.psh(RD_OKR,RD,RD_DZ);
RD_OKR.index('RD_OKR_P');
RD_OKR.prefix(P.ref());

_cz_Oj:=_cz_Ro:=_cz_Pr:=_cz_Wy:=0;
_dz_Oj:=_dz_Ro:=_dz_Pr:=_dz_Wy:='';
_wiek:=
   "  _ok:=0;
      {?  RD.DA<=RD_OKR.DO_WN
      || {? RD_OKR.RD_NB().ATR=11541 | RD_OKR.RD_NB().ATR=11542
         || __KAL.rdat(RD.DA,date(RD_OKR.DO_WN~1,12,0));
            _ok:=__KAL.year<=6
         |? RD_OKR.RD_NB().ATR=114
         || {? #RD.STNP().KOD
            || __KAL.rdat(RD.DA,RD_OKR.DO_WN);
               _ok:=__KAL.year<18
            || __KAL.rdat(RD.DA,date(RD_OKR.DO_WN~1,12,0));
               _ok:=__KAL.year<=6
            ?}
         |? RD_OKR.RD_NB().ATR=1153
         || __KAL.rdat(RD.DA,RD_OKR.DO_WN);
            {? RD.DZPRZYSP='N'
            || _ok:=__KAL.year*12+__KAL.month<=24
            || {? RD.ODROS='N'
               || {? __KAL.year<7
                  || __KAL.rdat(RD.DTPRZYSP,RD_OKR.DO_WN);
                      _ok:=__KAL.year*12+__KAL.month<=24
                  ?}
               || {? __KAL.year<10
                  || __KAL.rdat(RD.DTPRZYSP,RD_OKR.DO_WN);
                      _ok:=__KAL.year*12+__KAL.month<=24
                  ?}
               ?}
            ?}
         ?}
      ?};
      _ok
   ";

{? RD_OKR.first()
|| {!
   |? {? RD_OKR.ZM='N' | RD_OKR.ZAT='N'
      || {? ~RD_OKR.RD_PPRAW
         || RD_OKR.RD_PPRAW:=RD_OKR.RD_NB().RD_PPRAW
         ?};
:: Brak dzieci
         _rd:=null();
         _ile:=0;
         _du:=date(0,0,0);
         RD.index('_RODZINA');
         RD.prefix(RD_OKR.OSOBA);
         RD_DZ.index('RD_DZ_OK');
         RD_DZ.prefix(RD_OKR.ref());
         {? RD.last() & RD_DZ.size()=0
         || {!
            |? {? ((RD.DZPRZYSP<>'T' | RD.DTPRZYSP=#0)
                     & RD.DA<=RD_OKR.OD |  RD.DZPRZYSP='T' & RD.DTPRZYSP<>#0 & RD.DTPRZYSP<=RD_OKR.OD)
                  & +RD.STPK().KOD
                  & '11,21'*RD.STPK().KOD
                  & _wiek()
               || RD_DZ.blank();
                  RD_DZ.RD_OKR:=RD_OKR.ref();
                  RD_DZ.RD:=RD.ref();
                  {? _ile=0
                  || RD_DZ.add();
                     _ile+=1;
                     _du:={? RD.DZPRZYSP<>'T' || RD.DA || RD.DTPRZYSP ?}
                  |? _ile
                     &
                     ((RD.DZPRZYSP<>'T' | RD.DTPRZYSP=#0)
                        &
                     _du=RD.DA | RD.DZPRZYSP='T' & RD.DTPRZYSP<>#0 & _du=RD.DTPRZYSP)
                  || RD_DZ.add();
                     _ile+=1
                  ?}
               ?};
               RD.prev() & (_ile=0 | _ile & (RD.DZPRZYSP<>'T' & _du=RD.DA | RD.DZPRZYSP='T' & _du=RD.DTPRZYSP))
            !}
         ?};
         RD_OKR.DZIECI:=RD_DZ.size();
         RD_OKR.ZAT:={? RD_OKR.ZAT='T' & RD_OKR.DZIECI || 'T' || 'N' ?};
         RD_OKR.put()
      ?};
:: Częsci
      _dz_ref:='';
       RD_DZ.prefix(RD_OKR.ref());
       {? RD_DZ.first()
       || {!
          |? _dz_ref+=$RD_DZ.RD;
             RD_DZ.next()
          !}
       ?};
      _nt:=
         {? RD_OKR.RD_NB().ATR=114
         || 'Wy'
         |? RD_OKR.RD_NB().ATR=1153
         || 'Oj'
         |? RD_OKR.RD_NB().ATR=11541
         || 'Ro'
         |? RD_OKR.RD_NB().ATR=11542
         || 'Pr'
         || ''
         ?};
      _cz_zero:=RD_OKR.CZESC=0;
      {? RD_OKR.CZESC=0
      || {? _nt='Oj' & _dz_Oj=_dz_ref
         || _cz_Oj+=1;
            RD_OKR.CZESC:=_cz_Oj
         |? _nt='Oj'
         || _cz_Oj:=1;
            _dz_Oj:=_dz_ref;
            RD_OKR.CZESC:=_cz_Oj
         |? _nt='Ro' & _dz_Ro=_dz_ref
         || _cz_Ro+=1;
            RD_OKR.CZESC:=_cz_Ro
         |? _nt='Ro'
         || _cz_Ro:=1;
            _dz_Ro:=_dz_ref;
            RD_OKR.CZESC:=_cz_Ro
         |? _nt='Pr' & _dz_Pr=_dz_ref
         || _cz_Pr+=1;
            RD_OKR.CZESC:=_cz_Pr
         |? _nt='Pr'
         || _cz_Pr:=1;
            _dz_Pr:=_dz_ref;
            RD_OKR.CZESC:=_cz_Pr
         |? _nt='Wy' & _dz_Wy=_dz_ref
         || _cz_Wy+=1;
            RD_OKR.CZESC:=_cz_Wy
         |? _nt='Wy'
         || _cz_Wy:=1;
            _dz_Wy:=_dz_ref;
            RD_OKR.CZESC:=_cz_Wy
         ?}
      || {? _nt='Oj' & _cz_Oj>=RD_OKR.CZESC & _dz_Oj=_dz_ref
         || _cz_Oj+=1;
            RD_OKR.CZESC:=_cz_Oj
         |? _nt='Oj'
         || _cz_Oj:=RD_OKR.CZESC;
            _dz_Oj:=_dz_ref
         |? _nt='Ro' & _cz_Ro>=RD_OKR.CZESC & _dz_Ro=_dz_ref
         || _cz_Ro+=1;
            RD_OKR.CZESC:=_cz_Ro
         |? _nt='Ro'
         || _cz_Ro:=RD_OKR.CZESC;
            _dz_Ro:=_dz_ref
         |? _nt='Pr' & _cz_Pr>=RD_OKR.CZESC & _dz_Pr=_dz_ref
         || _cz_Pr+=1;
            RD_OKR.CZESC:=_cz_Pr
         |? _nt='Pr'
         || _cz_Pr:=RD_OKR.CZESC;
            _dz_Pr:=_dz_ref
         |? _nt='Wy' & _cz_Wy>=RD_OKR.CZESC & _dz_Wy=_dz_ref
         || _cz_Wy+=1;
            RD_OKR.CZESC:=_cz_Wy
         |? _nt='Wy'
         || _cz_Wy:=RD_OKR.CZESC;
            _dz_Wy:=_dz_ref
         ?}
      ?};
      {? RD_OKR.ZM='N' | RD_OKR.ZM='A' & RD_OKR.ZAT='N' | _cz_zero
      || {? RD_OKR.ZM='N'
         || RD_OKR.ZM:='A'
         ?};
         RD_OKR.put()
      ?};
      RD_OKR.next()
   !}
?};
Cntx.pop(RD_OKR,RD,RD_DZ);
~~


\nb_sql
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Tabela z nieobecnościami do aktualizacji.
::   WE:
::   WY:
::  OLD: \nb_sql/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_rubryki:='';
RD_NB.prefix();
{? RD_NB.first()
|| {!
   |? {? +_rubryki & _rubryki+1<>',' || _rubryki+=',' ?};
      {? RD_NB.ATR
      || _rubryki+=__RUB.sys_sql(RD_NB.ATR)
      ?};
      RD_NB.next()
   !}
?};
{? _rubryki='' || return(~~) ?};

_nb:=sql('
   select N.OD, N.DO, R.RN, N.NK, N.CU, 0 ROK, 0 MSC, 0 TYG, 0 DNI, N.REFERENCE as REF
   from N join R
   where N.KOR=\'N\' and N.P=:_a and R.RN in (:_b)
   order by 1,3',
   P.ref(),_rubryki
);

:: normalizacja - sklejanie
{? _nb.first()
|| _do:=date(0,0,0);
   _rn:=_cu:=0;
   _ref:=null();
   {!
   |? {? _ref & _nb.OD=(_do+1) & _nb.RN=_rn & (_cu=_nb.CU | ~_nb.CU)
      || _do:=_nb.DO;
         _nb.del();
         {? _nb.seek(_ref)
         || _nb.DO:=_do;
            _nb.put()
         || FUN.emsg('Błąd?')
         ?}
      || _do:=_nb.DO;
         _rn:=_nb.RN;
         _cu:=_nb.CU
      ?};
      _ref:=_nb.ref();
      _nb.NK:=_nb.DO-_nb.OD+1;
      exec('rdat','urlop_rodzicielski',_nb.OD,_nb.DO);
      _nb.ROK:=__KAL.year;
      _nb.MSC:=__KAL.year*12+__KAL.month;
      _nb.TYG:=(_nb.NK/7)#0;
      _nb.DNI:=_nb.NK;
      _nb.put();
      _nb.next()
   !}
?};
_nb


\rd_okr_clr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Kasowanie niepowiązanych wniosków.
::   WE: _a - [TABLE] - Tabela z nieobecnościami do wniosków o urlop rodzicielski.
::   WY:
::  OLD: \rd_okr_clr/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_nb:=_a;
_msg:='%1\n%2'
         [  'Do wniosku powiązanego z kasowaną nieobecnością jest dołączony załącznik.'@,
            'Po usunięciu nieobecności załącznik pozostanie w aktach pracownika.'@
         ];

Cntx.psh(RD_OKR,RD_DZ,ZALACZ);
RD_OKR.index('RD_OKR_P');
RD_OKR.prefix(P.ref());
ZALACZ.index('NAG');
{? RD_OKR.first()
|| _ref:=RD_OKR.ref();
   {!
   |? _del:=RD_OKR.N_SQL<>'';
      {? _del & _nb.first()
      || {!
         |? {? RD_OKR.N_SQL=_nb.REF & RD_OKR.OD_WN<=_nb.DO & (RD_OKR.DO_WN=#0 | RD_OKR.DO_WN>=_nb.OD)
            || _del:=0
            ?};
            _del & _nb.next()
         !}
      ?};

      ZALACZ.prefix(RD_OKR.uidref(),);
      {? _del & _ref=RD_OKR.ref()
      || RD_DZ.index('RD_DZ_OK');
         RD_DZ.prefix(RD_OKR.ref());
         {? RD_DZ.first()
         || {! |? RD_DZ.del() !}
         ?};
         {? ZALACZ.first()
         || FUN.emsg(_msg)
         ?};
         RD_OKR.del();
         RD_OKR.first()
      |? _del
      || RD_DZ.index('RD_DZ_OK');
         RD_DZ.prefix(RD_OKR.ref());
         {? RD_DZ.first()
         || {! |? RD_DZ.del() !}
         ?};
         {? ZALACZ.first()
         || FUN.emsg(_msg)
         ?};
         RD_OKR.del();
         RD_OKR.seek(_ref) & RD_OKR.next()
      |? _del=0 & RD_OKR.N_SQL=''
      || _ref:=RD_OKR.ref();
         exec('rd_okr_noref','urlop_rodzicielski');
         RD_OKR.put();
         RD_OKR.next()
      || _ref:=RD_OKR.ref();
         RD_OKR.next()
      ?}

   !}
?};
Cntx.pop(RD_OKR,RD_DZ,ZALACZ);
~~


\rd_okr_fill
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Aktualizacja informacji o wnioskach o urlop rodzicielski.
::   WE: _a - [TABLE] - Tabela z nieobecnościami do wniosków o urlop rodzicielski.
::   WY:
::  OLD: \rd_okr_fill/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
Cntx.psh(RD_OKR,RD_DZ);
_nb:=_a;
{? _nb.first()
|| RD_OKR.index('RD_OKR_P');
   RD_OKR.prefix(P.ref());
   {!
   |? {? RD_OKR.first() & RD_OKR.find_tab(1,'N_SQL',,'=',_nb.REF,'OD_WN',,'=',_nb.OD)
      || _put:=1
      |? RD_OKR.first() & RD_OKR.find_tab(1,'N_SQL',,'=',_nb.REF,'OD_WN',,'>',_nb.OD)
      || _put:=2
      |? RD_OKR.first() & RD_OKR.find_tab(1,'OD_WN',,'=',_nb.OD)
      || _put:=3
      || _put:=0
      ?};
      {? _put=0
      || RD_OKR.blank();
         RD_OKR.N_SQL:=_nb.REF
      ?};
:: Szukanie nieobecności z atrybutów
      _nb_ref:=null();
      {? RD_NB.first()
      || {!
         |? {? RD_NB.ATR & __RUB.sys_attr(_nb.RN,RD_NB.ATR)
            || _nb_ref:=RD_NB.ref()
            ?};
            _nb_ref=null() & RD_NB.next()
         !}
      ?};
:: Pomijanie/usuwanie niezdefiniowanych
      _ok:=1;
      {? _put & _nb_ref=null()
      || RD_DZ.index('RD_DZ_OK');
         RD_DZ.prefix(RD_OKR.ref());
         {? RD_DZ.first()
         || {! |? RD_DZ.del() !}
         ?};
         {? RD_DZ.size()=0 || RD_OKR.del() ?};
         _ok:=0
      |? _nb_ref=null()
      || _ok:=0
      ?};
:: Aktualizacja/dodanie rekordów
   _loop:=0;
      {!
      |? {? _ok=0
         || 'pominięcie wiersza z _nb'
         |? _put=0
         || _loop:=0;
            RD_OKR.OD_WN:=_nb.OD;
            RD_OKR.DO_WN:=_nb.DO;
            RD_OKR.OD:=_nb.OD;
            RD_OKR.DO:=_nb.DO;
            RD_OKR.ZM:='N';
            RD_OKR.R:=__RUB.ref(_nb.RN);
            RD_OKR.N_SQL:=_nb.REF;
            RD_OKR.RD_NB:=_nb_ref;
            RD_OKR.ROK:=_nb.ROK;
            RD_OKR.MIESIAC:=_nb.MSC;
            RD_OKR.TYDZIEN:=_nb.TYG;
            RD_OKR.DZIEN:=_nb.DNI
         |? _put=1 & RD_OKR.ZM='A' & RD_OKR.ZAT='N'
         || _loop:=0;
            RD_OKR.DO_WN:=_nb.DO;
            RD_OKR.OD:=_nb.OD;
            RD_OKR.DO:=_nb.DO;
            RD_OKR.R:=__RUB.ref(_nb.RN);
            RD_OKR.N_SQL:=_nb.REF;
            {? RD_OKR.RD_NB<>_nb_ref
            || RD_OKR.RD_NB:=_nb_ref;
               RD_OKR.RD_PPRAW:=RD_OKR.RD_NB().RD_PPRAW
            ?};
            RD_OKR.ROK:=_nb.ROK;
            RD_OKR.MIESIAC:=_nb.MSC;
            RD_OKR.TYDZIEN:=_nb.TYG;
            RD_OKR.DZIEN:=_nb.DNI
         |? (_put=1 | _put=3)
            &
            (RD_OKR.ZM='P' | (RD_OKR.ZM='A' & RD_OKR.ZAT='T'))
            &
            (_nb.DO<=RD_OKR.DO_WN | RD_OKR.DO_WN=#0)
         || _loop:=0;
            {? RD_OKR.DO_WN=#0
            || RD_OKR.DO_WN:=_nb.DO
            ?};
            RD_OKR.OD:=_nb.OD;
            RD_OKR.DO:=_nb.DO;
            RD_OKR.R:=__RUB.ref(_nb.RN);
            {? _put=3
            || RD_OKR.N_SQL:=_nb.REF
            ?};
            {? RD_OKR.RD_NB<>_nb_ref
            || RD_OKR.RD_NB:=_nb_ref;
               RD_OKR.RD_PPRAW:=RD_OKR.RD_NB().RD_PPRAW
            ?};
            RD_OKR.ROK:=_nb.ROK;
            RD_OKR.MIESIAC:=_nb.MSC;
            RD_OKR.TYDZIEN:=_nb.TYG;
            RD_OKR.DZIEN:=_nb.DNI
         |? (_put=1 | _put=3) & (RD_OKR.ZM='P' | (RD_OKR.ZM='A' & RD_OKR.ZAT='T')) & _nb.DO>RD_OKR.DO_WN
         || _loop:=1;
            _od:=RD_OKR.OD_WN;
            _do:=RD_OKR.DO_WN;
            _nb.OD:=RD_OKR.DO_WN+1;
            _nb.NK:=_nb.DO-_nb.OD+1;
            exec('rdat','urlop_rodzicielski',_nb.OD,_nb.DO);
            _nb.ROK:=__KAL.year;
            _nb.MSC:=__KAL.year*12+__KAL.month;
            _nb.TYG:=(_nb.NK/7)#0;
            _nb.DNI:=_nb.NK;
            _nb.put();
            _nb.OD:=_od;
            _nb.DO:=_do;
            _nb.NK:=_nb.DO-_nb.OD+1;
            exec('rdat','urlop_rodzicielski',_nb.OD,_nb.DO);
            _nb.ROK:=__KAL.year;
            _nb.MSC:=__KAL.year*12+__KAL.month;
            _nb.TYG:=(_nb.NK/7)#0;
            _nb.DNI:=_nb.NK;
            _nb.add()
         |? _put=2 & RD_OKR.ZM='A' & RD_OKR.ZAT='N'
         || _loop:=0;
            RD_OKR.OD_WN:=_nb.OD;
            RD_OKR.DO_WN:=_nb.DO;
            RD_OKR.OD:=_nb.OD;
            RD_OKR.DO:=_nb.DO;
            RD_OKR.R:=__RUB.ref(_nb.RN);
            RD_OKR.N_SQL:=_nb.REF;
            {? RD_OKR.RD_NB<>_nb_ref
            || RD_OKR.RD_NB:=_nb_ref;
               RD_OKR.RD_PPRAW:=RD_OKR.RD_NB().RD_PPRAW
            ?};
            RD_OKR.ROK:=_nb.ROK;
            RD_OKR.MIESIAC:=_nb.MSC;
            RD_OKR.TYDZIEN:=_nb.TYG;
            RD_OKR.DZIEN:=_nb.DNI
         |? _put=2 & (RD_OKR.ZM='P' | (RD_OKR.ZM='A' & RD_OKR.ZAT='T')) & _nb.OD<RD_OKR.OD_WN & _nb.DO<RD_OKR.OD_WN
         || _loop:=0;
            _put:=0;
            RD_OKR.blank();
            RD_OKR.N_SQL:=_nb.REF;
            RD_OKR.ZM:='N';
            RD_OKR.ZAT:='N';
            RD_OKR.OD_WN:=_nb.OD;
            RD_OKR.DO_WN:=_nb.DO;
            RD_OKR.OD:=_nb.OD;
            RD_OKR.DO:=_nb.DO;
            RD_OKR.R:=__RUB.ref(_nb.RN);
            {? RD_OKR.RD_NB<>_nb_ref
            || RD_OKR.RD_NB:=_nb_ref;
               RD_OKR.RD_PPRAW:=RD_OKR.RD_NB().RD_PPRAW
            ?};
            RD_OKR.ROK:=_nb.ROK;
            RD_OKR.MIESIAC:=_nb.MSC;
            RD_OKR.TYDZIEN:=_nb.TYG;
            RD_OKR.DZIEN:=_nb.DNI
         |? _put=2 & (RD_OKR.ZM='P' | (RD_OKR.ZM='A' & RD_OKR.ZAT='T')) & _nb.OD<RD_OKR.OD_WN & _nb.DO>=RD_OKR.OD_WN
         || _loop:=1;
            _od:=_nb.OD;
            _nb.OD:=RD_OKR.OD_WN;
            _nb.NK:=_nb.DO-_nb.OD+1;
            exec('rdat','urlop_rodzicielski',_nb.OD,_nb.DO);
            _nb.ROK:=__KAL.year;
            _nb.MSC:=__KAL.year*12+__KAL.month;
            _nb.TYG:=(_nb.NK/7)#0;
            _nb.DNI:=_nb.NK;
            _nb.put();
            _nb.OD:=_od;
            _nb.DO:=RD_OKR.OD_WN-1;
            _nb.NK:=_nb.DO-_nb.OD+1;
            exec('rdat','urlop_rodzicielski',_nb.OD,_nb.DO);
            _nb.ROK:=__KAL.year;
            _nb.MSC:=__KAL.year*12+__KAL.month;
            _nb.TYG:=(_nb.NK/7)#0;
            _nb.DNI:=_nb.NK;
            _nb.add()
         |? _put=3 & RD_OKR.ZM='A' & RD_OKR.ZAT='N'
         || _loop:=0;
            RD_OKR.OD_WN:=_nb.OD;
            RD_OKR.DO_WN:=_nb.DO;
            RD_OKR.OD:=_nb.OD;
            RD_OKR.DO:=_nb.DO;
            RD_OKR.R:=__RUB.ref(_nb.RN);
            RD_OKR.N_SQL:=_nb.REF;
            {? RD_OKR.RD_NB<>_nb_ref
            || RD_OKR.RD_NB:=_nb_ref;
               RD_OKR.RD_PPRAW:=RD_OKR.RD_NB().RD_PPRAW
            ?};
            RD_OKR.ROK:=_nb.ROK;
            RD_OKR.MIESIAC:=_nb.MSC;
            RD_OKR.TYDZIEN:=_nb.TYG;
            RD_OKR.DZIEN:=_nb.DNI
         ?};
         RD_OKR.ZRODLO:='Nieobecności';
         {? _loop=0 & _ok & _put
         || RD_OKR.put()
         |? _loop=0 & _ok
         || RD_OKR.ZAT:='T';
            {? RD_OKR.add()
            || exec('rd_dz_fill','urlop_rodzicielski',RD_OKR.ref(),_nb.REF)
            ?}
         ?};
:: Uzupełnianie częsci urlopu rodzicielskiego
         {? _loop=0 & _ok
         || {? RD_OKR.ZM<>'P' & _nb.CU
            || RD_OKR.CZESC:=_nb.CU
            ?};
            RD_OKR.put()
         ?};
         _loop
      !};
      _nb.next()
   !}
?};
Cntx.pop(RD_OKR,RD_DZ);
~~


\rd_okr_rd_okr_bfz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Zatwierdzenie lub wycofanie informacj o wniosku o urlop rodzicielski.
::   WE: _a - rodzaj wywołanej akcji (1/0) zatwierdzenie/wycofanie
::   WY:
::  OLD: \rd_okr_zat/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
Cntx.psh(RD_OKR,RD_DZ);
{? _a
|| RD_DZ.index('RD_DZ_OK');
   RD_DZ.prefix(RD_OKR.ref());
   {? RD_DZ.size()
   || RD_OKR.ZAT:='T'
   || FUN.emsg('Nie można zatwierdzić wniosku niepowiązanego z dziećmi pracownika.'@)
   ?}
|| RD_OKR.ZAT:='N'
?};
RD_OKR.put();
Cntx.pop(RD_OKR,RD_DZ);
~~


\rd_okr_bfc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Wyświetlenie załaczników do wniosku o urlop rodzicielski.
::   WE: _a - miejsce wywołania 'RD_OKR' lub 'RD_STAZ'
::   WY:
::  OLD: \rd_okr_zal/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
exec('show_zalacz','zalacz',
   {? RD_OKR.P<>null() || 'P' || 'OSOBA' ?},
   'RD_OKR',
   exec('chk_role','#b__box',OPERATOR.USER,{? _a='RD_OKR' || 'PKD_EZK_ORNN' || 'PKD_DOS_PRSW' ?})
);
~~


\rd_okr_rd_okr_bfl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Wyświetlenie okna legendy w oknie RD_OKR w tabeli RD_OKR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('legenda','color','URL_ROD#01#','URL_RODZ#01');
~~


\rd_okr_rd_okr_br
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Formuła "Rekord przed" w oknie RD_OKR w tabeli RD_OKR.
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::   WY:
::  OLD: \rd_okr_brec/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~RD_OKR.DZIECI
|| Color.fnd_kol('URL_ROD#01#01')
|? ~RD_OKR.R
|| Color.fnd_kol('URL_ROD#01#02')
|? RD_OKR.OD<>RD_OKR.OD_WN | RD_OKR.DO<>RD_OKR.DO_WN
|| Color.fnd_kol('URL_ROD#01#05')
|? RD_OKR.RD_PPRAW().TRESC=''
|| Color.fnd_kol('URL_ROD#01#03')
|? RD_OKR.ZAT='N'
|| Color.fnd_kol('URL_ROD#01#04')
?}


\rd_okr_rd_okr_ar
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Sprawdzenie wprowadzonych danych w oknie edycyjnym tabeli RD_OKR.
::   WE:
::   WY:
::  OLD: \rd_okr_arec/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_chk:=__CHK.record2(RD_OKR,
   'OD_WN','Od dnia'@,
   'DO_WN','Do dnia'@,
   'CZESC','Numer wniosku'@,
   'RD_NB','Rodzaj nieobecności'@
);

{? _chk=''
|| {? RD_OKR.OD_WN>RD_OKR.DO_WN
   || FUN.emsg('Data Od dnia" nie może być większa od daty "Do dnia".'@);
      _chk:='OD_WN'
   || RD_OKR.ZM:='P';
      exec('rd_okr_noref','urlop_rodzicielski')
   ?}
?};
_chk


\rd_okr_noref
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Okres bez powiązania z nieobecnościami.
::   WE:
::   WY:
::  OLD: \rd_okr_noref/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
RD_OKR.OD:=RD_OKR.OD_WN;
RD_OKR.DO:=RD_OKR.DO_WN;
{? RD_OKR.OD<>#0 & RD_OKR.DO<>#0
|| RD_OKR.DZIEN:=RD_OKR.DO-RD_OKR.OD+1;
   exec('rdat','urlop_rodzicielski',RD_OKR.OD,RD_OKR.DO);
   RD_OKR.ROK:=__KAL.year;
   RD_OKR.MIESIAC:=__KAL.year*12+__KAL.month;
   RD_OKR.TYDZIEN:=(RD_OKR.DZIEN/7)#0
|| RD_OKR.DZIEN:=RD_OKR.ROK:=RD_OKR.MIESIAC:=RD_OKR.TYDZIEN:=0
?};
~~


\rdat
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Obliczanie odstępu czasu wg Kodeksu Cywilnego
::   WE: _a - [DATE] - data początkowa zakresu
::       _b - [DATE] - data końcowa zakresu
::   WY:
::  OLD: \rdat/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_par330:=__KAL.par330;
:: Ustawienie liczenia okresów wg Kodeksu Cywilnego
__KAL.set330(1);
{? _a<>#0 & _b<>#0
|| __KAL.rdat(_a,_b)
?};
:: Przywrócenie ustawienia rdat()
 __KAL.set330(_par330);
~~


\rd_dz_wer_bfd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Dodanie dziecka do informacji o wniosku do urlopu rodzicielskiego.
::   WE:
::   WY:
::  OLD: \rd_dz_add/url_rod.fml
::  OLD: \rd_dz_be/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
RD.win_sel('SLO');
RD.index('_RODZINA');
RD.prefix(RD_OKR.OSOBA);
{? RD.select(,1,10)
|| {? RD_OKR.OD_WN<RD.DA
   || FUN.emsg('Data urodzenia dziecka jest późniejsza od daty rozpoczęcia nieobecności.'@);
      return(~~)
   ?};
   RD_DZ.blank();
   RD_DZ.RD_OKR:=RD_OKR.ref();
   RD_DZ.RD:=RD.ref();
   {? RD_DZ.add()
   || RD_OKR.ZM:='P';
      RD_OKR.DZIECI:=RD_DZ.size();
      RD_OKR.put()
   ?}
?};
~~


\rd_dz_wer_au
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Aktualizacja informacji o wniosku o urlop rodzicielski po dodaniu lub usunięciu dziecka.
::   WE:
::   WY:
::  OLD: \rd_dz_ae/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
RD_OKR.ZM:='P';
RD_OKR.DZIECI:=RD_DZ.size();
RD_OKR.put();
~~


\staz_wer_bfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Wywołanie okienka wertowania z informacjami o wnioskach o urlopy rodzicielskie w okresach zatrudnienia
::       u innego pracodawcy.
::   WE:
::   WY:
::  OLD: \rd_okr_staz/url_rod.fml
::  OLD: \rd_okr_st_gwin/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_mode:='maximized';
_upr:=exec('chk_role','#b__box',OPERATOR.USER,'PKD_DOS_PRRO') | exec('chk_role','#b__box',OPERATOR.USER,'PKD_DOS_PPRD');
_af_staz:=
   '{? '+$_upr+
   '|| RD_DZ.prefix({? RD_OKR.size() || RD_OKR.ref() || null() ?});'+
   '   RD_DZ.actions_grayed(\'WER\',{? RD_OKR.size() || \'\' || \'du:d\' ?});'+
   '   grp_disp(RD_DZ,\'WER\')'+
   '?}';

Cntx.psh(RD_OKR,RD_DZ,RD);
RD_DZ.index('RD_DZ_OK');

_wer:=RD_OKR.grp_make('Urlopy rodzicielskie'@,,'#rd_okr_st_tmp',,,,,_mode);
:: Wnioski o urlop rodzicielski
RD_OKR.grp_sel(_wer,RD_OKR,'RD_STAZ',,$_af_staz,,,20,,,,,_mode);
:: Dzieci
{? _upr
|| RD_OKR.grp_splt(_wer,,'horizontal','dzieci');
   RD_OKR.grp_sel(_wer,RD_DZ,'WER',,
      "  grp_disp(RD_OKR,'RD_STAZ')
      ",,,10,,,,,_mode
   )
?};

RD_OKR.win_fml('RD_STAZ',,'OD_WN',,'ICON_BEFORE',"exec('x_zalacz_icon','zalacz')");

RD_OKR.index('RD_OKR_S');
RD_OKR.prefix(STAZ.ref());
RD_OKR.first();
RD_OKR.actions_grayed('RD_STAZ',':');
RD_OKR.win_sel(_wer);
RD_OKR.hdr_sel();
RD_OKR.hdr_sel(' dla: %1 %2 w okresie zatrudnienia: %3 - %4'[STAZ.OSOBA().NAZWISKO,OSOBA.PIERWSZE,$STAZ.DR,$STAZ.DZ]);
RD_OKR.win_edit('RED');
RD_OKR.select();
RD_OKR.hdr_sel();
Cntx.pop(RD_OKR,RD_DZ,RD);
VAR_DEL.delete('__ctr_acr');
~~


\rd_okr_rd_staz_ar
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PK [12.41]
:: OPIS: Formuła na rekord po dla RD_OKR edycja od strony okresów zatrudnienia.
::   WE:
::   WY:
::  OLD: \rd_okr_st_arec/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
{? RD_OKR.RD_NB().ATR=1153
|| _chk:=__CHK.record2(RD_OKR,'RD_NB','Rodzaj nieobecności'@)
|| _chk:=__CHK.record2(RD_OKR,'OD_WN','Od dnia'@,'DO_WN','Do dnia'@,'RD_NB','Rodzaj nieobecności'@)
?};

{? +_chk
|| return(_chk)
?};
{? RD_OKR.OD_WN>RD_OKR.DO_WN & RD_OKR.OD_WN<>date(0,0,0)
|| FUN.emsg('Wartość w polu "Od dnia" nie może być większa od wartości w polu "Do dnia"'@);
   return('OD_WN')
?};
_msg:='%1\n%2'
   [  'Nieprawidłowa wartość w polu "Od dnia" lub w polu "Do dnia".'@,
      'Wniosek musi dotyczyć okresu mieszczącego się w obrębie wybranego okresu zatrudnienia.'@
   ];
{? (RD_OKR.OD_WN<STAZ.DR | RD_OKR.OD_WN>STAZ.DZ) & RD_OKR.OD_WN<>date(0,0,0)
|| FUN.emsg(_msg);
   return('OD_WN')
?};
{? (RD_OKR.DO_WN<STAZ.DR | RD_OKR.DO_WN>STAZ.DZ) & RD_OKR.DO_WN<>date(0,0,0)
|| FUN.emsg(_msg);
   return('DO_WN')
?};

RD_OKR.ZM:='P';
RD_OKR.PRAC:='N';
RD_OKR.P:=null();
RD_OKR.STAZ:=STAZ.ref();
RD_OKR.OD:=RD_OKR.OD_WN;
RD_OKR.DO:=RD_OKR.DO_WN;
exec('rdat','urlop_rodzicielski',RD_OKR.OD,RD_OKR.DO);
{? RD_OKR.OD_WN<>#0 & RD_OKR.DO_WN<>#0
|| RD_OKR.DZIEN:=RD_OKR.DO-RD_OKR.OD+1;
   RD_OKR.ROK:=__KAL.year;
   RD_OKR.MIESIAC:=__KAL.year*12+__KAL.month;
   RD_OKR.TYDZIEN:=(RD_OKR.DZIEN/7)#0
|| {? RD_OKR.DZIEN<>0 & RD_OKR.TYDZIEN<>0
   || {? RD_OKR.TYDZIEN*7<>RD_OKR.DZIEN
      || FUN.emsg('Wprowadzona liczba tygodni nie odpowiada liczbie dni.');
         return('TYDZIEN')
      ?}
   |? RD_OKR.TYDZIEN<>0
   || RD_OKR.DZIEN:=RD_OKR.TYDZIEN*7
   |? RD_OKR.DZIEN<>0
   || RD_OKR.TYDZIEN:=(RD_OKR.DZIEN/7)#0
   |? RD_OKR.DZIEN=0 & RD_OKR.TYDZIEN=0 & RD_OKR.MIESIAC=0 & RD_OKR.ROK=0 & (RD_OKR.OD_WN=#0 | RD_OKR.DO_WN=#0)
   || FUN.emsg('Należy wprowadzić czas trwania urlopu.');
      return('TYDZIEN')
   ?}
?};
~~


\rd_okr_rd_staz_bfl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Wyświetlenie okna legendy w oknie RD_STAZ w tabeli RD_OKR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('legenda','color','URL_ROD#01#01','URL_ROD#01#03','URL_RODZ#01');
~~


\rd_okr_rd_staz_br
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Formuła "Rekord przed" w oknie RD_STAZ w tabeli RD_OKR.
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~RD_OKR.DZIECI
|| Color.fnd_kol('URL_ROD#01#01')
|? RD_OKR.RD_PPRAW().TRESC=''
|| Color.fnd_kol('URL_ROD#01#03')
?}


\sel_rd_ppraw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Wyświetlenie słownika z podstawą prawną urlopu rodzicielskiego.
::   WE:
::   WY:
::  OLD: \rd_okr_par/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
RD_PPRAW.index('P_PRAWNA');
RD_PPRAW.prefix();
RD_PPRAW.win_edit('RED');
RD_PPRAW.win_sel('WER');
RD_PPRAW.select();
~~


\rd_ppraw_wer_bfi
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Import wartości do słownika podstaw prawnych.
::   WE:
::   WY:
::  OLD: \rd_okr_par/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
exec('podstawa_prawna','urlop_rodzicielski',1);
~~


\sel_rd_nb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Wyświetlenie słownika nieobecności dla urlopu rodzicielskiego.
::   WE:
::   WY:
::  OLD: \rd_okr_par/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
RD_NB.index('RD_NB');
RD_NB.prefix();
RD_NB.win_edit('RED');
RD_NB.win_sel('WER');
RD_NB.select();
exec('chk_nb','urlop_rodzicielski');
~~


\chk_nb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MKG [12.41]
:: OPIS: Sprawdzenie słownika RD_NB pod kątem obsługiwanych atrybutów.
::       Generowany jest ewentualny komunikat ostrzegawczy o potencjalnych nieprawidłowościach.
::   WE:
::   WY:
::  OLD: \chk_nb/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_msg:='';
{? RD_NB.first()
|| {!
   |? {? RD_NB.ATR=114 | RD_NB.ATR=1153 | RD_NB.ATR=11541 | RD_NB.ATR=11542
      || ''
      || _msg+=RD_NB.RT+', '
      ?};
      RD_NB.next()
   !}
?};
{? +_msg
|| FUN.emsg(
   'Nieobecności rodzicielskie: %1 posiadają atrybuty nie uwzględnione przy obsłudze nieobecności rodzicielskich.'@
      [(_msg-2)]+'\n'+
   'Może doprowadzić to do nieprawidłowej pracy programu.'@
   )
?};
~~


\rd_nb_wer_bfi
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [18.22]
:: OPIS: Import wartości do słownika nieobecności.
::   WE:
::   WY:
::  OLD: \rd_okr_par/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
exec('nieobecnosci','urlop_rodzicielski');
~~


\nieobecnosci
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Definicja zawartości słownika zawierającego rodzaje nieobecności.
::   WE:
::   WY:
::  OLD: \get_nb/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
RD_PPRAW.index('P_PRAWNA');
RD_PPRAW.prefix();

RD_NB.blank(1);
RD_NB.RT:='Ojcowski';
{? ~RD_NB.find_rec()
|| RD_NB.ATR:=1153;
   {? RD_PPRAW.find_key('Oj','182','3','','',)
   || RD_NB.RD_PPRAW:=RD_PPRAW.ref()
   ?};
   RD_NB.add(1)
?};

RD_NB.blank(1);
RD_NB.RT:='Rodzicielski';
{? ~RD_NB.find_rec()
|| RD_NB.ATR:=11541;
   {? RD_PPRAW.find_key('Ro','182','1a','1','1',)
   || RD_NB.RD_PPRAW:=RD_PPRAW.ref()
   ?};
   RD_NB.add(1)
?};

RD_NB.blank(1);
RD_NB.RT:='Rodzicielski praca';
{? ~RD_NB.find_rec()
|| RD_NB.ATR:=11542;
   {? RD_PPRAW.find_key('Ro','182','1f','','',)
   || RD_NB.RD_PPRAW:=RD_PPRAW.ref()
   ?};
   RD_NB.add(1)
?};

RD_NB.blank(1);
RD_NB.RT:='Wychowawczy';
{? ~RD_NB.find_rec()
|| RD_NB.ATR:=114;
   {? RD_PPRAW.find_key('Wy','186','', '2','',)
   || RD_NB.RD_PPRAW:=RD_PPRAW.ref()
   ?};
   RD_NB.add(1)
?};
~~


\podstawa_prawna
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MirPi [12.41_63]
:: OPIS: Definicja zawartości słownika zawierającego podstawę prawną uzyskania urlopu rodzicielskiego.
::   WE: [_a][INTEGER] - 0*/1 - Czy komunikowanie? domyślnie 0 - bez komunikatów
::   WY:
::  OLD: \get_pp/url_rod.fml
::----------------------------------------------------------------------------------------------------------------------
_kom:={? var_pres('_a')=type_of(0) || _a || 0 ?};
_mydo:=do_state()=0;
{? _mydo & _kom & ~FUN.ask('%1\n%2'
      ['Nastąpi nadpisanie i uzupełnienie istniejących zapisów zapisami standardowymi.'@,'Czy kontynuować?'@])
|| return(0)
?};
RD_PPRAW.cntx_psh();
{? _mydo || do() ?};
_memo_fld:='OPIS';
_add:=
   "  _a.prefix();
      {? ~_a.find_key(_c,_d,_e,_f,)
      || _a.blank();
         _a.LP:=_b;
         _a.ARTYKUL:=_c;
         _a.ART_NDX:=_d;
         _a.PARAGRAF:=_e;
         _a.PUNKT:=_f;
         _a.TRESC:=_g;
         _a.memo_set(_h,_i);
         {? _a.add(1) || _a.memo_put(,_i) ?}
      || _a.LP:=_b;
         _a.ARTYKUL:=_c;
         _a.ART_NDX:=_d;
         _a.PARAGRAF:=_e;
         _a.PUNKT:=_f;
         _a.TRESC:=_g;
         _a.memo_set(_h,_i);
         {? _a.put(1) || _a.memo_put(,_i) ?}
      ?}
   ";

RD_PPRAW.index('P_PRAW_U');
:: Wypełnienie zawartości słownika podstaw prawnych
_add(RD_PPRAW,
   'Ro',
   '179',
   '1',
   '',
   '',
   'art. 179(1) Kodeksu pracy',
   'Art. 179(1) Uchylony od dnia 26 kwietnia 2023r. zgodnie z ustawą.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '179',
   '1',
   '1',
   '',
   'art. 179(1) § 1 Kodeksu pracy',
   'Art. 179(1) Uchylony od dnia 26 kwietnia 2023r. zgodnie z ustawą.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '180',
   '',
   '1',
   '1',
   'art. 180 § 1 pkt 1 Kodeksu pracy',
   'Art. 180. § 1. Pracownicy przysługuje urlop macierzyński w wymiarze:\n'
   '1) 20 tygodni w przypadku urodzenia jednego dziecka przy jednym porodzie;',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '180',
   '',
   '1',
   '2',
   'art. 180 § 1 pkt 2 Kodeksu pracy',
   'Art. 180. § 1. Pracownicy przysługuje urlop macierzyński w wymiarze:\n'
   '2) 31 tygodni w przypadku urodzenia dwojga dzieci przy jednym porodzie;',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '180',
   '',
   '1',
   '3',
   'art. 180 § 1 pkt 3 Kodeksu pracy',
   'Art. 180. § 1. Pracownicy przysługuje urlop macierzyński w wymiarze:\n'
   '3) 33 tygodni – w przypadku urodzenia trojga dzieci przy jednym porodzie,',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '180',
   '',
   '1',
   '4',
   'art. 180 § 1 pkt 4 Kodeksu pracy',
   'Art. 180. § 1. Pracownicy przysługuje urlop macierzyński w wymiarze:\n'
   '4) 35 tygodni – w przypadku urodzenia czworga dzieci przy jednym porodzie,',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '180',
   '',
   '1',
   '5',
   'art. 180 § 1 pkt 5 Kodeksu pracy',
   'Art. 180. § 1. Pracownicy przysługuje urlop macierzyński w wymiarze:\n'
   '5) 37 tygodni w przypadku urodzenia pięciorga i więcej dzieci przy jednym porodzie.',
   _memo_fld
);

_add(RD_PPRAW,
   'Oj',
   '182',
   '3',
   '',
   '',
   'art. 182(3) Kodeksu pracy',
   'Art. 182(3).\n'
   '§ 1. W celu sprawowania opieki nad dzieckiem pracownik - ojciec ma prawo do urlopu ojcowskiego w wymiarze '
   'do 2 tygodni, nie dłużej jednak niż do:\n'
   '1) ukończenia przez dziecko 12 miesiąca życia albo\n'
   '2) upływu 12 miesięcy od dnia uprawomocnienia się postanowienia orzekającego przysposobienie dziecka i '
   'nie dłużej niż do ukończenia przez dziecko 14 roku życia.\n'
   '§ 1(1). Urlop ojcowski może być wykorzystany jednorazowo albo nie więcej niż w 2 częściach, z których '
   'żadna nie może być krótsza niż tydzień.\n'
   '§ 2. Urlop ojcowski jest udzielany na wniosek w postaci papierowej lub elektronicznej składany przez '
   'pracownika - ojca w terminie nie krótszym niż 7 dni przed rozpoczęciem korzystania z urlopu. Do wniosku '
   'dołącza się dokumenty określone w przepisach wydanych na podstawie art. 186(8a). Pracodawca jest '
   'obowiązany uwzględnić wniosek pracownika.\n'
   '§ 3. Do urlopu ojcowskiego stosuje się odpowiednio przepisy art. 45 § 3, art. 47, art. 57 § 2, '
   'art. 163 § 3, art. 165 pkt 4, art. 166 pkt 4, art. 181 i art. 183(1) § 1.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1a',
   '',
   '',
   'art. 182(1a) Kodeksu pracy',
   'art. 182(1a) Kodeksu pracy - Urlop rodzicielski\n'
   'Art. 182(1a).\n'
   '§ 1. Pracownicy - rodzice dziecka mają prawo do urlopu rodzicielskiego w celu sprawowania '
   'opieki nad dzieckiem w wymiarze do:\n'
   '1) 41 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;\n'
   '2) 43 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.\n'
   '§ 2. Pracownicy - rodzice dziecka posiadającego zaświadczenie, o którym mowa w art. 4 '
   'ust. 3 ustawy z dnia 4 listopada 2016 r. o wsparciu kobiet w ciąży i rodzin "Za życiem", '
   'mają prawo do urlopu rodzicielskiego w celu sprawowania opieki nad tym dzieckiem '
   'w wymiarze do:\n'
   '1) 65 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;\n'
   '2) 67 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.\n'
   '§ 3. Urlop rodzicielski w wymiarze, o którym mowa w § 1 i 2, przysługuje łącznie obojgu '
   'pracownikom - rodzicom dziecka.\n'
   '§ 4. Każdemu z pracowników - rodziców dziecka przysługuje wyłączne prawo do 9 tygodni '
   'urlopu rodzicielskiego z wymiaru urlopu określonego w § 1 i 2. Prawa tego nie można przenieść '
   'na drugiego z pracowników - rodziców dziecka.\n'
   '§ 5. Skorzystanie z urlopu rodzicielskiego w wymiarze co najmniej 9 tygodni oznacza '
   'wykorzystanie przez pracownika - rodzica dziecka urlopu, o którym mowa w § 4.\n'
   '§ 7. W okresie pobierania przez jednego z rodziców dziecka zasiłku macierzyńskiego za okres '
   'odpowiadający okresowi urlopu rodzicielskiego drugi rodzic może korzystać z urlopu '
   'rodzicielskiego. W takim przypadku łączny wymiar urlopu rodzicielskiego i okresu pobierania '
   'zasiłku macierzyńskiego za okres odpowiadający okresowi urlopu rodzicielskiego nie może '
   'przekraczać wymiaru, o którym mowa w § 1 albo 2.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1a',
   '1',
   '1',
   'art. 182(1a) § 1 pkt 1 Kodeksu pracy',
   'Art. 182(1a) Kodeksu pracy - Urlop rodzicielski (ust. 6 pkt 5 świadectwa)\n'
   'Art. 182(1a).\n'
   '§ 1. Pracownicy - rodzice dziecka mają prawo do urlopu rodzicielskiego\n'
   'w celu sprawowania opieki nad dzieckiem w wymiarze do:\n'
   '1) 41 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1a',
   '1',
   '2',
   'art. 182(1a) § 1 pkt 2 Kodeksu pracy',
   'Art. 182(1a) Kodeksu pracy - Urlop rodzicielski (ust. 6 pkt 5 świadectwa)\n'
   'Art. 182(1a).\n'
   '§ 1. Pracownicy - rodzice dziecka mają prawo do urlopu rodzicielskiego '
   'w celu sprawowania opieki nad dzieckiem w wymiarze do:\n'
   '2) 43 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1a',
   '2',
   '1',
   'art. 182(1a) § 2 pkt 1 Kodeksu pracy',
   'Art. 182(1a) Kodeksu pracy - Urlop rodzicielski (ust. 6 pkt 5 świadectwa)\n'
   'Art. 182(1a).\n'
   '§ 2. Pracownicy - rodzice dziecka posiadającego zaświadczenie, o którym mowa w '
   'art. 4 ust. 3 ustawy z dnia 4 listopada 2016 r. o wsparciu kobiet w ciąży i rodzin '
   '"Za życiem", mają prawo do urlopu rodzicielskiego w celu sprawowania opieki nad tym '
   'dzieckiem w wymiarze do:\n'
   '1) 65 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1a',
   '2',
   '2',
   'art. 182(1a) § 2 pkt 2 Kodeksu pracy',
   'Art. 182(1a) Kodeksu pracy - Urlop rodzicielski (ust. 6 pkt 5 świadectwa)\n'
   'Art. 182(1a).\n'
   '§ 2. Pracownicy - rodzice dziecka posiadającego zaświadczenie, o którym mowa w art. '
   '4 ust. 3 ustawy z dnia 4 listopada 2016 r. o wsparciu kobiet w ciąży i rodzin "Za życiem", '
   'mają prawo do urlopu rodzicielskiego w celu sprawowania opieki nad tym dzieckiem '
   'w wymiarze do:\n'
   '2) 67 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1a',
   '4',
   '',
   'art. 182(1a) § 4 Kodeksu pracy',
   'Art. 182(1a) Kodeksu pracy - Urlop rodzicielski (ust. 6 pkt 5 świadectwa)\n'
   'Art. 182(1a).\n'
   '§ 4. Każdemu z pracowników - rodziców dziecka przysługuje wyłączne prawo do 9 tygodni '
   'urlopu rodzicielskiego  z wymiaru urlopu określonego w § 1 i 2. Prawa tego nie można '
   'przenieść na drugiego z pracowników - rodziców dziecka.\n'
   '§ 5. Skorzystanie z urlopu rodzicielskiego w wymiarze co najmniej 9 tygodni oznacza '
   'wykorzystanie przez pracownika - rodzica dziecka urlopu, o którym mowa w § 4.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1c',
   '',
   '',
   'art. 182(1c) Kodeksu pracy',
   'Art. 182(1c).\n'
   'Urlop rodzicielski jest udzielany jednorazowo albo nie więcej niż w 5 częściach\n'
   'nie później niż do zakończenia roku kalendarzowego, w którym dziecko kończy 6 rok życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1c',
   '3',
   '',
   'art. 182(1c) § 3 Kodeksu pracy',
   'Art. 182(1c). Uchylony od dnia 26 kwietnia 2023r. zgodnie z ustawą.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1d',
   '',
   '',
   'art. 182(1d) Kodeksu pracy',
   'art. 182(1d).\n'
   '§ 1. Urlop rodzicielski jest udzielany na wniosek w postaci papierowej lub elektronicznej '
   'składany przez pracownika - rodzica dziecka w terminie nie krótszym niż 21 dni przed '
   'rozpoczęciem korzystania z urlopu. Do wniosku dołącza się dokumenty określone w przepisach '
   'wydanych na podstawie art. 186(8a). Pracodawca jest obowiązany uwzględnić wniosek pracownika.\n'
   '§ 2. Liczbę części urlopu ustala się w oparciu o liczbę złożonych wniosków o udzielenie '
   'urlopu. W liczbie wykorzystanych części urlopu uwzględnia się także liczbę wniosków o zasiłek '
   'macierzyński za okres odpowiadający okresowi urlopu rodzicielskiego albo jego części, '
   'złożonych przez ubezpieczoną - matkę dziecka lub ubezpieczonego - ojca dziecka.\n'
   '§ 3. Pracownik może zrezygnować z korzystania z urlopu rodzicielskiego w każdym czasie za '
   'zgodą pracodawcy i powrócić do pracy.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1f',
   '',
   '',
   'art. 182(1f) Kodeksu pracy',
   'Art. 182(1f).\n'
   '§ 1. W przypadku łączenia przez pracownika - rodzica dziecka korzystania z urlopu '
   'rodzicielskiego z wykonywaniem pracy u pracodawcy udzielającego tego urlopu wymiar '
   'urlopu rodzicielskiego ulega wydłużeniu proporcjonalnie do wymiaru czasu pracy '
   'wykonywanej przez pracownika w trakcie korzystania z urlopu lub jego części, nie '
   'dłużej jednak niż do:\n'
   '1) 82 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;\n'
   '2) 86 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.\n'
   '§ 1(1). W przypadku łączenia przez pracownika - rodzica dziecka posiadającego '
   'zaświadczenie, o którym mowa w art. 4 ust. 3 ustawy z dnia 4 listopada 2016 r. o '
   'wsparciu kobiet w ciąży i rodzin "Za życiem", korzystania z urlopu rodzicielskiego z '
   'wykonywaniem pracy u pracodawcy udzielającego tego urlopu wymiar urlopu rodzicielskiego '
   'ulega wydłużeniu proporcjonalnie do wymiaru czasu pracy wykonywanej przez pracownika '
   '- rodzica dziecka w trakcie korzystania z urlopu lub jego części, nie dłużej jednak '
   'niż do:\n'
   '1) 130 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;\n'
   '2) 134 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1f',
   '1',
   '1',
   'art. 182(1f) § 1 pkt 1 Kodeksu pracy',
   'Art. 182 1f.§ 1.\n'
   'W przypadku łączenia przez pracownika - rodzica dziecka korzystania z urlopu '
   'rodzicielskiego z wykonywaniem pracy u pracodawcy udzielającego tego urlopu wymiar '
   'urlopu rodzicielskiego ulega wydłużeniu proporcjonalnie do wymiaru czasu pracy '
   'wykonywanej przez pracownika w trakcie korzystania z urlopu lub jego części, '
   'nie dłużej jednak niż do:\n'
   '1) 82 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1f',
   '1',
   '2',
   'art. 182(1f) § 1 pkt 2 Kodeksu pracy',
   'Art. 182 1f.§ 1.\n'
   'W przypadku łączenia przez pracownika - rodzica dziecka korzystania z urlopu '
   'rodzicielskiego z wykonywaniem pracy u pracodawcy udzielającego tego urlopu wymiar '
   'urlopu rodzicielskiego ulega wydłużeniu proporcjonalnie do wymiaru czasu pracy '
   'wykonywanej przez pracownika w trakcie korzystania z urlopu lub jego części, '
   'nie dłużej jednak niż do:\n'
   '2) 86 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1f',
   '1(1)',
   '1',
   'art. 182(1f) § 1(1) pkt 1 Kodeksu pracy',
   'Art. 182 1f.\n'
   '§ 1(1). W przypadku łączenia przez pracownika - rodzica dziecka posiadającego '
   'zaświadczenie, o którym mowa w art. 4 ust. 3 ustawy z dnia 4 listopada 2016 r. o '
   'wsparciu kobiet w ciąży i rodzin "Za życiem", korzystania z urlopu rodzicielskiego '
   'z wykonywaniem pracy u pracodawcy udzielającego tego urlopu wymiar urlopu '
   'rodzicielskiego ulega wydłużeniu proporcjonalnie do wymiaru czasu pracy wykonywanej '
   'przez pracownika - rodzica dziecka w trakcie korzystania z urlopu lub jego części, '
   'nie dłużej jednak niż do:\n'
   '1) 130 tygodni - w przypadku, o którym mowa w art. 180 § 1 pkt 1;',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '182',
   '1f',
   '1(1)',
   '2',
   'art. 182(1f) § 1(1) pkt 2 Kodeksu pracy',
   'Art. 182 1f.\n'
   '§ 1(1). W przypadku łączenia przez pracownika - rodzica dziecka posiadającego '
   'zaświadczenie, o którym mowa w art. 4 ust. 3 ustawy z dnia 4 listopada 2016 r. o '
   'wsparciu kobiet w ciąży i rodzin "Za życiem", korzystania z urlopu rodzicielskiego '
   'z wykonywaniem pracy u pracodawcy udzielającego tego urlopu wymiar urlopu '
   'rodzicielskiego ulega wydłużeniu proporcjonalnie do wymiaru czasu pracy wykonywanej '
   'przez pracownika - rodzica dziecka w trakcie korzystania z urlopu lub jego części, '
   'nie dłużej jednak niż do:\n'
   '2) 134 tygodni - w przypadkach, o których mowa w art. 180 § 1 pkt 2-5.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '',
   '',
   'art. 183 Kodeksu pracy',
   'Art. 183.\n'
   '§ 1. Pracownik, który przyjął dziecko na wychowanie jako rodzina zastępcza, z wyjątkiem '
   'rodziny zastępczej zawodowej, ma prawo do urlopu na warunkach urlopu macierzyńskiego '
   'w wymiarze:\n'
   '1) 20 tygodni - w przypadku przyjęcia jednego dziecka,\n'
   '2) 31 tygodni - w przypadku jednoczesnego przyjęcia dwojga dzieci,\n'
   '3) 33 tygodni - w przypadku jednoczesnego przyjęcia trojga dzieci,\n'
   '4) 35 tygodni - w przypadku jednoczesnego przyjęcia czworga dzieci,\n'
   '5) 37 tygodni - w przypadku jednoczesnego przyjęcia pięciorga i więcej dzieci\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 7 roku życia, a w przypadku dziecka, '
   'wobec którego podjęto decyzję o odroczeniu obowiązku szkolnego, nie dłużej niż do ukończenia '
   'przez nie 10 roku życia.\n'
   '§ 1(1). Pracownik, który przyjął dziecko na wychowanie i wystąpił do sądu opiekuńczego '
   'z wnioskiem o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do urlopu '
   'na warunkach urlopu macierzyńskiego w wymiarze:\n'
   '1) 20 tygodni - w przypadku przyjęcia jednego dziecka,\n'
   '2) 31 tygodni - w przypadku jednoczesnego przyjęcia dwojga dzieci,\n'
   '3) 33 tygodni - w przypadku jednoczesnego przyjęcia trojga dzieci,\n'
   '4) 35 tygodni - w przypadku jednoczesnego przyjęcia czworga dzieci,\n'
   '5) 37 tygodni - w przypadku jednoczesnego przyjęcia pięciorga i więcej dzieci\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 14 roku życia.\n'
   '§ 2. Do urlopu na warunkach urlopu macierzyńskiego przepisy art. 45 § 3, art. 47, art. 57 § 2, '
   'art. 163 § 3, art. 165 pkt 4, art. 166 pkt 4, art. 180 § 4-17, art. 180(1) § 2 i art. 181 '
   'stosuje się odpowiednio.\n'
   '§ 3. Pracownik, o którym mowa w § 1, który przyjął dziecko w wieku do 7 roku życia, a w przypadku '
   'dziecka, wobec którego podjęto decyzję o odroczeniu obowiązku szkolnego, do 10 roku życia, oraz '
   'pracownik, o którym mowa w § 1(1), który przyjął dziecko w wieku do 14 roku życia - ma prawo '
   'do 9 tygodni urlopu na warunkach urlopu macierzyńskiego.\n'
   '§ 4. Pracownicy, którzy przyjęli dziecko na wychowanie jako rodzina zastępcza, z wyjątkiem '
   'rodziny zastępczej zawodowej, mają prawo do urlopu rodzicielskiego w celu sprawowania opieki nad '
   'tym dzieckiem w wymiarze do:\n'
   '1) 41 tygodni - w przypadku, o którym mowa w § 1 pkt 1;\n'
   '2) 43 tygodni - w przypadkach, o których mowa w § 1 pkt 2-5;\n'
   '3) 38 tygodni - w przypadku, o którym mowa w § 3.\n'
   '§ 4(1). Pracownicy, którzy przyjęli dziecko na wychowanie i wystąpili do sądu opiekuńczego '
   'z wnioskiem o wszczęcie postępowania w sprawie przysposobienia dziecka, mają prawo do urlopu '
   'rodzicielskiego w celu sprawowania opieki nad tym dzieckiem w wymiarze do:\n'
   '1) 41 tygodni - w przypadku, o którym mowa w § 1(1) pkt 1,\n'
   '2) 43 tygodni - w przypadkach, o których mowa w § 1(1) pkt 2-5\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 14 roku życia.\n'
   '§ 4(2). Pracownicy, o których mowa w § 3, którzy przyjęli na wychowanie dziecko w wieku do '
   'ukończenia 14 roku życia, mają prawo do 38 tygodni urlopu rodzicielskiego.\n'
   '§ 4(3). Pracownicy, o których mowa w § 4, w przypadku dziecka posiadającego zaświadczenie, '
   'o którym mowa w art. 4 ust. 3 ustawy z dnia 4 listopada 2016 r. o wsparciu kobiet w ciąży i '
   'rodzin "Za życiem", mają prawo do urlopu rodzicielskiego w celu sprawowania opieki nad tym '
   'dzieckiem w wymiarze do:\n'
   '1) 65 tygodni - w przypadku, o którym mowa w § 1 pkt 1;\n'
   '2) 67 tygodni - w przypadkach, o których mowa w § 1 pkt 2-5;\n'
   '3) 62 tygodni - w przypadku, o którym mowa w § 3.\n'
   '§ 4(4). Pracownicy, o których mowa w § 4(1), w przypadku dziecka posiadającego zaświadczenie, '
   'o którym mowa w art. 4 ust. 3 ustawy z dnia 4 listopada 2016 r. o wsparciu kobiet w ciąży i '
   'rodzin "Za życiem", mają prawo do urlopu rodzicielskiego w celu sprawowania opieki nad tym '
   'dzieckiem w wymiarze do:\n'
   '1) 65 tygodni - w przypadku, o którym mowa w § 1(1) pkt 1,\n'
   '2) 67 tygodni - w przypadkach, o których mowa w § 1(1) pkt 2-5\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 14 roku życia.\n'
   '§ 4(5). Pracownicy, o których mowa w § 3, którzy przyjęli na wychowanie dziecko w wieku do '
   'ukończenia 14 roku życia, w przypadku dziecka posiadającego zaświadczenie, o którym mowa w '
   'art. 4 ust. 3 ustawy z dnia 4 listopada 2016 r. o wsparciu kobiet w ciąży i rodzin "Za życiem", '
   'mają prawo do 62 tygodni urlopu rodzicielskiego.\n'
   '§ 4(6). Urlop rodzicielski jest udzielany jednorazowo albo nie więcej niż w 5 częściach.\n'
   '§ 5. Do urlopu rodzicielskiego stosuje się odpowiednio przepisy art. 182(1a) § 3-7 i '
   'art. 182(1c)-182(1g).\n'
   '§ 6. Urlop na warunkach urlopu macierzyńskiego jest udzielany na wniosek w postaci papierowej '
   'lub elektronicznej składany przez pracownika w terminie 7 dni od dnia przyjęcia dziecka na '
   'wychowanie jako rodzina zastępcza albo przyjęcia dziecka na wychowanie i wystąpienia do sądu '
   'opiekuńczego z wnioskiem o wszczęcie postępowania w sprawie przysposobienia dziecka. Urlop '
   'rozpoczyna się w terminie określonym we wniosku pracownika, jednak nie później niż 21 dni '
   'od dnia odpowiednio przyjęcia dziecka na wychowanie jako rodzina zastępcza albo przyjęcia dziecka '
   'na wychowanie i wystąpienia do sądu opiekuńczego z wnioskiem o wszczęcie postępowania w sprawie '
   'przysposobienia dziecka. Do wniosku dołącza się dokumenty określone w przepisach wydanych na '
   'podstawie art. 186(8a). Pracodawca jest obowiązany uwzględnić wniosek pracownika.\n'
   '§ 7. Pracownik, który korzysta lub korzystał z urlopu na warunkach urlopu macierzyńskiego w '
   'związku z przyjęciem dziecka na wychowanie jako rodzina zastępcza, a następnie wystąpił do sądu '
   'opiekuńczego z wnioskiem o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do '
   'urlopu na warunkach urlopu macierzyńskiego w związku z wystąpieniem do sądu opiekuńczego z '
   'wnioskiem o wszczęcie postępowania w sprawie przysposobienia dziecka w wymiarze określonym '
   'w § 1(1) obniżonym o wykorzystany urlop na warunkach urlopu macierzyńskiego w związku z przyjęciem '
   'dziecka na wychowanie jako rodzina zastępcza.\n'
   '§ 8. Pracownik, który korzysta lub korzystał z urlopu rodzicielskiego w związku z przyjęciem '
   'dziecka na wychowanie jako rodzina zastępcza, a następnie wystąpił do sądu opiekuńczego z '
   'wnioskiem o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do urlopu '
   'rodzicielskiego w związku z wystąpieniem do sądu opiekuńczego z wnioskiem o wszczęcie postępowania '
   'w sprawie przysposobienia dziecka w wymiarze określonym w § 4(1) albo 4(2) albo § 4(4) albo 4(5), '
   'obniżonym o wykorzystany urlop rodzicielski w związku z przyjęciem dziecka na wychowanie '
   'jako rodzina zastępcza.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1',
   '1',
   'art. 183 § 1 pkt 1 Kodeksu pracy',
   'Art. 183.\n'
   '§ 1. Pracownik, który przyjął dziecko na wychowanie jako rodzina zastępcza, z '
   'wyjątkiem rodziny zastępczej zawodowej, ma prawo do urlopu na warunkach urlopu '
   'macierzyńskiego w wymiarze:\n'
   '1) 20 tygodni - w przypadku przyjęcia jednego dziecka,\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 7 roku życia, a w przypadku dziecka, '
   'wobec którego podjęto decyzję o odroczeniu obowiązku szkolnego, nie dłużej niż do '
   'ukończenia przez nie 10 roku życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1',
   '2',
   'art. 183 § 1 pkt 2 Kodeksu pracy',
   'Art. 183.\n'
   '§ 1. Pracownik, który przyjął dziecko na wychowanie jako rodzina zastępcza, z '
   'wyjątkiem rodziny zastępczej zawodowej, ma prawo do urlopu na warunkach urlopu '
   'macierzyńskiego w wymiarze:\n'
   '2) 31 tygodni - w przypadku jednoczesnego przyjęcia dwojga dzieci,\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 7 roku życia, a w przypadku dziecka, '
   'wobec którego podjęto decyzję o odroczeniu obowiązku szkolnego, nie dłużej niż do '
   'ukończenia przez nie 10 roku życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1',
   '3',
   'art. 183 § 1 pkt 3 Kodeksu pracy',
   'Art. 183.\n'
   '§ 1. Pracownik, który przyjął dziecko na wychowanie jako rodzina zastępcza, z '
   'wyjątkiem rodziny zastępczej zawodowej, ma prawo do urlopu na warunkach urlopu '
   'macierzyńskiego w wymiarze:\n'
   '3) 33 tygodni - w przypadku jednoczesnego przyjęcia trojga dzieci,\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 7 roku życia, a w przypadku dziecka, '
   'wobec którego podjęto decyzję o odroczeniu obowiązku szkolnego, nie dłużej niż do ukończenia '
   'przez nie 10 roku życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1',
   '4',
   'art. 183 § 1 pkt 4 Kodeksu pracy',
   'Art. 183.\n'
   '§ 1. Pracownik, który przyjął dziecko na wychowanie jako rodzina zastępcza, z '
   'wyjątkiem rodziny zastępczej zawodowej, ma prawo do urlopu na warunkach urlopu '
   'macierzyńskiego w wymiarze:\n'
   '4) 35 tygodni - w przypadku jednoczesnego przyjęcia czworga dzieci,\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 7 roku życia, a w przypadku dziecka, '
   'wobec którego podjęto decyzję o odroczeniu obowiązku szkolnego, nie dłużej niż do ukończenia '
   'przez nie 10 roku życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1',
   '5',
   'art. 183 § 1 pkt 5 Kodeksu pracy',
   'Art. 183.\n'
   '§ 1. Pracownik, który przyjął dziecko na wychowanie jako rodzina zastępcza, z '
   'wyjątkiem rodziny zastępczej zawodowej, ma prawo do urlopu na warunkach urlopu '
   'macierzyńskiego w wymiarze:\n'
   '5) 37 tygodni - w przypadku jednoczesnego przyjęcia pięciorga i więcej dzieci\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 7 roku życia, a w przypadku dziecka, '
   'wobec którego podjęto decyzję o odroczeniu obowiązku szkolnego, nie dłużej niż do ukończenia '
   'przez nie 10 roku życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1(1)',
   '1',
   'art. 183 § 1(1) pkt 1 Kodeksu pracy',
   'Art. 183. § 1(1).\n'
   'Pracownik, który przyjął dziecko na wychowanie i wystąpił do sądu opiekuńczego z wnioskiem '
   'o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do urlopu na warunkach '
   'urlopu macierzyńskiego w wymiarze:\n'
   '1) 20 tygodni - w przypadku przyjęcia jednego dziecka,',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1(1)',
   '2',
   'art. 183 § 1(1) pkt 2 Kodeksu pracy',
   'Art. 183. § 1(1).\n'
   'Pracownik, który przyjął dziecko na wychowanie i wystąpił do sądu opiekuńczego z wnioskiem '
   'o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do urlopu na warunkach '
   'urlopu macierzyńskiego w wymiarze:\n'
   '2) 31 tygodni - w przypadku jednoczesnego przyjęcia dwojga dzieci,',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1(1)',
   '3',
   'art. 183 § 1(1) pkt 3 Kodeksu pracy',
   'Art. 183. § 1(1).\n'
   'Pracownik, który przyjął dziecko na wychowanie i wystąpił do sądu opiekuńczego z wnioskiem '
   'o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do urlopu na warunkach '
   'urlopu macierzyńskiego w wymiarze:\n'
   '3) 33 tygodni - w przypadku jednoczesnego przyjęcia trojga dzieci,',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1(1)',
   '4',
   'art. 183 § 1(1) pkt 4 Kodeksu pracy',
   'Art. 183. § 1(1).\n'
   'Pracownik, który przyjął dziecko na wychowanie i wystąpił do sądu opiekuńczego z wnioskiem '
   'o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do urlopu na warunkach '
   'urlopu macierzyńskiego w wymiarze:\n'
   '4) 35 tygodni - w przypadku jednoczesnego przyjęcia czworga dzieci,',
   _memo_fld
);

_add(RD_PPRAW,
   'Ro',
   '183',
   '',
   '1(1)',
   '5',
   'art. 183 § 1(1) pkt 5 Kodeksu pracy',
   'Art. 183. § 1(1).\n'
   'Pracownik, który przyjął dziecko na wychowanie i wystąpił do sądu opiekuńczego z wnioskiem '
   'o wszczęcie postępowania w sprawie przysposobienia dziecka, ma prawo do urlopu na warunkach '
   'urlopu macierzyńskiego w wymiarze:\n'
   '5) 37 tygodni - w przypadku jednoczesnego przyjęcia pięciorga i więcej dzieci\n'
   '- nie dłużej jednak niż do ukończenia przez dziecko 14 roku życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Wy',
   '186',
   '',
   '',
   '',
   'art. 186 Kodeksu pracy',
   'Art. 186.\n'
   '§ 1. Pracownik zatrudniony co najmniej 6 miesięcy ma prawo do urlopu wychowawczego '
   'w celu sprawowania osobistej opieki nad dzieckiem. Do sześciomiesięcznego okresu '
   'zatrudnienia wlicza się poprzednie okresy zatrudnienia.\n'
   '§ 2. Wymiar urlopu wychowawczego wynosi do 36 miesięcy. Urlop jest udzielany na okres '
   'nie dłuższy niż do zakończenia roku kalendarzowego, w którym dziecko kończy 6 rok życia.\n'
   '§ 3. Jeżeli z powodu stanu zdrowia potwierdzonego orzeczeniem o niepełnosprawności lub '
   'stopniu niepełnosprawności dziecko wymaga osobistej opieki pracownika, niezależnie od '
   'urlopu, o którym mowa w § 2, może być udzielony urlop wychowawczy w wymiarze do 36 miesięcy, '
   'jednak na okres nie dłuższy niż do ukończenia przez dziecko 18 roku życia.\n'
   '§ 3(1). Urlopy w wymiarach, o których mowa w § 2 i 3, przysługują łącznie obojgu rodzicom '
   'lub opiekunom dziecka.',
   _memo_fld
);

_add(RD_PPRAW,
   'Wy',
   '186',
   '',
   '2',
   '',
   'art. 186 § 2 Kodeksu pracy',
   'Art. 186.\n'
   '§ 1. Pracownik zatrudniony co najmniej 6 miesięcy ma prawo do urlopu wychowawczego '
   'w celu sprawowania osobistej opieki nad dzieckiem. Do sześciomiesięcznego okresu zatrudnienia '
   'wlicza się poprzednie okresy zatrudnienia.\n'
   '§ 2. Wymiar urlopu wychowawczego wynosi do 36 miesięcy. Urlop jest udzielany na okres nie '
   'dłuższy niż do zakończenia roku kalendarzowego, w którym dziecko kończy 6. rok życia.',
   _memo_fld
);

_add(RD_PPRAW,
   'Wy',
   '186',
   '',
   '3',
   '',
   'art. 186 § 3 Kodeksu pracy',
   'Art. 186.\n'
   '§ 1. Pracownik zatrudniony co najmniej 6 miesięcy ma prawo do urlopu wychowawczego w '
   'celu sprawowania osobistej opieki nad dzieckiem. Do sześciomiesięcznego okresu zatrudnienia '
   'wlicza się poprzednie okresy zatrudnienia.\n'
   '§ 3. Jeżeli z powodu stanu zdrowia potwierdzonego orzeczeniem o niepełnosprawności lub '
   'stopniu niepełnosprawności dziecko wymaga osobistej opieki pracownika, niezależnie od urlopu, '
   'o którym mowa w § 2, może być udzielony urlop wychowawczy w wymiarze do 36 miesięcy, jednak '
   'na okres nie dłuższy niż do ukończenia przez dziecko 18. roku życia.',
   _memo_fld
);

{? _mydo || end() ?};
RD_PPRAW.cntx_pop();
~~


\rd_okr_efld
::----------------------------------------------------------------------------------------------------------------------
::  UTW: IS [22.26]
:: OPIS: Ustawienie pól redakcji dla okna 'RED' tabeli RD_OKR
::   WE: _a - [INTEGER] - 1/0 miejsce wywołania: 1 - okno RD_OKR, 0 - okno RD_STAZ.
::      [_b] [INTEGER]  - 1/0 popraw/dołącz [domyślnie 0 - dołącz]
::      [_c] [STRING]   - akronim pola, któego mają dotyczyć ustawienia
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_czyRD_OKR:={? var_pres('_a')=type_of(0) || _a || 0 ?};
_popraw:={? var_pres('_b')=type_of(0) || _b || 0 ?};
_fld:={? var_pres('_c')=type_of('') || _c || '' ?};

{? _fld=''
|| _editable:={? _popraw || 'grayed' || '1' ?};
   RD_OKR.efld_opt('RED','editable=%1'[_editable],,'RD_NB','RT');
   RD_OKR.efld_opt('RED','editable=%1'[_editable],,'ZRODLO');
   RD_OKR.efld_opt('RED','mark=%1'[$_czyRD_OKR],,'CZESC')
?};

_enable:=
   ( (_popraw | +_fld)
     &
     (~_czyRD_OKR & RD_OKR.RD_NB().ATR=1153 & (RD_OKR.OD_WN=#0 | RD_OKR.DO_WN=#0))
   );
RD_OKR.efld_opt('RED','enable=%1'[$_enable],,'ROK');
RD_OKR.efld_opt('RED','enable=%1'[$_enable],,'MIESIAC');
RD_OKR.efld_opt('RED','enable=%1'[$_enable],,'TYDZIEN');
RD_OKR.efld_opt('RED','enable=%1'[$_enable],,'DZIEN');

{? _fld='' | _fld='RD_NB'
|| _mark:=(_czyRD_OKR | ~(RD_OKR.RD_NB().ATR=1153));
   RD_OKR.efld_opt('RED','mark=%1'[$_mark],,'OD_WN');
   RD_OKR.efld_opt('RED','mark=%1'[$_mark],,'DO_WN')
?};

~~


\rd_dz_fill
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [22.26]
:: OPIS: Próba uzupełnienia dziecka związanego z wnioskiem.
::   WE: _a [REFERENCE] - Wskazanie na okres urlopu rodzicielskiego - rekord tabeli RD_OKR.
::       _b [STRING]    - Wskazanie na źródłowy rekord nieobecności - SQL-ref / uidref tabeli N.
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')=type_of(null()) & ref_tab(_a)=RD_OKR & _a<>null()
|| _okr:=_a
|| return(0)
?};
{? var_pres('_b')=type_of('') & (+_b=16 | +_b=48) & type_of(ref_tab(_b))<>type_of(~~) & ref_tab(_b)=N
|| _nref:=_b
|| return(0)
?};

RD_OKR.cntx_psh();
RD_OKR.prefix();
{? RD_OKR.seek(_okr)
|| N.cntx_psh();
   N.prefix();
   {? N.seek(_nref)
   || NWU.cntx_psh();
      NWU.index('STATUS');
      NWU.prefix(N.ref());
      {? NWU.first()
      || EDOKUM.cntx_psh();
         _wm:=exec('nwu_edokum_mask','portal_method_chr');
         {? EDOKUM.name()<>_wm
         || EDOKUM.use(_wm)
         ?};
         EDOKUM.index('DOK_POW');
         EDOKUM.prefix(NWU.uidref());
         {? EDOKUM.first()
         || _params:=json_parse(EDOKUM.memo_txt(0,1,'PARAMS'));
            RD.cntx_psh();
            RD.prefix();
            {? obj_ntab(_params) & var_pres('PersonFamilyId__ID_ERP',_params)=type_of('')
               & +_params.PersonFamilyId__ID_ERP=16 & RD.seek(_params.PersonFamilyId__ID_ERP)
            || RD_DZ.blank();
               RD_DZ.RD:=RD.ref();
               RD_DZ.RD_OKR:=RD_OKR.ref();
               RD_DZ.add()
            ?};
            RD.cntx_pop()
         ?};
         EDOKUM.cntx_pop()
      ?};
      NWU.cntx_pop()
   ?};
   N.cntx_pop()
?};
RD_OKR.cntx_pop();
~~


:Sign Version 2.0 jowisz:1045 2023/07/21 13:25:28 951391c00926ef58bce20850b007a697d27c4431a7ac3a7bddfd10d4c952e34f39114f153e65ca0ee2d80ccb9f80100681d5d6c420c9b7d3469d3d7a03c2744eeff300dc96afa160dc5fdf80bbdf1b82b57e2781f19f9f8dc779916e0e80ea1ceb7f28400d4b6cebe2f999e3d84850faa75c549bb2f74a434bcf2b1840a990a3
