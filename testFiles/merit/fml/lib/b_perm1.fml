:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: b_perm1.fml
:: Utworzony: 25.01.2022
:: Autor: MB
::======================================================================================================================
:: Zawartość: Formuły do obsługi uprawnień do danych
::======================================================================================================================

\dane_usr_upr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_env:=exec('dane_usr_upr_env','b_perm1');
params_set('env',_env);
_env.select();
~~


\dane_usr_upr_env
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - środowisko (env)
::   WE:
::   WY: env
::----------------------------------------------------------------------------------------------------------------------
_fld:="31+form(_a)";
_mth:="31+form(_a)";

_env:=obj_new(
   _fld('ENV_ID','System: 0 - JTerm, 1 - InTerm')
   ,_fld('UPRAW','Symbol uprawnienia, czyli aktualnej zakładki')
:: Okna
   ,_fld('WIN_MAIN','Główne okno grupowe')
   ,_fld('WIN_ODDZ','Okno oddziałów')
   ,_fld('WIN_MG','Okno magazynów')
   ,_fld('WIN_STS','Okno stanowisk sprzedaży')
   ,_fld('WIN_STZ','Okno stanowisk zakupu')
   ,_fld('WIN_TARS','Okno cenników sprzedaży')
   ,_fld('WIN_TARD','Okno cenników dostawców')
   ,_fld('WIN_TRRODZ','Okno kategorii transportu')
   ,_fld('WIN_ZAM','Okno magazynów realizujących zamówienia sprzedaży')
   ,_fld('WIN_ZAW','Okno magazynów realizujących zamówienia wewnętrzne')
   ,_fld('WIN_FZATR','Okno form zatrudnienia')
   ,_fld('WIN_UDDEF','Okno schematów danych')
   ,_fld('WIN_ODD','Okno jednostek księgowych')
   ,_fld('WIN_HRB','Okno rachunków bankowych')
   ,_fld('WIN_HRP','Okno rodzajów przelewów')
   ,_fld('WIN_OGRP','Okno grup wniosków i dokumentów w obiegu')
   ,_fld('WIN_KAS_MUL','Okno uprawnień do multikas')
   ,_fld('WIN_KAS','Okno uprawnień do stanowisk kasowych')
   ,_fld('WIN_REJ','Okno uprawnień do rejestrów księgowych')

   ,_fld('WIN_US_ODDZ','Okno użytkowników uprawnionych do oddziałów')
   ,_fld('WIN_US_MG','Okno użytkowników uprawnionych do magazynów')
   ,_fld('WIN_US_STS','Okno użytkowników uprawnionych do stanowisk sprzedaży')
   ,_fld('WIN_US_STZ','Okno użytkowników uprawnionych do stanowisk zakupu')
   ,_fld('WIN_US_TARS','Okno użytkowników uprawnionych do cenników sprzedaży')
   ,_fld('WIN_US_TARD','Okno użytkowników uprawnionych do cenników dostawców')
   ,_fld('WIN_US_TRRODZ','Okno użytkowników uprawnionych do kategorii transportu')
   ,_fld('WIN_US_ZAM','Okno użytkowników uprawnionych do maazynów realizujących zamówienia sprzedaży')
   ,_fld('WIN_US_ZAW','Okno użytkowników uprawnionych do maazynów realizujących zamówienia wewnętrzne')
   ,_fld('WIN_US_FZATR','Okno użytkowników uprawnionych do form zatrudnienia')
   ,_fld('WIN_US_UDDEF','Okno użytkowników uprawnionych do schematów danych')
   ,_fld('WIN_US_ODD','Okno użytkowników uprawnionych do jednostek księgowych')
   ,_fld('WIN_US_HRB','Okno użytkowników uprawnionych do rachunków bankowych')
   ,_fld('WIN_US_HRP','Okno użytkowników uprawnionych do rodzajów przelewów')
   ,_fld('WIN_US_OGRP','Okno użytkowników uprawnionych do grup wniosków i dokumentów w obiegu')
   ,_fld('WIN_US_KAS_MUL','Okno użytkowników uprawnionych do multikas')
   ,_fld('WIN_US_KAS','Okno użytkowników uprawnionych do stanowisk kasowych')
   ,_fld('WIN_US_REJ','Okno użytkowników uprawnionych do rejestrów księgowych')

   ,_fld('WIN_US','Okno użytkowników')
:: Obsługa
   ,_fld('TAB_DANE','Tabela tymczasowa z refami zaznaczonych danych uprawnienia')
   ,_fld('CRC_DANE','Suma kontrolna zaznaczonych danych uprawnienia')
   ,_fld('TAB_FILTR_USERS','Tabela tymczasowa pomocnicza do filtrowania USERS')
   ,_fld('TAB_FILTR_USERSUP','Tabela tymczasowa pomocnicza do filtrowania USERS_UP')
   ,_fld('TAB_FILTR_USERSFZ','Tabela tymczasowa pomocnicza do filtrowania USERS_FZ')
   ,_fld('TAB_FILTR_USERSREJ','Tabela tymczasowa pomocnicza do filtrowania USERSREJ')
   ,_fld('TAB_FILTR_TARUP','Tabela tymczasowa pomocnicza do filtrowania TARUP')
   ,_fld('TAB_FILTR_BPERMU','Tabela tymczasowa pomocnicza do filtrowania B_PERM_U')
   ,_fld('TAB_FILTR_UDBUPR','Tabela tymczasowa pomocnicza do filtrowania UDB_UPR')
   ,_fld('TAB_USERS','Tabela tymczasowa z refami USERS zaznaczonych użytkowników')
   ,_fld('TAB_USERSUP','Tabela tymczasowa z refami USERS_UP zaznaczonych uprawnionych użytkowników')
   ,_fld('TAB_USERSFZ','Tabela tymczasowa z refami USERS_FZ zaznaczonych uprawnionych użytkowników')
   ,_fld('TAB_USERSREJ','Tabela tymczasowa z refami USERSREJ zaznaczonych uprawnionych użytkowników')
   ,_fld('TAB_TARUP','Tabela tymczasowa z refami TARUP zaznaczonych uprawnionych użytkowników')
   ,_fld('TAB_BPERMU','Tabela tymczasowa z refami B_PERM_U zaznaczonych uprawnionych użytkowników')
   ,_fld('TAB_UDBUPR','Tabela tymczasowa z refami UDB_UPR zaznaczonych uprawnionych użytkowników')
:: metody
   ,_mth('select','uruchamia wertowanie okna')
);

{? exec('interm','#system')
|| _env.ENV_ID:=1
|| _env.ENV_ID:=0
?};
_env.UPRAW:='';
_env.TAB_DANE:=~~;
_env.CRC_DANE:=0;
_env.TAB_FILTR_USERS:=~~;
_env.TAB_FILTR_USERSUP:=~~;
_env.TAB_FILTR_USERSFZ:=~~;
_env.TAB_FILTR_USERSREJ:=~~;
_env.TAB_FILTR_TARUP:=~~;
_env.TAB_FILTR_BPERMU:=~~;
_env.TAB_FILTR_UDBUPR:=~~;
_env.TAB_USERSREJ:=~~;
_env.TAB_USERS:=~~;
_env.TAB_USERSUP:=~~;
_env.TAB_USERSFZ:=~~;
_env.TAB_TARUP:=~~;
_env.TAB_BPERMU:=~~;
_env.TAB_UDBUPR:=~~;

_grp:=ODDZ.grp_make('Uprawnienia do danych'@,,'dane_usr_upr');

::Jednostki księgowe
_rfr:="params_exec('duu_dane6_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','FJKS')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_ODD:=exec('duu_odd_win','b_perm1');
ODDZ.grp_sel(_grp,ODD,_env.WIN_ODD,'Jednostki księgowe'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_ODD:=exec('duu_bpermu_win','b_perm1',_env,'FJKS');
ODDZ.tab_splt(_grp,,'vertical','odd_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_ODD,,_rfr,,,,_fb,,,,'maximized_with_title');

::Rejestry księgowe
__usersrej:=tab_tmp(1,'REJ','STRING[16]','Ref z tabeli REJ',
                      'KOD','STRING[10]','Nazwa'@,
                      'DANE','STRING[50]','Dane użytkownika'@,
                      'AKT','STRING[1]','Aktywny'@,
                      'FULL','STRING[1]','Uprawnienie do wszystkich rej.',
                      'USERS','STRING[16]','Ref z tabeli USERS');
__usersrej.fld_attr('USERS',2,2);
__usersrej.fld_attr('REJ',2,2);
__usersrej.fld_attr('FULL',2,2);

_rfr:="params_exec('duu_dane7_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','REJ')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_REJ:=exec('duu_rej_win','b_perm1');
ODDZ.grp_sel(_grp,REJ,_env.WIN_REJ,'Uprawnienia do rejestrów księgowych'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_REJ:=exec('duu_usersrej_win','b_perm1',_env,'REJ');
ODDZ.tab_splt(_grp,,'vertical','rej_panel');
ODDZ.grp_sel(_grp,__usersrej,_env.WIN_US_REJ,,_rfr,,,,_fb,,,,'maximized_with_title');

::Rachunki bankowe
_rfr:="params_exec('duu_dane6_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','HRB')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_HRB:=exec('duu_hrb_win','b_perm1');
ODDZ.grp_sel(_grp,SKID_RBK,_env.WIN_HRB,'Rachunki bankowe'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_HRB:=exec('duu_bpermu_win','b_perm1',_env,'HRB');
ODDZ.tab_splt(_grp,,'vertical','rbk_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_HRB,,_rfr,,,,_fb,,,,'maximized_with_title');

::Rodzaje przelewów
_rfr:="params_exec('duu_dane6_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','HRP')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_HRP:=exec('duu_hrp_win','b_perm1');
ODDZ.grp_sel(_grp,TZL,_env.WIN_HRP,'Rodzaje przelewów'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_HRP:=exec('duu_bpermu_win','b_perm1',_env,'HRP');
ODDZ.tab_splt(_grp,,'vertical','prz_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_HRP,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Grupy wniosków i dokumentów w obiegu
_rfr:="params_exec('duu_dane6_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','OGRP')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_OGRP:=exec('duu_ogrp_win','b_perm1');
ODDZ.grp_sel(_grp,ETYP_GRP,_env.WIN_OGRP,'Grupy wniosków i dokumentów w obiegu'@,_rfr,,,,_fb,_fa,,1,
             'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_OGRP:=exec('duu_bpermu_win','b_perm1',_env,'OGRP');
ODDZ.tab_splt(_grp,,'vertical','ogrp_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_OGRP,,_rfr,,,,_fb,,,,'maximized_with_title');

::Uprawnienia do multikas
_rfr:="params_exec('duu_dane6_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','KAS_MUL')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_KAS_MUL:=exec('duu_kas_mul_win','b_perm1');
ODDZ.grp_sel(_grp,MKASA,_env.WIN_KAS_MUL,'Uprawnienia do multikas'@,_rfr,,,,_fb,_fa,,1,
             'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_KAS_MUL:=exec('duu_bpermu_win','b_perm1',_env,'KAS_MUL');
ODDZ.tab_splt(_grp,,'vertical','mul_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_KAS_MUL,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Oddziały
_rfr:="params_exec('duu_dane1_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','ODDZ')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_ODDZ:=exec('duu_oddz_win','b_perm1');
ODDZ.grp_sel(_grp,ODDZ,_env.WIN_ODDZ,'Oddziały'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_ODDZ:=exec('duu_usersup_win','b_perm1',_env,'ODDZ');
ODDZ.tab_splt(_grp,,'vertical','oddz_panel');
ODDZ.grp_sel(_grp,USERS_UP,_env.WIN_US_ODDZ,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Magazyny
_rfr:="params_exec('duu_dane1_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','MG')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_MG:=exec('duu_mg_win','b_perm1');
ODDZ.grp_sel(_grp,MG,_env.WIN_MG,'Magazyny'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_MG:=exec('duu_usersup_win','b_perm1',_env,'MG');
ODDZ.tab_splt(_grp,,'vertical','mg_panel');
ODDZ.grp_sel(_grp,USERS_UP,_env.WIN_US_MG,,_rfr,,,,_fb,,,,'maximized_with_title');

::Stanowiska kasowe
_rfr:="params_exec('duu_dane6_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','KAS')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_KAS:=exec('duu_kas_win','b_perm1');
ODDZ.grp_sel(_grp,STANKAS,_env.WIN_KAS,'Uprawnienia do stanowisk kasowych'@,_rfr,,,,_fb,_fa,,1,
             'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_KAS:=exec('duu_bpermu_win','b_perm1',_env,'KAS');
ODDZ.tab_splt(_grp,,'vertical','kas_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_KAS,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Stanowiska sprzedaży
_rfr:="params_exec('duu_dane1_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','STS')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_STS:=exec('duu_sts_win','b_perm1');
ODDZ.grp_sel(_grp,STS,_env.WIN_STS,'Stanowiska sprzedaży'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_STS:=exec('duu_usersup_win','b_perm1',_env,'STS');
ODDZ.tab_splt(_grp,,'vertical','sts_panel');
ODDZ.grp_sel(_grp,USERS_UP,_env.WIN_US_STS,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Stanowiska zakupu
_rfr:="params_exec('duu_dane1_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','STZ')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_STZ:=exec('duu_stz_win','b_perm1');
ODDZ.grp_sel(_grp,STS,_env.WIN_STZ,'Stanowiska zakupu'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_STZ:=exec('duu_usersup_win','b_perm1',_env,'STZ');
ODDZ.tab_splt(_grp,,'vertical','stz_panel');
ODDZ.grp_sel(_grp,USERS_UP,_env.WIN_US_STZ,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Cenniki sprzedaży
_rfr:="params_exec('duu_dane2_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','TARS')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_TARS:=exec('duu_tars_win','b_perm1');
ODDZ.grp_sel(_grp,TARGN,_env.WIN_TARS,'Cenniki sprzedaży'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_TARS:=exec('duu_tarup_win','b_perm1',_env,'TARS');
ODDZ.tab_splt(_grp,,'vertical','tars_panel');
ODDZ.grp_sel(_grp,TARUP,_env.WIN_US_TARS,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Cenniki dostawców
_rfr:="params_exec('duu_dane2_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','TARD')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_TARD:=exec('duu_tard_win','b_perm1');
ODDZ.grp_sel(_grp,TARGN,_env.WIN_TARD,'Cenniki dostawców'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_TARD:=exec('duu_tarup_win','b_perm1',_env,'TARD');
ODDZ.tab_splt(_grp,,'vertical','tars_panel');
ODDZ.grp_sel(_grp,TARUP,_env.WIN_US_TARD,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Kategorie transportu
_rfr:="params_exec('duu_dane3_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','TR_RODZ')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_TRRODZ:=exec('duu_trrodz_win','b_perm1');
ODDZ.grp_sel(_grp,TR_RODZ,_env.WIN_TRRODZ,'Kategorie transportu'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_TRRODZ:=exec('duu_bpermu_win','b_perm1',_env,'TR_RODZ');
ODDZ.tab_splt(_grp,,'vertical','trrodz_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_TRRODZ,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Magazyny realizujące zamówienia sprzedaży
_rfr:="params_exec('duu_dane3_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','ZAM')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_ZAM:=exec('duu_zam_win','b_perm1');
ODDZ.grp_sel(_grp,USERS_UP,_env.WIN_ZAM,'Magazyny realizujące zamówienia sprzedaży'@,_rfr,,,,_fb,_fa,,1,
   'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_ZAM:=exec('duu_bpermu_win','b_perm1',_env,'ZAM');
ODDZ.tab_splt(_grp,,'vertical','zam_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_ZAM,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Magazyny realizujące zamówienia wewnętrzne
_rfr:="params_exec('duu_dane3_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','ZAW')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_ZAW:=exec('duu_zaw_win','b_perm1');
ODDZ.grp_sel(_grp,USERS_UP,_env.WIN_ZAW,'Magazyny realizujące zamówienia wewnętrzne'@,_rfr,,,,_fb,_fa,,1,
   'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_ZAW:=exec('duu_bpermu_win','b_perm1',_env,'ZAW');
ODDZ.tab_splt(_grp,,'vertical','zaw_panel');
ODDZ.grp_sel(_grp,B_PERM_U,_env.WIN_US_ZAW,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Formy współpracy
_rfr:="params_exec('duu_dane4_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','F_ZATR')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_FZATR:=exec('duu_fzatr_win','b_perm1');
ODDZ.grp_sel(_grp,F_ZATR,_env.WIN_FZATR,'Formy współpracy'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_FZATR:=exec('duu_usersfz_win','b_perm1',_env,'F_ZATR');
ODDZ.tab_splt(_grp,,'vertical','fzatr_panel');
ODDZ.grp_sel(_grp,USERS_FZ,_env.WIN_US_FZATR,,_rfr,,,,_fb,,,,'maximized_with_title');

:: Schematy danych
_rfr:="params_exec('duu_dane5_rfr','b_perm1')";
_fb:="
   {? _a
   || params_exec('duu_dane_fb','b_perm1','UD_SKL')
   || ~~
   ?}";
_fa:="
   params_set(params_get());
   _env:=params_get().env;
   exec('duu_tab_dane','b_perm1');
   ~~";
_env.WIN_UDDEF:=exec('duu_uddef_win','b_perm1');
ODDZ.grp_sel(_grp,UD_DEF,_env.WIN_UDDEF,'Schematy danych'@,_rfr,,,,_fb,_fa,,1,'maximized_with_title');

_rfr:="";
_fb:="params_exec('duu_inne_fb','b_perm1')";
_env.WIN_US_UDDEF:=exec('duu_udbupr_win','b_perm1',_env,'UD_SKL');
ODDZ.tab_splt(_grp,,'vertical','uddef_panel');
ODDZ.grp_sel(_grp,UDB_UPR,_env.WIN_US_UDDEF,,_rfr,,,,_fb,,,,'maximized_with_title');


:: Użytkownicy
{? _env.ENV_ID=1
|| _rfr:=""
|| _rfr:="params_exec('duu_users_rfr','b_perm1')"
?};
_fb:="params_exec('duu_inne_fb','b_perm1')";
{? _env.ENV_ID=1
|| _fa:=""
|| _fa:="
      params_set(params_get());
      _env:=params_get().env;
      exec('duu_tab_users','b_perm1');
      ~~"
?};
_env.WIN_US:=exec('duu_users_win','b_perm1',_env);
ODDZ.grp_splt(_grp,,'vertical','users_panel',',66%');
ODDZ.grp_sel(_grp,USERS,_env.WIN_US,,_rfr,,,,_fb,_fa,,,'maximized_with_title');

{? _env.ENV_ID=0
|| exec('duu_dnd','b_perm1',_env)
?};

_env.WIN_MAIN:=_grp;

_env.select:="

   params_set(params_get());
   USERS.cntx_psh();
   USERS_UP.cntx_psh();
   TARUP.cntx_psh();
   B_PERM_U.cntx_psh();
   USERS_FZ.cntx_psh();
   UDB_UPR.cntx_psh();
   USERSDEP.cntx_psh();
   UPR_RB.cntx_psh();
   UPR.cntx_psh();
   USERSOGR.cntx_psh();
   MKASAUPR.cntx_psh();
   KUSERUPR.cntx_psh();
   USERSREJ.cntx_psh();

   ODDZ.cntx_psh();
   MG.cntx_psh();
   STS.cntx_psh();
   TARGN.cntx_psh();
   TR_RODZ.cntx_psh();
   F_ZATR.cntx_psh();
   UD_DEF.cntx_psh();
   UDB_GRP.cntx_psh();
   UDB_SYS.cntx_psh();
   ODD.cntx_psh();
   SKID_RBK.cntx_psh();
   TZL.cntx_psh();
   ETYP_GRP.cntx_psh();
   MKASA.cntx_psh();
   STANKAS.cntx_psh();
   REJ.cntx_psh();
   _winrej:=REJ.win_sel('?');

   _win:=ODDZ.win_sel('?');
   ODDZ.win_sel(.WIN_MAIN);
   ODDZ.select();
   ODDZ.win_sel(_win);
   REJ.win_sel(_winrej);

   USERS.cntx_pop();
   {? USERS.f_active()>0
   || USERS.f_clear()
   ?};
   USERS_UP.cntx_pop();
   {? USERS_UP.f_active()>0
   || USERS_UP.f_clear()
   ?};
   TARUP.cntx_pop();
   {? TARUP.f_active()>0
   || TARUP.f_clear()
   ?};
   B_PERM_U.cntx_pop();
   {? B_PERM_U.f_active()>0
   || B_PERM_U.f_clear()
   ?};
   USERS_FZ.cntx_pop();
   {? USERS_FZ.f_active()>0
   || USERS_FZ.f_clear()
   ?};
   UDB_UPR.cntx_pop();
   {? UDB_UPR.f_active()>0
   || UDB_UPR.f_clear()
   ?};
   USERSDEP.cntx_pop();
   {? USERSDEP.f_active()>0
   || USERSDEP.f_clear()
   ?};
   UPR_RB.cntx_pop();
   {? UPR_RB.f_active()>0
   || UPR_RB.f_clear()
   ?};
   UPR.cntx_pop();
   {? UPR.f_active()>0
   || UPR.f_clear()
   ?};
   USERSOGR.cntx_pop();
   {? USERSOGR.f_active()>0
   || USERSOGR.f_clear()
   ?};
   MKASAUPR.cntx_pop();
   {? MKASAUPR.f_active()>0
   || MKASAUPR.f_clear()
   ?};
   KUSERUPR.cntx_pop();
   {? KUSERUPR.f_active()>0
   || KUSERUPR.f_clear()
   ?};
   USERSREJ.cntx_pop();
   {? USERSREJ.f_active()>0
   || USERSREJ.f_clear()
   ?};

   ODDZ.cntx_pop();
   {? ODDZ.f_active()>0
   || ODDZ.f_clear()
   ?};
   MG.cntx_pop();
   {? MG.f_active()>0
   || MG.f_clear()
   ?};
   STS.cntx_pop();
   {? STS.f_active()>0
   || STS.f_clear()
   ?};
   TARGN.cntx_pop();
   {? TARGN.f_active()>0
   || TARGN.f_clear()
   ?};
   TR_RODZ.cntx_pop();
   {? TR_RODZ.f_active()>0
   || TR_RODZ.f_clear()
   ?};
   F_ZATR.cntx_pop();
   {? F_ZATR.f_active()>0
   || F_ZATR.f_clear()
   ?};
   ODD.cntx_pop();
   {? ODD.f_active()>0
   || ODD.f_clear()
   ?};
   SKID_RBK.cntx_pop();
   {? SKID_RBK.f_active()>0
   || SKID_RBK.f_clear()
   ?};
   TZL.cntx_pop();
   {? TZL.f_active()>0
   || TZL.f_clear()
   ?};
   ETYP_GRP.cntx_pop();
   {? ETYP_GRP.f_active()>0
   || ETYP_GRP.f_clear()
   ?};
   MKASA.cntx_pop();
   {? MKASA.f_active()>0
   || MKASA.f_clear()
   ?};
   STANKAS.cntx_pop();
   {? STANKAS.f_active()>0
   || STANKAS.f_clear()
   ?};
   REJ.cntx_pop();
   {? REJ.f_active()>0
   || REJ.f_clear()
   ?};
   UD_DEF.cntx_pop();
   {? UD_DEF.f_active()>0
   || UD_DEF.f_clear()
   ?};
   UDB_GRP.cntx_pop();
   UDB_SYS.cntx_pop();

   VAR_DEL.delete('__datarej','__rokobr','__rejtitle','__usersrej')
   ";

_env


\duu_dnd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - ustawienie dnd (przeciągania)
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_fml:="params_exec('duu_upr_nadaj','b_perm1',1)";
USERS_UP.dnd_sel(_env.WIN_US_ODDZ,,'records.USERS',_fml);
USERS_UP.dnd_sel(_env.WIN_US_MG,,'records.USERS',_fml);
USERS_UP.dnd_sel(_env.WIN_US_STS,,'records.USERS',_fml);
USERS_UP.dnd_sel(_env.WIN_US_STZ,,'records.USERS',_fml);
TARUP.dnd_sel(_env.WIN_US_TARS,,'records.USERS',_fml);
TARUP.dnd_sel(_env.WIN_US_TARD,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_TRRODZ,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_ZAM,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_ZAW,,'records.USERS',_fml);
USERS_FZ.dnd_sel(_env.WIN_US_FZATR,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_ODD,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_HRB,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_HRP,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_OGRP,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_KAS_MUL,,'records.USERS',_fml);
B_PERM_U.dnd_sel(_env.WIN_US_KAS,,'records.USERS',_fml);
__usersrej.dnd_sel(_env.WIN_US_REJ,,'records.USERS',_fml);
UDB_UPR.dnd_sel(_env.WIN_US_UDDEF,,'records.USERS',_fml);
_fml:="params_exec('duu_upr_odbierz','b_perm1',1)";
USERS.dnd_sel(_env.WIN_US,,'records.USERS_UP',_fml);
USERS.dnd_sel(_env.WIN_US,,'records.TARUP',_fml);
USERS.dnd_sel(_env.WIN_US,,'records.B_PERM_U',_fml);
USERS.dnd_sel(_env.WIN_US,,'records.USERS_FZ',_fml);
USERS.dnd_sel(_env.WIN_US,,'records.bpu_rej',_fml);
::USERS.dnd_sel(_env.WIN_US,,'records.USERSDEP',_fml);
USERS.dnd_sel(_env.WIN_US,,'records.UDB_UPR',_fml);
~~


\duu_oddz_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno oddziałów ODDZ
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_oddz';
_win:=ODDZ.mk_sel('Oddziały'@,'P',0,_wid,,,,,'U','T');
ODDZ.win_fld(_win,,'KOD',,,,,,'Symbol'@);
ODDZ.win_fld(_win,,'NAZ',,,20,,,'Nazwa'@);
ODDZ.win_act(_win,,'Kolejność');
_win


\duu_mg_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno magazynów MG
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_mg';
_win:=MG.mk_sel('Magazyny'@,'P',0,_wid,,,,,'U','T');
MG.win_fld(_win,,'ODDZ',,,,,,'Oddział'@);
MG.win_fld(_win,,'SYM',,,,,,'Symbol'@);
MG.win_fld(_win,,'NAZ',,,20,,,'Nazwa'@);
MG.win_act(_win,,'Kolejność');
_win


\duu_sts_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno stanowisk sprzedaży STS
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_sts';
_win:=STS.mk_sel('Stanowiska sprzedaży'@,'P',0,_wid,,,,,'U','T');
STS.win_fld(_win,,'ODDZ',,,,,,'Oddział'@);
STS.win_fld(_win,,'KOD',,,,,,'Symbol'@);
STS.win_fld(_win,,'NAZ',,,20,,,'Nazwa'@);
STS.win_act(_win,,'Kolejność');
_win


\duu_stz_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno stanowisk zakupu STS
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_stz';
_win:=STS.mk_sel('Stanowiska zakupu'@,'P',0,_wid,,,,,'U','T');
STS.win_fld(_win,,'ODDZ',,,,,,'Oddział'@);
STS.win_fld(_win,,'KOD',,,,,,'Symbol'@);
STS.win_fld(_win,,'NAZ',,,20,,,'Nazwa'@);
STS.win_act(_win,,'Kolejność');
_win


\duu_tars_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno cenników sprzedaży TARS
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_tars';
_win:=TARGN.mk_sel('Cenniki sprzedaży'@,'P',0,_wid,,,,,'U','T');
TARGN.win_fld(_win,,'ODDZ',,,,,,'Oddział'@);
TARGN.win_fld(_win,,'KOD',,,,,,'Symbol'@);
TARGN.win_fld(_win,,'OP',,,20,,,'Nazwa'@);
TARGN.win_act(_win,,'Kolejność');
_win


\duu_tard_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno cenników sprzedaży TARS
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_tard';
_win:=TARGN.mk_sel('Cenniki dostawców'@,'P',0,_wid,,,,,'U','T');
TARGN.win_fld(_win,,'ODDZ',,,,,,'Oddział'@);
TARGN.win_fld(_win,,'KOD',,,,,,'Symbol'@);
TARGN.win_fld(_win,,'OP',,,20,,,'Nazwa'@);
TARGN.win_act(_win,,'Kolejność');
_win


\duu_trrodz_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno kategorii transportu TR_RODZ
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_trrodz';
_win:=TR_RODZ.mk_sel('Kategorie transportu'@,'P',0,_wid,,,,,'U','T');
TR_RODZ.win_fld(_win,,'KOD',,,,,,'Symbol'@);
TR_RODZ.win_fld(_win,,'NAZ',,,20,,,'Nazwa'@);
TR_RODZ.win_act(_win,,'Kolejność');
_win


\duu_zam_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno magazynów realizujących zamówienia sprzedaży USERS_UP
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_zam';
_win:=USERS_UP.mk_sel('Magazyny'@,'P',0,_wid,,,,,'U','T');
USERS_UP.win_fld(_win,,'MG','ODDZ',,,,,'Oddział'@);
USERS_UP.win_fld(_win,,'MG','SYM',,,,,'Symbol'@);
USERS_UP.win_fld(_win,,'MG','NAZ',,20,,,'Nazwa'@);
USERS_UP.win_act(_win,,'Kolejność');
_win


\duu_zaw_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno magazynów realizujących zamówienia wewnętrzne USERS_UP
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_zam';
_win:=USERS_UP.mk_sel('Magazyny'@,'P',0,_wid,,,,,'U','T');
USERS_UP.win_fld(_win,,'MG','ODDZ',,,,,'Oddział'@);
USERS_UP.win_fld(_win,,'MG','SYM',,,,,'Symbol'@);
USERS_UP.win_fld(_win,,'MG','NAZ',,20,,,'Nazwa'@);
USERS_UP.win_act(_win,,'Kolejność');
_win


\duu_usersup_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno uprawnionych użytkowników B_PERM_U
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::       _b - symbol uprawnienia (ODDZ, MG, STS, STZ)
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_upraw:=_b;
_wid:='uu_'+(-_upraw);
_win:=USERS_UP.mk_sel('Uprawnieni użytkownicy'@,'P',,_wid,,,,,'U','T');
USERS_UP.win_fld(_win,USERS,'AKT',,,5,,,'Aktywny'@,,,2,,"\'T\'","\'N\'");
USERS_UP.win_fld(_win,,'USERS','KOD',,,12,,'Nazwa'@);
USERS_UP.win_fld(_win,,'USERS','DANE',,30,,,'Dane użytkownika'@);
{? _env.ENV_ID=0
|| _fml:="
       params_exec('duu_upr_nadaj','b_perm1');
       ~~";
   _fgr1:="
       params_exec('duu_upr_nadaj','b_perm1');
       {? USERS_UP.sel_size()>0
       || USERS_UP.sel_adel()
       ?};
       0";
   _help:='Nadaje uprawnienie do danych dla użytkownika z listy.'@;
   USERS_UP.win_act(_win,0,'Formuła','Nadaj'@@,,_help,_fml,,,1,_fgr1,,'N');
   USERS_UP.win_act(_win,1,'Formuła','Nadaj'@@,,_help,_fml,,,0,,,'N');
   _btn:=USERS_UP.win_btn(_win,'text=<<<,panel=right,align=begin','menu:N');
   USERS_UP.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="
    params_exec('duu_upr_odbierz','b_perm1');
    ~~";
_fgr1:="
    params_exec('duu_upr_odbierz','b_perm1');
    0";
_help:='Odbiera uprawnienie do danych dla użytkownika z listy.'@;
USERS_UP.win_act(_win,0,'Formuła','Odbierz'@@,,_help,_fml,,,1,_fgr1,,'O');
{? _env.ENV_ID=0
|| _btn:=USERS_UP.win_btn(_win,'text=>>>,panel=right,align=begin','menu:O');
   USERS_UP.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="exec('legenda','color','B_PERM#01#1','B_PERM#01#2')";
USERS_UP.win_act(_win,,'Formuła','Legenda'@@,,'Opis znaczenia kolorów wierszy'@,,_fml,,,,,'L');
_fml:="params_exec('duu_usersup_rb','b_perm1',_a)";
USERS_UP.win_act(_win,,'Rekord',,,,_fml);
USERS_UP.win_act(_win,,'Kolejność');
_win


\duu_usersup_rb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - "rekord przed" USERS_UP
::   WE: _a - 1 aktualny rekord, 0 - nie
::   WY: kolor
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _env:=params_get().env;
   {? _env.ENV_ID=0
   || _upraw:=_env.UPRAW;
      {? _upraw='ODDZ'
      || _win:=_env.WIN_US_ODDZ
      |? _upraw='MG'
      || _win:=_env.WIN_US_MG
      |? _upraw='STS'
      || _win:=_env.WIN_US_STS
      |? _upraw='STZ'
      || _win:=_env.WIN_US_STZ
      ?};
      _bez:=':';
      {? grp_empty(USERS,_env.WIN_US)
      || _bez:='N:N'
      ?};
      USERS_UP.actions(_win,_bez,,1)
   ?}
?};

_full:='N';
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref(),USERS_UP.USERS);
{? B_PERM_U.first()
|| _full:=B_PERM_U.FULL
?};
B_PERM_U.cntx_pop();
exec('br_b_perm_u','#b_perm','T',_full)


\duu_tarup_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno uprawnionych użytkowników TARUP
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::       _b - symbol uprawnienia (TARS, TARD)
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_upraw:=_b;
_wid:='tu_'+(-_upraw);
_win:=TARUP.mk_sel('Uprawnieni użytkownicy'@,'P',,_wid,,,,,'U','T');
TARUP.win_fld(_win,USERS,'AKT',,,5,,,'Aktywny'@,,,2,,"\'T\'","\'N\'");
TARUP.win_fld(_win,,'USER','KOD',,,12,,'Nazwa'@);
TARUP.win_fld(_win,,'USER','DANE',,30,,,'Dane użytkownika'@);
{? _env.ENV_ID=0
|| _fml:="
       params_exec('duu_upr_nadaj','b_perm1');
       ~~";
   _fgr1:="
       params_exec('duu_upr_nadaj','b_perm1');
       {? TARUP.sel_size()>0
       || TARUP.sel_adel()
       ?};
       0";
   _help:='Nadaje uprawnienie do danych dla użytkownika z listy.'@;
   TARUP.win_act(_win,0,'Formuła','Nadaj'@@,,_help,_fml,,,1,_fgr1,,'N');
   TARUP.win_act(_win,1,'Formuła','Nadaj'@@,,_help,_fml,,,0,,,'N');
   _btn:=TARUP.win_btn(_win,'text=<<<,panel=right,align=begin','menu:N');
   TARUP.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="
    params_exec('duu_upr_odbierz','b_perm1');
    ~~";
_fgr1:="
    params_exec('duu_upr_odbierz','b_perm1');
    0";
_help:='Odbiera uprawnienie do danych dla użytkownika z listy.'@;
TARUP.win_act(_win,0,'Formuła','Odbierz'@@,,_help,_fml,,,1,_fgr1,,'O');
{? _env.ENV_ID=0
|| _btn:=TARUP.win_btn(_win,'text=>>>,panel=right,align=begin','menu:O');
   TARUP.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="exec('legenda','color','B_PERM#01#1','B_PERM#01#2')";
TARUP.win_act(_win,,'Formuła','Legenda'@@,,'Opis znaczenia kolorów wierszy'@,,_fml,,,,,'L');
_fml:="params_exec('duu_tarup_rb','b_perm1',_a)";
TARUP.win_act(_win,,'Rekord',,,,_fml);
TARUP.win_act(_win,,'Kolejność');
_win


\duu_tarup_rb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - "rekord przed" TARUP
::   WE: _a - 1 aktualny rekord, 0 - nie
::   WY: kolor
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _env:=params_get().env;
   {? _env.ENV_ID=0
   || _upraw:=_env.UPRAW;
      {? _upraw='TARS'
      || _win:=_env.WIN_US_TARS
      |? _upraw='TARD'
      || _win:=_env.WIN_US_TARD
      ?};
      _bez:=':';
      {? grp_empty(USERS,_env.WIN_US)
      || _bez:='N:N'
      ?};
      TARUP.actions(_win,_bez,,1)
   ?}
?};

_full:='N';
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref(),TARUP.USER);
{? B_PERM_U.first()
|| _full:=B_PERM_U.FULL
?};
B_PERM_U.cntx_pop();
exec('br_b_perm_u','#b_perm','T',_full)


\duu_bpermu_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno uprawnionych użytkowników B_PERM_U
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::       _b - symbol uprawnienia (TR_RODZ, ZAM, ZAW)
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_upraw:=_b;
_wid:='bpu_'+(-_upraw);
_win:=B_PERM_U.mk_sel('Uprawnieni użytkownicy'@,'P',,_wid,,,,,'U','T');
B_PERM_U.win_fld(_win,USERS,'AKT',,,5,,,'Aktywny'@,,,2,,"\'T\'","\'N\'");
B_PERM_U.win_fld(_win,,'USER','KOD',,,12,,'Nazwa'@);
B_PERM_U.win_fld(_win,,'USER','DANE',,30,,,'Dane użytkownika'@);
{? _env.ENV_ID=0
|| _fml:="
       params_exec('duu_upr_nadaj','b_perm1');
       ~~";
   _fgr1:="
       params_exec('duu_upr_nadaj','b_perm1');
       {? B_PERM_U.sel_size()>0
       || B_PERM_U.sel_adel()
       ?};
       0";
   _help:='Nadaje uprawnienie do danych dla użytkownika z listy.'@;
   B_PERM_U.win_act(_win,0,'Formuła','Nadaj'@@,,_help,_fml,,,1,_fgr1,,'N');
   B_PERM_U.win_act(_win,1,'Formuła','Nadaj'@@,,_help,_fml,,,0,,,'N');
   _btn:=B_PERM_U.win_btn(_win,'text=<<<,panel=right,align=begin','menu:N');
   B_PERM_U.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="
    params_exec('duu_upr_odbierz','b_perm1');
    ~~";
_fgr1:="
    params_exec('duu_upr_odbierz','b_perm1');
    0";
_help:='Odbiera uprawnienie do danych dla użytkownika z listy.'@;
B_PERM_U.win_act(_win,0,'Formuła','Odbierz'@@,,_help,_fml,,,1,_fgr1,,'O');
{? _env.ENV_ID=0
|| _btn:=B_PERM_U.win_btn(_win,'text=>>>,panel=right,align=begin','menu:O');
   B_PERM_U.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="exec('legenda','color','B_PERM#01#1','B_PERM#01#2')";
B_PERM_U.win_act(_win,,'Formuła','Legenda'@@,,'Opis znaczenia kolorów wierszy'@,,_fml,,,,,'L');
_fml:="params_exec('duu_bpermu_rb','b_perm1',_a)";
B_PERM_U.win_act(_win,,'Rekord',,,,_fml);
B_PERM_U.win_act(_win,,'Kolejność');
_win


\duu_bpermu_rb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - "rekord przed" B_PERM_U
::   WE: _a - 1 aktualny rekord, 0 - nie
::   WY: kolor
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _env:=params_get().env;
   {? _env.ENV_ID=0
   || _upraw:=_env.UPRAW;
      {? _upraw='TR_RODZ'
      || _win:=_env.WIN_US_TRRODZ
      |? _upraw='ZAM'
      || _win:=_env.WIN_US_ZAM
      |? _upraw='ZAW'
      || _win:=_env.WIN_US_ZAW
      |? _upraw='FJKS'
      || _win:=_env.WIN_US_ODD
      |? _upraw='HRB'
      || _win:=_env.WIN_US_HRB
      |? _upraw='HRP'
      || _win:=_env.WIN_US_HRP
      |? _upraw='OGRP'
      || _win:=_env.WIN_US_OGRP
      |? _upraw='KAS_MUL'
      || _win:=_env.WIN_US_KAS_MUL
      |? _upraw='KAS'
      || _win:=_env.WIN_US_KAS
      ?};
      _bez:=':';
      {? grp_empty(USERS,_env.WIN_US)
      || _bez:='N:N'
      ?};
      B_PERM_U.actions(_win,_bez,,1)
   ?}
?};

_full:=B_PERM_U.FULL;
exec('br_b_perm_u','#b_perm','T',_full)


\duu_users_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno użytkowników
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_wid:='duu_users';
_win:=USERS.mk_sel('Użytkownicy'@,'P',0,_wid,,,,,'U','T');
USERS.win_fld(_win,,'AKT',,,5,,,'Aktywny'@,0,,2,,"\'T\'","\'N\'");
USERS.win_fld(_win,,'KOD',,,12,,,'Nazwa'@,0);
USERS.win_fld(_win,,'DANE',,,30,,,'Dane użytkownika'@,0);
{? _env.ENV_ID=1
|| _fml:="params_exec('duu_upr_nadaj','b_perm1');
          ~~";
   _fgr1:="params_exec('duu_upr_nadaj','b_perm1');
           0";
   _help:='Nadaje uprawnienie do danych dla użytkownika z listy.'@;
   USERS.win_act(_win,,'Formuła','Nadaj'@@,,_help,_fml,,,1,_fgr1,,'N')
?};
USERS.win_act(_win,,'Kolejność');
_win


\duu_dane_fb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy włączeniu zakładki
::   WE: _a - symbol uprawnienia (FJKS, HRB, ODDZ, MG, STS, STZ, TARS, TARD, TR_RODZ, ZAM, ZAW, F_ZATR, UD_SKL)
::   WY: 1
::----------------------------------------------------------------------------------------------------------------------
_upraw:=_a;
_upraw_bp:=exec('rodz_uu2bp','b_perm',_upraw);
_start:=0;
params_set(params_get());
_env:=params_get().env;
{? _env.UPRAW<>_upraw
|| _env.UPRAW:=_upraw;
   B_PERM.index('NAME');
   B_PERM.prefix(_upraw_bp);
   B_PERM.first();
   _env.CRC_DANE:=0;
   _start:=1
?};
{? _upraw='ODDZ'
|| ODDZ.index('KOD');
   {? _start
   || {? ODDZ.f_active()
      || ODDZ.f_clear()
      ?};
      ODDZ.first()
   ?}
|? _upraw='MG'
|| MG.index('MAG');
   {? _start
   || {? MG.f_active()
      || MG.f_clear()
      ?};
      MG.first()
   ?}
|? _upraw='STS'
|| STS.index('KOD');
   STS.prefix('S');
   {? _start
   || {? STS.f_active()
      || STS.f_clear()
      ?};
      STS.first()
   ?}
|? _upraw='STZ'
|| STS.index('KOD');
   STS.prefix('Z');
   {? _start
   || {? STS.f_active()
      || STS.f_clear()
      ?};
      STS.first()
   ?}
|? _upraw='TARS'
|| TARGN.index('SDO');
   TARGN.prefix('S');
   {? _start
   || {? TARGN.f_active()
      || TARGN.f_clear()
      ?};
      TARGN.first()
   ?}
|? _upraw='TARD'
|| TARGN.index('SDO');
   TARGN.prefix('D');
   {? _start
   || {? TARGN.f_active()
      || TARGN.f_clear()
      ?};
      TARGN.first()
   ?}
|? _upraw='TR_RODZ'
|| TR_RODZ.index('KOD');
   {? _start
   || {? TR_RODZ.f_active()
      || TR_RODZ.f_clear()
      ?};
      TR_RODZ.first()
   ?}
|? _upraw='ZAM'
|| USERS_UP.index('MG');
   USERS_UP.prefix(null(),'ZAM');
   {? _start
   || {? USERS_UP.f_active()
      || USERS_UP.f_clear()
      ?};
      USERS_UP.first()
   ?}
|? _upraw='ZAW'
|| USERS_UP.index('MG');
   USERS_UP.prefix(null(),'ZAW');
   {? _start
   || {? USERS_UP.f_active()
      || USERS_UP.f_clear()
      ?};
      USERS_UP.first()
   ?}
|? _upraw='F_ZATR'
|| F_ZATR.index('UNIQUE');
   F_ZATR.prefix();
   {? _start
   || {? F_ZATR.f_active()
      || F_ZATR.f_clear()
      ?};
      F_ZATR.first()
   ?}
|? _upraw='FJKS'
|| ODD.index('ODDZIALY');
   ODD.prefix(REF.FIRMA);
   {? _start
   || {? ODD.f_active()
      || ODD.f_clear()
      ?};
      ODD.first()
   ?}
|? _upraw='HRB'
|| SKID_RBK.index('TRN');
   SKID_RBK.prefix(REF.INFO,0,null);
   {? _start
   || {? SKID_RBK.f_active()
      || SKID_RBK.f_clear()
      ?};
      SKID_RBK.first()
   ?}
|? _upraw='HRP'
|| TZL.index('KOD');
   TZL.prefix();
   {? _start
   || {? TZL.f_active()
      || TZL.f_clear()
      ?};
      TZL.first()
   ?}
|? _upraw='OGRP'
|| ETYP_GRP.index('N');
   ETYP_GRP.prefix(REF.FIRMA);
   {? _start
   || {? ETYP_GRP.f_active()
      || ETYP_GRP.f_clear()
      ?};
      ETYP_GRP.first()
   ?}
|? _upraw='KAS_MUL'
|| MKASA.index('NAZ');
   MKASA.prefix();
   {? _start
   || {? MKASA.f_active()
      || MKASA.f_clear()
      ?};
      MKASA.first()
   ?}
|? _upraw='KAS'
|| STANKAS.index('KOD');
   STANKAS.prefix();
   {? _start
   || {? STANKAS.f_active()
      || STANKAS.f_clear()
      ?};
      STANKAS.first()
   ?}
|? _upraw='REJ'
|| exec('duu_sql_datarej','b_perm1');
   REJ.index('KOD');
   REJ.prefix(__rokobr);
   exec('duu_usersrej_fill','b_perm1');
   {? _start
   || {? REJ.f_active()
      || REJ.f_clear()
      ?};
      REJ.first()
   ?};
   REJ.hdr_sel();
   REJ.hdr_sel('Rejestry księgowe: rok obrotowy %1'@[__rejtitle])
|? _upraw='UD_SKL'
|| UDB_GRP.index('SYMBOL');
   UDB_GRP.prefix();
   {? UDB_GRP.ref()=null || UDB_GRP.first() ?};
   UDB_SYS.index('OCHRONA');
   UDB_SYS.prefix(UDB_GRP.ref,'T');
   {? UDB_SYS.ref()=null || UDB_SYS.first() ?};
   UD_DEF.index('SYMBOL');
   UD_DEF.prefix(exec('domyslny','schemat',UDB_SYS.UD_TYP));
   {? UD_DEF.ref()=null || UD_DEF.first() ?};
   {? _start
   || {? UD_DEF.f_active()
      || UD_DEF.f_clear()
      ?};
      UD_DEF.first()
   ?}
?};
1


\duu_inne_fb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przed wyświetleniem dowolnego okna użytkownków
::   WE:
::   WY: 1
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='ODDZ'
|| _tab:=ODDZ;
   _win:=_env.WIN_ODDZ
|? _upraw='MG'
|| _tab:=MG;
   _win:=_env.WIN_MG
|? _upraw='STS'
|| _tab:=STS;
   _win:=_env.WIN_STS
|? _upraw='STZ'
|| _tab:=STS;
   _win:=_env.WIN_STZ
|? _upraw='TARS'
|| _tab:=TARGN;
   _win:=_env.WIN_TARS
|? _upraw='TARD'
|| _tab:=TARGN;
   _win:=_env.WIN_TARD
|? _upraw='TR_RODZ'
|| _tab:=TR_RODZ;
   _win:=_env.WIN_TRRODZ
|? _upraw='ZAM'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAM
|? _upraw='ZAW'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAW
|? _upraw='F_ZATR'
|| _tab:=F_ZATR;
   _win:=_env.WIN_FZATR
|? _upraw='FJKS'
|| _tab:=ODD;
   _win:=_env.WIN_ODD
|? _upraw='HRB'
|| _tab:=SKID_RBK;
   _win:=_env.WIN_HRB
|? _upraw='HRP'
|| _tab:=TZL;
   _win:=_env.WIN_HRP
|? _upraw='OGRP'
|| _tab:=ETYP_GRP;
   _win:=_env.WIN_OGRP
|? _upraw='KAS_MUL'
|| _tab:=MKASA;
   _win:=_env.WIN_KAS_MUL
|? _upraw='KAS'
|| _tab:=STANKAS;
   _win:=_env.WIN_KAS
|? _upraw='REJ'
|| _tab:=REJ;
   _win:=_env.WIN_REJ
|? _upraw='UD_SKL'
|| _tab:=UD_DEF;
   _win:=_env.WIN_UDDEF
?};

_ret:=~~;
{? grp_empty(_tab,_win)
|| _ret:='#disable'
?};

_ret


\duu_dane1_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna oddziałów, magazynów,
::       stanowisk sprzedaży lub zakupu
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='ODDZ'
|| _tab_dane:=ODDZ;
   _win_dane:=_env.WIN_ODDZ;
   _win_usersup:=_env.WIN_US_ODDZ;
   _ndx_usersup:='ODDZ_U'
|? _upraw='MG'
|| _tab_dane:=MG;
   _win_dane:=_env.WIN_MG;
   _win_usersup:=_env.WIN_US_MG;
   _ndx_usersup:='USM'
|? _upraw='STS'
|| _tab_dane:=STS;
   _win_dane:=_env.WIN_STS;
   _win_usersup:=_env.WIN_US_STS;
   _ndx_usersup:='STS_U'
|? _upraw='STZ'
|| _tab_dane:=STS;
   _win_dane:=_env.WIN_STZ;
   _win_usersup:=_env.WIN_US_STZ;
   _ndx_usersup:='STZ_U'
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? USERS_UP.f_active()>0
|| USERS_UP.f_clear(1)
?};
USERS_UP.index(_ndx_usersup);
USERS_UP.prefix(_upraw,null());
{? USERS.f_active()>0
|| USERS.f_clear(1)
?};
USERS.index('USR_AKOD');
USERS.prefix('2');

{? grp_empty(_tab_dane,_win_dane)
|| _env.CRC_DANE:=0

|? _tab_dane.sel_size()>0
|| _env.TAB_DANE:=_tab_dane.sel_aget();
   {? exec('duu_crc_zmiana','b_perm1')
   || exec('duu_usersup_filtr','b_perm1');
      USERS_UP.index(_ndx_usersup);
      USERS_UP.prefix();
      _where:='USERS_UP.REFERENCE in (select :_a.USERS_UP from :_a)';
      USERS_UP.f_set('USERS(KOD)','',_where,_env.TAB_FILTR_USERSUP);
      USERS_UP.f_first();
      USERS.index('USR_AKOD');
      USERS.prefix();
      _where:='USERS.REFERENCE in (select :_a.USERS from :_a)';
      USERS.f_set('KOD','',_where,_env.TAB_FILTR_USERS)
    ?}

|| USERS_UP.index(_ndx_usersup);
   USERS_UP.prefix(_upraw,_tab_dane.ref());
   USERS_UP.first();
   USERS.index('USR_AKOD');
   USERS.prefix();
   _where:='USERS.AKT=\'T\' and '+
           'USERS.REFERENCE in (select B_PERM_U.USER from B_PERM_U where B_PERM_U.FIRMA=:_a and '+
           'B_PERM_U.B_PERM=:_b and (B_PERM_U.ACCESS<>\'T\' or B_PERM_U.FULL<>\'T\')) and '+
           'USERS.REFERENCE not in (select USERS_UP.USERS from USERS_UP where USERS_UP.AKR=\':_c\' and '+
           'USERS_UP.'+_upraw+'=:_d)';
   USERS.f_set('KOD','',_where,REF.FIRMA,B_PERM.ref(),_upraw,_tab_dane.ref());
   {? USERS.f_size()>0 & ~USERS.f_test()
   || USERS.f_first()
   ?}

?};

grp_disp(USERS,_env.WIN_US);
{? _env.ENV_ID=0
|| _bez:=':';
   {? grp_empty(USERS,_env.WIN_US)
   || _bez:='N:N'
   ?};
   USERS_UP.actions(_win_usersup,_bez,,1)
?};
grp_disp(USERS_UP,_win_usersup);
~~


\duu_dane2_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna cenników sprzedaży lub dostawców
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
_sd:=_upraw+1;
{? _upraw='TARS'
|| _tab_dane:=TARGN;
   _win_dane:=_env.WIN_TARS;
   _win_tarup:=_env.WIN_US_TARS
|? _upraw='TARD'
|| _tab_dane:=TARGN;
   _win_dane:=_env.WIN_TARD;
   _win_tarup:=_env.WIN_US_TARD
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? TARUP.f_active()>0
|| TARUP.f_clear(1)
?};
TARUP.index('TARGN');
TARUP.prefix();
{? USERS.f_active()>0
|| USERS.f_clear(1)
?};
USERS.index('USR_AKOD');
USERS.prefix('2');

{? grp_empty(_tab_dane,_win_dane)
|| _env.CRC_DANE:=0

|? _tab_dane.sel_size()>0
|| _env.TAB_DANE:=_tab_dane.sel_aget();
   {? exec('duu_crc_zmiana','b_perm1')
   || exec('duu_tarup_filtr','b_perm1');
      TARUP.index('USER');
      TARUP.prefix();
      _where:='TARUP.REFERENCE in (select :_a.TARUP from :_a)';
      TARUP.f_set('USER(KOD)','',_where,_env.TAB_FILTR_TARUP);
      TARUP.f_first();
      USERS.index('USR_AKOD');
      USERS.prefix();
      _where:='USERS.REFERENCE in (select :_a.USERS from :_a)';
      USERS.f_set('KOD','',_where,_env.TAB_FILTR_USERS)
    ?}

|| TARUP.index('TARGN');
   TARUP.prefix(_tab_dane.ref());
   TARUP.first();
   USERS.index('USR_AKOD');
   USERS.prefix();
   _where:='USERS.AKT=\'T\' and '+
           'USERS.REFERENCE in (select B_PERM_U.USER from B_PERM_U where B_PERM_U.FIRMA=:_a and '+
           'B_PERM_U.B_PERM=:_b and (B_PERM_U.ACCESS<>\'T\' or B_PERM_U.FULL<>\'T\')) and '+
           'USERS.REFERENCE not in (select TARUP.USER from TARUP where TARUP.TARGN=:_c)';
   USERS.f_set('KOD','',_where,REF.FIRMA,B_PERM.ref(),_tab_dane.ref());
   {? USERS.f_size()>0 & ~USERS.f_test()
   || USERS.f_first()
   ?}

?};

grp_disp(USERS,_env.WIN_US);
{? _env.ENV_ID=0
|| _bez:=':';
   {? grp_empty(USERS,_env.WIN_US)
   || _bez:='N:N'
   ?};
   TARUP.actions(_win_tarup,_bez,,1)
?};
grp_disp(TARUP,_win_tarup);
~~


\duu_dane3_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna kategorii transportu,
::       magazynów realizujących zamówienia sprzedaży lub wewnętrzne
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='TR_RODZ'
|| _tab_dane:=TR_RODZ;
   _win_dane:=_env.WIN_TRRODZ;
   _win_bpermu:=_env.WIN_US_TRRODZ
|? _upraw='ZAM'
|| _tab_dane:=USERS_UP;
   _win_dane:=_env.WIN_ZAM;
   _win_bpermu:=_env.WIN_US_ZAM
|? _upraw='ZAW'
|| _tab_dane:=USERS_UP;
   _win_dane:=_env.WIN_ZAW;
   _win_bpermu:=_env.WIN_US_ZAW
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? B_PERM_U.f_active()>0
|| B_PERM_U.f_clear(1)
?};
USERS.index('USR_AKOD');
USERS.prefix('2');

{? grp_empty(_tab_dane,_win_dane)
|| _env.CRC_DANE:=0

|| {? _tab_dane.sel_size()>0
   || _env.TAB_DANE:=_tab_dane.sel_aget();
      _zmiana:=exec('duu_crc_zmiana','b_perm1')
   || exec('duu_tab_dane','b_perm1');
      _zmiana:=1
   ?};
   {? _zmiana
   || exec('duu_bpermu_filtr','b_perm1');
      B_PERM_U.index('USER');
      B_PERM_U.prefix();
      _where:='B_PERM_U.REFERENCE in (select :_a.B_PERM_U from :_a)';
      B_PERM_U.f_set('USER(KOD)','',_where,_env.TAB_FILTR_BPERMU);
      B_PERM_U.f_first();
      USERS.index('USR_AKOD');
      USERS.prefix();
      _where:='USERS.REFERENCE in (select :_a.USERS from :_a)';
      USERS.f_set('KOD','',_where,_env.TAB_FILTR_USERS)
    ?}

?};

grp_disp(USERS,_env.WIN_US);
{? _env.ENV_ID=0
|| _bez:=':';
   {? grp_empty(USERS,_env.WIN_US)
   || _bez:='N:N'
   ?};
   B_PERM_U.actions(_win_bpermu,_bez,,1)
?};
grp_disp(B_PERM_U,_win_bpermu);
~~


\duu_crc_zmiana
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, sprawczenie czy zmieniło się zaznaczenie danych uprawnienia
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
_zmiana:=0;
_crc:=-1;
_sum:=sql('select SUM(CRC) as SUMA from :_a',_env.TAB_DANE);
{? _sum.first()
|| _crc:=_sum.SUMA
?};
{? _crc<>_env.CRC_DANE
|| _env.CRC_DANE=_crc;
   _zmiana:=1
?};
_zmiana


\duu_usersup_filtr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wyliczenie tabel do filtrowanie USERS_UP i USERS
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='MG'
|| _ndx_usersup:='MAG'
|| _ndx_usersup:=_upraw
?};

{? var_pres('TAB_FILTR_USERS',_env)>100
|| obj_del(_env.TAB_FILTR_USERS)
?};
{? var_pres('TAB_FILTR_USERSUP',_env)>100
|| obj_del(_env.TAB_FILTR_USERSUP)
?};

_env.TAB_FILTR_USERSUP:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS',
            'USERS_UP','STRING[16]','Ref SQL USERS_UP'
            );
_env.TAB_FILTR_USERS:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS'
            );

USERS_UP.cntx_psh();
USERS_UP.index(_ndx_usersup);
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref());
{? B_PERM_U.first()
|| {!
   |? {? B_PERM_U.ACCESS='T'
      || _jest:=1;
         _usersup_ref0:='';
         {? B_PERM_U.FULL='T'
         || USERS_UP.prefix(B_PERM_U.USER,_upraw);
            {? USERS_UP.first()
            || _usersup_ref0:=$USERS_UP.ref()
            ?}
         || _env.TAB_DANE.first();
            {!
            |? USERS_UP.prefix(B_PERM_U.USER,_upraw,_env.TAB_DANE.REF);
               {? USERS_UP.first()
               || {? _usersup_ref0=''
                  || _usersup_ref0:=$USERS_UP.ref()
                  ?}
               || _jest:=0
               ?};
               _jest & _env.TAB_DANE.next()
            !}
         ?}
      || _jest:=0
      ?};
      {? _jest
      || _env.TAB_FILTR_USERSUP.blank();
         _env.TAB_FILTR_USERSUP.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERSUP.USERS_UP:=_usersup_ref0;
         _env.TAB_FILTR_USERSUP.add()
      || _env.TAB_FILTR_USERS.blank();
         _env.TAB_FILTR_USERS.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERS.add()
      ?};
      B_PERM_U.next()
   !}
?};
B_PERM_U.cntx_pop();
USERS_UP.cntx_pop();

~~


\duu_tarup_filtr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wyliczenie tabel do filtrowanie TARUP i USERS
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
_sd:=_upraw+1;

{? var_pres('TAB_FILTR_USERS',_env)>100
|| obj_del(_env.TAB_FILTR_USERS)
?};
{? var_pres('TAB_FILTR_TARUP',_env)>100
|| obj_del(_env.TAB_FILTR_TARUP)
?};

_env.TAB_FILTR_TARUP:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS',
            'TARUP','STRING[16]','Ref SQL TARUP'
            );
_env.TAB_FILTR_USERS:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS'
            );

TARUP.cntx_psh();
TARUP.index('USER');
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref());
{? B_PERM_U.first()
|| {!
   |? {? B_PERM_U.ACCESS='T'
      || _jest:=1;
         _tarup_ref0:='';
         {? B_PERM_U.FULL='T'
         || TARUP.prefix(B_PERM_U.USER);
            {? TARUP.first()
            || {!
               |? {? TARUP.TARGN<>null() & TARUP.TARGN().SD=_sd
                  || _tarup_ref0:=$TARUP.ref()
                  ?};
                  _tarup_ref0='' & TARUP.next()
               !}
            ?}
         || _env.TAB_DANE.first();
            {!
            |? TARUP.prefix(B_PERM_U.USER,null(),_env.TAB_DANE.REF);
               {? TARUP.first()
               || {? _tarup_ref0=''
                  || _tarup_ref0:=$TARUP.ref()
                  ?}
               || _jest:=0
               ?};
               _jest & _env.TAB_DANE.next()
            !}
         ?}
      || _jest:=0
      ?};
      {? _jest
      || _env.TAB_FILTR_TARUP.blank();
         _env.TAB_FILTR_TARUP.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_TARUP.TARUP:=_tarup_ref0;
         _env.TAB_FILTR_TARUP.add()
      || _env.TAB_FILTR_USERS.blank();
         _env.TAB_FILTR_USERS.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERS.add()
      ?};
      B_PERM_U.next()
   !}
?};
B_PERM_U.cntx_pop();
TARUP.cntx_pop();

~~


\duu_bpermu_filtr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wyliczenie tabel do filtrowanie B_PERM_U i USERS
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='ZAM' | _upraw='ZAW'
|| _tab:=USERS_UP;
   _ndx_usersup:='MAG'
|| _tab:=TR_RODZ;
   _ndx_usersup:=_upraw
?};

{? var_pres('TAB_FILTR_USERS',_env)>100
|| obj_del(_env.TAB_FILTR_USERS)
?};
{? var_pres('TAB_FILTR_BPERMU',_env)>100
|| obj_del(_env.TAB_FILTR_BPERMU)
?};

_env.TAB_FILTR_BPERMU:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS',
            'B_PERM_U','STRING[16]','Ref SQL TARUP'
            );
_env.TAB_FILTR_USERS:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS'
            );

USERS_UP.cntx_psh();
USERS_UP.index(_ndx_usersup);
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref());
{? B_PERM_U.first()
|| {!
   |? {? B_PERM_U.ACCESS='T'
      || _jest:=1;
         _bpermu_ref0:='';
         {? B_PERM_U.FULL='T'
         || _bpermu_ref0:=$B_PERM_U.ref()
         || _env.TAB_DANE.first();
            {!
            |? {? _upraw='ZAM' | _upraw='ZAW'
               || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),".MG.ref()",null())
               || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),,null())
               ?};
               USERS_UP.prefix(B_PERM_U.USER,_upraw,_dane);
               {? USERS_UP.first()
               || {? _bpermu_ref0=''
                  || _bpermu_ref0:=$B_PERM_U.ref()
                  ?}
               || _jest:=0
               ?};
               _jest & _env.TAB_DANE.next()
            !}
         ?}
      || _jest:=0
      ?};
      {? _jest
      || _env.TAB_FILTR_BPERMU.blank();
         _env.TAB_FILTR_BPERMU.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_BPERMU.B_PERM_U:=_bpermu_ref0;
         _env.TAB_FILTR_BPERMU.add()
      || _env.TAB_FILTR_USERS.blank();
         _env.TAB_FILTR_USERS.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERS.add()
      ?};
      B_PERM_U.next()
   !}
?};
B_PERM_U.cntx_pop();
USERS_UP.cntx_pop();

~~


\duu_tab_dane
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: zapisuje wybrane dane uprawnień w _env.TAB_DANE
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='ODDZ'
|| _tab:=ODDZ;
   _win:=_env.WIN_ODDZ
|? _upraw='MG'
|| _tab:=MG;
   _win:=_env.WIN_MG
|? _upraw='STS'
|| _tab:=STS;
   _win:=_env.WIN_STS
|? _upraw='STZ'
|| _tab:=STS;
   _win:=_env.WIN_STZ
|? _upraw='TARS'
|| _tab:=TARGN;
   _win:=_env.WIN_TARS
|? _upraw='TARD'
|| _tab:=TARGN;
   _win:=_env.WIN_TARD
|? _upraw='TR_RODZ'
|| _tab:=TR_RODZ;
   _win:=_env.WIN_TRRODZ
|? _upraw='ZAM'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAM
|? _upraw='ZAW'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAW
|? _upraw='F_ZATR'
|| _tab:=F_ZATR;
   _win:=_env.WIN_FZATR
|? _upraw='FJKS'
|| _tab:=ODD;
   _win:=_env.WIN_ODD
|? _upraw='HRB'
|| _tab:=SKID_RBK;
   _win:=_env.WIN_HRB
|? _upraw='HRP'
|| _tab:=TZL;
   _win:=_env.WIN_HRP
|? _upraw='OGRP'
|| _tab:=ETYP_GRP;
   _win:=_env.WIN_OGRP
|? _upraw='KAS_MUL'
|| _tab:=MKASA;
   _win:=_env.WIN_KAS_MUL
|? _upraw='KAS'
|| _tab:=STANKAS;
   _win:=_env.WIN_KAS
|? _upraw='REJ'
|| _tab:=REJ;
   _win:=_env.WIN_REJ
|? _upraw='UD_SKL'
|| _tab:=UD_DEF;
   _win:=_env.WIN_UDDEF
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? _tab.sel_size()>0
|| _env.TAB_DANE:=_tab.sel_aget()
|| _env.TAB_DANE:=
       tab_tmp(1,
               'REF','INTEGER','#REF');
   {? ~grp_empty(_tab,_win)
   || _env.TAB_DANE.blank();
      _env.TAB_DANE.REF:=#_tab.ref();
      _env.TAB_DANE.add()
   ?}
?};

~~


\duu_tab_users
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: zapisuje wybranych użytkowników w _env.TAB_USERS
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
{? var_pres('TAB_USERS',_env)>100
|| obj_del(_env.TAB_USERS)
?};
{? USERS.sel_size()>0
|| _env.TAB_USERS:=USERS.sel_aget()
|| _env.TAB_USERS:=
       tab_tmp(1,
               'REF','INTEGER','#USERS');
   {? ~grp_empty(USERS,_env.WIN_US)
   || _env.TAB_USERS.blank();
      _env.TAB_USERS.REF:=#USERS.ref();
      _env.TAB_USERS.add()
   ?}
?};
~~


\duu_tab_usersup
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: zapisuje wybranych użytkowników w _env.TAB_USERSUP
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
{? var_pres('TAB_USERSUP',_env)>100
|| obj_del(_env.TAB_USERSUP)
?};
_upraw:=_env.UPRAW;
{? USERS_UP.sel_size()>0
|| _env.TAB_USERSUP:=USERS_UP.sel_aget()
|| _env.TAB_USERSUP:=
       tab_tmp(1,
               'REF','INTEGER','#USERSUP');
   {? _upraw='ODDZ'
   || _win:=_env.WIN_US_ODDZ
   |? _upraw='MG'
   || _win:=_env.WIN_US_MG
   |? _upraw='STS'
   || _win:=_env.WIN_US_STS
   |? _upraw='STZ'
   || _win:=_env.WIN_US_STZ
   ?};
   {? ~grp_empty(USERS_UP,_win)
   || _env.TAB_USERSUP.blank();
      _env.TAB_USERSUP.REF:=#USERS_UP.ref();
      _env.TAB_USERSUP.add()
   ?}
?};
~~


\duu_tab_tarup
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: zapisuje wybranych użytkowników w _env.TAB_TARUP
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
{? var_pres('TAB_TARUP',_env)>100
|| obj_del(_env.TAB_TARUP)
?};
_upraw:=_env.UPRAW;
{? TARUP.sel_size()>0
|| _env.TAB_TARUP:=TARUP.sel_aget()
|| _env.TAB_TARUP:=
       tab_tmp(1,
               'REF','INTEGER','#TARUP');
   {? _upraw='TARS'
   || _win:=_env.WIN_US_TARS
   |? _upraw='TARD'
   || _win:=_env.WIN_US_TARD
   ?};
   {? ~grp_empty(TARUP,_win)
   || _env.TAB_TARUP.blank();
      _env.TAB_TARUP.REF:=#TARUP.ref();
      _env.TAB_TARUP.add()
   ?}
?};
~~


\duu_tab_bpermu
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: zapisuje wybranych użytkowników w _env.TAB_BPERMU
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
{? var_pres('TAB_BPERMU',_env)>100
|| obj_del(_env.TAB_BPERMU)
?};
_upraw:=_env.UPRAW;
{? B_PERM_U.sel_size()>0
|| _env.TAB_BPERMU:=B_PERM_U.sel_aget()
|| _env.TAB_BPERMU:=
       tab_tmp(1,
               'REF','INTEGER','#B_PERM_U');
   {? _upraw='TR_RODZ'
   || _win:=_env.WIN_US_TRRODZ
   |? _upraw='ZAM'
   || _win:=_env.WIN_US_ZAM
   |? _upraw='ZAW'
   || _win:=_env.WIN_US_ZAW
   |? _upraw='FJKS'
   || _win:=_env.WIN_US_ODD
   |? _upraw='HRB'
   || _win:=_env.WIN_US_HRB
   |? _upraw='HRP'
   || _win:=_env.WIN_US_HRP
   |? _upraw='OGRP'
   || _win:=_env.WIN_US_OGRP
   |? _upraw='KAS_MUL'
   || _win:=_env.WIN_US_KAS_MUL
   |? _upraw='KAS'
   || _win:=_env.WIN_US_KAS
   ?};
   {? ~grp_empty(B_PERM_U,_win)
   || _env.TAB_BPERMU.blank();
      _env.TAB_BPERMU.REF:=#B_PERM_U.ref();
      _env.TAB_BPERMU.add()
   ?}
?};
~~


\duu_upr_nadaj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Dodawanie uprawnienia do danych dla użytkownika
::   WE: [_a] - [0]/1 czy dnd (przeciągnięcie użytkowników)
::       [_b] - [0]/1 czy inicjować i wyświetlać progress
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;

:: tabela i okno danych uprawnienia
{? _upraw='ODDZ'
|| _tab:=ODDZ;
   _win:=_env.WIN_ODDZ
|? _upraw='MG'
|| _tab:=MG;
   _win:=_env.WIN_MG
|? _upraw='STS'
|| _tab:=STS;
   _win:=_env.WIN_STS
|? _upraw='STZ'
|| _tab:=STS;
   _win:=_env.WIN_STZ
|? _upraw='TARS'
|| _tab:=TARGN;
   _win:=_env.WIN_TARS
|? _upraw='TARD'
|| _tab:=TARGN;
   _win:=_env.WIN_TARD
|? _upraw='TR_RODZ'
|| _tab:=TR_RODZ;
   _win:=_env.WIN_TRRODZ
|? _upraw='ZAM'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAM
|? _upraw='ZAW'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAW
|? _upraw='FJKS'
|| _tab:=ODD;
   _win:=_env.WIN_ODD
|? _upraw='HRB'
|| _tab:=SKID_RBK;
   _win:=_env.WIN_HRB
|? _upraw='HRP'
|| _tab:=TZL;
   _win:=_env.WIN_HRP
|? _upraw='OGRP'
|| _tab:=ETYP_GRP;
   _win:=_env.WIN_OGRP
|? _upraw='KAS_MUL'
|| _tab:=MKASA;
   _win:=_env.WIN_KAS_MUL
|? _upraw='KAS'
|| _tab:=STANKAS;
   _win:=_env.WIN_KAS
|? _upraw='REJ'
|| _tab:=REJ;
   _win:=_env.WIN_REJ
|? _upraw='F_ZATR'
|| _tab:=F_ZATR;
   _win:=_env.WIN_FZATR
|? _upraw='UD_SKL'
|| _tab:=UD_DEF;
   _win:=_env.WIN_UDDEF
?};

_dnd:=0;
{? var_pres('_a')=type_of(0)
|| _dnd:=_a
?};

_progres:=0;
{? var_pres('_b')=type_of(0)
|| _progres:=_b
?};

:: tabela użytkowników, którym trzeba nadać uprawnienia
{? _dnd
|| _tab_users:=dnd_info('dropped_records')
|| {? _env.ENV_ID=1
   || exec('duu_tab_users','b_perm1')
   ?};
   _tab_users:=_env.TAB_USERS
?};

USERS.cntx_psh();
KOMM.init(250,,'Przypisywanie użytkownikom uprawnień do danych'@);
{? _tab_users.first()
|| {? _progres>0 & var_pres('TAB_DANE',_env)>100
   || _size:=_tab_users.size()*_env.TAB_DANE.size();
      FUN.prg_start(_size,'Przypisywanie użytkownikom uprawnień do danych...',,,1)
   ?};
   {!
   |? USERS.prefix();
      {? USERS.seek(_tab_users.REF)
      || {? _env.TAB_DANE.first()
         || {!
            |?
::             Uzupełnienie brakującej konfiguracji
               {? _upraw='F_ZATR'
               || exec('users_upr','f_zatr',REF.FIRMA,USERS.ref())
               |? _upraw='UD_SKL'
               || exec('upr_usr_add','schemat',USERS.ref())
               ?};
               {? _upraw='ZAM' | _upraw='ZAW'
               || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),".MG.ref()",null())
               || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),,null())
               ?};
               {? _upraw<>'REJ'
               || {? _dane<>null()
                  || exec('set','b_perm',B_PERM.ref(),USERS.ref(),1,_dane)
                  ?}
               || {? _dane<>null()
                  || exec('duu_set_rej','b_perm1',USERS.ref(),1,_dane)
                  ?}
               ?};
               {? _progres>0
               || FUN.prg_next()
               ?};
               _env.TAB_DANE.next()
            !}
         ?}
      ?};
     _tab_users.next()
   !};
   {? _progres>0
   || FUN.prg_stop()
   ?}
?};
KOMM.select();
USERS.cntx_pop();
_env.CRC_DANE:=0;

grp_disp(_tab,_win,1,1);
~~


\duu_upr_odbierz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Odbieranie uprawnienia do danych dla użytkownika
::   WE: [_a] - [0]/1 czy dnd (przeciągnięcie użytkowników)
::       [_b] - [0]/1 czy inicjować i wyświetlać progress
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;

:: tabela i okno danych uprawnienia
{? _upraw='ODDZ'
|| _tab:=ODDZ;
   _win:=_env.WIN_ODDZ
|? _upraw='MG'
|| _tab:=MG;
   _win:=_env.WIN_MG
|? _upraw='STS'
|| _tab:=STS;
   _win:=_env.WIN_STS
|? _upraw='STZ'
|| _tab:=STS;
   _win:=_env.WIN_STZ
|? _upraw='TARS'
|| _tab:=TARGN;
   _win:=_env.WIN_TARS
|? _upraw='TARD'
|| _tab:=TARGN;
   _win:=_env.WIN_TARD
|? _upraw='TR_RODZ'
|| _tab:=TR_RODZ;
   _win:=_env.WIN_TRRODZ
|? _upraw='ZAM'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAM
|? _upraw='ZAW'
|| _tab:=USERS_UP;
   _win:=_env.WIN_ZAW
|? _upraw='FJKS'
|| _tab:=ODD;
   _win:=_env.WIN_ODD
|? _upraw='HRB'
|| _tab:=SKID_RBK;
   _win:=_env.WIN_HRB
|? _upraw='HRP'
|| _tab:=TZL;
   _win:=_env.WIN_HRP
|? _upraw='OGRP'
|| _tab:=ETYP_GRP;
   _win:=_env.WIN_OGRP
|? _upraw='KAS_MUL'
|| _tab:=MKASA;
   _win:=_env.WIN_KAS_MUL
|? _upraw='KAS'
|| _tab:=STANKAS;
   _win:=_env.WIN_KAS
|? _upraw='REJ'
|| _tab:=REJ;
   _win:=_env.WIN_REJ
|? _upraw='F_ZATR'
|| _tab:=F_ZATR;
   _win:=_env.WIN_FZATR
|? _upraw='UD_SKL'
|| _tab:=UD_DEF;
   _win:=_env.WIN_UDDEF
?};

_dnd:=0;
{? var_pres('_a')=type_of(0)
|| _dnd:=_a
?};

_progres:=0;
{? var_pres('_b')=type_of(0)
|| _progres:=_b
?};

:: tabela uprawnionych użytkowników, którym trzeba odebrać uprawnienia
{? _dnd
|| _tab_usersup:=dnd_info('dropped_records')
|? _upraw='TARS' | _upraw='TARD'
|| exec('duu_tab_tarup','b_perm1');
   _tab_usersup:=_env.TAB_TARUP
|? _upraw='TR_RODZ' | _upraw='ZAM' | _upraw='ZAW'
   | _upraw='FJKS' | _upraw='HRB' | _upraw='HRP' | _upraw='OGRP' | _upraw='KAS_MUL' | _upraw='KAS'
|| exec('duu_tab_bpermu','b_perm1');
   _tab_usersup:=_env.TAB_BPERMU
|? _upraw='F_ZATR'
|| exec('duu_tab_usersfz','b_perm1');
   _tab_usersup:=_env.TAB_USERSFZ
|? _upraw='REJ'
|| exec('duu_tab_usersrej','b_perm1');
   _tab_usersup:=_env.TAB_USERSREJ
|? _upraw='UD_SKL'
|| exec('duu_tab_udbupr','b_perm1');
   _tab_usersup:=_env.TAB_UDBUPR
|| exec('duu_tab_usersup','b_perm1');
   _tab_usersup:=_env.TAB_USERSUP
?};

:: tabela USERS_UP albo TARUP
{? _upraw='TARS' | _upraw='TARD'
|| _users_up:=TARUP;
   _fml_user:="TARUP.USER"
|? _upraw='TR_RODZ' | _upraw='ZAM' | _upraw='ZAW'
   | _upraw='FJKS' | _upraw='HRB' | _upraw='HRP' | _upraw='OGRP' | _upraw='KAS_MUL' | _upraw='KAS'
|| _users_up:=B_PERM_U;
   _fml_user:="B_PERM_U.USER"
|? _upraw='F_ZATR'
|| _users_up:=USERS_FZ;
   _fml_user:="USERS_FZ.USERS"
|? _upraw='REJ'
|| _users_up:=__usersrej;
   _fml_user:="__usersrej.USERS"
|? _upraw='UD_SKL'
|| _users_up:=UDB_UPR;
   _fml_user:="UDB_UPR.USERS"
|| _users_up:=USERS_UP;
   _fml_user:="USERS_UP.USERS"
?};

USERS.cntx_psh();
_users_up.cntx_psh();
KOMM.init(250,,'Odbieranie użytkownikom uprawnień do danych'@);

{? _tab_usersup.first() & _upraw<>'REJ'
|| {? _progres>0 & var_pres('TAB_DANE',_env)>100
   || _size:=_tab_usersup.size()*_env.TAB_DANE.size();
      FUN.prg_start(_size,'Odbieranie użytkownikom uprawnień do danych...',,,1)
   ?};
   {!
   |? _users_up.prefix();
      {? _users_up.seek(_tab_usersup.REF)
      || {? (_upraw='TR_RODZ' | _upraw='ZAM' | _upraw='ZAW'
             | _upraw='FJKS' | _upraw='HRB' | _upraw='HRP'
             | _upraw='OGRP' | _upraw='KAS_MUL' | _upraw='KAS') & B_PERM_U.FULL='T'
         || _env.TAB_DANE.cntx_psh();
            _tab.cntx_psh();
            _ndx_tab_dane:=_env.TAB_DANE.ndx_tmp(,,'REF',,);
            _env.TAB_DANE.index(_ndx_tab_dane);
            _access:=0;
            {? _upraw='ZAM' | _upraw='ZAW'
            || _tab.index('MG');
               _tab.prefix(null(),_upraw)
            |? _upraw='FJKS'
            || _tab.index('ODDZIALY');
               _tab.prefix(REF.FIRMA)
            |? _upraw='HRB'
            || _tab.index('TRN');
               _tab.prefix(REF.INFO,0,null)
            |? _upraw='HRP'
            || _tab.index('KOD');
               _tab.prefix()
            |? _upraw='OGRP'
            || _tab.index('N');
               _tab.prefix(REF.FIRMA)
            |? _upraw='KAS_MUL'
            || _tab.index('NAZ');
               _tab.prefix()
            |? _upraw='KAS'
            || _tab.index('KOD');
               _tab.prefix()
            || _tab.prefix()
            ?};
            {? _tab.first()
            || {!
               |? {? _upraw='ZAM' | _upraw='ZAW'
                  || _dane:=_tab.MG().ref()
                  || _dane:=_tab.ref()
                  ?};
                  {? _dane<>null()
                  || {? _env.TAB_DANE.find_key(#_tab.ref())
                     || _dane_tak:=0
                     || _dane_tak:=1
                     ?};
                     _user:=_fml_user();
                     exec('set','b_perm',B_PERM.ref(),_user,_dane_tak,_dane);
                     {? ~_access & _dane_tak
                     || _access:=1
                     ?}
                  ?};
                  _tab.next()
               !}
            ?};
            _env.TAB_DANE.ndx_drop(_ndx_tab_dane);
            _env.TAB_DANE.cntx_pop();
            _tab.cntx_pop();
            B_PERM_U.ACCESS:={? _access || 'T' || 'N' ?};
            B_PERM_U.FULL():='N';
            B_PERM_U.put();
            {? _progres>0
            || FUN.prg_next(_env.TAB_DANE.size())
            ?}
         || {? _env.TAB_DANE.first()
            || {!
               |? {? _upraw='ZAM' | _upraw='ZAW'
                  || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),".MG.ref()",null())
                  || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),,null())
                  ?};
                  {? _dane<>null()
                  || _user:=_fml_user();
                     exec('set','b_perm',B_PERM.ref(),_user,0,_dane)
                  ?};
                  {? _progres>0
                  || FUN.prg_next()
                  ?};
                  _env.TAB_DANE.next()
               !}
            ?}
         ?}
      ?};
     _tab_usersup.next()
   !};
   {? _progres>0
   || FUN.prg_stop()
   ?}
|? _tab_usersup.first() & _upraw='REJ'
|| {? _progres>0 & var_pres('TAB_DANE',_env)>100
   || _size:=_tab_usersup.size()*_env.TAB_DANE.size();
      FUN.prg_start(_size,'Odbieranie użytkownikom uprawnień do danych...',,,1)
   ?};
   _ndxrej:=_users_up.ndx_tmp(,1,'USERS',,);
   _users_up.index(_ndxrej);
   REJ.cntx_psh();
   {!
   |? _users_up.prefix();
      {? _users_up.seek(_tab_usersup.REF)
      || {? _users_up.FULL='T'
         || _delusr:=_users_up.USERS;
            _users_up.prefix(_delusr);
            USERSREJ.cntx_psh(); USERSREJ.prefix();
            {? _users_up.first()
            || {! |?
                  _users_up.FULL:='N';
                  _users_up.put();
                  USERSREJ.blank();
                  USERSREJ.USER:=exec('FindAndGet','#table',USERS,_users_up.USERS,,,null());
                  USERSREJ.REJ:=exec('FindAndGet','#table',REJ,_users_up.REJ,,,null());
                  USERSREJ.ODD:=USERSREJ.REJ().ODD().OD;
                  USERSREJ.add();
                  _users_up.next()
               !}
            ?};
            _users_up.prefix();
            _users_up.seek(_tab_usersup.REF);
            USERSREJ.cntx_pop();
            {? _env.TAB_DANE.first()
            || {!
               |? {? _upraw='ZAM' | _upraw='ZAW'
                  || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),".MG.ref()",null())
                  || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),,null())
                  ?};
                  {? _dane<>null()
                  || _user:=_fml_user();
                     _userref:=exec('FindAndGet','#table',USERS,_user,,,null());
                     exec('duu_set_rej','b_perm1',_userref,0,_dane)
                  ?};
                  {? _progres>0
                  || FUN.prg_next()
                  ?};
                  _env.TAB_DANE.next()
               !}
            ?}
         || {? _env.TAB_DANE.first()
            || {!
               |? {? _upraw='ZAM' | _upraw='ZAW'
                  || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),".MG.ref()",null())
                  || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),,null())
                  ?};
                  {? _dane<>null()
                  || _user:=_fml_user();
                     _userref:=exec('FindAndGet','#table',USERS,_user,,,null());
                     exec('duu_set_rej','b_perm1',_userref,0,_dane)
                  ?};
                  {? _progres>0
                  || FUN.prg_next()
                  ?};
                  _env.TAB_DANE.next()
               !}
            ?}
         ?}
      ?};
      _tab_usersup.next()
   !};
   _users_up.ndx_drop(_ndxrej);
   REJ.cntx_pop()
?};

KOMM.select();
USERS.cntx_pop();
_users_up.cntx_pop();
_env.CRC_DANE:=0;

grp_disp(_tab,_win,1,1);
~~


\duu_fzatr_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno form zatrudnienia F_ZATR
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_fzatr';
_win:=F_ZATR.mk_sel('Formy zatrudnienia'@,'P',0,_wid,,,,,'U','T');
F_ZATR.win_fld(_win,,'KOD',,,,,,'Kod'@);
F_ZATR.win_fld(_win,,'OPIS',,,45,,,'Opis'@);
F_ZATR.win_act(_win,,'Kolejność');
_win


\duu_usersfz_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno uprawnionych użytkowników USERS_FZ
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::       _b - symbol uprawnienia
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_upraw:=_b;
_wid:='bpu_'+(-_upraw);
_win:=USERS_FZ.mk_sel('Uprawnieni użytkownicy'@,'P',,_wid,,,,,'U','T');
USERS_FZ.win_fld(_win,USERS,'AKT',,,5,,,'Aktywny'@,,,2,,"\'T\'","\'N\'");
USERS_FZ.win_fld(_win,,'USERS','KOD',,,12,,'Nazwa'@);
USERS_FZ.win_fld(_win,,'USERS','DANE',,30,,,'Dane użytkownika'@);
{? _env.ENV_ID=0
|| _fml:="
       params_exec('duu_upr_nadaj','b_perm1');
       ~~";
   _fgr1:="
       params_exec('duu_upr_nadaj','b_perm1');
       {? USERS_FZ.sel_size()>0
       || USERS_FZ.sel_adel()
       ?};
       0";
   _help:='Nadaje uprawnienie do danych dla użytkownika z listy.'@;
   USERS_FZ.win_act(_win,0,'Formuła','Nadaj'@@,,_help,_fml,,,1,_fgr1,,'N');
   USERS_FZ.win_act(_win,1,'Formuła','Nadaj'@@,,_help,_fml,,,0,,,'N');
   _btn:=USERS_FZ.win_btn(_win,'text=<<<,panel=right,align=begin','menu:N');
   USERS_FZ.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="
    params_exec('duu_upr_odbierz','b_perm1');
    ~~";
_fgr1:="
    params_exec('duu_upr_odbierz','b_perm1');
    0";
_help:='Odbiera uprawnienie do danych dla użytkownika z listy.'@;
USERS_FZ.win_act(_win,0,'Formuła','Odbierz'@@,,_help,_fml,,,1,_fgr1,,'O');
{? _env.ENV_ID=0
|| _btn:=USERS_FZ.win_btn(_win,'text=>>>,panel=right,align=begin','menu:O');
   USERS_FZ.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="exec('legenda','color','B_PERM#01#1','B_PERM#01#2')";
USERS_FZ.win_act(_win,,'Formuła','Legenda'@@,,'Opis znaczenia kolorów wierszy'@,,_fml,,,,,'L');
_fml:="params_exec('duu_usersfz_rb','b_perm1',_a)";
USERS_FZ.win_act(_win,,'Rekord',,,,_fml);
USERS_FZ.win_act(_win,,'Kolejność');
_win


\duu_usersfz_filtr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wyliczenie tabel do filtrowanie USERS_FZ i USERS
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='F_ZATR'
:|| _ndx_usersfz:='UNIQUE'
|| _ndx_usersfz:='DOSTEP'
|| _ndx_usersfz:=_upraw
?};

{? var_pres('TAB_FILTR_USERS',_env)>100
|| obj_del(_env.TAB_FILTR_USERS)
?};
{? var_pres('TAB_FILTR_USERSFZ',_env)>100
|| obj_del(_env.TAB_FILTR_USERSFZ)
?};

_env.TAB_FILTR_USERSFZ:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS',
            'USERS_FZ','STRING[16]','Ref SQL USERS_FZ'
            );
_env.TAB_FILTR_USERS:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS'
            );

USERS_FZ.cntx_psh();
USERS_FZ.index(_ndx_usersfz);
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref());
{? B_PERM_U.first()
|| {!
   |? {? B_PERM_U.ACCESS='T'
      || _jest:=1;
         _usersfz_ref0:='';
         {? B_PERM_U.FULL='T'
         || USERS_FZ.prefix('T',REF.FIRMA,B_PERM_U.USER);
            {? USERS_FZ.first()
            || _usersfz_ref0:=$USERS_FZ.ref()
            ?}
         || _env.TAB_DANE.first();
            {!
            |? USERS_FZ.prefix('T',REF.FIRMA,B_PERM_U.USER,_env.TAB_DANE.REF);
               {? USERS_FZ.first()
               || {? _usersfz_ref0=''
                  || _usersfz_ref0:=$USERS_FZ.ref()
                  ?}
               || _jest:=0
               ?};
               _jest & _env.TAB_DANE.next()
            !}
         ?}
      || _jest:=0
      ?};
      {? _jest
      || _env.TAB_FILTR_USERSFZ.blank();
         _env.TAB_FILTR_USERSFZ.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERSFZ.USERS_FZ:=_usersfz_ref0;
         _env.TAB_FILTR_USERSFZ.add()
      || _env.TAB_FILTR_USERS.blank();
         _env.TAB_FILTR_USERS.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERS.add()
      ?};
      B_PERM_U.next()
   !}
?};
B_PERM_U.cntx_pop();
USERS_FZ.cntx_pop();

~~


\duu_tab_usersfz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: zapisuje wybranych użytkowników w _env.TAB_USERSFZ
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
{? var_pres('TAB_USERSFZ',_env)>100
|| obj_del(_env.TAB_USERSFZ)
?};
_upraw:=_env.UPRAW;
{? USERS_FZ.sel_size()>0
|| _env.TAB_USERSFZ:=USERS_FZ.sel_aget()
|| _env.TAB_USERSFZ:=
       tab_tmp(1,
               'REF','INTEGER','#USERSFZ');
   {? _upraw='F_ZATR'
   || _win:=_env.WIN_US_FZATR
   ?};
   {? ~grp_empty(USERS_FZ,_win)
   || _env.TAB_USERSFZ.blank();
      _env.TAB_USERSFZ.REF:=#USERS_FZ.ref();
      _env.TAB_USERSFZ.add()
   ?}
?};
~~


\duu_tab_usersrej
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: zapisuje wybranych użytkowników w _env.TAB_USERSREJ
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
{? var_pres('TAB_USERSREJ',_env)>100
|| obj_del(_env.TAB_USERSREJ)
?};
_upraw:=_env.UPRAW;
{? __usersrej.sel_size()>0
|| _env.TAB_USERSREJ:=__usersrej.sel_aget()
|| _env.TAB_USERSREJ:=
       tab_tmp(1,
               'REF','INTEGER','#USERSREJ');
   {? _upraw='REJ'
   || _win:=_env.WIN_US_REJ
   ?};
   {? ~grp_empty(__usersrej,_win)
   || _env.TAB_USERSREJ.blank();
      _env.TAB_USERSREJ.REF:=#__usersrej.ref();
      _env.TAB_USERSREJ.add()
   ?}
?};
~~


\duu_usersfz_rb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - "rekord przed" USERS_FZ
::   WE: _a - 1 aktualny rekord, 0 - nie
::   WY: kolor
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _env:=params_get().env;
   {? _env.ENV_ID=0
   || _upraw:=_env.UPRAW;
      {? _upraw='F_ZATR'
      || _win:=_env.WIN_US_FZATR
      ?};
      _bez:=':';
      {? grp_empty(USERS,_env.WIN_US)
      || _bez:='N:N'
      ?};
      USERS_FZ.actions(_win,_bez,,1)
   ?}
?};

_full:='N';
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref(),USERS_FZ.USERS);
{? B_PERM_U.first()
|| _full:=B_PERM_U.FULL
?};
B_PERM_U.cntx_pop();
exec('br_b_perm_u','#b_perm','T',_full)


\duu_dane4_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna form zatrudnienia
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='F_ZATR'
|| _tab_dane:=F_ZATR;
   _win_dane:=_env.WIN_FZATR;
   _win_usersfz:=_env.WIN_US_FZATR
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? USERS_FZ.f_active()>0
|| USERS_FZ.f_clear(1)
?};
USERS_FZ.index('DOSTEP');
USERS_FZ.prefix('N',REF.FIRMA,);
{? USERS.f_active()>0
|| USERS.f_clear(1)
?};
USERS.index('USR_AKOD');
USERS.prefix('2');

{? grp_empty(_tab_dane,_win_dane)
|| _env.CRC_DANE:=0

|? _tab_dane.sel_size()>0
|| _env.TAB_DANE:=_tab_dane.sel_aget();
   {? exec('duu_crc_zmiana','b_perm1')
   || exec('duu_usersfz_filtr','b_perm1');
      USERS_FZ.index('FK_USR');
      USERS_FZ.prefix();
      _where:='USERS_FZ.REFERENCE in (select :_a.USERS_FZ from :_a)';
      USERS_FZ.f_set('FIRMA,USERS(KOD)','',_where,_env.TAB_FILTR_USERSFZ,REF.FIRMA);
      USERS_FZ.f_first();
      USERS.index('USR_AKOD');
      USERS.prefix();
      _where:='USERS.REFERENCE in (select :_a.USERS from :_a)';
      USERS.f_set('KOD','',_where,_env.TAB_FILTR_USERS)
    ?}

|| USERS_FZ.index('W_USR');
   USERS_FZ.prefix();
   _where:='USERS_FZ.FIRMA=:_a and '+
           'USERS_FZ.DOSTEP=\'T\' and '+
           'USERS_FZ.F_ZATR=:_b';
   USERS_FZ.f_set(,'',_where,REF.FIRMA,_tab_dane.ref());
   {? USERS_FZ.f_size()>0
   || USERS_FZ.f_first()
   ?};
   USERS.index('USR_AKOD');
   USERS.prefix();
   _where:='USERS.AKT=\'T\' and '+
           'USERS.REFERENCE in (select B_PERM_U.USER from B_PERM_U where B_PERM_U.FIRMA=:_a and '+
           'B_PERM_U.B_PERM=:_b and (B_PERM_U.ACCESS<>\'T\' or B_PERM_U.FULL<>\'T\')) and '+
           'USERS.REFERENCE not in (select USERS_FZ.USERS from USERS_FZ where '+
           'USERS_FZ.'+_upraw+'=:_d and USERS_FZ.DOSTEP=\'T\')';
   USERS.f_set('KOD','',_where,REF.FIRMA,B_PERM.ref(),_upraw,_tab_dane.ref());
   {? USERS.f_size()>0 & ~USERS.f_test()
   || USERS.f_first()
   ?}
?};

grp_disp(USERS,_env.WIN_US);
grp_disp(USERS_FZ,_win_usersfz);
{? _env.ENV_ID=0
|| _bez:=':';
   {? grp_empty(USERS,_env.WIN_US,1)
   || _bez:='N:N'
   ?};
   {? grp_empty(USERS_FZ,_win_usersfz,1)
   || _bez:='O'+_bez+'O'
   ?};
   USERS_FZ.actions(_win_usersfz,_bez,,1)
?};
~~


\duu_uddef_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno schematy danych UD_DEF
::   WE:
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_uddef';
_win:=UD_DEF.mk_sel('Schematy danych'@,'P',0,_wid,,,,1,'N','T');
UD_DEF.win_fld(_win,,'UD_SKL','SYMBOL',,24,,,'Symbol'@);
UD_DEF.win_fld(_win,,'OPIS',,,24,,,'Opis'@);
:UD_DEF.win_act(_win,,'');
UD_DEF.win_act(_win,0,'Formuła','&Zmień zakres'@@,,,,"exec('uddef_range','b_perm1')",1,,,,'Z');
UD_DEF.win_act(_win,1,'Formuła','&Zmień zakres'@@,,,,"exec('uddef_range','b_perm1')",1,,,,'Z');
UD_DEF.win_act(_win,,'Kolejność');
_win


\duu_udbupr_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno uprawnionych użytkowników UDB_UPR
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::       _b - symbol uprawnienia
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_upraw:=_b;
_wid:='bpu_'+(-_upraw);
_win:=UDB_UPR.mk_sel('Uprawnieni użytkownicy'@,'P',,_wid,,,,,'U','T');
UDB_UPR.win_fld(_win,USERS,'AKT',,,5,,,'Aktywny'@,,,2,,"\'T\'","\'N\'");
UDB_UPR.win_fld(_win,,'USERS','KOD',,,12,,'Nazwa'@);
UDB_UPR.win_fld(_win,,'USERS','DANE',,30,,,'Dane użytkownika'@);
{? _env.ENV_ID=0
|| _fml:="
       params_exec('duu_upr_nadaj','b_perm1');
       ~~";
   _fgr1:="
       params_exec('duu_upr_nadaj','b_perm1');
       {? UDB_UPR.sel_size()>0
       || UDB_UPR.sel_adel()
       ?};
       0";
   _help:='Nadaje uprawnienie do danych dla użytkownika z listy.'@;
   UDB_UPR.win_act(_win,0,'Formuła','Nadaj'@@,,_help,_fml,,,1,_fgr1,,'N');
   UDB_UPR.win_act(_win,1,'Formuła','Nadaj'@@,,_help,_fml,,,0,,,'N');
   _btn:=UDB_UPR.win_btn(_win,'text=<<<,panel=right,align=begin','menu:N');
   UDB_UPR.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="
    params_exec('duu_upr_odbierz','b_perm1');
    ~~";
_fgr1:="
    params_exec('duu_upr_odbierz','b_perm1');
    0";
_help:='Odbiera uprawnienie do danych dla użytkownika z listy.'@;
UDB_UPR.win_act(_win,0,'Formuła','Odbierz'@@,,_help,_fml,,,1,_fgr1,,'O');
{? _env.ENV_ID=0
|| _btn:=UDB_UPR.win_btn(_win,'text=>>>,panel=right,align=begin','menu:O');
   UDB_UPR.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="exec('legenda','color','B_PERM#01#1','B_PERM#01#2')";
UDB_UPR.win_act(_win,,'Formuła','Legenda'@@,,'Opis znaczenia kolorów wierszy'@,,_fml,,,,,'L');
_fml:="params_exec('duu_udbupr_rb','b_perm1',_a)";
UDB_UPR.win_act(_win,,'Rekord',,,,_fml);
UDB_UPR.win_act(_win,,'Kolejność');
_win


\duu_udbupr_filtr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wyliczenie tabel do filtrowanie UDB_UPR i USERS
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='UD_SKL'
|| _ndx_udbupr:='DOSTEP'
|| _ndx_udbupr:=_upraw
?};

{? var_pres('TAB_FILTR_USERS',_env)>100
|| obj_del(_env.TAB_FILTR_USERS)
?};
{? var_pres('TAB_FILTR_UDBUPR',_env)>100
|| obj_del(_env.TAB_FILTR_UDBUPR)
?};

_env.TAB_FILTR_UDBUPR:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS',
            'UDB_UPR','STRING[16]','Ref SQL UDB_UPR'
            );
_env.TAB_FILTR_USERS:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS'
            );

UDB_UPR.cntx_psh();
UDB_UPR.index(_ndx_udbupr);

::UDB_GRP.cntx_psh();
::UDB_GRP.index('SYMBOL');
::UDB_GRP.prefix();
::UDB_GRP.first();
::UDB_SYS.cntx_psh();
::UDB_SYS.index('OCHRONA');
::UDB_SYS.prefix(UDB_GRP.ref,'T');
::UDB_SYS.first();

B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref());
{? B_PERM_U.first()
|| {!
   |? {? B_PERM_U.ACCESS='T'
      || _jest:=1;
         _udbupr_ref0:='';
         {? B_PERM_U.FULL='T'
         || UDB_UPR.prefix('T',UDB_SYS.ref(),B_PERM_U.USER);
            {? UDB_UPR.first()
            || _udbupr_ref0:=$UDB_UPR.ref()
            ?}
         || _env.TAB_DANE.first();
            {!
            |? UDB_UPR.prefix('T',UDB_SYS.ref(),B_PERM_U.USER,_env.TAB_DANE.REF);
               {? UDB_UPR.first()
               || {? _udbupr_ref0=''
                  || _udbupr_ref0:=$UDB_UPR.ref()
                  ?}
               || _jest:=0
               ?};
               _jest & _env.TAB_DANE.next()
            !}
         ?}
      || _jest:=0
      ?};
      {? _jest
      || _env.TAB_FILTR_UDBUPR.blank();
         _env.TAB_FILTR_UDBUPR.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_UDBUPR.UDB_UPR:=_udbupr_ref0;
         _env.TAB_FILTR_UDBUPR.add()
      || _env.TAB_FILTR_USERS.blank();
         _env.TAB_FILTR_USERS.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERS.add()
      ?};
      B_PERM_U.next()
   !}
?};
B_PERM_U.cntx_pop();
UDB_UPR.cntx_pop();

~~


\duu_tab_udbupr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: zapisuje wybranych użytkowników w _env.TAB_UDBUPR
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;
{? var_pres('TAB_UDBUPR',_env)>100
|| obj_del(_env.TAB_UDBUPR)
?};
_upraw:=_env.UPRAW;
{? UDB_UPR.sel_size()>0
|| _env.TAB_UDBUPR:=UDB_UPR.sel_aget()
|| _env.TAB_UDBUPR:=
       tab_tmp(1,
               'REF','INTEGER','#UDBUPR');
   {? _upraw='UD_SKL'
   || _win:=_env.WIN_US_UDDEF
   ?};
   {? ~grp_empty(UDB_UPR,_win)
   || _env.TAB_UDBUPR.blank();
      _env.TAB_UDBUPR.REF:=#UDB_UPR.ref();
      _env.TAB_UDBUPR.add()
   ?}
?};
~~


\duu_udbupr_rb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - "rekord przed" UDB_UPR
::   WE: _a - 1 aktualny rekord, 0 - nie
::   WY: kolor
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _env:=params_get().env;
   {? _env.ENV_ID=0
   || _upraw:=_env.UPRAW;
      {? _upraw='UD_SKL'
      || _win:=_env.WIN_US_UDDEF
      ?};
      _bez:=':';
      {? grp_empty(USERS,_env.WIN_US)
      || _bez:='N:N'
      ?};
      UDB_UPR.actions(_win,_bez,,1)
   ?}
?};

_full:='N';
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref(),UDB_UPR.USERS);
{? B_PERM_U.first()
|| _full:=B_PERM_U.FULL
?};
B_PERM_U.cntx_pop();
exec('br_b_perm_u','#b_perm','T',_full)


\duu_dane5_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna schematów danych
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='UD_SKL'
|| _tab_dane:=UD_DEF;
   _win_dane:=_env.WIN_UDDEF;
   _win_udbupr:=_env.WIN_US_UDDEF
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? UDB_UPR.f_active()>0
|| UDB_UPR.f_clear(1)
?};
UDB_UPR.index('W_USR');
UDB_UPR.prefix();
{? USERS.f_active()>0
|| USERS.f_clear(1)
?};
USERS.index('USR_AKOD');
USERS.prefix('2');

{? grp_empty(_tab_dane,_win_dane)
|| _env.CRC_DANE:=0

|? _tab_dane.sel_size()>0
|| _env.TAB_DANE:=_tab_dane.sel_aget();
   {? exec('duu_crc_zmiana','b_perm1')
   || exec('duu_udbupr_filtr','b_perm1');
      UDB_UPR.index('W_USR');
      UDB_UPR.prefix();
      _where:='UDB_UPR.REFERENCE in (select :_a.UDB_UPR from :_a)';
      UDB_UPR.f_set(,'',_where,_env.TAB_FILTR_UDBUPR);
      UDB_UPR.f_first();
      USERS.index('USR_AKOD');
      USERS.prefix();
      _where:='USERS.REFERENCE in (select :_a.USERS from :_a)';
      USERS.f_set('KOD','',_where,_env.TAB_FILTR_USERS)
    ?}

|| UDB_UPR.index('W_USR');
:   UDB_UPR.prefix(REF.FIRMA,_tab_dane.ref());
:   UDB_UPR.first();
   UDB_UPR.prefix();
   _where:='UDB_UPR.UDB_SYS=:_a and UDB_UPR.DOSTEP=\'T\' and '+
           'UDB_UPR.UD_SKL=:_b';
   UDB_UPR.f_set(,'',_where,UDB_SYS.ref(),_tab_dane.UD_SKL);
   {? UDB_UPR.f_size()>0
   || UDB_UPR.f_first()
   ?};
   USERS.index('USR_AKOD');
   USERS.prefix();
   _where:='USERS.AKT=\'T\' and '+
           'USERS.REFERENCE in (select B_PERM_U.USER from B_PERM_U where B_PERM_U.FIRMA=:_a and '+
           'B_PERM_U.B_PERM=:_b and (B_PERM_U.ACCESS<>\'T\' or B_PERM_U.FULL<>\'T\')) and '+
           'USERS.REFERENCE not in (select UDB_UPR.USERS from UDB_UPR where '+
           'UDB_UPR.UD_SKL=:_d and UDB_UPR.DOSTEP=\'T\' and UDB_UPR.UDB_SYS=:_e)';
   USERS.f_set('KOD','',_where,REF.FIRMA,B_PERM.ref(),_upraw,_tab_dane.UD_SKL,UDB_SYS.ref());
   {? USERS.f_size()>0 & ~USERS.f_test()
   || USERS.f_first()
   ?}
?};

grp_disp(UDB_UPR,_win_udbupr);
grp_disp(USERS,_env.WIN_US);
~~


\uddef_range
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Akcja - Zmień zakres dla tabeli UD_DEF
::----------------------------------------------------------------------------------------------------------------------
_update:=0;
UDB_GRP.cntx_psh();
UDB_GRP.index('SYMBOL');
UDB_SYS.cntx_psh();
UDB_SYS.index('OCHRONA');
UD_TYP.cntx_psh();

_acr:=UDB_SYS.mk_edit('Podaj zakres dla schematów danych'@,0);
UDB_SYS.win_esep(_acr,'Dane'@);
UDB_SYS.win_efld(_acr,EDIT_VAR,'UDB_GRP','SYMBOL','SYMBOL',30,0,0,,,,,'F3_button=1');
UDB_SYS.efld_opt(_acr,'mark=1');
UDB_SYS.win_efld(_acr,EDIT_VAR,'UDB_SYS','SYMBOL','OCHRONA',30,0,0,,,,,'F3_button=1');
UDB_SYS.efld_opt(_acr,'mark=1');
exec('ok_esc','#window',UDB_SYS,_acr);
UDB_SYS.win_edit(_acr);

{? UDB_SYS.edit()
|| _update:=1
?};

UD_TYP.cntx_pop();
UDB_SYS.cntx_pop();
UDB_GRP.cntx_pop();

{? _update
|| UDB_GRP.prefix(EDIT_VAR.UDB_GRP,);
   UDB_GRP.first();
   UDB_SYS.prefix(UDB_GRP.ref(),'T',EDIT_VAR.UDB_SYS,);
   UDB_SYS.first();
   UD_DEF.prefix(exec('domyslny','schemat',UDB_SYS.UD_TYP));
   UD_DEF.first()
?}


\duu_odd_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno jednostek księgowych ODD
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_odd';
_win:=ODD.mk_sel('Jednostki księgowe'@,'P',0,_wid,,,,,'U','T');
ODD.win_fld(_win,,'OD',,,,,,'Skrót'@);
ODD.win_fld(_win,,'N',,,45,,,'Pełna nazwa'@);
ODD.win_act(_win,,'Kolejność');
_win


\duu_dane6_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna jednostek księgowych
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='FJKS'
|| _tab_dane:=ODD;
   _win_dane:=_env.WIN_ODD;
   _win_bpermu:=_env.WIN_US_ODD
|? _upraw='HRB'
|| _tab_dane:=SKID_RBK;
   _win_dane:=_env.WIN_HRB;
   _win_bpermu:=_env.WIN_US_HRB
|? _upraw='HRP'
|| _tab_dane:=TZL;
   _win_dane:=_env.WIN_HRP;
   _win_bpermu:=_env.WIN_US_HRP
|? _upraw='OGRP'
|| _tab_dane:=ETYP_GRP;
   _win_dane:=_env.WIN_OGRP;
   _win_bpermu:=_env.WIN_US_OGRP
|? _upraw='KAS_MUL'
|| _tab_dane:=MKASA;
   _win_dane:=_env.WIN_KAS_MUL;
   _win_bpermu:=_env.WIN_US_KAS_MUL
|? _upraw='KAS'
|| _tab_dane:=STANKAS;
   _win_dane:=_env.WIN_KAS;
   _win_bpermu:=_env.WIN_US_KAS
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? B_PERM_U.f_active()>0
|| B_PERM_U.f_clear(1)
?};
USERS.index('USR_AKOD');
USERS.prefix('2');

{? grp_empty(_tab_dane,_win_dane)
|| _env.CRC_DANE:=0

|| {? _tab_dane.sel_size()>0
   || _env.TAB_DANE:=_tab_dane.sel_aget();
      _zmiana:=exec('duu_crc_zmiana','b_perm1')
   || exec('duu_tab_dane','b_perm1');
      _zmiana:=1
   ?};
   {? _zmiana
   || exec('duu_f_bpermu_filtr','b_perm1');
      B_PERM_U.index('USER');
      B_PERM_U.prefix();
      _where:='B_PERM_U.REFERENCE in (select :_a.B_PERM_U from :_a)';
      B_PERM_U.f_set('USER(KOD)','',_where,_env.TAB_FILTR_BPERMU);
      B_PERM_U.f_first();
      USERS.index('USR_AKOD');
      USERS.prefix();
      _where:='USERS.REFERENCE in (select :_a.USERS from :_a)';
      USERS.f_set('KOD','',_where,_env.TAB_FILTR_USERS)
    ?}

?};


grp_disp(USERS,_env.WIN_US);
_bez:=':';
{? grp_empty(USERS,_env.WIN_US)
|| _bez:='N:N'
?};
B_PERM_U.actions(_win_bpermu,_bez,,1);
grp_disp(B_PERM_U,_win_bpermu);
~~


\duu_f_bpermu_filtr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wyliczenie tabel do filtrowanie B_PERM_U i USERS (FJKS)
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='FJKS'
|| _tab:=ODD;
   _ndx_usersup:='UNIK';
   _usersup:=USERSDEP
|? _upraw='HRB'
|| _tab:=SKID_RBK;
   _ndx_usersup:='RB';
   _usersup:=UPR_RB
|? _upraw='HRP'
|| _tab:=TZL;
   _ndx_usersup:='USUPR';
   _usersup:=UPR
|? _upraw='OGRP'
|| _tab:=ETYP_GRP;
   _ndx_usersup:='UNIK';
   _usersup:=USERSOGR
|? _upraw='KAS_MUL'
|| _tab:=MKASA;
   _ndx_usersup:='UNIK';
   _usersup:=MKASAUPR
|? _upraw='KAS'
|| _tab:=STANKAS;
   _ndx_usersup:='KU_ST';
   _usersup:=KUSERUPR
?};

{? var_pres('TAB_FILTR_USERS',_env)>100
|| obj_del(_env.TAB_FILTR_USERS)
?};
{? var_pres('TAB_FILTR_BPERMU',_env)>100
|| obj_del(_env.TAB_FILTR_BPERMU)
?};

_env.TAB_FILTR_BPERMU:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS',
            'B_PERM_U','STRING[16]','Ref SQL'
            );
_env.TAB_FILTR_USERS:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS'
            );

_usersup.cntx_psh();
_usersup.index(_ndx_usersup);
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,B_PERM.ref());
{? B_PERM_U.first()
|| {!
   |? {? B_PERM_U.ACCESS='T'
      || _jest:=1;
         _bpermu_ref0:='';
         {? B_PERM_U.FULL='T'
         || _bpermu_ref0:=$B_PERM_U.ref()
         || _env.TAB_DANE.first();
            {!
            |? {? _upraw='ZAM' | _upraw='ZAW'
               || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),".MG.ref()",null())
               || _dane:=exec('FindAndGet','#table',_tab,_env.TAB_DANE.REF,_tab.name(),,null())
               ?};
               {? _upraw='FJKS' | _upraw='OGRP'
               || _usersup.prefix(REF.FIRMA,B_PERM_U.USER,_dane)
               |? _upraw='HRB' | _upraw='HRP' | _upraw='KAS_MUL' | _upraw='KAS'
               || _usersup.prefix(B_PERM_U.USER,_dane)
               ?};
               {? _usersup.first()
               || {? _bpermu_ref0=''
                  || _bpermu_ref0:=$B_PERM_U.ref()
                  ?}
               || _jest:=0
               ?};
               _jest & _env.TAB_DANE.next()
            !}
         ?}
      || _jest:=0
      ?};
      {? _jest
      || _env.TAB_FILTR_BPERMU.blank();
         _env.TAB_FILTR_BPERMU.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_BPERMU.B_PERM_U:=_bpermu_ref0;
         _env.TAB_FILTR_BPERMU.add()
      || _env.TAB_FILTR_USERS.blank();
         _env.TAB_FILTR_USERS.USERS:=$B_PERM_U.USER;
         _env.TAB_FILTR_USERS.add()
      ?};
      B_PERM_U.next()
   !}
?};
B_PERM_U.cntx_pop();
_usersup.cntx_pop();

~~


\duu_hrb_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno rachunków bankowych SKID_RBK
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_hrb';
exec('RB','object');
_win:=SKID_RBK.mk_sel('Rachunki bankowe'@,'P',0,_wid,,,,,'U','T');
SKID_RBK.win_fld(_win,POMOC,'K54',,,35,,,'Rachunek bankowy'@);
SKID_RBK.win_fld(_win,,'BANK','NB',,45,,,'Nazwa banku'@);
SKID_RBK.win_act(_win,,'Kolejność');
SKID_RBK.win_act(_win,0,'Rekord',,,,"POMOC.K54:=RB.get_rbtx(1,SKID_RBK.ref())");
_win


\duu_hrp_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno rodzajów przelewów TZL
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_hrp';
_win:=TZL.mk_sel('Rodzaje przelewów'@,'P',0,_wid,,,,,'U','T');
TZL.win_fld(_win,,'KOD',,,20,,,'Kod'@);
TZL.win_fld(_win,,'OPIS',,,50,,,'Opis'@);
TZL.win_act(_win,,'Kolejność');
_win


\duu_ogrp_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno grup wniosków i dokumentów w obiegu ETYP_GRP
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_ogrp';
_win:=ETYP_GRP.mk_sel('Grupy obiegu'@,'P',0,_wid,,,,,'U','T');
ETYP_GRP.win_fld(_win,,'N',,,10,,,'Skrót'@);
ETYP_GRP.win_fld(_win,,'NAZ',,,50,,,'Pełna nazwa'@);
ETYP_GRP.win_act(_win,,'Kolejność');
_win


\ev_udb_grp_bd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Formuła - Przed wyświetleniem dla tabeli UDB_GRP
::----------------------------------------------------------------------------------------------------------------------
EDIT_VAR.UDB_GRP:=UDB_GRP.SYMBOL


\ev_udb_grp_f3
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Formuła - F3 dla tabeli UDB_GRP
::----------------------------------------------------------------------------------------------------------------------
_result:='';
UDB_GRP.prefix();
UDB_GRP.find_key(EDIT_VAR.UDB_GRP,);
_winB:=UDB_GRP.win_sel('?');
UDB_GRP.win_sel('SEL');
{? UDB_GRP.select(,1,-1)
|| _result:=UDB_GRP.SYMBOL
?};
UDB_GRP.win_sel(_winB);
_result


\ev_udb_grp_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Formuła - Po redagowaniu dla tabeli UDB_GRP
::----------------------------------------------------------------------------------------------------------------------
_result:=0;
UDB_GRP.prefix();
{? EDIT_VAR.UDB_GRP<>'' & UDB_GRP.find_key(EDIT_VAR.UDB_GRP,)
|| UDB_SYS.prefix(UDB_GRP.ref(),'T',);
   {? ~UDB_SYS.find_key(EDIT_VAR.UDB_SYS,)
   || {? UDB_SYS.first()
      || EDIT_VAR.UDB_SYS:=UDB_SYS.UD_TYP().SYMBOL
      || EDIT_VAR.UDB_SYS:=''
      ?}
   ?};
   _result:=1
?};
_result


\ev_udb_sys_bd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Formuła - Przed wyświetleniem dla tabeli UDB_SYS
::----------------------------------------------------------------------------------------------------------------------
EDIT_VAR.UDB_SYS:=UDB_SYS.UD_TYP().SYMBOL


\ev_udb_sys_f3
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Formuła - F3 dla tabeli UDB_SYS
::----------------------------------------------------------------------------------------------------------------------
_result:='';
UDB_GRP.prefix(EDIT_VAR.UDB_GRP,);
UDB_GRP.first();
UDB_SYS.prefix(UDB_GRP.ref(),'T',);
UDB_SYS.find_key(EDIT_VAR.UDB_SYS,);
_winB:=UDB_SYS.win_sel('?');
UDB_SYS.win_sel('SEL');
{? UDB_SYS.select(,1,-1)
|| _result:=UDB_SYS.UD_TYP().SYMBOL
?};
UDB_SYS.win_sel(_winB);
_result


\ev_udb_sys_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DG [23.25]
:: OPIS: Formuła - Po redagowaniu dla tabeli UDB_SYS
::----------------------------------------------------------------------------------------------------------------------
_result:=0;
UDB_GRP.prefix(EDIT_VAR.UDB_GRP,);
UDB_GRP.first();
UDB_SYS.prefix(UDB_GRP.ref(),'T');
{? EDIT_VAR.UDB_SYS<>'' & UDB_SYS.find_key(EDIT_VAR.UDB_SYS,)
|| _result:=1
?};
_result


\duu_kas_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno stanowisk kasowych STANKAS
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_kas';
_win:=STANKAS.mk_sel('Uprawnienia do stanowisk kasowych'@,'P',0,_wid,,,,,'U','T');
STANKAS.win_fld(_win,,'KOD',,,11,,,'Kod/symbol'@);
STANKAS.win_fld(_win,,'NAZWA',,,30,,,'Nazwa'@);
STANKAS.win_act(_win,,'Kolejność');
_win


\duu_sql_datarej
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Formuła pomocnicza - wybór ROK_F
::   WY: SQLREF tabeli ROK_F
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__rokobr')<=0
|| {? var_pres('__datarej')<=0 || __datarej:=date() ?};
   _sql1:=sql('select KOD, REFERENCE as REF from @ROK_F'+
              ' where (extract(YEAR from ROK_F.POCZ_ROK)<:_a or (extract(MONTH from ROK_F.POCZ_ROK)<=:_c and'+
              ' extract(YEAR from ROK_F.POCZ_ROK)=:_a))'+
              ' and (extract(YEAR from ROK_F.KON_ROK)>:_a or (extract(MONTH from ROK_F.KON_ROK)>=:_c and'+
              ' extract(YEAR from ROK_F.KON_ROK)=:_a))'+
              ' and ROK_F.FIRMA=\':_b\''+
              ' order by 1 desc',__datarej~1,$REF.FIRMA,__datarej~2);
   {? _sql1.first()
   || ROK_F.cntx_psh();
      {? ROK_F.seek(BIT.sqlint(_sql1.REF))
      || __rokobr:=_rokf:=ROK_F.ref(); __rejtitle:=ROK_F.NAZ
      || _rokf:=__rokobr:=null; __rejtitle:=''
      ?};
      ROK_F.cntx_pop()
   || _rokf:=__rokobr:=null; __rejtitle:=''
   ?}
|| _rokf:=__rokobr
?};
_rokf


\duu_rej_wybrok
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Zmiana aktywnego roku obrachunkowego dla tabeli REJ
::----------------------------------------------------------------------------------------------------------------------
ROK_F.cntx_psh();
_berok:=__rokobr;
_bewin:=ROK_F.win_sel('?');
ROK_F.win_sel('ROK');
ROK_F.index('KOD'); ROK_F.prefix(REF.FIRMA);
{? ROK_F.first()
|| {? ROK_F.select()
   || __rokobr:=ROK_F.ref();
      __rejtitle:=ROK_F.NAZ;
      REJ.hdr_sel();
      REJ.hdr_sel('Rejestry księgowe: rok obrotowy %1'@[__rejtitle]);
      REJ.index('KOD');
      REJ.prefix(__rokobr);
      exec('duu_usersrej_fill','b_perm1')
   ?}
?};
ROK_F.cntx_pop()


\duu_rej_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno rejestrów księgowych REJ
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_rej';
_win:=REJ.mk_sel(,'P',0,_wid,,,,,'U','T');
REJ.win_fld(_win,,'ODD','OD',,8,,,'Jednostka księgowa'@);
REJ.win_fld(_win,,'KOD',,,8,,,'Symbol'@);
REJ.win_fld(_win,,'NAZ',,,60,,,'Nazwa'@);

REJ.win_act(_win,0,'Formuła','&Zmień rok',,'Zmień rok pochodzenia rejestrów'@,"exec('duu_rej_wybrok','b_perm1')",,1);
REJ.win_act(_win,1,'Formuła','&Zmień rok',,'Zmień rok pochodzenia rejestrów'@,"exec('duu_rej_wybrok','b_perm1')",,1);
REJ.win_act(_win,,'Kolejność');
REJ.win_sel(_win);
_win


\duu_usersrej_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - okno uprawnionych użytkowników do rejestrów księgowych
::   WE: _a - env - środowisko działania - wynik działania exec('dane_usr_upr_env','b_perm1')
::       _b - symbol uprawnienia
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_env:=_a;
_upraw:=_b;
_wid:='bpu_'+(-_upraw);
_win:=__usersrej.mk_sel('Uprawnieni użytkownicy'@,'P',,_wid,,,,,'U','T');
__usersrej.win_fld(_win,,'AKT',,,5,,,'Aktywny'@,,,2,,"\'T\'","\'N\'");
__usersrej.win_fld(_win,,'KOD',,,12,,,'Nazwa'@);
__usersrej.win_fld(_win,,'DANE',,,30,,,'Dane użytkownika'@);
{? _env.ENV_ID=0
|| _fml:="
       params_exec('duu_upr_nadaj','b_perm1');
       ~~";
   _fgr1:="
       params_exec('duu_upr_nadaj','b_perm1');
       {? __usersrej.sel_size()>0
       || __usersrej.sel_adel()
       ?};
       0";
   _help:='Nadaje uprawnienie do danych dla użytkownika z listy.'@;
   __usersrej.win_act(_win,0,'Formuła','Nadaj'@@,,_help,_fml,,,1,_fgr1,,'N');
   __usersrej.win_act(_win,1,'Formuła','Nadaj'@@,,_help,_fml,,,0,,,'N');
   _btn:=__usersrej.win_btn(_win,'text=<<<,panel=right,align=begin','menu:N');
   __usersrej.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="
    params_exec('duu_upr_odbierz','b_perm1');
    ~~";
_fgr1:="
    params_exec('duu_upr_odbierz','b_perm1');
    0";
_help:='Odbiera uprawnienie do danych dla użytkownika z listy.'@;
__usersrej.win_act(_win,0,'Formuła','Odbierz'@@,,_help,_fml,,,1,_fgr1,,'O');
{? _env.ENV_ID=0
|| _btn:=__usersrej.win_btn(_win,'text=>>>,panel=right,align=begin','menu:O');
   __usersrej.btn_opt(_btn,'tooltip='+_help)
?};
_fml:="exec('legenda','color','B_PERM#01#1','B_PERM#01#2')";
__usersrej.win_act(_win,,'Formuła','Legenda'@@,,'Opis znaczenia kolorów wierszy'@,,_fml,,,,,'L');
_fml:="params_exec('duu_usersrej_rb','b_perm1',_a)";
__usersrej.win_act(_win,,'Rekord',,,,_fml);
__usersrej.win_act(_win,,'Kolejność');
_win


\duu_usersrej_rb
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - "rekord przed" USERSREJ
::   WE: _a - 1 aktualny rekord, 0 - nie
::   WY: kolor
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _env:=params_get().env;
   {? _env.ENV_ID=0
   || _upraw:=_env.UPRAW;
      {? _upraw='REJ'
      || _win:=_env.WIN_US_REJ
      ?};
      _bez:=':';
      {? grp_empty(USERS,_env.WIN_US)
      || _bez:='N:N'
      ?};
      __usersrej.actions(_win,_bez,,1)
   ?}
?};

_full:=__usersrej.FULL;
exec('br_b_perm_u','#b_perm','T',_full)


\duu_set_rej
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Formuła zmiany uprawnień do rejestrów księgowych
::   WE: _a  - wskazanie na użytkownika (USERS)
::       _b  - typ operacji: 1-nadanie 0-odebranie
::      [_c] - wskazanie na element danych lub brak gdy chodzi o dostęp do wszystkich
::----------------------------------------------------------------------------------------------------------------------
B_PERM.cntx_psh();
B_PERM.index('NAME');
B_PERM.prefix('FJKS');
{? B_PERM.first() || _bperm:=B_PERM.ref() || _bperm:=null ?};
B_PERM.cntx_pop();
_users:=_a;
_set:=_b;
_ref:={? var_pres('_c')=type_of(null) | var_pres('_c')=type_of('') || _c || ~~ ?};
_access:=-1;
_res:=-1;
USERSREJ.cntx_psh(); USERSREJ.index('REJ'); USERSREJ.prefix();
__usersrej.cntx_psh(); __usersrej.prefix();
{? _set
|| USERSREJ.blank();
   USERSREJ.USER:=_users;
   USERSREJ.REJ:=_ref;
   USERSREJ.ODD:=USERSREJ.REJ().ODD().OD;
   USERSREJ.add(1);
   __usersrej.blank();
   __usersrej.REJ:=$_ref;
   __usersrej.KOD:=USERSREJ.USER().KOD;
   __usersrej.DANE:=USERSREJ.USER().DANE;
   __usersrej.AKT:=USERSREJ.USER().AKT;
   __usersrej.FULL:='N';
   __usersrej.USERS:=$_users;
   __usersrej.add()
|| _ndx1:=__usersrej.ndx_tmp(,1,'USERS',,,'REJ',,);
   __usersrej.index(_ndx1);
   __usersrej.prefix($_users,$_ref);
   {? __usersrej.first() || {! |? __usersrej.del() !} ?};
   USERSREJ.index('REJ'); USERSREJ.prefix(_users,_ref);
   {? USERSREJ.first() || {! |? USERSREJ.del() !} ?};
   __usersrej.ndx_drop(_ndx1)
?};
__usersrej.cntx_pop();
USERSREJ.cntx_pop()


\duu_usersrej_fill
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Wypełnia tabelę tymczasową __usersrej po zmianie roku
::----------------------------------------------------------------------------------------------------------------------
__usersrej.prefix(); __usersrej.erase();
USERSREJ.cntx_psh(); USERS.cntx_psh(); REJ.cntx_psh();
USERSREJ.index('REJ_US'); __usersrej.prefix(); USERS.prefix();

_users:=tab_tmp(1,'FULL','STRING[1]','Uprawnienie do wszystkich rej.',
                  'KOD','STRING[10]','Nazwa',
                  'DANE','STRING[50]','Dane użytkownika',
                  'AKT','STRING[1]','Aktywny',
                  'USERS','STRING[16]','REF z USERS',
                  'ODD','STRING[16]','Ref z ODD');
_users.prefix();
B_PERM.cntx_psh();
B_PERM.index('NAME');
B_PERM.prefix('FJKS');
{? B_PERM.first() || _bperm:=B_PERM.ref() || _bperm:=null ?};
B_PERM.cntx_pop();
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM'); B_PERM_U.prefix(REF.FIRMA,_bperm);
{? B_PERM_U.first()
|| USERS.cntx_psh(); USERS.prefix();
   {! |?
      {? B_PERM_U.ACCESS='T'
      || {? B_PERM_U.FULL='T'
         || B_PERM_U.USER();
            _users.blank();
            _users.FULL:='T';
            _users.USERS:=$B_PERM_U.USER;
            _users.KOD:=USERS.KOD;
            _users.DANE:=USERS.DANE;
            _users.AKT:=USERS.AKT;
            _users.add()
         || USERSDEP.cntx_psh(); USERSDEP.index('UNIK'); USERSDEP.prefix(REF.FIRMA,B_PERM_U.USER);
            {? USERSDEP.first()
            || {! |?
                  USERSDEP.USERS();
                  _users.blank();
                  _users.FULL:='N';
                  _users.USERS:=$USERSDEP.USERS;
                  _users.KOD:=USERS.KOD;
                  _users.DANE:=USERS.DANE;
                  _users.AKT:=USERS.AKT;
                  _users.ODD:=$USERSDEP.DEPT;
                  _users.add();
                  USERSDEP.next()
               !}
            ?};
            USERSDEP.cntx_pop()
         ?}
      ?};
      B_PERM_U.next()
   !};
   USERS.cntx_pop()
?};
B_PERM_U.cntx_pop();


B_PERM.cntx_psh();
B_PERM.index('NAME');
B_PERM.prefix('FREJ');
{? B_PERM.first() || _bperm:=B_PERM.ref() || _bperm:=null ?};
B_PERM.cntx_pop();
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
_users.cntx_psh(); _users.prefix();
{? _users.first()
|| {! |?
      B_PERM_U.prefix(REF.FIRMA,_bperm,BB.sqlint(_users.USERS));
      {? B_PERM_U.first()
      || _users.next()
      || _users.del()
      ?}
   !}
?};
_users.cntx_pop();
B_PERM_U.cntx_pop();

{? REJ.first()
|| {! |?
      USERSREJ.prefix(REJ.ref());
      {? USERSREJ.first()
      || {! |?
            USERSREJ.USER();
            __usersrej.blank();
            __usersrej.FULL:='N';
            __usersrej.KOD:=USERS.KOD;
            __usersrej.DANE:=USERS.DANE;
            __usersrej.AKT:=USERS.AKT;
            __usersrej.USERS:=$USERS.ref();
            __usersrej.REJ:=$USERSREJ.REJ;
            __usersrej.add();
            USERSREJ.next()
         !}
      ?};
      REJ.next()
   !}
?};

_ustmp:=sql('select * from :_a where :_a.USERS not in (select :_b.USERS from :_b)',_users,__usersrej);
_ndx1:=_ustmp.ndx_tmp(,1,'FULL',,,'ODD',,); _ustmp.index(_ndx1); _ustmp.prefix();

{? REJ.first()
|| {! |?
      _ustmp.prefix('N',$REJ.ODD);
      {? _ustmp.first()
      || {! |?
            __usersrej.blank();
            __usersrej.FULL:='T';
            __usersrej.KOD:=_ustmp.KOD;
            __usersrej.DANE:=_ustmp.DANE;
            __usersrej.AKT:=_ustmp.AKT;
            __usersrej.USERS:=_ustmp.USERS;
            __usersrej.REJ:=$REJ.ref();
            __usersrej.add();
            _ustmp.next()
         !}
      ?};
      _ustmp.prefix('T');
      {? _ustmp.first()
      || {! |?
            __usersrej.blank();
            __usersrej.FULL:='T';
            __usersrej.KOD:=_ustmp.KOD;
            __usersrej.DANE:=_ustmp.DANE;
            __usersrej.AKT:=_ustmp.AKT;
            __usersrej.USERS:=_ustmp.USERS;
            __usersrej.REJ:=$REJ.ref();
            __usersrej.add();
            _ustmp.next()
         !}
      ?};
      REJ.next()
   !}
?};

USERSREJ.cntx_pop(); USERS.cntx_pop(); REJ.cntx_pop()


\duu_dane7_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna rejestrów księgowych
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='REJ'
|| _tab_dane:=REJ;
   _win_dane:=_env.WIN_REJ;
   _win_usersrej:=_env.WIN_US_REJ
?};

{? var_pres('TAB_DANE',_env)>100
|| obj_del(_env.TAB_DANE)
?};

{? __usersrej.f_active()>0
|| __usersrej.f_clear(1)
?};

__usersrej.prefix();
{? USERS.f_active()>0
|| USERS.f_clear(1)
?};
USERS.index('USR_AKOD');
USERS.prefix('2');

{? grp_empty(_tab_dane,_win_dane)
|| _env.CRC_DANE:=0

|? _tab_dane.sel_size()>0
|| _env.TAB_DANE:=_tab_dane.sel_aget();
   {? exec('duu_crc_zmiana','b_perm1')
   || exec('duu_usersrej_filtr','b_perm1');

     __usersrej.prefix();
      _where:=':_b.REFERENCE in (select :_a.USERSREJ from :_a)';
      __usersrej.f_set('KOD','',_where,_env.TAB_FILTR_USERSREJ,__usersrej);
      __usersrej.f_first();
      USERS.index('USR_AKOD');
      USERS.prefix();
      _where:='USERS.REFERENCE in (select :_a.USERS from :_a)';
      USERS.f_set('KOD','',_where,_env.TAB_FILTR_USERS)
    ?}

||
   __usersrej.prefix();
   _where:=':_a.REJ=\':_b\'';
   __usersrej.f_set('KOD','',_where,__usersrej,$_tab_dane.ref());
   {? __usersrej.f_size()>0
   || __usersrej.f_first()
   ?};
   USERS.index('USR_AKOD');
   USERS.prefix();
   B_PERM.cntx_psh();
   B_PERM.index('NAME');
   B_PERM.prefix('FJKS');
   {? B_PERM.first() || _bperm:=B_PERM.ref() || _bperm:=null ?};
   B_PERM.prefix('FREJ');
   {? B_PERM.first() || _bpermrej:=B_PERM.ref() || _bpermrej:=null ?};
   B_PERM.cntx_pop();
   _where:='USERS.AKT=\'T\' and '+
           '(USERS.REFERENCE in (select B_PERM_U.USER from B_PERM_U where B_PERM_U.FIRMA=:_a and '+
           'B_PERM_U.B_PERM=:_g)) and '+
           'USERS.REFERENCE in (select B_PERM_U.USER from B_PERM_U where B_PERM_U.FIRMA=:_a and '+
           'B_PERM_U.B_PERM=:_b and ((B_PERM_U.ACCESS=\'T\' and B_PERM_U.USER in '+
           '(select USERSDEP.USERS from USERSDEP where USERSDEP.DEPT=:_f)) or B_PERM_U.FULL=\'T\')) and '+
           'USERS.REFERENCE not in (select :_e.USERS from :_e where '+
           ':_e.'+'REJ'+'=\':_d\')';
   USERS.f_set('KOD','',_where,REF.FIRMA,_bperm,_upraw,$_tab_dane.ref(),__usersrej,_tab_dane.ODD,_bpermrej);
   {? USERS.f_size()>0 & ~USERS.f_test()
   || USERS.f_first()
   ?}
?};

grp_disp(USERS,_env.WIN_US);
_bez:=':';
{? grp_empty(USERS,_env.WIN_US)
|| _bez:='N:N'
?};
__usersrej.actions(_win_usersrej,_bez,,1);
grp_disp(__usersrej,_win_usersrej);
~~


\duu_usersrej_filtr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wyliczenie tabel do filtrowanie USERSREJ i USERS
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='REJ'
|| _ndx_usersrej:=__usersrej.ndx_tmp(,1,'USERS',,,'REJ',,)
|| return(0)
?};

B_PERM.cntx_psh();
B_PERM.index('NAME');
B_PERM.prefix('FJKS');
{? B_PERM.first() || _bperm:=B_PERM.ref() || _bperm:=null ?};
B_PERM.prefix('FREJ');
{? B_PERM.first() || _bpermrej:=B_PERM.ref() || _bpermrej:=null ?};
B_PERM.cntx_pop();

{? var_pres('TAB_FILTR_USERS',_env)>100
|| obj_del(_env.TAB_FILTR_USERS)
?};
{? var_pres('TAB_FILTR_USERSREJ',_env)>100
|| obj_del(_env.TAB_FILTR_USERSREJ)
?};

_env.TAB_FILTR_USERSREJ:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS',
            'USERSREJ','STRING[16]','Ref SQL USERSREJ'
            );
_env.TAB_FILTR_USERS:=
    tab_tmp(1,
            'USERS','STRING[16]','Ref SQL USERS'
            );

__usersrej.cntx_psh();
__usersrej.index(_ndx_usersrej);
B_PERM_U.cntx_psh();
B_PERM_U.index('B_PERM');
B_PERM_U.prefix(REF.FIRMA,_bperm);
{? B_PERM_U.first()
|| {!
   |? {? B_PERM_U.ACCESS='T'
      || _jest:=1;
         _notin:=1;
         _usersfz_ref0:='';
         {? 1
         || _env.TAB_DANE.first();
            {!
            |? REJ.cntx_psh(); REJ.prefix();
               {? REJ.seek(_env.TAB_DANE.REF) || _wynref:=$REJ.ref(); _oddchk:=REJ.ODD || _wynref:=''; _oddchk:=null ?};
               REJ.cntx_pop();
               __usersrej.prefix($B_PERM_U.USER,_wynref);
               {? __usersrej.first()
               || {? _usersfz_ref0=''
                  || _usersfz_ref0:=$__usersrej.ref()
                  ?}
               || {? B_PERM_U.FULL='T'
                  || _jest:=0
                  || USERSDEP.cntx_psh(); USERSDEP.index('UNIK'); USERSDEP.prefix(REF.FIRMA,B_PERM_U.USER,_oddchk);
                     {? USERSDEP.first()
                     || _jest:=0
                     || _notin:=0
                     ?};
                     USERSDEP.cntx_pop()
                  ?}
               ?};
               _jest & _env.TAB_DANE.next()
            !}
         ?}
      || _jest:=0; _notin:=0
      ?};
      _breju:=B_PERM_U.USER;
      B_PERM_U.cntx_psh(); B_PERM_U.prefix(REF.FIRMA,_bpermrej,_breju);
      {? B_PERM_U.first()
      || {? _notin
         || {? _jest
            || _env.TAB_FILTR_USERSREJ.blank();
               _env.TAB_FILTR_USERSREJ.USERS:=$B_PERM_U.USER;
               _env.TAB_FILTR_USERSREJ.USERSREJ:=_usersfz_ref0;
               _env.TAB_FILTR_USERSREJ.add()
            || _env.TAB_FILTR_USERS.blank();
               _env.TAB_FILTR_USERS.USERS:=$B_PERM_U.USER;
               _env.TAB_FILTR_USERS.add()
            ?}
         ?}
      ?};
      B_PERM_U.cntx_pop();
      B_PERM_U.next()
   !}
?};
B_PERM_U.cntx_pop();
__usersrej.cntx_pop();
__usersrej.ndx_drop(_ndx_usersrej);
~~


\duu_kas_mul_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS:  Uprawnienia użytkowników do danych, wg danych - okno multikas MKASA
::   WY: okno
::----------------------------------------------------------------------------------------------------------------------
_wid:='duu_kas_mul';
_win:=MKASA.mk_sel('Uprawnienia do multikas'@,'P',0,_wid,,,,,'U','T');
MKASA.win_fld(_win,POMOC,'K53',,,10,,,'Kod/symbol'@);
MKASA.win_fld(_win,,'NAZ',,,50,,,'Nazwa'@);
MKASA.win_act(_win,,'Kolejność');
MKASA.win_act(_win,0,'Rekord',,,,"POMOC.K53:=$#MKASA.ref()");
_win


\duu_users_rfr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [23.25]
:: OPIS: Uprawnienia użytkowników do danych, wg danych - przy odświeżaniu okna użytkowników
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(params_get());
_env:=params_get().env;

_upraw:=_env.UPRAW;
{? _upraw='ODDZ'
|| _users_up:=USERS_UP;
   _win_usersup:=_env.WIN_US_ODDZ
|? _upraw='MG'
|| _users_up:=USERS_UP;
   _win_usersup:=_env.WIN_US_MG
|? _upraw='STS'
|| _users_up:=USERS_UP;
   _win_usersup:=_env.WIN_US_STS
|? _upraw='STZ'
|| _users_up:=USERS_UP;
   _win_usersup:=_env.WIN_US_STZ
|? _upraw='TARS'
|| _users_up:=TARUP;
   _win_usersup:=_env.WIN_US_TARS
|? _upraw='TARD'
|| _users_up:=TARUP;
   _win_usersup:=_env.WIN_US_TARD
|? _upraw='TR_RODZ'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_TRRODZ
|? _upraw='ZAM'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_ZAM
|? _upraw='ZAW'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_ZAW
|? _upraw='FJKS'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_ODD
|? _upraw='REJ'
|| _users_up:=__usersrej;
   _win_usersup:=_env.WIN_US_REJ
|? _upraw='HRP'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_HRP
|? _upraw='HRB'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_HRB
|? _upraw='OGRP'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_OGRP
|? _upraw='KAS_MUL'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_KAS_MUL
|? _upraw='KAS'
|| _users_up:=B_PERM_U;
   _win_usersup:=_env.WIN_US_KAS
|| return(~~)
?};
{? _env.ENV_ID=0
||_bez:=':';
  {? grp_empty(USERS,_env.WIN_US)
   || _bez:='N:N'
   ?};
   USERS.cntx_psh();
   _users_up.actions(_win_usersup,_bez,,1);
   grp_disp(_users_up,_win_usersup);
   USERS.cntx_pop()
?};
~~

:Sign Version 2.0 jowisz:1048 2023/06/23 14:14:36 c473c3848eb9a9cf21914b7b6f49a972e286f8e4368641541c1cba2a2fd1d87fe88ac62af3f30cbbb27b693da353ca3ca284a7e32a955b9b10c6ed0276b9f3fa52931ca72a992b9aad3ceaf3229d9d74e4f4641134ce8ff68fffb3ab6cffd98d78e5f01fa5d171e5bc77bfa99eabcdc8a2ea5a75da41bd655d1f0e4577de9eb1
