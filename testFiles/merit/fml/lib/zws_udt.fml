:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: zws_udt.fml
:: Utworzony: 02.09.2019
:: Autor: MB
::======================================================================================================================
:: Zawartość: Formuły od obsługi umów
::======================================================================================================================


\udt_add_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.14]
:: OPIS: Dodaje okno umów do okna grupowego obszaru umów
::   WE: _a - tabela
::       _b - akronim okna grupowego
::       _c - formuła po odświeżeniu
::  OLD: \udt_add_win/umowy_wspolne.fml
::----------------------------------------------------------------------------------------------------------------------
exec('set_fml','#field',UD_POM,'JORG',
   "UD_POM.JORG:=UDT.JORG().SYMBOL; ~~",
   "exec('domyslny','schemat','PODZORG')<>null",
   "exec('ud_def_symbol_f3','schemat','PODZORG')",
   "  {? fld()='' || UDT.JORG:=null; return(1) ?};
      _ref:=exec('ud_def_symbol_ae','schemat',UD_SCH.ref());
      {? _ref
      || UDT.JORG:=_ref;
         fld(UDT.JORG().SYMBOL)
      ?}
   "
);
exec('udt_zakres','zws_udt');
_a.grp_sel(_b,UDT,'WER',,_c,,,,,,,,'maximized_with_title');
~~


\udt_zakres
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.14]
:: OPIS: Ustawia zakres przeglądanych umów
::  OLD: \udt_zakres/umowy_wspolne.fml
::----------------------------------------------------------------------------------------------------------------------
{? ROZNE.UDT_ZAK=''
|| UDT.index('UDTKOD'); UDT.prefix(REF.FIRMA)
|| UDT.index('ZAK'); UDT.prefix(REF.FIRMA,ROZNE.UDT_ZAK,)
?};
UDT.win_sel('WER');
UDT.hdr_sel();
UDT.hdr_sel(
   ' - '+
   {? ROZNE.UDT_ZAK='N'
   || 'Aktywne'
   |? ROZNE.UDT_ZAK='X'
   || 'Anulowane'
   |? ROZNE.UDT_ZAK='T'
   || 'Zakończone'
   || 'Wszystkie'
   ?}
)


\udt_add_zal_win
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.14]
:: OPIS: Dodaje okno załaczników do tabeli UDT
::   WE: _a - tabela
::       _b - okno grupowe
::  OLD: \udt_add_zal_win/umowy_wspolne.fml
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('__CTR');
__CTR:=obj_new('BTAB','BBLOB','TAB','WIN_ID','WIN_ACR','DIR_SEP','DND');
__CTR.BTAB:='DOKUM';
__CTR.TAB:='UDT';
__CTR.BBLOB:='DOKUM';
__CTR.WIN_ACR:=exec('mk_ctr','srsr_zal','utd_dokum_ctr',':');
__CTR.WIN_ID:=-(1-__CTR.WIN_ACR);
__CTR.DIR_SEP:=exec('sep','#file',1);
__CTR.DND:=1;
_bf:=$('exec(\'bobs_dokum\',\'srsr_zal\',exec(\'chk_role\',\'#b__box\',OPERATOR.USER,\'ZWS_PAR_KUMR\')=0 | UDT.ZAK<>\'N\')');
_fml:="exec('udt_zal_ar','rozrach')";
_a.grp_ctr(_b,DOKUM,__CTR.WIN_ACR,__CTR.WIN_ID,'Załączniki'@,_fml,,,,,_bf,,,'maximized');
_grp:=DOKUM.grp_make('Załączniki umowy',,'#udt_zal');
DOKUM.grp_ctr(_grp,DOKUM,__CTR.WIN_ACR,__CTR.WIN_ID,'Załączniki'@,_fml,,,,,_bf,,,'maximized');
DOKUM.win_sel(_grp);
DokumSel:=_grp;
~~

:Sign Version 2.0 jowisz:1048 2023/06/23 14:14:35 4dfe86890b64ab4128ca967296ff876d9c6bc2ae92489bde5ef6b47bf375899ad4bb10bec191bf7001f145c7f6980e78865c85d3571ae5735b7d7687f041121bb88911fe51f3f64989b35f50468707b4acb31a376d29cb32191631b09f659685d9078f7b05a40dc85ffff64212c899faf7e4db2187b106d9916d6bc12317effa
