:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: por_wdg.fml
:: Utworzony: 12.11.2019
:: Autor: RWR
::======================================================================================================================
:: Zawartość: Formuły obszaru POR_WDG - Wydarzenia grupowe.
::======================================================================================================================


\_cfg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [20.42]
:: OPIS: Kastomizacja działania.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_cfg:=exec('_cfg','portal_bip','BIPNAG');

_cfg.area:=1;
_cfg.uid:='POR_BIP_RWDG';
_cfg.funkc:='WDRZ';

_cfg.bipkat.wd:=_cfg.funkc+'S';
_cfg.bipkat.we:=exec('bipkat_we','portal_bip',_cfg.funkc,0);
_cfg.bipkat.wp:=exec('bipkat_we','portal_bip',_cfg.funkc,1);
:: Wydarzenia mają dedykowane okno słownika - tytuł z MacroBUILDER-a.
_cfg.bipkat.SLO_hdr_sel:='';
_cfg.bipkat.RED_hdr_edit:='Kategoria wydarzeń'@;

_cfg.bipnag_wnds.nag_ws:=exec('_mk_sel','por_wdg',_cfg);
_cfg.bipnag_wnds.nag_edit:=_cfg.funkc+'R';
_cfg.bipnag_wnds.nag_patt:=_cfg.funkc+'S';
_cfg.bipnag_wnds.grp_title:='Wydarzenia grupowe'@;
_cfg.bipnag_wnds.kryt_tab:='Kryteria uczestnictwa'@;
_cfg.bipnag_wnds.odb_ws:=_cfg.funkc;
_cfg.bipnag_wnds.odb_tab:='Uczestnicy'@;

_cfg.bipnag_main.brak:='Brak uczestników wydarzenia.'@;
_cfg.bipnag_main.id:="'%1 %2 - %3 %4 | %5' [BIPNAG.DT1$1,BIPNAG.GD1$1,BIPNAG.DT2$1,BIPNAG.GD2$1,BIPNAG.TYTUL]";
_cfg.bipnag_main.on:='B';
_cfg.bipnag_main.off:='C';

_cfg.bipnag_on.ask1:='Czy aktywować zaznaczone wydarzenie?'@;
_cfg.bipnag_on.askn:='Czy aktywować zaznaczone wydarzenia?'@;
_cfg.bipnag_on.title:='Raport z aktywacji wydarzeń'@;
_cfg.bipnag_on.askb:='Czy aktywować bieżące wydarzenie?'@;
_cfg.bipnag_on.root_odb:='Wydarzenia bez uczestników'@;
_cfg.bipnag_on.root_ok:='Wydarzenia niewymagające aktywacji (aktywowane już wcześniej)'@;

_cfg.bipnag_off.ask1:='Czy dezaktywować zaznaczone wydarzenie?'@;
_cfg.bipnag_off.askn:='Czy dezaktywować zaznaczone wydarzenia?'@;
_cfg.bipnag_off.title:='Raport z dezaktywacji wydarzeń'@;
_cfg.bipnag_off.askb:='Czy dezaktywować bieżące wydarzenie?'@;
_cfg.bipnag_off.confirm:="
   _par:=_a;
   _gr:=_b;
   _ok:=0;
   _dt:=date();
   _gd:=time();
   {? BIPNAG.DT1<_dt | (BIPNAG.DT1=_dt & BIPNAG.GD1<_gd)
   || {? _gr
      || KOMM.set_root('Wydarzenia z ""przeszłości"" - dezaktywacja grupowa nie jest możliwa'@);
         KOMM.add(_par.bipnag_main.id());
         KOMM.sect_end()
      || _ok:=FUN.ask(
            'Termin rozpoczęcia wydarzenia już minął.\n'
            'Czy na pewno chcesz kontynuować?'@
         )
      ?}
   || _ok:=1
   ?};
   _ok
";
_cfg.bipnag_off.root_ok:='Wydarzenia niewymagające dezaktywacji (dezaktywowane już wcześniej)'@;

_cfg.bipodb_usun.ask1:='Czy usunąć zaznaczonego uczestnika?'@;
_cfg.bipodb_usun.askn:='Czy usunąć zaznaczonych uczestników?'@;
_cfg.bipodb_usun.title:='Raport z usuwania uczestników'@;
_cfg.bipodb_usun.askb:='Czy usunąć bieżącego uczestnika?'@;
_cfg.bipodb_usun.root_r:='Uczestnicy niemogący być usunięci (status inny niż ''R'').'@;

_cfg.bipodb_wyklucz.ask1:='Czy wykluczyć zaznaczonego uczestnika?'@;
_cfg.bipodb_wyklucz.askn:='Czy wykluczyć zaznaczonych uczestników?'@;
_cfg.bipodb_wyklucz.title:='Raport z wykluczania uczestników'@;
_cfg.bipodb_wyklucz.askb:='Czy wykluczyć bieżącego uczestnika?'@;
_cfg.bipodb_wyklucz.root_a:='Uczestnicy niemogący być wykluczonymi (status inny niż ''A'').'@;

_cfg.bipodb_uwzglednij.ask1:='Czy uwzględnić zaznaczonego uczestnika?'@;
_cfg.bipodb_uwzglednij.askn:='Czy uwzględnić zaznaczonych uczestników?'@;
_cfg.bipodb_uwzglednij.title:='Raport z uwzględniania uczestników'@;
_cfg.bipodb_uwzglednij.askb:='Czy uwzględnić bieżącego uczestnika?'@;
_cfg.bipodb_uwzglednij.a2r:="
   '%1 %2 (PESEL: %3): uczestnik nie spełnia obecnych kryteriów.\n'
   'Zmiana statusu na ''A'' nie jest możliwa.\n'
   'Uczestnik otrzymał status ''R''.'@
   [OSOBA.NAZWISKO,OSOBA.PIERWSZE,OSOBA.PESEL]";
_cfg.bipodb_uwzglednij.rootr:='Uczestnicy niespełniający obecnych kryteriów - status zmieniony na ''R''.'@;
_cfg.bipodb_uwzglednij.root_w:='Uczestnicy niemogący być uwzględnionymi (status inny niż ''W'').'@;

_cfg.bipodb_powiadom.ask1:='Czy usunąć informacje o powiadomieniu zaznaczonego uczestnika\n'
                           'celem umożliwienia wysłania powiadomienia ponownie?'@;
_cfg.bipodb_powiadom.askn:='Czy usunąć informacje o powiadomieniu zaznaczonych uczestników\n'
                           'celem umożliwienia wysłania powiadomienia ponownie?'@;
_cfg.bipodb_powiadom.title:='Raport z usunięcia informacji o powiadomieniach uczestników'@;
_cfg.bipodb_powiadom.askb:='Czy usunąć informacje o powiadomieniu bieżącego uczestnika\n'
                           'celem umożliwienia wysłania powiadomienia ponownie?'@;
_cfg.bipodb_powiadom.root_ok:='Uczestnicy niewymagający usunięcia informacji (brak powiadomienia)'@;

_cfg


\_mk_sel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [20.42]
:: OPIS: Formuła tworzy dynamiczne okno wertowania dla tabeli BIPNAG.
::   WE: _a [ARRAY] - Tablica elementów nazwanych z parametryzacją.
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_cfg:=_a;

_ws:=BIPNAG.mk_sel(,'P',,'#nag_'+(-_cfg.funkc),,,,,'U');

BIPNAG.win_fld(_ws,,'BIPKAT','KOD',,'8,12',,1,'Kategoria - kod'@,,'Kod kategorii wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'BIPKAT','NAZWA',,16,,1,'Kategoria - nazwa'@,,'Nazwa kategorii wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'TYTUL',,,35,,1,'Tytuł'@,,'Tytuł wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,EDIT_VAR,'AUTOR',,,20,,1,'Organizator'@,,'Organizator wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'MIEJSCE',,,25,,1,,,'Lokalizacja wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'AKT',,,-3,,1,'Opublikowane'@,,'Wydarzenie grupowe widoczne na portalu [T/N]'@,2,,"'T'","'N'");
BIPNAG.win_fld(_ws,,'LODB',,,-5,,1,'Liczba uczestników'@,,'Liczba uczestników wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'DT1',,,-10,,1,'Data rozpoczęcia'@,,'Data rozpoczęcia wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'GD1',,,'-5,9',,1,'Godzina rozpoczęcia'@,,'Godzina rozpoczęcia wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'DT2',,,-10,,1,'Data zakończenia'@,,'Data zakończenia wydarzenia grupowego'@);
BIPNAG.win_fld(_ws,,'GD2',,,'-5,9',,1,'Godzina zakończenia'@,,'Godzina zakończenia wydarzenia grupowego'@);

{! _empty:=0 .. 1
|! BIPNAG.win_act(_ws,_empty,'Dołącz',,,'Dołączenie nowego zapisu'@,,"0",_empty);
   task_attach(_cfg.uid)
!};
BIPNAG.win_btn(_ws,'text=%1' ['Dołącz'@],'menu:D');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Popraw',,,'Poprawienie bieżącego zapisu'@,,"params_exec('bipnag_popraw_a','portal_bip')");
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Popraw'@],'menu:P',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Usuń',,,'Usunięcie bieżącego zapisu'@);
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Usuń'@],'menu:U',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Formuła','Pu&blikuj'@@,,'Udostępnienie wydarzenia grupowego na portalu'@,
   "params_exec('bipnag_aktn_b','portal_bip')",,,
   1,
   "params_exec('bipnag_aktn_bg','portal_bip')",
   "params_exec('bipnag_aktn_ag','portal_bip')",
   'B'
);
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Pu&blikuj'@],'menu:B',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Formuła','Wy&cofaj'@@,,'Wycofanie wydarzenia grupowego z portalu'@,
   "params_exec('bipnag_aktt_b','portal_bip')",,,
   1,
   "params_exec('bipnag_aktt_bg','portal_bip')",
   "params_exec('bipnag_aktt_ag','portal_bip')",
   'C'
);
task_attach(_cfg.uid);
BIPNAG.win_btn(_ws,'text=%1' ['Wy&cofaj'@],'menu:C',,,,,,'noempty');
task_attach(_cfg.uid);
BIPNAG.win_act(_ws,,'Formuła','Zmian&y'@@,,'Informacje o modyfikacjach bieżącego zapisu'@,"mb_exec('ZMIANY()')");
BIPNAG.win_act(_ws,,'Szukaj');
BIPNAG.win_act(_ws,,'Kolejność');
{! _empty:=0 .. 1
|! BIPNAG.win_act(_ws,_empty,'Rekord',,,,
      "params_exec('bipnag_bd','portal_bip',_a)",
      "params_exec('bipnag_ae','portal_bip')"
   )
!};

_ws

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:21 ad2a113bc91784c37e6bc7b657f0e1e4afbc8cf69b047681d834945e497a2ebffaf5e6f097bc8258d83e526599cb3163b93cf2548d72cc885f9b8f639b6a2d35b9ba823b00f5827d1f98a129705acf6d579805913373670d14727f5e5ab6f820e0dad150b9882b306ef6bc6ab56e5f5a5a4994c87d26022459ea45b22f5e6a62
