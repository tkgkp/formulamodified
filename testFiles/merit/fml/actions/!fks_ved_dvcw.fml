:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_ved_dv7w.fml
:: Utworzony: 04.12.2015
:: Autor: MB
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_VED_DVCW - Tworzenie i wysyłanie e-deklaracji CIT-8
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Tworzenie i wysyłanie e-deklaracji CIT-8 - główna formuła czynności FKS_VED_ZVCW.
::----------------------------------------------------------------------------------------------------------------------
::# permissions=FJKS
::# kind=WE, symbol=DEKLARACJA, type=_VAT_DEK, name=Deklaracja CIT-8, required=T, keyref=T
:: PARAMETRY WY:
::# kind=WY, symbol=DEKLARACJA, type=_VAT_DEK, name=Deklaracja CIT-8, required=T

params_exec('edek','fks_ved','FKS','CIT8')


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Opis na toDo czynności
::----------------------------------------------------------------------------------------------------------------------
_typ:=params_exec('desc','fks_ved','CIT8','Tworzenie i wysyłanie e-deklaracji ');
_desc:='Tworzenie i wysyłanie e-deklaracji %1'@@[_typ]


\clean
::----------------------------------------------------------------------------------------------------------------------
::  UTW: JK [23.25]
:: OPIS: Funkcja czyszcząca czynności - w razie potrzeby jak nie ma rekordu kluczowego lub dokument jest zaakceptowany
::       zrobi done albo cancel
::       Dodatkowo może być wywoływana przez czynność czyszczącą zadania na TODO
::   WE: [_a] - _mp - obiekt Menadżera procesów
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')>100
|| _mp:=_a
|| _mp:=params_get().mp
?};
_wy:=_mp.load(exec('kind_out','#b_port'));
_keyRefs:=_mp.getRefs();
{? obj_len(_keyRefs)>0
|| {! _it:=1..obj_len(_keyRefs)
   |! _kref:=_keyRefs[_it];
      {? type_of(_kref)>0
      || {? ref_name(_kref)*'vat_dek'>0
         || _record:=exec('FindAndGet','#table',VAT_DEK,_kref,,,null());
            {? _record=null()
            || _mp.done()
            ?}
         ?}
      ?}
   !}
?};
1

:Sign Version 2.0 jowisz:1048 2023/06/23 14:09:41 d12df421e4db9bcd0cf2f3efc3fa9efd5287bbb19b162e04820e0f88a5cb4d004343575ae49f602ea8fa22cd0c7ac7e8a5fdf0378591cd1331837f12ace02d1f9bcd17d0809aaf5acf937a584d5ae3f95768cf8b3f9884009e5084d86d7935c015467c0d3f6562eb57356fa5a8b166bef2754f2f0ce13483c546374ce8dead0b
