:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !por_zrd_rzrd.fml
:: Utworzony: 24.08.2021
:: Autor: RWR
::======================================================================================================================
:: Zawartość: Formuły czynności POR_ZRD_RZRD - Rej. zestawień rocznych.
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Rej. zestawień rocznych - główna formuła czynności.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zrdr_akcje
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Formuła dla bieżącego rekordu tabeli ZRDR określa dostępność akcji w oknie wertowania.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_akcje:=obj_new('aktualizuj');
:: Wstępnie - wszystkie akcje są niedostępne. Elementy tablicy wskazują na
{! _lp:=1 .. obj_len(_akcje)
|! _akcje[_lp]:=0
!};

{? ZRDR.get()
|| _akcje.aktualizuj:=ZRDR.sel_size() | ZRDR.HASH<>exec('o_hash','portal_zestrocz',ZRDR.ROK)
?};

_akcje


\zrdr_bd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Rekord - przed" w oknie WER tabeli ZRDR.
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _akcje:=exec('zrdr_akcje','!por_zrd_rzrd');
   _ag:='';
   {? ~_akcje.aktualizuj
   || _ag+='A'
   ?};
   ZRDR.actions_grayed('WER',_ag)
?};

ZRDN.cntx_psh();
ZRDN.index('ZRDR');
ZRDN.prefix(ZRDR.ref());
{? ~ZRDN.first()
|| POLA_GRP.TXT_1:='Brak danych'
|? ZRDR.HASH=exec('o_hash','portal_zestrocz',ZRDR.ROK)
|| POLA_GRP.TXT_1:='Dane aktualne'
|| POLA_GRP.TXT_1:='Dane wymagają aktualizacji'
?};
ZRDN.cntx_pop();
~~


\zrdr_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Rekord - po" w oknie WER tabeli ZRDR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
:: W oknie nie ma akcji "Popraw".
exec('zrdr_chk','portal_zestrocz',0)


\zrdr_dolacz_a
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Dołącz - po" w oknie WER tabeli ZRDR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
win_disp();
{? FUN.ask(
      'Czy przygotować zestawienia rocznych wynagrodzeń pracowników za rok %1?'@ [$ZRDR.ROK]+'\n'+
      '(operacja może być czasochłonna)'@
   )
|| exec('aktualizuj','portal_zestrocz',ZRDR.ROK)
?};
0


\zrdr_usun_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Usuń - przed" w oknie WER tabeli ZRDR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ZRDR.sel_size() |
   FUN.ask('Czy na pewno chcesz usunąć zestawienia rocznych wynagrodzeń pracowników za rok %1?'@ [$ZRDR.ROK])
|| ZRDR.del()
?}


\zrdr_usun_bg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Usuń - grupa przed" w oknie WER tabeli ZRDR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
FUN.ask(
   'Operacja spowoduje usunięcie zestawień rocznych wynagrodzeń pracowników dla zaznaczonych lat.'@+'\n'+
   'Czy na pewno chesz kontynuować?'@
)


\zrdr_aktualizuj_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Aktualizuj - przed" w oknie WER tabeli ZRDR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('zrdr_akcje','!por_zrd_rzrd').aktualizuj
|| melody()
|? ZRDR.sel_size() |
   FUN.ask(
      'Czy zaktualizować zestawienia rocznych wynagrodzeń pracowników za rok %1?'@ [$ZRDR.ROK]+'\n'+
      '(operacja może być czasochłonna)'@
   )
|| exec('aktualizuj','portal_zestrocz',ZRDR.ROK)
?}


\zrdr_aktualizuj_bg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Aktualizuj - grupa przed" w oknie WER tabeli ZRDR.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
FUN.ask(
   'Czy zaktualizować zestawienia rocznych wynagrodzeń pracowników dla zaznaczonych lat?'@+'\n'+
   '(operacja może być czasochłonna)'@
)


\zrdn_akcje
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Formuła dla bieżącego rekordu tabeli ZRDN określa dostępność akcji w oknie wertowania.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_akcje:=obj_new('aktualizuj','pokaz','ukryj');
:: Wstępnie - wszystkie akcje są niedostępne. Elementy tablicy wskazują na
{! _lp:=1 .. obj_len(_akcje)
|! _akcje[_lp]:=0
!};

{? ZRDN.get()
|| _grp:=ZRDN.sel_size();
   _akcje.aktualizuj:=_grp | ZRDN.HASH<>exec('o_p_hash','portal_zestrocz',ZRDR.ROK,ZRDN.P);
   _akcje.pokaz:=_grp | ZRDN.PRACWID='N';
   _akcje.ukryj:=_grp | ZRDN.PRACWID='T'
?};

_akcje


\zrdn_bd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Rekord - przed" w oknie WER tabeli ZRDR.
::   WE: _a [NUMBER] - Rekord bieżący? [0 - nie / 1 - tak]
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? _a
|| _akcje:=exec('zrdn_akcje','!por_zrd_rzrd');
   _ag:='';
   {? ~_akcje.aktualizuj
   || _ag+='A'
   ?};
   {? ~_akcje.pokaz
   || _ag+='O'
   ?};
   {? ~_akcje.ukryj
   || _ag+='J'
   ?};
   ZRDN.actions_grayed('WER',_ag)
?};
{? ZRDN.HASH=exec('o_p_hash','portal_zestrocz',ZRDR.ROK,ZRDN.P)
|| POLA_GRP.TXT_2:='Dane aktualne'
|| POLA_GRP.TXT_2:='Dane wymagają aktualizacji'
?};
~~


\zrdn_aktualizuj_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Aktualizuj - przed" w oknie WER tabeli ZRDN.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('zrdn_akcje','!por_zrd_rzrd').aktualizuj
|| melody()
|? ZRDN.sel_size() |
   FUN.ask(
      'Czy zaktualizować zestawienie rocznego wynagrodzenia za rok %1 dla bieżącego pracownika?'@ [$ZRDR.ROK]+'\n'+
      '(operacja może być czasochłonna)'@
   )
|| exec('aktualizuj','portal_zestrocz',ZRDR.ROK,ZRDN.P)
?}


\zrdn_aktualizuj_bg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Aktualizuj - grupa przed" w oknie WER tabeli ZRDN.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
FUN.ask(
   'Czy zaktualizować zestawienia rocznych wynagrodzeń za rok %1 dla zaznaczonych pracowników?'@ [$ZRDR.ROK]+'\n'+
   '(operacja może być czasochłonna)'@
)


\zrdn_pokaz_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Pokaż - przed" w oknie WER tabeli ZRDN.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('zrdn_akcje','!por_zrd_rzrd').pokaz
|| melody()
|? ZRDN.PRACWID<>'T' & (ZRDN.sel_size() | FUN.ask('Czy zapis ma być widoczny dla pracownika?'@))
|| ZRDN.PRACWID:='T';
   ZRDN.put()
?}


\zrdn_pokaz_bg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Pokaż - grupa przed" w oknie WER tabeli ZRDN.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
FUN.ask('Czy zaznaczone zapisy mają być widoczne dla pracowników?'@)


\zrdn_ukryj_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Ukryj - przed" w oknie WER tabeli ZRDN.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('zrdn_akcje','!por_zrd_rzrd').ukryj
|| melody()
|? ZRDN.PRACWID<>'N' & (ZRDN.sel_size() | FUN.ask('Czy zapis ma być niewidoczny dla pracownika?'@))
|| ZRDN.PRACWID:='N';
   ZRDN.put()
?}


\zrdn_ukryj_bg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [21.37]
:: OPIS: Obsługa akcji "Ukryj - grupa przed" w oknie WER tabeli ZRDN.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
FUN.ask('Czy zaznaczone zapisy mają być niewidoczne dla pracowników?'@)

:Sign Version 2.0 jowisz:1045 2022/06/30 14:22:52 50bfbf264449c2df076eaa529df320eb3e8ea6a99b5f31773263e241563292fbe15ef4e84292f7f70b3d9d09e74bb73d6439b73ce366a1edc6ef1872f85dfe7ac80afdf7215890a2ba9772e2525c3048dc0661af60f1ef18e2303d02da90b3a6c293a8e6deef186d532d3be31a674a7457aefe638bb7766501f9d292f79465e7
