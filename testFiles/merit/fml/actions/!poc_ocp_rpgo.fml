:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !poc_ocp_rpgo.fml
:: Utworzony: 07.08.2017
:: Autor: RWR
::======================================================================================================================
:: Zawartość: Formuły czynności POC_OCP_RPGO - Rejestracja programu ocen.
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Rejestracja programu ocen - główna formuła czynności.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
~~


\zo_prof_dolacz_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Obsługa akcji "Dołącz - przed" w tabeli ZO_PROF.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
ZZ_PROF.cntx_psh();
ZZ_PROF.prefix();
ZZ_PROF.f_set(
   'NAZWA',
   'join "SLO_KOD" using("ZZ_PROF".RODZAJ,"SLO_KOD".REFERENCE)',
   '"ZZ_PROF".ZZ_HIST=:_a and "SLO_KOD".KOD in (\'O\',\'S\') and "ZZ_PROF".REFERENCE not in (select ZZ_PROF from :_b)',
   ZZ_POM.ZZ_HIST,sql('select ZO_PROF.ZZ_PROF from ZO_PROF where ZO_PROF.ZO_PROG=:_a order by 1',ZO_PROG.ref())
);
_args:=exec('zz_prof_wybierz_args','phr_widok');
_args.ZZ_HIST:=1;
_ZZ_PROF:=exec('zz_prof_wybierz','phr_widok',_args);
{? _ZZ_PROF.first()
|| ZZ_PROF.cntx_psh();
   ZZ_PROF.f_clear();
   ZZ_PROF.prefix();
   {!
   |? {? ZZ_PROF.seek(_ZZ_PROF.UID)
      || ZO_PROF.blank();
         ZO_PROF.ZO_PROG:=ZO_PROG.ref();
         ZO_PROF.ZZ_PROF:=ZZ_PROF.ref();
         ZO_PROF.add()
      ?};
      _ZZ_PROF.next()
   !};
   ZZ_PROF.cntx_pop()
?};
ZZ_PROF.f_clear();
ZZ_PROF.cntx_pop();
~~


\zf_wyk_dolacz_b
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [17.42]
:: OPIS: Obsługa akcji "Dołącz - przed" w tabeli ZF_WYK.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
ZF_DEF.cntx_psh();
ZF_DEF.prefix();
ZF_DEF.f_set(
   'NAZWA',,
   '"ZF_DEF".FIRMA=:_a and "ZF_DEF".REFERENCE not in (select ZF_DEF from :_b)',
   exec('ref_firma','ustawienia'),
   sql('select ZF_DEF from ZF_WYK where ZF_WYK.NP_DOK=\':_a\' and ZF_WYK.ZZ_LINK=:_b order by 1',
      ZO_PROG.NP_DOK,ZO_PROG.ZZ_DOK
   )
);
_ZF_DEF:=exec('zf_def_wybierz','phr_widok');
{? _ZF_DEF.first()
|| ZF_DEF.cntx_psh();
   ZF_DEF.f_clear();
   ZF_DEF.prefix();
   {!
   |? {? ZF_DEF.seek(_ZF_DEF.UID)
      || ZF_WYK.blank();
         ZF_WYK.ZF_DEF:=ZF_DEF.ref();
         ZF_WYK.add()
      ?};
      _ZF_DEF.next()
   !};
   ZF_DEF.cntx_pop()
?};
ZF_DEF.f_clear();
ZF_DEF.cntx_pop();
~~

:Sign Version 2.0 jowisz:1028 2019/06/07 15:55:55 7c3f7c2ab1016c0bd01e058be12a3e8df04a9de124b2fa7c8f206534973a3c7b7538a52759edd240e0a82f5998cce076cb424a673ad50108d33d6d280657b9c93b397f915455147aefaecb8fcec4de63df2f1aa0990f7088fda40fed7911663a962b1997dcd25a99adc260cc0ab38921294a6c56cbab4f43d1912abf3888b3ba
