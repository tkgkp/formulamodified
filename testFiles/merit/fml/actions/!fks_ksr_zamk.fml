:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_ksr_zamk.fml
:: Utworzony: 23.04.2015
:: Autor: MB
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_KSR_ZAMK - Wyświetlanie zapisów
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Wyświetlanie zapisów - główna formuła czynności FKS_KSR_ZAMK
::----------------------------------------------------------------------------------------------------------------------
::# permissions=FJKS


\add_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Dodaje okno do okna grupowego
::   WE: _a - nazwa zakładki
::       _b - tabela
::       _c - okno grupowe
::----------------------------------------------------------------------------------------------------------------------
{? ZapPoz.REPAINT=-1
|| exec('set_var','dok_fks_ks')
?};
_afrfr1:="{? f_usr_changed()
          || SUM.SUMWN:=SUM.SUMMA:=0;
             ZapPoz.TAB.cntx_psh();
             {? ZapPoz.TAB.f_active() & ZapPoz.TAB.f_first()
             || _all:=ZapPoz.TAB.f_size();
                {! |?
                   SUM.SUMWN+=ZapPoz.TAB.WN; SUM.SUMMA+=ZapPoz.TAB.MA;
                   ZapPoz.TAB.f_next()
                !}
             |? ~ZapPoz.TAB.f_active() & ZapPoz.TAB.first()
             || _all:=ZapPoz.TAB.size();
                {! |?
                   SUM.SUMWN+=ZapPoz.TAB.WN; SUM.SUMMA+=ZapPoz.TAB.MA;
                   ZapPoz.TAB.next()
                !}
             ?};
             ZapPoz.TAB.cntx_pop()
          ?}";
_afrfr2:="{? f_usr_changed()
          || {? ZapPoz.TAB.f_active()
             || exec('zap_sum2_upd2','dok_fks_ks')
             || exec('zap_sum2_upd','dok_fks_ks')
             ?};
             grp_disp(ZapPoz.TAB2,ZapPoz.WIN2)
          ?}";
{? ZapPoz.TRYB<>2
|| _b.grp_sel(_c,ZapPoz.TAB,ZapPoz.WIN,_a,_afrfr1,,,,"zakladka:=2;
   exec('context1','dok_fks_ks',0)
   ",,,,'maximized_with_title')
|| _b.grp_sel(_c,ZapPoz.TAB,ZapPoz.WIN,_a,_afrfr2,,,,"zakladka:=2;
   {? ~ZapPoz.TAB.f_active()
   || exec('zap_sum2_upd','dok_fks_ks')
   || exec('zap_sum2_upd2','dok_fks_ks')
   ?};
   grp_disp(ZapPoz.TAB2,ZapPoz.WIN2)
   ",,,,'maximized_with_title');
   _b.tab_splt(_c,,'horizontal','bottom',29);
   _b.grp_sel(_c,ZapPoz.TAB2,ZapPoz.WIN2,,"",100,,,"",,,,'maximized')
::   _b.tab_splt(_c,'bottom','vertical','bottom_right',);
::   _b.grp_sel(_c,ZapPoz.TAB2,ZapPoz.WIN2,,"",,,,"",,,,'maximized_with_title')
?};
task_attach('FKS_KSR_ZAMK');
task_attach('FKS_KSR_ZAKK');
task_attach('FKS_KSR_ZBWA');
task_attach('FKS_KSR_ZBOS');
task_attach('FKS_KSR_ZSQL');
~~


\bgw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Formula na wypelnienie okna grupowego obszaru FKS_KSR
::----------------------------------------------------------------------------------------------------------------------
{? zakladka<>7
|| {? ZapPoz.REPAINT>0
   || tab_sel(2);
      ZapPoz.REPAINT:=0;
      ZapPoz.TAB.first()
   || POZ.index('OKWAL_O');
      POZ.prefix('T','T',null,null);
      ROZNE.TYP_WYS:='';
      ROZNE.PREFIX='';
      exec('sumy','dok_fks_ks')
   ?};
   _zakladka:=zakladka;
   _ret:=grp_disp(ZapPoz.TAB,ZapPoz.WIN,1);
   zakladka:=_zakladka;
   tab_sel(zakladka);
   _ret
|| _zakladka:=zakladka;
   _ret:=grp_disp(TAB_ZOIS,TAB_ZOIS.win_sel('?'),1);
   ZapPoz.REPAINT:=0;
   zakladka:=_zakladka;
   tab_sel(zakladka);
   _ret
?}


\obl_obr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [18.22]
:: OPIS: Akcja Oblicz obroty okna tabeli POZ
::  OLD: \obl_obr/!fks_ksr_zbka.fml
::----------------------------------------------------------------------------------------------------------------------
exec('obl_obr','dok_fks',POZ,POZ.WN,POZ.MA)


\add_tab_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Dodaje okno z pozycjami do okna grupowego
::   WE: _a - nazwa zakładki
::       _b - tabela
::       _c - okno grupowe
::----------------------------------------------------------------------------------------------------------------------
_be:="POZ.cntx_psh(); DOK.cntx_psh(); AN.cntx_psh();
      _maska:=SSTALE.AR().KOD+form(SSTALE.AO().NR,-2);
      ROZNE.ROKKON:=SSTALE.AR;
      {? POZ.use('pozy'+_maska) & DOK.use('doku'+_maska)
      || {? var_pres('pozpar')>0 || POZ.f_clear() ?};
         {? OPERATOR.DEPT=null
         || {? var_pres('pozndx')<=0 || POZ.index('KS_PR') || POZ.index(pozndx) ?}; POZ.prefix('T');
            {? POZ.f_active() || exec('suma_f_dok','dok_fks') || exec('suma_dok','dok_fks') ?};
            {? POZ.first() || 1 ?}
         || {? var_pres('pozndx')<=0 || POZ.index('KS_PR') || POZ.index(pozndx) ?}; POZ.prefix('T',OPERATOR.DEPT().OD);
            {? POZ.f_active() || exec('suma_f_dok','dok_fks') || exec('suma_dok','dok_fks') ?};
            {? POZ.first() || 1 ?}
         ?};
         {? var_pres('pozrefaf')>0 & POZ.f_active()=0 & var_pres('pozpar')<=0
         || {? POZ.seek(#pozrefaf,'pozy'+_maska) || 1 ?}
         |? var_pres('pozrefaf')>0 & POZ.f_active()<>0 & var_pres('pozpar')<=0
         || {? POZ.f_seek(#pozrefaf,'pozy'+_maska) || 1 ?}
         ?}
      ?};
      ROZRACH.TABELA:='POZ'; zakladka:=6";
_af:="VAR_DEL.delete('pozrefaf','pozpar','pozndx'); pozndx:=POZ.index('?'); pozrefaf:=POZ.ref();
      POZ.cntx_pop(); DOK.cntx_pop(); AN.cntx_pop(); ROZRACH.TABELA:=''";
_rfr:="{? f_usr_changed() || {? POZ.f_active() || exec('suma_f_dok','dok_fks') || exec('suma_dok','dok_fks') ?}  ?};
       AN.cntx_psh();KS.cntx_psh();
       AN.index('SYM'); AN.prefix(POZ.KON);
       {? AN.first()
       || AN.KS();
         exec('op_konta','konto',AN.SYM,AN.KS,2);
         exec('ka_opis','konto')
       ?};
       AN.cntx_pop();KS.cntx_pop()";
_b.grp_sel(_c,POZ,'WER_T',_a,_rfr,,,,_be,_af,,,,,);
task_attach('FKS_KSR_ZAMK');
task_attach('FKS_KSR_ZAKK');
task_attach('FKS_KSR_ZBWA');
task_attach('FKS_KSR_ZBOS');
task_attach('FKS_KSR_ZSQL')


\add_tab_gvat
::----------------------------------------------------------------------------------------------------------------------
::  UTW: IFZ [23.25]
:: OPIS: Dodaje okno z Ewidencja prowadzona przez członków grupy VAT
::   WE: _a - nazwa zakładki
::       _b - tabela
::       _c - okno grupowe
::----------------------------------------------------------------------------------------------------------------------
_be:="POZ.cntx_psh(); DOK.cntx_psh(); AN.cntx_psh();
      _maska:=SSTALE.AR().KOD+form(SSTALE.AO().NR,-2);
      ROZNE.ROKKON:=SSTALE.AR;
      {? POZ.use('pozy'+_maska) & DOK.use('doku'+_maska)
      || {? var_pres('gvpar')>0 || POZ.f_clear() ?};
         {? OPERATOR.DEPT=null
         || {? var_pres('gvndx')<=0 || POZ.index('KS_GV') || POZ.index(gvndx) ?}; POZ.prefix('T','GL');
            {? POZ.f_active() || exec('suma_f_dok','dok_fks') || exec('suma_dok','dok_fks') ?};
            {? POZ.first() || 1 ?}
         || {? var_pres('gvndx')<=0 || POZ.index('KS_GV') || POZ.index(gvndx) ?}; POZ.prefix('T','GL',OPERATOR.DEPT().OD);
            {? POZ.f_active() || exec('suma_f_dok','dok_fks') || exec('suma_dok','dok_fks') ?};
            {? POZ.first() || 1 ?}
         ?};
         {? var_pres('gvref')>0 & POZ.f_active()=0 & var_pres('gvpar')<=0
         || {? POZ.seek(#gvref,'pozy'+_maska) || 1 ?}
         |? var_pres('gvref')>0 & POZ.f_active()<>0 & var_pres('gvpar')<=0
         || {? POZ.f_seek(#gvref,'pozy'+_maska) || 1 ?}
         ?}
      ?};
      ROZRACH.TABELA:='POZ'; zakladka:=8";
_af:="VAR_DEL.delete('gvref','gvpar','gvndx'); gvndx:=POZ.index('?'); gvref:=POZ.ref();
      POZ.cntx_pop(); DOK.cntx_pop(); AN.cntx_pop(); ROZRACH.TABELA:=''";
_rfr:="{? f_usr_changed() || {? POZ.f_active() || exec('suma_f_dok','dok_fks') || exec('suma_dok','dok_fks') ?}  ?}";
_b.grp_sel(_c,POZ,'WER_T',_a,_rfr,,,,_be,_af,,,,,);
task_attach('FKS_KSR_ZAMK');
task_attach('FKS_KSR_ZAKK');
task_attach('FKS_KSR_ZBWA');
task_attach('FKS_KSR_ZBOS');
task_attach('FKS_KSR_ZSQL')

:Sign Version 2.0 jowisz:1045 2023/09/29 07:47:46 623ad4185f570cffd5d591dc4b69bef6536252bf9ee3884f89baf5cf80f8e6f591e75aa0d087fa79029c39086c48969e92d60a191f4b1279af927e0772dd73e5f0dbf5889024e4a4e0e42c3a649cd49e048009e1612cc906f5d3ad27edd8697282e81febb6ef4388ec5d05d076c30875da60cc0cfa32a91affd3a3ffcd6acba0
