:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !zws_par_pscp.fml
:: Utworzony: 25.04.2017
:: Autor: areKc
::======================================================================================================================
:: Zawartość: Formuły czynności ZWS_PAR_PSCP - Systemy czasu pracy.
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DRO [17.28]
:: OPIS: Definicja systemów czasu pracy.
::   WE:
::   WY:
::  OLD: \harm01/okres.fml
::----------------------------------------------------------------------------------------------------------------------
A_SCP.cntx_psh();
A_SCP.index('A_SCP');
A_SCP.prefix();
A_SCP.win_edit('RED');
A_SCP.win_sel('WER');
A_SCP.select(,,,'W');
A_SCP.cntx_pop();
~~


\a_scp_ae_dom
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DRO [17.28]
:: OPIS: Formuła po dla pola DOM tabeli A_SCP.
::   WE:
::   WY:
::  OLD: \ascpdom/okres.fml
::----------------------------------------------------------------------------------------------------------------------
_result:=1;
{? -(1+menu_txt())='p' || _ref:=A_SCP.ref() || _ref:=null() ?};
{? A_SCP.DOM='T'
|| A_SCP.cntx_psh();
   A_SCP.index('DOM');
   A_SCP.prefix('T',);
   {? A_SCP.first()
   || {? A_SCP.ref()<>_ref
      || FUN.info('Domyślnym system czasu pracy, jest już system "%1".'@[A_SCP.NAZ]);
         A_SCP.DOM:='N';
         _result:=0
      ?}
   ?};
   A_SCP.cntx_pop()
?};
_result


\a_scp_ae_rec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DRO [17.28]
:: OPIS: Formula na rekord po dla tabeli A_SCP.
::   WE:
::   WY:
::  OLD: \a_scp_ar/okres.fml
::----------------------------------------------------------------------------------------------------------------------
__CHK.record2(A_SCP,'NAZ',,'ND',,'NST','Norma średniotygodniowa','OD','Odpoczynek dobowy','OT',)


\a_scp_be
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DRO [17.28]
:: OPIS: Przed redagowaniem lub wyświetleniem pól ze zmiennej A_SCP_P.
::   WE:
::   WY:
::  OLD: \a_scp_be/okres.fml
::----------------------------------------------------------------------------------------------------------------------
_f_A_SCP:=$("A_SCP_P."+ cur_afld()+":=('000'+"+"A_SCP."+cur_afld()+"$1)+6");
_f_A_SCP()


\a_scp_ae
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DRO [17.28]
:: OPIS: Po redagowaniu pól ze zmiennej A_SCP_P.
::   WE:
::   WY:
::  OLD: \a_scp_ae/okres.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=1;
str2time:=
   "  _min:=#(_a+2);
      _a:=_a-3;
      _godz:=#(_a);
      {? _godz>=0 & _min>=0
      || {? _min>0 & _min<60
         || time(_godz,_min,0)
         || time(_godz,0,0)
         ?}
      || time(0,0,0)
      ?}
   ";

STR.split(fld(),':');
_godz:=form(STR.get_word());
_godz:=('000' + _godz)+3;
_min:=form(STR.get_word());
_min:=('00' + _min)+2;
_f_SCP:=$("A_SCP."+cur_afld()+":=str2time(_a)");
_f_SCP_P:=$("A_SCP_P."+cur_afld()+":=_a");
_afld:=cur_afld();
{? (_afld='ND' | _afld='OD') & #_godz>24
|| FUN.emsg(
      {? _afld='ND' || 'Norma dobowa nie może przekroczyć 24 godzin.'@
      |? _afld='OD' || 'Odpoczynek dobowy nie może przekroczyć 24 godzin.'@
      ?}
   );
   _godz:='000';
   _min:='00';
   _wyn:=0
?};
_f_SCP(_godz+':'+_min);
_f_SCP_P(_godz+':'+_min);
_wyn


\a_scp_wy_bl_a_scp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DRO [17.28]
:: OPIS: Wartosc poczatkowa pola A_SCP tabeli A_SCP_WY
::   WE:
::   WY:
::  OLD: \a_scp/okres.fml
::----------------------------------------------------------------------------------------------------------------------
A_SCP.ref()


\a_scp_sel_f_zatr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DRO [17.28]
:: OPIS: Wyświetla informacje o wykluczeniach z weryfikacji norm czasu pracy dla form zatrudnienia.
::   WE:
::   WY:
::  OLD: \ascpwy01/okres.fml
::----------------------------------------------------------------------------------------------------------------------
F_ZATR.cntx_psh();
F_ZATR.win_sel('SLO');
A_SCP_WY.cntx_psh();
A_SCP_WY.win_edit('RED');
A_SCP_WY.win_sel('WER');
A_SCP_WY.prefix(A_SCP.ref());
A_SCP_WY.select();
A_SCP_WY.cntx_pop();
F_ZATR.cntx_pop()


\a_scp_wy_ae_rec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [17.28]
:: OPIS: Formula na rekord po dla tabeli A_SCP_WY.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
__CHK.record2(A_SCP_WY,'F_ZATR','Kod')

:Sign Version 2.0 jowisz:1028 2019/06/07 15:56:06 098878a5d083bf53ce5d650bdd8de676f2f441db51c9a1233f67e736f7b0f5dc587167dd6f5d296385bb58e5a5abe3db81215d1dc4a051c84d77d506fa4e5c17e465a798ff53c17b2d72f614e037b21a329d28666f4bc42f94fb65a5b9d6f3e2daf8fa43fef6c7d8c22a160d0da2f471fc9c843a59a208acfe32422f5283554b
