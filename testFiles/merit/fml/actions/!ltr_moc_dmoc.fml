:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !ltr_kar_dkar.fml
:: Utworzony: 12.09.2019
:: Autor: MW
::======================================================================================================================
:: Zawartość: Formuły czynności LTR_MOC_DMOC
::            Generowanie mocy przerobowych transportu
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.42]
:: OPIS: Czynność LTR_MOC_DMOC - formuła główna
::   WE: _a - [obj_new] - parametry wejsciowe czynności
::       _b - [obj_new] - parametry wewnętrzne czynności
::       _c - [obj_new] - parametry wyjściowe czynności
::       _d - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
::# permissions=TR_RODZ
::# kind=WY,   symbol=SAMK,  type=_SAMK,  name=Karta drogowa,     required=N
_in:=params_get().in;
_out:=params_get().out;
_mp:=params_get().mp;

:: Uruchomiona akcja
_akcja:=_mp.akcja();
_area:=_mp.pathArea('LTR_ZLE');
_proc:=_mp.pathProc();
_todo:=_mp.pathTodo() | (_mp.pathArea() & ~_area);

exec('init','ltr');

{? _mp.pathTodo()
:: Ustawienie kontekstu wg instancji elementu w procesie
|| {? ~_mp.isMicro()
   || _akcja:='START_TODO'
   ?}
?};

:: Sprawdzenie uprawnień
params_set('in',_in,'user',OPERATOR.USER,'mp',_mp);
{? exec('permissions','!ltr_moc_dmoc')=0
|| _mp.error('Brak uprawnień do uruchomienia czynności.'@);
   return()
?};

_mp.trigRef('SAMK',,1,,exec('kind_out','#b_port'),'SAMK');

{? _akcja='Generuj' | _mp.pathProc() | _akcja='START_TODO'
:: Obsługa Generuj - generuj w oknie obszaru i start procesu z pulpitu
|| params_set('out',_out,'mp',_mp);
   exec('tr_moc_generuj','transport_moc');
   _mp.done()
|| _mp.error('Nieobsługiwana ścieżka.')
?}


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Formuła TO-DO
::       UWAGA. Do pobrania parametrów stosować params_get() = tablica nazwana:
::       mp  - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
_mp:=params_get().mp;
_out:=_mp.load(exec('kind_out','#b_port'));

'Wygeneruj moc przerobową transportu'@@


\permissions
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MW [19.22]
:: OPIS: Formuła na uprawnienia dla czynności
::   WE: params_get().in - parametry wejściowe czynności
::           params_get().user - użytkownik dla którego sprawdzane są uprawnienia
::           params_get().mp - Menedżer Procesów
::   WY: 0 - użytkownik nie ma uprawnień do czynności
::       1 - użytkownik ma uprawnienia do czynności
::----------------------------------------------------------------------------------------------------------------------
_in:=params_get().in;
_user:=params_get().user;
_mp:=params_get().mp;
_wyn:=1;
_wyn

:Sign Version 2.0 jowisz:1045 2021/09/17 15:16:57 bfac504125c62f91c5df09b508f72d84bff0d020b8f494742817586ac6d99c2bbfc37400df2cff56ecabe39b87d27b1be2e7a171b2fccff339898dee18efb5611d4f7451e7d2be0994659487a9b94b40fcf800d0d217ac52d130f31302271dfd912845f6bfeb1016a8c3c2842a72964f0c03eb959c0a9d206a9931d73b675458
