:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_ksr_zbob.fml
:: Utworzony: 20.05.2015
:: Autor: PJ
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_KSR_ZBOB - Obroty kont
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PJ [17.00]
:: OPIS: Obroty kont - główna formuła czynności FKS_KSR_ZBOB.
::----------------------------------------------------------------------------------------------------------------------
::# permissions=FJKS
~~


\add_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Dodaje okno do okna grupowego
::   WE: _a - nazwa zakładki
::       _b - tabela
::       _c - okno grupowe
::----------------------------------------------------------------------------------------------------------------------
exec('set_var','!fks_ksr_zbob');
dwiewalo:=0;
exec('obr_create','!fks_ksr_zbob');
{? var_press('TAB_OBR')<=0
|| exec('tab_create','fks_ksr')
?};
_b.grp_sel(_c,TAB_OBR,TAB_OBR.win_sel('?'),_a,"",,,,"zakladka:=3;exec('get_global','!fks_ksr_zbob');dwiewalo:=0;zm_wal:=0",
           "exec('set_global','!fks_ksr_zbob'); exec('set_global','!fks_ksr_zboc')",,,'maximized_with_title');
task_attach('FKS_KSR_ZBOB')

\set_global
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PJ [17.00]
:: OPIS: Ustawienie zmiennych globalnych do obrotów
::----------------------------------------------------------------------------------------------------------------------
__OBR.UT_OKROD:=ROZNE.UT_OKROD;
__OBR.UT_OKRDO:=ROZNE.UT_OKRDO;
__OBR.UT_ROKOD:=ROZNE.UT_ROKOD;
__OBR.UT_ROKDO:=ROZNE.UT_ROKDO;
__OBR.PAR4:=ROZNE.PAR4;
__OBR.PREFIX:=ROZNE.PREFIX;
__OBR.MASKA:=ROZNE.MASKA;
__OBR.PSLO:=UNPAR.PSLO


\get_global
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PJ [17.00]
:: OPIS: Użycie zmiennych globalnych do obrotów
::----------------------------------------------------------------------------------------------------------------------
ROZNE.UT_OKROD:=__OBR.UT_OKROD;
ROZNE.UT_OKRDO:=__OBR.UT_OKRDO;
ROZNE.UT_ROKOD:=__OBR.UT_ROKOD;
ROZNE.UT_ROKDO:=__OBR.UT_ROKDO;
ROZNE.PAR4:=__OBR.PAR4;
ROZNE.PREFIX:=__OBR.PREFIX;
ROZNE.MASKA:=__OBR.MASKA;
UNPAR.PSLO:=__OBR.PSLO


\obr_create
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PJ [17.00]
:: OPIS: Inicjowanie zmiennych globalnych do obrotów
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__OBR')<0
|| __OBR:=obj_new('UT_OKROD','UT_OKRDO','UT_ROKOD','UT_ROKDO','PAR4','PREFIX','MASKA','PSLO')
?};
__OBR.UT_OKROD:=__OBR.UT_OKRDO:=SSTALE.AO;
__OBR.UT_ROKOD:=__OBR.UT_ROKDO:=SSTALE.AR;
__OBR.PAR4:=0;
__OBR.PREFIX:=__OBR.MASKA:='';
__OBR.PSLO:=null


\set_var
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PJ [17.00]
:: OPIS: Ustawia zmienne po zmianie stałych
::----------------------------------------------------------------------------------------------------------------------
dwiewalo:=0;
ROZNE.UT_OKROD:=ROZNE.UT_OKRDO:=SSTALE.AO;
ROZNE.UT_ROKOD:=ROZNE.UT_ROKDO:=SSTALE.AR;
BILANSP.ASYNT:=SSTALE.AR().SYNT;
BILANSP.ASEP:=SSTALE.AR().SEP


\add_tab_zois
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Dodaje okno do okna grupowego
::   WE: _a - nazwa zakładki
::       _b - tabela
::       _c - okno grupowe
::----------------------------------------------------------------------------------------------------------------------
exec('tab_create_zois','fks_ksr');
_b.grp_sel(_c,TAB_ZOIS,TAB_ZOIS.win_sel('?'),_a,"",,,,"
           zakladka:=7; echo(); exec('be_zois','!fks_ksr_zbob');
           dwiewalo:=0; exec('zois_par_get','fks_ksr');
           TAB_ZOIS.hdr_sel();
           {? notfirst
           || _nagl:=35+({? ROZNE.PAR4=0 || ROZNE.PREFIX || ROZNE.MASKA ?}+35*'?');
              {? ROZNE.PAR4=4
              || _nagl:='zakresu od %1 do %2'@[ROZNE.KS_OD().SYM,ROZNE.KS_DO().SYM]
              |? ROZNE.PAR4=5
              || _nagl:='zestawu kont %1'@[ROZNE.KON_WYDR().KOD]
              |? ROZNE.PAR4=3
              || _nagl:='wybranych kont syntetycznych'
              |? ROZNE.PAR4=6
              || _nagl:='wybranych kont analitycznych'
              ?};
              TAB_ZOIS.hdr_sel(' dla %1 od %2 do %3'@[_nagl,$ROZNE.DATA_OD,$ROZNE.DATA_DO]);
              {? UNPAR.PSLO<>null & UNPAR.PSLO().KOD<>'PLN' || TAB_ZOIS.hdr_sel(', waluta: ' + UNPAR.PSLO().KOD) ?};
              {? ROZNE.ANSLU<>null || TAB_ZOIS.hdr_sel(', słownik: ' + ROZNE.ANSLU().NAZ) ?};
              {? ROZNE.ANSLO<>null || TAB_ZOIS.hdr_sel(', pozycja: ' + ROZNE.ANSLO().KOD) ?}
           ?}"
           ,"exec('af_zois','!fks_ksr_zbob')",,,'maximized_with_title');
task_attach('FKS_KSR_ZBOB')


\be_zois
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Formuła przed obsługą okienka zestawienia obrotów i sald
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__AZOIS')<=0
|| __AZOIS:=obj_new('DATA_OD','DATA_DO','BZ','PAR2','PAR4','PREFIX','MASKA','KS_OD','KS_DO','KON_WYDR','PSLO','P25',
                   'PAR3','PAR1','UT_ROZR','UT_DOK')
?};
__AZOIS.DATA_OD:=ROZNE.DATA_OD;
__AZOIS.DATA_DO:=ROZNE.DATA_DO;
__AZOIS.BZ:=ROZNE.BZ;
__AZOIS.PAR2:=ROZNE.PAR2;
__AZOIS.PAR4:=ROZNE.PAR4;
__AZOIS.PREFIX:=ROZNE.PREFIX;
__AZOIS.MASKA:=ROZNE.MASKA;
__AZOIS.KS_OD:=ROZNE.KS_OD;
__AZOIS.KS_DO:=ROZNE.KS_DO;
__AZOIS.KON_WYDR:=ROZNE.KON_WYDR;
__AZOIS.PSLO:=UNPAR.PSLO;
__AZOIS.P25:=UNPAR.P25;
__AZOIS.PAR3:=ROZNE.PAR3;
__AZOIS.PAR1:=ROZNE.PAR1;
__AZOIS.UT_ROZR:=ROZNE.UT_ROZR;
__AZOIS.UT_DOK:=ROZNE.UT_DOK;
1


\af_zois
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Formuła po obsłudze okienka zestawienia obrotów i sald
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__AZOIS')>0
|| ROZNE.DATA_OD:=__AZOIS.DATA_OD;
   ROZNE.DATA_DO:=__AZOIS.DATA_DO;
   ROZNE.BZ:=__AZOIS.BZ;
   ROZNE.PAR2:=__AZOIS.PAR2;
   ROZNE.PAR4:=__AZOIS.PAR4;
   ROZNE.PREFIX:=__AZOIS.PREFIX;
   ROZNE.MASKA:=__AZOIS.MASKA;
   ROZNE.KS_OD:=__AZOIS.KS_OD;
   ROZNE.KS_DO:=__AZOIS.KS_DO;
   ROZNE.KON_WYDR:=__AZOIS.KON_WYDR;
   UNPAR.PSLO:=__AZOIS.PSLO;
   UNPAR.P25:=__AZOIS.P25;
   ROZNE.PAR3:=__AZOIS.PAR3;
   ROZNE.PAR1:=__AZOIS.PAR1;
   ROZNE.UT_ROZR:=__AZOIS.UT_ROZR;
   ROZNE.UT_DOK:=__AZOIS.UT_DOK
?};
TAB_ZOIS.ndx_drop()

:Sign Version 2.0 jowisz:1048 2023/06/23 14:09:40 895b797017f74e69b857ff32961bc89d09229c51c4bea7190a0f4814ff4abff4af5749e8edb00981fb7cb0e42c4fef6cfe14ffae342bf09fb9477b1dfb0a6639e748b47be0b979b759229b7729213dbb8bd24cada99128629ab3b5a80a69136c1342defeded502737f4d79f6e3f9c2ca701141f0780025e887329d66833d4852
