:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_ved_zvgp.fml
:: Utworzony: 30.06.2023
:: Autor: PBS
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_VED_ZVGP - Przeglądanie deklaracji JPK_GV
::======================================================================================================================

\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Przeglądanie deklaracji JPK_GV - główna formuła czynności FKS_VED_ZVGP.
::----------------------------------------------------------------------------------------------------------------------
::# permissions=FJKS


\br_gv_dek
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Rekord przed okna VAT_V7 tabeli VAT_DEK
::----------------------------------------------------------------------------------------------------------------------
exec('br_vat','fks_ved','JPK_GV');
''


\add_tab
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Dodanie zakładki do okna grupowego obszaru deklaracji podatkowych (FKS_VED)
::   WE: _a - nazwa zakładki
::       _b - okno grupowe
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('J_GV_POZ')>0 & type_of(DOK)=type_of(J_GV_POZ)
|| VAT_DEK.grp_sel(_b,,'JPK_GV',_a,"",0,0,,"exec('bw','!fks_ved_zvgp')","",,,'maximized_with_title');
   exec('task_attach','fks_ved','G')
::   exec('set_viudo_fml','fks_viudo')
?};
~~


\bw
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Przed obsługą okien okna grupowego obszaru FKS_VED
::----------------------------------------------------------------------------------------------------------------------
rodzdekl:='G';
VAT_DEK.index('VAT_DEKR');
VAT_DEK.prefix(rodzdekl,SIK.ROK1().POCZ_ROK);
vat_typ:='GV';
VAT_DEK.win_sel('JPK_GV');
VAT_DEK.hdr_sel();
VAT_DEK.hdr_sel(' JPK_GV'@);
SKID.TYP_ZAP:=SKID.DEKL_NAZ:='GV';
VAT_DEK.hdr_sel(' z roku %1'@[ROK_F.NAZ])


\vat_dekz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Zmiana zakresu wyświetlanych deklaracji JPK_GV
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('OknROKE2');
exec('okno_rok2','fks_ved');
SIK.win_edit(OknROKE2);
{? SIK.edit("{? SIK.ROK1=null
             || FUN.info('Należy wybrać rok bilansowy.'@);
                0
             || 1
             ?}")
|| VAT_DEK.hdr_sel();
   vat_typ:='GV'; VAT_DEK.hdr_sel(' JPK_GV'); SKID.TYP_ZAP:=SKID.DEKL_NAZ:='GV';
   VAT_DEK.index('VAT_DEKR');
   {? SIK.ROK1=null
   || VAT_DEK.hdr_sel(' ze wszystkich lat'@);
      VAT_DEK.prefix(rodzdekl)
   || VAT_DEK.hdr_sel(' z roku %1'@[SIK.ROK1().NAZ]);
      VAT_DEK.prefix(rodzdekl,ROK_F.POCZ_ROK)
   ?};
   AreaTitle.setTitle()
?};
SIK.win_edit();
VAR_DEL.delete('OknROKE2');
1


\vat_dek_jpk
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Akcja Pliki JPK w okienku wertowania deklaracji
::----------------------------------------------------------------------------------------------------------------------
ISTDEF.win_sel('W_JPK');
ISTDEF.win_edit('R_JPK');
ISTDEF.actions('W_JPK','dpUTHOEIA:dAI');
_typ:=2+VAT_DEK.TYP;
JPK.index('DODAT'); JPK.prefix(_typ,$VAT_DEK.ref(),);
JPK.win_sel('WER_V7');
_actions:='CPZ:CZ';
{? 2+VAT_DEK.TYP<>'GV'
|| _actions:='DUATW'+_actions+'D'
|| _actions:='E'+_actions
?};
VAT_DEK.cntx_psh();
JPK.select(,,,_actions);
VAT_DEK.cntx_pop();
ISTDEF.actions('W_JPK')


\gv_poz_rekprzed
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Rekord przed okienka wertowania tabeli J_GV_POZ
::----------------------------------------------------------------------------------------------------------------------
~~


\wysw_dok
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Wyświetla nagłówek dokumentu źródłowego
:: ~OST: INFORK
::----------------------------------------------------------------------------------------------------------------------
_uidref:=J_GV_POZ.DOKUID;
_domain:='FKS';
{? exec('interm','#system')
|| _params:=exec('obj_ntab_set','#array',,'LINK',_uidref);
   _link_interm:=link_uri(_params);
   cli_open_link(_link_interm)
|| _color:=exec('FindInSet','#table','B_DOMAIN','SYMBOL',_domain,,"B_DOMAIN.COLOR",1,,'');
   mb_fork(,'START_PROCES'
      ,'color='+exec('color_conv','#convert',_color)
      ,'LINK',_uidref)
?};
1


\wysw_space
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Akcja na spację
::----------------------------------------------------------------------------------------------------------------------
DOK.cntx_psh(); DOK.prefix();
FAKS.cntx_psh(); FAKS.prefix();
_faks:=exec('czy_faks','!fks_ved_dvgd',J_GV_POZ.DOKUID);
{? _faks=null
|| {? DOK.seek(J_GV_POZ.DOKUID,ref_name(J_GV_POZ.DOKUID))
   || exec('dok_spac','dok_fks',DOK.ref())
   ?}
|| {? FAKS.seek(_faks,ref_name(_faks))
   || exec('fall_rek','faktury_nag',2)
   ?}
?};
DOK.cntx_pop(); FAKS.cntx_pop();
1

:Sign Version 2.0 jowisz:1045 2023/09/07 12:13:11 7d905f421512fcc280f2797221ef2ec3b9e18905d8883c46d77869173e98b0a680b2559114b38cb728cd78f93776486c34afc07c7c1e172691d646c7e129a4d75b2431b60a8cde5764523b46c64887a976a30f4d6bdc94d942a77596bf773518aaffb3d777f4a62c49c1d803a756b6596c6bcb75ed9be33d8889545370b5c66c
