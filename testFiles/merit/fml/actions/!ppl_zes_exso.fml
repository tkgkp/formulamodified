:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !ppl_zes_exso.fml
:: Utworzony: 18.05.2016
:: Autor: DAROKR
::======================================================================================================================
:: Zawartość: PPL_ZES_EXSO - Eksport danych do SODiR.
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [17.00]
:: OPIS: PPL_ZES_EXSO - Eksport danych do SODiR.
::----------------------------------------------------------------------------------------------------------------------
::# permissions=F_ZATR,UD_SKL,HRB
: warunek podstawowy działania tylko dla formy zatrudnienia 'P'
{? __PARSES.getVal('F_ZATR').KOD<>'P'
|| FUN.emsg('Obszar niedostępny dla formy współpracy "%1".'@[__PARSES.getVal('F_ZATR').OPIS]);
   return()
?};
{? ~exec('no_limit','schemat','PPL')
|| return('Brak praw dostępu do wszystkich jednostek organizacyjnych.'@)
?};
exec('sodir','!ppl_zes_exso');
~~


\sodir
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Wywolanie dla typu dokumentu SODIR.
::  OLD: \sodir/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_ed:=1;
params_set(params_get());
exec('clear_all','!ppl_zes_exso');
__DocT:=__DocTN:='';
__G:=obj_new(57);
__S:=obj_new(51);
exec('zero_s','!ppl_zes_exso');
__Ch:=obj_new(63);
__G[16]:=__G[42]:=__G[43]:=__G[44]:='';
__G[46]:=0;
__G[40]:=__G[41]:=date(0,0,0);
__G[54]:=__G[55]:=0;
__G[56]:=__G[57]:='';
__nSOD_N:=SOD_N.ndx_tmp(,1,'PESEL',,,'NAZ',,,'IM',,,'SOD_P','ZA',,'SOD_P','R',1,'SOD_P','MK',1);
P.cntx_psh();
P.index('PRACOSOB');
P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P);
exec('okress','!ppl_zes_exso');
{? exec('valid','!ppl_zes_exso','SODIR')
||
   _ed:=FUN.ask('Generowanie paczki dokumentów dla okresu sprawozdawczego %1.\n'
              'Operacja może być czasochłonna.\nKontynuować?'@[__okSp]);
   {? _ed
   || __ileP:=0;
      __G[16]:='Z'; 'Korekta - NIE';
      exec('data_st','!ppl_zes_exso'); 'dane stale';
      progress(0,'Postęp realizacji zadania...'@,FUN.TYT);
      {? exec('przed2009','!ppl_zes_exso')
      ||
         __DocT:='INF-U-P';
         __DocTN:='WNU';
         exec('czytaj_dane','!ppl_zes_exso')
      || __G[46]:=FUN.ask('Czy wniosek o wypłatę miesięcznego dofinansowania\n'
                          'składany jest po raz pierwszy bądź nastąpiła zmiana danych pracodawcy?'@)
      ?};
      __DocT:='INF-D-P';
      __DocTN:='WND';
      exec('czytaj_dane','!ppl_zes_exso');
      prgs_clr
   ?}
?};
{? _ed || exec('ed_pacz','!ppl_zes_exso',1) ?};
P.cntx_pop();
exec('clear_all','!ppl_zes_exso');
exec('dla_listy','stalesys');
1


\valid
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Kontrola istniejacych dokumentow.
::   WE: _a - oznaczenie rodzaju przechowywanych dokumentow [STRING] - np. SODIR
::  OLD: \valid/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=1;
SOD.cntx_psh();
SOD_P.cntx_psh();
SOD_P.index('SOD_P');
SOD_P.prefix(_a,_a,#(__okSp+4),#(2+__okSp));
{? SOD_P.first() & SOD_P.size>1
||  _wyn:=0
|? SOD_P.size=1 & SOD_P.ZA='T'
|| _wyn:=0
|? SOD_P.size=1
||
   SOD.use('sod'+(__okSp+4));
   SOD.index('SODA');
   SOD.prefix(SOD_P.ref,'R');
   _wyn:=0
?};
SOD_P.cntx_pop();
SOD.cntx_pop();
_wyn


\do_pliku
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Eksport do pliku.
:: ~OST: INFILECHOOSER, INFCOPY
::  OLD: \do_pliku/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_sep_s:=exec('sep','#file',2);
_sep_c:=exec('sep','#file');
_err:=0;
_exp:=0;
SOD_N.cntx_psh();
SOD_N.index('SOD_N3');
SOD_N.prefix(SOD_N.SOD_P);
_progress:=SOD_N.size;

SOD_N.cntx_pop();

_user:={? _psep:=username*'~' || _psep-1
       |? _psep:=username*'.' || _psep-1
       || +username
       ?};
_path:='';

SOD.cntx_psh();
SOD_S.cntx_psh();
SOD_P.cntx_psh();
SOD_N.cntx_psh();

_il:=_ileP:=0;
__IDP:=SOD_P.ID;
_plik:=0;

undefine();
define('header1',~~);
{? SOD_P.DW=date(0,0,0)
 | FUN.ask('Paczka była już wysyłana.\nWysłać ponownie?'@)
||
   define('header2',~~,'Data wysyłki dokumentów:'@);
   define('DATA',{? SOD_P.DW<>date(0,0,0) || SOD_P.DW || date() ?},'Data:');
   def_btn('text=%1, icon=xwin16.png:13, btn_label_align=center'['OK'@],"'key:F2'");
   def_btn('text=%1, icon=xwin16.png:14, btn_label_align=center'['Anuluj'@],"'key:Esc'");
   _exp:=def_edit("{? DEFINE.DATA=date(0,0,0)
                   || FUN.emsg('Podanie daty jest obowiązkowe.'@); 'DATA'
                   || ''
                   ?}",'Eksport dokumentów'@)
?};

{? _exp
|| _path:='';
   _tmp_dir:=fmk_tmp_dir(0);
   {? type_of(_tmp_dir)<>type_of(~~)
   || _path:=_tmp_dir.get_path();
      _path:=fmkdir(_path, 'sodir')
   ?};
   {? _path=''
   || _err:=2
   ?}
|| _err:=4
?};

{? ~_err
||
   exec('data_st','!ppl_zes_exso',1);
   SOD_N.index('SOD_N1');
   SOD_N.prefix(SOD_P.ref);
   {? SOD_N.first
   ||
      exec('typdok','!ppl_zes_exso',,,SOD_N.SOD_P().KOR);
      {!
      |? SOD_N.cntx_psh();
         __DocT:=SOD_N.SOD_S().DOK;
         exec('NAGr','!ppl_zes_exso');
         progress(100*_ileP/_progress,'Postęp realizacji zadania...'@,FUN.TYT);
         _name:=SOD_N.PLIK+'.xml';
         _plik:=fopen(_path+_sep_s+_name,'bw');
         {? _plik>0
         || {? exec('DokExpo','!ppl_zes_exso',_plik,SOD_N.PLIK)
            || _il+=1;
               fclose(_plik)
            || _err:=1;
               fclose(_plik);
               ferase(_path+_sep_s+_name)
            ?}
         ?};
         SOD_N.cntx_pop();
         SOD_N.next()
      !};
      prgs_clr;
      {? ~_err
      || {? _il>1
         || _save:='';
            {? exec('interm','#system')
            || _date:=form(date()~1,-4,0,'9999')+form(date()~2,-2,0,'99')+form(date()~3,-2,0,'99');
               _zip:=_tmp_dir.get_path()+_sep_s+'SODIR_'+_date+'.zip';
               {? fpack_add(_zip,_path)
               || _save:=dlg_save(_zip,0)
               || _err:=3
               ?}
            || _jpath:=exec('filechooser','#file','Wybierz katalog do zapisu plików'@,0,,,,'DIRECTORIES_ONLY',1);
               {? _jpath<>''
               || _filesTAB:=fdir(_path);
                  {? var_pres('_filesTAB')<>type_of(~~) & _filesTAB.first()
                  || {!
                     |? fcopy(_path+_sep_s+_filesTAB.NAME,'@'+_jpath+_sep_c+_filesTAB.NAME);
                        _filesTAB.next()
                     !};
                     _save:='T'
                  ?}
               ?}
            ?}
         || _save:=dlg_save(_path+_sep_s+_name,0,_name)
         ?};
         {? _save<>''
         || {? SOD_P.DW<>DEFINE.DATA
            || SOD_P.DW:=DEFINE.DATA
            ?};
            {? SOD_P.ZA<>'T'
            || SOD_P.ZA:='T'
            ?};
            SOD_P.put(1);
            {? FUN.ask('Zakończono eksport dokumentów.\nWydrukować raport?'@)
            || exec('raport','!ppl_zes_exso')
            ?}
         ?}
      ?}
   ?}
?};
{? _err=4
|| FUN.info('Eksport dokumentów został anulowany.'@)
|? _err=1
|| FUN.emsg('Wystąpiły błędy podczas eksportu dokumentów.'@)
|? _err=2
|| FUN.emsg('Nie udało się utworzenie katalogu tymczasowego po stronie serwera.'@+
            '\n'+'Eksport dokumentów został anulowany.'@)
|? _err=3
|| FUN.emsg('Wystąpił błąd podczas próby dodawania plików do archiwum.'@+
            '\n'+'Eksport dokumentów został anulowany.'@)
?};
SOD_N.cntx_pop();
SOD_P.cntx_pop();
SOD_S.cntx_pop();
SOD.cntx_pop();
undefine();
1


\mk_sel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Wybor pracownikow.
::  OLD: \mk_sel/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('__Grupa');
__Grupa:=0;

P.cntx_psh();
P.index('PRACONAZ');
P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P);

_win_acr:=P.mk_sel('',,,'20081029143213',,,,,'U');
P.win_fld(_win_acr,,'T',,,9,,,'Nr teczki'@);
P.win_fld(_win_acr,,'OSOBA','NAZWISKO',,22,,,'Nazwisko'@);
P.win_fld(_win_acr,,'OSOBA','PIERWSZE',,20,,,'Imię'@);
P.win_fld(_win_acr,,'WYDZIAL','SYMBOL',,16,,,'Jednostka organizacyjna'@);
P.win_fld(_win_acr,,'CP','CP',,4,,,'Charakter pracy'@);
P.win_fld(_win_acr,,'ZA',,,4,,,'Zatrudniony?'@,,,2,,"'T'","'N'");
P.win_sel(_win_acr);

P.win_act(_win_acr,,'Rekord',,,,"REF.P:=P.ref; REF.OSOBA:=P.OSOBA");
P.win_act(_win_acr,0,'Formuła','Wybierz',,'Wybór',,"
   exec('ten_solo','!ppl_zes_exso',1)",1,1,"
   exec('ten_bfg','!ppl_zes_exso')","
   exec('ten_afg','!ppl_zes_exso',1)");
_menu:='Szukaj'@;
P.win_act(_win_acr,,'Menu',_menu);
P.win_act(_win_acr,,'Formuła','Szukaj dokładnie'@@,_menu,,"exec('p_ustaw_ezk','szukaj')","exec('p_d','szukaj')");
P.win_act(_win_acr,,'Formuła','Szukaj &kontekstowo'@@,_menu,,"exec('p_ustaw_ezk','szukaj')","exec('p_k','szukaj')");
P.win_act(_win_acr,,'#F3',,,,"exec('p_ustaw_ezk','szukaj')","exec('p_f3_wnd','szukaj')");
P.win_act(_win_acr,,'Kolejność');
P.win_edit('RED_P');
P.hdr_sel();
P.hdr_sel(__Header);
__Close:=P.select(,,10);
_ref:=P.ref();
VAR_DEL.delete('__Grupa');
P.cntx_pop();
_ref


\czytaj_dane
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Petla po pracownikach.
::  OLD: \czytaj_dane/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_od:=date(#(__okSp+4),#(2+__okSp),1);
_do:=date(#(__okSp+4),#(2+__okSp),0);

{? P.first
||
   exec('ten_bfg','!ppl_zes_exso');
   {!
   |? __ileP+=1;
      P.OSOBA();
      progress(100*__ileP/({? exec('przed2009','!ppl_zes_exso') || P.size*2 || P.size ?}),
         'Postęp realizacji zadania...'@,FUN.TYT);
      SOD_N.cntx_psh();
      SOD_N.prefix();
      _findN:=SOD_N.find_tab(1,'SOD_P','ID','=',__IDP,'SOD_S','DOK','=',__DocT,'PESEL',,'=',OSOBA.PESEL);
      SOD_N.cntx_pop();
      {? ~_findN
      || exec('ten_solo','!ppl_zes_exso')
      ?};
      P.next()
   !};
   exec('ten_afg','!ppl_zes_exso',0,1)
?};
~~


\ed_pacz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: _a - wywolanie edycja i podglad
:: OPIS: Okno edycyjne paczki.
::  OLD: \ed_pacz/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
SOD_P.cntx_psh();
SOD_N.cntx_psh();
SOD_S.cntx_psh();
_all:={? _>0 || 1 || 0 ?};
VAR_DEL.delete('__winlud','__winpac','__winrec','__windoc','__DOC');

__DOC:=sql('select distinct  SOD_P.ID as ID, SOD_S.DOK as DOK, SOD_S.NAG as NAG, 0 as LP '+
   'from SOD_S '+
   'join SOD_N using(SOD_N.SOD_S,SOD_S.reference) '+
   'join SOD_P using(SOD_N.SOD_P,SOD_P.reference) '+
   'order by 1,4,3,2 desc');
{? _all
||
   SOD_P.index('SOD_P');
   SOD_P.prefix('SODIR','SODIR',#(__okSp+4),#(2+__okSp));
   {? SOD_P.first()
   || {!
      |? exec('zalaczniki','!ppl_zes_exso',SOD_P.ID);
         SOD_P.next()
      !}
   ?};
   SOD_N.index('SOD_N3');
   SOD_N.prefix(SOD_P.ref());
   {? ~SOD_P.first()
   || SOD_P.cntx_pop();
      SOD_N.cntx_pop();
      SOD_S.cntx_pop();
      FUN.emsg('Brak dokumentów do wyświetlenia.'@);
      return(0)
   || SOD_P.cntx_psh();
      {!|?
         {? SOD_P.find_tab(,'KOR',,'=','')
         || SOD_P.KOR:='Z';
            SOD_P.put()
         || 0
         ?}
      !};
      SOD_P.cntx_pop()
   ?}
||
   exec('zalaczniki','!ppl_zes_exso',SOD_P.ID)
?};
__ref_p:=SOD_P.ref;
__winpac:=SOD_P.mk_sel('Paczki'@,,,'jshddbsfhcvrd',,,,,'U');
SOD_P.win_fld(__winpac,,'ID',,,17,,,'Symbol'@);
SOD_P.win_fld(__winpac,,'KOR',,,-5,,,'Korekta'@,,,2,,"'K'","'Z'");
SOD_P.win_fld(__winpac,,'ZA',,,-5,,,'Blokada'@,,,2,,"'T'","'N'");
SOD_P.win_fld(__winpac,,'DW',,,11,,,'Eksport'@);
SOD_P.win_act(__winpac,,'Formuła','Export'@@,,,"exec('do_pliku','!ppl_zes_exso')");
SOD_P.win_act(__winpac,,'Formuła','Blokada'@@,,,"exec('f_reblock','!ppl_zes_exso')");
SOD_P.win_act(__winpac,,'Formuła','Korekta'@@,,,"exec('f_revision','!ppl_zes_exso')");
SOD_P.win_act(__winpac,,'Formuła','Raport przekazania'@@,,,"exec('raport','!ppl_zes_exso')");
SOD_P.win_act(__winpac,1,'Formuła','Generuj'@@,,,"sel_exit()",,1);
SOD_P.win_act(__winpac,,'Formuła','Usuń'@@,,,"
   {? SOD_P.ZA='T'
   || FUN.info('Akcja niedostępna.')
   || _ask:={? SOD_P.DW<>date(0,0,0)
            || FUN.ask('Paczka była wysłana.\nCzy na pewno usunąć?'@)
            || FUN.ask('Na pewno usunąć bieżącą paczkę?'@)
            ?};
      {? _ask & exec('erase_p','!ppl_zes_exso')
      || grp_disp(SOD,__winrec)
      ?}
   ?}"
);

_tree_tab:=exec('tree_zalacz','!ppl_zes_exso');
_tree_ndx:=_tree_tab.ndx_tmp(,,'PARENT',,1);
_tmp_tab:=_tree_tab.index('?');
_tree_tab.index(_tree_ndx);
_tree_tab.prefix();
_tree_tab.index(_tmp_tab);
_tree_tab.prefix();
_tree_wnd:=exec('tree_wnd','!ppl_zes_exso',_tree_tab);
params_set(
   'tree_tab',_tree_tab,
   'tree_wnd',_tree_wnd,
   'tree_ndx',_tree_ndx
);
__DOC.for_each("
   _par:=params_get().tree_tab;
   {? __DOC.ID=$SOD_P.ref() ||
   _par.PARENT := 0;
   _par.REF:=_par.KOD := '';
   _par.OPIS := __DOC.DOK;
   _par.ID:=__DOC.ID;
   _par.NAG:=__DOC.NAG;
   _par.add();
   _parent:=_par.ref();
   _par.PARENT := _parent;
   _par.REF:=_par.KOD := '';
   _par.OPIS:= __DOC.DOK;
   _par.ID:=__DOC.ID;
   _par.NAG:=__DOC.NAG;
   _par.add();
   _parent:=_par.ref();
   SOD_N.index('SOD_N3');
   SOD_N.prefix(SOD_P.ref,__DOC.DOK,__DOC.DOK);
   {? SOD_N.first()
   || {! |?
         _par.PARENT := #_parent;
         _par.OPIS := SOD_N.NAZ +' '+ SOD_N.IM;
         _par.REF:= $SOD_N.ref();
         _par.KOD := SOD_N.PESEL;
         _par.ID:= '';
         _par.add();
         SOD_N.next()
      !}
   ?}
   ?}
");

__winlud:=SOD_N.mk_sel('Pozycje dokumentu'@,,,'laxdki',,,,,'U');
SOD_N.win_fld(__winlud,,'NAZ',,,30,,,'Nazwisko/identyfikator 1'@);
SOD_N.win_fld(__winlud,,'IM',,,24,,,'Imię/identyfikator 1'@);
SOD_N.win_fld(__winlud,,'PESEL',,,-14,,,'PESEL/identyfikator 1'@);
SOD_N.win_act(__winlud,,'Formuła','Dołącz'@@,,,"exec('f_add','!ppl_zes_exso')",,1);
SOD_N.win_act(__winlud,1,'Formuła','Dołącz'@@,,,"exec('f_add','!ppl_zes_exso'),,1");
SOD_N.win_act(__winlud,,'Formuła','Usuń'@@,,,"exec('f_delete','!ppl_zes_exso')");

__winrec:=SOD.mk_sel('Wartości dokumentu'@,,,'jdncfkjasdn',,,,,'U');
SOD.win_fld(__winrec,,'NR',,,3,,,'Nr'@);
SOD.win_fld(__winrec,,'OPIS',,,33,,,'Opis'@);
SOD.win_fld(__winrec,,'WAR',,,31,,,'Wartość'@);
SOD.win_act(__winrec,,'Rekord',,,,"exec('rekprzed','color','SODIRPOZ#')");
SOD.win_act(__winrec,,'Formuła','Popraw'@@,,,"
   __IDP:=SOD_N.SOD_P().ID;
   {? {? SOD_P.ZA='T'
      || FUN.info('Akcja niedostępna.'@); 0
      || 1
      ?}
    & exec('popraw_sod','!ppl_zes_exso')
   || {? SOD.SUM || exec('nagl_aktual','!ppl_zes_exso',SOD.SUM) ?}
   ?}
",,1);
SOD.win_act(__winrec,,'Formuła','Legenda'@@,,,"exec('leg_sodir_poz','!ppl_zes_exso')",,,,,,
   'L',,'target=window'
);
SOD.win_btn(__winrec,'text=Popraw','menu:P');
_acr:=SOD_P.grp_make('Okres: '+date(SOD_P.R,SOD_P.MP,0)$8,
                     "params_set(params_get());
                      params_exec('synchronize_tree','!ppl_zes_exso');
                      grp_disp(params_get().tree_tab,params_get().tree_wnd);
                      SOD.prefix(0);
                      ~~
                     ",'irhniucye');
SOD_P.grp_sel(_acr,,__winpac,,
              "params_set(params_get());
              {? __IDP<>SOD_P.ID
              ||
                  __IDP:=SOD_P.ID;
                  __DocT:=params_get().tree_tab.DOC;
                  __DOC.prefix(SOD_P.ID);
                  __DOC.first();
                  __ref_p:=SOD_P.ref;
                  params_exec('synchronize_tree','!ppl_zes_exso');
                  grp_disp(params_get().tree_tab,params_get().tree_wnd);
                  SOD.prefix(0);
                  grp_disp(SOD,__winrec)
               ?};
               {? params_get().tree_tab.size()=0
               || params_exec('synchronize_tree','!ppl_zes_exso');
               grp_disp(params_get().tree_tab,params_get().tree_wnd);
               SOD.prefix(0);
               grp_disp(SOD,__winrec)?};
               ~~",,,10,"","",,,'maximized_with_title');
SOD_P.grp_splt(_acr,,'horizontal','bottom1');
SOD_P.grp_sel(_acr,_tree_tab,_tree_wnd,,
             "_par:=params_get();
              SOD_N.cntx_psh();
              SOD_N.prefix();
              {? SOD_N.seek(_par.tree_tab.REF)
              || exec('w_rec','!ppl_zes_exso');
                 SOD_N.cntx_pop()
              || SOD.prefix(0);
                 SOD_N.cntx_pop();
                 grp_disp(SOD,__winrec)
              ?};
              __DOC.find_tab(,'DOK',,'=',_par.tree_tab.OPIS);
              _aid:='';
              {? SOD_P.ZA='T' | _par.tree_tab.OPIS='WND'
              || _aid+='DU'
              |? _par.tree_tab.DOC=''
              || _aid+='U'
              || _aid+='D'
              ?};
              _par.tree_tab.actions_grayed(_par.tree_wnd,_aid)
              ",,,,
              "_par:=params_get();
              _aid:='';
              {? SOD_P.ZA='T'
              || _aid+='DU'
              |? _par.tree_tab.DOC=''
              || _aid+='U'
              || _aid+='D'
              ?};
              __DOC.find_tab(,'DOK',,'=',_par.tree_tab.OPIS);
              _par.tree_tab.actions_grayed(_par.tree_wnd,_aid)
              ");
SOD_P.grp_splt(_acr,,'vertical','doko');
SOD_P.grp_sel(_acr,SOD,__winrec,,"",,,,,,,,'maximized_with_title');

SOD_P.index('SOD_P');
SOD_P.prefix('SODIR','SODIR',#(__okSp+4),#(2+__okSp));
{? SOD_P.first
|| SOD_P.win_sel(_acr);
   exec('doclpn','!ppl_zes_exso');
   __DOC.first();
   {? SOD_P.select(,,10)
   || params_exec('sodir','!ppl_zes_exso')
   ?}
|| FUN.emsg('Brak dokumentów do wyświetlenia.'@)
?};
VAR_DEL.delete('__winlud','__winpac','__winrec','__windoc','__DOC');
SOD_P.cntx_pop();
SOD_N.cntx_pop();
SOD_S.cntx_pop();
1


\doclpn
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Formula numerujaca zestawy dokumentow wewnatrz paczek.
::  OLD: \doclpn/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__DOC.cntx_psh();
__DOC.prefix();
_lpn:=__DOC.size;
{? __DOC.first
||
   {!
   |? __DOC.find_tab(,'NAG',,'=','','LP',,'=',0)
   |! _lpn+=1;
      __DOC.LP:=_lpn;
      __DOC.put(1);
      _nag:=__DOC.DOK;
      _docid:=__DOC.ID;
      __DOC.cntx_psh();
      __DOC.prefix(_docid,0);
      {? __DOC.first
      || {!
         |?
            {? __DOC.NAG=_nag
            ||
               __DOC.cntx_psh();
               __DOC.prefix();
               __DOC.LP:=_lpn;
               __DOC.put();
               __DOC.cntx_pop();
               __DOC.first
            || __DOC.next
            ?}
         !}
      ?};
      __DOC.cntx_pop();
      __DOC.first
   !}
?};
__DOC.cntx_pop()


\f_add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Formula na dolacz okna wertowania __winlud.
::  OLD: \f_add/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_par:=params_get();
params_set(_par);

_ref:='0';
SOD.cntx_psh();
SOD_S.cntx_psh();
SOD_P.cntx_psh();
SOD_N.cntx_psh();
SOD_P.get();
__Close:=0;
{? SOD_P.ZA<>'T'
 & _par.tree_tab.size
 & (_par.tree_tab.OPIS<>'' & _par.tree_tab.KOD='')
||
   exec('data_st','!ppl_zes_exso',SOD_N.size);
   __DocT:=_par.tree_tab.OPIS;
   {? __DocT='INF-D-Z'
    | __DocT='WND2II'
    | __DocT='WNU_II'
   || exec('ten_solo','!ppl_zes_exso',1)
   || __Close:=1;
      _ref:=exec('mk_sel','!ppl_zes_exso');
      __Close:=0
   ?};
   exec('nagl_aktual','!ppl_zes_exso');
   exec('przenumerowanie','!ppl_zes_exso')
|| FUN.info('Akcja niedostępna.'@)
?};
SOD_N.cntx_pop();
SOD_P.cntx_pop();
SOD_S.cntx_pop();
SOD.cntx_pop();
{? #_ref<>0
|| _t_ref:='0';
   params_exec('synchronize_tree','!ppl_zes_exso');
   P.cntx_psh();
   P.seek(_ref);
   _par.tree_tab.cntx_psh();
   _ind:=_par.tree_tab.ndx_tmp(,0,'KOD',,);
   {? _ind<>''
   || _par.tree_tab.index(_ind);
      _par.tree_tab.prefix(P.OSOBA().PESEL);
      {? _par.tree_tab.first
      || _t_ref:=_par.tree_tab.ref()
      ?};
      _par.tree_tab.ndx_drop(_ind);
      _par.tree_tab.index('?');
      &_ind
   ?};
   _par.tree_tab.cntx_pop();
   {? #_t_ref<>0 || _par.tree_tab.seek(_t_ref) ?};
   P.cntx_pop()
?}


\f_delete
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Usuniecie biezacego dokumentu z pozycjami.
::   WY: Wynik dzialania formuly
::  OLD: \f_delete/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_par:=params_get();
params_set(_par);
_wyn:=0;
{? SOD_P.ZA='T' | _par.tree_tab.REF='' | _par.tree_tab.KOD='WnD'
|| FUN.info('Akcja niedostępna.'@)
|| _wyn:=1
?};
{? _wyn & FUN.ask('Czy na pewno usunąć wskazany dokument wraz z pozycjami?'@)
||
   SOD_N.cntx_psh();
   SOD_N.prefix();
   {? SOD_N.seek(_par.tree_tab.REF)
   || {? exec('erase_d','!ppl_zes_exso',SOD_N.ref)
      || {? SOD_N.del(1,1)
         || exec('nagl_aktual','!ppl_zes_exso');
            exec('przenumerowanie','!ppl_zes_exso')
         ?}
      || _wyn:=0
      ?}
   ?};

   SOD_N.cntx_pop()
?};
{? _wyn || params_exec('synchronize_tree','!ppl_zes_exso') ?};
_wyn


\f_revision
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Utworzenie korekty biezacej paczki.
::   WY: Wynik dzialania formuly
::  OLD: \f_revision/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=0;
_newP:=0;
_bazaP:=SOD_P.ref();
_bazaID:=SOD_P.ID;
_nex:={? ~(SOD_P.DW<>date(0,0,0))
      || FUN.ask('Paczka nie była wysyłana,\nczy na pewno utworzyć paczkę korygującą?'@)
      || {? SOD_P.find_tab(,'ID',,'>',SOD_P.ID)
         || FUN.info('Istnieje późniejszy dokument korygujący.'@); 0
         || FUN.ask('Utworzyć paczkę korygującą?'@)
         ?}
      ?};

SOD_P.seek(_bazaP);
{? _nex
|| _wyn:=1;
   do();

   SOD_P.ZA='T'; SOD_P.put(1);

   SOD_P.ID:=exec('gen_id','!ppl_zes_exso');
   SOD_P.ZA:='N';
   SOD_P.KOR:='K';
   SOD_P.DW:=date(0,0,0);
   _wyn:=SOD_P.add(1);
   {? _wyn
   ||
       _newP:=SOD_P.ref();
      exec('zalaczniki','!ppl_zes_exso',SOD_P.ID);
      SOD_N.cntx_psh();
      SOD_N.index('SOD_N1');
      SOD_N.prefix(_bazaP);
      {? SOD_N.first()
      ||
         {!
         |?
            _bazaN:=SOD_N.ref();
            SOD_N.cntx_psh();
            SOD_N.prefix();
            SOD_N.SOD_P:=_newP;
            SOD_N.DM:=date();
            _wyn:=SOD_N.add(1);
            {? _wyn
            || SOD.cntx_psh();
               SOD.index('SODN');
               SOD.prefix(_bazaN);
               {? SOD.first
               || {!
                  |?
                     SOD.SOD_N:=SOD_N.ref();
                     {? SOD.AUTO='R' || SOD.AUTO:='A' ?};
                     {? SOD.OPIS*'koryguj'
                     || SOD.WAR:='K'
                     ?};
                     SOD.cntx_psh();
                     SOD.prefix();
                     _wyn:=SOD.add(1);
                     SOD.cntx_pop();
                     _wyn & SOD.next()
                  !}
               ?};
               SOD.cntx_pop()
            ?};
            SOD_N.cntx_pop();
            _wyn & SOD_N.next()
         !}
      ?};
      SOD_N.cntx_pop()
   ?};
   {? _wyn
   || SOD_P.seek(_bazaP);
      SOD_P.ZA:='T';
      _wyn:=SOD_P.put(1)
   ?};
   {? ~_wyn || undo() ?};
   end();
   {? ~_wyn
   || FUN.info('Utworzenie korekty nie powiodło się.'@)
   || exec('doclpn','!ppl_zes_exso')
   ?}
?};
{? _newP>0 || SOD_P.seek(_newP) ?};
_wyn


\popraw_sod
::----------------------------------------------------------------------------------------------------------------------
::  UTW: pkoso [2009+]
:: OPIS: Poprawienie wartosci dla pozycji naglowka.
::   WE: wykorzystywane zmienne globalne
::  OLD: \popraw_sod/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=1;
{? SOD.AUTO='B'
|| FUN.choice('Niedozwolone modyfikowanie wskazanej pozycji.'@);
   return(0 )
?};
undefine();
define('header1',~~);
{? _wyn
|| _ok:=
      {? SOD.R='S'
      || _edit:={? SOD.PR>0
                || SOD.PR
                || _szer:=MS.fld_len('SOD','WAR')/2;
                   {? 2*({? +SOD.WAR>0 || +SOD.WAR || 30 ?})>_szer
                   || _szer
                   || 2*{? +SOD.WAR>0 || +SOD.WAR || 30 ?}
                   ?}
                ?};
         define('WART',exec('Stype','!ppl_zes_exso',SOD.WAR,SOD.R),5*' '+'Wartość:',,_edit,_edit+2)
      |? SOD.R='D'
      || define('WART',exec('Stype','!ppl_zes_exso',SOD.WAR,SOD.R),5*' '+'Wartość:')
      |? SOD.R='R'
      || define('WART',exec('Stype','!ppl_zes_exso',SOD.WAR,SOD.R),5*' '+'Wartość:',,,,SOD.PR)
      ?};
   define('header2',~~);
   def_btn('text=%1, icon=xwin16.png:13, btn_label_align=center'['OK'@],"'key:F2'");
   def_btn('text=%1, icon=xwin16.png:14, btn_label_align=center'['Anuluj'@],"'key:Esc'");
   {? _ok
   || _dalej:=def_edit(,'|--|'+{? +SOD.OPIS || SOD.OPIS || 'Proszę wprowadzić nową wartość'@ ?});
      {? _dalej
      || exec('d_act','!ppl_zes_exso',SOD.SOD_N,SOD.NR,SOD.OPIS,DEFINE.WART,'R',SOD.PR,SOD.SUM)
      || _wyn:=0
      ?}
   || _wyn:=0
   ?}
?};
undefine();
_wyn


\nagl_aktual
::----------------------------------------------------------------------------------------------------------------------
::  UTW: pkoso [2009+]
:: OPIS: Aktualizacja podsumowan dla naglowka.
::   WE: _a : jesli podany, oznacza konkretna pozycje dla sumy
::            wartosc 0 lub brak parametru - wyliczenie dla wszystkich podsumowan
::      [_b] - typ dokumentu naglowkowego - jesli nie podane czytany jest typ wg biezacego rekordu SOD_N
::  OLD: \nagl_aktual/sodir.fml
::----------------------------------------------------------------------------------------------------------------------

_a:={? var_pres('_a')=type_of(0) || _a$0 ?};
{? _>1 & type_of(_b)=type_of('')
|| _type:=_b
|| _type:=SOD_N.SOD_S().NAG
?};

SOD_N.cntx_psh;
SOD.cntx_psh;
SOD.prefix();
SOD_N.index('SOD_N3');
SOD_N.prefix(SOD_P.ref);
{? ~SOD_N.find_tab(,'SOD_S','DOK','=',_type,'SOD_S','NAG','=','')
|| SOD_N.cntx_pop;
   SOD.cntx_pop;
   return(0)
|| _ver:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0,0)
?};

{? ~_a & _type='WND'
|| {? _ver<3
   || exec('d_act','!ppl_zes_exso',SOD_N.ref,15,'Liczba załączników INF-D-Z',$exec('count','!ppl_zes_exso','INF-D-Z'),'N');
      exec('d_act','!ppl_zes_exso',SOD_N.ref,16,'Liczba załączników INF-D-P',$exec('count','!ppl_zes_exso','INF-D-P'),'N')
   |? _ver=3
   || exec('d_act','!ppl_zes_exso',SOD_N.ref,13,'Liczba załączników INF-D-P',$exec('count','!ppl_zes_exso','INF-D-P'),'N');
      _sum:=exec('f_sum','!ppl_zes_exso',SOD_N.ref,43,date(SOD_N.SOD_P().R,SOD_N.SOD_P().MP,1),
                                              date(SOD_N.SOD_P().R,SOD_N.SOD_P().MK,0),'INF-D-P');
      exec('d_act','!ppl_zes_exso',SOD_N.ref,12,,_sum,'N',2)
   |? _ver=4
   || exec('d_act','!ppl_zes_exso',SOD_N.ref,14,'Liczba załączników INF-D-P',$exec('count','!ppl_zes_exso','INF-D-P'),'N')
   ?}
|? ~_a & _type='WNU'
||
  exec('d_act','!ppl_zes_exso',SOD_N.ref,16,'Liczba załączników INF-U-P',$exec('count','!ppl_zes_exso','INF-U-P'),'N');
  exec('d_act','!ppl_zes_exso',SOD_N.ref,15,'Liczba załączników INF-U-G',$exec('count','!ppl_zes_exso','INF-U-G'),'N');
  exec('d_act','!ppl_zes_exso',SOD_N.ref,15,'Liczba załączników INF-U-A',$exec('count','!ppl_zes_exso','INF-U-A'),'N');
  exec('d_act','!ppl_zes_exso',SOD_N.ref,15,'Liczba załączników WNU_II',$exec('count','!ppl_zes_exso','WNU_II'),'N')
?};

{? _a || _pocz:=_a; _ile:=_a || _pocz:=1; _ile:=SOD_N.size ?};
_suma:=obj_new(_ile);
{! _ind:=_pocz.._ile |! _suma[_ind]:=0 !};

SOD.index('SODP');
SOD.prefix(SOD_P.ref);
{? SOD.first
|| {! _ind:=_pocz.._ile
   |! SOD.prefix(SOD_P.ref,_ind);
      {? SOD.first || {! |? _suma[_ind]+=exec('Stype','!ppl_zes_exso',SOD.WAR,'R'); SOD.next !} ?}
   !}
?};

SOD.index('SODN');
SOD.prefix(SOD_N.ref);
{? SOD.first()
|| {! _ind:=_pocz.._ile
   |! {? _suma[_ind]<>0 & SOD.find_key(_ind)
      || SOD.WAR:=exec('typeS','!ppl_zes_exso',_suma[_ind],SOD.PR); SOD.put
      ?}
   !}
?};
obj_del(_suma);
SOD_N.cntx_pop;
SOD.cntx_pop


\w_lud
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Odswiezenie zawartosci okna __winlud.
::  OLD: \w_lud/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_par:=params_get();
SOD_N.index('SOD_N3');
SOD_N.prefix(SOD_P.ref,__DOC.DOK,__DOC.DOK);
{? SOD_N.first()
|| grp_disp(SOD_N,__winlud)
|| SOD.prefix(0);
   grp_disp(SOD_N,__winlud);
   grp_disp(SOD,__winrec)
?}


\w_rec
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Odswiezenie zawartosci okna __winrec.
::  OLD: \w_rec/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
SOD_N.SOD_P();
SOD.index('SODN');
{? SOD_N.size
|| SOD.prefix(SOD_N.ref);
   SOD.first
|| SOD.prefix(0)
?};
grp_disp(SOD,__winrec)


\ten_solo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Generowanie dokumentu pojedynczego pracownika.
::  [_a] - 1          - aktualizacja dokumentu naglowkowego (osoby bez walidacji)
::         0 lub brak - generowanie nowego dokumentu naglowkowego
::                      (parametr bedzie przekazany jedynie do wlasciwej formuly)
::  OLD: \ten_solo/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__Grupa')<=0
|| __Grupa:=0
?};
_dx:={? _>0 || _a || 0 ?};
{? _dx
|| __DocT:={? var_pres('__DOC')>100 || __DOC.DOK || SOD_N.SOD_S().DOK ?}
?};
exec('DokSave','!ppl_zes_exso',_dx);
{? __Grupa=0
|| exec('ten_afg','!ppl_zes_exso',_dx)
?}


\ten_bfg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Akcja przed dla wywolania grupowo.
::  OLD: \ten_bfg/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__Grupa:=1;
~~


\ten_afg
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Akcja po dla wywolania grupowo oraz po obrobce ludzika dla akcji.
::  [_a] - 1          - aktualizacja dokumentu naglowkowego (osoby bez walidacji)
::         0 lub brak - generowanie nowego dokumentu naglowkowego
::  [_b] - 1 bez wyjścia przez sel_exit
::  OLD: \ten_afg/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__Grupa:=0;
_dx:={? _>0 || _a || 0 ?};
_czy_exit:=var_pres('_b')=type_of(0) & _b;
{? __DocT<>__DocTN
||
   {? ~_dx
   || __DocT:=__DocTN;
      exec('DokSave','!ppl_zes_exso',_dx)
   ?}
?};
{? (~_dx & ~_czy_exit) | (var_pres('__Close')>0 & __Close) || sel_exit() ?}


\NAGs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zapis naglowka dokumentu do bazy.
::       _a - nazwa plikowa dokumentu
::  OLD: \NAGs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_echo:='';
{? ~exec('sod_p','!ppl_zes_exso',__IDP,'')
|| return(0)
?};
SOD_N.prefix();
SOD_N.blank();
SOD_N.SOD_P:=SOD_P.ref();
SOD_N.PLIK:=_a;
SOD_N.SOD_S:=SOD_S.ref();
{? SOD_N.SOD_S().DOK='INF-D-P' | SOD_N.SOD_S().DOK='INF-U-P'
|| SOD_N.NAZ:=P.OSOBA().NAZWISKO;
   SOD_N.IM:=OSOBA.PIERWSZE;
   SOD_N.PESEL:=OSOBA.PESEL
|| {? SOD_N.SOD_S().DOK='WND'
   || SOD_N.NAZ:='Wniosek o wypłatę dofinansowań';
      SOD_N.IM:='za okres '+__okSp;
      SOD_N.PESEL:='WnD'
   |? SOD_N.SOD_S().DOK='WND2II'
   || SOD_N.NAZ:='Załącznik aktualizacji danych';
      SOD_N.IM:='za okres '+__okSp;
      SOD_N.PESEL:='WND cz.II';
      _echo:='Dozwolono dodanie jednego załącznika WND cz.II.'
   |? SOD_N.SOD_S().DOK='INF-D-Z'
   || SOD_N.NAZ:='Załącznik INF-D-Z';
      SOD_N.IM:='za okres '+__okSp;
      SOD_N.PESEL:='INF-D-Z';
      _echo:='Dozwolono dodanie jednego załącznika INF-D-Z.'
   |? SOD_N.SOD_S().DOK='WNU'
   || SOD_N.NAZ:='Wniosek o wypłatę refundacji';
      SOD_N.IM:='za okres '+__okSp;
      SOD_N.PESEL:='WnU'
   |? SOD_N.SOD_S().DOK='WNU_II'
   || SOD_N.NAZ:='Załącznik aktualizacji danych';
      SOD_N.IM:='za okres '+__okSp;
      SOD_N.PESEL:='WNU cz.II';
      _echo:='Dozwolono dodanie jednego załącznika WNU cz.II.'
   ?}
?};
SOD_N.DM:=date();
_wyn:=SOD_N.add(1);
{? ~_wyn & +_echo || FUN.emsg(_echo) ?};
_wyn


\NAGr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Odszukanie naglowka w bazie i ustawienie dziedziny pozycji.
::       [_a] - nazwa plikowa
::              brak prametru - biezacy rekord SOD_N
::   WY: 1 - zakonczone powodzeniem
::        0 - nie udalo sie
::  OLD: \NAGr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? _=0
|| SOD_P.seek(SOD_N.SOD_P);
   SOD_S.seek(SOD_N.SOD_S);
   SOD.index('SODN');
   SOD.prefix(SOD_N.ref);
   SOD.first
||
  SOD_N.prefix();
  {? SOD_N.find_tab(,'PLIK',,'=',_a)
  || SOD_P.seek(SOD_N.SOD_P);
     SOD_S.seek(SOD_N.SOD_S);
     SOD.index('SODN');
     SOD.prefix(SOD_N.ref);
     SOD.first
  || SOD.prefix();
     0
  ?}
?}


\DokSave
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Czesc A dokumentu.
::   WE: __DocT, __DocTN - zmienne globalne
::    _a - walidacja pracownikow: 1 - nie, 0 - tak
::  OLD: \DokSave/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? _=0 || _a:=0 ?};
{? var_pres('__cas')>0 & __cas=1 || __cas:=0 || __cas:=1 ?};
exec('cleaner','!ppl_zes_exso');
_next:=0;
{!
|?
   _file:=exec('typdok','!ppl_zes_exso');
   {? +_file>0
   || {? SOD_S.DOK='INF-D-P'
       | SOD_S.DOK='INF-D-Z'
       | SOD_S.DOK='INF-U-P'
       | SOD_S.DOK='WND'
       | SOD_S.DOK='WND2II'
       | SOD_S.DOK='WNU'
       | SOD_S.DOK='WNU_II'
      ||
         exec(exec('txt_cut','!ppl_zes_exso',__DocT,'-')+'s','!ppl_zes_exso',_file,_a)
      ?};
      1
   || return(0)
   ?};
   _next
!};
exec('cleaner','!ppl_zes_exso');
1


\typdok
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Czesc kontrolna typow dokumentow; okreslenie nazwy plikowej dokumentu
::       (formula sprawdza czy dany typ dokumentu jest obslugiwany, jesli tak uzupelnia czesc informacji
::       zaleznych jedynie od typu dokumentu).
::   WE: __DocT   - typ dokumentu [string] - oznaczenie zgodne z formatem SODiR
::       [_a]     - symbol typu dokumentu
::       [_b]     - numer wersji [interger]
::       [_c]     - korekta? (Z lub nie podany - dokument zwykly; K - dokument korygujacy)
::
::   WY: true        - prefix nazwy pliku wyjsciowego [string]
::       false       - ciag pusty [string]
::       __idTypu    - id typu [string]
::  OLD: \typdok/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
::----------------------------------------------------------------------------------------------------------------------
:: LEGENDA FORMATU NAZWY PLIKU
:: Typ             typ dokumentu o wartosciach infd, infdp, infdz, wnd, wndii, wnd2, infdr, wnu, infup,
::                  indua, wnuii
:: Okres           okres w formacie MM-RRRR np. (01-2004)
:: Okres12         okres w formacie MM-RRRR, przy czym miesiac zawsze 12 np. (12-2004)
:: Pierwszy_okres  dla dokumentow WnD pierwszy okres, ktorego dotyczy wniosek o
::                  dofinansowanie w formacie MM-RRRR np. (01-2004)
:: NumerPESEL      numer PESEL pracownika
::----------------------------------------------------------------------------------------------------------------------
_dok:={? _>0 & type_of(_a)=type_of('') || _a || __DocT ?};
_wer:={? _>1 & type_of(_b)=type_of(0) || _b || 0 ?};
__G[16]:={? _>2 & type_of(_c)=type_of('') || _c || 'Z' ?};
__werTyp:='';
_wyn:='';
{? _dok='INF-D-Z'
|| __idTypu:='4';
   _wyn:='infdz_'+__okSp+'_1'

|? _dok='WND2II'
||
   __idTypu:='4';
   _wyn:='wndii_'+__okSp+'_1'

|? _dok='WNU'
||
   __werTyp:='1';
   __idTypu:={? __G[16]='Z' || '31' || '32' ?};
   _wyn:='wnu_'+__okSp

|? _dok='WNU_II'
||
   __werTyp:='1';
   __idTypu:='29';
   _wyn:='wnuii_'+__okSp+'_1'

|? _dok='INF-U-P'
||
   __werTyp:='1';
   __idTypu:='30';
   _wyn:='infup_'+__okSp+'_'+P.OSOBA().PESEL

|? _dok='INF-U-G'
||
   __werTyp:='1';
   __idTypu:='45';
   _wyn:='infug_'+__okSp+'_'+P.OSOBA().PESEL

|? _dok='INF-U-A'
||
   __werTyp:='1';
   __idTypu:='47';
   _wyn:='infua_'+__okSp+'_'+P.OSOBA().PESEL

|? _dok='WND'
||
   __idTypu:={? __G[16]='Z' || '8' || '9' ?};
   _wyn:='wnd'+{? _wer>=2
               || __werTyp:=$_wer;
                  __werTyp
               || ''
               ?}+'_'+__okSp

|? _dok='INF-D-P'
||
   __werTyp:='4';
   __idTypu:='5';
   _wyn:='infdp'+{? _wer>4
                 || __werTyp:=$_wer;
                    __werTyp
                 || ''
                 ?}+'_'+__okSp+'_'+P.OSOBA().PESEL

|| FUN.emsg('Wskazany typ dokumentu nie jest obsługiwany.'@)
?};
{? _wyn<>''
|| {? ~exec('sod_s','!ppl_zes_exso',_dok)
   || _wyn:=''
   ?}
?};
_wyn


\DokExpo
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Czesc uniwersalna (wspolna) formularzy.
::   WE: dane pobierane ze zmiennych globalnych - zaklada sie poprawnosc i kompletnosc przechowywanych informacji
::       oraz wlasciwe ustawienie masek i dziedzin tabel
::    _a - uchwyt pliku
::    _b - nazwa plikowa dokumentu
::  OLD: \DokExpo/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=1;
{? exec('NAGr','!ppl_zes_exso')
|| _dok:=SOD_N.SOD_S().DOK;
   _kor:=SOD_N.SOD_P().KOR;
   _styp:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0,0);
   exec('typdok','!ppl_zes_exso',_dok,_styp,_kor);
   _dokGT:={? ',4,5,29,30,47,'*(','+__idTypu+',') || 1 || 0 ?}
|| return(0)
?};

_nw:=exec('eol','!ppl_zes_exso');
_tresc:=
       '<?xml version="'+__G[1]+'" encoding="'+__G[2]+'"?>'+
   _nw+'<wniosek idWnioskuGlownego="'+__G[14]+'" stanWyslania="'+__G[13]+'">'+
   _nw+'  <pytanie bilet="'+__G[8]+'" kanal="'+__G[4]+'" login="'+__G[9]+'">';
exec('f_save','!ppl_zes_exso',_a,_tresc);

_tresc:=
   _nw+'     <parametry>'+
   _nw+'        <dokument czyOdrzucic="'+__G[5]+
                '" czyZmienicStan="'+__G[6]+'" idDokumentuTemp="'+{? _dokGT || '" idDokumentuGlownegoTemp="' || '' ?}+
                '" idOddzialu="'+__G[11]+'" idPracodawcy="'+__G[12]+'"'+
   _nw+'           idStanu="'+__G[7]+'" idTypu="'+__idTypu+
                   '" okresSprawozdawczy="'+__okSp+
                   '" sposobWymiany="'+__G[3]+
                   '" wersjaTypu="'+__werTyp+'">'+
   _nw+'           <tresc>'+
   _nw;
exec('f_save','!ppl_zes_exso',_a,_tresc);

   __FF:=_a;
   exec(exec('txt_cut','!ppl_zes_exso',_dok,'-')+'r','!ppl_zes_exso',SOD_N.PLIK);
   VAR_DEL.delete('__FF');

_tresc:=
       '           </tresc>'+
   _nw+'           <podpisy>'+
   _nw+'              <podpis podpis="'+__G[10]+'"/>'+
   _nw+'           </podpisy>'+
   _nw+'        </dokument>'+
   _nw+'     </parametry>'+
   _nw+'  </pytanie>'+
   _nw+'</wniosek>';
exec('f_save','!ppl_zes_exso',_a,_tresc);
_wyn


\data_st
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Ustawienie stałych.
::   WE: __DocT - typ dokumentu [string] - oznaczenie zgodne z formatem SODiR
::       [_a] - szybka formula
::   WY: ~~
::  OLD: \data_st/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? _>0 & type_of(_a)=type_of(0) & _a>0
|| _fast:=1
|| _fast:=0
?};
_od:=date(#(__okSp+4),#(2+__okSp),1);
_do:=date(#(__okSp+4),#(2+__okSp),0);

__G[1]:='1.0';                                                      'wersja XML';
__G[2]:='UTF-8';                                                    'Kodowanie';
__G[3]:='E';                                                        'Sposob wymiany';
__G[4]:='3';                                                        'Kanal';
__G[5]:='N';                                                        'Czy odrzucic';
__G[6]:='T';                                                        'Czy zmienic stan';
__G[7]:='0';                                                        'Id stanu';
__G[8]:='';                                                         'bilet';
__G[9]:='';                                                         'Login';
__G[10]:='';                                                        'Podpis';
__G[11]:='';                                                        'Id oddzialu';
__G[12]:='';                                                        'Id pracodawcy';
__G[13]:='';                                                        'Stan wyslania';
__G[14]:='';                                                        'Id wniosku glownego';
__G[15]:='';                                                        'Id dokumentu - temp';

__G[21]:=KST.PFFORPR;                                               'Forma prawna';
__G[22]:=KST.PFFORPRP;                                              'Forma prawna przedsiebiorcy';
__G[23]:=KST.PFFORWLA;                                              'Forma wlasnosci';
__G[24]:=KST.PFTYPFIR;                                              'Typ pracodawcy';
__G[25]:=KST.PFWIEFIR;                                              'Wielkosc pracodawcy';
__G[26]:={? KST.PFR_R_L+KST.PFR_R_U+KST.PFR_R_Z>0 || 'R' || 'N' ?}; 'Podwyzszone koszty zatrudnienia';

{? _fast=0
||
   _pyt:={? _od~1>=2011
         || 0
         || ~choice('Czy średnie zatrudnienie osób niepełnosprawnych\n'+
                    'ma być ustalane metodą uproszczoną?',FUN.TYT,'ASK',,,,'&Tak','&Nie')
         ?};
   {? _od~1<2011
   ||
::    Srednie zatrudnienie w ostatnich 12 m-cach
      __G[28]:=exec('sr_zatrudnienie','!ppl_zes_exso',date(_od~1,_od~2-12,1),_od-1);

::    Srednie zatrudnienie niepelnosprawnych w ostatnich 12 m-cach - wymiar
      _g53:=exec('sr_zatr_niep','!ppl_zes_exso',date(_od~1,_od~2-12,1),_od-1,_pyt);
      __G[53]:=_g53[1]
   ?};
:: Liczba osob niepelnosprawnych nowozatrudnionych (w etatach)
   _lnowo:=tab_tmp(1,'REF','INTEGER','Ref osoby'
                    ,'NIEP','STRING[1]','Niepełnosprawna'
                    ,'WY','REAL','Wymiar etatu');
   P.cntx_psh();
   P_INFO.cntx_psh();
   P.index('PRACOSOB');
   P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P);
   P_INFO.index('OD');
   {? P.first
   || {!
      |? {? P.DZA>=_od & P.DZA<=_do
         || {? ~_lnowo.find_tab(1,'REF',,'=',#P.OSOBA)
            || _lnowo.blank(1);
               _lnowo.REF:=#P.OSOBA;
               _lnowo.NIEP:='N';
               _lnowo.WY:=P.WY;
               _lnowo.add;
               _datalast:=_do;
               P_INFO.prefix(exec('ref_firma','ustawienia'),P.OSOBA);
               {? P_INFO.last
               || {!
                  |? {? (2+P_INFO.TTUB().KOD)<>'04'
                      & P_INFO.STNP<>null
                      & P_INFO.STNP().KOD<>'0'
                      & _od<=_datalast
                      & P_INFO.OD<=_do
                      & P_INFO.STNP_OD<=_do
                      & (P_INFO.STNP_DO~1=0 | P_INFO.STNP_DO>=_od)
                      & {? _od>=date(2011,03,01)
                        || ~(P_INFO.PREM<>null & P_INFO.PREM().KOD='1' & P_INFO.STNP<>null & P_INFO.STNP().KOD<>'3')
                        || 1
                        ?}
                     ||
                        _lnowo.NIEP:='T';
                        _lnowo.put(1)
                     ?};
                     _datalast:=P_INFO.OD;
                     P_INFO.prev
                  !}
               ?}
            || {? _lnowo.NIEP='T'
               || _lnowo.WY+=P.WY;
                  _lnowo.put()
               ?}
            ?}
         ?};
         P.next
      !}
   ?};
   P_INFO.cntx_pop();
   P.cntx_pop();
   __G[32]:=((sql('select sum(:_a.WY) as IL '+
                    'from :_a '+
                  'where :_a.NIEP=\'T\'',_lnowo)).IL)$3;

:: Srednie zatrudnienie niepelnosprawnych w okresie sprawozdawczym - wymiar
   _g52:=exec('sr_zatr_niep','!ppl_zes_exso',_od,_do,_pyt,3);
   __G[52]:=_g52[1];
:: Srednie zatrudnienie w okresie sprawozdawczym
   __G[27]:=_g52[3];

:: Biezacy stan zatrudnienia ogolem - wymiar w 2011
:: Biezacy stan zatrudnienia niepelnospr. ogolem - wymiar
   {? _od~1>=2011
   || _g55:=exec('zatr_niep_new','!ppl_zes_exso',_od,_do);
:: poz. 39
      __G[55]:=_g55[1];
:: poz. 40
      __G[54]:=_g55[2];
      {? _od>=date(2015,1,1) || __G[54]:=0 ?};
      _g53:=exec('zatr_niep_new','!ppl_zes_exso',date(_od~1,_od~2-12,1),_od-1);
:: poz.41
      __G[28]:=_g53[1];
:: poz. 42
      __G[53]:=_g53[2];
      {? _od>=date(2015,1,1) || __G[53]:=0 ?}
   ?};


:: Pracodawca wykonujacy dzialalnosc gospodarcza
   __G[56]:='';

:: Czy ustalac efekt zachety?
:: (metoda ilosciowa, sposob drugi - zgodnie z wyrokiem TSWE w sprawie Lodato (C-415/07)
   __G[57]:='';

   1
?};

__G[30]:=0;                                                            'Wymiar zatrudnienia pracownika';
__G[31]:=0;                                                            'Liczba dni przepracowanych';


{? KST.PFZPCCZY=1
|| __G[40]:=KST.PFZPCDST;                                            'Data uzyskania statusu';
   __G[41]:=KST.PFZPCDAT;                                            'Data wydania decycji';
   __G[42]:=KST.PFZPCDEC;                                            'Podstawa uzyskania statusu';
   __G[43]:=KST.PFZPCPP;                                             'Rodzaj decyzji';
   __G[44]:=KST.PFZPCZNA;                                            'Znak decyzji'
?};
__G[45]:=KST.PFRON;                                                  'Numer PFRON';


__G[50]:={? +KST.KKOD & +KST.KMIASTO & +KST.KULICA & +KST.KDOM & +KST.KLOKAL & +KST.KTEL & +KST.KFAX & +KST.KEMAIL
         || {? KST.KKOD=KST.KOD & KST.KMIASTO=KST.MIASTO & KST.KULICA=KST.ULICA & KST.KDOM=KST.DOM & KST.KLOKAL=KST.LOKAL
            || 'T'
            || 'N'
            ?}
         || 'T'
         ?};
__G[51]:=exec('kod_woje','!ppl_zes_exso',KST.WOJEWODZ);                      'Kod wojewodztwa';


exec('zero_ch','!ppl_zes_exso');
~~


\okress
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Ustalenie okresu sprawozdawczego.
::   WE: wymagane zmienne globalne
::   WY: okres sprawdozdawczy, data zlozenia dokumentow
::  OLD: \okress/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__IDP:=exec('gen_id','!ppl_zes_exso');
__dataZl:=date(0,0,0);
__okWp:=__okSp:=(('00'+$O.M)+2)+'-'+$O.R;
exec('czytaj','#stalesys',date( #(__okSp+4),#(2+__okSp),0),KST);
SOD.use('sod'+(__okSp+4));
_mc:=date(O.R,O.M,1);
_mc:=((_mc$8)*' ')+_mc$8;
__Header:='Data złożenia: %1 *** za okres: %2 %3'@[__dataZl$1,_mc,$O.R];
1


\WNUs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Dokument WNU - zbieranie danych i zapis do bazy (wersja 1)
::  OLD: \WNUs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wer:=1;
_file:=exec('typdok','!ppl_zes_exso','WNU',_wer);

{? exec('NAGs','!ppl_zes_exso',_file)
||
   _ref:=SOD_N.ref;

   _xWNUII:=exec('count','!ppl_zes_exso','WNU_II');
   _xINFUP:=exec('count','!ppl_zes_exso','INF-U-P');
   _xINFUA:=exec('count','!ppl_zes_exso','INF-U-A');
   _xINFUZ:=exec('count','!ppl_zes_exso','INF-U-Z');
   _xINFUG:=exec('count','!ppl_zes_exso','INF-U-G');

   exec('d_save','!ppl_zes_exso',_ref,0,'Wersja',_wer,'B');
   exec('d_save','!ppl_zes_exso',_ref,1,'Numer w rejestrze PFRON',__G[45]);
   exec('d_save','!ppl_zes_exso',_ref,2,'Skrócona nazwa wnioskodawcy',KST.SKROT);
   exec('d_save','!ppl_zes_exso',_ref,3,'REGON',14+(KST.REG+(14*'0')));
   exec('d_save','!ppl_zes_exso',_ref,4,'NIP',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'));
   exec('d_save','!ppl_zes_exso',_ref,5,'Kod pocztowy',KST.KOD);
   exec('d_save','!ppl_zes_exso',_ref,6,'Miejscowość',KST.MIASTO);
   exec('d_save','!ppl_zes_exso',_ref,7,'Ulica',KST.ULICA);
   exec('d_save','!ppl_zes_exso',_ref,8,'Nr domu',KST.DOM);
   exec('d_save','!ppl_zes_exso',_ref,9,'Nr lokalu',KST.LOKAL);
   exec('d_save','!ppl_zes_exso',_ref,10,'telefon',KST.PFTEL);
   exec('d_save','!ppl_zes_exso',_ref,11,'fax',KST.PFFAX);
   exec('d_save','!ppl_zes_exso',_ref,12,'e-mail',KST.PFEMAIL);
   exec('d_save','!ppl_zes_exso',_ref,13,'Okres sprawozdawczy',__okSp);
   exec('d_save','!ppl_zes_exso',_ref,98,'Kwartał',ceil(#(2+__okSp)/12*4));
   exec('d_save','!ppl_zes_exso',_ref,99,'Wniosek o przedłużenie okresu wypł. dofinansowania','N');
   exec('d_save','!ppl_zes_exso',_ref,15,'Liczba załączników WNU czII',_xWNUII);
   exec('d_save','!ppl_zes_exso',_ref,16,'Liczba załączników INF-U-P',_xINFUP);
   exec('d_save','!ppl_zes_exso',_ref,17,'Liczba załączników INF-U-G',_xINFUG);
   exec('d_save','!ppl_zes_exso',_ref,18,'Liczba załączników INF-U-A',_xINFUA);
   exec('d_save','!ppl_zes_exso',_ref,19,'Liczba załączników INF-U-Z',_xINFUZ);
   _sum:=exec('f_sum','!ppl_zes_exso',_ref,57,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),0),'INF-U-P');
   exec('d_save','!ppl_zes_exso',_ref,20,'Należna kwota refundacji',_sum,,2);
   exec('d_save','!ppl_zes_exso',_ref,21,'Trudna sytuacja ekonomiczna?','N');
   exec('d_save','!ppl_zes_exso',_ref,23,'Osoba występująca w imieniu wnioskodawcy',OPERATOR.USER().DANE)
|| return(0)
?};
1


\WNUr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: eksport dokumentu typu WNU (wersja 1)
:: _a - nazwa pliku
::  OLD: \WNUr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------

_wer:=0;
_tresc:='';

{? exec('NAGr','!ppl_zes_exso')
|| _wer:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0,0);
   {? _wer=1
   ||
      _ref:=SOD_N.ref;
      _izk:=SOD_N.SOD_P().KOR;
      _dw:=DEFINE.DATA;

      _lWNUII:=exec('d_read','!ppl_zes_exso',_ref,15);
      {? type_of(_lWNUII)=type_of('') || _lWNUII:=#_lWNUII ?};
      _czWNUII:={? _lWNUII>0 || 'T' || 'N' ?};
      _lINFUP:=exec('d_read','!ppl_zes_exso',_ref,16);
      {? type_of(_lINFUP)=type_of('') || _lINFUP:=#_lINFUP ?};
      _czINFUP:={? _lINFUP>0 || 'T' || 'N' ?};
      _lINFUG:=exec('d_read','!ppl_zes_exso',_ref,17);
      {? type_of(_lINFUG)=type_of('') || _lINFUG:=#_lINFUG ?};
      _czINFUG:={? _lINFUG>0 || 'T' || 'N' ?};
      _lINFUA:=exec('d_read','!ppl_zes_exso',_ref,18);
      {? type_of(_lINFUA)=type_of('') || _lINFUA:=#_lINFUA ?};
      _czINFUA:={? _lINFUA>0 || 'T' || 'N' ?};
      _lINFUZ:=exec('d_read','!ppl_zes_exso',_ref,19);
      {? type_of(_lINFUZ)=type_of('') || _lINFUZ:=#_lINFUZ ?};
      _czINFUZ:={? _lINFUZ>0 || 'T' || 'N' ?};
      _nw:=exec('eol','!ppl_zes_exso');
      _q:=13*' ';

      _tresc:=
             _q+'<daneInformacji dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+'"'+
         _nw+_q+'imieNazwiskoOsobyPodpisujacej="'+exec('d_read','!ppl_zes_exso',_ref,23)+
              '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
              '" rodzajInformacji="'+_izk+'"'+
         _nw+_q+'wnOPrzedluzenie="'+exec('d_read','!ppl_zes_exso',_ref,99)+
              '" okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,13)+
              '" kwartal="'+$exec('d_read','!ppl_zes_exso',_ref,98)+'" uwagi=""'+
         _nw+_q+'jestINFUA="'+_czINFUA+'" jestINFUG="'+_czINFUG+
                '" jestINFUP="'+_czINFUP+'" jestINFUZ="'+_czINFUZ+'"'+
         _nw+_q+'liczbaINFUPGA="'+$(_lINFUP+_lINFUG+_lINFUA)+'" liczbaINFUZ="'+$_lINFUZ+
              '" oswSytEkon="'+exec('d_read','!ppl_zes_exso',_ref,21)+'" />'+
         _nw+_q+'<kartaPracodawcy>'+
         _nw+_q+'<daneEwidencyjne nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+
              '" regon="'+exec('d_read','!ppl_zes_exso',_ref,3)+'"'+
         _nw+_q+'skroconaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,2)+
              '" imie="" nazwisko="" />'+
         _nw+_q+'<adresPracodawcy>'+
         _nw+_q+'<adres kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,5)+
              '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,6)+
              '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,8)+'"'+
         _nw+_q+'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,9)+
              '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,7)+'" />'+
         _nw+_q+'<kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,12)+
              '" faks="'+exec('d_read','!ppl_zes_exso',_ref,11)+
              '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,10)+'" />'+
         _nw+_q+'</adresPracodawcy>'+
         _nw+_q+'<infDofinansowanie ogolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,20),SOD.PR)+'" />'+
         _nw+_q+'</kartaPracodawcy>'+
         _nw;

      exec('f_save','!ppl_zes_exso',__FF,_tresc)

   ?}
?};
+_tresc


\WNDs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Dokument WND - zbieranie danych i zapis do bazy.
::   WE: _a - nazwa plikowa dokumentu
::       _b - walidacja: 1 - nie, 0 - tak
::  OLD: \WNDs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? date(#(__okSp+4),#(2+__okSp),1)<date(2009,01,01)
|| _wer:=2;
   _a:=exec('typdok','!ppl_zes_exso','WND',_wer)
|? date(#(__okSp+4),#(2+__okSp),1)<date(2014,04,01)
|| _wer:=4;
   _a:=exec('typdok','!ppl_zes_exso','WND',_wer)
|? date(#(__okSp+4),#(2+__okSp),1)<date(2015,01,01)
|| _wer:=5;
   _a:=exec('typdok','!ppl_zes_exso','WND',_wer)
|| _wer:=6;
   _a:=exec('typdok','!ppl_zes_exso','WND',_wer)
?};

{? exec('NAGs','!ppl_zes_exso',_a)
||
   {? _wer=2 | _wer=3 | _wer=4 | _wer=5 | _wer=6
   || exec('WNDs'+$_wer,'!ppl_zes_exso')
   || return(0)
   ?}
|| return(0)
?};
1


\WNDs2
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Dokument WND - (wersja 2).
::  OLD: \WNDs2/sodir.fml
::----------------------------------------------------------------------------------------------------------------------

_ref:=SOD_N.ref;
_xINFDZ:=$exec('count','!ppl_zes_exso','INF-D-Z');
_xINFDP:=$exec('count','!ppl_zes_exso','INF-D-P');

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',2,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer w rejestrze PFRON',__G[45]);
exec('d_save','!ppl_zes_exso',_ref,2,'Skrócona nazwa pracodawcy',KST.SKROT);
exec('d_save','!ppl_zes_exso',_ref,3,'REGON',14+(KST.REG+(14*'0')));
exec('d_save','!ppl_zes_exso',_ref,4,'NIP',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'));
exec('d_save','!ppl_zes_exso',_ref,5,'Kod pocztowy',KST.KOD);
exec('d_save','!ppl_zes_exso',_ref,6,'Miejscowość',KST.MIASTO);
exec('d_save','!ppl_zes_exso',_ref,7,'Ulica',KST.ULICA);
exec('d_save','!ppl_zes_exso',_ref,8,'Nr domu',KST.DOM);
exec('d_save','!ppl_zes_exso',_ref,9,'Nr lokalu',KST.LOKAL);

exec('d_save','!ppl_zes_exso',_ref,10,'e-mail',KST.PFEMAIL);
exec('d_save','!ppl_zes_exso',_ref,11,'fax',KST.PFFAX);
exec('d_save','!ppl_zes_exso',_ref,12,'telefon',KST.PFTEL);

exec('d_save','!ppl_zes_exso',_ref,13,'Okres sprawozdawczy',__okSp);

exec('d_save','!ppl_zes_exso',_ref,15,'Liczba załączników INF-D-Z',_xINFDZ);
exec('d_save','!ppl_zes_exso',_ref,16,'Liczba załączników INF-D-P',_xINFDP);

_sum:=exec('f_sum','!ppl_zes_exso',_ref,50,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),0),'INF-D-P');
exec('d_save','!ppl_zes_exso',_ref,17,'Należna kwota dofinansowania',_sum,,2);

exec('d_save','!ppl_zes_exso',_ref,18,'Trudna sytuacja ekonomiczna?','N');

exec('d_save','!ppl_zes_exso',_ref,20,'Osoba występująca w imieniu wnioskodawcy',OPERATOR.USER().DANE);

exec('d_save','!ppl_zes_exso',_ref,99,'Wniosek o przedłużenie okresu wypł. dofinansowania','N')


\WNDs3
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Dokument WND - (wersja 3).
::  OLD: \WNDs3/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? __G[46] & ~exec('rachunki_banki','rachunki') || __G[46]:=0 ?};
_dxt:=date(#(__okSp+4),#(2+__okSp),1);


_ref:=SOD_N.ref;
_xINFDP:=$exec('count','!ppl_zes_exso','INF-D-P');
exec('d_save','!ppl_zes_exso',_ref,0,'Wersja',3,'B');

exec('d_save','!ppl_zes_exso',_ref,2,'Numer w rejestrze PFRON',__G[45]);
exec('d_save','!ppl_zes_exso',_ref,3,'NIP',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'));
exec('d_save','!ppl_zes_exso',_ref,4,'REGON',14+(KST.REG+(14*'0')));
exec('d_save','!ppl_zes_exso',_ref,5,'Skrócona nazwa pracodawcy',KST.SKROT);
exec('d_save','!ppl_zes_exso',_ref,6,'Peła nazwa pracodawcy',{? __G[46] || KST.NAZWA || '' ?});
exec('d_save','!ppl_zes_exso',_ref,7,'Forma prawna pracodawcy',{? __G[46] || __G[22] || '' ?});
exec('d_save','!ppl_zes_exso',_ref,8,'Wielkość pracodawcy',{? __G[46] || __G[25] || '' ?});
exec('d_save','!ppl_zes_exso',_ref,9,'Kod adresu przedsiębiorcy',{? __G[46] || ((7*'0')+KST.GMGUS)+7 || '' ?});
exec('d_save','!ppl_zes_exso',_ref,10,'PKD wnioskodawcy',{? __G[46] || KST.PKD || '' ?});
exec('d_save','!ppl_zes_exso',_ref,11,'Okres sprawozdawczy',__okSp);
_sum:=exec('f_sum','!ppl_zes_exso',_ref,43,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),0),'INF-D-P');
exec('d_save','!ppl_zes_exso',_ref,12,'Należna kwota dofinansowania',_sum,,2);

exec('d_save','!ppl_zes_exso',_ref,13,'Liczba załączników INF-D-P',_xINFDP);

exec('d_save','!ppl_zes_exso',SOD_N.ref,14,'Nr rachunku',{? __G[46] || SKID_RBK.N || '' ?});

exec('d_save','!ppl_zes_exso',_ref,15,'Kod pocztowy',{? __G[46] || KST.KOD || '' ?});
exec('d_save','!ppl_zes_exso',_ref,16,'Poczta',{? __G[46] || KST.POCZTA || '' ?});
exec('d_save','!ppl_zes_exso',_ref,17,'Miejscowość',{? __G[46] || KST.MIASTO || '' ?});
exec('d_save','!ppl_zes_exso',_ref,18,'Ulica',{? __G[46] || KST.ULICA || '' ?});
exec('d_save','!ppl_zes_exso',_ref,19,'Nr domu',{? __G[46] || KST.DOM || '' ?});
exec('d_save','!ppl_zes_exso',_ref,20,'Nr lokalu',{? __G[46] || KST.LOKAL || '' ?});
exec('d_save','!ppl_zes_exso',_ref,21,'telefon',{? __G[46] || KST.PFTEL || '' ?});
exec('d_save','!ppl_zes_exso',_ref,22,'fax',{? __G[46] || KST.PFFAX || '' ?});
exec('d_save','!ppl_zes_exso',_ref,23,'e-mail',{? __G[46] || KST.PFEMAIL || '' ?});

exec('d_save','!ppl_zes_exso',_ref,24,'KORESPONDENCJA: Kod pocztowy',{? __G[46] || KST.KKOD || '' ?});
exec('d_save','!ppl_zes_exso',_ref,25,'KORESPONDENCJA: Poczta',{? __G[46] || KST.KPOCZTA || '' ?});
exec('d_save','!ppl_zes_exso',_ref,26,'KORESPONDENCJA: Miejscowość',{? __G[46] || KST.KMIASTO || '' ?});
exec('d_save','!ppl_zes_exso',_ref,27,'KORESPONDENCJA: Ulica',{? __G[46] || KST.KULICA || '' ?});
exec('d_save','!ppl_zes_exso',_ref,28,'KORESPONDENCJA: nr domu',{? __G[46] || KST.KDOM || '' ?});
exec('d_save','!ppl_zes_exso',_ref,29,'KORESPONDENCJA: nr lokalu',{? __G[46] || KST.KLOKAL || '' ?});
exec('d_save','!ppl_zes_exso',_ref,30,'KORESPONDENCJA: tel.',{? __G[46] || KST.KTEL || '' ?});
exec('d_save','!ppl_zes_exso',_ref,31,'KORESPONDENCJA: fax',{? __G[46] || KST.KFAX || '' ?});
exec('d_save','!ppl_zes_exso',_ref,32,'KORESPONDENCJA: e-mail',{? __G[46] || KST.KEMAIL || '' ?});

exec('d_save','!ppl_zes_exso',_ref,33,'Liczba osób nowozatrudnionych',__G[32],,3);
exec('d_save','!ppl_zes_exso',_ref,34,'Stan zatrudnienia ogółem',__G[27],,3);
exec('d_save','!ppl_zes_exso',_ref,35,'Stan zatrudnienia niepełnosprawnych',__G[52],,3);
exec('d_save','!ppl_zes_exso',_ref,36,'Stan zatrudnienia ogółem za 12 miesięcy',__G[28],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'Stan zatrudnienia niepełnosprawnych za 12 miesięcy',__G[53],,3);

exec('d_save','!ppl_zes_exso',_ref,38,'Osoba występująca w imieniu wnioskodawcy',OPERATOR.USER().DANE);

exec('d_save','!ppl_zes_exso',_ref,39,'Przyrost zatrudnienia netto','N',,3);

exec('d_save','!ppl_zes_exso',SOD_N.ref,99,'Adres do korespondencji taki sam?',__G[50]);
exec('d_save','!ppl_zes_exso',_ref,100,'Oświadczenie o wybraniu papierowej formy składania wniosków','N');
exec('d_save','!ppl_zes_exso',_ref,101,'Oświadczenie o wybraniu elektronicznej formie składania wniosków','T');
exec('d_save','!ppl_zes_exso',_ref,102,'Oświadczenie o powstaniu nowych miejsc pracy','N');

_demin:=FUN.ask('Czy otrzymano pomoc "de minimis"?');
exec('d_save','!ppl_zes_exso',_ref,103,'Załączono informację o nieotrzymaniu pomocy de minimis',{? _demin || 'N' || 'T' ?});
exec('d_save','!ppl_zes_exso',_ref,104,'Załączono informację o otrzymanej pomocy de minimis',{? _demin || 'T' || 'N' ?});
1


\WNDs4
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [11.22]
:: OPIS: Dokument WND - (wersja 4).
::  OLD: \WNDs4/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? __G[46] & ~exec('rachunki_banki','rachunki') || __G[46]:=0 ?};
_pole26:=_pole27:=_pole28:=_pole29:=_pole30:=_pole31:=_pole32:=_pole33:=_pole34:='';

:: szukanie pelnomocnika w poprzednim dokumencie
_dgr:=date(2011,12,0);
_pole25:=exec('read_last','!ppl_zes_exso',25,'',_dgr);

{? (_pole25=~~ & FUN.ask('Czy w imieniu pracodawcy występuje pełnomocnik?'@))
 | _pole25<>''
||
:: Zgloszenie wysyla pelnomocnik pracodawcy
   {? _pole25=~~ || _pole25:='' ?};
   {? _pole25<>''
   || _pole26:=exec('read_last','!ppl_zes_exso',26,'',_dgr); {? _pole26=~~ || _pole26:='' ?};
      _pole27:=exec('read_last','!ppl_zes_exso',27,'',_dgr); {? _pole27=~~ || _pole27:='' ?};
      _pole28:=exec('read_last','!ppl_zes_exso',28,'',_dgr); {? _pole28=~~ || _pole28:='' ?};
      _pole29:=exec('read_last','!ppl_zes_exso',29,'',_dgr); {? _pole29=~~ || _pole29:='' ?};
      _pole30:=exec('read_last','!ppl_zes_exso',30,'',_dgr); {? _pole30=~~ || _pole30:='' ?};
      _pole31:=exec('read_last','!ppl_zes_exso',31,'',_dgr); {? _pole31=~~ || _pole31:='' ?};
      _pole32:=exec('read_last','!ppl_zes_exso',32,'',_dgr); {? _pole32=~~ || _pole32:='' ?};
      _pole33:=exec('read_last','!ppl_zes_exso',33,'',_dgr); {? _pole33=~~ || _pole33:='' ?};
      _pole34:=exec('read_last','!ppl_zes_exso',34,'',_dgr); {? _pole34=~~ || _pole34:='' ?}
   ?};
   undefine();
   define('P25',_pole25,'Nazwa pełnomocnika*: ','Nazwa pełnomocnika - pole wymagane',60,60);
   define('HD_0',~~,'  Adres pełnomocnika');
   define('P26',_pole26,'ulica:     ','ulica',60,60);
   define('P27',_pole27,'nr domu*:   ','nr domu',10,10);
   define('P28',_pole28,'nr lokalu: ','nr lokalu',10,10);
   define('P29',_pole29,'miejscowość*: ','miejscowość',30,30);
   define('P30',_pole30,'kod pocztowy*: ','kod pocztowy',10,10);
   define('P31',_pole31,'poczta*: ','poczta',30,30);
   define('P32',_pole32,'telefon*: ','telefon',14,14);
   define('P33',_pole33,'fax: ','telefax',14,14);
   define('P34',_pole34,'e-mail: ','adres e-mail',40,40);
   define('HD_1',~~,'');
   define('HD_2',~~,'Pola oznaczone * są wymagane.');
   define('HD_3',~~,'Wszystkie informacje można poprawić');
   define('HD_4',~~,'przed wysłaniem zestawu do programu');
   define('HD_5',~~,'SODiR OffLine');
   define('HD_6',~~,'(podane dane nie są weryfikowane automatycznie).');
   {!
   |? {? def_edit("{? DEFINE.P25=''
                   || FUN.emsg('Podanie nazwy pełnomocnika jest wymagane.'); 'P25'
                   |? DEFINE.P27=''
                   || FUN.emsg('Pole >>nr domu<< jest wymagane.'); 'P27'
                   |? DEFINE.P29=''
                   || FUN.emsg('Pole >>miejscowość<< jest wymagane.'); 'P29'
                   |? DEFINE.P30=''
                   || FUN.emsg('Pole >>kod pocztowy<< jest wymagane.'); 'P30'
                   |? DEFINE.P31=''
                   || FUN.emsg('Pole >>poczta<< jest wymagane.'); 'P31'
                   |? DEFINE.P32=''
                   || FUN.emsg('Pole >>nr telefonu<< jest wymagane.'); 'P32'
                   || 1
                   ?}
                  ",'Uzupełnij/zweryfikuj dane pełnomocnika')
      ||  _pole25:=DEFINE.P25; _pole26:=DEFINE.P26; _pole27:=DEFINE.P27; _pole28:=DEFINE.P28; _pole29:=DEFINE.P29;
          _pole30:=DEFINE.P30; _pole31:=DEFINE.P31; _pole32:=DEFINE.P32; _pole33:=DEFINE.P33; _pole34:=DEFINE.P34;
          0
      || {? FUN.ask('Rezygnacja spowoduje usunięcie zapisu\n'
                    'o przygotowaniu dokumentów przez pełnomocnika.\n'
                    'Ustawienie można zmienić wypełniając w nagłówku\n'
                    'dokumentu WND informację o pełnomocniku i jego adresie.\n'
                    'Czy na pewno kontynuować?'@)
         || _pole25:=_pole26:=_pole27:=_pole28:=_pole29:=_pole30:=_pole31:=_pole32:=_pole33:=_pole34:='';
            0
         || 1
         ?}
      ?}
   !};
   undefine()
?};
{? _pole25=''
||
:: Zgloszenie wysyla pracodawca
   _pole26:={? __G[46] || KST.KULICA || '' ?};
   _pole27:={? __G[46] || KST.KDOM || '' ?};
   _pole28:={? __G[46] || KST.KLOKAL || '' ?};
   _pole29:={? __G[46] || KST.KMIASTO || '' ?};
   _pole30:={? __G[46] || KST.KKOD || '' ?};
   _pole31:={? __G[46] || KST.KPOCZTA || '' ?};
   _pole32:={? __G[46] || KST.KTEL || '' ?};
   _pole33:={? __G[46] || KST.KFAX || '' ?};
   _pole34:={? __G[46] || KST.KEMAIL || '' ?}
?};

_ref:=SOD_N.ref;
_xINFDP:=$exec('count','!ppl_zes_exso','INF-D-P');
exec('d_save','!ppl_zes_exso',_ref,0,'Wersja',4,'B');

exec('d_save','!ppl_zes_exso',_ref,2,'Numer w rejestrze PFRON',__G[45],'B');
exec('d_save','!ppl_zes_exso',_ref,3,'NIP',exec('txt_cut','!ppl_zes_exso',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'),'-'),'B');
exec('d_save','!ppl_zes_exso',_ref,4,'REGON',14+(KST.REG+(14*'0')),'B');
exec('d_save','!ppl_zes_exso',_ref,5,'Pełna nazwa pracodawcy',{? __G[46] || KST.NAZWA || '' ?},'B');

:: pola 6-9 - nie eksportujemy - pola nie wymagane do eksportu, zdefiniowane w SODiR OffLine
::exec('d_save','!ppl_zes_exso',_ref,6,'Forma prawna pracodawcy',{? __G[46] || __G[22] || '' ?});
::exec('d_save','!ppl_zes_exso',_ref,7,'Szczegółowa forma prawna pracodawcy',__G[21]);
::exec('d_save','!ppl_zes_exso',_ref,8,'Forma własności',__G[23]);
::exec('d_save','!ppl_zes_exso',_ref,9,'Wielkość pracodawcy',{? __G[46] || __G[25] || '' ?});

exec('d_save','!ppl_zes_exso',_ref,10,'Kod adresu przedsiębiorcy',{? __G[46] || ((7*'0')+KST.GMGUS)+7 || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,11,'PKD wnioskodawcy',{? __G[46] || STR.gsub(KST.PKD,'.','') || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,12,'Okres sprawozdawczy',__okSp,'B');

:: pole 13 - nie wyliczamy ze wzgledu na brak wyliczen kwoty do wyplaty na dokumentach INF-D-P (pole eksportowane z zerowa wartoscia)
:: exec('d_save','!ppl_zes_exso',_ref,13,'Należna kwota dofinansowania',0,'B',2);

exec('d_save','!ppl_zes_exso',_ref,14,'Liczba załączników INF-D-P',_xINFDP,'B');
exec('d_save','!ppl_zes_exso',_ref,15,'Nr rachunku',{? __G[46] || SKID_RBK.N || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,16,'Ulica',{? __G[46] || KST.ULICA || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,17,'Nr domu',{? __G[46] || KST.DOM || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Nr lokalu',{? __G[46] || KST.LOKAL || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Miejscowość',{? __G[46] || KST.MIASTO || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,20,'Kod pocztowy',{? __G[46] || KST.KOD || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,21,'Poczta',{? __G[46] || KST.POCZTA || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,22,'telefon',{? __G[46] || KST.PFTEL || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,23,'fax',{? __G[46] || KST.PFFAX || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,24,'e-mail',{? __G[46] || KST.PFEMAIL || '' ?},'B');

exec('d_save','!ppl_zes_exso',_ref,25,'Pełnomocnik wyst. w im. wnioskodawcy',_pole25,,60);
_koresp:='KORESPONDENCJA/PEŁNOMOCNIK: ';
exec('d_save','!ppl_zes_exso',_ref,26,_koresp+'Ulica',_pole26);
exec('d_save','!ppl_zes_exso',_ref,27,_koresp+'nr domu',_pole27);
exec('d_save','!ppl_zes_exso',_ref,28,_koresp+'nr lokalu',_pole28);
exec('d_save','!ppl_zes_exso',_ref,29,_koresp+'Miejscowość',_pole29);
exec('d_save','!ppl_zes_exso',_ref,30,_koresp+'Kod pocztowy',_pole30);
exec('d_save','!ppl_zes_exso',_ref,31,_koresp+'Poczta',_pole31);
exec('d_save','!ppl_zes_exso',_ref,32,_koresp+'tel.',_pole32);
exec('d_save','!ppl_zes_exso',_ref,33,_koresp+'fax',_pole33);
exec('d_save','!ppl_zes_exso',_ref,34,_koresp+'e-mail',_pole34);

exec('d_save','!ppl_zes_exso',_ref,35,'Status pracodawcy (ZPCH,ZAZ,INNY)',{? KST.PFZPCCZY=1 || 'ZPCH' || 'INNY' ?},,4);

exec('d_save','!ppl_zes_exso',_ref,36,'Liczba osób nowozatrudnionych',__G[32],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'Stan zatrudnienia ogółem',__G[27],,3);
exec('d_save','!ppl_zes_exso',_ref,38,'Stan zatrudnienia niepełnosprawnych',__G[52],,3);
exec('d_save','!ppl_zes_exso',_ref,39,'Bieżący stan zatrudnienia ogółem',__G[55],,3);

exec('d_save','!ppl_zes_exso',_ref,40,'Bieżący stan zatrudnienia niepełnospr. ogółem',__G[54],,3);

exec('d_save','!ppl_zes_exso',_ref,41,'Stan zatrudnienia ogółem za 12 miesięcy',__G[28],,3);
exec('d_save','!ppl_zes_exso',_ref,42,'Stan zatrudnienia niepełn. za 12 miesięcy',__G[53],,3);
exec('d_save','!ppl_zes_exso',_ref,43,'Data wypełnienia',date(),'B');
exec('d_save','!ppl_zes_exso',_ref,99,'Adres do korespondencji taki sam?',{? +_pole25 || 'N' || __G[50] ?});
exec('d_save','!ppl_zes_exso',_ref,100,'Ośw. o wybr. el. formy skł. wniosków','T',,1);
exec('d_save','!ppl_zes_exso',_ref,101,'Załączono inf. o otrzym. pom. de minimis','N',,1);
1


\WNDr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Eksport dokumentu typu WND.
:: _a - nazwa pliku
::  OLD: \WNDr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------

_wyn:=0;
{? exec('NAGr','!ppl_zes_exso')
|| _wer:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0,0);
   {? _wer=2 | _wer=3 | _wer=4 | _wer=5 | _wer=6
   || _wyn:=exec('WNDr'+$_wer,'!ppl_zes_exso')
   ?}
?};
_wyn


\WNDr2
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Eksport dokumentu typu WND (wersja 2).
::  OLD: \WNDr2/sodir.fml
::----------------------------------------------------------------------------------------------------------------------

_tresc:='';
_ref:=SOD_N.ref;
    _izk:=SOD_N.SOD_P().KOR;
    _dw:=DEFINE.DATA;
    _lDZ := exec('d_read','!ppl_zes_exso',_ref,15);
    _czDZ:= {? #_lDZ>0 || 'T' || 'N' ?};
    _lDP := exec('d_read','!ppl_zes_exso',_ref,16);
    _czDP:= {? #_lDP>0 || 'T' || 'N' ?};

    _nw:=exec('eol','!ppl_zes_exso');
    _q:=13*' ';

       _tresc:=
              _q+'<daneInformacji dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+
                               '" imieNazwiskoOsobyPodpisujacej=""'+
                       _nw+_q+'   nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
                               '" rodzajInformacji="'+_izk+
                               '" wnOPrzedluzenie="'+exec('d_read','!ppl_zes_exso',_ref,99)+
                               '" okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,13)+'"'+
                       _nw+_q+'   uwagi="" '+
                                 'jestINFDP="'+_czDP+
                               '" jestINFDZ="'+_czDZ+
                               '" liczbaINFDP="'+$_lDP+
                               '" liczbaINFDZ="'+$_lDZ+
                               '" oswSytEkon="'+exec('d_read','!ppl_zes_exso',_ref,18)+'" />'+
          _nw+_q+'<kartaPracodawcy>'+
          _nw+_q+'   <daneEwidencyjne imie="" nazwisko="" '+
                         'nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+
                       '" regon="'+exec('d_read','!ppl_zes_exso',_ref,3)+'"'+
            _nw+_q+'      skroconaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" />'+
          _nw+_q+'   <adresPracodawcy>'+
          _nw+_q+'      <adres kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,5)+
                            '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                            '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,8)+
                            '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,9)+
                            '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,7)+'" />'+
          _nw+_q+'      <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                              '" faks="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                              '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,12)+'" />'+
          _nw+_q+'   </adresPracodawcy>'+
          _nw+_q+'<infDofinansowanie ogolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,17),SOD.PR)+'" />'+
          _nw+_q+'</kartaPracodawcy>'+
          _nw;

    exec('f_save','!ppl_zes_exso',__FF,_tresc);

+_tresc


\WNDr3
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Eksport dokumentu typu WND (wersja 3).
::  OLD: \WNDr3/sodir.fml
::----------------------------------------------------------------------------------------------------------------------

_tresc:='';
_ref:=SOD_N.ref;
_dw:=DEFINE.DATA;


    _izk:={? SOD_N.SOD_P().KOR='K' || _zglo:='N'; 'K' || _zglo:='T'; 'Z' ?};
    _lDZ := exec('d_read','!ppl_zes_exso',_ref,15);
    _czDZ:= {? #_lDZ>0 || 'T' || 'N' ?};
    _lDP := exec('d_read','!ppl_zes_exso',_ref,16);
    _czDP:= {? #_lDP>0 || 'T' || 'N' ?};

    _nw:=exec('eol','!ppl_zes_exso');
    _q:=13*' ';


       _tresc:=
              _q+'<daneInformacji dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+
                               '" imieNazwiskoOsobyPodpisujacej="'+exec('d_read','!ppl_zes_exso',_ref,38)+'"'+
          _nw+_q+'   okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                  '" rodzajInformacji="'+_izk+
                  '" uwagi="" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,2)+'"'+
          _nw+_q+'   czyZgloszeniowy="'+_zglo+
                  '" liczbaINFDP="'+exec('d_read','!ppl_zes_exso',_ref,13)+'"  />'+
          _nw+_q+'<kartaPracodawcy>'+
          _nw+_q+'   <daneEwidencyjne nip="'+exec('d_read','!ppl_zes_exso',_ref,3)+
                                   '" pkd="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                                   '" regon="'+exec('d_read','!ppl_zes_exso',_ref,4)+'"'+
          _nw+_q+'        pelnaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                      '"  skroconaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,5)+'" />'+
          _nw+_q+'   <dodInfPracodawcy formaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,7)+
                                    '" wielkoscPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,8)+'"/>'+
          _nw+_q+'   <adresPracodawcy>'+
          _nw+_q+'     <adres kodAdresuPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,9)+
                           '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,15)+
                           '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,17)+'"'+
          _nw+_q+'        nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,19)+
                       '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,20)+
                       '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,16)+
                       '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,18)+'"/>'+
          _nw+_q+'     <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,23)+
                             '" faks="'+exec('d_read','!ppl_zes_exso',_ref,22)+
                             '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,21)+'" />'+
          _nw+_q+'   </adresPracodawcy>'+
          _nw+_q+'   <infDofinansowanie ogolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,12),SOD.PR)+'"/>'+
          _nw+_q+'   <rachunekBankowy  nrRachunku="'+exec('d_read','!ppl_zes_exso',_ref,14)+'"/>'+
          _nw+_q+'   <adresKorespondencyjny>'+
          _nw+_q+'      <adres adresJak="'+exec('d_read','!ppl_zes_exso',_ref,99)+
                            '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,24)+
                            '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,26)+
                            '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,28)+
                            '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,29)+'"'+
          _nw+_q+'           ulica="'+exec('d_read','!ppl_zes_exso',_ref,27)+
                        '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,25)+'" />'+
          _nw+_q+'      <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,32)+
                              '" faks="'+exec('d_read','!ppl_zes_exso',_ref,31)+
                              '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,30)+'" />'+
          _nw+_q+'   </adresKorespondencyjny>'+
          _nw+_q+'</kartaPracodawcy>'+
          _nw+_q+'<stanZatrudnienia czyPrzyrostNetto="'+exec('d_read','!ppl_zes_exso',_ref,39)+
                                 '" nowozatrudnieni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,33),SOD.PR)+
                                 '" wOkresieOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,34),SOD.PR)+'"'+
          _nw+_q+'   wOkresieNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,35),SOD.PR)+
                  '" poprzedzajacyOkresNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37),SOD.PR)+'"'+
          _nw+_q+'   poprzedzajacyOkresOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36),SOD.PR)+'" />'+
          _nw+_q+'<oswiadczenie czyPapierowo="'+exec('d_read','!ppl_zes_exso',_ref,100)+
                             '" czyElektronicznie="'+exec('d_read','!ppl_zes_exso',_ref,101)+
                             '" miejscaPracyNiePowstaly="'+exec('d_read','!ppl_zes_exso',_ref,102)+'"'+
          _nw+_q+'   zalaczaInfoONieotrzymanejPomocy="'+exec('d_read','!ppl_zes_exso',_ref,103)+
                  '" zalaczaInfoOOtrzymanejPomocy="'+exec('d_read','!ppl_zes_exso',_ref,104)+'"/>'+
          _nw;

    exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\WNDr4
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [11.22]
:: OPIS: Eksport dokumentu typu WND (wersja 4).
::  OLD: \WNDr4/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
_ref:=SOD_N.ref;
_dw:=DEFINE.DATA;

    _izk    :={? SOD_N.SOD_P().KOR='K' || _zglo:='N'; 'K' || _zglo:='T'; 'Z' ?};
    _statP  :=~-exec('d_read','!ppl_zes_exso',_ref,35);
    _elekt  :=~-exec('d_read','!ppl_zes_exso',_ref,100);
    _demin  :=~-exec('d_read','!ppl_zes_exso',_ref,101);

    _nw:=exec('eol','!ppl_zes_exso');
    _q:=13*' ';

      _tresc:=
            _q+'<daneInformacji '+
                        'czyZgloszeniowy="'+_zglo+'" '+
                        'dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+'" '+
                        'imieNazwiskoOsobyPodpisujacej="" '+
                        'liczbaINFDP="'+exec('d_read','!ppl_zes_exso',_ref,14)+'" '+
                        'nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" '+
                        'okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,12)+'" '+
                        'rodzajInformacji="'+_izk+'" '+
                        'uwagi=""/>'+
       _nw+_q+'<kartaPracodawcy>'+
       _nw+_q+'   <daneEwidencyjne '+
                     'nip="'+exec('d_read','!ppl_zes_exso',_ref,3)+'" '+
                     'pelnaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,5)+'" '+
                     'pkd="'+exec('d_read','!ppl_zes_exso',_ref,11)+'" '+
                     'regon="'+exec('d_read','!ppl_zes_exso',_ref,4)+'"/>'+
       _nw+_q+'   <dodInfPracodawcy '+
                     'formaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,6)+'" '+
                     'formaWlasnosci="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" '+
                     'statusPracodawcyIP="'+{? _statP<>'ZPCH' & _statP<>'ZAZ' || 'T' || 'N' ?}+'" '+
                     'statusPracodawcyZAZ="'+{? _statP='ZAZ' || 'T' || 'N' ?}+'" '+
                     'statusPracodawcyZPC="'+{? _statP='ZPCH' || 'T' || 'N' ?}+'" '+
                     'szczegolowaFormaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,7)+'" '+
                     'wielkoscPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,9)+'"/>'+
       _nw+_q+'   <adresPracodawcy>'+
       _nw+_q+'      <adres '+
                        'kodAdresuPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,10)+'" '+
                        'kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,20)+'" '+
                        'miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,19)+'" '+
                        'nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,17)+'" '+
                        'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,18)+'" '+
                        'poczta="'+exec('d_read','!ppl_zes_exso',_ref,21)+'" '+
                        'ulica="'+exec('d_read','!ppl_zes_exso',_ref,16)+'"/>'+
       _nw+_q+'      <kontakt '+
                        'email="'+exec('d_read','!ppl_zes_exso',_ref,24)+'" '+
                        'faks="'+exec('d_read','!ppl_zes_exso',_ref,23)+'" '+
                        'telefon="'+exec('d_read','!ppl_zes_exso',_ref,22)+'"/>'+
       _nw+_q+'   </adresPracodawcy>'+
       _nw+_q+'   <infDofinansowanie ogolem="0,00"/>'+
       _nw+_q+'   <rachunekBankowy nrRachunku="'+exec('d_read','!ppl_zes_exso',_ref,15)+'"/>'+
       _nw+_q+'   <adresKorespondencyjny>'+
       _nw+_q+'      <adres '+
                        'adresJak="'+exec('d_read','!ppl_zes_exso',_ref,99)+'" '+
                        'czyPelnomocnik="'+{? exec('d_read','!ppl_zes_exso',_ref,25)='' || 'N' || 'T' ?}+'" '+
                        'kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,30)+'" '+
                        'miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,29)+'" '+
                        'nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,27)+'" '+
                        'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,28)+'" '+
                        'poczta="'+exec('d_read','!ppl_zes_exso',_ref,31)+'" '+
                        'ulica="'+exec('d_read','!ppl_zes_exso',_ref,26)+'"/>'+
       _nw+_q+'      <kontakt '+
                        'email="'+exec('d_read','!ppl_zes_exso',_ref,34)+'" '+
                        'faks="'+exec('d_read','!ppl_zes_exso',_ref,33)+'" '+
                        'telefon="'+exec('d_read','!ppl_zes_exso',_ref,32)+'"/>'+
       _nw+_q+'   </adresKorespondencyjny>'+
       _nw+_q+'</kartaPracodawcy>'+
       _nw+_q+'<osoba nazwaPelnomocnika="'+exec('d_read','!ppl_zes_exso',_ref,25)+'"/>'+
       _nw+_q+'<stanZatrudnienia '+
                  'biezacyOkresNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40),SOD.PR)+'" '+
                  'biezacyOkresOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39),SOD.PR)+'" '+
                  'nowozatrudnieni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36),SOD.PR)+'" '+
                  'poprzedzajacyOkresNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42),SOD.PR)+'" '+
                  'poprzedzajacyOkresOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41),SOD.PR)+'" '+
                  'wOkresieNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38),SOD.PR)+'" '+
                  'wOkresieOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37),SOD.PR)+'"/>'+
       _nw+_q+'<oswiadczenie '+
                  'czyElektronicznie="'+_elekt+'" '+
                  'czyPapierowo="'+{? _elekt='T' || 'N' || 'T' ?}+'" '+
                  'zalaczaInfoONieotrzymanejPomocy="'+{? _demin='T' || 'N' || 'T' ?}+'" '+
                  'zalaczaInfoOOtrzymanejPomocy="'+_demin+'"/>'+
       _nw;

    exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\WND2IIr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Eksport dokumentu typu WND v.2 czesc II.
::   WE: odczyt z wymaganych zmiennych globalnych
::  OLD: \WND2IIr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
{? exec('NAGr','!ppl_zes_exso')
||
   _nw:=exec('eol','!ppl_zes_exso');
   _q:=15*' ';
   _ref:=SOD_N.ref;
   _izk:=SOD_N.SOD_P().KOR;

   _dw:=DEFINE.DATA;
   _dr:=exec('d_read','!ppl_zes_exso',_ref,36);
   _ds:=exec('d_read','!ppl_zes_exso',_ref,43);
   _dd:=exec('d_read','!ppl_zes_exso',_ref,44);

   _tresc:=
       _q+'<daneInformacji dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+
        '" imieNazwiskoOsobyPodpisujacej="'+exec('d_read','!ppl_zes_exso',_ref,51)+'"'+
   _nw+_q+'  okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,28)+
          '" rodzajInformacji="'+_izk+'" uwagi="" />'+
   _nw+_q+'<kartaPracodawcy>'+
   _nw+_q+'  <daneEwidencyjne imie="" nazwisko="" '+
              'nip="'+exec('txt_cut','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,3),'-')+
            '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+'"'+
   _nw+_q+'    pelnaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,5)+
            '" pkd="'+exec('d_read','!ppl_zes_exso',_ref,4)+
            '" regon="'+('0'+(14+(exec('d_read','!ppl_zes_exso',_ref,2)+'00000')))+'"'+
   _nw+_q+'    skroconaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,6)+'" />'+
   _nw+_q+'  <adresPracodawcy>'+
   _nw+_q+'    <adres kodAdresuPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,17)+
              '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,9)+
              '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,8)+'"'+
   _nw+_q+'      nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,12)+
              '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,13)+
              '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,10)+
              '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,11)+
              '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,7)+'" />'+
   _nw+_q+'    <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,16)+
              '" faks="'+exec('d_read','!ppl_zes_exso',_ref,15)+
              '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,14)+'" />'+
   _nw+_q+'  </adresPracodawcy>'+
   _nw+_q+'  <adresKorespondencyjny>'+
   _nw+_q+'    <adres adresJak="'+exec('d_read','!ppl_zes_exso',_ref,18)+
              '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,19)+
              '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,20)+
              '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,22)+
              '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,23)+'"'+
   _nw+_q+'      ulica="'+exec('d_read','!ppl_zes_exso',_ref,21)+'" />'+
   _nw+_q+'    <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,26)+
              '" faks="'+exec('d_read','!ppl_zes_exso',_ref,25)+
              '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,24)+'" />'+
   _nw+_q+'  </adresKorespondencyjny>'+
   _nw+_q+'  <osobaOdp>'+
   _nw+_q+'    <osoba imie="'+exec('d_read','!ppl_zes_exso',_ref,29)+
      '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,30)+'" />'+
   _nw+_q+'    <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,33)+
            '" faks="'+exec('d_read','!ppl_zes_exso',_ref,32)+
            '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,31)+'" />'+
   _nw+_q+'  </osobaOdp>'+
   _nw+_q+'  <organRejestrowy dataRejestracji="'+exec('txt_dt','!ppl_zes_exso',_dr)+
            '" nazwaRejestru="'+exec('d_read','!ppl_zes_exso',_ref,35)+'"'+
   _nw+_q+'    numerWRejestrze="'+exec('d_read','!ppl_zes_exso',_ref,37)+
            '" pelnaNazwa="'+exec('d_read','!ppl_zes_exso',_ref,34)+'" />'+
   _nw+_q+'  <dodInfPracodawcy formaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,38)+
            '" formaPrawnaPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,39)+
            '" formaWlasnosci="'+exec('d_read','!ppl_zes_exso',_ref,40)+'"'+
   _nw+_q+'    typPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,42)+
            '" wielkoscPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,41)+'" />'+
   _nw+_q+'  <statusZakladu dataUzyskStatusu="'+exec('txt_dt','!ppl_zes_exso',_ds)+
            '" dataWydaniaDecyzji="'+exec('txt_dt','!ppl_zes_exso',_dd)+'" podstUzyskStatusu="'+__G[42]+
            '" rodzajDecyzji="'+exec('d_read','!ppl_zes_exso',_ref,46)+'"'+
   _nw+_q+'    znakDecyzji="'+exec('d_read','!ppl_zes_exso',_ref,47)+'" />'+
   _nw+_q+'  <rachunekBankowy nazwaBanku="'+exec('d_read','!ppl_zes_exso',_ref,48)+
            '" nrRachunku="'+exec('d_read','!ppl_zes_exso',_ref,49)+'" />'+
   _nw+_q+'</kartaPracodawcy>'+
   _nw;
   exec('f_save','!ppl_zes_exso',__FF,_tresc)
?};
+_tresc


\WND2IIs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Dokument WND czesc II wersja 2 - zbieranie danych i zapis do bazy.
::   WE: _a - nazwa plikowa dokumentu
::  OLD: \WND2IIs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
{? ~exec('rachunki_banki','rachunki') || SOD_N.del(); return(0) ?};

exec('d_save','!ppl_zes_exso',SOD_N.ref,0,'Wersja dokumentu',2,'B');

exec('d_save','!ppl_zes_exso',SOD_N.ref,1,'Numer w rejestrze PFRON',__G[45]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,2,'REGON',14+(KST.REG+(14*'0')));
exec('d_save','!ppl_zes_exso',SOD_N.ref,3,'NIP',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'));
exec('d_save','!ppl_zes_exso',SOD_N.ref,4,'PKD',KST.PKD);
exec('d_save','!ppl_zes_exso',SOD_N.ref,5,'Pełna nazwa wnioskodawcy',KST.NAZWA);
exec('d_save','!ppl_zes_exso',SOD_N.ref,6,'Skrócona nazwa wnioskodawcy',KST.SKROT);
exec('d_save','!ppl_zes_exso',SOD_N.ref,7,'województwo',__G[51]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,8,'Miejscowość',KST.MIASTO);
exec('d_save','!ppl_zes_exso',SOD_N.ref,9,'Kod pocztowy',KST.KOD);
exec('d_save','!ppl_zes_exso',SOD_N.ref,10,'Poczta',KST.POCZTA);
exec('d_save','!ppl_zes_exso',SOD_N.ref,11,'Ulica',KST.ULICA);
exec('d_save','!ppl_zes_exso',SOD_N.ref,12,'Nr domu',KST.DOM);
exec('d_save','!ppl_zes_exso',SOD_N.ref,13,'Nr lokalu',KST.LOKAL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,14,'Telefon',KST.TEL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,15,'Faks',KST.FAX);
exec('d_save','!ppl_zes_exso',SOD_N.ref,16,'e-mail',KST.EMAIL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,17,'Identyfikator adresu(GUS)',KST.GMGUS);
exec('d_save','!ppl_zes_exso',SOD_N.ref,18,'Adres do korespondencji taki sam?',__G[50]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,19,'KORESPONDENCJA: Kod pocztowy',KST.KKOD);
exec('d_save','!ppl_zes_exso',SOD_N.ref,20,'KORESPONDENCJA: Miejscowość',KST.KMIASTO);
exec('d_save','!ppl_zes_exso',SOD_N.ref,21,'KORESPONDENCJA: Ulica',KST.KULICA);
exec('d_save','!ppl_zes_exso',SOD_N.ref,22,'KORESPONDENCJA: nr domu',KST.KDOM);
exec('d_save','!ppl_zes_exso',SOD_N.ref,23,'KORESPONDENCJA: nr lokalu',KST.KLOKAL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,24,'KORESPONDENCJA: tel.',KST.KTEL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,25,'KORESPONDENCJA: fax',KST.KFAX);
exec('d_save','!ppl_zes_exso',SOD_N.ref,26,'KORESPONDENCJA: e-mail',KST.KEMAIL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,28,'Okres sprawozdawczy',__okSp);
exec('d_save','!ppl_zes_exso',SOD_N.ref,29,'Osoba kontaktowa: Imię',KST.PFIMIE);
exec('d_save','!ppl_zes_exso',SOD_N.ref,30,'Osoba kontaktowa: Nazwisko',KST.PFNAZW);
exec('d_save','!ppl_zes_exso',SOD_N.ref,31,'Osoba kontaktowa: tel.',KST.PFTEL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,32,'Osoba kontaktowa: fax',KST.PFFAX);
exec('d_save','!ppl_zes_exso',SOD_N.ref,33,'Osoba kontaktowa: e-mail',KST.PFEMAIL);
exec('d_save','!ppl_zes_exso',SOD_N.ref,34,'Pełna nazwa organu rejestrowego',KST.REJ);
exec('d_save','!ppl_zes_exso',SOD_N.ref,35,'Nazwa rejestru',KST.OREJ);
exec('d_save','!ppl_zes_exso',SOD_N.ref,36,'Data rejestracji',KST.DREJ);
exec('d_save','!ppl_zes_exso',SOD_N.ref,37,'Numer w rejestrze',KST.NREJ);
exec('d_save','!ppl_zes_exso',SOD_N.ref,38,'Forma prawna działalności',__G[21]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,39,'Forma prawna przedsiębiorcy',__G[22]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,40,'Forma własności',__G[23]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,41,'Wielkość pracodawcy',__G[25]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,42,'Typ pracodawcy',__G[24]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,43,'Data uzyskania/utraty statusu Z.P.CH.',__G[40]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,44,'Data wydania decyzji',__G[41]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,45,'Podstawa uzyskania statusu',__G[42]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,46,'Rodzaj decyzji',__G[43]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,47,'Znak decyzji',__G[44]);
exec('d_save','!ppl_zes_exso',SOD_N.ref,48,'Nazwa banku',SKID_RBK.BANK().NB);
exec('d_save','!ppl_zes_exso',SOD_N.ref,49,'Nr rachunku',SKID_RBK.N);
exec('d_save','!ppl_zes_exso',SOD_N.ref,51,'Osoba występująca w imieniu wnioskodawcy',OPERATOR.USER().DANE);
1


\WNU_IIs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Dokument WNU część II - zbieranie danych i zapis do bazy (strukturalnie identyczny z WND II v.2).
::   WE: _a - nazwa plikowa dokumentu
::  OLD: \WNU_IIs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
exec('WND2IIs','!ppl_zes_exso',_a)


\WNU_IIr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Eksport dokumentu typu WNU czesc II.
::   WE: odczyt z wymaganych zmiennych globalnych
::  OLD: \WNU_IIr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
{? exec('NAGr','!ppl_zes_exso')
||
   _nw:=exec('eol','!ppl_zes_exso');
   _q:=15*' ';
   _ref:=SOD_N.ref;
   _izk:=SOD_N.SOD_P().KOR;

   _dw:=DEFINE.DATA;
   _dr:=exec('d_read','!ppl_zes_exso',_ref,36);
   _ds:=exec('d_read','!ppl_zes_exso',_ref,43);
   _dd:=exec('d_read','!ppl_zes_exso',_ref,44);

   _tresc:=
          _q+'<daneInformacji dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+
               '" imieNazwiskoOsobyPodpisujacej="'+exec('d_read','!ppl_zes_exso',_ref,51)+
               '" kwartal="3"'+
      _nw+_q+'okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,28)+
               '" rodzajInformacji="'+_izk+
               '" uwagi="" />'+
      _nw+_q+'<kartaPracodawcy>'+
      _nw+_q+'<daneEwidencyjne nip="'+exec('txt_cut','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,3),'-')+
               '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+'"'+
      _nw+_q+'pelnaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,5)+
               '" pkd="'+exec('d_read','!ppl_zes_exso',_ref,4)+
               '" regon="'+('0'+(14+(exec('d_read','!ppl_zes_exso',_ref,2)+'00000')))+'"'+
      _nw+_q+'skroconaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,6)+
               '" imie="" nazwisko="" />'+
      _nw+_q+'<adresPracodawcy>'+
      _nw+_q+'<adres kodAdresuPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,17)+
               '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,9)+
               '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,8)+
               '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,12)+'"'+
      _nw+_q+'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,13)+
               '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,10)+
               '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,11)+
               '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,7)+'" />'+
      _nw+_q+'<kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,7)+
               '" faks="'+exec('d_read','!ppl_zes_exso',_ref,15)+
               '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,14)+'" />'+
      _nw+_q+'</adresPracodawcy>'+
      _nw+_q+'<adresKorespondencyjny>'+
      _nw+_q+'<adres adresJak="'+exec('d_read','!ppl_zes_exso',_ref,18)+
               '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,19)+
               '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,20)+
               '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,22)+
               '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,23)+'"'+
      _nw+_q+'ulica="'+exec('d_read','!ppl_zes_exso',_ref,21)+'" />'+
      _nw+_q+'<kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,26)+
               '" faks="'+exec('d_read','!ppl_zes_exso',_ref,25)+
               '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,24)+'" />'+
      _nw+_q+'</adresKorespondencyjny>'+
      _nw+_q+'<osobaOdp>'+
      _nw+_q+'<osoba imie="'+exec('d_read','!ppl_zes_exso',_ref,29)+
               '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,30)+'" />'+
      _nw+_q+'<kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,33)+
               '" faks="'+exec('d_read','!ppl_zes_exso',_ref,32)+
               '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,31)+'" />'+
      _nw+_q+'</osobaOdp>'+
      _nw+_q+'<organRejestrowy pelnaNazwa="'+exec('d_read','!ppl_zes_exso',_ref,34)+
               '" nazwaRejestru="'+exec('d_read','!ppl_zes_exso',_ref,35)+'"'+
      _nw+_q+'dataRejestracji="'+exec('txt_dt','!ppl_zes_exso',_dr)+
               '" numerWRejestrze="'+exec('d_read','!ppl_zes_exso',_ref,37)+'" />'+
      _nw+_q+'<dodInfPracodawcy formaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,38)+
               '" formaPrawnaPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,39)+
               '" formaWlasnosci="'+exec('d_read','!ppl_zes_exso',_ref,40)+'"'+
      _nw+_q+'wielkoscPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,41)+
               '" typPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,42)+'" />'+
      _nw+_q+'<statusZakladu podstUzyskStatusu="'+__G[42]+
               '" rodzajDecyzji="'+exec('d_read','!ppl_zes_exso',_ref,46)+
               '" dataWydaniaDecyzji="'+exec('txt_dt','!ppl_zes_exso',_dd)+'"'+
      _nw+_q+'znakDecyzji="'+exec('d_read','!ppl_zes_exso',_ref,47)+
               '" dataUzyskStatusu="'+exec('txt_dt','!ppl_zes_exso',_ds)+'" />'+
      _nw+_q+'<rachunekBankowy nazwaBanku="'+exec('d_read','!ppl_zes_exso',_ref,48)+
               '" nrRachunku="'+exec('d_read','!ppl_zes_exso',_ref,49)+'" />'+
      _nw+_q+'</kartaPracodawcy>'+
      _nw;
   exec('f_save','!ppl_zes_exso',__FF,_tresc)
?};
+_tresc


\INFDPs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Dokument INF-D-P (wersje 4, 5, 6, 7 ,8 i 9) - odczyt danych i zapis do bazy - rozpoznanie wersji
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::       _b - ignoruj bledy - 1 tak, 0 nie
::  OLD: \INFDPs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__wersja:={? date(#(__okSp+4),#(2+__okSp),1)<date(2009,01,01) || 4
          |? date(#(__okSp+4),#(2+__okSp),1)<date(2011,01,01) || 5
          |? date(#(__okSp+4),#(2+__okSp),1)<date(2014,04,01)
          || 6
          |? date(#(__okSp+4),#(2+__okSp),1)<date(2015,01,01)
          || 7
          |? date(#(__okSp+4),#(2+__okSp),1)<date(2020,04,01)
          || 8
          || 9
          ?};
__Ch[63]:=0;
{? ( ( P.DZA<=date(#(__okSp+4),#(2+__okSp),0) & (P.DZ=date(0,0,0) | P.DZ>=date(#(__okSp+4),#(2+__okSp),1)) )
   & {? __wersja<=5
     || exec('i_Niep','!ppl_zes_exso',__okSp)
     || exec('i_Niep_od201103','!ppl_zes_exso',__okSp)
     ?}
   & (exec('i_Wyn','!ppl_zes_exso',date(#(__okSp+4),#(2+__okSp),1)) | __wersja>=1)
   )
   |
   (_=2 & _b=1)
||
   {? _=2 & _b=1
   || exec('zero_ch','!ppl_zes_exso');
      {? __wersja<=5
      || exec('i_Niep','!ppl_zes_exso',__okSp)
      || exec('i_Niep_od201103','!ppl_zes_exso',__okSp)
      ?};
      exec('i_Wyn','!ppl_zes_exso',date(#(__okSp+4),#(2+__okSp),1))
   ?};
   exec('zatrudnienie','!ppl_zes_exso',P.OSOBA);
   {? __wersja=4
   || exec('INFDPs4','!ppl_zes_exso',_a)
   || 'wersje 5 i 6 i 7 i 8 i 9';
      exec('INFDPs'+$__wersja,'!ppl_zes_exso',exec('typdok','!ppl_zes_exso','INF-D-P',__wersja))
   ?};
   exec('przenumerowanie','!ppl_zes_exso')
?};
exec('zero_ch','!ppl_zes_exso')


\INFDPs4
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Generowanie i zapis do bazy dokumentu INF-D-P w wersji 4
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::  OLD: \INFDPs4/sodir.fml
::----------------------------------------------------------------------------------------------------------------------

{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
_xINFDP:=exec('count','!ppl_zes_exso','INF-D-P');
_ref:=SOD_N.ref;

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',4,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer pracodawcy w rejestrze PFRON',__G[45]);

exec('d_save','!ppl_zes_exso',_ref,2,'PESEL',OSOBA.PESEL);
exec('d_save','!ppl_zes_exso',_ref,3,'Dowód osobisty',OSOBA.DOWOD);
exec('d_save','!ppl_zes_exso',_ref,4,'NIP',exec('txt_cut','!ppl_zes_exso',OSOBA.NIP,'-'));
exec('d_save','!ppl_zes_exso',_ref,5,'Nazwisko',OSOBA.NAZWISKO);
exec('d_save','!ppl_zes_exso',_ref,6,'Pierwsze imię',OSOBA.PIERWSZE);
exec('d_save','!ppl_zes_exso',_ref,7,'Drugie imię',OSOBA.DRUGIE);

{? exec('szukaj','osoba','S',date(SOD_P.R,SOD_P.MP,0))<>null
||
   exec('d_save','!ppl_zes_exso',_ref,8,'Województwo',exec('kod_woje','!ppl_zes_exso',OS_ADRES.WOJEWODZ));
   exec('d_save','!ppl_zes_exso',_ref,9,'Powiat',OS_ADRES.POWIAT);
   exec('d_save','!ppl_zes_exso',_ref,10,'Gmina',OS_ADRES.GMINA);
   exec('d_save','!ppl_zes_exso',_ref,11,'Miejscowość',OS_ADRES.MIASTO);
   exec('d_save','!ppl_zes_exso',_ref,12,'Kod pocztowy',OS_ADRES.KOD);
   exec('d_save','!ppl_zes_exso',_ref,13,'Poczta',OS_ADRES.POCZTA);
   exec('d_save','!ppl_zes_exso',_ref,14,'Ulica',OS_ADRES.ULICA);
   exec('d_save','!ppl_zes_exso',_ref,15,'Nr domu',OS_ADRES.DOM);
   exec('d_save','!ppl_zes_exso',_ref,16,'Nr lokalu',OS_ADRES.LOKAL);
   exec('d_save','!ppl_zes_exso',_ref,17,'Miejsce zamieszkania',
      {? (+OS_ADRES.ULICA | OS_ADRES.MIASTO<>OS_ADRES.ULICA)
       &  OS_ADRES.POCZTA=OS_ADRES.MIASTO
      || 'M'
      || 'W'
      ?})
 ?};

 exec('d_save','!ppl_zes_exso',_ref,18,'Wykonywany zawód lub specjalność',P.ZAW().KOD);
 exec('d_save','!ppl_zes_exso',_ref,19,'Poziom wykształcenia',OSOBA.WYK().KODPFRON);
 exec('d_save','!ppl_zes_exso',_ref,20,'Płeć',OSOBA.PLEC);
 exec('d_save','!ppl_zes_exso',_ref,23,'Nr kolejny informacji',_xINFDP,'B');

 exec('d_save','!ppl_zes_exso',_ref,24,'niep.znaczna,S,ZPCH',__Ch[12],,3);
 exec('d_save','!ppl_zes_exso',_ref,25,'niep.umiarkowana,S,ZPCH',__Ch[11],,3);
 exec('d_save','!ppl_zes_exso',_ref,26,'niep.lekka,S,ZPCH',__Ch[10],,3);
 exec('d_save','!ppl_zes_exso',_ref,27,'niep.znaczna,S',__Ch[3],,3);
 exec('d_save','!ppl_zes_exso',_ref,28,'niep.umiarkowana,S',__Ch[2],,3);
 exec('d_save','!ppl_zes_exso',_ref,29,'niep.lekka,S',__Ch[1],,3);
 exec('d_save','!ppl_zes_exso',_ref,30,'niep.znaczna,ZPCH',__Ch[6],,3);
 exec('d_save','!ppl_zes_exso',_ref,31,'niep.umiarkowana,ZPCH',__Ch[5],,3);
 exec('d_save','!ppl_zes_exso',_ref,32,'niep.lekka,ZPCH',__Ch[4],,3);
 exec('d_save','!ppl_zes_exso',_ref,33,'niep.znaczna',__Ch[9],,3);
 exec('d_save','!ppl_zes_exso',_ref,34,'niep.umiarkowana',__Ch[8],,3);
 exec('d_save','!ppl_zes_exso',_ref,35,'niep.lekka',__Ch[7],,3);

 exec('d_save','!ppl_zes_exso',_ref,36,'Zatrudnienie od dnia',__Ch[50]);
 exec('d_save','!ppl_zes_exso',_ref,37,'Podwyższone koszty zatrudnienia',__G[26]);
 _poz38:=0;
{? __G[26]<>'N'
|| _poz38:=__S[7]+
   {? #(2+__okSp)>1
   || exec('f_sum','!ppl_zes_exso',_ref,38,date(#(__okSp+4),#(2+__okSp)-1,1),date(#(__okSp+4),#(2+__okSp)-1,1))
   ?}
?};

exec('d_save','!ppl_zes_exso',_ref,38,'Najniższy pułap intensywności pomocy',_poz38,2);

_poz39:=0;
{? __G[26]<>'N'
|| _poz39:=exec('f_sum','!ppl_zes_exso',_ref,56,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1),'INF-U-P');
   {? #(2+__okSp)>1
   || _poz39+=exec('f_sum','!ppl_zes_exso',_ref,48,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1))
   ?}
?};
      exec('d_save','!ppl_zes_exso',_ref,39,'Dofinansowanie i refundacja',_poz39,2);

_poz40:=0;
{? __G[26]<>'N'
|| {? #(2+__okSp)>1
   || _poz40:=exec('f_sum','!ppl_zes_exso',_ref,56,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1),'INF-U-P');
      _poz40+=exec('f_sum','!ppl_zes_exso',_ref,50,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1))
   ?}
?};
exec('d_save','!ppl_zes_exso',_ref,40,'Wypłacona kwota z poz. 39',_poz40,2);

_poz41:=exec('f_sum','!ppl_zes_exso',_ref,57,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),1),'INF-U-P');
exec('d_save','!ppl_zes_exso',_ref,41,'Refundacja za okres sprawdozdawczy',_poz41);

exec('d_save','!ppl_zes_exso',_ref,42,'Wynagrodzenie osiągane',__Ch[15]$2,,2 );

_nk:=exec('ust_nk','lista_licz',date(#(__okSp+4)-1,12,31),'NK');

_poz43:=_nk*(1.3*(__Ch[12]+__Ch[9]*0.9+__Ch[6]+__Ch[3]*0.7)+
  1.1*(__Ch[11]+__Ch[8]*0.9+__Ch[5]+__Ch[2]*0.7)+0.5*(__Ch[10]+__Ch[7]*0.9+__Ch[4]+__Ch[1]*0.7)+
  0.75*(__Ch[12]+__Ch[11]+__Ch[10]));

exec('d_save','!ppl_zes_exso',_ref,43,'Kwota ustalona',_poz43,,2);

exec('d_save','!ppl_zes_exso',_ref,44,'Wynagrodzenie wypłacone',__Ch[16]$2,,2 );

exec('d_save','!ppl_zes_exso',_ref,45,'Pomniejszenia',__S[3],,2);

_poz46:=
   {? __Ch[15]<=(_poz43+__S[3])
   || __Ch[15]-__S[3]
   || _poz43
   ?};
exec('d_save','!ppl_zes_exso',_ref,46,'Kwota po pomniejszeniach',_poz46,,2);

exec('d_save','!ppl_zes_exso',_ref,47,'Wynagrodzenie minimalne',_nk,,2 );

_poz48:=
  {? _poz46<=__Ch[15]
  || _poz46
  || _Mian:=(__Ch[12]+__Ch[11]+__Ch[10]+__Ch[9]+__Ch[8]+__Ch[7]+__Ch[6]+__Ch[5]+__Ch[4]+__Ch[3]+__Ch[2]+__Ch[1]);
     {? _Mian <>0
     || (__Ch[16]*(__Ch[9]+__Ch[8]+__Ch[7]+__Ch[3]+__Ch[2]+__Ch[1])+
         _poz46*(__Ch[12]+__Ch[11]+__Ch[10]+__Ch[6]+__Ch[5]+__Ch[4]))
         /_Mian
     || 0
     ?}
  ?};
exec('d_save','!ppl_zes_exso',_ref,48,'Dofinansowanie po pomniejszeniach',_poz48,,2);

_Mian:=(__Ch[12]+__Ch[11]+__Ch[10]+__Ch[9]+__Ch[8]+__Ch[7]+__Ch[6]+__Ch[5]+__Ch[4]+__Ch[3]+__Ch[2]+__Ch[1]);
_poz49:={? _Mian<>0
        || (_poz43-__Ch[15])*(__Ch[12]+__Ch[11]+__Ch[10]+__Ch[6]+__Ch[5]+__Ch[4])/_Mian
        || 0
        ?};
{? _poz49<0 || _poz49:=0 ?};
exec('d_save','!ppl_zes_exso',_ref,49,'Kwota do przekazania na ZFRON',_poz49,,2);

_poz50:=0;
{? __G[26]<>'N'
|| {? (_poz39+_poz48)>_poz38
   || _poz50:=(_poz38-_poz40-_poz41+_poz49)
   || _poz50:=(_poz49+_poz48+_poz39-_poz40-_poz41)
   ?}
|| _poz50:=(_poz48+_poz49)
?};
{? _poz50<0 || _poz50:=0 ?};
{? _poz50>(_poz48+_poz49)
|| _poz50:=(_poz48+_poz49)
|| {? _poz50<_poz49 || exec('d_act','!ppl_zes_exso',_ref,49,,_poz50)  ?}
?};

    exec('d_save','!ppl_zes_exso',_ref,50,'DO WYPŁATY',_poz50,,2,17);

:: uzupelnienie danych w deklaracji INF-U-P
_poz47:=0;
{? __G[26]<>'N'
|| _poz47:=_poz48;
   {? #(2+__okSp)>1
   || _poz47+=exec('f_sum','!ppl_zes_exso',_ref,48,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1));
      _poz47+=exec('f_sum','!ppl_zes_exso',_ref,56,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1),'INF-U-P')
   ?}
?};
 exec('d_act','!ppl_zes_exso',_ref,47,,_poz47,,,,'INF-U-P');

_poz48:=0;
{? __G[26]<>'N'
|| {? #(2+__okSp)>1
   || _poz48+=exec('f_sum','!ppl_zes_exso',_ref,41,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1)-1);
      _poz48+=exec('f_sum','!ppl_zes_exso',_ref,49,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1)-1,'INF-U-P')
   ?}
?};
exec('d_act','!ppl_zes_exso',_ref,48,,_poz48,,,,'INF-U-P');

_poz49:=_poz50;
exec('d_act','!ppl_zes_exso',_ref,49,,_poz49,,,,'INF-U-P');

: aktualizacja po uzupelnieniu
_poz46:=exec('f_sum','!ppl_zes_exso',_ref,46,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),1),'INF-U-P');
_poz56:=exec('f_sum','!ppl_zes_exso',_ref,56,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),1),'INF-U-P');

_poz57:=0;
{? __G[26]<>'N'
|| {? (_poz47+_poz56)>_poz46
   || {? (_poz46-_poz48)>_poz56 || _poz57:=_poz56 || _poz57:=(_poz46-_poz48) ?}
   || {? (_poz56+_poz47-_poz48)>_poz56 || _poz57:=_poz56 || _poz57:=(_poz56+_poz47-_poz48) ?}
   ?}
|| _poz57:=_poz56
?};
{? _poz57<0 || _poz57:=0 ?};
exec('d_act','!ppl_zes_exso',_ref,57,,_poz57,,,,'INF-U-P');

:: koniec uzupelniania
1


\INFDPs5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Generowanie i zapis do bazy dokumentu INF-D-P w wersji 5
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::  OLD: \INFDPs5/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
_xINFDP:=exec('count','!ppl_zes_exso','INF-D-P');
_ref:=SOD_N.ref;

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',5,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer w rejestrze PFRON',__G[45]);
exec('d_save','!ppl_zes_exso',_ref,2,'PESEL',OSOBA.PESEL);
exec('d_save','!ppl_zes_exso',_ref,3,'Dowód osobisty',{? +OSOBA.PESEL || '' || OSOBA.DOWOD ?});
exec('d_save','!ppl_zes_exso',_ref,4,'NIP',exec('txt_cut','!ppl_zes_exso',OSOBA.NIP,'-'));
exec('d_save','!ppl_zes_exso',_ref,5,'Nazwisko',OSOBA.NAZWISKO);
exec('d_save','!ppl_zes_exso',_ref,6,'Pierwsze imię',OSOBA.PIERWSZE);
exec('d_save','!ppl_zes_exso',_ref,7,'Drugie imię',OSOBA.DRUGIE);

{? exec('szukaj','osoba','S',date(SOD_P.R,SOD_P.MP,0))<>null
||
   exec('d_save','!ppl_zes_exso',_ref,8,'Województwo',exec('kod_woje','!ppl_zes_exso',OS_ADRES.WOJEWODZ));
   exec('d_save','!ppl_zes_exso',_ref,9,'Powiat',OS_ADRES.POWIAT);
   exec('d_save','!ppl_zes_exso',_ref,10,'Gmina',OS_ADRES.GMINA);
   exec('d_save','!ppl_zes_exso',_ref,11,'Miejscowość',OS_ADRES.MIASTO);
   exec('d_save','!ppl_zes_exso',_ref,12,'Kod pocztowy',OS_ADRES.KOD);
   exec('d_save','!ppl_zes_exso',_ref,13,'Poczta',OS_ADRES.POCZTA);
   exec('d_save','!ppl_zes_exso',_ref,14,'Ulica',OS_ADRES.ULICA);
   exec('d_save','!ppl_zes_exso',_ref,15,'Nr domu',OS_ADRES.DOM);
   exec('d_save','!ppl_zes_exso',_ref,16,'Nr lokalu',OS_ADRES.LOKAL)
?};

exec('d_save','!ppl_zes_exso',_ref,17,'Okres sprawozdawczy',__okSp,'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Okres wypłaty wynagrodzenia',__okWp,'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Informacja (zwykła/korygująca)',SOD_N.SOD_P().KOR,'B');

exec('d_save','!ppl_zes_exso',_ref,20,'Nr kolejny informacji',_xINFDP,'B');

_poz21:=__Ch[6];
exec('d_save','!ppl_zes_exso',_ref,21,'niep.znaczna,s.szczeg.,ZPCH',_poz21,,3);
_poz22:=__Ch[5];
exec('d_save','!ppl_zes_exso',_ref,22,'niep.umiarkowana,s.szczeg.,ZPCH',_poz22,,3);
_poz23:=__Ch[4];
exec('d_save','!ppl_zes_exso',_ref,23,'niep.lekka,s.szczeg.,ZPCH',__Ch[4],,3);
_poz24:=__Ch[12];
exec('d_save','!ppl_zes_exso',_ref,24,'niep.znaczna,ZPCH',__Ch[12],,3);
_poz25:=__Ch[11];
exec('d_save','!ppl_zes_exso',_ref,25,'niep.umiarkowana,ZPCH',__Ch[11],,3);
_poz26:=__Ch[10];
exec('d_save','!ppl_zes_exso',_ref,26,'niep.lekka,ZPCH',__Ch[10],,3);
_poz27:=__Ch[9];
exec('d_save','!ppl_zes_exso',_ref,27,'niep.znaczna,s.szczeg.',_poz27,,3);
_poz28:=__Ch[8];
exec('d_save','!ppl_zes_exso',_ref,28,'niep.umiarkowana,s.szczeg.',__Ch[8],,3);
_poz29:=__Ch[7];
exec('d_save','!ppl_zes_exso',_ref,29,'niep.lekka,s.szczeg.',__Ch[7],,3);
_poz30:=__Ch[3];
exec('d_save','!ppl_zes_exso',_ref,30,'niep.znaczna',__Ch[3],,3);
_poz31:=__Ch[2];
exec('d_save','!ppl_zes_exso',_ref,31,'niep.umiarkowana',__Ch[2],,3);
_poz32:=__Ch[1];
exec('d_save','!ppl_zes_exso',_ref,32,'niep.lekka',__Ch[1],,3);

exec('d_save','!ppl_zes_exso',_ref,33,'Zatrudnienie od dnia',__Ch[50]);

_poz35:='N';
exec('d_save','!ppl_zes_exso',_ref,35,'Wzrost zatrudnienia netto',_poz35);

_poz36:='N';
exec('d_save','!ppl_zes_exso',_ref,36,'Zatrudnienie w wyniku rozw.umowy z poprz.prac.',_poz36);

_poz37:=0;
exec('d_save','!ppl_zes_exso',_ref,37,'Kwota pomocy publicznej',_poz37,,2);

_poz34:={? _poz37>0 || 'T' || 'N' ?};
exec('d_save','!ppl_zes_exso',_ref,34,'Pomoc publiczna',_poz34);

_poz38:=exec('ust_nk','lista_licz',{? #(__okSp+4)>2009 || date((#(__okSp+4))-1,12,31) || date(#(__okSp+4),1,0) ?},'NK');
exec('d_save','!ppl_zes_exso',_ref,38,'Wynagrodzenie minimalne',_poz38,,2 );

_poz39:={? #(__okSp+4)>2010
        || _poz38*( 2.0*(_poz21+_poz27)
                   +1.8*(_poz22+_poz28)
                   +1.0*(_poz23+_poz29)
                   +1.6*(_poz24+_poz30)
                   +1.4*(_poz25+_poz31)
                   +0.6*(_poz26+_poz32))
        || _poz38*( 1.0*( 2.0*_poz21 + 1.8*_poz22 + 1.0*_poz23 + 1.6*_poz24 + 1.4*_poz25 + 0.6*_poz26 )+
                    0.9*( 2.0*_poz27 + 1.8*_poz28 + 1.0*_poz29 )+
                    0.7*( 1.6*_poz30 + 1.4*_poz31 + 0.6*_poz32 ))
        ?};
exec('d_save','!ppl_zes_exso',_ref,39,'Kwota ustalona',_poz39,,2);

_poz40:=__Ch[63];
exec('d_save','!ppl_zes_exso',_ref,40,'Koszty płacy',_poz40,,2);

_poz41:=0;
exec('d_save','!ppl_zes_exso',_ref,41,'Pomniejszenia (dofinansowania z innych źródeł)',_poz41,,2);

_poz42:={? _poz34='T'
        || 0.75 * _poz40
        || 0.90 * _poz40
        ?};
exec('d_save','!ppl_zes_exso',_ref,42,'Limit kosztów płacy',_poz42,,2);

_poz43:={? _poz34='T' & _poz35='N' & _poz36='T'
        || 0
        |? _poz39<(_poz40-_poz41) & _poz39<_poz42
        || _poz39
        |? _poz42<(_poz40-_poz41) & _poz42<_poz39
        || _poz42
        || (_poz40-_poz41)
        ?};
_poz43:={? _poz43<0 || 0 || _poz43 ?};
exec('d_save','!ppl_zes_exso',_ref,43,'DO WYPŁATY',_poz43,,2,12);
1


\INFDPs6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [11.22]
:: OPIS: Generowanie i zapis do bazy dokumentu INF-D-P w wersji 6
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::  OLD: \INFDPs6/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
{? __G[56]=''
|| __G[56]:={? FUN.ask('Czy pracodawca wykonuje działalność gospodarczą?'@) || 'T' || 'N' ?}
?};
{? __G[57]=''
||
   {!
   |? _fch:=FUN.choice(
         'Wybierz sposób ustalania efektu zachęty:\n'
         '(bez względu na wybór, w pierwszej kolejności poszukiwana jest informacja w poprzednich zestawach)\n'
         'automatycznie - metoda ilościowa, sposób drugi zgodnie z wyrokiem TSWE,\n'
         'domyślnie TAK - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie T,\n'
         'domyślnie NIE - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie N.'@,,
         'aUtomatycznie'@,'domyślnie TAK'@,'domyślnie NIE'@,,'');
      {? _fch=1 || __G[57]:='A'
      |? _fch=2 || __G[57]:='T'
      |? _fch=3 || __G[57]:='N'
      ?};
      __G[57]=''
   !}
?};
P.OSOBA();
_firstZ:={? -menu_txt='wybierz'
         || FUN.ask('Czy pracownik %1 %2 zgłaszany po raz pierwszy?'@[OSOBA.NAZWISKO,OSOBA.PIERWSZE])
         ?};
_xINFDP:=exec('count','!ppl_zes_exso','INF-D-P');
_ref:=SOD_N.ref;
_EfZach:=__G[57];
{? __Ch[50]<=date(#(__okSp+4),(#(2+__okSp))-12,0)
|| SOD_P.cntx_psh();
   SOD_N.cntx_psh();
   SOD_N.index(__nSOD_N);
   SOD_N.prefix(OSOBA.PESEL,OSOBA.NAZWISKO,OSOBA.PIERWSZE,'T');
   SOD.cntx_psh();
   _EfZach:='';
   {? SOD_N.first
   || {!
      |? {? SOD_N.SOD_P().R<2011
         || 0
         || {? $SOD_N.SOD_P().R<>(SOD.name+4) || SOD.use('sod'+$SOD_N.SOD_P().R) ?};
            SOD.index('SODN');
            SOD.prefix(SOD_N.ref);
            _wtmp:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0);
            {? var_pres('_wtmp')=type_of(0) & _wtmp=6
            || _EfZach:=exec('d_read','!ppl_zes_exso',SOD_N.ref,48)
            ?};
            _EfZach='' & SOD_N.next
         ?}
      !}
   ?};
   SOD.cntx_pop();
   SOD_N.cntx_pop();
   SOD_P.cntx_pop();

   {? _EfZach=''
   || {? __G[57]='A'
      || OSOBA.cntx_psh();
         _niepZ:=exec('srzatr_niep_new','!ppl_zes_exso',date(__Ch[50]~1,(__Ch[50]~2)-11,1),__Ch[50],1);
         _axd:=date(__Ch[50]~1,(__Ch[50]~2)-1,1);
         _niepP:=exec('srzatr_niep_new','!ppl_zes_exso',date(_axd~1,(_axd~2)-11,1),_axd,1);
         _EfZach:={? _niepZ>_niepP || 'T' || 'N' ?};
         OSOBA.cntx_pop()
      || _EfZach:=__G[57]
      ?}
   ?}
?};
{? _EfZach<>'T' & _EfZach<>'N' || _EfZach:='N' ?};

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',6,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer w rejestrze PFRON',__G[45],'B');
exec('d_save','!ppl_zes_exso',_ref,2,'PESEL',OSOBA.PESEL,,11);
exec('d_save','!ppl_zes_exso',_ref,3,'Dowód osobisty',{? +OSOBA.PESEL || '' || OSOBA.DOWOD ?},,9);
exec('d_save','!ppl_zes_exso',_ref,4,'NIP',{? +OSOBA.PESEL || '' || exec('txt_cut','!ppl_zes_exso',OSOBA.NIP,'-') ?},,10);
exec('d_save','!ppl_zes_exso',_ref,5,'Nazwisko',OSOBA.NAZWISKO,,60);
exec('d_save','!ppl_zes_exso',_ref,6,'Pierwsze imię',OSOBA.PIERWSZE,,60);
{? _firstZ || exec('d_save','!ppl_zes_exso',_ref,7,'Drugie imię',OSOBA.DRUGIE,,60) ?};

_ad_mp:=exec('szukaj','osoba','S',date(#(__okSp+4),(#(2+__okSp))-1,0));
_ad_ms:=exec('szukaj','osoba','S',date(#(__okSp+4),#(2+__okSp),0));
{? _ad_ms<>null & (_firstZ | _ad_mp<>_ad_ms)
||
   exec('d_save','!ppl_zes_exso',_ref,8,'Województwo',exec('kod_woje','!ppl_zes_exso',OS_ADRES.WOJEWODZ),,2);
   exec('d_save','!ppl_zes_exso',_ref,9,'Powiat',OS_ADRES.POWIAT,,30);
   exec('d_save','!ppl_zes_exso',_ref,10,'Gmina',OS_ADRES.GMINA,,30);
   exec('d_save','!ppl_zes_exso',_ref,11,'Miejscowość',OS_ADRES.MIASTO,,30);
   exec('d_save','!ppl_zes_exso',_ref,12,'Kod pocztowy',OS_ADRES.KOD,,6);
   exec('d_save','!ppl_zes_exso',_ref,13,'Poczta',OS_ADRES.POCZTA,,30);
   exec('d_save','!ppl_zes_exso',_ref,14,'Ulica',OS_ADRES.ULICA,,60);
   exec('d_save','!ppl_zes_exso',_ref,15,'Nr domu',OS_ADRES.DOM,,5);
   exec('d_save','!ppl_zes_exso',_ref,16,'Nr lokalu',OS_ADRES.LOKAL,,4)
?};

exec('d_save','!ppl_zes_exso',_ref,17,'Okres sprawozdawczy',__okSp,'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Okres wypłaty wynagrodzenia',__okWp,'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Informacja (zwykła/korygująca)',SOD_N.SOD_P().KOR,'B');

exec('d_save','!ppl_zes_exso',_ref,20,'Nr kolejny informacji',_xINFDP,'B');

exec('d_save','!ppl_zes_exso',_ref,21,'niep.znaczna,s.szczeg.,ZPCH',__Ch[6]+__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,22,'niep.umiarkowana,s.szczeg.,ZPCH',__Ch[5]+__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,23,'niep.lekka,s.szczeg.,ZPCH',__Ch[4]+__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,24,'niep.znaczna,ZPCH',__Ch[12]+__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,25,'niep.umiarkowana,ZPCH',__Ch[11]+__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,26,'niep.lekka,ZPCH',__Ch[10]+__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,27,'niep.znaczna,s.szczeg.,emeryt,ZPCH',__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,28,'niep.umiarkowana,s.szczeg.,emeryt,ZPCH',__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,29,'niep.lekka,s.szczeg.,emeryt,ZPCH',__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,30,'niep.znaczna,emeryt,ZPCH',__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,31,'niep.umiarkowana,emeryt,ZPCH',__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,32,'niep.lekka,emeryt,ZPCH',__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,33,'niep.znaczna,s.szczeg.',__Ch[9]+__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,34,'niep.umiarkowana,s.szczeg.',__Ch[8]+__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,35,'niep.lekka,s.szczeg.',__Ch[7]+__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,36,'niep.znaczna',__Ch[3]+__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'niep.umiarkowana',__Ch[2]+__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,38,'niep.lekka',__Ch[1]+__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,39,'niep.znaczna,s.szczeg.,emeryt',__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,40,'niep.umiarkowana,s.szczeg.,emeryt',__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,41,'niep.lekka,s.szczeg.,emeryt',__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,42,'niep.znaczna,emeryt',__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,43,'niep.umiarkowana,emeryt',__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,44,'niep.lekka,emeryt',__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,45,'Zatrudnienie od dnia',__Ch[50]);

:: Domyslnie T
exec('d_save','!ppl_zes_exso',_ref,46,'Dof. stanowi pomoc publiczną','T',,1);

exec('d_save','!ppl_zes_exso',_ref,47,'Pracodawca wyk. działaność gosp.',__G[56],,1);

exec('d_save','!ppl_zes_exso',_ref,48,'Zatr. w warunkach efektu zachęty',_EfZach,,1);

:: Brak informacji w systemie - eksportujemy stala wartosc 0
_poz49:=0;
exec('d_save','!ppl_zes_exso',_ref,49,'Kwota pomocy publ. i de minimis',_poz49,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,50,'Wynagrodzenie minimalne',0,,2 );

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,51,'Kwota ustalona',0,,2);

exec('d_save','!ppl_zes_exso',_ref,52,'Koszty płacy',__Ch[63],,2);
:: Brak informacji w programie - eksportujemy stala wartosc 0
_poz53:=0;
exec('d_save','!ppl_zes_exso',_ref,53,'Pomniejszenia (dofinansowania z innych źródeł)',_poz53,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,54,'Limit kosztów płacy',0,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,55,'DO WYPŁATY',0,,2,12);
1


\INFDPr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Eksport dokumentu INF-D-P
::   WE: odczyt wymaganych zmiennych globalnych
::    _a - nazwa plikowa dokumentu
::  OLD: \INFDPr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=0;
{? exec('NAGr','!ppl_zes_exso')
|| _wer:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0,0);
   {? (',4,5,6,7,8,9,')*(','+$_wer+',')
   || _wyn:=exec('INFDPr'+$_wer,'!ppl_zes_exso')
   ?}
?};
_wyn


\INFDPr4
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Eksport dokumentu INF-D-P (wersja 4).
::   WE: odczyt wymaganych zmiennych globalnych
::  OLD: \INFDPr4/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
exec('zero_ch','!ppl_zes_exso');
_q:=15*' ';
_nw:=exec('eol','!ppl_zes_exso');
_ref:=SOD_N.ref;
_izk:=SOD_N.SOD_P().KOR;

   _tresc:=
       _q+'<daneInformacji nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,23)+
                        '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,12)+
                        '" okresSprawozdawczy="'+(((('00'+$SOD_N.SOD_P().MP))+2)+'-'+($SOD_N.SOD_P().R))+'"'+
   _nw+_q+'  rodzajInformacji="'+_izk+'" sposobRozlPomocy="'+exec('d_read','!ppl_zes_exso',_ref,37)+'" />'+
   _nw+_q+'  <metrykaPracownika>'+
   _nw+_q+'  <daneEwidencyjne imie1="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                           '" imie2="'+exec('d_read','!ppl_zes_exso',_ref,7)+
                           '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,5)+
                           '" nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+'"'+
   _nw+_q+'    nrDowodu="'+exec('d_read','!ppl_zes_exso',_ref,3)+
            '" pesel="'+exec('d_read','!ppl_zes_exso',_ref,2)+
            '" plec="'+exec('d_read','!ppl_zes_exso',_ref,20)+
            '" wyksztalcenie="'+exec('d_read','!ppl_zes_exso',_ref,19)+'"'+
   _nw+_q+'    zawod="'+exec('d_read','!ppl_zes_exso',_ref,18)+'" />'+
   _nw+_q+'  <adresPracownika>'+
   _nw+_q+'    <adres gmina="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                   '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,12)+
                   '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                   '" msceZamieszk="'+exec('d_read','!ppl_zes_exso',_ref,17)+'"'+
   _nw+_q+'    nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,15)+
            '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,16)+
            '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,13)+
            '" powiat="'+exec('d_read','!ppl_zes_exso',_ref,9)+
            '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,14)+'"'+
   _nw+_q+'    wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" />'+
   _nw+_q+'  </adresPracownika>'+
   _nw+_q+'  <infNiepelnospr chronLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,32,0),SOD.PR)+
                          '" chronSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,26,0),SOD.PR)+
                          '" chronSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,25,0),SOD.PR)+'"'+
                 _nw+_q+'    chronSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,24,0),SOD.PR)+
                          '" chronUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,31,0),SOD.PR)+
                          '" chronZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,30,0),SOD.PR)+
                          '" normLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,35,0),SOD.PR)+'"'+
                 _nw+_q+'    normSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,29,0),SOD.PR)+
                          '" normSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,28,0),SOD.PR)+
                          '" normSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,27,0),SOD.PR)+'"'+
                 _nw+_q+'    normUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,34,0),SOD.PR)+
                          '" normZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,33,0),SOD.PR)+'" />'+
        _nw+_q+'  <zatrudnienie okresZatrOdDnia="'+exec('txt_dt','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36))+
                             '" wynOsiagane="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42,0),SOD.PR)+
                             '" wynWyplacone="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,44,0),SOD.PR)+'"'+
                    _nw+_q+'    wynMinimalne="'+'0,00'+
                             '" pomniejszenia="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,45,0),SOD.PR)+
                             '" kwDofNalezna="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,48,0),SOD.PR)+
                             '" kwDofZFRON="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,49,0),SOD.PR)+'"'+
                    _nw+_q+'    kwPoPomniejszeniach="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,46,0),SOD.PR)+
                             '" kwUstalona="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,43,0),SOD.PR)+
                             '" kwDofWyplata="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,50,0),SOD.PR)+
                             '" kosztyPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39,0),SOD.PR)+'"'+
                    _nw+_q+'    podwKoszty="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38,0),SOD.PR)+
                             '" skladki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40,0),SOD.PR)+
                             '" uzyskaneDof="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41,0),SOD.PR)+'" />'+
   _nw+_q+'  </metrykaPracownika>'+
   _nw;
exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\INFDPr5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Eksport dokumentu INF-D-P (wersja 5).
::   WE: odczyt wymaganych zmiennych globalnych
::  OLD: \INFDPr5/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
exec('zero_ch','!ppl_zes_exso');
_q:=15*' ';
_nw:=exec('eol','!ppl_zes_exso');
_ref:=SOD_N.ref;
_izk:={? SOD_N.SOD_P().KOR='K' || 'K' || 'Z' ?};

   _tresc:=
       _q+'<daneInformacji nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,20)+
                        '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
                        '" okresSprawozdawczy="'+(((('00'+$SOD_N.SOD_P().MP))+2)+'-'+($SOD_N.SOD_P().R))+'"'+
   _nw+_q+' okresSprawozdawczyWynagrodzenie="'+exec('d_read','!ppl_zes_exso',_ref,18)+
                      '" rodzajInformacji="'+_izk+'" />'+
   _nw+_q+' <metrykaPracownika>'+
   _nw+_q+'<daneEwidencyjne imie1="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                         '" imie2="'+exec('d_read','!ppl_zes_exso',_ref,7)+
                         '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,5)+
                         '" nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+
                         '" nrDowodu="'+exec('d_read','!ppl_zes_exso',_ref,3)+
                         '" pesel="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" />'+
   _nw+_q+' <adresPracownika>'+
   _nw+_q+'  <adres gmina="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                 '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,12)+
                 '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                 '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,15)+
                 '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,16)+
                 '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,13)+
                 '" powiat="'+exec('d_read','!ppl_zes_exso',_ref,9)+
                 '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,14)+
                 '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" />'+
   _nw+_q+'  </adresPracownika>'+
   _nw+_q+'  <infNiepelnospr chronLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,23,0),SOD.PR)+
                          '" chronSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,26,0),SOD.PR)+
                          '" chronSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,25,0),SOD.PR)+
                          '" chronSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,24,0),SOD.PR)+
                          '" chronUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,22,0),SOD.PR)+
                          '" chronZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,21,0),SOD.PR)+
                          '" normLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,29,0),SOD.PR)+
                          '" normSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,32,0),SOD.PR)+
                          '" normSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,31,0),SOD.PR)+
                          '" normSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,30,0),SOD.PR)+
                          '" normUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,28,0),SOD.PR)+
                          '" normZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,27,0),SOD.PR)+'" />'+
   _nw+_q+'  <zatrudnienie kosztyPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40,0),SOD.PR)+
                        '" kwDofWyplata="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,43,0),SOD.PR)+
                        '" kwUstalona="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39,0),SOD.PR)+
                        '" limitKosztowPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42,0),SOD.PR)+
                        '" okresZatrOdDnia="'+exec('txt_dt','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,33))+
                        '" pomniejszenia="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41,0),SOD.PR)+
                        '" stanowiPomocPubliczna="'+exec('d_read','!ppl_zes_exso',_ref,34)+
                        '" wWynikuRozwUmowy="'+exec('d_read','!ppl_zes_exso',_ref,36)+
                        '" wynMinimalne="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38,0),SOD.PR)+
                        '" wzrostNettoZatrudnienia="'+exec('d_read','!ppl_zes_exso',_ref,35)+'" />'+
   _nw+_q+'  <pomocPubliczna kwota="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37,0),SOD.PR)+'" /> '+
   _nw+_q+'</metrykaPracownika>'+
   _nw;
exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\INFDPr6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [11.22]
:: OPIS: Eksport dokumentu INF-D-P (wersja 6).
::   WE: odczyt wymaganych zmiennych globalnych
::  OLD: \INFDPr6/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
exec('zero_ch','!ppl_zes_exso');
_q:=15*' ';
_nw:=exec('eol','!ppl_zes_exso');

_ref:=SOD_N.ref;
_izk:={? SOD_N.SOD_P().KOR='K' || 'K' || 'Z' ?};

   _tresc:=
       _q+'<daneInformacji nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,20)+
                        '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
                        '" okresSprawozdawczy="'+(((('00'+$SOD_N.SOD_P().MP))+2)+'-'+($SOD_N.SOD_P().R))+'"'+
   _nw+_q+' okresSprawozdawczyWynagrodzenie="'+exec('d_read','!ppl_zes_exso',_ref,18)+
                      '" rodzajInformacji="'+_izk+'" />'+
   _nw+_q+' <metrykaPracownika>'+
   _nw+_q+'<daneEwidencyjne imie1="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                         '" imie2="'+exec('d_read','!ppl_zes_exso',_ref,7)+
                         '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,5)+
                         '" nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+
                         '" nrDowodu="'+exec('d_read','!ppl_zes_exso',_ref,3)+
                         '" pesel="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" />'+
   _nw+_q+' <adresPracownika>'+
   _nw+_q+'  <adres gmina="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                 '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,12)+
                 '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                 '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,15)+
                 '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,16)+
                 '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,13)+
                 '" powiat="'+exec('d_read','!ppl_zes_exso',_ref,9)+
                 '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,14)+
                 '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" />'+
   _nw+_q+'  </adresPracownika>'+
   _nw+_q+'  <infNiepelnospr chronLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,23,0),SOD.PR)+'" '+
                  'chronLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,29,0),SOD.PR)+'" '+
                  'chronSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,26,0),SOD.PR)+'" '+
                  'chronSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,32,0),SOD.PR)+'" '+
                  'chronSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,25,0),SOD.PR)+'" '+
                  'chronSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,31,0),SOD.PR)+'" '+
                  'chronSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,24,0),SOD.PR)+'" '+
                  'chronSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,30,0),SOD.PR)+'" '+
                  'chronUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,22,0),SOD.PR)+'" '+
                  'chronUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,28,0),SOD.PR)+'" '+
                  'chronZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,21,0),SOD.PR)+'" '+
                  'chronZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,27,0),SOD.PR)+'" '+
                  'normLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,35,0),SOD.PR)+'" '+
                  'normLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41,0),SOD.PR)+'" '+
                  'normSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38,0),SOD.PR)+'" '+
                  'normSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,44,0),SOD.PR)+'" '+
                  'normSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37,0),SOD.PR)+'" '+
                  'normSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,43,0),SOD.PR)+'" '+
                  'normSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36,0),SOD.PR)+'" '+
                  'normSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42,0),SOD.PR)+'" '+
                  'normUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,34,0),SOD.PR)+'" '+
                  'normUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40,0),SOD.PR)+'" '+
                  'normZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,33,0),SOD.PR)+'" '+
                  'normZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39,0),SOD.PR)+'" />'+
   _nw+_q+'  <zatrudnienie '+
                  'efektZachety="'+exec('d_read','!ppl_zes_exso',_ref,48)+'" '+
                  'kosztyPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,52,0),SOD.PR)+'" '+
                  'kwDofWyplata="0,00" '+
                  'kwUstalona="0,00" '+
                  'limitKosztowPlacy="0,00" '+
                  'okresZatrOdDnia="'+exec('txt_dt','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,45))+'" '+
                  'pomniejszenia="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,53,0),SOD.PR)+'" '+
                  'pracWykDzG="'+exec('d_read','!ppl_zes_exso',_ref,47)+'" '+
                  'stanowiPomocPubliczna="'+exec('d_read','!ppl_zes_exso',_ref,46,0)+'" '+
                  'wynMinimalne="0,00"/>'+
   _nw+_q+'  <pomocPubliczna kwota="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,49,0),SOD.PR)+'" /> '+
   _nw+_q+'</metrykaPracownika>'+
   _nw;
exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\INFDZs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Tresc dokumentu typu INF-D-Z (wersja 2).
::   WE: odczyt wymaganych zmiennych globalnych
::    _a - nazwa plikowa dokumentu
:: formatowanie - strona 52
:: instrukcja   - brak danych
::  OLD: \INFDZs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
{? ~exec('rachunki_banki','rachunki') || SOD_N.del(); return(0) ?};

_xINFDZ:=exec('count','!ppl_zes_exso','INF-D-Z');
_ref:=SOD_N.ref;

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',2,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer pracodawcy w rejestrze PFRON',__G[45]);
exec('d_save','!ppl_zes_exso',_ref,2,'NIP pracodawcy',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'));
exec('d_save','!ppl_zes_exso',_ref,3,'REGON',14+(KST.REG+(14*'0')));
exec('d_save','!ppl_zes_exso',_ref,4,'PKD',KST.PKD);
exec('d_save','!ppl_zes_exso',_ref,5,'Pełna nazwa wnioskodawcy',KST.NAZWA);
exec('d_save','!ppl_zes_exso',_ref,6,'Skrócona nazwa wnioskodawcy',KST.SKROT);
exec('d_save','!ppl_zes_exso',_ref,7,'Identyfikator adresu(GUS)',KST.GMGUS);
exec('d_save','!ppl_zes_exso',_ref,8,'Kod pocztowy',KST.KOD);
exec('d_save','!ppl_zes_exso',_ref,9,'Miejscowość',KST.MIASTO);
exec('d_save','!ppl_zes_exso',_ref,10,'Nr domu',KST.DOM);
exec('d_save','!ppl_zes_exso',_ref,11,'Nr lokalu',KST.LOKAL);
exec('d_save','!ppl_zes_exso',_ref,12,'Poczta',KST.POCZTA);
exec('d_save','!ppl_zes_exso',_ref,13,'Ulica',KST.ULICA);
exec('d_save','!ppl_zes_exso',_ref,14,'województwo',__G[51]);
exec('d_save','!ppl_zes_exso',_ref,15,'e-mail',KST.EMAIL);
exec('d_save','!ppl_zes_exso',_ref,16,'Faks',KST.FAX);
exec('d_save','!ppl_zes_exso',_ref,17,'Telefon',KST.TEL);
exec('d_save','!ppl_zes_exso',_ref,18,'Adres do korespondencji taki sam?',__G[50]);
exec('d_save','!ppl_zes_exso',_ref,19,'KORESPONDENCJA: Kod pocztowy',KST.KKOD);
exec('d_save','!ppl_zes_exso',_ref,20,'KORESPONDENCJA: Miejscowość',KST.KMIASTO);
exec('d_save','!ppl_zes_exso',_ref,21,'KORESPONDENCJA: nr domu',KST.KDOM);
exec('d_save','!ppl_zes_exso',_ref,22,'KORESPONDENCJA: nr lokalu',KST.KLOKAL);
exec('d_save','!ppl_zes_exso',_ref,23,'KORESPONDENCJA: Ulica',KST.KULICA);
exec('d_save','!ppl_zes_exso',_ref,24,'KORESPONDENCJA: e-mail',KST.KEMAIL);
exec('d_save','!ppl_zes_exso',_ref,25,'KORESPONDENCJA: fax',KST.KFAX);
exec('d_save','!ppl_zes_exso',_ref,26,'KORESPONDENCJA: tel.',KST.KTEL);
exec('d_save','!ppl_zes_exso',_ref,27,'Osoba kontaktowa: Imię',KST.PFIMIE);
exec('d_save','!ppl_zes_exso',_ref,28,'Osoba kontaktowa: Nazwisko',KST.PFNAZW);
exec('d_save','!ppl_zes_exso',_ref,29,'Osoba kontaktowa: e-mail',KST.PFEMAIL);
exec('d_save','!ppl_zes_exso',_ref,30,'Osoba kontaktowa: fax',KST.PFFAX);
exec('d_save','!ppl_zes_exso',_ref,31,'Osoba kontaktowa: tel.',KST.PFTEL);
exec('d_save','!ppl_zes_exso',_ref,32,'Data rejestracji',KST.DREJ);
exec('d_save','!ppl_zes_exso',_ref,33,'Nazwa rejestru',KST.OREJ);
exec('d_save','!ppl_zes_exso',_ref,34,'Numer w rejestrze',KST.NREJ);
exec('d_save','!ppl_zes_exso',_ref,35,'Pełna nazwa organu rejestrowego',KST.REJ);
exec('d_save','!ppl_zes_exso',_ref,36,'Forma prawna działalności',__G[21]);
exec('d_save','!ppl_zes_exso',_ref,37,'Forma prawna przedsiębiorcy',__G[22]);
exec('d_save','!ppl_zes_exso',_ref,38,'Forma własności',__G[23]);
exec('d_save','!ppl_zes_exso',_ref,39,'Typ pracodawcy',__G[24]);
exec('d_save','!ppl_zes_exso',_ref,40,'Wielkość pracodawcy',__G[25]);
exec('d_save','!ppl_zes_exso',_ref,41,'Data uzyskania/utraty statusu Z.P.CH.',__G[40]);
exec('d_save','!ppl_zes_exso',_ref,42,'Data wydania decyzji',__G[41]);
exec('d_save','!ppl_zes_exso',_ref,43,'Podstawa uzyskania statusu',__G[42]);
exec('d_save','!ppl_zes_exso',_ref,44,'Rodzaj decyzji',__G[43]);
exec('d_save','!ppl_zes_exso',_ref,45,'Znak decyzji',__G[44]);
exec('d_save','!ppl_zes_exso',_ref,46,'Nazwa banku',SKID_RBK.BANK().NB);
exec('d_save','!ppl_zes_exso',_ref,47,'Nr rachunku',SKID_RBK.N);
exec('d_save','!ppl_zes_exso',_ref,49,'Osoba występująca w imieniu wnioskodawcy',OPERATOR.USER().DANE);
exec('d_save','!ppl_zes_exso',_ref,50,'Numer kolejny',_xINFDZ,'B');
exec('d_save','!ppl_zes_exso',_ref,51,'Okres sprawozdawczy',__okSp);
1


\INFDZr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Eksport dokumentu typu INF-D-Z (wersja 2).
::   WE: odczyt wymaganych zmiennych globalnych
::    _a - nazwa plikowa dokumentu
::  OLD: \INFDZr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
{? exec('NAGr','!ppl_zes_exso')
||
   _nw:=exec('eol','!ppl_zes_exso');
   _q:=15*' ';
   _ref:=SOD_N.ref;
   _izk:=SOD_N.SOD_P().KOR;

   _dw:=DEFINE.DATA;
   _dr:=exec('d_read','!ppl_zes_exso',_ref,32);
   _ds:=exec('d_read','!ppl_zes_exso',_ref,41);
   _dd:=exec('d_read','!ppl_zes_exso',_ref,42);

   _tresc:=
          _q+'<kartaPracodawcy>'+
      _nw+_q+'   <daneEwidencyjne '+
         'nip="'+exec('txt_cut','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,2),'-')+
         '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+'"'+
      _nw+_q+
         '   pelnaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,5)+
         '" pkd="'+exec('d_read','!ppl_zes_exso',_ref,4)+
         '" regon="'+('0'+(14+(exec('d_read','!ppl_zes_exso',_ref,3)+'00000')))+'"'+
      _nw+_q+
         '   skroconaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,6)+'"/>'+
      _nw+_q+'   <adresPracodawcy>'+
      _nw+_q+'      <adres '+
         'kodAdresuPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,7)+
         '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,8)+
         '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,9)+'"'+
      _nw+_q+
         '      nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,10)+
         '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,11)+
         '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,12)+'"'+
      _nw+_q+
         '      ulica="'+exec('d_read','!ppl_zes_exso',_ref,13)+
         '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,14)+'"/>'+
      _nw+_q+
         '      <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,15)+
         '" faks="'+exec('d_read','!ppl_zes_exso',_ref,16)+
         '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,17)+'"/>'+
      _nw+_q+'    </adresPracodawcy>'+
      _nw+_q+'    <adresKorespondencyjny>'+
      _nw+_q+
         '       <adres adresJak="'+exec('d_read','!ppl_zes_exso',_ref,18)+
         '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,19)+
         '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,20)+
         '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,21)+'"'+
      _nw+_q+
         '       nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,22)+
         '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,23)+'"/>'+
      _nw+_q+
         '       <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,24)+
         '" faks="'+exec('d_read','!ppl_zes_exso',_ref,25)+
         '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,26)+'"/>'+
      _nw+_q+'    </adresKorespondencyjny>'+
      _nw+_q+'    <osobaOdp>'+
      _nw+_q+
         '       <osoba imie="'+exec('d_read','!ppl_zes_exso',_ref,27)+
         '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,28)+'"/>'+
      _nw+_q+
         '      <kontakt email="'+exec('d_read','!ppl_zes_exso',_ref,29)+
         '" faks="'+exec('d_read','!ppl_zes_exso',_ref,30)+
         '" telefon="'+exec('d_read','!ppl_zes_exso',_ref,31)+'"/>'+
      _nw+_q+'    </osobaOdp>'+
      _nw+_q+
         '    <organRejestrowy dataRejestracji="'+exec('txt_dt','!ppl_zes_exso',_dr)+
         '" nazwaRejestru="'+exec('d_read','!ppl_zes_exso',_ref,33)+'"'+
      _nw+_q+
         '       numerWRejestrze="'+exec('d_read','!ppl_zes_exso',_ref,34)+
         '" pelnaNazwa="'+exec('d_read','!ppl_zes_exso',_ref,35)+'"/>'+
      _nw+_q+
         '    <dodInfPracodawcy formaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,36)+
         '" formaPrawnaPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,37)+
         '" formaWlasnosci="'+exec('d_read','!ppl_zes_exso',_ref,38)+
         '" typPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,39)+'"';
      _nw+_q+
         '       wielkoscPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,40)+'"/>'+
      _nw+_q+
         '    <statusZakladu dataUzyskStatusu="'+exec('txt_dt','!ppl_zes_exso',_ds)+
         '" dataWydaniaDecyzji="'+exec('txt_dt','!ppl_zes_exso',_dd)+'"'+
      _nw+_q+
         '       podstUzyskStatusu="'+exec('d_read','!ppl_zes_exso',_ref,43)+
         '" rodzajDecyzji="'+exec('d_read','!ppl_zes_exso',_ref,44)+
         '" znakDecyzji="'+exec('d_read','!ppl_zes_exso',_ref,45)+'"/>'+
      _nw+_q+
         '    <rachunekBankowy nazwaBanku="'+exec('d_read','!ppl_zes_exso',_ref,46)+
         '" nrRachunku="'+exec('d_read','!ppl_zes_exso',_ref,47)+'"/>'+
      _nw+_q+'</kartaPracodawcy>'+
      _nw+_q+'<daneInformacji '+
         'dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+
         '" imieNazwiskoOsobyPodpisujacej="'+exec('d_read','!ppl_zes_exso',_ref,49)+
         '" nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,50)+'"'+
      _nw+_q+
         '   okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,51)+
         '" rodzajInformacji="'+_izk+'" uwagi=""/>'+
      _nw;
   exec('f_save','!ppl_zes_exso',__FF,_tresc)
?};
+_tresc


\INFUPs
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Dokument INF-U-P (wersja 1) - odczyt danych i zapis do bazy
::       (zalacznik do wniosku o wyplate refundacji).
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::       _b - ignoruj bledy - 1 tak, 0 nie
::  OLD: \INFUPs/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ( ( P.DZA<=date(#(__okSp+4),#(2+__okSp),0) & (P.DZ=date(0,0,0) | P.DZ>=date(#(__okSp+4),#(2+__okSp),1)) )
   & exec('i_Niep','!ppl_zes_exso',__okSp)
   & exec('i_Wyn','!ppl_zes_exso',date(#(__okSp+4),#(2+__okSp),1)) )
   | (_=2 & _b=1)
||
   {? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
   {? _=2 & _b=1
   || exec('zero_ch','!ppl_zes_exso');
      exec('i_Niep','!ppl_zes_exso',__okSp);
      exec('i_Wyn','!ppl_zes_exso',date(#(__okSp+4),#(2+__okSp),1))
   ?};
   exec('zatrudnienie','!ppl_zes_exso',P.OSOBA);
   _xINFUP:=exec('count','!ppl_zes_exso','INF-U-P');
   _od:={? __Ch[50]<=date(#(__okSp+4),#(2+__okSp),1)
        || 1
        || __Ch[50]~3 ?};
   _do:={? __Ch[49]=date(0,0,0)
         | __Ch[49]>=date(#(__okSp+4),#(2+__okSp),0)
        || date(#(__okSp+4),#(2+__okSp),0)~3
        || __Ch[49]~3 ?};
   _okZat:=_do-_od+1;
   _ref:=SOD_N.ref;

   exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',1,'B');

   exec('d_save','!ppl_zes_exso',_ref,1,'Numer pracodawcy w rejestrze PFRON',__G[45]);
   exec('d_save','!ppl_zes_exso',_ref,2,'PESEL',OSOBA.PESEL);
   exec('d_save','!ppl_zes_exso',_ref,3,'Dowód osobisty',OSOBA.DOWOD);
   exec('d_save','!ppl_zes_exso',_ref,4,'NIP',exec('txt_cut','!ppl_zes_exso',OSOBA.NIP,'-'));
   exec('d_save','!ppl_zes_exso',_ref,5,'Nazwisko',OSOBA.NAZWISKO);
   exec('d_save','!ppl_zes_exso',_ref,6,'Pierwsze imię',OSOBA.PIERWSZE);
   exec('d_save','!ppl_zes_exso',_ref,7,'Drugie imię',OSOBA.DRUGIE);
   {? exec('szukaj','osoba','S',date(SOD_P.R,SOD_P.MP,0))<>null
   ||
      exec('d_save','!ppl_zes_exso',_ref,8,'Województwo',exec('kod_woje','!ppl_zes_exso',OS_ADRES.WOJEWODZ));
      exec('d_save','!ppl_zes_exso',_ref,9,'Powiat',OS_ADRES.POWIAT);
      exec('d_save','!ppl_zes_exso',_ref,10,'Gmina',OS_ADRES.GMINA);
      exec('d_save','!ppl_zes_exso',_ref,11,'Miejscowość',OS_ADRES.MIASTO);
      exec('d_save','!ppl_zes_exso',_ref,12,'Kod pocztowy',OS_ADRES.KOD);
      exec('d_save','!ppl_zes_exso',_ref,13,'Poczta',OS_ADRES.POCZTA);
      exec('d_save','!ppl_zes_exso',_ref,14,'Ulica',OS_ADRES.ULICA);
      exec('d_save','!ppl_zes_exso',_ref,15,'Nr domu',OS_ADRES.DOM);
      exec('d_save','!ppl_zes_exso',_ref,16,'Nr lokalu',OS_ADRES.LOKAL);
      exec('d_save','!ppl_zes_exso',_ref,17,'Miejsce zamieszkania',
                            {? (+OS_ADRES.ULICA | OS_ADRES.MIASTO<>OS_ADRES.ULICA)
                             &  OS_ADRES.POCZTA=OS_ADRES.MIASTO
                            || 'M'
                            || 'W'
                            ?})
    ?};
    exec('d_save','!ppl_zes_exso',_ref,18,'Wykonywany zawód lub specjalność',P.ZAW().KOD);
    exec('d_save','!ppl_zes_exso',_ref,19,'Poziom wykształcenia',OSOBA.WYK().KODPFRON);
    exec('d_save','!ppl_zes_exso',_ref,20,'Płeć',OSOBA.PLEC);

    exec('d_save','!ppl_zes_exso',_ref,23,'Nr kolejny informacji',_xINFUP,'B');

    exec('d_save','!ppl_zes_exso',_ref,24,'art25a/3 - niep.znaczna,ZPCH',__Ch[6]);
    exec('d_save','!ppl_zes_exso',_ref,25,'art25a/3 - niep.umiarkowana,ZPCH',__Ch[5]);
    exec('d_save','!ppl_zes_exso',_ref,26,'art25a/3 - niep.lekka,ZPCH',__Ch[4]);
    exec('d_save','!ppl_zes_exso',_ref,27,'art25a/3 - niep.nieokreślona,ZPCH',__Ch[14]);
    exec('d_save','!ppl_zes_exso',_ref,28,'art25a/2 - niep.znaczna',__Ch[3]);
    exec('d_save','!ppl_zes_exso',_ref,29,'art25a/2 - niep.umiarkowana',__Ch[2]);
    exec('d_save','!ppl_zes_exso',_ref,30,'art25a/2 - niep.lekka',__Ch[1]);
    exec('d_save','!ppl_zes_exso',_ref,31,'art25a/4 - niep.znaczna',__Ch[31]);
    exec('d_save','!ppl_zes_exso',_ref,32,'art25a/4 - niep.umiarkowana',__Ch[32]);
    exec('d_save','!ppl_zes_exso',_ref,33,'art25a/4 - niep.lekka',__Ch[33]);
    exec('d_save','!ppl_zes_exso',_ref,34,'art25a/3 - niep.znaczna,S,ZPCH',__Ch[12]);
    exec('d_save','!ppl_zes_exso',_ref,35,'art25a/3 - niep.umiarkowana,S,ZPCH',__Ch[11]);
    exec('d_save','!ppl_zes_exso',_ref,36,'art25a/3 - niep.lekka,S,ZPCH',__Ch[10]);
    exec('d_save','!ppl_zes_exso',_ref,37,'art25a/3 - niep.nieokreślona,S,ZPCH',__Ch[13]);
    exec('d_save','!ppl_zes_exso',_ref,38,'art25a/2 - niep.znaczna,S',__Ch[9]);
    exec('d_save','!ppl_zes_exso',_ref,39,'art25a/2 - niep.umiarkowana,S',__Ch[8]);
    exec('d_save','!ppl_zes_exso',_ref,40,'art25a/2 - niep.lekka,S',__Ch[7]);
    exec('d_save','!ppl_zes_exso',_ref,41,'art25a/4 - niep.znaczna,S',__Ch[41]);
    exec('d_save','!ppl_zes_exso',_ref,42,'art25a/4 - niep.umiarkowana,S',__Ch[42]);
    exec('d_save','!ppl_zes_exso',_ref,43,'art25a/4 - niep.lekka,S',__Ch[43]);
    exec('d_save','!ppl_zes_exso',_ref,44,'Okres zatrudnienia',_okZat,,2);
    exec('d_save','!ppl_zes_exso',_ref,45,'Podwyższone koszty zatrudnienia',__G[26]);


   _poz46:=0;
   {? __G[26]<>'N'
   ||
      _poz46:=__S[7]+
         {? #(2+__okSp)>1
         || exec('f_sum','!ppl_zes_exso',_ref,46,date(#(__okSp+4),#(2+__okSp)-1,1),date(#(__okSp+4),#(2+__okSp)-1,1))
         ?}
   ?};
    exec('d_save','!ppl_zes_exso',_ref,46,'Najniższy pułap intensywności pomocy',_poz46,,2);

   _poz47:=0;
   {? __G[26]<>'N'
   || _poz47:=exec('f_sum','!ppl_zes_exso',_ref,48,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1),'INF-D-P');
      {? #(2+__okSp)>1 || _poz47+=exec('f_sum','!ppl_zes_exso',_ref,56,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1)) ?}
   ?};
   exec('d_save','!ppl_zes_exso',_ref,47,'Dofinansowanie i refundacja',_poz47,,2);

::    12 Nalezy wypelnic w przypadku wybrania pola 1 lub 2 w poz. 45.
::    Wykazac sume kwot:
::     dofinansowania do wynagrodzen osob niepelnosprawnych przyslugujacych na podstawie art. 26a ustawy, wykazanych
::      w poz. 48 Miesiecznych informacji o wynagrodzeniach, zatrudnieniu i stopniach niepelnosprawnosci
::      pracownikow niepelnosprawnych (INF-D-P) skladanych za okresy od poczatku roku do okresu sprawozdawczego
::      wlacznie
::    oraz
::     refundacji skladek na ubezpieczenia spoleczne przyslugujacych na podstawie art. 25a ust. 2-4 ustawy,
::      wykazanych w poz. 56
::    Miesiecznych informacji pracodawcy o podstawach wymiaru skladek na ubezpieczenia spoleczne,
::    skladkach na ubezpieczenia spoleczne, zatrudnieniu i stopniach niepelnosprawnosci pracownikow
::    niepelnosprawnych (INF-U-P) skladanych za okresy od poczatku roku do miesiaca poprzedzajacego
::    okres sprawozdawczy wlacznie.

   _poz48:=0;
   {? __G[26]<>'N'
   || {? #(2+__okSp)>1
      || _poz48:=exec('f_sum','!ppl_zes_exso',_ref,41,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1)-1,'INF-D-P');
         _poz48+=exec('f_sum','!ppl_zes_exso',_ref,49,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1)-1)
      ?}
   ?};

    exec('d_save','!ppl_zes_exso',_ref,48,'Wypłacone dofinansowanie i refundacja',_poz48,,2);
::    13 Należy wykazaµ wypłaconą kwote z poz. 47.

    _poz49:=exec('f_sum','!ppl_zes_exso',_ref,50,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),1),'INF-D-P');
    exec('d_save','!ppl_zes_exso',_ref,49,'Dofinansowanie za okres sprawozdawczy',_poz49,,2);
::    14 Należy wykazaµ kwote dofinansowania do wypłaty za okres sprawozdawczy, pomniejszoną o kwote do przekazania na zakładowy
::    fundusz rehabilitacji osób niepełnosprawnych.

    _tab:=exec('get_skl','!ppl_zes_exso',date(#(__okSp+4),#(2+__okSp),1),P.OSOBA,753,958,959,960,765,767);
    exec('d_save','!ppl_zes_exso',_ref,50,'Podstawa wymiaru',_tab[1],,2);
    exec('d_save','!ppl_zes_exso',_ref,51,'Kwoty składek (pracodawca): EMERYTALNE',_tab[2],,2);
    exec('d_save','!ppl_zes_exso',_ref,52,'Kwoty składek (pracodawca): RENTOWE',_tab[3],,2);
    exec('d_save','!ppl_zes_exso',_ref,53,'Kwoty składek (pracodawca): WYPADKOWE',_tab[4],,2);
    exec('d_save','!ppl_zes_exso',_ref,54,'Kwoty składek (wynagrodzenie): EMERYTALNE',_tab[5],,2);
    exec('d_save','!ppl_zes_exso',_ref,55,'Kwoty składek (wynagrodzenie): CHOROBOWE',_tab[6],,2);


    _poz56:=((_tab[2]+_tab[5])*(__Ch[6]+__Ch[5]+__Ch[4]+__Ch[14]+__Ch[3]+__Ch[2]+__Ch[31]+__Ch[32]+__Ch[12]+__Ch[11]+
      __Ch[10]+__Ch[13]+__Ch[9]+__Ch[8]+__Ch[41]+__Ch[42])+_tab[4]*
      (__Ch[6]+__Ch[5]+__Ch[4]+__Ch[14]+__Ch[33]+__Ch[12]+__Ch[11]+__Ch[10]+__Ch[13]+__Ch[43])+
      (_tab[3]+_tab[6])*(__Ch[6]+__Ch[5]+__Ch[4]+__Ch[14]+__Ch[12]+__Ch[11]+__Ch[10]+__Ch[13]))/_okZat;
    exec('d_save','!ppl_zes_exso',_ref,56,'RAZEM:',_poz56,,2);
::  16 Poz. 56 = [(poz. 51 + poz. 54) x (poz. 24 + poz. 25 + poz. 26 + poz. 27 + poz. 28 + poz. 29 + poz. 31 + poz. 32 + poz. 34 +
::  poz. 35 + poz. 36 + poz. 37 + poz. 38 + poz. 39 + poz. 41 + poz. 42) + poz. 53 x (poz. 24 + poz. 25 + poz. 26 + poz. 27 + poz.
::  33 + poz. 34 + poz. 35 + poz. 36 + poz. 37 + poz. 43) + (poz. 52 + poz. 55) x (poz. 24 + poz. 25 + poz. 26 + poz. 27 + poz. 34 +
::  poz. 35 + poz. 36 + poz. 37)] / poz. 44.


    _poz57:=0;
    {? __G[26]<>'N'
    || {? (_poz47+_poz56)>_poz46
       || {? (_poz46-_poz48)>_poz56 || _poz57:=_poz56 || _poz57:=(_poz46-_poz48) ?}
       || {? (_poz56+_poz47-_poz48)>_poz56 || _poz57:=_poz56 || _poz57:=(_poz56+_poz47-_poz48) ?}
       ?}
    || _poz57:=_poz56
    ?};
    {? _poz57<0 || _poz57:=0 ?};
    exec('d_save','!ppl_zes_exso',_ref,57,'DO WYPŁATY',_poz57,,2,00);
::   17 W przypadku wybrania pola 1 lub 2 w poz. 45: jeSeli (poz. 47 + poz. 56) > poz. 46, to poz. 57 = poz. 46  poz. 48, chyba Se
::   poz. 46  poz. 48 > poz. 56, wtedy poz. 57 = poz. 56, a jeSeli (poz. 47 + poz. 56) ? poz. 46, to poz. 57 = poz. 56 + poz. 47 
::   poz. 48, chyba Se poz. 56 + poz. 47  poz. 48 > poz. 56, wtedy poz. 57 = poz. 56. W przypadku wybrania pola 3 w poz. 37: poz.
::   57 = poz. 56. JeSeli poz. 57 < 0, to poz.57 = 0.

:: uzupelnienie danych w deklaracji INF-D-P
   _poz39:=0;
   {? __G[26]<>'N'
   ||
      _poz39:=_poz56;
      {? #(2+__okSp)>1
      || _poz39:=exec('f_sum','!ppl_zes_exso',_ref,56,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1)-1);
         _poz39+=exec('f_sum','!ppl_zes_exso',_ref,48,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp),1)-1,'INF-D-P')
      ?}
   ?};
   exec('d_act','!ppl_zes_exso',_ref,39,,_poz39,,,,'INF-D-P');

    _poz40:=0;
    {? __G[26]<>'N'
    || {? #(2+__okSp)>1
       || _poz40+=exec('f_sum','!ppl_zes_exso',_ref,56,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1));
          _poz40+=exec('f_sum','!ppl_zes_exso',_ref,50,date(#(__okSp+4),1,1),date(#(__okSp+4),#(2+__okSp)-1,1),'INF-D-P')
       ?}
    ?};
   exec('d_act','!ppl_zes_exso',_ref,40,,_poz40,,,,'INF-D-P');

   _poz41:=_poz57;
   exec('d_act','!ppl_zes_exso',_ref,41,,_poz41,,,,'INF-D-P');

:   aktualizacja po uzupelnieniu
  _poz38:=exec('f_sum','!ppl_zes_exso',_ref,38,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),1),'INF-D-P');
  _poz48:=exec('f_sum','!ppl_zes_exso',_ref,48,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),1),'INF-D-P');
  _poz49:=exec('f_sum','!ppl_zes_exso',_ref,49,date(#(__okSp+4),#(2+__okSp),1),date(#(__okSp+4),#(2+__okSp),1),'INF-D-P');
  _poz50:=0;
  {? __G[26]<>'N'
  || {? (_poz39+_poz48)>_poz38
     || _poz50:=(_poz38-_poz40-_poz41+_poz49)
     || _poz50:=(_poz49+_poz48+_poz39-_poz40-_poz41)
     ?}
  || _poz50:=(_poz48+_poz49)
  ?};
  {? _poz50<0 || _poz50:=0 ?};
  {? _poz50>(_poz48+_poz49)
  || _poz50:=(_poz48+_poz49)
  || {? _poz50<_poz49 || exec('d_act','!ppl_zes_exso',_ref,49,,_poz50,,,,'INF-D-P')  ?}
  ?};
  exec('d_act','!ppl_zes_exso',_ref,50,,_poz50,,,,'INF-D-P');

:: koniec uzupelnienia

   exec('d_save','!ppl_zes_exso',_ref,99,'Okres sprawozdawczy',__okSp);
   1
?};
exec('zero_ch','!ppl_zes_exso')


\INFUPr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Eksport dokumentu typu INF-U-P (wersja 1)
::       (zalacznik do wniosku o wyplate refundacji).
::   WE: odczyt wymaganych zmiennych globalnych
::  OLD: \INFUPr/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
{? exec('NAGr','!ppl_zes_exso')
||
   _nw:=exec('eol','!ppl_zes_exso');
   _q:=15*' ';
   _ref:=SOD_N.ref;
   _izk:=SOD_N.SOD_P().KOR;

   _tresc:=
          _q+'<daneInformacji nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,23)+
              '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
              '" okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,99)+'"'+
       _nw+_q+'   rodzajInformacji="'+_izk+
              '" sposobRozlPomocy="'+exec('d_read','!ppl_zes_exso',_ref,45)+'" />'+
      _nw+_q+'<metrykaPracownika>'+
      _nw+_q+'<daneEwidencyjne imie1="'+exec('d_read','!ppl_zes_exso',_ref,6)+
              '" imie2="'+exec('d_read','!ppl_zes_exso',_ref,7)+
              '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,5)+
              '" nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+'"'+
       _nw+_q+'   nrDowodu="'+exec('d_read','!ppl_zes_exso',_ref,3)+
              '" pesel="'+exec('d_read','!ppl_zes_exso',_ref,2)+
              '" plec="'+exec('d_read','!ppl_zes_exso',_ref,20)+
              '" wyksztalcenie="'+exec('d_read','!ppl_zes_exso',_ref,19)+'"'+
       _nw+_q+'   zawod="'+exec('d_read','!ppl_zes_exso',_ref,18)+'" />'+
       _nw+_q+'<adresPracownika>'+
       _nw+_q+'<adres gmina="'+exec('d_read','!ppl_zes_exso',_ref,10)+
              '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,12)+
              '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,11)+
              '" msceZamieszk="'+exec('d_read','!ppl_zes_exso',_ref,17)+'"'+
       _nw+_q+'   nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,15)+
              '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,16)+
              '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,14)+
              '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,13)+
              '" powiat="'+exec('d_read','!ppl_zes_exso',_ref,9)+'"'+
       _nw+_q+'   wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" />'+
       _nw+_q+'</adresPracownika>'+
       _nw+_q+'<infNiepelnospr chronZnaczny="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,24))+2)+
              '" chronUmiarkowany="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,25))+2)+
              '" chronLekki="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,26))+2)+
              '" chronNieokreslony="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,27))+2)+'"'+
       _nw+_q+'   normZnaczny="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,28))+2)+
              '" normUmiarkowany="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,29))+2)+
              '" normLekki="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,30))+2)+'"'+
       _nw+_q+'   ust4Znaczny="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,31))+2)+
              '" ust4Umiarkowany="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,32))+2)+
              '" ust4Lekki="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,33))+2)+'"'+
       _nw+_q+'   chronSZnaczny="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,34))+2)+
              '" chronSUmiarkowany="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,35))+2)+
              '" chronSLekki="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,36))+2)+
              '" chronSNieokreslony="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,37))+2)+'"'+
       _nw+_q+'   normSZnaczny="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,38))+2)+
              '" normSUmiarkowany="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,39))+2)+
              '" normSLekki="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,40))+2)+'"'+
       _nw+_q+'   ust4SZnaczny="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,41))+2)+
              '" ust4SUmiarkowany="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,42))+2)+
              '" ust4SLekki="'+(('00'+$exec('d_read','!ppl_zes_exso',_ref,43))+2)+'" />'+
       _nw+_q+'   <zatrudnienieRef okresZatr="'+$exec('d_read','!ppl_zes_exso',_ref,44)+
              '" podwKoszty="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,46),SOD.PR)+
              '" kosztyPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,47),SOD.PR)+
              '" dofinansowanie="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,48),SOD.PR)+'"'+
       _nw+_q+'   uzyskanaRef="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,49),SOD.PR)+
              '" podstawaWymiaru="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,50),SOD.PR)+
              '" pracEmerytalne="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,51),SOD.PR)+
              '" pracRentowe="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,52),SOD.PR)+'"'+
       _nw+_q+'   pracWypadkowe="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,53),SOD.PR)+
              '" wynEmerytalne="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,54),SOD.PR)+
              '" wynChorobowe="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,55),SOD.PR)+
              '" razem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,56),SOD.PR)+'"'+
       _nw+_q+'   kwDoWyplaty="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,57),SOD.PR)+'" />'+
       _nw+_q+'</metrykaPracownika>'+
       _nw;
   exec('f_save','!ppl_zes_exso',__FF,_tresc)
?};
+_tresc


\txt_cut
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Obrobka parametrow opisowych (usuniecie spacji i znakow roznie zapisywanych).
::   WE: _a -  string do obrobki
::       _b, _c, _d, _e, _f, _g - znaki do usuniecia [string]
::   WY:       string po obrobce
::  OLD: \txt_cut/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_nabok:='';
{! _obrot:=2 .. _
|!
   _zm:={? _obrot=2 || _b
        |? _obrot=3 || _c
        |? _obrot=4 || _d
        |? _obrot=5 || _e
        |? _obrot=6 || _f
        |? _obrot=7 || _g
        || '' ?};
   {!|? _poz:=(_a*_zm);_poz |! _nabok:=_nabok+((_poz-1)+_a); _a:=_poz-_a !};
   _a:=_nabok+_a;
   _nabok:=''
!};
_a


\txt_dt
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Obrobka parametrow opisowych (usuniecie spacji i znakow roznie zapisywanych).
::   WE: _a -  data [date]
::   WY:       data po obrobce: RRRR-MM-DD as STRING
::  OLD: \txt_dt/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? type_of(_a)=type_of(date) & _a<>date(0,0,0)
|| (('0000'+$(_a~1))+4)+'-'+(('0'+$(_a~2))+2)+'-'+(('0'+$(_a~3))+2)
|| ''
?}


\txt_mv
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zamiana wskazanaego znaku w w ciagu na inny.
::   WE: _a - tekst wejsciowy
::       _b - znak instniejacy
::       _c - znak nowy
::   WY:      tekst po obrobce
::  OLD: \txt_mv/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_na:='';
{!|? _q:=(_a*_b);_q |! _na:=_na+((_q-1)+_a)+_c; _a:=_q-_a !};
_na+_a


\int2str
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zamiana dowolnej liczby w dowolnej postaci na string uwzgledniajac liczbe miejsc po przecinku.
::   WE: _a - liczba [real][int][string]
::       _b - dokladnosc (liczba miejsc po przecinku) [integer]
::   WY:      przetworzona liczba [string]
::  OLD: \int2str/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? type_of(_a)=type_of('') || 1
|? type_of(_a)=type_of(0)  || _a:=$_a
?};
_lc:=+_a;
_a:=exec('txt_mv','!ppl_zes_exso',_a,'.',',');
_lp:=_a*',';
{? _b>0
|| {? _lp
   || {? (_lc-_lp)<_b
      || _a+((_b-(_lc-_lp))*'0')
      |? _lc-_lp>_b
      || _a-(_lc-_lp-_b)
      || _a
      ?}
   || _a+','+(_b*'0')
   ?}
|| {? _lp>0
   || (_lp-1)+_a
   || _a
   ?}
?}


\kod_woje
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Kody wojewodztw wg PFRON.
::   WE: _a - nazwa wojewodztwa [string]
::   WY: Dwucyfrowy kod wojewodztwa wg. PFRON [string]
::       w przypadku nierozpoznanej nazwy lub niepodanego wojewodztwa zwraca ciag pusty
::  OLD: \kod_woje/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_a:=-(STR.maz2nop(_a));
{? _a='dolnoslaskie' | _a*'doln'
|| '02'
|? _a='kujawsko-pomorskie' | _a*'kuja'
|| '04'
|? _a='lubelskie' | _a*'lube' | _a*'lubl'
|| '06'
|? _a='lubuskie' | _a*'lubu'
|| '08'
|? _a='lodzkie' | _a*'lodz'
|| '10'
|? _a='malopolskie' | _a*'malo'
|| '12'
|? _a='mazowieckie' | _a*'mazo'
|| '14'
|? _a='opolskie' | _a*'opol'
|| '16'
|? _a='podkarpackie' | _a*'podk' | _a*'karpa'
|| '18'
|? _a='podlaskie' | _a*'podl'
|| '20'
|? _a='pomorskie' | _a*'pom'
|| '22'
|? _a='slaskie' | _a*'sla'
|| '24'
|? _a='swietokrzyskie' | _a*'swie'
|| '26'
|? _a='warminskomazurskie' | _a*'warm' | _a*'mazu'
|| '28'
|? _a='wielkopolskie' | _a*'wiel'
|| '30'
|? _a='zachodniopomorskie' | _a*'zac' | _a*'pom'
|| '32'
|| 'Przypadek nieobsluzony, blednie podane badz niewypelnione wojewodztwo.';
   ''
?}


\i_Wyn
::----------------------------------------------------------------------------------------------------------------------
::  UTW: pkoso [2009+]
:: OPIS: Odczyt skladnikow wynagrodzen pracownikow.
:: _a - okres poczatkowy [date] - dowolna data z tego okresu
:: _b - okres końcowy    [date] - dowolna data z tego okresu (zero oznacza tylko okres pierwszy)
::  OLD: \i_Wyn/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__Ch[15]:=__Ch[16]:=0;
{! _ind:=1..10 |! __S[_ind]:=0 !};
{? var_pres('_a')<>type_of(date) || return(0) ?};
{? var_pres('_b')<>type_of(date) || _b:=_a ?};
__okWp:=(('00'+$(_a~2))+2)+'-'+$(_a~1);
_od:=date(_a~1,_a~2,1);
_do:=date(_b~1,_b~2,1);

_rok:=_od~1;
_msc:=_od~2;

P_INFO.index('OD');
_np:=''; _em:=0;
P_INFO.prefix(exec('ref_firma','ustawienia'),P.OSOBA);
{? P_INFO.find_le(date(_rok,_msc,0))
|| {!
   |?
      {? (2+P_INFO.TTUB().KOD)<>'04'
       & {? date(#(__okSp+4),#(2+__okSp),1)>=date(2011,03,01)
         || ~(P_INFO.PREM<>null & P_INFO.PREM().KOD='1' & P_INFO.STNP<>null & P_INFO.STNP().KOD<>'3')
         || 1
         ?}
       & P_INFO.STNP<>null & P_INFO.STNP().KOD<>'0'
       & P_INFO.STNP_OD<=date(_rok,_msc,0)
       & (P_INFO.STNP_DO=date(0,0,0) | P_INFO.STNP_DO>=date(_rok,_msc,1))
      || _np:={? S_ZUS.KOD='1' || '3'
              |? S_ZUS.KOD='3' || '1'
              || S_ZUS.KOD
              ?}
      ?};
      {? P_INFO.PREM<>null & P_INFO.PREM().KOD='1'
      || _em:=1
      ?};
      _np='' & P_INFO.next & P_INFO.OD<=date(_rok,_msc,0)
   !}
?};

_pocz:=date(_rok,_msc,1);
_kon:=date(_rok,_msc,0);

{? 7+$P.DZA=7+$date(_rok,_msc,1) || _pocz:=P.DZA ?};
{? 7+$P.DZ=7+$date(_rok,_msc,1) || _kon:=P.DZ ?};
_proc:=((_kon+1-_pocz)/(date(_rok,_msc,0)+1-date(_rok,_msc,1))*__G[30])$3;
_zatr:={? __G[30] || (P.DZ=date(0,0,0) | P.DZ>=date(_rok,_msc,1)) || 0 ?};

_r:=obj_new(__RUB.max());
{! _i:=1..obj_len(_r) |! _r[_i]:=0 !};

LS.cntx_psh();
O.cntx_psh();
KT.cntx_psh();
P.cntx_psh();
O.index('LISTYPLA');
O.prefix(exec('ref_firma','ustawienia'),__F_ZATR.O,_od~1,_od~2);
{? O.first
|| {!
   |? {? KST.PFR_LIST='*' | KST.PFR_LIST*O.T().T | KST.PFR_LIST=''
      || LS.use(O.LT);
         LS.index('OSOBAKOD');
         LS.prefix(exec('ref_firma','ustawienia'),P.OSOBA);
         {? LS.first
         || __okWp:=(('00'+$O.MP)+2)+'-'+$O.RP;
            {!
            |? _rn:=LS.RB().RN;
               {? _rn=440 || _r[440]+=LS.KW
               |? _rn=151 || _r[151]+=LS.KW
               |? _rn=152 || _r[152]+=LS.KW
               |? _rn=500 || _r[500]+=LS.KW
               |? _rn>=510 & _rn<=530 || _r[650]+=LS.KW
               |? _rn=753 || _r[753]+=LS.KW
               |? _rn=754 || _r[754]+=LS.KW
               |? _rn=765 || _r[765]+=LS.KW
               |? _rn=766 || _r[766]+=LS.KW
               |? _rn=767 || _r[767]+=LS.KW
               |? _rn=780 || _r[780]+=LS.KW
               |? _rn=784 || _r[784]+=LS.KW
               |? _rn=785 || _r[785]+=LS.KW
               |? _rn=792 || _r[792]+=LS.KW
               |? _rn=797 || _r[797]+=LS.KW

               |? _rn=958 || _r[958]+=LS.KW
               |? _rn=959 || _r[959]+=LS.KW
               |? _rn=960 || _r[960]+=LS.KW
               |? _rn=981 || _r[981]+=LS.KW
               |? _rn=982 || _r[982]+=LS.KW
               |? _rn=983 || _r[983]+=LS.KW
               |? _rn=71  || {? _r[71]<LS.KW || _r[71]:=LS.KW ?}
               ?};
               LS.next()
            !}
         ?};
         'uwzględniaj korekty składek';
         KORN.index('KOR_NAGU');
         P.index('PRACOSOB');
         P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P,P.OSOBA);
         {? P.first()
         || {!
            |? KORN.prefix(O.RU,O.MU,P.ref());
               {? KORN.first() & ((-KORN.LT)=(-O.LT)) & (KOR.prefix(KORN.ref()); KOR.first())
               || {! |? {? KOR.RU().RN=765 || _r[765]+=KOR.SKL; _r[753]+=KOR.POD
                        |? KOR.RU().RN=766 || _r[766]+=KOR.SKL
                        |? KOR.RU().RN=767 || _r[767]+=KOR.SKL; _r[754]+=KOR.POD
                        |? KOR.RU().RN=958 || _r[958]+=KOR.SKL
                        |? KOR.RU().RN=959 || _r[959]+=KOR.SKL
                        |? KOR.RU().RN=960 || _r[960]+=KOR.SKL
                        ?};
                        KOR.next()
                  !}
               ?};
               P.next()
            !}
         ?}
      ?};
      O.next()
   !}
?};
O.cntx_pop();
KT.cntx_pop();
P.cntx_pop();
LS.cntx_pop();

_r_nom:=obj_new(obj_len(_r));
{! _i:=1..obj_len(_r) |! _r_nom[_i]:=_r[_i] !};

: wynagrodzenie osiągane
__S[1]:=(_r[500]-_r[440]-_r[151]-_r[152])$2;
{? __S[1]<0 || __S[1]:=0 ?};
__Ch[15]:=__S[1];

{! _i:=1..obj_len(_r)
|! {? _r[_i]<0 || _r[_i]:=0 ?}
!};
: jeśli nie pracuje i nie ma nic na liscie to go pomijamy
{? ~_zatr | _r[500]=0 || return(0) ?};

: wynagrodzenie wyplacone
__S[2]:={? ~_em || exec('wynwyp','!ppl_zes_exso',_r,_r_nom)$2 || 0 ?};
: pomniejszenia
{? (~KST.PFZPCCZY & _np='3') | _em
|| __S[3]:=0
|| __S[3]:=
     {? _r_nom[440]<>0
     || 'wylicznie nowej podstawy -> nowa podstawa/stara podstawa * składki naliczone';
        {? _r_nom[753] || (_r_nom[753]-_r_nom[440])/_r_nom[753]*_r[765] || 0 ?}
        +
        {? KST.PFZPCCZY
        || {? _r_nom[754] || (_r_nom[754]-_r_nom[440])/_r_nom[754]*_r[767] || 0 ?}
        || 0
        ?}
     || _r[765]+{? KST.PFZPCCZY || _r[767] || 0 ?}
     ?}$2
?};
{? __S[2]<0 || __S[2]:=0 ?};
__Ch[16]:=__S[2];

{? __S[3]<0 || __S[3]:=0 ?};

:: koszty placy - infdp
__Ch[63]:=_r[500]-_r[440]-_r[151]-_r[152]
          +{? _r[440]>0
           || {? _r[753] || (_r[753]-_r[440])/_r[753]*_r[958] || 0 ?}
              +{? _r[753] || (_r[753]-_r[440])/_r[753]*_r[959] || 0 ?}
              +{? _r[754] || (_r[754]-_r[440])/_r[754]*_r[960] || 0 ?}
              +{? _r[981]
               || _fp:=(_r[981]-_r[440])/_r[981]*_r[982];
                  _fp
               || 0
               ?}
              +{? _r[981] || (_r[981]-_r[440])/_r[981]*_r[983] || 0 ?}
           || _r[958]+_r[959]+_r[960]+_r[983]+_r[982]
           ?};
__Ch[63]:=__Ch[63]$2;

: najnizsza krajowa na koniec roku
_nk:=exec('ust_nk','lista_licz',date(_rok-1,12,31),'NK');

: pulap intensywnosci
{? KST.PFZPCCZY
|| {? ~_em
   || _kwA:={? _np='3'
            || (KST.PFR_R_L*_proc*_nk)+_r[765]+_r[767]+_r[958]+_r[959]+_r[960]
            |? _np='2'
            || (KST.PFR_R_U*_proc*_nk)+_r[765]+_r[767]+_r[958]+_r[959]+_r[960]
            |? _np='1'
            || (KST.PFR_R_Z*_proc*_nk)+_r[765]+_r[767]+_r[958]+_r[959]+_r[960]
            || 0
            ?}
   || _kwA:={? _np='3' | _np='2' | _np='1'
            || _r[765]+_r[767]+_r[958]+_r[959]+_r[960]
            || 0
            ?}
   ?};
   _kwB:=__S[1]+{? _r_nom[440]>0 | _r_nom[151]>0
                  || {? _r_nom[753] || (_r_nom[753]-_r_nom[440]-_r_nom[151])/_r_nom[753]*_r[958] || 0 ?}
                    +{? _r_nom[753] || (_r_nom[753]-_r_nom[440]-_r_nom[151])/_r_nom[753]*_r[959] || 0 ?}
                    +{? _r_nom[754] || (_r_nom[754]-_r_nom[440]-_r_nom[151])/_r_nom[754]*_r[960] || 0 ?}
                  || _r[958]+_r[959]+_r[960]
                  ?};
   __S[7]:={? _kwA<_kwB || _kwA || _kwB ?}$2
|| {? ~_em
   || _kwA:={? _np='3'
            || (KST.PFR_R_L*_proc)+_r[960]
            |? _np='2'
            || (KST.PFR_R_U*_proc)+_r[765]+_r[958]
            |? _np='1'
            || (KST.PFR_R_Z*_proc)+_r[765]+_r[958]
            || 0
            ?}
   || _kwA:={? _np='3'
            || _r[960]
            |? _np='2'
            || _r[765]+_r[958]
            |? _np='1'
            || _r[765]+_r[958]
            || 0
            ?}
   ?};
   _kwB:=__S[1]+{? _r_nom[440]>0 | _r_nom[151]>0
                  || {? _r_nom[753] || (_r_nom[753]-_r_nom[440]-_r_nom[151])/_r_nom[753]*_r[958] || 0 ?}
                    +{? _r_nom[753] || (_r_nom[753]-_r_nom[440]-_r_nom[151])/_r_nom[753]*_r[959] || 0 ?}
                    +{? _r_nom[754] || (_r_nom[754]-_r_nom[440]-_r_nom[151])/_r_nom[754]*_r[960] || 0 ?}
                  || _r[958]+_r[959]+_r[960]
                  ?};
   __S[7]:={? _kwA<_kwB || _kwA || _kwB ?}$2
?};
: koniec
1


\wynwyp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: pkoso [2009+]
:: OPIS: Wyliczenie wynagrodzenia wyplaconego
::   WE: _a - tablica
::       _b - tablica
::  OLD: \wynwyp/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_r:=_a;
_r_nom:=_b;
_sk500:=_r_nom[500]-_r_nom[440]-_r_nom[151];
_skladki:={? _r_nom[440]<>0
          || 'wylicznie nowej podstawy -> nowa podstawa/stara podstawa * składki naliczone';
             {? _r_nom[753]
             || (_r_nom[753]-_r_nom[440])/_r_nom[753]*(_r[765]+_r[766])
             || 0
             ?}
             +
             {? _r_nom[754]
             || (_r_nom[754]-_r_nom[440])/_r_nom[754]*_r[767]
             || 0
             ?}
          || _r[765]+_r[766]+_r[767]
          ?};
{? _r_nom[500]-_r_nom[440]-_skladki<>_r_nom[780]
|| _sk780:=_sk500-_skladki;
   _sk784:={? _r_nom[500] || _sk500/_r_nom[500]*_r_nom[784] || 0 ?};
   _sk785:={? (_r_nom[500]+_r_nom[650])
           || _sk500/(_r_nom[500]+_r_nom[650])*_r_nom[785]
           || 0
           ?};
   _sk790:=((((_sk780-_sk784)$0)*_r[71]*0.01)-_sk785)$2;
   _sk791:=_sk500-_skladki;
   _sk792:=(_sk791*KST.PRKC*0.01)$2;
   _sk793:=(_sk791*KST.PRKO*0.01)$2;
   {? _sk790<_sk793
   || _sk793:=_sk792:=_sk790
   || {? _sk790<_sk792 || _sk792:=_sk790 ?};
      {? _sk790<_sk793 || _sk793:=_sk790 ?}
   ?};
   _podatek:=(_sk790-_sk793)$0;
   {? _podatek<0 || _podatek:=0 ?}
|| _podatek:=_r_nom[797];
   _sk792:=_r_nom[792]
?};
(_sk500-_skladki-_sk792-_podatek)


\get_skl
::----------------------------------------------------------------------------------------------------------------------
::  UTW: pkoso [2009+]
:: OPIS: Wyliczenie wynagrodzenia wypłaconego
::   WE: _a - data
::       _b - OSOBA
::       _c... - numery rubryk
::   WY: tablica z kwotami kolejnosc wartosci taka jak przy wywolaniu
::  OLD: \get_skl/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_rok:=_a~1;
_msc:=_a~2;
_ret:=obj_new(_-2);
{! _ii:=1..obj_len(_ret) |! _ret[_ii]:=0 !};
O.cntx_psh();
LS.cntx_psh();
P.cntx_psh();
O.index('LISTYPLA');
O.prefix(exec('ref_firma','ustawienia'),__F_ZATR.O,_rok,_msc);
{? O.first
|| {!
   |? {? KST.PFR_LIST='*' | KST.PFR_LIST*O.T().T | KST.PFR_LIST=''
      || LS.use(O.LT);
         LS.index('OSOBAKOD');
         LS.prefix(exec('ref_firma','ustawienia'),_b);
         {? LS.first
         || {!
            |? _rn:=LS.RB().RN;
               {! _ii:=3.._ |! {? _[_ii]=_rn || _ret[_ii-2]+=LS.KW ?} !};
               LS.next()
            !}
         ?};
         'uwzględniaj korekty składek';
         KORN.index('KOR_NAGU');
         P.index('PRACOSOB');
         P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P,_b);
         {? P.first()
         || {!
            |? KORN.prefix(O.RU,O.MU,P.ref());
               {? KORN.first() & ((-KORN.LT)=(-O.LT)) & (KOR.prefix(KORN.ref()); KOR.first())
               || {!
                  |? {! _ii:=3.._
                     |! {? _[_ii]=KOR.RU().RN
                        || _ret[_ii-2]+=KOR.SKL
                        |? _[_ii]=753 & KOR.RU().RN=765
                        || _ret[_ii-2]+=KOR.POD
                        ?}
                     !};
                     KOR.next()
                  !}
               ?};
               P.next()
            !}
         ?}
      ?};
      O.next()
   !}
?};
LS.cntx_pop();
P.cntx_pop();
O.cntx_pop();
{! _ii:=1..obj_len(_ret) |! {? _ret[_ii]<0 || _ret[_ii]:=0 ?} !};
_ret


\i_Niep
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Pobranie informacji wymiarze pracy z orzeczonym stopniem niepelnosprawnosci pracownika.
::   WE: _a - okres sprawozdawczy [MM-RRRR]
::  OLD: \i_Niep/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__wersja')<>type_of(0) ||__wersja:=0 ?};
_wyn:=0;
_xod:=_od:=date(#(_a+4),#(2+_a),1);
_xdo:=_do:=date(#(_a+4),#(2+_a),0);
__G[30]:=_G30:=0;
P_INFO.index('OD');
P_INFO.prefix(exec('ref_firma','ustawienia'),OSOBA.ref);

{? P_INFO.last
|| _stnp_od:=P_INFO.OD;
   _stnp_do:=date(0,0,0);
   {!
   |? {? (_wyn=0 | ~(_stnp_od=P_INFO.STNP_OD & _stnp_do=P_INFO.STNP_DO))
       & (2+P_INFO.TTUB().KOD)<>'04'
       & {? date(#(__okSp+4),#(2+__okSp),1)>=date(2011,03,01)
         || ~(P_INFO.PREM<>null & P_INFO.PREM().KOD='1' & P_INFO.STNP<>null & P_INFO.STNP().KOD<>'3')
         || 1
         ?}
       & P_INFO.STNP<>null
       & P_INFO.STNP().KOD<>'0'
       & P_INFO.STNP_OD<=_do
       & (P_INFO.STNP_DO>=_od | P_INFO.STNP_DO=date(0,0,0))
      ||
         _xod:={? P_INFO.STNP_OD=date(0,0,0)
                | P_INFO.STNP_OD<_od
               || _od
               || P_INFO.STNP_OD
               ?};
         _xdo:={? P_INFO.STNP_DO=date(0,0,0)
                | P_INFO.STNP_DO>_do
               || _do
               || P_INFO.STNP_DO
               ?};
         {? _xdo>_do || _xdo:=_do ?};
         _stnp_od:=_xod;
         _stnp_do:=_xdo;
         _G30:=exec('zatr_wymiar','!ppl_zes_exso',OSOBA.ref,_xod,_xdo);
         {? __DocT+7='INF-U-P'
         || 'Zbieranie informacji dla przypadku dokumentu INF-U-P';
            {? KST.PFZPCCZY=1
            || 'pracodawca wg art 25a ust 3 Ustawy - Zaklad pracy chronionej';
               {? P_INFO.SZCZNIEP='T'
               ||
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     __Ch[10]+=__G[31]
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     __Ch[11]+=__G[31]
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     __Ch[12]+=__G[31]
                  |? #P_INFO.STNP().KOD>3
                  || 'Nieokreślony'; _wyn:=1;
                     __Ch[13]+=__G[31]
                  ?}
               || 'normalny';
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     __Ch[4]+=__G[31]
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     __Ch[5]+=__G[31]
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     __Ch[6]+=__G[31]
                  |? #P_INFO.STNP().KOD>3
                  || 'Nieokreślony'; _wyn:=1;
                     __Ch[14]+=__G[31]
                  ?}
               ?}
            |? __G[27]>=25
            || 'pracodawca wg art 25a ust 4 Ustawy';
               {? P_INFO.SZCZNIEP='T'
               ||
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     __Ch[43]+=__G[31]
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     __Ch[42]+=__G[31]
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     __Ch[41]+=__G[31]
                  ?}
               || 'normalny';
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     __Ch[33]+=__G[31]
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     __Ch[32]+=__G[31]
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     __Ch[31]+=__G[31]
                  ?}
               ?}
            |? __G[27]<25
            || 'pracodawca wg art 25a ust 2 Ustawy';
               {? P_INFO.SZCZNIEP='T'
               ||
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     __Ch[40]+=__G[31]
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     __Ch[39]+=__G[31]
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     __Ch[38]+=__G[31]
                  ?}
               || 'normalny';
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     __Ch[30]+=__G[31]
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     __Ch[18]+=__G[31]
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     __Ch[17]+=__G[31]
                  ?}
              ?}
            ?}
         |? __DocT+7='INF-D-P'
         || 'Zbieranie informacji dla przypadku dokumentu INF-D-P';
            _num:=0;
            {? KST.PFZPCCZY=1
            || 'chronionej';
               {? P_INFO.SZCZNIEP<>'T'
               || 'szczegolne schorzenia';
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 51 || 10 ?}
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 52 || 11 ?}
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 53 || 12 ?}
                  ?}
               || 'normalny';
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 54 || 4 ?}
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 55 || 5 ?}
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 56 || 6 ?}
                  ?}
               ?}
            || 'normalny zakład';
               {? P_INFO.SZCZNIEP<>'T'
               || 'szczegolne schorzenia';
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 57 || 1 ?}
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 58 || 2 ?}
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 59 || 3 ?}
                  ?}
               || 'normalny';
                  {? P_INFO.STNP().KOD='1'
                  || 'Lekki'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 60 || 7 ?}
                  |? P_INFO.STNP().KOD='2'
                  || 'Umiarkowany'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 61 || 8 ?}
                  |? P_INFO.STNP().KOD='3'
                  || 'Znaczny'; _wyn:=1;
                     _num:={? __wersja=6 & P_INFO.PREM().KOD='1' || 62 || 9 ?}
                  ?}
               ?}
            ?};
            {? _num>0 || __Ch[_num]+=_G30$3; __G[30]+=_G30$3 ?}
         ?}
      ?};
      _pod:=_xod-1;
      P_INFO.prev
   !}
?};
_wyn


\zero_ch
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zerowanie tablicy __Ch.
::  OLD: \zero_ch/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{! _xc:=1..obj_len(__Ch)
|! __Ch[_xc]:={? _xc=49 | _xc=50
              || date(0,0,0)
              || 0
              ?}
!};
~~


\zero_s
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zerowanie tablicy __S.
::  OLD: \zero_s/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{! _xc:=1..obj_len(__S)
|! __S[_xc]:=0
!};
~~


\clear_all
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Czysciciel globalny.
::  OLD: \clear_all/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
exec('cleaner','!ppl_zes_exso');
{? var_pres('__nSOD_N')>0
|| SOD_N.index('SOD_N1');
   SOD_N.ndx_drop(__nSOD_N);
   VAR_DEL.delete('__nSOD_N')
?};
VAR_DEL.delete('__dataZl','__okSp','__okWp','__DocT','__DocTN','__G','__Ch','__S','__Header','__Grupa');
VAR_DEL.delete('__ileP','__Close','__IDP','__ref_p','__cas','__Szatr');
~~


\cleaner
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Czysciciel podreczny.
::  OLD: \cleaner/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('__idTypu','__werTyp','__wersja')


\eol
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: End Of Line.
::  OLD: \eol/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
'
'


\f_save
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zapis do pliku z konwersja na UTF-8.
::   WE: _a - uchwyt pliku
::       _b - tekst
::  OLD: \f_save/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
fwrite(_a,maz_utf8(_b))


\f_sum
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Sumowanie przyrostowe (uwzgledniane sa jedynie dokumenty w paczkach o statusie zamknietym).
::   WE:   _a - wskazanie na naglowek dokumentu SOD_N.ref
::         _b - numer rubryki
::              w przypadku podania rubryki z wartoscia nieliczbowa formula zwraca 0
::         _c - data pierwszego okresu (zliczany)
::         _d - data ostatniego okresu (zliczany)
::        [_e]- typ dokumentu sumowanego(zgodny z opisem SOD_S.DOK) [parametr opcjonalny]
::        [_f]- wszystkie osoby (1 - tak, 0 lub brak - nie)
::
::   WY: Zsumowana wartosc
::
::  UWAGA: ::   Funkcja zwraca 0 - w przypadku nie podania któregos z parametrow
::                                 badz podania go nieprawidlowo (uniemozliwiajac sumowanie).
::  OLD: \f_sum/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=0;
_allpe:={? _>5 & type_of(_f)=type_of(0) || _a || 0 ?};
{? type_of(_a)<>type_of(SOD_N.ref)
 | type_of(_b)<>type_of(0)
 | type_of(_c)<>type_of(date)
 | type_of(_d)<>type_of(date)
|| return(0) ?};

_od:=date(_c~1,_c~2,0);
_do:=date(_d~1,_d~2,0);

_ignoruj:={? date(#(__okSp+4),#(2+__okSp),0)=_do
          || 1
          || 0
          ?};

SOD_P.cntx_psh();
SOD_N.cntx_psh();
SOD_S.cntx_psh();
SOD.cntx_psh();
SOD_P.prefix();
SOD.prefix();
_xba:={? _ignoruj
      || 'SOD_N6'
      || 'SOD_N5'
      ?};
SOD_N.index(_xba);
SOD_N.prefix();
{? SOD_N.seek(_a)
||
   _pesel:={? _allpe || SOD_N.PESEL || '' ?};
   _sod_s:=SOD_N.SOD_S;
   {? _>4 & type_of(_e)=type_of('')
   || SOD_S.prefix();
      {? SOD_S.find_tab(1,'DOK',,'=',_e)
      || _sod_s:=SOD_S.ref
      ?}
   ?};
   {!
   |? {? _ignoruj
      || SOD_N.prefix(_sod_s,_od~1,_od~2,SOD_P.ID,_pesel)
      || SOD_N.prefix(_sod_s,'T',_od~1,_od~2,SOD_P.ID,_pesel)
      ?};
      {? SOD_N.first
      || {!
         |? {? $SOD_N.SOD_P().R<>(SOD.name+4)
            || SOD.use('sod'+$SOD_N.SOD_P().R);
               SOD.prefix()
            ?};
            _odczyt:=exec('d_read','!ppl_zes_exso',SOD_N.ref,_b);
            {? type_of(_odczyt)=type_of(0)
            || _wyn+=_odczyt
            ?};
            SOD_N.next
         !}
      ?};
      _od:=_od+1;
      _od:=date(_od~1,_od~2,0);
      _od<=_do
   !}
?};
SOD.cntx_pop();
SOD_S.cntx_pop();
SOD_N.cntx_pop();
SOD_P.cntx_pop();
_wyn


\f_open
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Otwarcie pliku deklaracji.
::   WE: _a - nazwa pliku
::   WY: stan otwarcia pliku
:: ~OST: INFOPEN
::  OLD: \f_open/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? type_of(_a)=type_of('')  & +_a>0
|| fopen('@'+_a,'bw')
|| ~~
?}


\f_reblock
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zmiana statusu blokady paczki.
::  OLD: \f_reblock/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? SOD_P.ZA<>'T'
||
   {? FUN.ask('Zablokować paczkę do edycji?'@)
   || {? ( SOD_P.ZA:='T'; ~SOD_P.put() )
      || FUN.emsg('Operacja zakończona niepowodzeniem.'@)
      ?}
   ?}
|? ( _baseP:=SOD_P.ref; SOD_P.find_tab(,'ID',,'>',SOD_P.ID) )
|| SOD_P.seek(_baseP);
   FUN.info('Paczka była korygowana.'@)
||
   _ask:={? SOD_P.DW<>date(0,0,0)
         || 'Paczka już wysłana.\nNa pewno odblokować?'@
         || 'Odblokować paczkę do edycji?'@
         ?};
   {? FUN.ask(_ask)
   || {? ( SOD_P.ZA:='N'; ~SOD_P.put() )
      || FUN.emsg('Operacja zakończona niepowodzeniem.'@)
      ?}
   ?}
?}


\gen_id
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Generowanie identyfikatora paczki dokumentow.
::   WY: [String] - identyfikator paczki
::  OLD: \gen_id/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
($(date~1)+(('00'+$(date~2))+2)+(('00'+($(date()~3)))+2))+
 ((('00'+$(time~1))+2)+(('00'+$(time~2))+2)+(('00'+$(time~3))+2))


\d_save
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zapis danych rekordu do SOD.
::   WE: _a  - Uchwyt naglowka
::       _b  - nr rubryki formularza
::       _c  - opis pola rubryki formularza
::       _d  - informacja do zapisania
::      [_e] - informacja ('A' lub brak - wyliczona automatycznie,
::                         'R' - podana przez operatora,
::                         'B' - blokada - pozycja nie może być modyfikowana)
::      [_f] - precyzja
::      [_g] - pozycja sumowania do naglowka
::  OLD: \d_save/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_e:={? var_pres('_e')=type_of('') || _e || 'A' ?};
_f:={? var_pres('_f')=type_of(0) || _f$0 ?};
_g:={? var_pres('_g')=type_of(0) || _g$0 ?};

_tof:=type_of(_d);
{? _tof=1         || _typ:='R';       'liczba rzeczywista'
|? _tof=2         || _typ:='S';       'String'
|? _tof=4         || _typ:='D';       'Data'
|? _tof=7         || _typ:='F';       'reFerence - typ zlaczeniowy'
                  || _typ:='';        'Inne - nieobsluzone'
?};
SOD.prefix();
SOD.blank(1);
SOD.SOD_N:=_a;
SOD.R:=_typ;
SOD.NR:=_b;
SOD.OPIS:=_c;
SOD.WAR:=exec('typeS','!ppl_zes_exso',_d,{? _f>0 || _f ?});
SOD.AUTO:=_e;
SOD.PR:=_f;
SOD.SUM:=_g;
SOD.add()


\d_act
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zapis danych rekordu do SOD.
::   WE: _a  - ref naglowka
::       _b  - nr rubryki formularza
::      [_c] - opis pola rubryki formularza
::       _d  - informacja do zapisania
::      [_e] - informacja ('A' lub brak - wyliczona automatycznie, 'R' - podana przez operatora, 'N' - nie zmieniaj)
::      [_f] - precyzja
::      [_g] - pozycja sumowania do naglowka
::      [_h] - wskazanie na inny typ dokumentu w tej samej paczce
::
:: przykladowe wywolanie: exec('d_act','!ppl_zes_exso',SOD_N.ref(),50,,515.99,,,,'INF-D-P')
::  OLD: \d_act/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? _>2 & type_of(_c)<>type_of('') || _c:='' ?};
_e:={? _>4 & type_of(_e)=type_of('') || _e || 'A' ?};
_f:={? _>5 & type_of(_f)=type_of(0) || _f || -1 ?};
_g:={? _>6 & type_of(_g)=type_of(0) || _g || -1 ?};
{? _>7 & type_of(_h)=type_of('')
||
   SOD_N.cntx_psh();
   SOD_N.index('SOD_N3');
   SOD_N.prefix(SOD_N.SOD_P,_h,_h);
   {? SOD_N.find_tab(,'PESEL',,'=',SOD_N.PESEL)
   || _a:=SOD_N.ref()
   || SOD_N.cntx_pop(); return(0)
   ?};
   SOD_N.cntx_pop()
?};
_tof:=type_of(_d);
{? _tof=1         || _typ:='R';       'liczba rzeczywista'
|? _tof=2         || _typ:='S';       'String'
|? _tof=4         || _typ:='D';       'Data'
|? _tof=7         || _typ:='F';       'reFerence - typ zlaczeniowy'
                  || _typ:='';        'Inne - nieobsluzone'
?};
_wyn:=0;
SOD.cntx_psh();
SOD.index('SODN');
SOD.prefix;
{? SOD.find_key(_a,_b)
|| SOD.SOD_N:=_a;
   SOD.R:=_typ;
   SOD.NR:=_b;
   {? +_c || SOD.OPIS:=_c ?};
   SOD.WAR:=exec('typeS','!ppl_zes_exso',_d,_f);
   {? _e<>'N' || SOD.AUTO:=_e ?};
   {? _f>=0 || SOD.PR:=_f ?};
   {? _g>=0 || SOD.SUM:=_g ?};
   _wyn:=SOD.put()
?};
SOD.cntx_pop();
_wyn


\d_read
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Odczyt danej rubryki dokumentu.
::   WE: _a - uchwyt naglowka
::       _b - nr rubryki formularza
::      [_c]- wartosc oczekiwana (w przypadku nieodczytania rubryki, jesli nie podane zwrocone zostanie '')
::   WY: odczytana informacja
::  OLD: \d_read/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? SOD.find_tab(0,'SOD_N',,'=',_a,'NR',,'=',_b)
|| exec('Stype','!ppl_zes_exso',SOD.WAR,SOD.R)
|| {? _>2 || _c || '' ?}
?}


\erase_p
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Usuniecie paczki dokumentow wraz z pozycjami.
::  OLD: \erase_p/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=0;
SOD_N.index('SOD_N1');
SOD_N.prefix(SOD_P.ref);
_idp:=SOD_P.ID;
{? SOD_N.first
|| {!
   |? {? exec('erase_d','!ppl_zes_exso',SOD_N.SOD_P)
      || SOD_N.del(1,1);
         SOD_N.size
      || SOD_N.next
      ?}
   !}
?};
{? ~SOD_N.size
||
   SOD_P.del(1,1);
   _wyn:=~SOD_P.size
?};
{? _wyn & var_pres('__DOC')>100
|| {? SOD_P.size
   || {!
      |? __DOC.del(1,1);
         __DOC.size
      !}
   || __DOC.erase()
   ?}
?};
_wyn


\erase_d
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Usuniecie rekordow z SOD.
::   WE: _a - wskazanie na paczke (SOD_P.ref)- dla usuniecia wszystkich pozycji przypisanych do paczki
::            badz naglowek(SOD_N.ref() - dla usuniecia wszystkich pozycji przypisanych do naglowka
::       _b - nr rubryki formularza (jesli nie podano, wszystkie rekordy dokumentu)
::  OLD: \erase_d/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_wyn:=1;
{? (6+($_a))='sod_n '
|| SOD.index('SODN');
   SOD.prefix(_a)
|? (6+($_a))='sod_p '
|| SOD.index('SODP');
   SOD.prefix(_a)
|| _wyn:=0
?};

{? SOD.first()
|| {!|? SOD.del() !};
   _wyn:=~SOD.size
?};
_wyn


\typeS
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Konwersja do stringa.
::   WE: _a - co konwertowac
::       [_b] - precyzja
::   WY: String do zapisania
::  OLD: \typeS/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_b:={? var_pres('_b')=type_of(0) || {? _b<0 || _b:=0 ?}; _b$0 ?};
{? _>=1
||
   {? type_of(_a)=type_of(date()) || _a$1
   |? type_of(_a)=type_of('')     || _a
   |? type_of(_a)=type_of(0)      || form(_a,,_b)
   || ''
   ?}
|| ''
?}


\Stype
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Konwersja ze stringa na wlasciwy typ.
::   WE: _a - co konwertowac
::       _b - na co konwertowac (String, Real, Integer, date)
::   WY: String do zapisania
::  OLD: \Stype/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? _=2
|| {? _b='D'
   || date(#(4+_a),#(2+(_a+5)),#(_a+2))
   |? _b='S'
   || _a
   |? _b='R'
   || _sx:=exec('txt_cut','!ppl_zes_exso',_a,'.');
      #exec('txt_mv','!ppl_zes_exso',_sx,',','.')
   |? _b='I'
   || _sx:=exec('txt_cut','!ppl_zes_exso',_a,'.');
      (#exec('txt_mv','!ppl_zes_exso',_sx,',','.'))$0
   || null
   ?}
|| null
?}


\sod_s
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Obsluga typow dokumentow.
::   WE: _a - typ dokumentu (zawartosc zmiennej __DocT)
::   WY: stan powodzenie operacji
::       0 - niepowodzenie, >0 - sukces
::  OLD: \sod_s/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
SOD_S.prefix();
_wyn:=0;
{? SOD_S.find_tab(,'DOK',,'=',_a)
|| _wyn:=SOD_S.ref()
|| 'dodajemy typ do slownika';
   SOD_S.blank();
   SOD_S.DOK:=_a;
   SOD_S.NAG:={? _a='INF-D-P' | _a='WND2II'
              || 'WND'
              |? _a='INF-U-P' | _a='WNU_II'
              || 'WNU'
              || ''
              ?};
   _wyn:=SOD_S.add()
?};
_wyn


\sod_p
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Ograniczenie dziedziny paczek do zadanego zakresu.
::   WE: _a - identyfikator paczki
::       _b - korekta ('K'), zwykla ('Z'), nie podanie parametru (wszystkie);
::   WY: stan powodzenie operacji
::       0 - niepowodzenie, >0 - sukces
::  OLD: \sod_p/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? _=1 || _b:='' ?};
SOD_P.index('SOD_I');
SOD_P.prefix(_a,_b);
{? ~SOD_P.size
||
   SOD_P.blank();
   SOD_P.ID:=_a;
   SOD_P.R:=#(__okSp+4);
   SOD_P.MP:=#(2+__okSp);
   SOD_P.MK:=#(2+__okSp);
   SOD_P.DW:=__dataZl;
   SOD_P.ZA:='N'; 'N - otwarte, T - zamknięte';
   SOD_P.KOR:={? _b='' || 'Z' || 'K' ?};
   SOD_P.DOC:='SODIR';
   SOD_P.add
?};
SOD_P.size


\count
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Zliczenie zalacznikow w paczce.
::   WE: _a - dokument (symbol)
::            podliczana jest paczka zgodna z biezacym rekordem SOD_N
::   WY: liczba dokumentow
::  OLD: \count/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_xbl:=sql('select count(SOD_S.DOK) as IL from SOD_N '+
      'join SOD_P join SOD_S  '+
      'where SOD_P.ID=\':_a\' and SOD_S.DOK=\':_b\' '+
      'order by 1',SOD_N.SOD_P().ID,_a);
{? _xbl.first
|| _xbl.IL
|| 0
?}


\zalaczniki
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Uzupelnienie listy obslugiwanych zalacznikow.
::   WE: _a - paczka
::  OLD: \zalaczniki/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__DOC.prefix();
{? SOD_N.SOD_S().DOK=''
|| SOD_N.find_tab(,'SOD_P','ID','=',_a)
?};
{? __DocTN='WND'
 | __DocTN='WNU'
 | (__DocTN=''
   & ( SOD_N.SOD_S().DOK='WND'
     | SOD_N.SOD_S().DOK='WNU'
     | SOD_N.SOD_S().NAG='WND'
     | SOD_N.SOD_S().NAG='WNU'
     )
   )
|| {? (_dc:='WND'; ~__DOC.find_tab(,'DOK',,'=',_dc,'ID',,'=',_a))
   || __DOC.ID:=_a; __DOC.NAG:=''; __DOC.DOK:=_dc; __DOC.LP:=0; __DOC.add(1) ?};

   {? (_dc:='INF-D-P'; ~__DOC.find_tab(,'DOK',,'=',_dc,'ID',,'=',_a))
   || __DOC.ID:=_a; __DOC.NAG:='WND'; __DOC.DOK:=_dc; __DOC.LP:=0; __DOC.add(1) ?};

   {? exec('przed2009','!ppl_zes_exso')
    & (_dc:='WND2II';  ~__DOC.find_tab(,'DOK',,'=',_dc,'ID',,'=',_a))
   || __DOC.ID:=_a; __DOC.NAG:='WND'; __DOC.DOK:=_dc; __DOC.LP:=0; __DOC.add(1) ?};

   {? exec('przed2009','!ppl_zes_exso')
   ||
      {? (_dc:='WNU'; ~__DOC.find_tab(,'DOK',,'=',_dc,'ID',,'=',_a))
      || __DOC.ID:=_a; __DOC.NAG:=''; __DOC.DOK:=_dc; __DOC.LP:=0; __DOC.add(1) ?};

      {? (_dc:='INF-U-P'; ~__DOC.find_tab(,'DOK',,'=',_dc,'ID',,'=',_a))
      || __DOC.ID:=_a; __DOC.NAG:='WNU'; __DOC.DOK:=_dc; __DOC.LP:=0; __DOC.add(1) ?};

      {? (_dc:='WNU_II'; ~__DOC.find_tab(,'DOK',,'=',_dc,'ID',,'=',_a))
      || __DOC.ID:=_a; __DOC.NAG:='WNU'; __DOC.DOK:=_dc; __DOC.LP:=0; __DOC.add(1) ?}
   ?}

?};
1


\sr_zatrudnienie
::----------------------------------------------------------------------------------------------------------------------
::  UTW: pkoso [2009+]
:: OPIS: Wyliczenie osob zatrudnionych przecietnie w okresie (srednia) wymiar zatrudnienia.
::   WE: _a - date poczatek badanego okresu [domyslnie poczatek okresu]
::       _b - date koniec badanego okresu   [domyslnie koniec okresu]
::  OLD: \sr_zatrudnienie/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_pocz:={? var_pres('_a')=type_of(date) || _a || date(#(__okSp+4),#(2+__okSp),1) ?};
_kon:={? var_pres('_b')=type_of(date) || _b || date(#(__okSp+4),#(2+__okSp),0) ?};
_ilosc:=exec('zatrdzien','!ppl_zes_exso',_pocz,_kon);
_ilosc


\zatrdzien
::----------------------------------------------------------------------------------------------------------------------
::  UTW: pkoso [2010]
:: OPIS: Wyliczenie osob zatrudnionych przecietnie w okresie (srednia) wymiar zatrudnienia.
::   WE: _a - data od
::       _b - data do
::  OLD: \zatrdzien/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a') <> 4 || return(0) ?};
{? var_pres('_b') <> 4 || return(0) ?};

_sql:='select CASE WHEN H.OD < to_date(:_a) THEN to_date(:_a) ELSE H.OD END OD, '+
             'CASE WHEN H.DO IS NULL OR H.DO > to_date(:_b) THEN to_date(:_b) ELSE H.DO END DO, H.RWY WY '+
             'FROM P join F_ZATR using(P.F_ZATR,F_ZATR.REFERENCE) join H';
_sql+=' where F_ZATR.KOD=\''+__F_ZATR.P+'\' and H.OD<=to_date(:_b) and (H.DO>=to_date(:_a) or H.DO IS NULL) '+
             'and P.FIRMA=:_c';
_wynik:=sql(_sql,_a,_b,exec('ref_firma','ustawienia'));

:: bezplatny, wychowawczy, wojsko, sw. rehabilitacyjne
_rub:='';
_rub+={? _rub='' || '' || ',' ?}+__RUB.sys_sql(1122,_a);
_rub+={? _rub='' || '' || ',' ?}+__RUB.sys_sql(133,_a);
_rub+={? _rub='' || '' || ',' ?}+__RUB.sys_sql(1323,_a);
_rub+={? _rub='' || '' || ',' ?}+__RUB.sys_sql(1222,_a);
_sql:='select N.OD OD, N.DO DO, H.RWY WY '+
             'FROM N join P join F_ZATR using(P.F_ZATR,F_ZATR.REFERENCE) join H join R ';
_sql+=' where F_ZATR.KOD=\''+__F_ZATR.P+'\' and N.OD<=to_date(:_b) and (N.DO>=to_date(:_a)) and N.KOR=\'N\' '+
      'and R.RN in (:_c) and H.OD<=N.OD and (H.DO>=N.OD or H.DO IS NULL) and P.FIRMA=:_d';
_bezplat:=sql(_sql,_a,_b,_rub,exec('ref_firma','ustawienia'));

_sr:=0;
_tmp:=obj_new(_b-_a+1);
{! _i:=1 .. _b-_a+1
|! _tmp[_i]:=0
!};
{? _wynik.first
|| {!
   |? {! _i:=_wynik.OD-_a+1 .. _wynik.DO-_a+1
      |! _tmp[_i]+=_wynik.WY
      !};
      _wynik.next
   !}
?};
{? _bezplat.first
|| {!
   |? {! _i:=_bezplat.OD-_a+1 .. _bezplat.DO-_a+1
      |! _tmp[_i]-=_bezplat.WY
      !};
      _bezplat.next
   !}
?};
{! _i:=1 .. _b-_a+1
|! _sr+=_tmp[_i]
!};
_sr/=_b-_a+1;
_sr


\sr_zatr_niep
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Wyliczenie osob niepelnosprawnych zatrudnionych przecietnie w okresie (srednia) wymiar zatrudnienia.
::   WE: _a  - poczatek badanego okresu [date]
::      [_b] - koniec badanego okresu   [date]
::       _c  - metoda ustalanie sredniego zatrudnienia [0 - pelna, 1 - szybka]
::      [_d] - ustalenie zaokraglenia do 3 miesjc [3 lub niepodany]
::  OLD: \sr_zatr_niep/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a') <> 4 || return(0) || _a:=date(_a~1,_a~2,1) ?};
{? var_pres('_b') <> 4 || _b:=date(_a~1,_a~2,0) || _b:=date(_b~1,_b~2,0) ?};
{? var_pres('_d')=type_of(1) & _d=3 || _d || _d:=2 ?};
_tmp:=obj_new(3);
_tmp[1]:=_tmp[2]:=_tmp[3]:=0;
{? var_pres('__PFRONZAT')>100 || obj_del(__PFRONZAT) ?};
__PFRONZAT:=obj_new(12);
{! _i:=1 .. 12 |!
   __PFRONZAT[_i]:=0
!};
exec('zatrudnienie','pfron',_a,_b,_c,_d);
{! _i:=2 .. 12 |!
   {? _i<>7
   ||
      {? _i>=2 & _i<=6
      || _tmp[1]+=__PFRONZAT[_i]; 'Wymiar zatrudnienia'
      || _tmp[2]+=__PFRONZAT[_i]; 'Liczba zatrudnionych'
      ?}
   ?}
!};
_tmp[3]+=__PFRONZAT[1];
{? var_pres('__PFRONZAT')>100 || obj_del(__PFRONZAT); &__PFRONZAT ?};
_tmp


\srzatr_niep_new
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [11.22]
:: OPIS: Wyliczenie osob niepelnosprawnych zatrudnionych przecietnie w okresie (srednia) wymiar zatrudnienia.
::       dla potrzeb ustalenia efektu zachety
::   WE: _a  - poczatek badanego okresu [date]
::      [_b] - koniec badanego okresu   [date]
::      [_c] - ktory wynik zwrocic 1 - wymiar zatrudnienia, 2 - liczba zatrudnionych, 3 - sr. zatr. w badanym okresie
::  OLD: \srzatr_niep_new/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a') <> 4 || return(0) || _pocz:=date(_a~1,_a~2,1) ?};
{? var_pres('_b') <> 4 || _kon:=date(_pocz~1,_pocz~2,0) || _kon:=date(_b~1,_b~2,0) ?};
_rwyn:={? var_pres('_c')=type_of(0) & (_c=1 | _c=2 | _c=3)  || _c || 1 ?};
{? var_pres('__Szatr')<>type_of(SYSLOG)
|| __Szatr:=tab_tmp(2,'ROK','INTEGER','Rok',
                      'MIE','INTEGER','Miesiąc',
                      'WYM','REAL','Średnia liczba zatrudnionych niep. w etatach',
                      'ZAT','REAL','Średnia liczba zatrudnionych niep. w osobach',
                      'SUM','REAL','Średnia liczba zatrudnionych w etatach')
?};

_ile:=_wyn:=0;
_od:=_pocz;
_do:=_kon;
{!
|? _rok:=_od~1;
   _mie:=_od~2;
   __Szatr.prefix(_rok,_mie);
   {? ~__Szatr.first
   || VAR_DEL.delete('__PFRONZAT');
      __PFRONZAT:=obj_new(12);
      {! _i:=1 .. 12 |!
         __PFRONZAT[_i]:=0
      !};
      exec('zatrudnienie','pfron',date(_rok,_mie,1),date(_rok,_mie,0),0);

      __Szatr.blank(1);
      __Szatr.ROK:=_rok;
      __Szatr.MIE:=_mie;
      {! _i:=2 .. 12
      |!
         {? _i<>7
         ||
            {? _i>=2 & _i<=6
            || __Szatr.WYM+=__PFRONZAT[_i]; 'Wymiar zatrudnienia'
            || __Szatr.ZAT+=__PFRONZAT[_i]; 'Liczba zatrudnionych'
            ?}
         ?}
      !};
      __Szatr.SUM+=__PFRONZAT[1];
      __Szatr.add(1)
   ?};
   _od:=date(_rok,_mie,0)+1;
   _od<_do
!};
VAR_DEL.delete('__PFRONZAT');

_od:=_pocz;
_do:=_kon;
{!
|? _ile+=1;
   _rok:=_od~1;
   _mie:=_od~2;
   __Szatr.prefix(_rok,_mie);
   {? __Szatr.first
   || _wyn+={? _rwyn=1
            || __Szatr.WYM
            |? _rwyn=2
            || __Szatr.ZAT
            || __Szatr.SUM
            ?}
   ?};
   _od:=date(_rok,_mie,0)+1;
   _od<_do
!};
({? _rwyn=3 || _wyn || _rwyn/_ile ?})$3


\przed2009
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Kontrola czy dokumentoy grupy WNU oraz WNDczII ma byc tworzona
::   WE: __okSp - zmienna globalna
::   WY: 1 lub 0
::  OLD: \przed2009/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
date(#(__okSp+4),#(2+__okSp),0)<=date(2008,12,0)


\przenumerowanie
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Przenumerowanie dokumentow
::   WE: Biezacy kontekst okna dokumentow, wymagane zmienne globalne
::  OLD: \przenumerowanie/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
SOD.cntx_psh();
SOD.prefix();
SOD_N.cntx_psh();
_wer:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0,0);
_rubryka:={? (__DocT='INF-D-P' & _wer=4) |  __DocT='INF-U-P'
          || 23
          |? __DocT='INF-D-P' & (_wer=5 | _wer=6 | _wer=7 | _wer=8)
          || 20
          || 0
          ?};
{? _rubryka>0
||
   SOD_N.index('SOD_N3');
   SOD_N.prefix(SOD_P.ref,__DocT,__DocT);
   {? SOD_N.first()
   || _lp:=1;
      {!|?
         exec('d_act','!ppl_zes_exso',SOD_N.ref(),_rubryka,,_lp,'N');
         _lp+=1;
         SOD_N.next
      !}
   ?}
?};
SOD_N.cntx_pop();
SOD.cntx_pop()


\zatrudnienie
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
:: OPIS: Pobranie informacji o dacie zatrudnienia i zwolnienia pracownika
::   WE: _a - OSOBA.ref
::   WY: zmienne globalne
::       __Ch[49] - data zwolnienia
::       __Ch[50] - data zatrudnienia
::  OLD: \zatrudnienie/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
__Ch[49]:=__Ch[50]:=date(0,0,0);
P.cntx_psh();
P.index('PRACOSOB');
P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P,_a);
{? P.size() & P.last()
||
   __Ch[50]:=P.DZA;
   __Ch[49]:={? P.DZ=date(0,0,0) || date(9999,12,31) || P.DZ ?};

   {!|?
      _pod:=P.DZA;
      _pdo:={? P.DZ=date(0,0,0) || date(9999,12,31) || P.DZ ?};
      {? _pdo>__Ch[50]-1 & _pod<__Ch[50]
      || __Ch[50]:=_pod
      ?};
      {? _pod<=__Ch[49]+1 & _pdo>__Ch[49]
      || __Ch[49]:=_pdo
      ?};
      P.prev()
   !};

   {? __Ch[49]=date(9999,12,31)
   || __Ch[49]:=date(0,0,0)
   ?}
?};
P.cntx_pop();
1


\zatr_wymiar
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2010]
::       RWR [12.30]
:: OPIS: Przecietny miesieczny wymiar czasu pracy
::       (ustalany jako iloczyn wymiaru czasu pracy pracownika oraz ilorazu liczby dni pozostawania w zatrudnieniu
::        u pracodawcy i liczby dni w okresie sprawozdawczym).
::
::   WE: UWAGA: Brak walidacji danych wejsciowych - zaklada sie, iz przekazane informacje spelniaja opisane kryteria
::       _a - OSOBA.ref
::       _b - data od niepelnosprawnosci
::       _c - data do niepelnosprawnosci (jesli _b to _c obowiazkowe)
::             (daty niepelnosprawnosci musza zawierac sie w okresie przekazanym __okSp;
::              w przypadku, gdy niepelnosprawnosc zaczyna sie przed poczatkiem tego okresu, przekazujemy
::              tu poczatek okresu okreslonego w zmiennej __okSp, analogicznie gdy koniec niepelnosprawnosci wykracza
::              poza wspomniany okres)
::       wymagane zmienne globalne
::   WY: _G30 - wymiar zatrudnienia
::       __G[31] - liczba dni przepracowanych
::  OLD: \zatr_wymiar/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_osoba:=_a;
_od:=date(#(__okSp+4),#(2+__okSp),1);
_do:=date(#(__okSp+4),#(2+__okSp),0);
_td:=type_of(_od);
_odnie:={? var_pres('_b')=_td || _b || _od ?};
_donie:={? var_pres('_c')=_td || _c || _do ?};
_G30:=__G[31]:=0;

_d0:=date(0,0,0);
P.cntx_psh();
P.index('PRACOSOB');
P.prefix(exec('ref_firma','ustawienia'),'P',_osoba);
{? P.first()
|| H_ZM.cntx_psh();
   H.cntx_psh();
   H.index('_HISTDAT');
   N.cntx_psh();
   N.index('NIPRACNB');

   _ile:=_donie-_odnie+1;
   _dni:=obj_new(_ile);
   _wym:=obj_new(_ile);

   _tbezpl:=__RUB.sys_rub(112,_do);
   _twych:=__RUB.sys_rub(133,_do);

   {!
   |? {? P.DZA<=_donie & (P.DZ=_d0 | _odnie<=P.DZ)
      || {! _lp:=1.._ile |! _dni[_lp]:=_wym[_lp]:=0 !};

         H.prefix(P.ref());
         {? H.last()
         || {!
            |?
               {? H.OD<=_donie & (H.DO=_d0 | _odnie<=H.DO)
               || _dod:={? _odnie<H.OD || H.OD || _odnie ?};
                  _ddo:={? H.DO=_d0 | _donie<H.DO || _donie || H.DO ?};
                  {! _lp:=(_dod-_odnie+1)..(_ddo-_odnie+1)
                  |! _wym[_lp]:=H.WY;
                     _dni[_lp]+=1
                  !}
               ?};
               H.prev() & (H.DO=_d0 | _odnie<=H.DO)
            !}
         ?};

         {? _tbezpl.first()
         || {!
            |? N.prefix('N',P.ref(),_tbezpl.RN);
               {? N.last()
               || {!
                  |? {? N.OD<=_donie & _odnie<=N.DO
                     || _dod:={? _odnie<N.OD || N.OD || _odnie ?};
                        _ddo:={? N.DO<_donie || N.DO || _donie ?};
                        {! _lp:=(_dod-_odnie+1)..(_ddo-_odnie+1)
                        |! _dni[_lp]-=1
                        !}
                     ?};
                     N.prev() & _odnie<=N.DO
                  !}
               ?};
               _tbezpl.next()
            !}
         ?};
         {? _twych.first()
         || {!
            |? N.prefix('N',P.ref(),_twych.RN);
               {? N.last()
               || {!
                  |? {? N.OD<=_donie & _odnie<=N.DO
                     || _dod:={? _odnie<N.OD || N.OD || _odnie ?};
                        _ddo:={? N.DO<_donie || N.DO || _donie ?};
                        {! _lp:=(_dod-_odnie+1)..(_ddo-_odnie+1)
                        |! _dni[_lp]-=1
                        !}
                     ?};
                     N.prev() & _odnie<=N.DO
                  !}
               ?};
               _twych.next()
            !}
         ?};
         {! _lp:=1.._ile
         |! __G[31]+=_dni[_lp];
            _G30+=_dni[_lp]*_wym[_lp]/(_do~3)
         !}

      ?};
      P.next() & P.DZA<=_donie
   !};

   N.cntx_pop();
   H.cntx_pop();
   H_ZM.cntx_pop()

?};
P.cntx_pop();
_G30


\kolor_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Wywolanie raportu.
::  OLD: \kolor_poz/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? SOD.AUTO='R'
|| 'SODIRPOZ#02'
|? SOD.AUTO='B'
|| 'SODIRPOZ#01'
?}


\raport
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [2009+]
:: OPIS: Wywolanie raportu.
::  OLD: \raport/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
rep_exec('ppl_sodir')


\zatr_niep_new
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [11.22]
:: OPIS: Obliczenie sredniego zatrudnienia wg etatow i osob z uwzglednieniem
::       osob niepelnosprawnych
::   WE: _a - data poczatku okresu
::       _b - data konca okresu
::   WY: tablica _Wynik: 1-wymiar pelnosprawnych, 2-niepelnosprawnych
::  OLD: \zatr_niep_new/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_Wynik:=obj_new(2);
{! _i:=1..obj_len(_Wynik) |! _Wynik[_i]:=0 !};
{? var_pres('_a')<>4 || return(_Wynik) ?};
{? var_pres('_b')<>4 || return(_Wynik) ?};
_ile_dni:=_b-_a+1;
_tmp:=obj_new(3);
{! _i:=1..obj_len(_tmp) |! _tmp[_i]:=obj_new(_ile_dni) !};
H.cntx_psh;
H.index('_HISTKOD');
N.cntx_psh;
N.index('NIEOBECN');
P_INFO.cntx_psh;
P_INFO.index('OD');
P.cntx_psh;
P.index('PRACOSOB');
P.prefix(exec('ref_firma','ustawienia'),__F_ZATR.P);
{? P.first
|| _licz:=0;
   _size:=P.size;
   _prgs:=100*_licz/_size;
   {!
   |? _licz+=1;
      _prgs:=100*_licz/_size;
      progress(_prgs,'Trwa wyliczanie średniego zatrudnienia...'@,FUN.TYT);
      {? ((P.DZ=date(0,0,0) | P.DZ>=_a) & P.DZA<=_b)
      || {? P.DZ<>date(0,0,0) & P.DZ<_b || _ile:=P.DZ-_a+1 || _ile:=_ile_dni ?};
         {! _i:=1..obj_len(_tmp)
         |! {! _j:=1.._ile_dni
            |! _tmp[_i][_j]:=0
            !}
         !};
         P_INFO.prefix(exec('ref_firma','ustawienia'),P.OSOBA);
         H.prefix(P.ref,'Z');
         {? H.first
         || {! _i:=0.._ile-1
            |! {? H.find_le(_a+_i)
               || _tmp[1][_i+1]+=H.WY;
                  _tmp[3][_i+1]:=H.WY;
                  {? P_INFO.find_le(_a+_i) & P_INFO.STNP().KOD<>'0'
                  || {? P_INFO.STNP_OD<=_a+_i & (P_INFO.STNP_DO=date(0,0,0) | P_INFO.STNP_DO>=_a+_i)
                     || _tmp[2][_i+1]+=H.WY
                     ?}
                  ?}
               ?}
            !};
            {! _i:=0.._ile-1
            |! {? P_INFO.find_le(_a+_i) & P_INFO.STNP
               || _rodz:=P_INFO.STNP().KOD;
                  N.prefix('N',P.ref);
                  {? N.find_le(_a+_i) & N.DO>=_a+_i
                  || {? __RUB.sys_attr(N.NB,115,N.OD) | __RUB.sys_attr(N.NB,133,N.OD) | __RUB.sys_attr(N.NB,112,N.OD) | __RUB.sys_attr(N.NB,1222,N.OD) | __RUB.sys_attr(N.NB,1323,N.OD)
                     || {? _rodz='0'
                        || _tmp[1][_i+1]-=_tmp[3][_i+1]
                        || {? P_INFO.STNP_OD<=_a+_i & (P_INFO.STNP_DO=date(0,0,0) | P_INFO.STNP_DO>=_a+_i)
                           || _tmp[2][_i+1]-=_tmp[3][_i+1]
                           ?}
                        ?}
                     ?}
                  ?}
               ?}
            !};
            {! _i:=1..2
            |! _suma:=0;
               {! _j:=1.._ile |! _suma+=_tmp[_i][_j] !};
               _Wynik[_i]+=(_suma/_ile_dni)$3
            !}
          ?}
       ?};
       P.next
   !}
?};
prgs_clr;
obj_del(_tmp);
P.cntx_pop;
H.cntx_pop;
N.cntx_pop;
P_INFO.cntx_pop;
_Wynik


\i_Niep_od201103
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [12.10]
:: OPIS: Wersja obowiazujaca od 03-2011 dla dokumentow INF-D-P
::       Pobranie informacji wymiarze pracy z orzeczonym stopniem niepelnosprawnosci pracownika.
::   WE: _a - okres sprawozdawczy [MM-RRRR]
::  OLD: \i_Niep_od201103/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('__wersja')<>type_of(0) ||__wersja:=0 ?};
_wyn:=0;
_xod:=_od:=date(#(_a+4),#(2+_a),1);
_xdo:=_do:=date(#(_a+4),#(2+_a),0);
__G[30]:=_G30:=0;
P_INFO.index('OD');
P_INFO.prefix(exec('ref_firma','ustawienia'),OSOBA.ref);

{! _obrot:=_xod~3.._xdo~3
|! _dalej:=1;
   _data:=date(_xod~1,_xod~2,_obrot);
   _datalast:=_xdo;
   {? P_INFO.last
   || {!
      |?
         {? (2+P_INFO.TTUB().KOD)<>'04'
          & P_INFO.STNP<>null
          & P_INFO.STNP().KOD<>'0'
          & _data<=_datalast
          & P_INFO.OD<=_data
          & P_INFO.STNP_OD<=_data
          & (P_INFO.STNP_DO~1=0 | P_INFO.STNP_DO>=_data)
          & {? _xod>=date(2011,03,01)
            || ~(P_INFO.PREM<>null & P_INFO.PREM().KOD='1' & P_INFO.STNP<>null & P_INFO.STNP().KOD<>'3')
            || 1
            ?}
         ||
            _G30:=exec('zatr_wymiar','!ppl_zes_exso',OSOBA.ref,_data,_data);
            {? __DocT+7='INF-U-P'
            || 'Zbieranie informacji dla przypadku dokumentu INF-U-P';
               {? KST.PFZPCCZY=1
               || 'pracodawca wg art 25a ust 3 Ustawy - Zaklad pracy chronionej';
                  {? P_INFO.SZCZNIEP='T'
                  ||
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        __Ch[10]+=__G[31]
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        __Ch[11]+=__G[31]
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        __Ch[12]+=__G[31]
                     |? #P_INFO.STNP().KOD>3
                     || 'Nieokreślony'; _wyn:=1;
                        __Ch[13]+=__G[31]
                     ?}
                  || 'normalny';
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        __Ch[4]+=__G[31]
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        __Ch[5]+=__G[31]
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        __Ch[6]+=__G[31]
                     |? #P_INFO.STNP().KOD>3
                     || 'Nieokreślony'; _wyn:=1;
                        __Ch[14]+=__G[31]
                     ?}
                  ?}
               |? __G[27]>=25
               || 'pracodawca wg art 25a ust 4 Ustawy';
                  {? P_INFO.SZCZNIEP='T'
                  ||
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        __Ch[43]+=__G[31]
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        __Ch[42]+=__G[31]
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        __Ch[41]+=__G[31]
                     ?}
                  || 'normalny';
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        __Ch[33]+=__G[31]
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        __Ch[32]+=__G[31]
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        __Ch[31]+=__G[31]
                     ?}
                  ?}
               |? __G[27]<25
               || 'pracodawca wg art 25a ust 2 Ustawy';
                  {? P_INFO.SZCZNIEP='T'
                  ||
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        __Ch[40]+=__G[31]
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        __Ch[39]+=__G[31]
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        __Ch[38]+=__G[31]
                     ?}
                  || 'normalny';
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        __Ch[30]+=__G[31]
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        __Ch[18]+=__G[31]
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        __Ch[17]+=__G[31]
                     ?}
               ?}
               ?}
            |? __DocT+7='INF-D-P'
            || 'Zbieranie informacji dla przypadku dokumentu INF-D-P';
               _num:=0;
               {? KST.PFZPCCZY=1
               || 'chronionej';
                  {? P_INFO.SZCZNIEP<>'T'
                  || 'szczegolne schorzenia';
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 51 || 10 ?}
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 52 || 11 ?}
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 53 || 12 ?}
                     ?}
                  || 'normalny';
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 54 || 4 ?}
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 55 || 5 ?}
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 56 || 6 ?}
                     ?}
                  ?}
               || 'normalny zakład';
                  {? P_INFO.SZCZNIEP<>'T'
                  || 'szczegolne schorzenia';
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 57 || 1 ?}
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 58 || 2 ?}
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 59 || 3 ?}
                     ?}
                  || 'normalny';
                     {? P_INFO.STNP().KOD='1'
                     || 'Lekki'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 60 || 7 ?}
                     |? P_INFO.STNP().KOD='2'
                     || 'Umiarkowany'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 61 || 8 ?}
                     |? P_INFO.STNP().KOD='3'
                     || 'Znaczny'; _wyn:=1;
                        _num:={? (__wersja=6 | __wersja=7 | __wersja=8) & P_INFO.PREM().KOD='1' || 62 || 9 ?}
                     ?}
                  ?}
               ?};
               {? _num>0 || __Ch[_num]+=_G30; __G[30]+=_G30 ?}
            ?};
            _dalej:=0
         ?};
         _datalast:=P_INFO.OD;
         _dalej & P_INFO.prev
      !}
   ?}
!};
_wyn


\read_last
::----------------------------------------------------------------------------------------------------------------------
::  UTW: KGS [12.10]
:: OPIS: Odczyt wartosci z poprzedniej paczki
::   WE:  _a  - rubryka
::        _b  - wartosc pusta pola (wlasciwego typu)
::              (wartosc zwracana w przypadku nieodczytania pola badz odczytane pole jest innego typu)
::       [_c] - granica poszukiwan wlacznie [DATE] (istotny miesiac i rok)
::              (przekroczenie granicy zwroci wartosc pusta wlasciwa dla danego pola)
::   WY: wartosc zwracana
::       ~~ - w przypadku nieznalezienia dokumentu badz rubryki
::  OLD: \read_last/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
:: okres graniczny poszukiwan
_gdt:={? var_pres('_c')=type_of(date)
      || date(_c~1,_c~2,0)
      || date(0,0,0)
      ?};
:: biezacy okres
_odt:=date(#(__okSp+4),#(2+__okSp),0);

SOD_P.cntx_psh();
SOD_N.cntx_psh();
SOD.cntx_psh();
SOD_P.index('SOD_P');
SOD_P.prefix('SODIR','SODIR');
{? SOD_P.last
|| {!
   |? _sdt:=date(SOD_P.R,SOD_P.MK,0);
      {? _odt>_sdt & _sdt>=_gdt
      || SOD_N.index('SOD_N3');
         SOD_N.prefix(SOD_P.ref,'WND','WND');
         {? SOD_N.last
         || SOD.use('sod'+$SOD_P.R);
            SOD.index('SODN');
            SOD.prefix();
            _wyn:=exec('d_read','!ppl_zes_exso',SOD_N.ref,_a)
         ?};
         0
      |? _sdt>_gdt
      || SOD_P.prev
      || 0
      ?}
   !}
?};
{? var_pres('_wyn')<0
|| _wyn:=~~
|? var_pres('_wyn')<>type_of(_b)
|| _wyn:=_b
?};
SOD.cntx_pop();
SOD_N.cntx_pop();
SOD_P.cntx_pop();
_wyn


\INFDPs7
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.30]
:: OPIS: Generowanie i zapis do bazy dokumentu INF-D-P w wersji 7
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::  OLD: \INFDPs7/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
{? __G[56]=''
|| __G[56]:={? FUN.ask('Czy pracodawca wykonuje działalność gospodarczą?') || 'T' || 'N' ?}
?};
{? __G[57]=''
||
   {!
   |? _fch:=FUN.choice(
         'Wybierz sposób ustalania efektu zachęty:\n'+
         '(bez względu na wybór, w pierwszej kolejności poszukiwana jest informacja w poprzednich zestawach)\n'+
         'automatycznie - metoda ilościowa, sposób drugi zgodnie z wyrokiem TSWE,\n'+
         'domyślnie TAK - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie T,\n'+
         'domyślnie NIE - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie N.',,
         'aUtomatycznie','domyślnie TAK','domyślnie NIE',,'');
      {? _fch=1 || __G[57]:='A'
      |? _fch=2 || __G[57]:='T'
      |? _fch=3 || __G[57]:='N'
      ?};
      __G[57]=''
   !}
?};
P.OSOBA();
_firstZ:={? -menu_txt='wybierz'
         || FUN.ask('Czy pracownik '+OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE+' zgłaszany po raz pierwszy?')
         ?};
_xINFDP:=exec('count','!ppl_zes_exso','INF-D-P');
_ref:=SOD_N.ref;
_EfZach:=__G[57];
{? __Ch[50]<=date(#(__okSp+4),(#(2+__okSp))-12,0)
|| SOD_P.cntx_psh();
   SOD_N.cntx_psh();
   SOD_N.index(__nSOD_N);
   SOD_N.prefix(OSOBA.PESEL,OSOBA.NAZWISKO,OSOBA.PIERWSZE,'T');
   SOD.cntx_psh();
   _EfZach:='';
   {? SOD_N.first
   || {!
      |? {? SOD_N.SOD_P().R<2011
         || 0
         || {? $SOD_N.SOD_P().R<>(SOD.name+4) || SOD.use('sod'+$SOD_N.SOD_P().R) ?};
            SOD.index('SODN');
            SOD.prefix(SOD_N.ref);
            _wtmp:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0);
            {? var_pres('_wtmp')=type_of(0) & _wtmp=6
            || _EfZach:=exec('d_read','!ppl_zes_exso',SOD_N.ref,48)
            ?};
            _EfZach='' & SOD_N.next
         ?}
      !}
   ?};
   SOD.cntx_pop();
   SOD_N.cntx_pop();
   SOD_P.cntx_pop();

   {? _EfZach=''
   || {? __G[57]='A'
      || OSOBA.cntx_psh();
         _niepZ:=exec('srzatr_niep_new','!ppl_zes_exso',date(__Ch[50]~1,(__Ch[50]~2)-11,1),__Ch[50],1);
         _axd:=date(__Ch[50]~1,(__Ch[50]~2)-1,1);
         _niepP:=exec('srzatr_niep_new','!ppl_zes_exso',date(_axd~1,(_axd~2)-11,1),_axd,1);
         _EfZach:={? _niepZ>_niepP || 'T' || 'N' ?};
         OSOBA.cntx_pop()
      || _EfZach:=__G[57]
      ?}
   ?}
?};
{? _EfZach<>'T' & _EfZach<>'N' || _EfZach:='N' ?};

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',7,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer w rejestrze PFRON',__G[45],'B');
exec('d_save','!ppl_zes_exso',_ref,2,'PESEL',OSOBA.PESEL,,11);
exec('d_save','!ppl_zes_exso',_ref,3,'Dowód osobisty',{? +OSOBA.PESEL || '' || OSOBA.DOWOD ?},,9);
exec('d_save','!ppl_zes_exso',_ref,4,'NIP',{? +OSOBA.PESEL || '' || exec('txt_cut','!ppl_zes_exso',OSOBA.NIP,'-') ?},,10);
exec('d_save','!ppl_zes_exso',_ref,5,'Nazwisko',OSOBA.NAZWISKO,,60);
exec('d_save','!ppl_zes_exso',_ref,6,'Pierwsze imię',OSOBA.PIERWSZE,,60);
{? _firstZ || exec('d_save','!ppl_zes_exso',_ref,7,'Drugie imię',OSOBA.DRUGIE,,60) ?};

_ad_mp:=exec('szukaj','osoba','S',date(#(__okSp+4),(#(2+__okSp))-1,0));
_ad_ms:=exec('szukaj','osoba','S',date(#(__okSp+4),#(2+__okSp),0));
{? _ad_ms<>null & (_firstZ | _ad_mp<>_ad_ms)
||
   exec('d_save','!ppl_zes_exso',_ref,8,'Województwo',exec('kod_woje','!ppl_zes_exso',OS_ADRES.WOJEWODZ),,2);
   exec('d_save','!ppl_zes_exso',_ref,9,'Powiat',OS_ADRES.POWIAT,,30);
   exec('d_save','!ppl_zes_exso',_ref,10,'Gmina',OS_ADRES.GMINA,,30);
   exec('d_save','!ppl_zes_exso',_ref,11,'Miejscowość',OS_ADRES.MIASTO,,30);
   exec('d_save','!ppl_zes_exso',_ref,12,'Kod pocztowy',OS_ADRES.KOD,,6);
   exec('d_save','!ppl_zes_exso',_ref,13,'Poczta',OS_ADRES.POCZTA,,30);
   exec('d_save','!ppl_zes_exso',_ref,14,'Ulica',OS_ADRES.ULICA,,60);
   exec('d_save','!ppl_zes_exso',_ref,15,'Nr domu',OS_ADRES.DOM,,5);
   exec('d_save','!ppl_zes_exso',_ref,16,'Nr lokalu',OS_ADRES.LOKAL,,4)
?};

exec('d_save','!ppl_zes_exso',_ref,17,'Okres sprawozdawczy',__okSp,'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Okres wypłaty wynagrodzenia',__okWp,'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Informacja (zwykła/korygująca)',SOD_N.SOD_P().KOR,'B');

exec('d_save','!ppl_zes_exso',_ref,20,'Nr kolejny informacji',_xINFDP,'B');

exec('d_save','!ppl_zes_exso',_ref,21,'niep.znaczna,s.szczeg.,ZPCH',__Ch[6]+__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,22,'niep.umiarkowana,s.szczeg.,ZPCH',__Ch[5]+__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,23,'niep.lekka,s.szczeg.,ZPCH',__Ch[4]+__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,24,'niep.znaczna,ZPCH',__Ch[12]+__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,25,'niep.umiarkowana,ZPCH',__Ch[11]+__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,26,'niep.lekka,ZPCH',__Ch[10]+__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,27,'niep.znaczna,s.szczeg.,emeryt,ZPCH',__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,28,'niep.umiarkowana,s.szczeg.,emeryt,ZPCH',__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,29,'niep.lekka,s.szczeg.,emeryt,ZPCH',__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,30,'niep.znaczna,emeryt,ZPCH',__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,31,'niep.umiarkowana,emeryt,ZPCH',__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,32,'niep.lekka,emeryt,ZPCH',__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,33,'niep.znaczna,s.szczeg.',__Ch[9]+__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,34,'niep.umiarkowana,s.szczeg.',__Ch[8]+__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,35,'niep.lekka,s.szczeg.',__Ch[7]+__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,36,'niep.znaczna',__Ch[3]+__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'niep.umiarkowana',__Ch[2]+__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,38,'niep.lekka',__Ch[1]+__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,39,'niep.znaczna,s.szczeg.,emeryt',__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,40,'niep.umiarkowana,s.szczeg.,emeryt',__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,41,'niep.lekka,s.szczeg.,emeryt',__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,42,'niep.znaczna,emeryt',__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,43,'niep.umiarkowana,emeryt',__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,44,'niep.lekka,emeryt',__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,45,'Zatrudnienie od dnia',__Ch[50]);

:: Domyslnie T
exec('d_save','!ppl_zes_exso',_ref,46,'Dof. stanowi pomoc publiczną','T',,1);

exec('d_save','!ppl_zes_exso',_ref,47,'Pracodawca wyk. działaność gosp.',__G[56],,1);

exec('d_save','!ppl_zes_exso',_ref,48,'Zatr. w warunkach efektu zachęty',_EfZach,,1);

:: Brak informacji w systemie - eksportujemy stala wartosc 0
_poz49:=0;
exec('d_save','!ppl_zes_exso',_ref,49,'Kwota pomocy publ. i de minimis',_poz49,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,50,'Wynagrodzenie minimalne',0,,2 );

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,51,'Kwota ustalona',0,,2);

exec('d_save','!ppl_zes_exso',_ref,52,'Koszty płacy',__Ch[63],,2);
:: Brak informacji w programie - eksportujemy stala wartosc 0
_poz53:=0;
exec('d_save','!ppl_zes_exso',_ref,53,'Pomniejszenia (dofinansowania z innych źródeł)',_poz53,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,54,'Limit kosztów płacy',0,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,55,'DO WYPŁATY',0,,2,12);
1


\INFDPr7
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.30]
:: OPIS: Eksport dokumentu INF-D-P (wersja 7).
::   WE: odczyt wymaganych zmiennych globalnych
::  OLD: \INFDPr7/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
exec('zero_ch','!ppl_zes_exso');
_q:=15*' ';
_nw:=exec('eol','!ppl_zes_exso');

_ref:=SOD_N.ref;
_izk:={? SOD_N.SOD_P().KOR='K' || 'K' || 'Z' ?};

   _tresc:=
       _q+'<daneInformacji nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,20)+
                        '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
                        '" okresSprawozdawczy="'+(((('00'+$SOD_N.SOD_P().MP))+2)+'-'+($SOD_N.SOD_P().R))+'"'+
   _nw+_q+' okresSprawozdawczyWynagrodzenie="'+exec('d_read','!ppl_zes_exso',_ref,18)+
                      '" rodzajInformacji="'+_izk+'" />'+
   _nw+_q+' <metrykaPracownika>'+
   _nw+_q+'<daneEwidencyjne imie1="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                         '" imie2="'+exec('d_read','!ppl_zes_exso',_ref,7)+
                         '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,5)+
                         '" nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+
                         '" nrDowodu="'+exec('d_read','!ppl_zes_exso',_ref,3)+
                         '" pesel="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" />'+
   _nw+_q+' <adresPracownika>'+
   _nw+_q+'  <adres gmina="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                 '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,12)+
                 '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                 '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,15)+
                 '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,16)+
                 '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,13)+
                 '" powiat="'+exec('d_read','!ppl_zes_exso',_ref,9)+
                 '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,14)+
                 '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" />'+
   _nw+_q+'  </adresPracownika>'+
   _nw+_q+'  <infNiepelnospr chronLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,23,0),SOD.PR)+'" '+
                  'chronLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,29,0),SOD.PR)+'" '+
                  'chronSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,26,0),SOD.PR)+'" '+
                  'chronSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,32,0),SOD.PR)+'" '+
                  'chronSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,25,0),SOD.PR)+'" '+
                  'chronSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,31,0),SOD.PR)+'" '+
                  'chronSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,24,0),SOD.PR)+'" '+
                  'chronSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,30,0),SOD.PR)+'" '+
                  'chronUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,22,0),SOD.PR)+'" '+
                  'chronUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,28,0),SOD.PR)+'" '+
                  'chronZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,21,0),SOD.PR)+'" '+
                  'chronZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,27,0),SOD.PR)+'" '+
                  'normLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,35,0),SOD.PR)+'" '+
                  'normLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41,0),SOD.PR)+'" '+
                  'normSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38,0),SOD.PR)+'" '+
                  'normSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,44,0),SOD.PR)+'" '+
                  'normSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37,0),SOD.PR)+'" '+
                  'normSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,43,0),SOD.PR)+'" '+
                  'normSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36,0),SOD.PR)+'" '+
                  'normSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42,0),SOD.PR)+'" '+
                  'normUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,34,0),SOD.PR)+'" '+
                  'normUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40,0),SOD.PR)+'" '+
                  'normZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,33,0),SOD.PR)+'" '+
                  'normZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39,0),SOD.PR)+'" />'+
   _nw+_q+'  <zatrudnienie '+
                  'efektZachety="'+exec('d_read','!ppl_zes_exso',_ref,48)+'" '+
                  'kosztyPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,52,0),SOD.PR)+'" '+
                  'kwDofWyplata="0,00" '+
                  'kwUstalona="0,00" '+
                  'limitKosztowPlacy="0,00" '+
                  'okresZatrOdDnia="'+exec('txt_dt','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,45))+'" '+
                  'pomniejszenia="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,53,0),SOD.PR)+'" '+
                  'pracWykDzG="'+exec('d_read','!ppl_zes_exso',_ref,47)+'" '+
                  'stanowiPomocPubliczna="'+exec('d_read','!ppl_zes_exso',_ref,46,0)+'" '+
                  'wynMinimalne="0,00" />'+
   _nw+_q+'  <pomocPubliczna kwota="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,49,0),SOD.PR)+'" /> '+
   _nw+_q+'</metrykaPracownika>'+
   _nw;
exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\WNDs5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.30]
:: OPIS: Dokument WND - (wersja 5).
::  OLD: \WNDs5/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? __G[46] & ~exec('rachunki_banki','rachunki') || __G[46]:=0 ?};
_pole26:=_pole27:=_pole28:=_pole29:=_pole30:=_pole31:=_pole32:=_pole33:=_pole34:='';

:: szukanie pelnomocnika w poprzednim dokumencie
_dgr:=date(2011,12,0);
_pole25:=exec('read_last','!ppl_zes_exso',25,'',_dgr);

{? (_pole25=~~ & FUN.ask('Czy w imieniu pracodawcy występuje pełnomocnik?'))
 | _pole25<>''
||
:: Zgloszenie wysyla pelnomocnik pracodawcy
   {? _pole25=~~ || _pole25:='' ?};
   {? _pole25<>''
   || _pole26:=exec('read_last','!ppl_zes_exso',26,'',_dgr); {? _pole26=~~ || _pole26:='' ?};
      _pole27:=exec('read_last','!ppl_zes_exso',27,'',_dgr); {? _pole27=~~ || _pole27:='' ?};
      _pole28:=exec('read_last','!ppl_zes_exso',28,'',_dgr); {? _pole28=~~ || _pole28:='' ?};
      _pole29:=exec('read_last','!ppl_zes_exso',29,'',_dgr); {? _pole29=~~ || _pole29:='' ?};
      _pole30:=exec('read_last','!ppl_zes_exso',30,'',_dgr); {? _pole30=~~ || _pole30:='' ?};
      _pole31:=exec('read_last','!ppl_zes_exso',31,'',_dgr); {? _pole31=~~ || _pole31:='' ?};
      _pole32:=exec('read_last','!ppl_zes_exso',32,'',_dgr); {? _pole32=~~ || _pole32:='' ?};
      _pole33:=exec('read_last','!ppl_zes_exso',33,'',_dgr); {? _pole33=~~ || _pole33:='' ?};
      _pole34:=exec('read_last','!ppl_zes_exso',34,'',_dgr); {? _pole34=~~ || _pole34:='' ?}
   ?};
   undefine();
   define('P25',_pole25,'Nazwa pełnomocnika*: ','Nazwa pełnomocnika - pole wymagane',60,60);
   define('HD_0',~~,'  Adres pełnomocnika');
   define('P26',_pole26,'ulica:     ','ulica',60,60);
   define('P27',_pole27,'nr domu*:   ','nr domu',10,10);
   define('P28',_pole28,'nr lokalu: ','nr lokalu',10,10);
   define('P29',_pole29,'miejscowość*: ','miejscowość',30,30);
   define('P30',_pole30,'kod pocztowy*: ','kod pocztowy',10,10);
   define('P31',_pole31,'poczta*: ','poczta',30,30);
   define('P32',_pole32,'telefon*: ','telefon',14,14);
   define('P33',_pole33,'fax: ','telefax',14,14);
   define('P34',_pole34,'e-mail: ','adres e-mail',40,40);
   define('HD_1',~~,'');
   define('HD_2',~~,'Pola oznaczone * są wymagane.');
   define('HD_3',~~,'Wszystkie informacje można poprawić');
   define('HD_4',~~,'przed wysłaniem zestawu do programu');
   define('HD_5',~~,'SODiR OffLine');
   define('HD_6',~~,'(podane dane nie są weryfikowane automatycznie).');
   {!
   |? {? def_edit("{? DEFINE.P25=''
                   || FUN.emsg('Podanie nazwy pełnomocnika jest wymagane.'); 'P25'
                   |? DEFINE.P27=''
                   || FUN.emsg('Pole >>nr domu<< jest wymagane.'); 'P27'
                   |? DEFINE.P29=''
                   || FUN.emsg('Pole >>miejscowość<< jest wymagane.'); 'P29'
                   |? DEFINE.P30=''
                   || FUN.emsg('Pole >>kod pocztowy<< jest wymagane.'); 'P30'
                   |? DEFINE.P31=''
                   || FUN.emsg('Pole >>poczta<< jest wymagane.'); 'P31'
                   |? DEFINE.P32=''
                   || FUN.emsg('Pole >>nr telefonu<< jest wymagane.'); 'P32'
                   || 1
                   ?}
                  ",'Uzupełnij/zweryfikuj dane pełnomocnika')
      ||  _pole25:=DEFINE.P25; _pole26:=DEFINE.P26; _pole27:=DEFINE.P27; _pole28:=DEFINE.P28; _pole29:=DEFINE.P29;
          _pole30:=DEFINE.P30; _pole31:=DEFINE.P31; _pole32:=DEFINE.P32; _pole33:=DEFINE.P33; _pole34:=DEFINE.P34;
          0
      || {? FUN.ask('Rezygnacja spowoduje usunięcie zapisu\n'+
                    'o przygotowaniu dokumentów przez pełnomocnika.\n'+
                    'Ustawienie można zmienić wypełniając w nagłówku\n'+
                    'dokumentu WND informację o pełnomocniku i jego adresie.\n'+
                    'Czy na pewno kontynuować?')
         || _pole25:=_pole26:=_pole27:=_pole28:=_pole29:=_pole30:=_pole31:=_pole32:=_pole33:=_pole34:='';
            0
         || 1
         ?}
      ?}
   !};
   undefine()
?};
{? _pole25=''
||
:: Zgloszenie wysyla pracodawca
   _pole26:={? __G[46] || KST.KULICA || '' ?};
   _pole27:={? __G[46] || KST.KDOM || '' ?};
   _pole28:={? __G[46] || KST.KLOKAL || '' ?};
   _pole29:={? __G[46] || KST.KMIASTO || '' ?};
   _pole30:={? __G[46] || KST.KKOD || '' ?};
   _pole31:={? __G[46] || KST.KPOCZTA || '' ?};
   _pole32:={? __G[46] || KST.KTEL || '' ?};
   _pole33:={? __G[46] || KST.KFAX || '' ?};
   _pole34:={? __G[46] || KST.KEMAIL || '' ?}
?};

_ref:=SOD_N.ref;
_xINFDP:=$exec('count','!ppl_zes_exso','INF-D-P');
exec('d_save','!ppl_zes_exso',_ref,0,'Wersja',5,'B');

exec('d_save','!ppl_zes_exso',_ref,2,'Numer w rejestrze PFRON',__G[45],'B');
exec('d_save','!ppl_zes_exso',_ref,3,'NIP',exec('txt_cut','!ppl_zes_exso',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'),'-'),'B');
exec('d_save','!ppl_zes_exso',_ref,4,'REGON',14+(KST.REG+(14*'0')),'B');
exec('d_save','!ppl_zes_exso',_ref,5,'Pełna nazwa pracodawcy',{? __G[46] || KST.NAZWA || '' ?},'B');

:: pola 6-9 - nie eksportujemy - pola nie wymagane do eksportu, zdefiniowane w SODiR OffLine
::exec('d_save','!ppl_zes_exso',_ref,6,'Forma prawna pracodawcy',{? __G[46] || __G[22] || '' ?});
::exec('d_save','!ppl_zes_exso',_ref,7,'Szczegółowa forma prawna pracodawcy',__G[21]);
::exec('d_save','!ppl_zes_exso',_ref,8,'Forma własności',__G[23]);
::exec('d_save','!ppl_zes_exso',_ref,9,'Wielkość pracodawcy',{? __G[46] || __G[25] || '' ?});

exec('d_save','!ppl_zes_exso',_ref,10,'Kod adresu przedsiębiorcy',{? __G[46] || ((7*'0')+KST.GMGUS)+7 || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,11,'PKD wnioskodawcy',{? __G[46] || STR.gsub(KST.PKD,'.','') || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,12,'Okres sprawozdawczy',__okSp,'B');

:: pole 13 - nie wyliczamy ze wzgledu na brak wyliczen kwoty do wyplaty na dokumentach INF-D-P (pole eksportowane z zerowa wartoscia)
:: exec('d_save','!ppl_zes_exso',_ref,13,'Należna kwota dofinansowania',0,'B',2);

exec('d_save','!ppl_zes_exso',_ref,14,'Liczba załączników INF-D-P',_xINFDP,'B');
exec('d_save','!ppl_zes_exso',_ref,15,'Nr rachunku',{? __G[46] || SKID_RBK.N || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,16,'Ulica',{? __G[46] || KST.ULICA || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,17,'Nr domu',{? __G[46] || KST.DOM || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Nr lokalu',{? __G[46] || KST.LOKAL || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Miejscowość',{? __G[46] || KST.MIASTO || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,20,'Kod pocztowy',{? __G[46] || KST.KOD || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,21,'Poczta',{? __G[46] || KST.POCZTA || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,22,'telefon',{? __G[46] || KST.PFTEL || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,23,'fax',{? __G[46] || KST.PFFAX || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,24,'e-mail',{? __G[46] || KST.PFEMAIL || '' ?},'B');

exec('d_save','!ppl_zes_exso',_ref,25,'Pełnomocnik wyst. w im. wnioskodawcy',_pole25,,60);
_koresp:='KORESPONDENCJA/PEŁNOMOCNIK: ';
exec('d_save','!ppl_zes_exso',_ref,26,_koresp+'Ulica',_pole26);
exec('d_save','!ppl_zes_exso',_ref,27,_koresp+'nr domu',_pole27);
exec('d_save','!ppl_zes_exso',_ref,28,_koresp+'nr lokalu',_pole28);
exec('d_save','!ppl_zes_exso',_ref,29,_koresp+'Miejscowość',_pole29);
exec('d_save','!ppl_zes_exso',_ref,30,_koresp+'Kod pocztowy',_pole30);
exec('d_save','!ppl_zes_exso',_ref,31,_koresp+'Poczta',_pole31);
exec('d_save','!ppl_zes_exso',_ref,32,_koresp+'tel.',_pole32);
exec('d_save','!ppl_zes_exso',_ref,33,_koresp+'fax',_pole33);
exec('d_save','!ppl_zes_exso',_ref,34,_koresp+'e-mail',_pole34);

exec('d_save','!ppl_zes_exso',_ref,35,'Status pracodawcy (ZPCH,ZAZ,INNY)',{? KST.PFZPCCZY=1 || 'ZPCH' || 'INNY' ?},,4);

exec('d_save','!ppl_zes_exso',_ref,36,'Liczba osób nowozatrudnionych',__G[32],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'Stan zatrudnienia ogółem',__G[27],,3);
exec('d_save','!ppl_zes_exso',_ref,38,'Stan zatrudnienia niepełnosprawnych',__G[52],,3);
exec('d_save','!ppl_zes_exso',_ref,39,'Bieżący stan zatrudnienia ogółem',__G[55],,3);

exec('d_save','!ppl_zes_exso',_ref,40,'Bieżący stan zatrudnienia niepełnospr. ogółem',__G[54],,3);

exec('d_save','!ppl_zes_exso',_ref,41,'Stan zatrudnienia ogółem za 12 miesięcy',__G[28],,3);
exec('d_save','!ppl_zes_exso',_ref,42,'Stan zatrudnienia niepełn. za 12 miesięcy',__G[53],,3);
exec('d_save','!ppl_zes_exso',_ref,43,'Data wypełnienia',date(),'B');
exec('d_save','!ppl_zes_exso',_ref,99,'Adres do korespondencji taki sam?',{? +_pole25 || 'N' || __G[50] ?});
exec('d_save','!ppl_zes_exso',_ref,100,'Ośw. o wybr. el. formy skł. wniosków','T',,1);
exec('d_save','!ppl_zes_exso',_ref,101,'Załączono inf. o otrzym. pom. de minimis','N',,1);
1


\WNDr5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.30]
:: OPIS: Eksport dokumentu typu WND (wersja 5).
::  OLD: \WNDr5/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
_ref:=SOD_N.ref;
_dw:=DEFINE.DATA;

    _izk    :={? SOD_N.SOD_P().KOR='K' || _zglo:='N'; 'K' || _zglo:='T'; 'Z' ?};
    _statP  :=~-exec('d_read','!ppl_zes_exso',_ref,35);
    _elekt  :=~-exec('d_read','!ppl_zes_exso',_ref,100);
    _demin  :=~-exec('d_read','!ppl_zes_exso',_ref,101);

    _nw:=exec('eol','!ppl_zes_exso');
    _q:=13*' ';

      _tresc:=
            _q+'<daneInformacji '+
                        'czyZgloszeniowy="'+_zglo+'" '+
                        'dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+'" '+
                        'imieNazwiskoOsobyPodpisujacej="" '+
                        'liczbaINFDP="'+exec('d_read','!ppl_zes_exso',_ref,14)+'" '+
                        'nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" '+
                        'okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,12)+'" '+
                        'rodzajInformacji="'+_izk+'" '+
                        'uwagi=""/>'+
       _nw+_q+'<kartaPracodawcy>'+
       _nw+_q+'   <daneEwidencyjne '+
                     'nip="'+exec('d_read','!ppl_zes_exso',_ref,3)+'" '+
                     'pelnaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,5)+'" '+
                     'pkd="'+exec('d_read','!ppl_zes_exso',_ref,11)+'" '+
                     'regon="'+exec('d_read','!ppl_zes_exso',_ref,4)+'"/>'+
       _nw+_q+'   <dodInfPracodawcy '+
                     'formaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,6)+'" '+
                     'formaWlasnosci="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" '+
                     'statusPracodawcyIP="'+{? _statP<>'ZPCH' & _statP<>'ZAZ' || 'T' || 'N' ?}+'" '+
                     'statusPracodawcyZAZ="'+{? _statP='ZAZ' || 'T' || 'N' ?}+'" '+
                     'statusPracodawcyZPC="'+{? _statP='ZPCH' || 'T' || 'N' ?}+'" '+
                     'szczegolowaFormaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,7)+'" '+
                     'wielkoscPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,9)+'"/>'+
       _nw+_q+'   <adresPracodawcy>'+
       _nw+_q+'      <adres '+
                        'kodAdresuPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,10)+'" '+
                        'kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,20)+'" '+
                        'miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,19)+'" '+
                        'nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,17)+'" '+
                        'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,18)+'" '+
                        'poczta="'+exec('d_read','!ppl_zes_exso',_ref,21)+'" '+
                        'ulica="'+exec('d_read','!ppl_zes_exso',_ref,16)+'"/>'+
       _nw+_q+'      <kontakt '+
                        'email="'+exec('d_read','!ppl_zes_exso',_ref,24)+'" '+
                        'faks="'+exec('d_read','!ppl_zes_exso',_ref,23)+'" '+
                        'telefon="'+exec('d_read','!ppl_zes_exso',_ref,22)+'"/>'+
       _nw+_q+'   </adresPracodawcy>'+
       _nw+_q+'   <infDofinansowanie ogolem="0,00"/>'+
       _nw+_q+'   <rachunekBankowy nrRachunku="'+exec('d_read','!ppl_zes_exso',_ref,15)+'"/>'+
       _nw+_q+'   <adresKorespondencyjny>'+
       _nw+_q+'      <adres '+
                        'adresJak="'+exec('d_read','!ppl_zes_exso',_ref,99)+'" '+
                        'czyPelnomocnik="'+{? exec('d_read','!ppl_zes_exso',_ref,25)='' || 'N' || 'T' ?}+'" '+
                        'kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,30)+'" '+
                        'miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,29)+'" '+
                        'nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,27)+'" '+
                        'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,28)+'" '+
                        'poczta="'+exec('d_read','!ppl_zes_exso',_ref,31)+'" '+
                        'ulica="'+exec('d_read','!ppl_zes_exso',_ref,26)+'"/>'+
       _nw+_q+'      <kontakt '+
                        'email="'+exec('d_read','!ppl_zes_exso',_ref,34)+'" '+
                        'faks="'+exec('d_read','!ppl_zes_exso',_ref,33)+'" '+
                        'telefon="'+exec('d_read','!ppl_zes_exso',_ref,32)+'"/>'+
       _nw+_q+'   </adresKorespondencyjny>'+
       _nw+_q+'</kartaPracodawcy>'+
       _nw+_q+'<osoba nazwaPelnomocnika="'+exec('d_read','!ppl_zes_exso',_ref,25)+'"/>'+
       _nw+_q+'<stanZatrudnienia '+
                  'biezacyOkresNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40),SOD.PR)+'" '+
                  'biezacyOkresOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39),SOD.PR)+'" '+
                  'nowozatrudnieni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36),SOD.PR)+'" '+
                  'poprzedzajacyOkresNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42),SOD.PR)+'" '+
                  'poprzedzajacyOkresOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41),SOD.PR)+'" '+
                  'wOkresieNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38),SOD.PR)+'" '+
                  'wOkresieOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37),SOD.PR)+'"/>'+
       _nw+_q+'<oswiadczenie '+
                  'czyElektronicznie="'+_elekt+'" '+
                  'czyPapierowo="'+{? _elekt='T' || 'N' || 'T' ?}+'" '+
                  'zalaczaInfoONieotrzymanejPomocy="'+{? _demin='T' || 'N' || 'T' ?}+'" '+
                  'zalaczaInfoOOtrzymanejPomocy="'+_demin+'"/>'+
       _nw;

    exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\INFDPs8
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Generowanie i zapis do bazy dokumentu INF-D-P w wersji 8
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::  OLD: \INFDPs8/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
{? __G[56]=''
|| __G[56]:={? FUN.ask('Czy pracodawca wykonuje działalność gospodarczą?'@) || 'T' || 'N' ?}
?};
{? __G[57]=''
||
   {!
   |? _fch:=FUN.choice(
         'Wybierz sposób ustalania efektu zachęty:\n'
         '(bez względu na wybór, w pierwszej kolejności poszukiwana jest informacja w poprzednich zestawach)\n'
         'automatycznie - metoda ilościowa, sposób drugi zgodnie z wyrokiem TSWE,\n'
         'domyślnie TAK - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie T,\n'
         'domyślnie NIE - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie N.'@,,
         'aUtomatycznie'@,'domyślnie TAK'@,'domyślnie NIE'@,,'');
      {? _fch=1 || __G[57]:='A'
      |? _fch=2 || __G[57]:='T'
      |? _fch=3 || __G[57]:='N'
      ?};
      __G[57]=''
   !}
?};
P.OSOBA();
{? -menu_txt='wybierz'
|| _firstZ:=FUN.ask('Czy pracownik '+OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE+' zgłaszany po raz pierwszy?')
|| _firstZ:=1;
   _pm:=date(#(__okSp+4),(#(2+__okSp))-1,0);
   SOD_P.cntx_psh();
   SOD_P.index('SOD_P');
   SOD_P.prefix('SODIR','SODIR',_pm~1,_pm~2);
   {? SOD_P.first()
   || SOD_S.cntx_psh();
      SOD_S.index('SOD_S2');
      SOD_S.prefix('INF-D-P',);
      {? SOD_S.first()
      || SOD_N.cntx_psh();
         SOD_N.blank();
         SOD_N.SOD_P:=SOD_P.ref();
         SOD_N.SOD_S:=SOD_S.ref();
         SOD_N.NAZ:=OSOBA.NAZWISKO;
         SOD_N.IM:=OSOBA.PIERWSZE;
         SOD_N.PESEL:=OSOBA.PESEL;
         _firstZ:=~SOD_N.find_rec();
         SOD_N.cntx_pop()
      ?};
      SOD_S.cntx_pop()
   ?};
   SOD_P.cntx_pop()
?};
_xINFDP:=exec('count','!ppl_zes_exso','INF-D-P');
_ref:=SOD_N.ref;
_EfZach:=__G[57];
{? __Ch[50]<=date(#(__okSp+4),(#(2+__okSp))-12,0)
|| SOD_P.cntx_psh();
   SOD_N.cntx_psh();
   SOD_N.index(__nSOD_N);
   SOD_N.prefix(OSOBA.PESEL,OSOBA.NAZWISKO,OSOBA.PIERWSZE,'T');
   SOD.cntx_psh();
   _EfZach:='';
   {? SOD_N.first
   || {!
      |? {? SOD_N.SOD_P().R<2011
         || 0
         || {? $SOD_N.SOD_P().R<>(SOD.name+4) || SOD.use('sod'+$SOD_N.SOD_P().R) ?};
            SOD.index('SODN');
            SOD.prefix(SOD_N.ref);
            _wtmp:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0);
            {? var_pres('_wtmp')=type_of(0) & _wtmp=6
            || _EfZach:=exec('d_read','!ppl_zes_exso',SOD_N.ref,48)
            ?};
            _EfZach='' & SOD_N.next
         ?}
      !}
   ?};
   SOD.cntx_pop();
   SOD_N.cntx_pop();
   SOD_P.cntx_pop();

   {? _EfZach=''
   || {? __G[57]='A'
      || OSOBA.cntx_psh();
         _niepZ:=exec('srzatr_niep_new','!ppl_zes_exso',date(__Ch[50]~1,(__Ch[50]~2)-11,1),__Ch[50],1);
         _axd:=date(__Ch[50]~1,(__Ch[50]~2)-1,1);
         _niepP:=exec('srzatr_niep_new','!ppl_zes_exso',date(_axd~1,(_axd~2)-11,1),_axd,1);
         _EfZach:={? _niepZ>_niepP || 'T' || 'N' ?};
         OSOBA.cntx_pop()
      || _EfZach:=__G[57]
      ?}
   ?}
?};
{? _EfZach<>'T' & _EfZach<>'N' || _EfZach:='N' ?};

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',8,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer w rejestrze PFRON',__G[45],'B');
exec('d_save','!ppl_zes_exso',_ref,2,'PESEL',OSOBA.PESEL,,11);
exec('d_save','!ppl_zes_exso',_ref,3,'Dowód osobisty',{? +OSOBA.PESEL || '' || OSOBA.DOWOD ?},,9);
exec('d_save','!ppl_zes_exso',_ref,4,'NIP',{? +OSOBA.PESEL || '' || exec('txt_cut','!ppl_zes_exso',OSOBA.NIP,'-') ?},,10);
exec('d_save','!ppl_zes_exso',_ref,5,'Nazwisko',OSOBA.NAZWISKO,,60);
exec('d_save','!ppl_zes_exso',_ref,6,'Pierwsze imię',OSOBA.PIERWSZE,,60);
{? _firstZ || exec('d_save','!ppl_zes_exso',_ref,7,'Drugie imię',OSOBA.DRUGIE,,60) ?};

_ad_mp:=exec('szukaj','osoba','S',date(#(__okSp+4),(#(2+__okSp))-1,0));
{? _ad_mp=null || _ad_mp:=exec('szukaj','osoba','C',date(#(__okSp+4),(#(2+__okSp))-1,0)) ?};
_ad_ms:=exec('szukaj','osoba','S',date(#(__okSp+4),#(2+__okSp),0));
{? _ad_ms=null || _ad_ms:=exec('szukaj','osoba','C',date(#(__okSp+4),#(2+__okSp),0)) ?};
{? _ad_ms<>null & (_firstZ | _ad_mp<>_ad_ms)
|| exec('d_save','!ppl_zes_exso',_ref,8,'Województwo',exec('kod_woje','!ppl_zes_exso',OS_ADRES.WOJEWODZ),,2);
   exec('d_save','!ppl_zes_exso',_ref,9,'Powiat',OS_ADRES.POWIAT,,30);
   exec('d_save','!ppl_zes_exso',_ref,10,'Gmina',OS_ADRES.GMINA,,30);
   exec('d_save','!ppl_zes_exso',_ref,11,'Miejscowość',OS_ADRES.MIASTO,,30);
   exec('d_save','!ppl_zes_exso',_ref,12,'Kod pocztowy',OS_ADRES.KOD,,6);
   exec('d_save','!ppl_zes_exso',_ref,13,'Poczta',OS_ADRES.POCZTA,,30);
   exec('d_save','!ppl_zes_exso',_ref,14,'Ulica',30+OS_ADRES.ULICA,,30);
   exec('d_save','!ppl_zes_exso',_ref,15,'Nr domu',OS_ADRES.DOM,,5);
   exec('d_save','!ppl_zes_exso',_ref,16,'Nr lokalu',OS_ADRES.LOKAL,,4)
?};

exec('d_save','!ppl_zes_exso',_ref,17,'Okres sprawozdawczy',__okSp,'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Okres wypłaty wynagrodzenia',__okWp,'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Informacja (zwykła/korygująca)',SOD_N.SOD_P().KOR,'B');

exec('d_save','!ppl_zes_exso',_ref,20,'Nr kolejny informacji',_xINFDP,'B');

exec('d_save','!ppl_zes_exso',_ref,21,'niep.znaczna,s.szczeg.,ZPCH',__Ch[6]+__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,22,'niep.umiarkowana,s.szczeg.,ZPCH',__Ch[5]+__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,23,'niep.lekka,s.szczeg.,ZPCH',__Ch[4]+__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,24,'niep.znaczna,ZPCH',__Ch[12]+__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,25,'niep.umiarkowana,ZPCH',__Ch[11]+__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,26,'niep.lekka,ZPCH',__Ch[10]+__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,27,'niep.znaczna,s.szczeg.,emeryt,ZPCH',__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,28,'niep.umiarkowana,s.szczeg.,emeryt,ZPCH',__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,29,'niep.lekka,s.szczeg.,emeryt,ZPCH',__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,30,'niep.znaczna,emeryt,ZPCH',__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,31,'niep.umiarkowana,emeryt,ZPCH',__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,32,'niep.lekka,emeryt,ZPCH',__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,33,'niep.znaczna,s.szczeg.',__Ch[9]+__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,34,'niep.umiarkowana,s.szczeg.',__Ch[8]+__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,35,'niep.lekka,s.szczeg.',__Ch[7]+__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,36,'niep.znaczna',__Ch[3]+__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'niep.umiarkowana',__Ch[2]+__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,38,'niep.lekka',__Ch[1]+__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,39,'niep.znaczna,s.szczeg.,emeryt',__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,40,'niep.umiarkowana,s.szczeg.,emeryt',__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,41,'niep.lekka,s.szczeg.,emeryt',__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,42,'niep.znaczna,emeryt',__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,43,'niep.umiarkowana,emeryt',__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,44,'niep.lekka,emeryt',__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,45,'Zatrudnienie od dnia',__Ch[50]);

:: Domyslnie T
exec('d_save','!ppl_zes_exso',_ref,46,'Dof. stanowi pomoc publiczną','T',,1);

exec('d_save','!ppl_zes_exso',_ref,47,'Pracodawca wyk. działaność gosp.',__G[56],,1);

exec('d_save','!ppl_zes_exso',_ref,48,'Zatr. w warunkach efektu zachęty',_EfZach,,1);

:: Brak informacji w systemie - eksportujemy stala wartosc 0
_poz49:=0;
exec('d_save','!ppl_zes_exso',_ref,49,'Kwota pomocy publ. i de minimis',_poz49,,2);

:: zgodnie ze specyfikacja ustalamy wartosci w zaleznosci od okresu
:: od kwietnia 2014 eksportujemy zawsze 0, pozycja nie jest wykazyana w dokumencie INFDP wersja 8
{? date(#(__okSp+4),#(2+__okSp),1)<date(2014,4,1)
|| _poz50:={? date(#(__okSp+4),#(2+__okSp),1)>=date(2009,1,1) & date(#(__okSp+4),#(2+__okSp),1)<=date(2012,8,1)
           || 1276
           |? date(#(__okSp+4),#(2+__okSp),1)>=date(2012,9,1) & date(#(__okSp+4),#(2+__okSp),1)<=date(2012,12,1)
           || 1386
           |? date(#(__okSp+4),#(2+__okSp),1)>=date(2013,1,1) & date(#(__okSp+4),#(2+__okSp),1)<=date(2014,3,1)
           || 1500
           || 0
           ?};
   exec('d_save','!ppl_zes_exso',_ref,50,'Wynagrodzenie minimalne',_poz50,,2 )
?};

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,51,'Kwota ustalona',0,,2);

exec('d_save','!ppl_zes_exso',_ref,52,'Koszty płacy',__Ch[63],,2);
:: Brak informacji w programie - eksportujemy stala wartosc 0
_poz53:=0;
exec('d_save','!ppl_zes_exso',_ref,53,'Pomniejszenia (dofinansowania z innych źródeł)',_poz53,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,54,'Limit kosztów płacy',0,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,55,'DO WYPŁATY',0,,2,12);
1


\INFDPr8
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Eksport dokumentu INF-D-P (wersja 8).
::   WE: odczyt wymaganych zmiennych globalnych
::  OLD: \INFDPr8/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
exec('zero_ch','!ppl_zes_exso');
_q:=15*' ';
_nw:=exec('eol','!ppl_zes_exso');

_ref:=SOD_N.ref;
_izk:={? SOD_N.SOD_P().KOR='K' || 'K' || 'Z' ?};

   _tresc:=
       _q+'<daneInformacji nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,20)+
                        '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
                        '" okresSprawozdawczy="'+(((('00'+$SOD_N.SOD_P().MP))+2)+'-'+($SOD_N.SOD_P().R))+'"'+
   _nw+_q+' okresSprawozdawczyWynagrodzenie="'+exec('d_read','!ppl_zes_exso',_ref,18)+
                      '" rodzajInformacji="'+_izk+'" />'+
   _nw+_q+' <metrykaPracownika>'+
   _nw+_q+'<daneEwidencyjne imie1="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                         '" imie2="'+exec('d_read','!ppl_zes_exso',_ref,7)+
                         '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,5)+
                         '" nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+
                         '" nrDowodu="'+exec('d_read','!ppl_zes_exso',_ref,3)+
                         '" pesel="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" />'+
   _nw+_q+' <adresPracownika>'+
   _nw+_q+'  <adres gmina="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                 '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,12)+
                 '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                 '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,15)+
                 '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,16)+
                 '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,13)+
                 '" powiat="'+exec('d_read','!ppl_zes_exso',_ref,9)+
                 '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,14)+
                 '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" />'+
   _nw+_q+'  </adresPracownika>'+
   _nw+_q+'  <infNiepelnospr chronLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,23,0),SOD.PR)+'" '+
                  'chronLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,29,0),SOD.PR)+'" '+
                  'chronSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,26,0),SOD.PR)+'" '+
                  'chronSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,32,0),SOD.PR)+'" '+
                  'chronSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,25,0),SOD.PR)+'" '+
                  'chronSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,31,0),SOD.PR)+'" '+
                  'chronSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,24,0),SOD.PR)+'" '+
                  'chronSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,30,0),SOD.PR)+'" '+
                  'chronUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,22,0),SOD.PR)+'" '+
                  'chronUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,28,0),SOD.PR)+'" '+
                  'chronZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,21,0),SOD.PR)+'" '+
                  'chronZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,27,0),SOD.PR)+'" '+
                  'normLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,35,0),SOD.PR)+'" '+
                  'normLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41,0),SOD.PR)+'" '+
                  'normSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38,0),SOD.PR)+'" '+
                  'normSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,44,0),SOD.PR)+'" '+
                  'normSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37,0),SOD.PR)+'" '+
                  'normSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,43,0),SOD.PR)+'" '+
                  'normSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36,0),SOD.PR)+'" '+
                  'normSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42,0),SOD.PR)+'" '+
                  'normUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,34,0),SOD.PR)+'" '+
                  'normUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40,0),SOD.PR)+'" '+
                  'normZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,33,0),SOD.PR)+'" '+
                  'normZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39,0),SOD.PR)+'" />'+
   _nw+_q+'  <zatrudnienie '+
                  'efektZachety="'+exec('d_read','!ppl_zes_exso',_ref,48)+'" '+
                  'kosztyPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,52,0),SOD.PR)+'" '+
                  'kwDofWyplata="0,00" '+
                  'kwUstalona="0,00" '+
                  'limitKosztowPlacy="0,00" '+
                  'okresZatrOdDnia="'+exec('txt_dt','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,45))+'" '+
                  'pomniejszenia="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,53,0),SOD.PR)+'" '+
                  'pracWykDzG="'+exec('d_read','!ppl_zes_exso',_ref,47)+'" '+
                  'stanowiPomocPubliczna="'+exec('d_read','!ppl_zes_exso',_ref,46,0)+'" '+
                  'wynMinimalne="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,50,0),2)+'" />'+
   _nw+_q+'  <pomocPubliczna kwota="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,49,0),SOD.PR)+'" /> '+
   _nw+_q+'</metrykaPracownika>'+
   _nw;
exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\WNDs6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Dokument WND - (wersja 6).
::  OLD: \WNDs6/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_bank:=exec('rachunki_banki','rachunki');
_pole26:=_pole27:=_pole28:=_pole29:=_pole30:=_pole31:=_pole32:=_pole33:=_pole34:='';

:: szukanie pelnomocnika w poprzednim dokumencie
_dgr:=date(2011,12,0);
_pole25:=exec('read_last','!ppl_zes_exso',25,'',_dgr);

{? (_pole25=~~ & FUN.ask('Czy w imieniu pracodawcy występuje pełnomocnik?'@)) |
:: ^ Brak pełnomocnika, a okazuje się, że występuje lub
:: v Pełnomocnik wypełniony lub
   (type_of(_pole25)=type_of('') & _pole25<>'')
||
:: Zgloszenie wysyla pelnomocnik pracodawcy
   {? _pole25=~~ || _pole25:='' ?};
   {? _pole25<>''
   || _pole26:=exec('read_last','!ppl_zes_exso',26,'',_dgr); {? _pole26=~~ || _pole26:='' ?};
      _pole27:=exec('read_last','!ppl_zes_exso',27,'',_dgr); {? _pole27=~~ || _pole27:='' ?};
      _pole28:=exec('read_last','!ppl_zes_exso',28,'',_dgr); {? _pole28=~~ || _pole28:='' ?};
      _pole29:=exec('read_last','!ppl_zes_exso',29,'',_dgr); {? _pole29=~~ || _pole29:='' ?};
      _pole30:=exec('read_last','!ppl_zes_exso',30,'',_dgr); {? _pole30=~~ || _pole30:='' ?};
      _pole31:=exec('read_last','!ppl_zes_exso',31,'',_dgr); {? _pole31=~~ || _pole31:='' ?};
      _pole32:=exec('read_last','!ppl_zes_exso',32,'',_dgr); {? _pole32=~~ || _pole32:='' ?};
      _pole33:=exec('read_last','!ppl_zes_exso',33,'',_dgr); {? _pole33=~~ || _pole33:='' ?};
      _pole34:=exec('read_last','!ppl_zes_exso',34,'',_dgr); {? _pole34=~~ || _pole34:='' ?}
   ?};
   undefine();
   define('P25',_pole25,'Nazwa pełnomocnika*: ','Nazwa pełnomocnika - pole wymagane',60,60);
   define('HD_0',~~,'  Adres pełnomocnika');
   define('P26',_pole26,'ulica: ','ulica',45,45);
   define('P27',_pole27,'nr domu*: ','nr domu',10,10);
   define('P28',_pole28,'nr lokalu: ','nr lokalu',5,5);
   define('P29',_pole29,'miejscowość*: ','miejscowość',30,30);
   define('P30',_pole30,'kod pocztowy*: ','kod pocztowy',10,10);
   define('P31',_pole31,'poczta*: ','poczta',30,30);
   define('P32',_pole32,'telefon*: ','telefon',14,14);
   define('P33',_pole33,'fax: ','telefax',14,14);
   define('P34',_pole34,'e-mail: ','adres e-mail',40,40);
   define('HD_1',~~,'');
   define('HD_2',~~,'Pola oznaczone * są wymagane.');
   define('HD_3',~~,'Wszystkie informacje można poprawić');
   define('HD_4',~~,'przed wysłaniem zestawu do programu');
   define('HD_5',~~,'SODiR OffLine');
   define('HD_6',~~,'(podane dane nie są weryfikowane automatycznie).');
   {!
   |? {? def_edit("{? DEFINE.P25=''
                   || FUN.emsg('Podanie nazwy pełnomocnika jest wymagane.'@); 'P25'
                   |? DEFINE.P27=''
                   || FUN.emsg('Pole >>nr domu<< jest wymagane.'@); 'P27'
                   |? DEFINE.P29=''
                   || FUN.emsg('Pole >>miejscowość<< jest wymagane.'@); 'P29'
                   |? DEFINE.P30=''
                   || FUN.emsg('Pole >>kod pocztowy<< jest wymagane.'@); 'P30'
                   |? DEFINE.P31=''
                   || FUN.emsg('Pole >>poczta<< jest wymagane.'@); 'P31'
                   |? DEFINE.P32=''
                   || FUN.emsg('Pole >>nr telefonu<< jest wymagane.'@); 'P32'
                   || 1
                   ?}
                  ",'Uzupełnij/zweryfikuj dane pełnomocnika'@)
      ||  _pole25:=DEFINE.P25; _pole26:=DEFINE.P26; _pole27:=DEFINE.P27; _pole28:=DEFINE.P28; _pole29:=DEFINE.P29;
          _pole30:=DEFINE.P30; _pole31:=DEFINE.P31; _pole32:=DEFINE.P32; _pole33:=DEFINE.P33; _pole34:=DEFINE.P34;
          0
      || {? FUN.ask('Rezygnacja spowoduje usunięcie zapisu\n'
                    'o przygotowaniu dokumentów przez pełnomocnika.\n'
                    'Ustawienie można zmienić wypełniając w nagłówku\n'
                    'dokumentu WND informację o pełnomocniku i jego adresie.\n'
                    'Czy na pewno kontynuować?'@)
         || _pole25:=_pole26:=_pole27:=_pole28:=_pole29:=_pole30:=_pole31:=_pole32:=_pole33:=_pole34:='';
            0
         || 1
         ?}
      ?}
   !};
   undefine()
|| _pole25:=''
?};
{? _pole25=''
||
:: Zgloszenie wysyla pracodawca
   _pole26:={? __G[46] || KST.KULICA || '' ?};
   _pole27:={? __G[46] || KST.KDOM || '' ?};
   _pole28:={? __G[46] || KST.KLOKAL || '' ?};
   _pole29:={? __G[46] || KST.KMIASTO || '' ?};
   _pole30:={? __G[46] || KST.KKOD || '' ?};
   _pole31:={? __G[46] || KST.KPOCZTA || '' ?};
   _pole32:={? __G[46] || KST.KTEL || '' ?};
   _pole33:={? __G[46] || KST.KFAX || '' ?};
   _pole34:={? __G[46] || KST.KEMAIL || '' ?}
?};

_ref:=SOD_N.ref;
_xINFDP:=$exec('count','!ppl_zes_exso','INF-D-P');
exec('d_save','!ppl_zes_exso',_ref,0,'Wersja',6,'B');

exec('d_save','!ppl_zes_exso',_ref,2,'Numer w rejestrze PFRON',__G[45],'B');
exec('d_save','!ppl_zes_exso',_ref,3,'NIP',exec('txt_cut','!ppl_zes_exso',exec('txt_cut','!ppl_zes_exso',KST.NIP,'-'),'-'),'B');
exec('d_save','!ppl_zes_exso',_ref,4,'REGON',14+(KST.REG+(14*'0')),'B');
exec('d_save','!ppl_zes_exso',_ref,5,'Pełna nazwa pracodawcy',{? __G[46] || KST.NAZWA || '' ?},'B');

:: pola 6-9 - eksportujemy - pola wymagane do eksportu, od 1 lipca 2022 r. wysyłka w SODiR OffLine jest zablokowana
exec('d_save','!ppl_zes_exso',_ref,6,'Forma prawna pracodawcy',__G[22]);
exec('d_save','!ppl_zes_exso',_ref,7,'Szczegółowa forma prawna pracodawcy',__G[21]);
exec('d_save','!ppl_zes_exso',_ref,8,'Forma własności',__G[23]);
exec('d_save','!ppl_zes_exso',_ref,9,'Wielkość pracodawcy',__G[25]);

exec('d_save','!ppl_zes_exso',_ref,10,'Kod adresu przedsiębiorcy',{? __G[46] || ((7*'0')+KST.GMGUS)+7 || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,11,'PKD wnioskodawcy',{? __G[46] || STR.gsub(KST.PKD,'.','') || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,12,'Okres sprawozdawczy',__okSp,'B');

:: pole 13 - nie wyliczamy ze wzgledu na brak wyliczen kwoty do wyplaty na dokumentach INF-D-P (pole eksportowane z zerowa wartoscia)
:: exec('d_save','!ppl_zes_exso',_ref,13,'Należna kwota dofinansowania',0,'B',2);

exec('d_save','!ppl_zes_exso',_ref,14,'Liczba załączników INF-D-P',_xINFDP,'B');
exec('d_save','!ppl_zes_exso',_ref,15,'Nr rachunku',{? _bank || SKID_RBK.N || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,16,'Ulica',{? __G[46] || 45+KST.ULICA || '' ?},'B',45);
exec('d_save','!ppl_zes_exso',_ref,17,'Nr domu',{? __G[46] || KST.DOM || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Nr lokalu',{? __G[46] || KST.LOKAL || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Miejscowość',{? __G[46] || KST.MIASTO || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,20,'Kod pocztowy',{? __G[46] || KST.KOD || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,21,'Poczta',{? __G[46] || KST.POCZTA || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,22,'telefon',{? __G[46] || KST.PFTEL || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,23,'fax',{? __G[46] || KST.PFFAX || '' ?},'B');
exec('d_save','!ppl_zes_exso',_ref,24,'e-mail',{? __G[46] || KST.PFEMAIL || '' ?},'B');

exec('d_save','!ppl_zes_exso',_ref,25,'Pełnomocnik wyst. w im. wnioskodawcy',_pole25,,60);
_koresp:='KORESPONDENCJA/PEŁNOMOCNIK: ';
exec('d_save','!ppl_zes_exso',_ref,26,_koresp+'Ulica',45+_pole26,,45);
exec('d_save','!ppl_zes_exso',_ref,27,_koresp+'nr domu',_pole27);
exec('d_save','!ppl_zes_exso',_ref,28,_koresp+'nr lokalu',_pole28);
exec('d_save','!ppl_zes_exso',_ref,29,_koresp+'Miejscowość',_pole29);
exec('d_save','!ppl_zes_exso',_ref,30,_koresp+'Kod pocztowy',_pole30);
exec('d_save','!ppl_zes_exso',_ref,31,_koresp+'Poczta',_pole31);
exec('d_save','!ppl_zes_exso',_ref,32,_koresp+'tel.',_pole32);
exec('d_save','!ppl_zes_exso',_ref,33,_koresp+'fax',_pole33);
exec('d_save','!ppl_zes_exso',_ref,34,_koresp+'e-mail',_pole34);

exec('d_save','!ppl_zes_exso',_ref,35,'Status pracodawcy (ZPCH,ZAZ,INNY)',{? KST.PFZPCCZY=1 || 'ZPCH' || 'INNY' ?},,4);

exec('d_save','!ppl_zes_exso',_ref,36,'Liczba osób nowozatrudnionych',__G[32],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'Stan zatrudnienia ogółem',__G[27],,3);
exec('d_save','!ppl_zes_exso',_ref,38,'Stan zatrudnienia niepełnosprawnych',__G[52],,3);
exec('d_save','!ppl_zes_exso',_ref,39,'Bieżący stan zatrudnienia ogółem',__G[55],,3);

::od stycznia 2015 roku pozycja 40 nie jest wypełniana w 6 wersji WND zapis 0 do pliku
{? date(#(__okSp+4),#(2+__okSp),1)<date(2015,1,1)
|| exec('d_save','!ppl_zes_exso',_ref,40,'Bieżący stan zatrudnienia niepełnospr. ogółem',__G[54],,3)
?};

exec('d_save','!ppl_zes_exso',_ref,41,'Stan zatrudnienia ogółem za 12 miesięcy',__G[28],,3);
::od stycznia 2015 roku pozycja 42 nie jest wypełniana w 6 wersji WND zapis 0 do pliku
{? date(#(__okSp+4),#(2+__okSp),1)<date(2015,1,1)
|| exec('d_save','!ppl_zes_exso',_ref,42,'Stan zatrudnienia niepełn. za 12 miesięcy',__G[53],,3)
?};

exec('d_save','!ppl_zes_exso',_ref,43,'Data wypełnienia',date(),'B');
exec('d_save','!ppl_zes_exso',_ref,99,'Adres do korespondencji taki sam?',{? +_pole25 || 'N' || __G[50] ?});
exec('d_save','!ppl_zes_exso',_ref,100,'Ośw. o wybr. el. formy skł. wniosków','T',,1);
exec('d_save','!ppl_zes_exso',_ref,101,'Załączono inf. o otrzym. pom. de minimis','N',,1);
1


\WNDr6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [12.41]
:: OPIS: Eksport dokumentu typu WND (wersja 6).
::  OLD: \WNDr6/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
_ref:=SOD_N.ref;
_dw:=DEFINE.DATA;

    _izk    :={? SOD_N.SOD_P().KOR='K' || _zglo:='N'; 'K' || _zglo:='T'; 'Z' ?};
    _statP  :=~-exec('d_read','!ppl_zes_exso',_ref,35);
    _elekt  :=~-exec('d_read','!ppl_zes_exso',_ref,100);
    _demin  :=~-exec('d_read','!ppl_zes_exso',_ref,101);

    _nw:=exec('eol','!ppl_zes_exso');
    _q:=13*' ';

      _tresc:=
            _q+'<daneInformacji '+
                        'czyZgloszeniowy="'+_zglo+'" '+
                        'dataWypelnienia="'+exec('txt_dt','!ppl_zes_exso',_dw)+'" '+
                        'imieNazwiskoOsobyPodpisujacej="" '+
                        'liczbaINFDP="'+exec('d_read','!ppl_zes_exso',_ref,14)+'" '+
                        'nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" '+
                        'okresSprawozdawczy="'+exec('d_read','!ppl_zes_exso',_ref,12)+'" '+
                        'rodzajInformacji="'+_izk+'" '+
                        'uwagi=""/>'+
       _nw+_q+'<kartaPracodawcy>'+
       _nw+_q+'   <daneEwidencyjne '+
                     'nip="'+exec('d_read','!ppl_zes_exso',_ref,3)+'" '+
                     'pelnaNazwaPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,5)+'" '+
                     'pkd="'+exec('d_read','!ppl_zes_exso',_ref,11)+'" '+
                     'regon="'+exec('d_read','!ppl_zes_exso',_ref,4)+'"/>'+
       _nw+_q+'   <dodInfPracodawcy '+
                     'formaPrawnaPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,6)+'" '+
                     'formaWlasnosci="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" '+
                     'statusPracodawcyIP="'+{? _statP<>'ZPCH' & _statP<>'ZAZ' || 'T' || 'N' ?}+'" '+
                     'statusPracodawcyZAZ="'+{? _statP='ZAZ' || 'T' || 'N' ?}+'" '+
                     'statusPracodawcyZPC="'+{? _statP='ZPCH' || 'T' || 'N' ?}+'" '+
                     'szczegolowaFormaPrawna="'+exec('d_read','!ppl_zes_exso',_ref,7)+'" '+
                     'wielkoscPracodawcy="'+exec('d_read','!ppl_zes_exso',_ref,9)+'"/>'+
       _nw+_q+'   <adresPracodawcy>'+
       _nw+_q+'      <adres '+
                        'kodAdresuPrzedsiebiorcy="'+exec('d_read','!ppl_zes_exso',_ref,10)+'" '+
                        'kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,20)+'" '+
                        'miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,19)+'" '+
                        'nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,17)+'" '+
                        'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,18)+'" '+
                        'poczta="'+exec('d_read','!ppl_zes_exso',_ref,21)+'" '+
                        'ulica="'+exec('d_read','!ppl_zes_exso',_ref,16)+'"/>'+
       _nw+_q+'      <kontakt '+
                        'email="'+exec('d_read','!ppl_zes_exso',_ref,24)+'" '+
                        'faks="'+exec('d_read','!ppl_zes_exso',_ref,23)+'" '+
                        'telefon="'+exec('d_read','!ppl_zes_exso',_ref,22)+'"/>'+
       _nw+_q+'   </adresPracodawcy>'+
       _nw+_q+'   <infDofinansowanie ogolem="0,00"/>'+
       _nw+_q+'   <rachunekBankowy nrRachunku="'+exec('d_read','!ppl_zes_exso',_ref,15)+'"/>'+
       _nw+_q+'   <adresKorespondencyjny>'+
       _nw+_q+'      <adres '+
                        'adresJak="'+exec('d_read','!ppl_zes_exso',_ref,99)+'" '+
                        'czyPelnomocnik="'+{? exec('d_read','!ppl_zes_exso',_ref,25)='' || 'N' || 'T' ?}+'" '+
                        'kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,30)+'" '+
                        'miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,29)+'" '+
                        'nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,27)+'" '+
                        'nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,28)+'" '+
                        'poczta="'+exec('d_read','!ppl_zes_exso',_ref,31)+'" '+
                        'ulica="'+exec('d_read','!ppl_zes_exso',_ref,26)+'"/>'+
       _nw+_q+'      <kontakt '+
                        'email="'+exec('d_read','!ppl_zes_exso',_ref,34)+'" '+
                        'faks="'+exec('d_read','!ppl_zes_exso',_ref,33)+'" '+
                        'telefon="'+exec('d_read','!ppl_zes_exso',_ref,32)+'"/>'+
       _nw+_q+'   </adresKorespondencyjny>'+
       _nw+_q+'</kartaPracodawcy>'+
       _nw+_q+'<osoba nazwaPelnomocnika="'+exec('d_read','!ppl_zes_exso',_ref,25)+'"/>'+
       _nw+_q+'<stanZatrudnienia '+
                  'biezacyOkresNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40,0),3)+'" '+
                  'biezacyOkresOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39),SOD.PR)+'" '+
                  'nowozatrudnieni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36),SOD.PR)+'" '+
                  'poprzedzajacyOkresNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42,0),3)+'" '+
                  'poprzedzajacyOkresOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41),SOD.PR)+'" '+
                  'wOkresieNiepelnosprawni="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38),SOD.PR)+'" '+
                  'wOkresieOgolem="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37),SOD.PR)+'"/>'+
       _nw+_q+'<oswiadczenie '+
                  'czyElektronicznie="'+_elekt+'" '+
                  'czyPapierowo="'+{? _elekt='T' || 'N' || 'T' ?}+'" '+
                  'zalaczaInfoONieotrzymanejPomocy="'+{? _demin='T' || 'N' || 'T' ?}+'" '+
                  'zalaczaInfoOOtrzymanejPomocy="'+_demin+'"/>'+
       _nw;

    exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\leg_sodir
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [17.00]
:: OPIS: Akcja "Legenda" w oknie SOD
::  OLD: \leg_sodir/menu.fml
::----------------------------------------------------------------------------------------------------------------------
exec('legenda','color','SOD#01#01')


\leg_sodir_poz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [17.00]
:: OPIS: Akcja "Legenda" w oknie SOD
::  OLD: \leg_sodir_poz/menu.fml
::----------------------------------------------------------------------------------------------------------------------
exec('legenda','color','SODIRPOZ#')


\INFDPs9
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [20.14]
:: OPIS: Generowanie i zapis do bazy dokumentu INF-D-P w wersji 9
::   WE: odczyt wymaganych zmiennych globalnych
::       _a - nazwa plikowa dokumentu
::  OLD: \INFDPs9/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
{? ~exec('NAGs','!ppl_zes_exso',_a) || return(0) ?};
{? __G[56]=''
|| __G[56]:={? FUN.ask('Czy pracodawca wykonuje działalność gospodarczą?'@) || 'T' || 'N' ?}
?};
{? __G[57]=''
||
   {!
   |? _fch:=FUN.choice(
         'Wybierz sposób ustalania efektu zachęty:\n'
         '(bez względu na wybór, w pierwszej kolejności poszukiwana jest informacja w poprzednich zestawach)\n'
         'automatycznie - metoda ilościowa, sposób drugi zgodnie z wyrokiem TSWE,\n'
         'domyślnie TAK - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie T,\n'
         'domyślnie NIE - jeśli nie znaleziono w poprzednim zestawie wstawione zostanie N.'@,,
         'aUtomatycznie'@,'domyślnie TAK'@,'domyślnie NIE'@,,'');
      {? _fch=1 || __G[57]:='A'
      |? _fch=2 || __G[57]:='T'
      |? _fch=3 || __G[57]:='N'
      ?};
      __G[57]=''
   !}
?};
P.OSOBA();
{? -menu_txt='wybierz'
|| _firstZ:=FUN.ask('Czy pracownik '+OSOBA.NAZWISKO+' '+OSOBA.PIERWSZE+' zgłaszany po raz pierwszy?')
|| _firstZ:=1;
   _pm:=date(#(__okSp+4),(#(2+__okSp))-1,0);
   SOD_P.cntx_psh();
   SOD_P.index('SOD_P');
   SOD_P.prefix('SODIR','SODIR',_pm~1,_pm~2);
   {? SOD_P.first()
   || SOD_S.cntx_psh();
      SOD_S.index('SOD_S2');
      SOD_S.prefix('INF-D-P',);
      {? SOD_S.first()
      || SOD_N.cntx_psh();
         SOD_N.blank();
         SOD_N.SOD_P:=SOD_P.ref();
         SOD_N.SOD_S:=SOD_S.ref();
         SOD_N.NAZ:=OSOBA.NAZWISKO;
         SOD_N.IM:=OSOBA.PIERWSZE;
         SOD_N.PESEL:=OSOBA.PESEL;
         _firstZ:=~SOD_N.find_rec();
         SOD_N.cntx_pop()
      ?};
      SOD_S.cntx_pop()
   ?};
   SOD_P.cntx_pop()
?};
_xINFDP:=exec('count','!ppl_zes_exso','INF-D-P');
_ref:=SOD_N.ref;
_EfZach:=__G[57];
{? __Ch[50]<=date(#(__okSp+4),(#(2+__okSp))-12,0)
|| SOD_P.cntx_psh();
   SOD_N.cntx_psh();
   SOD_N.index(__nSOD_N);
   SOD_N.prefix(OSOBA.PESEL,OSOBA.NAZWISKO,OSOBA.PIERWSZE,'T');
   SOD.cntx_psh();
   _EfZach:='';
   {? SOD_N.first
   || {!
      |? {? SOD_N.SOD_P().R<2011
         || 0
         || {? $SOD_N.SOD_P().R<>(SOD.name+4) || SOD.use('sod'+$SOD_N.SOD_P().R) ?};
            SOD.index('SODN');
            SOD.prefix(SOD_N.ref);
            _wtmp:=exec('d_read','!ppl_zes_exso',SOD_N.ref,0);
            {? var_pres('_wtmp')=type_of(0) & _wtmp=6
            || _EfZach:=exec('d_read','!ppl_zes_exso',SOD_N.ref,48)
            ?};
            _EfZach='' & SOD_N.next
         ?}
      !}
   ?};
   SOD.cntx_pop();
   SOD_N.cntx_pop();
   SOD_P.cntx_pop();

   {? _EfZach=''
   || {? __G[57]='A'
      || OSOBA.cntx_psh();
         _niepZ:=exec('srzatr_niep_new','!ppl_zes_exso',date(__Ch[50]~1,(__Ch[50]~2)-11,1),__Ch[50],1);
         _axd:=date(__Ch[50]~1,(__Ch[50]~2)-1,1);
         _niepP:=exec('srzatr_niep_new','!ppl_zes_exso',date(_axd~1,(_axd~2)-11,1),_axd,1);
         _EfZach:={? _niepZ>_niepP || 'T' || 'N' ?};
         OSOBA.cntx_pop()
      || _EfZach:=__G[57]
      ?}
   ?}
?};
{? _EfZach<>'T' & _EfZach<>'N' || _EfZach:='N' ?};

exec('d_save','!ppl_zes_exso',_ref,0,'Wersja dokumentu',9,'B');

exec('d_save','!ppl_zes_exso',_ref,1,'Numer w rejestrze PFRON',__G[45],'B');
exec('d_save','!ppl_zes_exso',_ref,2,'PESEL',OSOBA.PESEL,,11);
exec('d_save','!ppl_zes_exso',_ref,3,'Dowód osobisty',{? +OSOBA.PESEL || '' || OSOBA.DOWOD ?},,9);
exec('d_save','!ppl_zes_exso',_ref,4,'NIP',{? +OSOBA.PESEL || '' || exec('txt_cut','!ppl_zes_exso',OSOBA.NIP,'-') ?},,10);
exec('d_save','!ppl_zes_exso',_ref,5,'Nazwisko',OSOBA.NAZWISKO,,60);
exec('d_save','!ppl_zes_exso',_ref,6,'Pierwsze imię',OSOBA.PIERWSZE,,60);
{? _firstZ || exec('d_save','!ppl_zes_exso',_ref,7,'Drugie imię',OSOBA.DRUGIE,,60) ?};

_ad_mp:=exec('szukaj','osoba','S',date(#(__okSp+4),(#(2+__okSp))-1,0));
{? _ad_mp=null || _ad_mp:=exec('szukaj','osoba','C',date(#(__okSp+4),(#(2+__okSp))-1,0)) ?};
_ad_ms:=exec('szukaj','osoba','S',date(#(__okSp+4),#(2+__okSp),0));
{? _ad_ms=null || _ad_ms:=exec('szukaj','osoba','C',date(#(__okSp+4),#(2+__okSp),0)) ?};
{? _ad_ms<>null & (_firstZ | _ad_mp<>_ad_ms)
|| exec('d_save','!ppl_zes_exso',_ref,8,'Województwo',exec('kod_woje','!ppl_zes_exso',OS_ADRES.WOJEWODZ),,2);
   exec('d_save','!ppl_zes_exso',_ref,9,'Powiat',OS_ADRES.POWIAT,,30);
   exec('d_save','!ppl_zes_exso',_ref,10,'Gmina',OS_ADRES.GMINA,,30);
   exec('d_save','!ppl_zes_exso',_ref,11,'Miejscowość',OS_ADRES.MIASTO,,30);
   exec('d_save','!ppl_zes_exso',_ref,12,'Kod pocztowy',OS_ADRES.KOD,,6);
   exec('d_save','!ppl_zes_exso',_ref,13,'Poczta',OS_ADRES.POCZTA,,30);
   exec('d_save','!ppl_zes_exso',_ref,14,'Ulica',30+OS_ADRES.ULICA,,30);
   exec('d_save','!ppl_zes_exso',_ref,15,'Nr domu',OS_ADRES.DOM,,5);
   exec('d_save','!ppl_zes_exso',_ref,16,'Nr lokalu',OS_ADRES.LOKAL,,4)
?};

exec('d_save','!ppl_zes_exso',_ref,17,'Okres sprawozdawczy',__okSp,'B');
exec('d_save','!ppl_zes_exso',_ref,18,'Okres wypłaty wynagrodzenia',__okWp,'B');
exec('d_save','!ppl_zes_exso',_ref,19,'Informacja (zwykła/korygująca)',SOD_N.SOD_P().KOR,'B');

exec('d_save','!ppl_zes_exso',_ref,20,'Nr kolejny informacji',_xINFDP,'B');

exec('d_save','!ppl_zes_exso',_ref,21,'niep.znaczna,s.szczeg.,ZPCH',__Ch[6]+__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,22,'niep.umiarkowana,s.szczeg.,ZPCH',__Ch[5]+__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,23,'niep.lekka,s.szczeg.,ZPCH',__Ch[4]+__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,24,'niep.znaczna,ZPCH',__Ch[12]+__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,25,'niep.umiarkowana,ZPCH',__Ch[11]+__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,26,'niep.lekka,ZPCH',__Ch[10]+__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,27,'niep.znaczna,s.szczeg.,emeryt,ZPCH',__Ch[56],,3);
exec('d_save','!ppl_zes_exso',_ref,28,'niep.umiarkowana,s.szczeg.,emeryt,ZPCH',__Ch[55],,3);
exec('d_save','!ppl_zes_exso',_ref,29,'niep.lekka,s.szczeg.,emeryt,ZPCH',__Ch[54],,3);

exec('d_save','!ppl_zes_exso',_ref,30,'niep.znaczna,emeryt,ZPCH',__Ch[53],,3);
exec('d_save','!ppl_zes_exso',_ref,31,'niep.umiarkowana,emeryt,ZPCH',__Ch[52],,3);
exec('d_save','!ppl_zes_exso',_ref,32,'niep.lekka,emeryt,ZPCH',__Ch[51],,3);

exec('d_save','!ppl_zes_exso',_ref,33,'niep.znaczna,s.szczeg.',__Ch[9]+__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,34,'niep.umiarkowana,s.szczeg.',__Ch[8]+__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,35,'niep.lekka,s.szczeg.',__Ch[7]+__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,36,'niep.znaczna',__Ch[3]+__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,37,'niep.umiarkowana',__Ch[2]+__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,38,'niep.lekka',__Ch[1]+__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,39,'niep.znaczna,s.szczeg.,emeryt',__Ch[62],,3);
exec('d_save','!ppl_zes_exso',_ref,40,'niep.umiarkowana,s.szczeg.,emeryt',__Ch[61],,3);
exec('d_save','!ppl_zes_exso',_ref,41,'niep.lekka,s.szczeg.,emeryt',__Ch[60],,3);
exec('d_save','!ppl_zes_exso',_ref,42,'niep.znaczna,emeryt',__Ch[59],,3);
exec('d_save','!ppl_zes_exso',_ref,43,'niep.umiarkowana,emeryt',__Ch[58],,3);
exec('d_save','!ppl_zes_exso',_ref,44,'niep.lekka,emeryt',__Ch[57],,3);

exec('d_save','!ppl_zes_exso',_ref,45,'Zatrudnienie od dnia',__Ch[50]);

:: Domyslnie T
exec('d_save','!ppl_zes_exso',_ref,46,'Dof. stanowi pomoc publiczną','T',,1);

exec('d_save','!ppl_zes_exso',_ref,47,'Pracodawca wyk. działaność gosp.',__G[56],,1);

exec('d_save','!ppl_zes_exso',_ref,48,'Zatr. w warunkach efektu zachęty',_EfZach,,1);

:: Brak informacji w systemie - eksportujemy stala wartosc 0
_poz49:=0;
exec('d_save','!ppl_zes_exso',_ref,49,'Kwota pomocy publ. i de minimis',_poz49,,2);

:: zgodnie ze specyfikacja ustalamy wartosci w zaleznosci od okresu
:: od kwietnia 2014 eksportujemy zawsze 0, pozycja nie jest wykazyana w dokumencie INFDP wersja 8
{? date(#(__okSp+4),#(2+__okSp),1)<date(2014,4,1)
|| _poz50:={? date(#(__okSp+4),#(2+__okSp),1)>=date(2009,1,1) & date(#(__okSp+4),#(2+__okSp),1)<=date(2012,8,1)
           || 1276
           |? date(#(__okSp+4),#(2+__okSp),1)>=date(2012,9,1) & date(#(__okSp+4),#(2+__okSp),1)<=date(2012,12,1)
           || 1386
           |? date(#(__okSp+4),#(2+__okSp),1)>=date(2013,1,1) & date(#(__okSp+4),#(2+__okSp),1)<=date(2014,3,1)
           || 1500
           || 0
           ?};
   exec('d_save','!ppl_zes_exso',_ref,50,'Wynagrodzenie minimalne',_poz50,,2 )
?};

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,51,'Kwota ustalona',0,,2);

exec('d_save','!ppl_zes_exso',_ref,52,'Koszty płacy',__Ch[63],,2);
:: Brak informacji w programie - eksportujemy stala wartosc 0
_poz53:=0;
exec('d_save','!ppl_zes_exso',_ref,53,'Pomniejszenia (dofinansowania z innych źródeł)',_poz53,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,54,'Limit kosztów płacy',0,,2);

:: zgodnie ze specyfikacja eksportujemy 0 - brak prezentacji
:: exec('d_save','!ppl_zes_exso',_ref,55,'DO WYPŁATY',0,,2,12);
1


\INFDPr9
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DAROKR [20.14]
:: OPIS: Eksport dokumentu INF-D-P (wersja 9).
::   WE: odczyt wymaganych zmiennych globalnych
::  OLD: \INFDPr9/sodir.fml
::----------------------------------------------------------------------------------------------------------------------
_tresc:='';
exec('zero_ch','!ppl_zes_exso');
_q:=15*' ';
_nw:=exec('eol','!ppl_zes_exso');

_ref:=SOD_N.ref;
_izk:={? SOD_N.SOD_P().KOR='K' || 'K' || 'Z' ?};

   _tresc:=
       _q+'<daneInformacji nrKolejny="'+$exec('d_read','!ppl_zes_exso',_ref,20)+
                        '" nrPfron="'+exec('d_read','!ppl_zes_exso',_ref,1)+
                        '" okresSprawozdawczy="'+(((('00'+$SOD_N.SOD_P().MP))+2)+'-'+($SOD_N.SOD_P().R))+'"'+
   _nw+_q+' okresSprawozdawczyWynagrodzenie="'+exec('d_read','!ppl_zes_exso',_ref,18)+
                      '" rodzajInformacji="'+_izk+'" />'+
   _nw+_q+' <metrykaPracownika>'+
   _nw+_q+'<daneEwidencyjne imie1="'+exec('d_read','!ppl_zes_exso',_ref,6)+
                         '" imie2="'+exec('d_read','!ppl_zes_exso',_ref,7)+
                         '" nazwisko="'+exec('d_read','!ppl_zes_exso',_ref,5)+
                         '" nip="'+exec('d_read','!ppl_zes_exso',_ref,4)+
                         '" nrDowodu="'+exec('d_read','!ppl_zes_exso',_ref,3)+
                         '" pesel="'+exec('d_read','!ppl_zes_exso',_ref,2)+'" />'+
   _nw+_q+' <adresPracownika>'+
   _nw+_q+'  <adres gmina="'+exec('d_read','!ppl_zes_exso',_ref,10)+
                 '" kodPocztowy="'+exec('d_read','!ppl_zes_exso',_ref,12)+
                 '" miejscowosc="'+exec('d_read','!ppl_zes_exso',_ref,11)+
                 '" nrDomu="'+exec('d_read','!ppl_zes_exso',_ref,15)+
                 '" nrLokalu="'+exec('d_read','!ppl_zes_exso',_ref,16)+
                 '" poczta="'+exec('d_read','!ppl_zes_exso',_ref,13)+
                 '" powiat="'+exec('d_read','!ppl_zes_exso',_ref,9)+
                 '" ulica="'+exec('d_read','!ppl_zes_exso',_ref,14)+
                 '" wojewodztwo="'+exec('d_read','!ppl_zes_exso',_ref,8)+'" />'+
   _nw+_q+'  </adresPracownika>'+
   _nw+_q+'  <infNiepelnospr chronLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,23,0),SOD.PR)+'" '+
                  'chronLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,29,0),SOD.PR)+'" '+
                  'chronSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,26,0),SOD.PR)+'" '+
                  'chronSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,32,0),SOD.PR)+'" '+
                  'chronSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,25,0),SOD.PR)+'" '+
                  'chronSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,31,0),SOD.PR)+'" '+
                  'chronSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,24,0),SOD.PR)+'" '+
                  'chronSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,30,0),SOD.PR)+'" '+
                  'chronUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,22,0),SOD.PR)+'" '+
                  'chronUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,28,0),SOD.PR)+'" '+
                  'chronZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,21,0),SOD.PR)+'" '+
                  'chronZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,27,0),SOD.PR)+'" '+
                  'normLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,35,0),SOD.PR)+'" '+
                  'normLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,41,0),SOD.PR)+'" '+
                  'normSLekki="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,38,0),SOD.PR)+'" '+
                  'normSLekkiEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,44,0),SOD.PR)+'" '+
                  'normSUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,37,0),SOD.PR)+'" '+
                  'normSUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,43,0),SOD.PR)+'" '+
                  'normSZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,36,0),SOD.PR)+'" '+
                  'normSZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,42,0),SOD.PR)+'" '+
                  'normUmiarkowany="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,34,0),SOD.PR)+'" '+
                  'normUmiarkowanyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,40,0),SOD.PR)+'" '+
                  'normZnaczny="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,33,0),SOD.PR)+'" '+
                  'normZnacznyEmeryt="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,39,0),SOD.PR)+'" />'+
   _nw+_q+'  <zatrudnienie '+
                  'efektZachety="'+exec('d_read','!ppl_zes_exso',_ref,48)+'" '+
                  'kosztyPlacy="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,52,0),SOD.PR)+'" '+
                  'kwDofWyplata="0,00" '+
                  'kwUstalona="0,00" '+
                  'limitKosztowPlacy="0,00" '+
                  'okresZatrOdDnia="'+exec('txt_dt','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,45))+'" '+
                  'pomniejszenia="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,53,0),SOD.PR)+'" '+
                  'pracWykDzG="'+exec('d_read','!ppl_zes_exso',_ref,47)+'" '+
                  'stanowiPomocPubliczna="'+exec('d_read','!ppl_zes_exso',_ref,46,0)+'" '+
                  'wynMinimalne="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,50,0),2)+'" />'+
   _nw+_q+'  <pomocPubliczna kwota="'+exec('int2str','!ppl_zes_exso',exec('d_read','!ppl_zes_exso',_ref,49,0),SOD.PR)+'" /> '+
   _nw+_q+'</metrykaPracownika>'+
   _nw;
exec('f_save','!ppl_zes_exso',__FF,_tresc);
+_tresc


\tree_zalacz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: J9SZAFRA [21.37]
:: OPIS: Tworzy tabelę nawigatora dla konkretnej paczki.
::   WE: ~~
::   WY: alias tabeli
::----------------------------------------------------------------------------------------------------------------------
tab_tmp(2,
   'PARENT','TREE_REF','Rodzic'@,
   'ID','STRING[20]','Symbol paczki'@,
   'KOD','STRING[80]','Kod'@,
   'OPIS','STRING[80]','Opis'@,
   'NAG','STRING[20]','Dokument nagłówkowy'@,
   'REF','STRING[16]','Wskazanie'@,
   'DOC','STRING[80]','Nazwa dokumentu'@
   )


\tree_wnd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: J9SZAFRA [21.37]
:: OPIS: Tworzy okno wertowania dla tabeli nawigatora.
::   WE: _a [TABLE] - alias tabeli nawigatora
::   WY: alias okna wertowania
::----------------------------------------------------------------------------------------------------------------------
_TREE:=_a;
_win:=_TREE.mk_sel('Dokument/załącznik'@,'P',0,'#dynatree',,,,1);
_TREE.win_fld(_win,, 'OPIS',,, 30,,,,1);
_TREE.win_fld(_win,, 'KOD',,, 30,,,,1);
_TREE.win_act(_win,,'Formuła','Dołącz'@@,,,"params_exec('f_add','!ppl_zes_exso')",,1);
_TREE.win_act(_win,1,'Formuła','Dołącz'@@,,,"params_exec('f_add','!ppl_zes_exso')",,1);
_TREE.win_act(_win,,'Formuła','Usuń'@@,,,"params_exec('f_delete','!ppl_zes_exso')");
_TREE.win_act(_win,,'Formuła','Zwiń/&rozwiń'@@,,,"params_exec('zwin_rozwin','#tree')",,,,,,,,'target=window');
_TREE.win_btn(_win,'text=Dołącz','menu:D');
_TREE.win_btn(_win,'text=Usuń','menu:U');
_TREE.win_sel(_win);
_win


\synchronize_tree
::----------------------------------------------------------------------------------------------------------------------
::  UTW: J9SZAFRA [21.37]
:: OPIS: Synchronizuje zawartość nawigatora z tabelami SOD_N, SOD_S oraz SOD_P.
::   WE: ~~
::   WY: ~~
::----------------------------------------------------------------------------------------------------------------------
params_set(_par:=params_get());
{? _par.tree_tab.last()
|| {!|?
   _par.tree_tab.del();
   _par.tree_tab.last()
   !}
?};
__DOC.for_each("
   _par:=params_get().tree_tab;
   {? __DOC.ID=$__IDP
   || _par.PARENT:=0;
      _par.REF:=_par.KOD := '';
      _par.OPIS:=__DOC.DOK;
      _par.ID:=__DOC.ID;
      _par.NAG:=__DOC.NAG;
      _par.DOC:='';
      _par.add();
      _parent:=_par.ref();
      _doc_par:=_par.OPIS;
      SOD_N.index('SOD_N3');
      SOD_N.prefix(SOD_P.ref,__DOC.DOK,__DOC.DOK);
      {? SOD_N.first()
      || {!
         |? _par.PARENT:=#_parent;
            _par.OPIS:=SOD_N.NAZ+' '+SOD_N.IM;
            _par.REF:=$SOD_N.ref();
            _par.KOD:=SOD_N.PESEL;
            _par.ID:='';
            _par.DOC:=_doc_par;
            _par.add();
            SOD_N.next()
         !}
      ?}
   ?}
");
_par.tree_tab.first();
__DOC.find_tab(,'DOK',,'=',_par.tree_tab.OPIS);
~~

:Sign Version 2.0 jowisz:1048 2023/06/23 14:09:37 18b61b94d92e5304345697e5d7fe9ac41e6ec3f0b4ada45e33721852789d66ee0da85c0df9a536b1c2e79725eae38309255d3efee947e228e80071ce3ba51d9a35181c487832d482a30bf540d911843b67353bbd50ce06c76d7efa64922c5d04dde814dc614141ace45180628a8762726e241700cebf54a6630d3698eb8b9f38
