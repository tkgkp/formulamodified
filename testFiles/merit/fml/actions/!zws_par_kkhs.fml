:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !zws_par_kkhs.fml
:: Utworzony: 20.02.2017
:: Autor: AWI
::======================================================================================================================
:: Zawartość: Subkonta kontrahentów
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.14]
:: OPIS: Formuła główna czynności
::       UWAGA. Do pobrania parametrów stosować params_get() = tablica nazwana:
::       in  - [obj_new] - parametry wejściowe czynności
::       int - [obj_new] - parametry wewnętrzne czynności
::       out - [obj_new] - parametry wyjściowe czynności
::       mp  - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
::# kind=WE,   symbol=KH,  type=_KH,   name=Kontrahent,  required=T, keyref=T
::# properties=GRP_FIRM
_in:=params_get().in;
_mp:=params_get().mp;

_akcja:=_mp.akcja();
_auto:=_mp.isAutoRun();

exec('czytaj','#stalesys',,XINFO,'KRAJ');
exec('RB','object');

{? _mp.isMicro()=0 & _in.KH=null()
|| FUN.info('Nie wskazano kontrahenta. Czynność zostanie zakończona.'@);
   _mp.done()
|? _akcja='Multi' | exec('subkonta','rachunki',1+_auto,_in.KH)
|| _mp.done()
?}


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.14]
:: OPIS: Formuła TO-DO
::       UWAGA. Do pobrania parametrów stosować params_get() = tablica nazwana:
::       in  - [obj_new] - parametry wejściowe czynności
::       int - [obj_new] - parametry wewnętrzne czynności
::       out - [obj_new] - parametry wyjściowe czynności
::       mp  - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
_mp:=params_get().mp;
_in:=_mp.load(exec('kind_in','#b_port'));

{? var_pres('KH',_in)=type_of(null()) & _in.KH
|| 'Wygeneruj subkonto dla kontrahenta: %1'@@[exec('record','#to_string',_in.KH)]
|| ''@@
?}


\generuj
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.14]
:: OPIS: Generuj subkonto dla kontrahenta
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_params:=exec('mp_run_a','#b__box');
_params.ACT_UID:='ZWS_PAR_KKHS';
_params.UIDREF:=KH.uidref();
_params.PORTS_IN:=exec('portsIn','#b__box',_params.ACT_UID);
exec('portsInSet','#b__box',_params.PORTS_IN,_params.ACT_UID,'KH',KH.ref());

exec('mp_run','#b__box',_params)

:Sign Version 2.0 jowisz:1048 2020/10/16 15:19:23 d6c6693405824f9aa8ebd16faa6b2d2c8382ef1bded7d5ecaa7f1906ca25ee419773c185e864e8660010f368aca2c2e6c54752582dc120030925f897bf7f8fc2750657f2b2ffc6504d9c28ce92206c6e8aa626e94d2f22bf7bb45b2522196cdbecbcf5b67fb4b79abd59f5afe55be3c5336e0b7ea431e9c9d856062a1755f097
