:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_ved_dvge.fml
:: Utworzony: 30.06.2023
:: Autor: PBS
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_VED_DVGE - Akceptacja deklaracji JPK_GV
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Akceptacja deklaracji JPK_GV - główna formuła czynności FKS_VED_DVGE
::----------------------------------------------------------------------------------------------------------------------
::# permissions=FJKS
::# kind=WE, symbol=DEKLARACJA, type=_VAT_DEK, name=Deklaracja JPK_GV, required=T, keyref=T
:: PARAMETRY WY:
::# kind=WY, symbol=DEKLARACJA, type=_VAT_DEK, name=Deklaracja JPK_GV, required=T

params_exec('akceptacja','fks_ved','GV')


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Opis czynności TODO
::----------------------------------------------------------------------------------------------------------------------
_typ:=params_exec('desc','fks_ved','JPK_GV','Akceptuj deklarację ');
_desc:='Akceptuj deklarację %1'@@[_typ]


\clean
::----------------------------------------------------------------------------------------------------------------------
::  UTW: JK [22.26]
:: OPIS: Funkcja czyszcząca czynności - w razie potrzeby jak nie ma rekordu kluczowego lub dokument jest zaakceptowany
::       zrobi done albo cancel
::       Dodatkowo może być wywoływana przez czynność czyszczącą zadania na TODO
::   WE: [_a] - _mp - obiekt Menadżera procesów
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')>100
|| _mp:=_a
|| _mp:=params_get().mp
?};
_wy:=_mp.load(exec('kind_out','#b_port'));
_keyRefs:=_mp.getRefs();
{? obj_len(_keyRefs)>0
|| {! _it:=1..obj_len(_keyRefs)
   |! _kref:=_keyRefs[_it];
      {? type_of(_kref)>0
      || {? ref_name(_kref)*'vat_dek'>0
         || _vat_dek:=exec('FindAndGet','#table',VAT_DEK,_kref,,,null());
            {? _vat_dek=null()
            || _mp.done()
            |? exec('FindAndGet','#table',VAT_DEK,_kref,,"@.VAT_DEK.STATUS<>'R'",1)
            || _mp.done()
            ?}
         ?}
      ?}
   !}
?};
1

:Sign Version 2.0 jowisz:1045 2023/09/07 12:13:11 4ac670d6737988b54a2e1379c1ba5f8b5f580ec5ffac7addd284e63e63a270c8ba6d936ceaae5cd5df782e700848edb2cdba60ebeae70f9e16796146f8dd45df8dca964f222595228a49e4f6a8a809d2de4b20cf3a8c020758153a73609ecb0513e3874873af589d02d61df39493f25bf90b9cf14183cda3231d81fcbc563751
