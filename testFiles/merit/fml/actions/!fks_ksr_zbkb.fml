:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_ksr_zbkb.fml
:: Utworzony: 16.04.2015
:: Autor: MB
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_KSR_ZBKB - Blokowanie kont
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Blokowanie kont - główna formuła czynności FKS_KSR_ZBKB.
::----------------------------------------------------------------------------------------------------------------------
~~


\blok_an_tt
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Blokowanie/odblokowanie konta ksiegowego.
::   WE: _a - T-blokowano N-odblokowanie
::----------------------------------------------------------------------------------------------------------------------
{? TT_STKON.STAN<>_a
|| {? {? _a='T'
        || FUN.ask('Czy chcesz zablokować konto %1 ?'@[TT_STKON.KONTO])
        || FUN.ask('Czy chcesz odblokować konto %1 ?'@[TT_STKON.KONTO])
       ?}
   || _inn_bl:=0;
      do();
      TT_STKON.STAN:=_a;
      {? TT_STKON.put()
      || AN.prefix();
         {? AN.seek(BB.sqlint(TT_STKON.REF_AN),form(8+TT_STKON.REF_AN))
         || {? AN.STAN<>_a
            || AN.STAN:=_a;
               {? ~AN.put() || undo() ?}
            || _inn_bl:=1
            ?}
         || undo()
         ?}
      || undo()
      ?};
      {? end()
      || {? _inn_bl
         ||  {? _a='T'
             ||  FUN.info('Analityka została zablokowana przez innego operatora.'@)
             ||  FUN.info('Analityka została odblokowana przez innego operatora.'@)
             ?}
       ?}
      || FUN.info('Nie udało się zablokować anlityki konta.'@)
      ?}
   ?}
|| {? _a='T'
   ||  FUN.info('Konto %1 jest już zablokowane.'@[TT_STKON.KONTO])
   ||  FUN.info('Konto %1 jest już odblokowane'@[TT_STKON.KONTO])
   ?}
?}


\blok_an
::----------------------------------------------------------------------------------------------------------------------
::  UTW: ?? [?????]
:: OPIS: Blokowanie/odblokowanie konta ksiegowego.
::       Funkcja sluzy do zablokowania/odblokowania konta ksiegowego. Po zablokowaniu nie bedzie
::       mozna akceptowac i ksiegowac dokumentow z pozycjami na zablokowane konto.
::       Bedzie to mozliwe dopiero po odblokowaniu konta.
::   WE: _a - typ operacji: T-blokada N-otwarcie
::  OLD: \blok_an/param.fml
::----------------------------------------------------------------------------------------------------------------------
{? AN.STAN<>_a
|| {? {? _a='T'
        || FUN.ask('Zablokować konto %1 ?'@[AN.SYM])
        || FUN.ask('Odblokować konto %1 ?'@[AN.SYM])
       ?}
   || _k:=AN.SYM;
      AN.cntx_psh();
      AN.index('SYM');
      AN.prefix(_k);
      {? AN.first()
      || {!
         |? AN.STAN:=_a;
            AN.put;
            AN.next
         !}
      ?};
      AN.cntx_pop()
   ?}
|| {? _a='T'
   ||  FUN.info('Konto %1 jest już zablokowane.'@[AN.SYM])
   ||  FUN.info('Konto %1 jest już odblokowane'@[AN.SYM])
   ?}
?};
1

:Sign Version 2.0 jowisz:1028 2019/06/07 15:55:42 277645d5d3f0d58c15ff4c41545d75cc5591e79e419cbefbd4c8671c7cbeafbd26f7efdf8d2c2ddbb4f9e0ff4cf4c8fdf5e5d14834ef82c6b4366d0e897f781955a814018f50816b0113f28d9e14ccc377341629c043a6055ab98bf151e0d0e080635fb5b7ce873d7f452afa02175c91bed7f46b387864f268358c63a7d39363
