:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !pkd_zes_zube.fml
:: Utworzony: 16.06.2016
:: Autor: areKc
::======================================================================================================================
:: Zawartość: Formuły czynności PKD_ZES_ZUBE - Raporty zgłoszeniowe do ZUS
::======================================================================================================================

\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [17.00]
:: OPIS: Przygotowanie raportów zgłoszeniowych do ZUS z obszaru PKD
::   WE:
::   WY:
::  OLD: \menu/rap_zus.fml
::----------------------------------------------------------------------------------------------------------------------
::# permissions=F_ZATR,UD_SKL
{? ~__F_ZATR.control(1,'P','Z') || return() ?};
VAR_DEL.delete('zus');
{? (_typ:=exec('wyb_rap_zglo','rap_zus'))<>''
|| _inTerm:=exec('interm','#system');
:: przygotowanie katalogu tymczasowego po stronie serwera dla pracy w inTerm
   _file:='';
   {? _inTerm
   || _tmp_dir:=fmk_tmp_dir(0);
      {? type_of(_tmp_dir)<>type_of(~~)
      || _pth:=_tmp_dir.get_path();
         _file:='';
         _sep:=exec('sep','#file',2);
         _file:=_pth+_sep
      || FUN.emsg('Nie udało się utworzenie katalogu tymczasowego po stronie serwera.'@);
         return()
      ?}
   ?};
   ZUS.blank();
   ZUS.FOLDER:={? _inTerm || '' || exec('get','#profile',,OPERATOR.USER().KOD,'lokalny katalog raportów ZUS') ?};
   ZUS.PLIK:=-_typ;
   ZUS.DATA:=date();
   ZUS.RAPORT:='ZUS '+_typ;
   ZUS.DATAG:=#0;
   {? exec('zus_dialog','rap_zus',_typ,__F_ZATR.P,0,_file)
   || exec('oZus','rap_zus');
      exec('zus_win_sel','rap_zus',_typ,__F_ZATR.P);
      exec('zus_'+(-_typ)+'_generuj','rap_zus',null(),__F_ZATR.P,'PKD');
      VAR_DEL.delete('zus')
   ?};
   {? ~_inTerm
   || exec('set','#profile',,OPERATOR.USER().KOD,'lokalny katalog raportów ZUS',ZUS.FOLDER)
   ?}
?}

:Sign Version 2.0 jowisz:1045 2022/06/30 14:22:52 db980804b53be066c24d21d1c666da4563fd4679a2753fef434c76fcc50cebdae2092e3d8ee208a72e5fb6088f5da9e99011d1af41b6b4f37e4680ad3a227b26b5cdf60fc3c4b57a03c95c9b6439637c4c0c97b034ca9cffc4c0fadd656cd42e840f65ff95fc93fa1ff1add4e44dfb3e17513a2898b054925ffabc918444ab62
