:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !lmg_int_dint.fml
:: Utworzony: 18.01.2016
:: Autor: AWI
::======================================================================================================================
:: Zawartość: Wysłanie deklaracji INTRASTAT do UC
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: Formuła główna czynności
::       UWAGA. Do pobrania parametrów stosować params_get() = tablica nazwana:
::       in  - [obj_new] - parametry wejściowe czynności
::       int - [obj_new] - parametry wewnętrzne czynności
::       out - [obj_new] - parametry wyjściowe czynności
::       mp  - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
::# permissions=ODDZ
::# kind=WE,   symbol=IST,       type=_IST,     name=Deklaracja INTRASTAT, required=T, keyref=T
::# kind=WY,   symbol=FILE,      type=STRING,   name=Deklaracja INTRASTAT, required=N
_in:=params_get().in;
_out:=params_get().out;
_mp:=params_get().mp;

exec('init','lmg');

:: Uruchomiona akcja
_akcja:=_mp.akcja();

:: Uruchomiona automatycznie
_auto:=_mp.isAutoRun();

{? _mp.pathTodo()
:: Ustawienie kontekstu wg instancji elementu w procesie
|| {? var_pres('IST',_in)=type_of(null()) & _in.IST
   || 1
   || _mp.error('Brak parametru wyjściowego INT.')
   ?}
?};

{? _akcja='Xml'
   | _mp.pathTodo()
   | _mp.pathArea() & _akcja='' & _auto
:: Obsługa Xml - dołącz w oknie obszaru i start procesu z pulpitu
|| IST.cntx_psh();
   IST.prefix();
   {? IST.seek(_in.IST)
   ||
::    Parametr 'akcja' wykorzystywany w formułach przycisków 'Pozycje', 'Zakończ'
      params_set('out',_out,'mp',_mp,'akcja',_akcja);
      _xml:=exec('xml','intrastat',_auto);

      {? IST.Z
::    Utworzono xml
      || {? _xml=1 || _mp.done() |? ~_mp.isMicro() || _mp.keep() ?}
::    Nie utworzono xml
      || _mp.cancel()
      ?}
   ?};
   IST.cntx_pop()

|| _mp.error('Nieobsługiwana ścieżka.')
?}


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: Formuła TO-DO
::       UWAGA. Do pobrania parametrów stosować params_get() = tablica nazwana:
::       mp  - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
_mp:=params_get().mp;
_in:=_mp.load(exec('kind_in','#b_port'));

{? var_pres('IST',_in)=type_of(null()) & _in.IST
|| 'Utwórz deklarację Intrastat wywóz xml: %1'@@[exec('record','#to_string',_in.IST)]
|| ''
?}

:Sign Version 2.0 jowisz:1048 2020/10/16 15:19:14 602dec2e75858d88178a0538abe2ddc2c3d30bef6eecdaac63518987650df3b355dfc97b74346986d2d1e72f7a49155376d97d0ae9223b31600e69d0b404d5cd88b5d40c0b63ae9ece19f30e5b2a4d29ad9479a3d880d4360815d71a2b7e48b17c58edd13c3d8d06be9eda0335bf07f3177169e17f4a9c118be00bf40a637e89
