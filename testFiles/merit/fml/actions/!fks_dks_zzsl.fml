:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_vat_zzsl.fml
:: Utworzony: 24.08.2015
:: Autor: MB
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_DKS_ZZSL - Zapytania SQL dotyczące dokumentów księgowych
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MB [17.00]
:: OPIS: Zapytaia SQL dotyczące dokumentów księgowych - główna formuła czynności FKS_DKS_ZZSL
::   WE: [_a] - uruchomienie z pulpitu? [1] - tak, 0 - nie
::----------------------------------------------------------------------------------------------------------------------
::# permissions=FJKS,FREJ
{? _=0 || _a:=1 ?};
params_set(params_get());
{? _a=1
|| exec('open_tabele','open_tab','F')
?};
exec('m_sql','#sql','FKS_DKS_ZZSL','Dokumenty źródłowe')


\poz_br
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMA [7.60]
:: OPIS: Zwraca maske tabeli POZ dla biezacego roku
::  OLD: \poz_br/form_sql.fml
::----------------------------------------------------------------------------------------------------------------------
'pozy'+$SSTALE.AR().KOD+'*'


\dok_br
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMA [7.60]
:: OPIS: Zwraca maske tabeli DOK dla biezacego roku
::  OLD: \dok_br/form_sql.fml
::----------------------------------------------------------------------------------------------------------------------
'doku'+$SSTALE.AR().KOD+'*'


\rej_dok_sch
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [JH] [12.30]
:: OPIS: Tworzy tab_tmp wykorzystywana w zapytaniu parametryzacyjnym
::            Rejestry z typami dokumentow i schematami dekretacji
:: WY: Tabela zwracajaca rekordy do zapytania sql
::  OLD: \rej_dok_sch/skid_zes.fml
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('X_Xcie');
X_Xcie:=tab_tmp(,'KOD','STRING[8]','Kod'
               ,'NAZ','STRING[60]','Nazwa rejestru'
               ,'ODD','STRING[8]','Jednostka'
               ,'WAL','STRING[1]','Walutowy'
               ,'RODZ','STRING[8]','Rodzaj dokumentu'
               ,'NAZ_DOK','STRING[60]','Nazwa dokumentu'
               ,'VAT_KOD','STRING[3]','Kod schematu'
               ,'VAT_NAZ','STRING[8]','Nazwa schematu');
REJ.cntx_psh;
DOK_REJ.cntx_psh;
REJ.index('KOD');
REJ.prefix(SSTALE.AR);
{? REJ.first
|| {!
   |?
      X_Xcie.blank();
      X_Xcie.KOD:=REJ.KOD;
      X_Xcie.NAZ:=REJ.NAZ;
      X_Xcie.WAL:=REJ.WAL;
      X_Xcie.ODD:=REJ.ODD().OD;
      X_Xcie.add();
      DOK_REJ.index('NAZ');
      DOK_REJ.prefix(REJ.ref);
      {? DOK_REJ.first
      ||
         {!
         |?
            X_Xcie.blank();
            X_Xcie.RODZ:=DOK_REJ.SLO().KOD;
            X_Xcie.NAZ_DOK:=DOK_REJ.NAZ;
            X_Xcie.VAT_KOD:=DOK_REJ.AV().KOD;
            X_Xcie.VAT_NAZ:=DOK_REJ.AV().OP;
            X_Xcie.add;
            DOK_REJ.next
         !}
      ?};
   REJ.next
   !}
?};
DOK_REJ.cntx_pop;
REJ.cntx_pop;
X_Xcie

:Sign Version 2.0 jowisz:1048 2023/06/23 14:09:39 7de75284d8c8a50344649a238ab023e5df7076fdf227ae18b0e553f38a12e59f7c8cfced09e9a0090a82eadb1d5806a3fa87e6fa1fb43b3c830b87a61b3523eac960295f7cf9cb22156df90d84e8b8c644cb733f06d7c246236fb5439f239184d50dce1247072cdcc0c1f1e09ccb2b968c29cf9bca68edc7bbfce8a7d3959f96
