:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !pba_bpb_gzes.fml
:: Utworzony: 28.01.2019
:: Autor: RO
::======================================================================================================================
:: Zawartość: Obsługa czynności PBA_BPB_GZES - Generowanie zestaawienia z ankiety.
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [19.22]
:: OPIS: Generowanie zestawienia z ankiety - główna formuła czynności.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
::# kind=WE, symbol=ZA_ZEST, type=_ZA_ZEST, name=Opis ankiety, required=T, keyref=T
::
params_set(_par:=params_get());
_mp:=_par.mp;
_in:=_par.in;
_out:=_par.out;
_context:=_par.context;
_akcja:=_mp.akcja();

{? _akcja='webTermProcCancel'
|| return(~~)
?};

_ret:=exec('run','!pba_bpb_gzes',_in.ZA_ZEST,_akcja);
{? _mp.isMicro()
|| _mp.done()
|? _ret
|| _mp.done()
|| _mp.keep()
?};

~~


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [19.22]
:: OPIS: Generowanie dokumentu oceny - formuła opisu zadania.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
'Zestawienie ankieta'@@
::_mp:=params_get().mp;
::_in:=_mp.load(exec('kind_in','#b_port'));
::
::_ret:='Wygeneruj dokument oceny';
::{? (app_info('web_tabid')='' | exec('env_wt','poc',1)) & type_of(_in.ZO_TEST)=type_of(null()) & _in.ZO_TEST<>null()
::|| ZO_TEST.cntx_psh();
::   ZO_TEST.prefix();
::   {? ZO_TEST.seek(_in.ZO_TEST)
::   || _ret+=' dla '+exec('record','#to_string',ZO_TEST.ZZ_OSOBA,1)
::   ?};
::   ZO_TEST.cntx_pop()
::?};
::
::_ret


\run
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [19.22]
:: OPIS: Obsługa akcji z czynności.
::   WE:  _a  [REFERENCE] - Opis ankiety (ZA_ZEST).
::       [_b] [STRING]    - Kod akcji do wykonania: GENERUJ*/POBIERZ
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_ref:={? var_pres('_a')=type_of(null()) & _a<>null() & ref_tab(_a)=ZA_ZEST || _a || null() ?};
_akcja:={? var_pres('_b')=type_of('') || _b || 'GENERUJ' ?};

_zz_dokz:=null();
ZA_ZEST.cntx_psh();
ZA_ZEST.prefix();
{? ZA_ZEST.seek(_ref)
   || exec('excel','!pba_bpb_gzes')

::      _zz_dokz:=exec('zz_dok','!poc_ocw_gdok');
::      ZZ_DOKZ.cntx_psh();
::      ZZ_DOKZ.prefix();
::      {? ZZ_DOKZ.seek(_zz_dokz)
::      || ZZ_DOKZ.web_bl_download('PLIK')
::      ?};
::      ZZ_DOKZ.cntx_pop()
?};
ZA_ZEST.cntx_pop()
:_zz_dokz<>null()


\excel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RO [19.22]
:: OPIS: Właściwa akcja generowania zestawienia z ankiety. Formuła wymaga poprawnie ustawionego środowiska,
::       w szczególności jest wykonywana dla bieżącego rekordu tabeli ZA_ZEST.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
exec('ank_excel','phr_dane',ZA_ZEST.ref())

:Sign Version 2.0 jowisz:1048 2020/10/16 15:19:16 615d29f4e497c23ff8913451dfdbddaa65958528bac4a7f84577e4d313e862f65625250b5bbd65bd1be6783221b6612b36d442bbc6debe04842c63f4c332dcec5b85d598df2599920ceb0ba89c207cc9351112d0ef5af514c09c1667c4c73415599887dbe20365773fc9b8108105b01df64d4d110a03e212984e57d793c5bf60
