:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !pkd_zes_orsl.fml
:: Utworzony: 12.05.2016
:: Autor: areKc
::======================================================================================================================
:: Zawartość: Formuły czynności PKD_ZES_ORSL - Wydruk słowników
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [17.00]
:: OPIS: Wydruk słowników - główna formuła czynności.
::   WY:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
::# permissions=F_ZATR,UD_SKL
exec('rep_exec','#b_report','PKD_ZES_ORSL','p_sl*',,1)


\kalendarze
::----------------------------------------------------------------------------------------------------------------------
::  UTW: areKc [17.00]
:: OPIS: Okno parametryzacji wydruku do zdefiniowanych kalendarzy.
::   WY:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
KAL_NAZW.index('KAL_CZES');
KAL_NAZW.prefix(exec('ref_firma','ustawienia'),'N');
KAL_ROK.index('KAL_ROK');

_mode:='maximized';
_tab:=tab_tmp(2,
   'NAZ','STRING[16]','Nazwa kalendarza',
   'ROK','STRING[16]','Rok wybranego kalendarza'
);

_wn:=KAL_NAZW.mk_sel('Kalendarze'@,,,'sl_kalendarze',,,,,'U',,,,,_mode);
KAL_NAZW.win_fld(_wn,,'NAZWA',,,25,,1,'Kalendarz'@);
KAL_NAZW.win_act(_wn,,'Kolejność');
KAL_NAZW.win_act(_wn,,'Rekord',,,,
   "  _par:=params_get();
      _par.tab.find_key($KAL_NAZW.ref())
   "
);

_wr:=KAL_ROK.mk_sel('Lata'@,,,'sl_lata',30,,,,'U',,,,,_mode);
KAL_ROK.win_fld(_wr,,'ROK',,,10,,1,'Lata'@);
KAL_ROK.win_act(_wr,,'Formuła','Wybierz'@@,,'Wybór roku'@,
   "  _par:=params_get();
      _par.tab.NAZ:=$KAL_ROK.NAZWA;
      _par.tab.ROK:=$KAL_ROK.ref();
      _par.tab.add()
   ",,1,1,,,'W'
);
KAL_ROK.win_act(_wr,,'Formuła','W&ycofaj'@@,,'Wycofanie wyboru roku'@,
   "  _par:=params_get();
      {? _par.tab.find_key($KAL_ROK.NAZWA,$KAL_ROK.ref()) || _par.tab.del() ?}
   ",,,1,,,'Y'
);
KAL_ROK.win_act(_wr,,'Formuła','Drukuj'@@,,'Drukowanie wybranych pozycji'@,"sel_exit()",,,1,,,'D',
                ,'target=window,icon=print');
KAL_ROK.win_act(_wr,,'Kolejność');
KAL_ROK.win_act(_wr,,'Rekord',,,,
   "  _par:=params_get();
      _gray:={? _par.tab.first() || '' || 'D' ?};
      _gray+={? _par.tab.find_key($KAL_ROK.NAZWA,$KAL_ROK.ref()) || 'W' || 'Y' ?};
      KAL_ROK.actions_grayed(_par.wr,_gray);
      _gray='W'
   "
);
KAL_ROK.win_btn(_wr,'text=%1,panel=right,align=begin'['Wybierz'@],'menu:W');
KAL_ROK.win_btn(_wr,'text=%1,panel=right,align=begin'['Wycofaj'@],'menu:Y');
KAL_ROK.win_btn(_wr,'text=%1,panel=right,align=end'['Drukuj'@],'menu:D');
KAL_ROK.win_btn(_wr,'text=%1,panel=right,align=end'['Anuluj'@],'key:Esc');

_wg:=KAL_NAZW.grp_make('Kalendarze'@,,'p_skalendarze',,,,,_mode);
KAL_NAZW.win_sel(_wg);
KAL_NAZW.grp_sel(_wg,,_wn,,
   "  params_set(_par:=params_get());
      KAL_ROK.prefix(KAL_NAZW.ref());
      KAL_ROK.first();
      grp_disp(KAL_ROK,params_get().wr)
   ",,,,,,,,_mode
);
KAL_NAZW.grp_splt(_wg,,'vertical','Lata');
KAL_NAZW.grp_sel(_wg,KAL_ROK,_wr,,,,,,,,,,_mode
);

params_set('tab',_tab,'wr',_wr);
{? ~KAL_NAZW.select()
   & _tab.size()
   & FUN.ask('Niektóre kalendarze zostały wybrane do wydruku.'@+'\n'+'Czy na pewno zrezygnować?'@)
|| _tab.erase()
?};

_tab

:Sign Version 2.0 jowisz:1045 2022/06/30 14:22:52 52d63042a8d92a6a16e9bd3a095acd8912ab388f6c2118e6f0935dad94f72a63da02e38ecf42825ea7ac9af0544b75570bc7d50f6a82d3f042965f446f80db7b46fa99fbb2cf0a9a24b45fcd8473065fde2e4c0dc339fea554a598521736174ffc1f3ce165af6e212ae1438914fc09e77179dd5a9f12c160dfd902b0dd929afb
