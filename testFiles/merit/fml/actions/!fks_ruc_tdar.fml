:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_ruc_tdar.fml
:: Utworzony: 22.10.2015
:: Autor: AMK
::======================================================================================================================
:: Zawartość: Formuły czynności FKS_RUC_TDAR - Rejestracja planu faktoringu
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Rejestracja planu faktoringu - główna formuła czynności FKS_RUC_TDAR
::----------------------------------------------------------------------------------------------------------------------
::# permissions=FJKS
::# parses=exec('parses_par_nag','rozrach')
::# kind=WY, symbol=PAR_NAG, type=_PAR_NAG, name=Wskazanie na nagłówek planu umowy faktoringu, required=T, keyref=T
_par:=params_get();
_in:=params_get().in;
_out:=params_get().out;
_mp:=params_get().mp;
_akcja:=_mp.akcja();
SER_KOR.TYP:='F';
:: czynność startowa
{? _mp.pathProc()
|| menu_txt(,'Dołącz');
   _mp.trigRef('PAR_NAG');
   params_exec('kom_dol','rozrach')
|? _mp.pathTodo()
|| menu_txt(,'Popraw');
   {? var_press('PAR_NAG',_out)>0
   || _ref:=BB.sqlint($_out.PAR_NAG); _nam:=form(($_out.PAR_NAG)-8);
      {? _ref<>0 & _nam<>''
      || PAR_NAG.cntx_psh(); PAR_NAG.prefix();
         {? PAR_NAG.seek(_ref,_nam)
         || {? PAR_NAG.TYP=SER_KOR.TYP
            || params_exec('kom_pop','rozrach',1)
            || FUN.info('Wybrana umowa nie jest umową faktoringu.'@); _mp.error()
            ?}
         || FUN.info('Nie znaleziono umowy faktoringu.'@);
            _out.PAR_NAG:=null;
            _mp.save(,_out);
            _mp.done()
         ?};
         PAR_NAG.cntx_pop()
      || FUN.info('Nie znaleziono umowy faktoringu.'@);
         _out.PAR_NAG:=null;
         _mp.save(,_out);
         _mp.done()
      ?}
   || FUN.info('Nie znaleziono umowy faktoringu.'@);
      _out.PAR_NAG:=null;
      _mp.save(,_out);
      _mp.done()
   ?}
|? _akcja='Dołącz'
|| menu_txt(,'Dołącz');
   _mp.trigRef('PAR_NAG');
   params_exec('kom_dol','rozrach')
|? _akcja='Popraw0'
|| menu_txt(,'Popraw');
   params_exec('kom_pop','rozrach',0)
|? _akcja='Popraw1'
|| menu_txt(,'Popraw');
   params_exec('kom_pop','rozrach',1)
|? _akcja='Zakoncz'
|| menu_txt(,'Popraw');
   params_exec('kom_zak_plan','rozrach')
?};
~~


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Formuła na opis czynności na liście ToDo
::----------------------------------------------------------------------------------------------------------------------
_desc:='Zakończ rejestrację umowy faktoringu'@@;
_mp:=params_get().mp;
_wy:=_mp.load(exec('kind_out','#b_port'));
{? var_pres('PAR_NAG',_wy)
|| _ref:=BB.sqlint($_wy.PAR_NAG); _nam:=form(($_wy.PAR_NAG)-8);
   {? _ref<>0 & _nam<>''
   || PAR_NAG.cntx_psh(); PAR_NAG.use(_nam); PAR_NAG.prefix();
      {? PAR_NAG.seek(_ref,_nam)
      || _desc:='Zakończ rejestrację umowy faktoringu: %1 z dnia %2'@@[PAR_NAG.PAR_UM().SYM,$PAR_NAG.DATA]
      ?};
      PAR_NAG.cntx_pop()
   ?}
?};
_desc


\faktor_new
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Dołączanie planu umowy faktoringu
::----------------------------------------------------------------------------------------------------------------------
_params:=exec('mp_run_a','#b__box');
_params.ACT_UID:='FKS_RUC_TDAR';
_params.AKCJA:='Dołącz';
_params.PORTS_IN:=exec('portsIn','#b__box',_params.ACT_UID);
exec('portsInSet','#b__box',_params.PORTS_IN,_params.ACT_UID);
_params.PROC_START:='T';
exec('mp_run','#b__box',_params)


\faktor_pop
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Poprawianie planu umowy faktoringu
::   WE: _a - 0 - nagłówek
::            1 - pozycje
::----------------------------------------------------------------------------------------------------------------------
_params:=exec('mp_run_a','#b__box');
_params.ACT_UID:='FKS_RUC_TDAR';
_params.AKCJA:={? _a=0 || 'Popraw0' || 'Popraw1' ?};
_params.UIDREF:=PAR_NAG.uidref();
_params.PORTS_IN:=exec('portsIn','#b__box',_params.ACT_UID);
exec('portsInSet','#b__box',_params.PORTS_IN,_params.ACT_UID);
exec('mp_run','#b__box',_params)


\faktor_zak
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Kończenie planu umowy faktoringu
::----------------------------------------------------------------------------------------------------------------------
_params:=exec('mp_run_a','#b__box');
_params.ACT_UID:='FKS_RUC_TDAR';
_params.AKCJA:='Zakoncz';
_params.UIDREF:=PAR_NAG.uidref();
_params.PORTS_IN:=exec('portsIn','#b__box',_params.ACT_UID);
exec('portsInSet','#b__box',_params.PORTS_IN,_params.ACT_UID);
exec('mp_run','#b__box',_params)

:Sign Version 2.0 jowisz:1048 2020/10/16 15:19:12 4d36023743e99465796a124cb09eb8a0c65b000d576c86f772939853a559b87b5bc5c69b119b0ddc5dc32d81efb838fcfbe3874b9a1ae4453a4a2af9a3d3bf548160d187163de6f6c9651c520db4caaad02e834f92b4ddd6466e59c031bae891639d1cdc6722ef8a8a830360fd812c116e30ba0eacba5ae636c8720a41d1ecc0
