:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !ppl_zlc_wucp.fml
:: Utworzony: 02.06.2016
:: Autor: jaws
::======================================================================================================================
:: Zawartość: Obsługa czynności PPL_ZLC_WUCP - Wydruk umowy cywilnoprawnej
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.00]
:: OPIS: Wydruk umowy cywilnoprawnej - główna formuła czynności.
::----------------------------------------------------------------------------------------------------------------------
::# permissions=F_ZATR,UD_SKL
::# access=exec('run_cond_p','pkd','ZC','ZC.P().get()')
::
::# kind=WE, symbol=ZC, type=_ZC, name=Wskazanie umowy cywilnoprawnej, required=T, keyref=T
::
_par:=params_get();
params_set(_par);

_in:=_par.in;
_ib:=_par.int;
_rv:=_par.out;
_mp:=_par.mp;

SEEK.ZC:=_in.ZC;
SEEK.ZC().OSOBA();

_id:=exec('ref2uid','#table',_in.ZC);
_result:='';

{? _id=''
|| _result:=exec('error','!ppl_zlc_wucp')

|? _mp.isMicro()
|| _mp.keyRef(_id);
   exec('zc_drukuj','zlec_rh');
   _mp.delRef(_id);
   _mp.cancel()

|| _mp.save(_ib,_rv);
   _msg:='Wydruk umowy cywilnoprawnej.\n%1\nZawarta z %2'@
      [exec('ZC','#to_string'),exec('OSOBA','#to_string')];
   {? (_todo:=FUN.choice(_msg,,'Zakończ'@,'Drukuj'@))<>0
   || exec('zc_drukuj','zlec_rh')
   ?};
   {? _todo=1
   || _mp.done()
   || _mp.keep()
   ?}
?};

{? _result<>''
:  obsługa błędów
|| _mp.error(_result);
   FUN.emsg(_result)
?};
~~


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.00]
:: OPIS: Wydruk umowy cywilnoprawnej - formuła opisu zadania.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_in:=params_get().mp.load(exec('kind_in','#b_port'));

{? type_of(_in.ZC)<>type_of(null) | _in.ZC=null
|| return(exec('error','!ppl_zlc_wucp'))
?};

SEEK.ZC:=_in.ZC;
SEEK.ZC().OSOBA();

{? OSOBA.OBCY='T'
|| 'Wydrukuj umowę cywilnoprawną: Umowa nr %1 z dnia %2 r. zawartą z %3 %4: Paszport - %5'@@[ZC.NU,ZC.DU$4,OSOBA.NAZWISKO,OSOBA.PIERWSZE,OSOBA.PASZPORT]
|? +OSOBA.PESEL
|| 'Wydrukuj umowę cywilnoprawną: Umowa nr %1 z dnia %2 r. zawartą z %3 %4: PESEL - %5'@@[ZC.NU,ZC.DU$4,OSOBA.NAZWISKO,OSOBA.PIERWSZE,OSOBA.PESEL]
|| 'Wydrukuj umowę cywilnoprawną: Umowa nr %1 z dnia %2 r. zawartą z %3 %4: Data urodzenia - %5'@@[ZC.NU,ZC.DU$4,OSOBA.NAZWISKO,OSOBA.PIERWSZE,$OSOBA.UR_DATA]
?}


\error
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jaws [17.00]
:: OPIS: Zwraca treść komunikatu błędu.
::   WE:
::   WY: treść komunikatu
::----------------------------------------------------------------------------------------------------------------------
'Wydrukowanie umowy cywilnoprawnej niemożliwe.'@

:Sign Version 2.0 jowisz:1048 2020/10/16 15:19:20 4983a7f8d06be576b10ced89e58d8ae3010a63aabc5ec10126f778fdedf4bb407b14220d52d507160d80874ac6b9e0a86ad084484309f3a31eb73705a226ee184b05ec81baf15cc238dda5c6127b27cc14f57235ac326ab6d43a757c353f5ae2d4d71bf85e3f6d1ffa9060ef1169ea1d6b95d8bd0fbcf0338593f4b8667c4189
