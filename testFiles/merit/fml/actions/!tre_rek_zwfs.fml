:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !tre_rek_zwfs.fml
:: Utworzony: 09.03.2021
:: Autor: AKUL
::======================================================================================================================
:: Zawartość: TRE_REK_ZWFS - Utworzenie reklamacji klienta w PDF
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AKUL [21.14]
:: OPIS: Formuła główna czynności
::       UWAGA. Do pobrania parametrów stosować params_get() = tablica nazwana:
::       in  - [obj_new] - parametry wejściowe czynności
::       int - [obj_new] - parametry wewnętrzne czynności
::       out - [obj_new] - parametry wyjściowe czynności
::       mp  - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
::# permissions=ODDZ
::# kind=WE, symbol=REK_N,   type=_REK_N, name=Reklamacja klienta, required=T, keyref=T
::# kind=WE, symbol=CZY_PDF, type=STRING, name=Utwórz PDF,         required=N, keyref=N, fml_val="exec('answer2str','params','TAK','NIE','Czy tworzyć plik w formacie PDF?')"
::# kind=WE, symbol=PRN_MSK, type=STRING, name=Maska wydruku,      required=N, keyref=N
::# kind=WY, symbol=DOKUM,   type=_DOKUM, name=Załącznik,          required=N

_in:=params_get().in;
_out:=params_get().out;
_mp:=params_get().mp;

exec('init','tre');

_akcja:=_mp.akcja();
_auto:=_mp.isAutoRun();

_in_pdf:={? var_pres('CZY_PDF',_in)=type_of('') || _in.CZY_PDF || 'NIE' ?};
_czy_pdf:={? _akcja<>'' || ~(_akcja*'Drukuj') || _in_pdf='TAK' ?};
_keep:=_akcja<>'' & {? _in_pdf='TAK' || _akcja*'Drukuj' || ~(_akcja*'Drukuj') ?};

_msk:={? var_pres('PRN_MSK',_in)=type_of('') & _in.PRN_MSK<>'' & fexists(_in.PRN_MSK+'.rpt',1)
      || _in.PRN_MSK
      || ''
      ?};

{? var_pres('REK_N',_in)=type_of(null()) & _in.REK_N
||
:: Ustawienie kontekstu wg instancji elementu w procesie
   REK_N.cntx_psh();
   REK_N.prefix();
   {? REK_N.seek(_in.REK_N)
   ||
      _result:=exec('rek_n_druk','reklamacje',_czy_pdf,_msk,_auto);
      {? _czy_pdf & _result.WYN
      ||
         _out.DOKUM:=_result.REF;
         _mp.save(,_out);
         {? ~_keep || _mp.done() ?}

      |? ~_czy_pdf & _result.WYN
      ||
         {? ~_keep || _mp.done() ?}
      ?}
   ||
      _mp.error('Nie znaleziono reklamacji.')
   ?};
   REK_N.cntx_pop()
||
   _mp.error('Brak parametru wejściowego REK_N.')
?}


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AKUL [21.14]
:: OPIS: Formuła TO-DO
::       UWAGA. Do pobrania parametrów stosować params_get() = tablica nazwana:
::       mp  - obiekt odpowiedzialny za obsługę procesu
::----------------------------------------------------------------------------------------------------------------------
_mp:=params_get().mp;
_in:=_mp.load(exec('kind_in','#b_port'));

{? var_pres('REK_N',_in)=type_of(null()) & _in.REK_N
||
   {? _in.CZY_PDF='NIE'
   || 'Wydrukuj reklamację klienta: %1'@@[exec('record','#to_string',_in.REK_N)]
   || 'Utwórz PDF do reklamacji klienta: %1'@@[exec('record','#to_string',_in.REK_N)]
   ?}
|| ''
?}


\rek_pdf
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AKUL [21.14]
:: OPIS: Reklamacja klienta - Utwórz PDF
::----------------------------------------------------------------------------------------------------------------------
exec('rek_n_druk_gr','reklamacje',1,'TRE_REK_ZWFS','Area Utwórz PDF')


\rek_prn
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AKUL [21.14]
:: OPIS: Reklamacja klienta - Drukuj
::----------------------------------------------------------------------------------------------------------------------
exec('rek_n_druk_gr','reklamacje',0,'TRE_REK_ZWFS','Area Drukuj')

:Sign Version 2.0 jowisz:1048 2021/04/09 15:19:41 9589f65d6a21c12f9eebf0f106bb8fae097b8bcd9f15a05c2b0a2100dd608d05410107df2bda37b4afaff1e7b3dc92dcd31baca12f81fe8ec5a204fbb49ca000f2db6062300febc4b0d43438d5e32d4c198e45bfee03021a912199e3fcf5ccdc07166e4d2834b9f33e08507fc9ed7f31d3a77f53fde399007b311c875a897f41
