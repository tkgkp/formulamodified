:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzezone
::======================================================================================================================
:: Nazwa pliku: !zws_upg_task.fml [17.00]
:: Utworzony: 2017/02/14
:: Autor: [rr]
::======================================================================================================================
:: Zawartosc: Obsługa zadań potransferowych
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.14]
:: OPIS: Parametryzacja - główna formuła czynności
::       Formuła do wywoływacza ZWS_UPG oraz serwisowa
::----------------------------------------------------------------------------------------------------------------------
::# properties=SERVICE,GRP_FIRM
::# kind=WY, symbol=RESULT,  type=STRING,   name=Rezultat działania,            required=N

_out:=params_get().out;
_mp:=params_get().mp;

:: Uruchomiona akcja
_akcja:=_mp.akcja();
_service:=_mp.isService();
_area:=_mp.pathArea();
_tryb:={? _area || _service |? ~_service || 3 ?};

{? _service || exec('__UPG','#object') ?};
_mode:=__UPG.get_mode();
{? _mode=3 || _tryb:=3 ?};
_res:=exec('run_upgrade','zws',_tryb);

{? var_pres('_out')=type_of(~~)
|| {? ~_service
   || FUN.info('Brak parametru wyjściowego RESULT. Należy zaaktualizować czynność.')
   ?};
   _mp.error('Brak parametru wyjściowego RESULT. Należy zaaktualizować czynność.')
|| _out.RESULT:={? _res>0 || 'OK' |? _res<0 || 'FIRMA' || 'BŁĄD' ?};
   _mp.save(,_out);
   _mp.done()
?};
~~


\desc
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.14]
:: OPIS: Parametryzacja - główna formuła czynności
::       Formuła do wywoływacza ZWS_UPG oraz serwisowa opis na TODO
::----------------------------------------------------------------------------------------------------------------------
'Uruchom aktualizację zadań potransferowych'@@


\run_upgrade
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.00]
:: OPIS: dołączenie dokumentu magazynowego
::----------------------------------------------------------------------------------------------------------------------
{? FUN.ask('Czy uruchomić automatyczną aktualizację?'@)
|| UPG_TASK.cntx_psh();
   UPG_REAL.cntx_psh();
   UPG_MSG.cntx_psh();
   _params:=exec('mp_run_a','#b__box');
   _params.ACT_UID:='ZWS_UPG_TASK';
   _params.AKCJA:='Uruchom';
   _params.PROC_START:='T';

   exec('mp_run','#b__box',_params);
   UPG_TASK.cntx_pop();
   UPG_REAL.cntx_pop();
   UPG_MSG.cntx_pop()
?}

:Sign Version 2.0 jowisz:1045 2023/07/03 09:07:18 ac793d806e0039515fc1db99fa479324c91ddbb0446352d713fb0a738fe757d7ddc6cbaca09118c48f82bb9633f6d9119a81612e5ea78de268319ebef256c99e4febdc7f6e4ca231ec01d1af3a0984bd5b92e46fec0cdffc568c5d980576e7c935f0849a4ed9906b550f5e1becaf3722ec65462839dc89d245dc4afc7f14338f
