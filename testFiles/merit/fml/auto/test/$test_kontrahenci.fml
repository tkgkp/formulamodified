:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: $kontrahenci.fml
:: Utworzony: 26.10.2018
:: Autor: GZ
:: Systemy:
::======================================================================================================================
:: Zawartość: Skrypty automatyzujące obsługę kontrahentów
:: AREA: [ZWS_KHR]
::======================================================================================================================


\test_kontrahenci
::----------------------------------------------------------------------------------------------------------------------
::  UTW: GZ [19.02]
:: OPIS:
::   WE: _a - obiekt testujący
:: ~OST: INENVGET
::----------------------------------------------------------------------------------------------------------------------
:: @GIVEN
_test_driver:=exec('init','$lib_base','$test_kontrahenci.log');
_test_driver.app_activate(_b);
:: @WHEN
exec('obszar','$kontrahenci',_test_driver);
_dane_ogolne:=exec('importuj_dane_ogolne','$test_kontrahenci');
_inne_dane:=exec('importuj_inne_dane','$test_kontrahenci');
{? _dane_ogolne.first()
|| {!
   |?
      _kod_kontrahenta:=exec('dolacz','$kontrahenci',_test_driver,_dane_ogolne,_inne_dane);
      exec('szukaj','$kontrahenci',_test_driver,_kod_kontrahenta);
      exec('wyswietl','$kontrahenci',_test_driver);
      exec('popraw','$kontrahenci',_test_driver);
      {? envget('@MacroTestyZero')<>'1' || exec('usun','$kontrahenci',_test_driver) ?};
      _dane_ogolne.next()
   !}
|| _test_driver.fail('Brak zaimportowanych danych');
   return(0)
?};
:: Zamknięcie okna kontrahentów
_test_driver.win_action('file_close');
~~


\importuj_dane_ogolne
::----------------------------------------------------------------------------------------------------------------------
::  UTW: GZ [19.02]
:: OPIS: Importuje z cvs dane ogólne
::   WE:
::   WY: _tab_tmp
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(1,
               'KOD','STRING[8]','Kod',
               'GLN','STRING[13]','GLN',
               'TYP','STRING[50]','Typ',
               'FIZYCZNY','STRING[1]','Osoba fizyczna',
               'DTKL','STRING[11]','Data rozpoczęcia współpracy',
               'NIP','STRING[20]','NIP',
               'PESEL','STRING[11]','PESEL',
               'NIP_UE','STRING[13]','NIP w UE',
               'REG','STRING[10]','Regon',
               'REG_DATA','STRING[11]','Data otrzymania nr REGON',
               'SKR','STRING[10]','Skrót',
               'NAZ_P','STRING[150]','Nazwa pełna',
               'NAZ','STRING[60]','Nazwa skrócona',
               'GRKH','STRING[20]','Grupa kontrahentów',
               'OBS','STRING[20]','Obszar sprzedaży',
               'PLATNOSC','STRING[8]','Rodzaj płatności',
               'U','STRING[255]','Uwagi',
               'WIELKOSC','STRING[1]','Wielkość kontrahenta',
               'STATUS','STRING[10]','Status kontrahenta'
             );

_tab.import('$kontrahenci_dane_ogolne.csv',,1,,'Windows,header',,'KOD',,1,,'GLN',,2,,'TYP',,3,,'FIZYCZNY',,4,,'DTKL',,5,,
                                                       'NIP',,6,,'PESEL',,7,,'NIP_UE',,8,,'REG',,9,,'REG_DATA',,10,,
                                                       'SKR',,11,,'NAZ_P',,12,,'NAZ',,13,,'GRKH',,14,,'OBS',,15,,
                                                       'PLATNOSC',,16,,'U',,17,,'WIELKOSC',,18,,'STATUS',,19,);
_tab


\importuj_inne_dane
::----------------------------------------------------------------------------------------------------------------------
::  UTW: GZ [19.02]
:: OPIS: Importuje z csv inne dane
::   WE:
::   WY: _tab_tmp
::----------------------------------------------------------------------------------------------------------------------
_tab:=tab_tmp(1,
               'KOD','STRING[8]','Kod',
               'KODISO','STRING[2]','Kraj kontrahenta',
               'STR_PZ','STRING[1]','Strona ponosząca koszty przelewu',
               'SP','STRING[1]','Płatności split-payment?',
               'KRS','STRING[10]','Krajowy Rejestr Sądowy',
               'KRS_DATA','STRING[10]','Data otrzymania KRS',
               'KAPITAL','STRING[20]','Kapitał zakładowy',
               'KAP_ZROD','STRING[20]','Źródło kapitału zakładowego',
               'EORI','STRING[20]','Economic Operators  Registration and Identification',
               'TR','STRING[80]','Nazwa dowodu tożsam.',
               'SN_DT','STRING[10]','Seria i numer DT',
               'TR_1','STRING[80]','Wydany przez',
               'DATA_WDT','STRING[10]','Data wydania DT',
               'REJ_INFO','STRING[32]','Źródło informacji',
               'KOLOR','STRING[11]','Kolor',
               'KOD_1','STRING[8]','Domyślna wersja językowa wydruków');

_tab.import('$kontrahenci_inne_dane.csv',,1,,'Windows,header',,'KOD',,1,,'KODISO',,2,,'STR_PZ',,3,,'SP',,4,,'KRS',,5,,
                                                              'KRS_DATA',,6,,'KAPITAL',,7,,'KAP_ZROD',,8,,'EORI',,9,,
                                                              'TR',,10,,'SN_DT',,11,,'TR_1',,12,,'DATA_WDT',,13,,
                                                              'REJ_INFO',,14,,'KOLOR',,15,,'KOD_1',,16,);

_tab

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:06 15ec6b30c8f806638490f5b67e1678e2e907429809a2b3621dc730752b0690b19a7a0638808f5a9ddfa355818a1596a57cebd21c9d92520fb6ecd1daf14139ab8459d59ff851907ba687b1ef1abc349e3c119268d672fca0af17f2fcfb29c1285317071110706c7dbca3ddaf383c9852419e3f1e05400bfec5072d29ef252ab0
