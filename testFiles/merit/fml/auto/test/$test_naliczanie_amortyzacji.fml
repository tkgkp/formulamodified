:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: $test_naliczanie_amortyzacji.fml
:: Utworzony: 19.02.2019
:: Autor: PJ
::======================================================================================================================
:: Zawartość: Test automatyczneydla obszaru FST - naliczanie amortyzacji
:: AREA: [FST_EWI]
::======================================================================================================================


\amor_nalicz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PJ [19.22]
:: OPIS: Test dodawania środków trwałych
::   WE: _a - obiekt testujący
::----------------------------------------------------------------------------------------------------------------------

::GIVEN
_test_driver:=_a;

:: jeżeli poprzedni test na tej samej kopii obiektu testującego zakończył się błędem to nie uruchamia się
:: test bo wynik może być nieoczekiwany - poprzedni test mógł zostwić niewyczyszczone środowisko, otwarte zakładki itp.
{? _test_driver.error_no<>0 || return(0) ?};

_test_driver.logger.log_actions:=1;
_file:=_test_driver.logger.filename;
_test_driver.logger.filename:='$test_naliczanie_amortyzacji.log';
_timeout:=_test_driver.timeout;
_test_driver.timeout:=300000;
_test_driver.log_init_info();

_test_driver.exec_after_error:=0;
_test_driver.set_lib_mock_enabled('', '', 0);
_test_driver.set_lib_mock_enabled('mbutil.jar', '', 1);
_test_driver.set_lib_mock_enabled('filedlg.jar', '', 1);

_test_driver.set_ctrl_mock_enabled('', '', 0);
_test_driver.set_ctrl_mock_enabled('!application>ctr:filechooser', '', 1);

::_app:=_test_driver.app_open('admin', 'admin123', 'firma', 'merit001', '', '');
_app:=_test_driver.app_activate();

_test_driver.control('!desktop', 'open', 'Środki trwałe\\Obszary\\Kartoteka środków', 7);
_test_driver.app_wait_for_change();
_app_fst:=_test_driver.app_activate();
_test_driver.assert('', 'wnd:zsrst_wer', 'state', 'maximized', 'sum_row_allowed', 'true', 'sum_row_enabled', 'false', 'title', '', 'type', 's');

:: ustawienie parametrów pracy - dla danych demo: okres styczeń 2019
exec('fst_par_prac','$srodki_trwale',_test_driver,2019,'luty');

::WHEN
_test_driver.click('wnd:zsrst_wer');


:: naliczanie amortyzacji w kartotece środków

_test_driver.click('fld:@SRST.SRSR.DE(row=1)');
_test_driver.menu('Amortyzacja:Usunięcie amortyzacji dla firmy');
_test_driver.click('dbtn:Tak');
_test_driver.click('dbtn:OK');
_test_driver.menu('Amortyzacja:Obliczenie amortyzacji dla firmy');
_test_driver.assert('', 'wnd:@EDIT_ES._amort_obl', 'title', 'Amortyzacja - naliczanie', 'type', 'e');
_test_driver.click('btn:@OK');
_test_driver.click('dbtn:OK');
_test_driver.assert('', 'wnd:@EDIT_ES._amort_obl', 'title', 'Amortyzacja - naliczanie', 'type', 'e');
_test_driver.click('btn:@OK');
_test_driver.click('dbtn:OK');


::THEN
{? _test_driver.error_no=0
|| _test_driver.click('wnd:zsrst_wer');


:: weryfikacja czy naliczono amortyzację dla wszystkich środków
   _formula:="exec('check_amort','$srodki_trwale')";
   _check:=_test_driver.execute(_formula);
   {? _check
   || _test_driver.logger.info('Naliczono amortyzację dla wszystkich środków.')
   || _test_driver.logger.error(0,'Nie naliczono amortyzacji dla wszystkich środków.')
   ?};

:: zamykanie okna kartoteki środków
   _test_driver.app_close(_app_fst);
   _test_driver.timeout=_timeout;
   _test_driver.logger.filename:=_file;
   return(_check)
|| _test_driver.timeout=_timeout;
   _test_driver.logger.filename:=_file;
   return(0)
?}


:Sign Version 2.0 jowisz:1048 2021/04/09 15:23:47 1eef9b431af72c522e935d3d0d235d1676ba9516fae15f26da881e02c2c55393005a9e74f79a8314c56a0eb4805030cfe409304d212ebe633a8236b4d4aba2ac4d39881c23cd1027da17f60e8f3224a603dfc8b7de2652d4c6365ab1abce8aee622a6e35df35387a581580bcd58d0340b75630d19104d0e58d3bf6091fffc31d
