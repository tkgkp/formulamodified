:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: $test_uzup_param.fml
:: Utworzony: 22.04.2020
:: Autor: GZ
:: Systemy:
::======================================================================================================================
:: Zawartość:
::======================================================================================================================


\zaloz_rok
::----------------------------------------------------------------------------------------------------------------------
::  UTW: GZ [20.42]
:: OPIS: Uzupełnia parametryzację o lata 2019 i 2020
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
:: @GIVEN
_test_driver:=exec('init','$lib_base','$test_uzup_param.log');
:: @WHEN

_app1:=exec('otworz_obszar','$lib_base',_test_driver,'Ustawienia i parametryzacja');
_test_driver.assert('', 'wnd:@param', 'title', 'Parametryzacja', 'type', 's');
_test_driver.click('gtab:@Wykonanie');
_test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'Okresy pracy w systemie');
_test_driver.menu('Wybierz');
_test_driver.assert('', 'wnd:@OKRO.WER', 'title', 'Okresy', 'type', 's');

{! _i:=2020..(date()~1) |!
   _test_driver.menu('Dołącz');
   _test_driver.assert('', 'wnd:@PAR_OKR.EDIT_OKR', 'title', 'Wybór dziedzin', 'type', 'e');
   _test_driver.click('fld:@PAR_OKR.MSTART');
   _test_driver.click('fld:@PAR_OKR.LOKR');
   _test_driver.click('fld:@PAR_OKR.FKS');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.FKS');
   _test_driver.click('fld:@PAR_OKR.CTR');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.CTR');
   _test_driver.click('fld:@PAR_OKR.OBG');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.OBG');
   _test_driver.click('fld:@PAR_OKR.FST');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.FST');
   _test_driver.click('fld:@PAR_OKR.KAS');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.KAS');
   _test_driver.click('fld:@PAR_OKR.LMG');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.LMG');
   _test_driver.click('fld:@PAR_OKR.LSP');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.LSP');
   _test_driver.click('fld:@PAR_OKR.LZK');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.LZK');
   _test_driver.click('fld:@PAR_OKR.LUM');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.LUM');
   _test_driver.send('', '{F2}', '')
!};
_test_driver.send('', '{ESC}', '');

:: zaczytanie lat bilansowych, aby dodał się rok
_test_driver.click('gtab:@Parametryzacja');
_test_driver.click('fld:@tmp.NAZWA(row=3;tree)');
_test_driver.click('fld:@tmp.NAZWA(row=5)');
_test_driver.menu('Wybierz');
_test_driver.assert('', 'wnd:@ROK_F.rok_fwerk', 'title', 'Lata bilansowe', 'type', 's');
_test_driver.send('', '{ESC}', '');

:: Kopiowanie struktur księgowych
_test_driver.click('gtab:@Wykonanie');
{! _i:=2019..(date()~1) |!
_test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'struktury księgowe', '@FP_WYK.FP_INS.NAZWA', $_i);
_test_driver.menu('Wybierz');
_test_driver.menu('Kopiuj z poprzedniego roku');
_test_driver.click('dbtn:Tak');
_test_driver.send('1', '', 'fld:@BILANSP.ZAKKON');
_test_driver.send('', '{F2}', '');
_test_driver.send('', '{ESC}', '')
!};


::Kopiowanie rejestrów
_test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'struktury księgowe', '@FP_WYK.FP_INS.NAZWA', '2018');
_test_driver.click('fld:@FP_WYK.FIRMA.OPIS(row=1)');
_test_driver.menu('Wybierz');
_test_driver.click('gtab:@Rejestry');

::    kopiowanie do kolejnych lat
{! _i:=2019..(date~1) |!
   {! _j:=1..36
   |!
      _test_driver.click('fld:@REJ.KOD(row='+$_j+')');
      _test_driver.menu('Kopiuj');
      {? _test_driver.exist('dial:') & _test_driver.state('dial:').message='Kopiowanie rejestru ~BO jest zabronione.'
         | _test_driver.exist('dial:') & _test_driver.state('dial:').message='Kopiowanie rejestru ~BZ jest zabronione.'
      || _test_driver.click('dbtn:OK')
      ||
         _test_driver.send($_i, '', 'fld:@REJ.ROK.NAZ');
         _test_driver.send('', '{TAB}', 'fld:@REJ.ROK.NAZ');
         _test_driver.send('', '{F2}', '');
         _test_driver.click('dbtn:OK');
         _test_driver.send('', '{PGUP}', '');
         _test_driver.send('', '{PGUP}', '');
         _test_driver.send('', '{PGUP}', '');
         _test_driver.send('', '{PGUP}', '')
      ?}
   !}
!};
_test_driver.send('', '{ESC}', '');


:: Akceptacja schematu VAT dla automatycznej dekretacji
{! _j:=2019..(date~1) |!
   _test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'struktury księgowe', '@FP_WYK.FP_INS.NAZWA', $_j);
   _test_driver.click('fld:@FP_WYK.FP_DEF.NAZWA(row=1)');
   _test_driver.menu('Wybierz');
   _test_driver.click('gtab:@Schematy VAT');
   {! _i:=1..11
   |!
      _test_driver.click('fld:@AV.OP(row='+$_i+')');
      _test_driver.click('btn:btnAKC');
      _test_driver.click('dbtn:Tak')
   !};
   _test_driver.send('', '{ESC}', '')
!};

exec('dokumenty_split_payment','$test_uzup_param',_test_driver);

_test_driver.app_close(_app1)


\akceprtacja_schematow_VAT
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WHAN [20.xx]
:: OPIS: akceptacja schematu VAT dla automatycznej dekretacji - kontener zerowy
::   WE: _a - obiekt testujący
::   WY:
::----------------------------------------------------------------------------------------------------------------------
:: @GIVEN
_test_driver:=_a;
:: @WHEN

_test_driver.control('!leftmenu', 'open', 'Wspólne\\Obszary\\Ustawienia i parametryzacja', 1);
_app1:=_test_driver.app_wait_for_change();
_test_driver.assert('', 'wnd:@param', 'title', 'Parametryzacja', 'type', 's');
_test_driver.click('gtab:@Wykonanie');
::_test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'Okresy pracy w systemie');
::_test_driver.menu('Wybierz');
:: Akceptacja schematów VAT dla automatycznej dekretacji
_test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'struktury księgowe', '@FP_WYK.FP_INS.NAZWA', '2022');
_test_driver.click('fld:@FP_WYK.FP_DEF.NAZWA(row=1)');
_test_driver.menu('Wybierz');
_test_driver.click('gtab:@Schematy VAT');
{! _i:=1..18
|!
   _test_driver.click('fld:@AV.OP(row='+$_i+')');
   {? _test_driver.state('btn:btnAKC').enable='true'
   || _test_driver.click('btn:btnAKC');
      _test_driver.click('dbtn:Tak')
   ?};
   _test_driver.send('', '{PGUP}', '')
!};
_test_driver.send('', '{ESC}', '');
_test_driver.app_close(_app1)


\dokumenty_split_payment
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WHAN [21.14]
:: OPIS: Ustawienia do wykonania dodatkowych przypadków testowych
::   WE: _a - _test_driver
::   WY: [_b] - [STRING] rok
::----------------------------------------------------------------------------------------------------------------------
_test_driver:=_a;
{? var_press('_b')=type_of('')
|| _rok:=_b
|| _rok:=$(date()~1)
?};
:: konta syntetyczne - Split payment: nieobowiązkowe
_test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'struktury księgowe', '@FP_WYK.FP_INS.NAZWA', _rok);
_test_driver.click('fld:@FP_WYK.FP_DEF.NAZWA(row=1)');

:: Konta syntetyczne - Split payment: nieobowiązkowe
_test_driver.menu('Wybierz');
_test_driver.filter('@KS.SYM', '224');
_test_driver.click('fld:@KS.NAZ(row=1)');
_test_driver.menu('Popraw');
_test_driver.assert('', 'wnd:@KS.RED', 'title', 'Konto syntetyczne', 'type', 'e');
_test_driver.click('fld:@RKS.ROZR(ndx=2)');
_test_driver.send('2', '', 'fld:@RKS.ROZR');
_test_driver.send('', '{F2}', '');
_test_driver.send('', '{ESC}', '');



:: Grupy podatkowe
_test_driver.menu('Wybierz');
_test_driver.assert('', 'wnd:@KS.WER', 'title', 'Konta syntetyczne z roku '+_rok, 'type', 's');
_test_driver.click('gtab:@Rejestry');

_szukaj:="_szukaj:=
{? REJ.first()
|| {! |?
      _szukaj:=REJ.KOD='ZAK_KRAJ';
      _szukaj=0 & REJ.next()
   !}
?}";
{? _test_driver.execute(_szukaj)
||
   _test_driver.menu('Grupy podatkowe');
   _test_driver.assert('', 'wnd:@GR_VAT.WER', 'title', 'Grupy podatkowe', 'type', 's');
   _test_driver.click('btn:addGR_VAT');
   _test_driver.assert('', 'wnd:@SLO.grupy_podat', 'title', 'GRUPY PODATKOWE', 'type', 's');
   _test_driver.send('ZakuPodZ', '{ENTER}', '');
   _test_driver.click('fld:@SLO.KOD(row=1)');
   {? _test_driver.state('fld:@SLO.KOD(row=1)').value='ZakuPodZ'
   || _test_driver.menu('Wybierz')
   || _test_driver.fail('Nie odnaleziono Grupy podatkowej ZakuPodZ');
      _test_driver.send('', '{ESC}', '')
   ?};
    _test_driver.send('', '{ESC}', '')
?};
_test_driver.send('', '{ESC}', '')


\zaloz_rok_000
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WHAN [23.25]
:: OPIS: Uzupełnia okresy i schematy danych na kolejne lata dla firmy 000
::   WE: [_a] - test driver
::       [_b] - [STRING] pulpit
::   WY:
::----------------------------------------------------------------------------------------------------------------------
{? var_pres('_a')>0
|| _test_driver:=_a
|| _test_driver:=exec('init','$lib_base','$test_uzup_param000.log')
?};
{? var_pres('_b')>0
|| _pulpit:=_test_driver.app_activate(_b)
|| _pulpit:=exec('get_desctop_id','$lib_base',_test_driver)
?};
{? _pulpit=''
|| _pulpit:=_test_driver.app_open('admin', 'admin123', 'firma', 'merit001', '', '')
?};
_pulpit:=_test_driver.app_activate(_pulpit);
_test_driver.control('!desktop', 'reload', 'firma', 'merit000');
_app:=_test_driver.app_wait_for_change();
_test_driver.control('!desktop', 'open', 'Wspólne\\Obszary\\Ustawienia i parametryzacja', 7);
_app1:=_test_driver.app_wait_for_change();
_test_driver.click('gtab:@Wykonanie');
_test_driver.filter('@FP_WYK.FP_DEF.NAZWA', 'okresy pracy');
_test_driver.click('fld:@FP_WYK.FP_DEF.NAZWA(row=1)');
_test_driver.menu('Wybierz');
_test_driver.assert('', 'wnd:@OKRO.WER0', 'title', 'Okresy', 'type', 's');
{! _i:=2018..(date()~1)
|! _test_driver.menu('Dołącz');
   _test_driver.assert('', 'wnd:@PAR_OKR.EDITOKR0', 'title', 'Wybór dziedzin', 'type', 'e');
   _test_driver.click('fld:@PAR_OKR.FKS');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.FKS');
   _test_driver.click('fld:@PAR_OKR.CTR');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.CTR');
   _test_driver.click('fld:@PAR_OKR.FST');
   _test_driver.send('checked', '', 'fld:@PAR_OKR.FST');
   _test_driver.send('', '{F2}', '')
!};
_test_driver.send('', '{ESC}', '');
::    kopiowanie planów schematów danych do kolejnych lat
_test_driver.click('gtab:@Parametryzacja');

_test_driver.click('fld:@tmp.NAZWA(row=3;tree)');
_test_driver.click('fld:@tmp.NAZWA(row=5)');
_test_driver.menu('Wybierz');
_test_driver.assert('', 'wnd:@ROK_F.rok_fwerk', 'title', 'Lata bilansowe', 'type', 's');
_row:=1;
{! _i:=2018..(date()~1)
|! _row+=1;
   _test_driver.click('fld:@ROK_F.NAZ(row='+$_row+')');
   _test_driver.menu('Kopiuj z poprzedniego roku');
   _test_driver.assert('', 'wnd:@ROZNE.KOP_KRT', 'title', 'Parametry kopiowania', 'type', 'e');
   _test_driver.send('', '{F2}', 'fld:@UNPAR.PRF2.NAZ');
   _test_driver.click('dbtn:OK')
!};
_test_driver.send('', '{ESC}', '');

_test_driver.app_close(_app1);
{? var_pres('_b')>0
|| _test_driver.app_activate(_pulpit);
   _test_driver.control('!desktop', 'reload', 'firma', 'merit001')
|| _test_driver.app_close(_app)
?}

:Sign Version 2.0 jowisz:1048 2023/06/23 14:12:56 1e622b11131ea0bbeeace7036ab8dc981b1f4e1aa4b8a76faad8ea63e5ae3afb3ac857aa6b73bab31b2a3d6cea4272b98e6a30717e0f6c188c716150debc5757a4bff5232bf06d032f2547219dddec1929dcd4b8bcd62bfa7fc1b0f99730a31323fd910d9ce0e11a623943354b293468d1fd8ff8336c5c501d5086f42af41876
