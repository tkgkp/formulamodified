:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: %jpk.fml
:: Utworzony: 04.04.2023
:: Autor: PBS
::======================================================================================================================
:: Zawartość: Formuły obsługujące powiadomienia dla JPK
::======================================================================================================================


\dek_link
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Link do deklaracji
::   WE: _a - VAT_DEK.uidref() lub JPK.uidref()
::       _b - app_ident
::       _c - cluster_group
::----------------------------------------------------------------------------------------------------------------------
_link:=exec('link_uri','#system',exec('obj_ntab_set','#array',,'LINK',_a),,_c,_b);
_link


\jpk_v7_ntc_act
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Akcja przycisku 1 w powiadomieniu o JPK_V7
::   WE: _a - link
::       _b -USERS.ref()
::----------------------------------------------------------------------------------------------------------------------
_formula:={? exec('get','#params',7011,,_b)='T'
          || '{"url": %1}'[json_value(_a)]
          || '{"url": %1, "delete": %2}'[json_value(_a), json_val(0)]
          ?};
_formula


\jpk_v7_ntc_btn
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Nazwa przycisku 1 w powiadomieniu o JPK_V7
::   WE: _a - rodzaj powiadomienia
::----------------------------------------------------------------------------------------------------------------------
{? _a=1
|| 'Deklaracje JPK_V7'@
|? _a=2
|| 'Idź do deklaracji'@
|? _a=3
|| 'Idź do deklaracji'@
|? _a=4
|| 'Idź do pliku JPK'@
|? _a=5
|| 'Idź do pliku JPK'@
|| ''
?}


\txt
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Treść powiadomienia
::   WE: _a - rodzaj powiadomienia
::       _b [STRING] - okres
::----------------------------------------------------------------------------------------------------------------------
{? _a=1
|| 'Brak deklaracji JPK_V7 za okres %1'@[_b]
|? _a=2
|| 'Deklaracja w okresie %1 nie jest zaakceptowana'@[_b]
|? _a=3
|| 'Brak wygenerowanego pliku JPK dla deklaracji w okresie %1'@[_b]
|? _a=4
|| 'Plik JPK_V7 z %1 oczekuje na przesłanie do ministerstwa'@[_b]
|? _a=5
|| 'Plik JPK_V7 z %1 oczekuje na UPO'@[_b]
|| ''
?}


\title
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Tytuł powiadomienia
::   WE: _a - rodzaj powiadomienia
::----------------------------------------------------------------------------------------------------------------------
{? _a=1
|| 'Deklaracje JPK_V7 za poprzedni miesiąc wymagające obsługi'@
|? _a=2
|| 'Deklaracje JPK_V7 za poprzedni miesiąc wymagające obsługi'@
|? _a=3
|| 'Deklaracje JPK_V7 za poprzedni miesiąc wymagające obsługi'@
|? _a=4
|| 'Deklaracje JPK_V7 za poprzedni miesiąc wymagające obsługi'@
|? _a=5
|| 'Deklaracje JPK_V7 za poprzedni miesiąc wymagające obsługi'@
|| ''
?}


\r_users_to_send
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Użytkownicy roli - do wysyłki powiadomienia
::----------------------------------------------------------------------------------------------------------------------
_mp:=params_get().mp;
_b_prel:=_mp.b_prel;

_result:='';

B_ROLE.cntx_psh(); B_USRROL.cntx_psh(); USERS.cntx_psh();
B_ROLE.prefix();
{? B_ROLE.seek(exec('FindAndGet','#table',B_PREL,_b_prel,,"B_ROLE",null()))
|| B_USRROL.index('UNIK');
   B_USRROL.prefix(REF.FIRMA,B_ROLE.ref());
   {? B_USRROL.first()
   || {!
      |? {? exec('get','#params',7014,,B_USRROL.USERS)='T'
         || _result+=B_USRROL.USERS().KOD+','
         ?};
         B_USRROL.next()
      !}
   ?}
?};
B_ROLE.cntx_pop(); B_USRROL.cntx_pop(); USERS.cntx_pop();
_result


\info
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Tekst informacji w nagłówku powiadomienia
::----------------------------------------------------------------------------------------------------------------------
''


\variant
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Tekst informacji w nagłówku powiadomienia
::----------------------------------------------------------------------------------------------------------------------
'warning'


\icon
::----------------------------------------------------------------------------------------------------------------------
::  UTW: PBS [23.25]
:: OPIS: Tekst informacji w nagłówku powiadomienia
::----------------------------------------------------------------------------------------------------------------------
''

:Sign Version 2.0 jowisz:1048 2023/06/23 14:15:44 6aa15e530e3abe3350e52fc2c7fb3f00b50039dff1d7748ad11d38afcf1ac3e97842e766218b0f6f96a7e6edfa7e92d4ba2bdc3911ad8a73e5395162387ac88df7df1f15dc96518a232fde5da0e58a7486e4c4d0d47117ec8a349dbb9191f204e4e6bbc7470ee1ba4607ceff0c62d78a81cc97d35bc15bf3cfb05dc6e26401c7
