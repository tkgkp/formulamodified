:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: %domain_area_task.fml
:: Utworzony: 05.01.2017
:: Autor: RWR
::======================================================================================================================
:: Zawartość: Dziedziny, obszary, czynności.
::======================================================================================================================


\main
::----------------------------------------------------------------------------------------------------------------------
::  UTW: RWR [14.10]
:: OPIS: Dziedziny, obszary, czynności.
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_cfg:=obj_new('inverse');
_cfg.inverse:=0;

_szer:=60;
_struct:="obj_new('TAB','NDX','ws','wep','wer')";

:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

_lic:=_struct();
_lic.TAB:=app_info('domain_lic');

:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

_sql:=
   'select '
      'case when LIC.SYMBOL is null then \'N\' else \'T\' end LIC, '
      'DOM.*, '
      'from_hex(substr(DOM.COLOR,1,2)) || \':\' || '
      'from_hex(substr(DOM.COLOR,3,2)) || \':\' || '
      'from_hex(substr(DOM.COLOR,5,2)) C10 '
   'from '
      ':_a DOM left join :_b LIC using(DOM.SYMBOL,LIC.SYMBOL)'
   'order by '
      'DOM.SYMBOL'
;
_dom:=_struct();
_dom.TAB:=sql(_sql,app_info('domain'),_lic.TAB);
_dom.TAB.fld_fml('COLOR','BEFORE_DISPLAY',"'255:255:255,%1'[params_get().dom.TAB.C10]");
_dom.TAB.fld_fml('C10','BEFORE_DISPLAY',"'255:255:255,%1'[params_get().dom.TAB.C10]");
_dom.NDX:=_dom.TAB.index('?');
_dom.TAB.first();
_dom.ws:=_dom.TAB.mk_sel(,,,'#procdomws',,,,,'U');
_dom.TAB.win_fld(_dom.ws,,'SYMBOL',,,,,,'Symbol'@);
_dom.TAB.win_fld(_dom.ws,,'NAME',,,,,,'Nazwa'@);
_dom.TAB.win_fld(_dom.ws,,'AH',,,,,,'Podpowiedź'@);
_dom.TAB.win_fld(_dom.ws,,'FM',,,,,,'Formuła'@);
_dom.TAB.win_fld(_dom.ws,,'TCALL',,,,,,'Przeznaczenie'@,,'Przeznaczenie'@);
_dom.TAB.win_fld(_dom.ws,,'INTERM',,,,,,'inTerm'@,,'Dziedzina dostępna dla klienta inTerm [T/N]'@,2,,"'T'","'N'");
_dom.TAB.win_fld(_dom.ws,,'MOBILE',,,,,,'Mobile'@,,'Dziedzina dostępna dla wyglądu mobilnego [T/N]'@,2,,"'T'","'N'");
_dom.TAB.win_fld(_dom.ws,,'LIC',,,,,,'Licencja'@,,'Dziedzina licencjonowanta [T/N]'@,2,,"'T'","'N'");
_dom.TAB.win_fld(_dom.ws,,'VALIDTO',,,,,,'Data ważności'@,,'Data ważności licencji'@);
_dom.TAB.win_act(_dom.ws,,'Formuła','K&olor',,,"_cfg:=params_get().cfg; _cfg.inverse:=~_cfg.inverse",,1);
_dom.TAB.win_act(_dom.ws,,'Szukaj');
_dom.TAB.win_act(_dom.ws,,'Kolejność');
_dom.TAB.win_act(_dom.ws,,'Rekord',,,,"_par:=params_get(); {? _par.cfg.inverse || ',' || '' ?}+_par.dom.TAB.C10");
_dom.TAB.win_fml(_dom.ws,,'SYMBOL',,'ICON_BEFORE',"params_get().dom.TAB.ICON");
_dom.wep:=_dom.TAB.mk_edit('Dziedzina'@,,'#procdomwep');
_dom.TAB.win_efld(_dom.wep,,'SYMBOL',,,_szer,,,'Symbol'@);
_dom.TAB.win_efld(_dom.wep,,'NAME',,,_szer,,,'Nazwa'@);
_dom.TAB.win_efld(_dom.wep,,'AH',,,_szer,,,'Podpowiedź'@);
_dom.TAB.win_efld(_dom.wep,,'COLOR',,,_szer,,,'Kolor (hex)'@);
_dom.TAB.win_efld(_dom.wep,,'C10',,,_szer,,,'Kolor (dec)'@);
_dom.TAB.win_efld(_dom.wep,,'FM',,,_szer,,,'Formuła'@);
_dom.TAB.win_efld(_dom.wep,,'ICON',,,_szer,,,'Ikona'@);
_dom.TAB.win_efld(_dom.wep,,'TCALL',,,,,,'Wywołanie'@,,,'radio-buttons',,
   'jTerm'@,"'M'",
   'webTerm'@,"'W'",
   'jTerm+webTerm'@,"'B'"
);
_dom.TAB.win_efld(_dom.wep,,'INTERM',,,,,,'Klient inTerm'@,,,'check-box',
   'check_label="%1"' ['Tak, dziedzina dostępna dla klienta inTerm'@],"'T'","'N'"
);
_dom.TAB.win_efld(_dom.wep,,'MOBILE',,,,,,'Tryb mobilny'@,,,'check-box',
   'check_label="%1"' ['Tak, dziedzina dostępna dla wyglądu mobilnego'@],"'T'","'N'"
);
_dom.TAB.win_esep(_dom.wep,'Licencjonowanie'@);
_dom.TAB.win_efld(_dom.wep,,'LIC',,,,,,'Licencja'@,,,'check-box','check_label="Tak, dziedzina jest licencjonowana"');
_dom.TAB.win_efld(_dom.wep,,'VALIDTO',,,,,,'Data ważności'@);
_dom.wer:=_dom.TAB.mk_edit('Dziedzina'@,,'#procdomwer');
_dom.TAB.win_ewin(_dom.wer,,_dom.wep,'Dane podstawowe'@);
_dom.TAB.win_edit(_dom.wer);
_dom.TAB.win_efml(_dom.wer,,'ICON',,'ICON_BEFORE',"params_get().dom.TAB.ICON");

:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

_area:=_struct();
_area.TAB:=app_info('area');
_area.NDX:=_area.TAB.index('?');
_area.TAB.first();
_area.ws:=_area.TAB.mk_sel(,,,'#procareaws',,,,,'U');
_area.TAB.win_fld(_area.ws,,'SYMBOL');
_area.TAB.win_fld(_area.ws,,'NAME');
_area.TAB.win_fld(_area.ws,,'AH');
_area.TAB.win_fld(_area.ws,,'FM');
_area.TAB.win_fld(_area.ws,,'TCALL',,,,,,,,'Wywołanie'@);
_area.TAB.win_fld(_area.ws,,'INTERM',,,,,,'inTerm'@,,'Obszar dostępny dla klienta inTerm [T/N]'@,2,,"'T'","'N'");
_area.TAB.win_fld(_area.ws,,'MOBILE',,,,,,'Mobile'@,,'Oszar dostępny dla wyglądu mobilnego [T/N]'@,2,,"'T'","'N'");
_area.TAB.win_act(_area.ws,,'Szukaj');
_area.TAB.win_act(_area.ws,,'Kolejność');
_area.TAB.win_fml(_area.ws,,'SYMBOL',,'ICON_BEFORE',"params_get().area.TAB.ICON");
_area.wep:=_area.TAB.mk_edit('Obszar'@,,'#procareawep');
_area.TAB.win_efld(_area.wep,,'SYMBOL',,,_szer);
_area.TAB.win_efld(_area.wep,,'NAME',,,_szer);
_area.TAB.win_efld(_area.wep,,'AH',,,_szer);
_area.TAB.win_efld(_area.wep,,'FM',,,_szer);
_area.TAB.win_efld(_area.wep,,'ICON',,,_szer);
_area.TAB.win_efld(_area.wep,,'TCALL',,,,,,,,,'radio-buttons',,
   'jTerm'@,"'M'",
   'webTerm'@,"'W'"
);
_area.TAB.win_efld(_area.wep,,'INTERM',,,,,,'Klient inTerm'@,,,'check-box',
   'check_label="%1"' ['Tak, obszar dostępny dla klienta inTerm'@],"'T'","'N'"
);
_area.TAB.win_efld(_area.wep,,'MOBILE',,,,,,'Tryb mobilny'@,,,'check-box',
   'check_label="%1"' ['Tak, obszar dostępny dla wyglądu mobilnego'@],"'T'","'N'"
);
_area.wer:=_area.TAB.mk_edit('Obszar'@,,'#procareawer');
_area.TAB.win_ewin(_area.wer,,_area.wep,'Dane podstawowe'@);
_area.TAB.win_edit(_area.wer);
_area.TAB.win_efml(_area.wer,,'ICON',,'ICON_BEFORE',"params_get().area.TAB.ICON");

:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

_task:=_struct();
_task.TAB:=app_info('task');
_task.NDX:=_task.TAB.index('?');
_task.TAB.first();
_task.ws:=_task.TAB.mk_sel(,,,'#proctaskws',,,,,'U');
_task.TAB.win_fld(_task.ws,,'B_DOM',,,-4);
_task.TAB.win_fld(_task.ws,,'SYMBOL');
_task.TAB.win_fld(_task.ws,,'NAME');
_task.TAB.win_fld(_task.ws,,'AH');
_task.TAB.win_fld(_task.ws,,'B_CAN',,,-3);
_task.TAB.win_fld(_task.ws,,'AUTOMAT',,,,,,'Automatyczna'@,,'Czynność automatyczna [T/N]'@,2,,"'T'","'N'");
_task.TAB.win_fld(_task.ws,,'PROC',,,,,,'Proces'@,,'Czynność może wystąpić w procesie [T/N]'@,2,,"'T'","'N'");
_task.TAB.win_fld(_task.ws,,'REP',,,,,,'Raport'@,,'Czynność jest raportem [1/0]'@,2,,"1","0");
_task.TAB.win_fld(_task.ws,,'INTERM',,,,,,,,'Czynność dostępna dla klienta inTerm [T/N]'@,2,,"'T'","'N'");
_task.TAB.win_fld(_task.ws,,'MOBILE',,,,,,,,'Czynność dostępna dla wygladu mobilnego [T/N]'@,2,,"'T'", "'N'");
_task.TAB.win_act(_task.ws,,'Formuła','K&olor',,,"_cfg:=params_get().cfg; _cfg.inverse:=~_cfg.inverse",,1);
_task.TAB.win_act(_task.ws,,'Szukaj');
_task.TAB.win_act(_task.ws,,'Kolejność');
_task.TAB.win_act(_task.ws,,'Rekord',,,,"
   _par:=params_get();
   _task:=_par.task;
   _dom:=_par.dom;
   _dom.TAB.cntx_psh();
   _dom.TAB.index(_dom.NDX);
   _dom.TAB.prefix();
   _color:=
      {? _dom.TAB.find_key(_task.TAB.B_DOM,)
      || {? _par.cfg.inverse || ',' || '' ?}+_par.dom.TAB.C10
      || ''
      ?};
   _dom.TAB.cntx_pop();
   _color
");
_task.TAB.win_act(_task.ws,,'Wyświetl',,,,"
   params_set(_par:=params_get());
   _task:=_par.task;
   _dom:=_par.dom;
   _dom.TAB.cntx_psh();
   _dom.TAB.index(_dom.NDX);
   _dom.TAB.prefix();
   {? _dom.TAB.find_key(_task.TAB.B_DOM,)
   || _task.TAB.display()
   || melody()
   ?};
   _dom.TAB.cntx_pop();
   ~~
");
_task.wep:=_task.TAB.mk_edit(,,'#proctaskwep');
_task.TAB.win_efld(_task.wep,,'SYMBOL',,,_szer);
_task.TAB.win_efld(_task.wep,,'NAME',,,_szer);
_task.TAB.win_efld(_task.wep,,'AH',,,_szer);
_task.TAB.win_efld(_task.wep,,'FMMAIN',,,_szer);
_task.TAB.win_efld(_task.wep,,'FMTODO',,,_szer);
_task.TAB.win_efld(_task.wep,,'AUTOMAT',,,,,,,,,'check-box','check_label="%1"' ['Tak, czynność automatyczna'@],
   "'T'","'N'");
_task.TAB.win_efld(_task.wep,,'PROC',,,,,,,,,'check-box','check_label="%1"' ['Tak, występuje w procesie'@],
   "'T'","'N'");
_task.TAB.win_efld(_task.wep,,'REP',,,,,,,,,'check-box','check_label="%1"' ['Tak, czynność jest raportem'@],
   "1","0");
_task.TAB.win_efld(_task.wep,,'ICON',,,_szer);
_task.TAB.win_efld(_task.wep,,'B_CAN',,,,,,,,,'radio-buttons',,
   'jTerm'@,"'M'",
   'webTerm'@,"'W'",
   'jTerm+webTerm'@,"'B'",
   'QlikView'@,"'Q'",
   'OLAP'@,"'O'"
);
_task.TAB.win_efld(_task.wep,,'INTERM',,,,,,'Klient inTerm'@,,,'check-box',
   'check_label="%1"' ['Tak, czynność dostępna dla klienta inTerm'@],"'T'","'N'"
);
_task.TAB.win_efld(_task.wep,,'MOBILE',,,,,,'Tryb mobilny'@,,,'check-box',
   'check_label="%1"' ['Tak, czynność dostępna dla wyglądu mobilnego'@],"'T'","'N'"
);
_task.wer:=_task.TAB.mk_edit('Czynność'@,,'#proctaskwer');
_task.TAB.win_ewin(_task.wer,_dom.TAB,_dom.wep,'Dziedzina'@);
_task.TAB.win_ecol(_task.wer);
_task.TAB.win_ewin(_task.wer,_task.TAB,_task.wep,'Czynność'@);
_task.TAB.win_edit(_task.wer);
_task.TAB.win_efml(_task.wer,_dom.TAB,'ICON',,'ICON_BEFORE',"params_get().dom.TAB.ICON");
_task.TAB.win_efml(_task.wer,,'ICON',,'ICON_BEFORE',"params_get().task.TAB.ICON");

:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

_sql:=
   'select '
      'AT.B_CALL A_SYMBOL, AREA.NAME A_NAME, '
      'DOM.SYMBOL D_SYMBOL, DOM.NAME D_NAME, DOM.C10 D_C10, '
      'AT.B_TASK T_SYMBOL, TASK.NAME T_NAME '
   'from '
      ':_a AT left join :_b AREA using(AT.B_CALL,AREA.SYMBOL) '
             'left join :_c TASK using(AT.B_TASK,TASK.SYMBOL) '
             'left join :_d DOM using(TASK.B_DOM,DOM.SYMBOL)'
   'order by '
      '1,3'
;
_at:=_struct();
_at.TAB:=sql(_sql,app_info('area_task'),_area.TAB,_task.TAB,_dom.TAB);
_at.NDX:=_at.TAB.index('?');
_at.TAB.first();
_at.ws:=_at.TAB.mk_sel(,,,'#procatws',,,,,'U');
_at.TAB.win_fld(_at.ws,,'A_SYMBOL',,,,,,'Obszar - symbol'@);
_at.TAB.win_fld(_at.ws,,'A_NAME',,,,,,'Obszar - nazwa'@);
_at.TAB.win_fld(_at.ws,,'D_SYMBOL',,,,,,'Dziedzina - symbol'@);
_at.TAB.win_fld(_at.ws,,'D_NAME',,,,,,'Dziedzina - nazwa'@);
_at.TAB.win_fld(_at.ws,,'T_SYMBOL',,,,,,'Czynność - symbol'@);
_at.TAB.win_fld(_at.ws,,'T_NAME',,,,,,'Czynność - nazwa'@);
_at.TAB.win_act(_at.ws,,'Formuła','K&olor',,,"_cfg:=params_get().cfg; _cfg.inverse:=~_cfg.inverse",,1);
_at.TAB.win_act(_at.ws,,'Szukaj');
_at.TAB.win_act(_at.ws,,'Kolejność');
_at.TAB.win_act(_at.ws,,'Wyświetl',,,,"
   params_set(_par:=params_get());
   _at:=_par.at;
   _area:=_par.area;
   _dom:=_par.dom;
   _task:=_par.task;
   _area.TAB.cntx_psh();
   _area.TAB.index(_area.NDX);
   _area.TAB.prefix();
   _dom.TAB.cntx_psh();
   _dom.TAB.index(_dom.NDX);
   _dom.TAB.prefix();
   _task.TAB.cntx_psh();
   _task.TAB.index(_task.NDX);
   _task.TAB.prefix();
   {? _area.TAB.find_key(_at.TAB.A_SYMBOL,) &
      _dom.TAB.find_key(_at.TAB.D_SYMBOL,) &
      _task.TAB.find_key(_at.TAB.D_SYMBOL,_at.TAB.T_SYMBOL,)
   || _at.TAB.display()
   || melody()
   ?};
   _task.TAB.cntx_pop();
   _dom.TAB.cntx_pop();
   _area.TAB.cntx_pop();
   ~~
");
_at.TAB.win_act(_at.ws,,'Rekord',,,,"_par:=params_get(); {? _par.cfg.inverse || ',' || '' ?}+_par.at.TAB.D_C10");
_at.wep:=_at.TAB.mk_edit('Czynność w obszarze'@,,'#procatwep');
_at.TAB.win_ewin(_at.wep,_area.TAB,_area.wep,'Obszar'@);
_at.TAB.win_ewin(_at.wep,_dom.TAB,_dom.wep,'Dziedzina (czynności)'@);
_at.TAB.win_ecol(_at.wep);
_at.TAB.win_ewin(_at.wep,_task.TAB,_task.wep,'Czynność'@);
_at.TAB.win_edit(_at.wep);
_at.TAB.win_efml(_at.wep,_area.TAB,'ICON',,'ICON_BEFORE',"params_get().area.TAB.ICON");
_at.TAB.win_efml(_at.wep,_dom.TAB,'ICON',,'ICON_BEFORE',"params_get().dom.TAB.ICON");
_at.TAB.win_efml(_at.wep,_task.TAB,'ICON',,'ICON_BEFORE',"params_get().task.TAB.ICON");

:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

_mode:='maximized';

_grp:=_dom.TAB.grp_make('Informacje procesowe'@);
_dom.TAB.grp_sel(_grp,_dom.TAB,_dom.ws,'Dziedziny'@,,,,,,,,,_mode);
::_dom.TAB.grp_sel(_grp,_lic.TAB,_lic.ws,'Licencje'@,,,,,,,,,_mode);
_dom.TAB.grp_sel(_grp,_area.TAB,_area.ws,'Obszary'@,,,,,,,,,_mode);
_dom.TAB.grp_sel(_grp,_task.TAB,_task.ws,'Czynności'@,,,,,,,,,_mode);
_dom.TAB.grp_sel(_grp,_at.TAB,_at.ws,'Czynności w obszarach'@,,,,,,,,,_mode);
_dom.TAB.win_sel(_grp);

params_set(
   'cfg',_cfg,
   'dom',_dom,
   'lic',_lic,
   'area',_area,
   'task',_task,
   'at',_at
);

_dom.TAB.select()

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:39 de8493cc842f3a50bcfd41c7582953daedd517c9137e8b19a1495f5bf0ebf2f1deb8c8f344acefbe595691fe23d927be9f8b6dc6bda27560e4894b87106aeb9023b6f26732fe3d1e8bc841fd113ae94afcb66b4fabda6e8a3a1e60f6812f0e714ef9bf6c01e655e8094bc294a2eac02095af9992d463d0381783ef94c13c4ec4
