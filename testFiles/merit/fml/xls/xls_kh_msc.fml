:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: xls_kh_msc.fml
:: Utworzony: 26.09.2018
:: Autor: AWI
:: Systemy:
::======================================================================================================================
:: Zawartość: Formuły do obsługi eksportu/importu miejsc dostaw licencjobiorcy
::======================================================================================================================


\init
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [18.42]
:: OPIS: Inicjalizuje mechanizm importu/eksportu do Excel
::   WE: _a - obj_new - środowisko mechanizmu
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_def:=_a;
_def.ID:='KH_MSC';
_def.DOMAIN:=exec('name','#b_domain','ZWS');
_def.FUNPAR:='ZWS_EDI_DEF';
_def.MULTIFIR:='T';

_def.FILE:='parametryzacja.xlsx';
_def.SHEET:='Miejsca dostaw=1,1';
_def.NAME:='Miejsca dostaw licencjobiorcy'@;
_def.DESC:='Miejsca dostaw licencjobiorcy';

_def.PREFIX:="KH_MSC.index('KH_NAZ'); KH_MSC.prefix(null())";
_def.TABLE:="KH_MSC";
_def.FIELDS:="exec('fields','xls_kh_msc',_a)";

_def.BEFORE:="KH_MSC.cntx_psh()";
_def.AFTER:="KH_MSC.cntx_pop()";

_def.EXPORT:="exec('export','xls_kh_msc',_a,_b)";
_def.VALIDATE:="exec('validate','xls_kh_msc',_a,_b,_c)";
_def.IMPORT:="exec('import','xls_kh_msc',_a,_b,_c)";
_def.SELECT:="";
~~


\fields
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [18.42]
:: OPIS: Określa pola tabeli
::   WE: _a - obiekt z definicją pól który należy zasilić
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_def:=_a;

_def.define('NAZ',MS.name(KH_MSC,'NAZ'),1,,MS.comment(KH_MSC,'NAZ'));
_def.define('KRAJ',MS.name(KH_MSC,'KRAJ'),1,,MS.comment(KH_MSC,'KRAJ'));
_def.define('MIASTO',MS.name(KH_MSC,'MIASTO'),1,,MS.comment(KH_MSC,'MIASTO'));
_def.define('UL',MS.name(KH_MSC,'UL'),1,,MS.comment(KH_MSC,'UL'));
_def.define('DOM',MS.name(KH_MSC,'DOM'),1,,MS.comment(KH_MSC,'DOM'));
_def.define('LOKAL',MS.name(KH_MSC,'LOKAL'),1,,MS.comment(KH_MSC,'LOKAL'));
_def.define('POCZ',MS.name(KH_MSC,'POCZ'),1,,MS.comment(KH_MSC,'POCZ'));
_def.define('TEL',MS.name(KH_MSC,'TEL'),1,,MS.comment(KH_MSC,'TEL'));
_def.define('EMAIL',MS.name(KH_MSC,'EMAIL'),1,,MS.comment(KH_MSC,'EMAIL'));
_def.define('OS',MS.name(KH_MSC,'OS'),1,,MS.comment(KH_MSC,'OS'));
_def.define('UWAGI',MS.name(KH_MSC,'UWAGI'),1,,MS.comment(KH_MSC,'UWAGI'));
_def.define('KPOCZ',MS.name(KH_MSC,'KPOCZ'),1,,MS.comment(KH_MSC,'KPOCZ'));
_def.define('GLN',MS.name(KH_MSC,'GLN'),1,,MS.comment(KH_MSC,'GLN'));
~~


\export
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [18.42]
:: OPIS: Wypełnia obiekt który zapisze w Excel wiersz danymi z rekordu
::       Użycie: export
::   WE: _a - obj_new - środowisko mechanizmu
::       _b - obj_new - obiekt który zasilić wartościami z pól
::   WY: ANY - dowolny wynik (zwracany przez _excel.write_async())
::----------------------------------------------------------------------------------------------------------------------
_excel:=_a;
_table:=_b;

_result:=1;
_table.NAZ.VALUE:=KH_MSC.NAZ;
_table.KRAJ.VALUE:=KH_MSC.KRAJ;
_table.MIASTO.VALUE:=KH_MSC.MIASTO;
_table.UL.VALUE:=KH_MSC.UL;
_table.DOM.VALUE:=KH_MSC.DOM;
_table.LOKAL.VALUE:=KH_MSC.LOKAL;
_table.POCZ.VALUE:=KH_MSC.POCZ;
_table.TEL.VALUE:=KH_MSC.TEL;
_table.EMAIL.VALUE:=KH_MSC.EMAIL;
_table.OS.VALUE:=KH_MSC.OS;
_table.UWAGI.VALUE:=KH_MSC.UWAGI;
_table.KPOCZ.VALUE:=KH_MSC.KPOCZ;
_table.GLN.VALUE:=KH_MSC.GLN;

_result


\validate
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [18.42]
:: OPIS: Waliduje czy można poprawić/dodać rekord
::   WE: _a - obj_new() - tablica nazwana z polami odczytanymi z excel
::       _b - INTEGER - tryb pracy: 0 - nie zastępować istniejących wartości, 1 - zastępować istniejące
::       _c - obiekt Result, zawiera .RESULT, .ACTION, .OBJ (własna tablica parametrów do przekazania dla import)
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_obj:=_a;
_mode:=_b;
_result:=_c;

:: wychwyć błędy krytyczne
_fld:=
   {? _obj.NAZ='' || 'NAZ'
   || ''
   ?};
{? _fld<>''
::  katastrofa
|| _result.msg_empty(_fld);
   _result.RESULT:=0;
   return()
?};

KH_MSC.index('KH_NAZ');
KH_MSC.prefix(null(),_obj.NAZ,_obj.NAZ);
{? KH_MSC.first()
|| {? _mode=0
   || _result.RESULT:=0
   || _result.ACTION:='put'
   ?}
|| _result.ACTION:='add'
?};
{? _result.RESULT=1
|| {? _result.ACTION='add' || KH_MSC.blank() ?};

   KH_MSC.NAZ:=_obj.NAZ;
   KH_MSC.KRAJ:=_obj.KRAJ;
   KH_MSC.MIASTO:=_obj.MIASTO;
   KH_MSC.UL:=_obj.UL;
   KH_MSC.DOM:=_obj.DOM;
   KH_MSC.LOKAL:=_obj.LOKAL;
   KH_MSC.POCZ:=_obj.POCZ;
   KH_MSC.TEL:=_obj.TEL;
   KH_MSC.EMAIL:=_obj.EMAIL;
   KH_MSC.OS:=_obj.OS;
   KH_MSC.UWAGI:=_obj.UWAGI;
   KH_MSC.KPOCZ:=_obj.KPOCZ;
   KH_MSC.GLN:=_obj.GLN
?};
~~


\import
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [18.42]
:: OPIS: Waliduje czy można poprawić/dodać rekord
::   WE: _a - obj_new() - tablica nazwana z polami odczytanymi z excel
::       _b - INTEGER - tryb pracy: 0 - nie zastępować istniejących wartości, 1 - zastępować istniejące
::       _c - obiekt Result, zawiera .RESULT, .ACTION, .OBJ (własna tablica parametrów do przekazania dla import)
::  TAG: <PUBLICZNA>
::----------------------------------------------------------------------------------------------------------------------
_obj:=_a;
_mode:=_b;
_validate:=_c;

_result:=0;
{? _validate.RESULT=1
||
   {? _validate.ACTION='add'
   ||
      _result:=KH_MSC.add(1)

   |? _validate.ACTION='put'
   ||
      _result:=KH_MSC.put(1)
   ?}
?};
{? _result=0
||

   {? _validate.ACTION='add'
   ||
      _validate.MSG:='Dodanie miejsca dostawy licencjobiorcy nie powiodło się.'@
   ||
      _validate.MSG:='Poprawa miejsca dostawy licencjobiorcy nie powiodła się.'@
   ?}
?};
_result

:Sign Version 2.0 jowisz:1048 2023/06/23 14:17:11 00362c7d4ae217c1fb8ca918504f975d7014f018da9edce73506952e1b4192bd8bb499bcfdcac5b6b2cc6eec6e560fdffe929e37c7bc5c5d4a23ff900287c5763be9fc586e2cf7d4325df4b97df51b7c02d0cf9cfe8c7e2047bb35f24ab4195797c081bff63f16eb3aa47e065512bb0ab6e82e511439571f5ab683887b01e60f
