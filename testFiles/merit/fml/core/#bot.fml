:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone

\start
::----------------------------------------------------------------------------------------------------------------------
::  UTW:   bryQ [22.26]
:: OPIS:   formuła startowa zakładki chatbota
::----------------------------------------------------------------------------------------------------------------------
: ukrycie pozycji Parametry w menu PULPIT_J

AI:=exec('start','genius');
{? AI.talk(username) ||
   menu_act('PULPIT_J','P');
   dsk_menu('PULPIT_J','Czy zamknąć okno z dialogiem Genius?'@,"exec('panel','#bot',1)","exec('ctr_callback','#bot')")
?}

\panel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: bryQ [22.26]
:: OPIS: formuła inicjująca kontrolkę webbrowser z polem dialogu na belce jterma
:: ~OST: INWEBBROWSER
::----------------------------------------------------------------------------------------------------------------------

{? exec('interm','#system')>0
|| 
	inst_dsk('@webframe>desktop');
	ctr_set('!desktop',,'setCssVarsInjectionEnabled', 1);
	ctr_set('!desktop',,'setFormulaInterfaceEnabled', 1);
	ctr_call('!desktop',,'loadBrowserControl', 'bot');
	title('Asystent Genius',,1)
||

	inst_dsk('@webbrowser2>desktop',1);
: ukrywa przyciski przeglądarkowe typu odśwież, adres
	ctr_set('!desktop',,'setButtonBarVisible','false');
	ctr_set('!desktop',,'setLocationBarVisible','false');
	ctr_set('!desktop',,'enableAudioCapture', 'file:');
: jaki typ dialogu był wybrany
	_stype:=app_info('init_param');

: tytuł zakładki dialogu
	title('Genius',,1);

:dodanie pola wyszukiwania dla kolejnych wyszukiwań w bieżącej zakładce
:ctr_set('!desktop',,'addAppTiltleBarFilterField',_stype);

: załadowanie strony
ctr_call('!desktop',,'loadBrowserControl','bot')
?};
~~


\ctr_callback
::----------------------------------------------------------------------------------------------------------------------
::  UTW: bryQ [22.26]
:: OPIS: formuła callback kontrolki bot
::----------------------------------------------------------------------------------------------------------------------

_action:=ctr_info('action');
_param:=ctr_info('param');
_ret := '{}';
{? _action = 'getConfig' || _ret := json_obj(AI.config())
|? _action = 'recognize' || _ret := AI.recognize(_param)
|? _action = 'talk' || _ret := AI.getAnswer(_param)
|? _action = 'reset' || _ret := exec('reset','genius')
|? _action = 'run' || _ret := AI.run(_param)
?};
_ret

\bot_params
::----------------------------------------------------------------------------------------------------------------------
::  UTW: bryQ [22.26]
:: OPIS: zwraca parametry do okna bot'a
::----------------------------------------------------------------------------------------------------------------------
_params:=obj_new('sessionId','message','group','ident');
_params.group:=app_info('cluster_group');
_params.ident:=app_info('app_ident');
json_obj(_params)

:Sign Version 2.0 jowisz:1048 2023/06/23 14:13:35 6308f38aeb80e13db2e1214d5da8fdfb9e97fa5cbbb65c83ac866fb68106d7cf61bb6341cae44517914c8b6978c556f3c7c424ad8bd5160ea014676acb0a33e063a8286cefbfc83fa4a4598caa59abc409ace3791d2bd1f05d5b1ab5363adade622d6d9600c9a4eebacc89b38311a061f02520202fba0b5a7dbec8ca2f6b479f
