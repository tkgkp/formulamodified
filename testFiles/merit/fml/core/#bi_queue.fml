:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzezone
::======================================================================================================================
:: Nazwa pliku: #bi_queue.fml
:: Utworzony: 30.12.2014 [17.00]
:: Autor: AWI
::======================================================================================================================
:: Zawartosc: Kolejka menadżera procesu
::======================================================================================================================


\buffer
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: Zwraca obiekt nazwany - bufor tabeli BI_QUEUE
::   WY: obj_new()
::----------------------------------------------------------------------------------------------------------------------
exec('BI_QUEUE','#buffer')


\add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: Funkcja dodająca wpis do tabeli BI_QUEUE
::   WE: _a - obj_new - tablica nazwana bedaca buforem tabeli exec('buffer','#bi_queue')
::   WY:      [REFERENCE]  - wskazanie na dodany rekord (lub już istniejący)
::----------------------------------------------------------------------------------------------------------------------
_buffer:={? var_pres('_a')>100 || _a || return(null) ?};

_res:=0;
BI_QUEUE.cntx_psh();
BI_QUEUE.prefix();
BI_QUEUE.blank();
_buffer.set();
{? BI_QUEUE.add()
|| _buffer.get();
   _res:=1
?};
BI_QUEUE.cntx_pop();
_res


\delete4biprel
::----------------------------------------------------------------------------------------------------------------------
:: DOST: PUBLIC
::  UTW: WH [17.00]
:: OPIS: Usuwa z kolejki wszystkie rekordy powiazane z danym BI_PRELem
::   WE: _a - BI_PREL.ref()
::   WY: 0 - porazka
::       1 - sukces
::----------------------------------------------------------------------------------------------------------------------
_bi_prel:=_a;

_result:=0;
_can_continue:=1;

BI_QUEUE.cntx_psh();
BI_QUEUE.index('BI_PREL');
BI_QUEUE.prefix(_bi_prel);
{? BI_QUEUE.first()
|| {!
   |? _can_continue:=BI_QUEUE.del(,1);
      BI_QUEUE.first() & _can_continue>0
   !}
?};
BI_QUEUE.cntx_pop();
{? _can_continue>0
|| _result:=1
?};
_result


\trig_a_add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: trigger BI_PREL add() po
::       Załączanie triggera odbywa się w funkcji \BI_QUEUE/#b_trig.fml tylko przy włączonym __develop
::----------------------------------------------------------------------------------------------------------------------
_bi_prel:=BI_QUEUE.BI_PREL;
_b_proc:=exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.BI_PROC().B_PROC",null());
_class:=exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.B_PREL().CLASS",'');
_b_ele:=exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.B_PREL().B_ELE",null());
::exec('log','#b_proman','bi_queue_add','clear');
::   exec('log','#b_proman','(mp_uid)'+BI_QUEUE.UID);
::   exec('log','#b_proman',tm_form(BI_QUEUE.TM_STAMP));
::   exec('log','#b_proman','(bi_prel)'+$_bi_prel);
::   exec('log','#b_proman',
::      {? _class='B_ACTION'
::      || '(act_uid)'+exec('FindInSet','#table','B_ACTION','B_ELE',_b_ele,,"B_ACTION.UID",,,'')
::      |? _class='B_EVENT'
::      || '(eve_sym)'+exec('FindInSet','#table','B_EVENT','ELEMENT',_b_ele,,"B_EVENT.SYMBOL",,,'')
::      |? _class='B_GATE'
::      || '(gat_uid)'+exec('FindInSet','#table','B_GATE','ELEMENT',_b_ele,,"B_GATE.SYMBOL",,,'')
::      || '(class): '+_class
::      ?});
::   exec('log','#b_proman','(b_proc)'+$_b_proc);
::   exec('log','#b_proman',exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.BI_PROC().B_PROC().SYMBOL"));
::exec('log','#b_proman',,'write');
~~


\trig_a_del
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AWI [17.00]
:: OPIS: trigger BI_PREL del() po
::       Załączanie triggera odbywa się w funkcji \BI_QUEUE/#b_trig.fml tylko przy włączonym __develop
::----------------------------------------------------------------------------------------------------------------------
_bi_prel:=bfld('BI_PREL');
_b_proc:=exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.BI_PROC().B_PROC",null());
_class:=exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.B_PREL().CLASS",'');
_b_ele:=exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.B_PREL().B_ELE",null());
::exec('log','#b_proman','bi_queue_add','clear');
::   exec('log','#b_proman','(mp_uid)'+BI_QUEUE.UID);
::   exec('log','#b_proman',tm_form(BI_QUEUE.TM_STAMP));
::   exec('log','#b_proman','(bi_prel)'+$_bi_prel);
::   exec('log','#b_proman',
::      {? _class='B_ACTION'
::      || '(act_uid)'+exec('FindInSet','#table','B_ACTION','B_ELE',_b_ele,,"B_ACTION.UID",,,'')
::      |? _class='B_EVENT'
::      || '(eve_sym)'+exec('FindInSet','#table','B_EVENT','ELEMENT',_b_ele,,"B_EVENT.SYMBOL",,,'')
::      |? _class='B_GATE'
::      || '(gat_uid)'+exec('FindInSet','#table','B_GATE','ELEMENT',_b_ele,,"B_GATE.SYMBOL",,,'')
::      || '(class): '+_class
::      ?});
::   exec('log','#b_proman','(b_proc)'+$_b_proc);
::   exec('log','#b_proman',exec('FindAndGet','#table',BI_PREL,_bi_prel,,"BI_PREL.BI_PROC().B_PROC().SYMBOL"));
::exec('log','#b_proman',,'write');
~~

:Sign Version 2.0 jowisz:1045 2022/06/30 14:23:08 3ec11d95a16b81465578d10754c822b4aedeee2e3d54ba49ce286ed7e0d50a94f8151598e0224420e87507736e9622be45dbdfb6c5ff7198a2339b1c117661da5f7dfd2dece3895750f6cd276fafcedea3b5f34966eca8a88a03fc402bcec8345cd6eb107ef01b103be86c047b53eecce161d7e811fa97c6896ad96ab4a566bd
