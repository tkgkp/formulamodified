:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone


\start
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [P.40]
:: OPIS:   formuła startowa zakładki wyszukiwania
::----------------------------------------------------------------------------------------------------------------------
: ukrycie pozycji Parametry w menu PULPIT

menu_act('PULPIT_J','P');
dsk_menu('PULPIT_J','Czy zamknąć bieżącą zakładkę'@,"exec('panel','#search',1)","exec('ctr_callback','#search')")

\start_p
::----------------------------------------------------------------------------------------------------------------------
::  UTW: bryq
:: OPIS:   formuła startowa zakładki wyszukiwania z frazą startową
::----------------------------------------------------------------------------------------------------------------------
: ukrycie pozycji Parametry w menu PULPIT
_exe:='exec(\'panel\',\'#search\',1,\''+_a+'\')';
_call:='exec(\'ctr_callback\',\'#search\',\''+_a+'\',\''+_b+'\')';
menu_act('PULPIT_J','P');
dsk_menu('PULPIT_J','Czy zamknąć bieżącą zakładkę'@,$_exe,$_call)


\panel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [P.40]
:: OPIS: formuła inicjująca kontrolkę webbrowser z polem szukania na belce jterma
:: ~OST: INWEBBROWSER
::----------------------------------------------------------------------------------------------------------------------


{? exec('interm','#system')>0
|| 
	inst_dsk('@webframe>desktop');
	ctr_set('!desktop',,'setCssVarsInjectionEnabled', 1);
	ctr_set('!desktop',,'setFormulaInterfaceEnabled', 1);
	ctr_call('!desktop',,'loadBrowserControl', 'elastic');
	title('Wyszukiwanie w danych',,1)
||   

	inst_dsk('@webbrowser2>desktop',1);

: ukrywa przyciski przeglądarkowe typu odśwież, adres
	ctr_set('!desktop',,'setButtonBarVisible','false');
	ctr_set('!desktop',,'setLocationBarVisible','false');

: jaki typ wyszukiwania był wybrany
	_stype:=app_info('init_param');

: tytuł zakładki wyszukiwania
: title(~(1-_stype),,1);
	{? _ > 1
		|| title('Oto co znalazł Asystent',,1)
		|| title('Szukaj w danych',,1)
	?};
: dodanie pola wyszukiwania dla kolejnych wyszukiwań w bieżącej zakładce
	{? _ < 2 || ctr_set('!desktop',,'addAppTiltleBarFilterField',_stype) ?};

:załadowanie strony
	ctr_call('!desktop',,'loadBrowserControl','%elastic')
?};
~~


\ctr_callback
::----------------------------------------------------------------------------------------------------------------------
::  UTW: DSYS [P.40]
:: OPIS: formuła callback kontrolki
::----------------------------------------------------------------------------------------------------------------------

_param:=ctr_info('param');
{? _param='params' ||
   {? _>0
      || return(exec('elastic_params','#search',_a,_b))
      || return(exec('elastic_params','#search'))
   ?}
?};
:uwaga w gsub znak zamieniany to w utf-8 0xc2a0 (non breaking space) utf8_maz wywala się na tym
_wyn:=exec('search','elastic',_param);
utf8_maz(_wyn,"{? _a = 0 || ' ' || '' ?}")


\elastic_params
::----------------------------------------------------------------------------------------------------------------------
::  UTW: trocek [19.42]
:: OPIS: zwraca parametry do wyszukiwarki es
::----------------------------------------------------------------------------------------------------------------------
_es:=exec('elastic','elastic');
_params:=obj_new('interm','group','ident','company','names','colors','server','blob_size','page_size','query','dates');
_params.group:=app_info('cluster_group');
_params.ident:=app_info('app_ident');
_params.colors:=exec('colors','elastic');
_params.company:=exec('get_firmaopis','elastic');
_params.blob_size:=exec('get_blobsize','elastic');
_params.names:=exec('labels','elastic');
_params.page_size:=_es.MAXRECORDS;
_server:=exec('server','#system');
_params.server:='%1:%2'[_server.address,_server.port];
_params.interm:=exec('interm','#system');
{? _>0 || _params.query:=_a; _params.dates:=_b ?};
json_obj(_params)

:Sign Version 2.0 jowisz:1048 2023/06/23 14:13:35 75a520527e8ef50ebba8d37b98f5b4e30efb2e97ab59ae5702df67363a22e3985896eb58898dda2610e73193ae999274fa00ca397e84ac9505144d445ff8ed04c8f5f4bdd0ca7eddaeefa43dea9e3faed74b96895e9b026b6dee63daecffd38f0a6fe3a8a97c09a4ed4ee7f02aaee596624274d6acc986664a96ae39742eced8
