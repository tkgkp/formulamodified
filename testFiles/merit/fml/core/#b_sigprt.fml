:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: #b_sigprt.fml [17.00]
:: Utworzony: 06.10.2015
:: Autor: TS
::======================================================================================================================
:: Zawartość: Obsługa własności (parametrów) dla zdarzenia sygnałowego
::======================================================================================================================


\buffer
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [17.00]
:: OPIS: Zwraca obiekt nazwany - bufor tabeli B_SIGPRT
::   WY: obj_new()
::  TAG: <PROCES>
::----------------------------------------------------------------------------------------------------------------------
exec('B_SIGPRT','#buffer')


\add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [17.00]
:: OPIS: Dodaje do tabeli B_SIGPRT jeden rekord
::   WE: _a - obj_new - tablica nazwana będąca buforem tabeli exec('buffer','#b_sigprt')
::   WY: B_SIGPRT.ref() lub null()
::  TAG: <PROCES><ADD>
::----------------------------------------------------------------------------------------------------------------------
_buffer:={? var_pres('_a')>100
         || _a
         || exec('buffer','#b_sigprt')
         ?};
_result:=null();

B_SIGPRT.cntx_psh(); B_SIGPRT.clear();
B_SIGPRT.blank();
_buffer.set();
{? B_SIGPRT.add()>0
|| _result:=B_SIGPRT.ref()
?};
B_SIGPRT.cntx_pop();
_result


\delete
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [17.00]
:: OPIS: Kasuje podany rekord tabeli B_SIGPRT (wykonywane w transakcji!!!)
::   WE: _a - B_SIGPRT.ref()
::   WY: >0 -wyczyszczone,
::      <=0 -niewyczyszczone
::UWAGA: Parametry bez [] są wymagane, formuła może nie sprawdzać czy zostały podane i może wystąpić błąd.
::----------------------------------------------------------------------------------------------------------------------
:: jeżeli transakcja została zerwana, to nie ma sensu przetwarzać formuły
{? do_state()=2 || return(-100) ?};

_ref:=_a;

_result:=0;
_can_continue:=1;

:: sprawdzam, czy to w tej formule będę zakładał transakcję, czy już jest założona
_mydo:=do_state()=0;
{? _mydo || do() ?};
B_SIGPRT.cntx_psh(); B_SIGPRT.clear();
{? B_SIGPRT.seek(_ref)
|| {? exec('can_delete','#b_sigprt',_ref)>0
   || {? exec('clean','#b_sigprt',_ref)>0
      || {? B_SIGPRT.del(,1)>0
         || _result:=1
         || undo();
            _result:=-4
         ?}
      || _result:=-3
      ?}
   || _result:=-2
   ?}
|| _result:=0
?};
B_SIGPRT.cntx_pop();
{? _result<0
|| undo()
?};

{? _mydo || end() ?};
_result


\can_delete
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [17.00]
:: OPIS: Sprawdza, czy można usunąć B_SIGPRT
::   WE: _a - B_SIGPRT.ref()
::----------------------------------------------------------------------------------------------------------------------
_b_sigtyp:=_a;

_result:=1;
_can_continue:=1;

_result


\clean
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [17.00]
:: OPIS: Czyści powiązania do rekordu tabeli B_SIGTYP
::   WE: _a - B_SIGTYP.ref()
::   WY: >0 -wyczyszczone,
::       <=0 -niewyczyszczone
::UWAGA: Parametry bez [] są wymagane, formuła może nie sprawdzać czy zostały podane i może wystąpić błąd.
::----------------------------------------------------------------------------------------------------------------------
{? do_state()=2 || return(-100) ?};

_ref:=_a;

_result:=0;
_can_continue:=1;

_mydo:=do_state()=0;
{? _mydo || do() ?};
:: --- powiązania do ---

:: --- wszystkie powiązania usunięte? ---
{? _can_continue>0
|| _result:=1
|| undo()
?};
{? _mydo || end() ?};

_result

:Sign Version 2.0 jowisz:1028 2019/06/07 15:58:46 4cb69efd879240000dfca4bbc6f4197a10d9f368e6bf3cdf583a5e72930c0aecdc9413e331e2bed48e33bbfe9408d968c32799d5d415805d7c9710aaefc66400c77ea45405bda2fb9282901a7466a3cc24ce5f301522cb8d708cd1663893db403e8bd155bdef0c170931526af11944ae0dea658b1a49eee7670a479bc38b6b88
