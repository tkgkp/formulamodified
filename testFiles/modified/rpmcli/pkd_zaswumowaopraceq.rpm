:!UTF-8
{TITLE:Umowa o pracę - NUCO}
{PRINTER: exec('prt','param_wydr','v',KST),exec('rep_set','rap_zew','PXX_ZASWUMPR')='T',,,,'I','B',,,,,,1,
          PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   PAR_WYDR.TITLE:='';
   VAR_DEL.delete('Text','lmt','indent','cnt','num','plik','__okr_new','__uzas1','__uzas2','__CALL','__xr_ins');
   VAR_DEL.delete('par','info','lnr','__ppsf','__glNr','__nru01','__CALL2');
   PARCZAS:=PAR_WYDR.CZAS;
   PAR_WYDR.CZAS:=0;

   H_UM.cntx_psh();
   H.cntx_psh();

   plik:=Text:=__uzas1:=__uzas2:='';
   lmt:=cnt:=num:=indent:=__okr_new:=0;
   __glNr:=1;
   info:=obj_new('UNA','DZU','OZA','PESEL','ORZ','STN','WYD','WYM','SW1','SW2','SW3','SW4','SW5','IW','GOD','PAT','PAW',
      'DRP','UZAS1','UZAS2','DRU','KW_SL1','KW_SL2','KW_SL3','KW_SL4','PPSF_OD','PPSF_DO','PPSF_A','PPSF_R','PPSF_I',
      'INNEW3','ZAM_OKR','PRZ_USPR');
   info.ZAM_OKR:='';

   __xr_ins:=exec('new_ins','rap_zew','PXX_ZASWUMPR');
   __ppsf:=exec('is_pzd01','ppsf');
   __nru01:=exec('upgrade2226_nru01','wnioski_urlopowe');
   {? __ppsf
   || Cntx.psh(PPSF_H,PPSFROZD,PPSF_ADR,PPSFT);
      Cntx.clr(PPSF_H,PPSFROZD,PPSF_ADR,PPSFT)
   ?};
   par:=params_get();
   {? type_of(par)=type_of(~~)
   || par:=obj_new('UM','ZAL','DALEJ')
   ?};
   {? var_pres('UM',par)<0
   || _par:=exec('obj_ntab_set','#array',par,'UM',~~);
      obj_del(par);par:=_par; obj_del(_par)
   ?};
   {? var_pres('ZAL',par)<0
   || _par:=exec('obj_ntab_set','#array',par,'ZAL','');
      obj_del(par);par:=_par; obj_del(_par)
   ?};
   {? var_pres('DALEJ',par)<=0
   || _par:=exec('obj_ntab_set','#array',par,'DALEJ','');
      obj_del(par);par:=_par; obj_del(_par);
      par.DALEJ:=exec('uprawnieniawrap','pkd',
         'Przebiegu zatrudnienia'@,
         'PKD_EZK_PPZA',
         'PKD_EZK_RPZA'
      );
      {? par.DALEJ=''
      || par.UM:=exec('umowa_o_prace','!pkd_zes_orza');
         par.ZAL:=''
      || FUN.emsg('Brak wymaganych uprawnień do przeglądania informacji o:%1'@ [par.DALEJ])
      ?}
   ?};

   'nuco';
   __QPROCENTPREMII:=0
}
{END:
   PAR_WYDR.CZAS:=PARCZAS;
   H.cntx_pop();
   H_UM.cntx_pop();
   {? __ppsf
   || PPSF_H.f_clear();
      PPSF_ADR.f_clear();
      Cntx.pop(PPSF_H,PPSFROZD,PPSF_ADR,PPSFT)
   ?};
   exec('del_ins','rap_zew',__xr_ins);
   VAR_DEL.delete('Text','lmt','indent','cnt','num','plik','__okr_new','__uzas1','__uzas2','__CALL','__xr_ins');
   VAR_DEL.delete('par','info','lnr','__ppsf','__glNr','__nru01','__CALL2',__QPROCENTPREMII)
}
{COMMENT}OLD: zaswumpr.rpm{COMMENT-}
{COMMENT}OLD: zaswumpr.rpi{COMMENT-}
{COMMENT}OLD: zaswump2.rpi{COMMENT-}
{EXIT: +par.DALEJ}
{EXIT: ~par.UM.first()}
{EXIT: ~__xr_ins}
{FOR: par.UM}
 {DO}
    {IF: H_UM.seek(par.UM.UM,,1)}
{COMMENT}  NUCO
       {INCLUDE: p_zaswump2.rpi}
           NUCO  {COMMENT-}
       {INCLUDE: p_zaswump2q.rpi}
{COMMENT}  NUCO  {COMMENT-}
    {FI}
 {OD}
{EXIT: ~exec('ready','rap_zew',__xr_ins)}
{ __CALL:=proc_exec('umpr@zasw',#__xr_ins); ~~ }
{ __CALL2:=proc_exec('umpr2@zasw',#__xr_ins); ~~ }
{IF: (cli_ver()='jterm' | exec('cli_ver','#system')='interm') & (
     exec('rep_set','rap_zew','PXX_ZASWUMPR',1)='T' |
     exec('rep_set','rap_zew','PXX_ZASWUMPR_PRAUT',1)='T')}
   {FOR: par.UM}{DO}
      {IF: H_UM.seek(par.UM.UM,,1)
         & __CALL.find_tab(,'H_UM_REF',,'=',$H_UM.ref())
         & __CALL2.find_tab(,'H_UM_REF',,'=',$H_UM.ref())}{
         H_UM.P().OSOBA();
         _usun:=0;
         _ret:=~~;
         _paperless:=var_pres('par',par)>100;
         {? __CALL.PAT='N' & exec('rep_set','rap_zew','PXX_ZASWUMPR',1)='T'
         || _ret:=exec('wypelnij','szablon','PXX_ZASWUMPR',,,2,,_paperless);
            _usun:=1
         |? __CALL.PAT<>'N' & exec('rep_set','rap_zew','PXX_ZASWUMPR_PRAUT',1)='T'
         || _ret:=exec('wypelnij','szablon','PXX_ZASWUMPR_PRAUT',,,2,,_paperless);
            _usun:=1
         ?};
         {? _usun<>0
         || __CALL.del()
         ?};
         {? par.ZAL='1' & type_of(_ret)>100 & _ret.STATUS=1
         || {? _paperless
            || params_exec('dodaj_dokument','paperless',_ret.INFO,H_UM.uidref(),par)
         || exec('add_zal','zal','um',,_ret.INFO)
            ?}
         ?}; ~~
      }{FI}
   {OD}
   {EXIT: __CALL.size()=0}
{FI}
{IF: cli_ver()='jterm' & exec('rep_set','rap_zew','zaswumpr')='T'}
   { exec('use_tmp','rap_zew','zaswumpr');
     {? par.ZAL='1'
     || {? var_pres('par',par)>100
        || params_exec('dodaj_dokument','paperless','@!Tmp\\macrotmp.doc',H_UM.uidref(),par)
     || exec('add_zal','zal','um')
        ?}
     ?}; ~~ }
   {EXIT}
{ELSE}
{COMMENT}  NUCO
   {INCLUDE: p_zaswumpr.rpi}
           NUCO  {COMMENT-}
   {INCLUDE: p_zaswumprq.rpi}
{COMMENT}  NUCO  {COMMENT-}
{FI}