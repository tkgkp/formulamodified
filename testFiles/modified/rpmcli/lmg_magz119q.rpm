:!UTF-8
{TITLE: Towary bez inwetaryzacji}
{PRINTER: exec('set_parw','param_wydr'); exec('prt','param_wydr','v'),,,,,'Q','C',,,,,,1,
   PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1}
{BEGIN:
   {? var_press('tabinw')>100 || obj_del(tabinw) ?};
   {? var_press('tabsc')>100 || obj_del(tabsc) ?};
   undefine();
   define('D1',date(ST.AR,ST.AM,1),'Od dnia:');
   define('D2',date(ST.AR,ST.AM,0),'Do dnia:');
   {? def_edit("chk_rec",'Sprawdzenie za okres')
   || d1:=DEFINE.D1;
      d2:=DEFINE.D2
   || d1:=d2:=date(0,0,0)
   ?}
}
{END:
   {? var_press('tabinw')>100 || obj_del(tabinw) ?};
   {? var_press('tabsc')>100 || obj_del(tabsc) ?};
   undefine()
}
{IF: d1=date(0,0,0) | d2=date(0,0,0) | d2<d1}
{  msg('Błędny zakres dat !!'); ~~}
{ELSE}
{  tabinw:=sql('
      select M.KTM
      from @INP join M join @INN join MG
      where INN.DI>=to_date(:_a) and INN.DI<=to_date(:_b) and INN.D is not null and MG.SYM=\':_c\' and INN.RODZ=\'I\'',
      DEFINE.D1,DEFINE.D2,ST.MAG().SYM);
   ~~
}
{  tabsc:=sql('
      select distinct MG.SYM,M.KTM,M.N
      from @SC join M join MG
      where SC.S>0 and MG.SYM=\':_a\' order by M.KTM',
      ST.MAG().SYM);
   ~~
}
{  tabinw.index(tabinw.ndx_tmp(,,'KTM',,0,'KTM',,0));
   tabsc.prefix();
   {? tabsc.first()
   || {!
      |? tabinw.prefix(tabsc.KTM,tabsc.KTM);
         {? tabinw.first()
         || tabsc.del()
         || tabsc.next()
         ?}
      !}
   ?};
   _winsel:=tabsc.mk_sel('','',0);
   tabsc.win_fld(_winsel,,'SYM',,,10,,,'Magazyn');
   tabsc.win_fld(_winsel,,'KTM',,,15,,,'Indeks');
   tabsc.win_fld(_winsel,,'N',,,60,,,'Nazwa');
   tabsc.win_sel(_winsel);
   tabsc.prefix();
   tabsc.first();
   tabsc.select();
   ~~
}
{FI}
{EXIT}
