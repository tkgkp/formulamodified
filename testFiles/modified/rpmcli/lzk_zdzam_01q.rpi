:!UTF-8
{DEFINEFONT: 'TM=Bookman Old Style,,M,,0,0'}
{DEFINEFONT: 'TMB=Bookman Old Style,,N,,0,0'}
{DEFINEFONT: 'TF=Bookman Old Style,,F,,0,0'}
{FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
{
   _nag_wc1:=charleft()/2;
   _nag_wc2:=charleft()-_nag_wc1;
   NAG.add("na[1]",_nag_wc1,'');
   NAG.add("na[2]",_nag_wc2,'');
"PeKa - MOD NUCO - usuniecie planowanej daty dostawy";
   lmt:=int((charleft()-PRN.width())/2);
   PAR_WYDR.TITLE:=exec('tr','tlumaczenia','6000101')+' '+exec('tr','tlumaczenia','1000102')+' '+ZD_NAG.SYM+'\n '
                  +exec('tr','tlumaczenia','1000127')+' '+form(ZD_NAG.DATA,,4);
   prn1:='PRN'; prn2:='PRNS'
;~~}
{COMMENT}   SIGNATURE                                                {COMMENT-}
{SUBSTITUTE: 'FOOT'}
{COMMENT}   REPORT-HEADER                                            {COMMENT-}
{SUBSTITUTE: 'HEADNUCO'}
{ns:=0;~~}
{COMMENT}   dokument anulowany                                       {COMMENT-}
{FONT: exec('font','param_wydr','ory_kop')}{SPACE: exec('space','param_wydr')}
{IF: ZD_NAG.STAT_REJ='A'}{<1}{>{charleft}exec('tr','tlumaczenia','1000215')}{FI}
{LINE}
{FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
{
"--szerokosc kolumn--";
VAR_DEL.delete('X_Xw1');
X_Xw1:=tab_tmp(1
   ,'P','INTEGER',''
   ,'M','STRING[160]',''
   ,'JM','STRING[5]',''
   ,'IL','REAL',''
   ,'C','REAL',''
   ,'WAR','REAL',''
   ,'REF','STRING[16]','');

_sum_war:=0;
"PeKa - MOD NUCO - kolejnosc sortowania wg indeksu";
ZD_POZ.index(sortuj); ZD_POZ.prefix(ZD_NAG.ref());
{? ZD_POZ.first
||
   dokl_c:=exec('fld_prec','#field',ZD_POZ,{? walh=1 || 'CENA' || 'CWAL' ?});
   {!
   |? _pop:=((+form((frac(ZD_POZ.IL))))-2);
      {? _pop>0 & _pop>ddokl || ddokl:=_pop ?};
      X_Xw1.clear();
      X_Xw1.blank();
      X_Xw1.P:=ZD_POZ.POZ;
      X_Xw1.M:=ZD_POZ.M().KTM+' - '+M.N;
      X_Xw1.JM:=ZD_POZ.JM().KOD;
      X_Xw1.IL:=ZD_POZ.IL;
      X_Xw1.C:={? walh=1 || ZD_POZ.CENA || ZD_POZ.CWAL ?};
      X_Xw1.WAR:={? walh=1 || ZD_POZ.WAR || ZD_POZ.WARW ?};
      X_Xw1.REF:=$ZD_POZ.ref();
      X_Xw1.add(1);
      _sum_war+=X_Xw1.WAR $2;
      ZD_POZ.next
   !}
?};

lmt:=charleft()-4;
k[1]:=8;                            p[1] :='form(X_Xw1.IL,,ddokl,\' ,\')';
"PeKa - MOD NUCO - wydruk ilosciowy";
{? __PARAM_W.ILOSC='T'
|| k[2]:=0;                            p[2] :='';
   k[3]:=0;                            p[3] :=''
|| k[2]:=5;                            p[2] :='form(X_Xw1.C,,dokl_c,\' ,\')';
   k[3]:=7;                            p[3] :='form(X_Xw1.WAR,,2,\' ,\')'
?};
k[4]:=-4;                           p[4] :='X_Xw1.P';
k[5]:=0;                            p[5] :='X_Xw1.M';
k[6]:=4;                            p[6] :='X_Xw1.JM';

_len:=obj_len(k);
_buf:=obj_new(_len); {! _i.._len |! _buf[_i]:=0 !};
_max:=obj_new(_len); {! _i.._len |! _max[_i]:=0 !};

X_Xw1.clear();
{? X_Xw1.first()
|| {!
   |? {! _i.._len
      |! _war:=($p[_i])();
         _typ:=type_of(_war);
         {? _typ=1 || _w:=(+form(_war));
                      {? _max[_i]<_w || _max[_i]:=_w; _buf[_i]:=_w ?}
         |? _typ=2 || _w:=(+_war);
                      {? _max[_i]<_w || _max[_i]:=_w; _buf[_i]:=_w ?}
         |? _typ=4 || _buf[_i]:=10
         |? _typ=5 || _buf[_i]:=5
         ?}
      !};
      X_Xw1.next()
   !}
?};

_max[3]:=_buf[3]:=(+form(_sum_war,,2));

{! _i.._len
|! {? k[_i]<0         || k[_i]:=-k[_i]
   |? k[_i]<=_buf[_i] || k[_i]:=_buf[_i]
   ?}
!};
k[5]:=1;
obj_del(_buf); obj_del(_max);

{! _ii:=1..2
|!
   PRN.add("w[1]",k[4],exec('tr','tlumaczenia','6000201'),1);
   PRN.add("form(w[3])",k[5],exec('tr','tlumaczenia','1000181'));
   PRN.add("form(w[7])",k[6],exec('tr','tlumaczenia','1000184'));
   PRN.add("form(w[4],,ddokl)",k[1],exec('tr','tlumaczenia','1000183'),1);
   "PeKa - MOD NUCO - wydruk ilosciowy";
   {? __PARAM_W.ILOSC='N'
   || PRN.add("form(w[5],,dokl_c)",k[2],exec('tr','tlumaczenia','1000188'),1);
      PRN.add("form(w[6],,2)",k[3],exec('tr','tlumaczenia','1000189'),1)
   ?};
   {? _ii=1
   ||
      k[5]+=charleft-PRN.width();
      VAR_DEL.delete('PRN');
      PRN:=obj_new(@.CLASS.PRINT,6); PRN.s_frame()
   ?}
!};
"PeKa - MOD NUCO - wydruk ilosciowy";
{? __PARAM_W.ILOSC='N'
|| PRNS.add(" exec('tr','tlumaczenia','6000302')+' '+{? walh=1 || INFO.NAROD().KOD || ZD_NAG.WAL().KOD ?}",k[4]+3+k[5]+3+k[6],,1);
   PRNS.add(" '' ",k[1]);
   PRNS.add(" '' ",k[2]);
   PRNS.add("form(s[2],,2)",k[3],,1)
?};
~~}
{COMMENT}   strony transakcji                                        {COMMENT-}
{ __STRTAB:='ZD_NAG'; __STRODB:=''; __STRLIN:=''; __STRDAT:=ZD_NAG.DATA;~~}
{SUBSTITUTE: 'stronyf'}
{ VAR_DEL.delete('__STRTAB','__STRODB','__STRLIN','__STRDAT');~~}
{COMMENT}   forma platnosci                                          {COMMENT-}
{IF: ZD_NAG.KH().PLATNOSC<>null | ZD_NAG.PL<>null}
   {LINE}
   {
   "PeKa - MOD NUCO - usuniecnie terminu platnosci dla zamowien kontraktowych 9999";
   fp_tr:=exec('tr','tlumaczenia','1000121');
   fp_war:=' '+{? ZD_NAG.PL=null() || ZD_NAG.KH().PLATNOSC().TR || ZD_NAG.PL().TR ?};
   tp_tr:={? ZD_NAG.TZ<>date(0,0,0) & ZD_NAG.TZ<date(9999,1,1) || exec('tr','tlumaczenia','1000124') || '' ?};
   tp_war:={? ZD_NAG.TZ<>date(0,0,0) & ZD_NAG.TZ<date(9999,1,1) || ' '+form(ZD_NAG.TZ) || '' ?};
   wp_tr:=wp_war:=wp_wal:='';
   odstep:=charleft()-(+fp_tr)-(+fp_war)-(+tp_tr)-(+tp_war)-(+wp_tr)-(+wp_war)-(+wp_wal);
   odstep:={? odstep>0 || ' '*odstep || ' ' ?};
   ~~}
   {<{1}
      }{FONT: exec('font','param_wydr','fp_tr')}{fp_tr
      }{FONT: exec('font','param_wydr','fp_war')}{fp_war
      }{FONT: exec('font','param_wydr','fp_ods')}{odstep
      }{FONT: exec('font','param_wydr','tp_tr')}{tp_tr
      }{FONT: exec('font','param_wydr','tp_war')}{tp_war
      }{FONT: exec('font','param_wydr','wp_tr')}{wp_tr
      }{FONT: exec('font','param_wydr','wp_war')}{wp_war
      }{FONT: exec('font','param_wydr','wp_wal')}{wp_wal}
{FI}
{COMMENT}   miejsce dostawy                                          {COMMENT-}
{FONT: exec('font','param_wydr','strony_po')}{SPACE: exec('space','param_wydr')}
{IF: ZD_NAG.ZAM_DST<>''}
   {LINE}
   {<{lmt+1}exec('tr','tlumaczenia','6000109')+' '+ZD_NAG.ZAM_DST}
{FI}
{IF: ZD_NAG.KH_MSC<>null}
   {LINE}
   {<{lmt+1}exec('msc_dost','kontrahent','ZD_NAG')}
{FI}
{COMMENT}   planowana data realizacji                                {COMMENT-}
{IF: PARAM_W.DTPREAL='T' & ZD_NAG.DTPREAL<>date(0,0,0)}
   {LINE}
   {<{lmt+1}
      }{FONT: exec('font','param_wydr','tr_tr')}{exec('tr','tlumaczenia','6000110')
      }{FONT: exec('font','param_wydr','tr_war')}{' '}{$ZD_NAG.DTPREAL}
{FI}
{COMMENT}   warunki dostawy                               {COMMENT-}
{IF: PARAM_W.ZDSWD='T' & ZD_NAG.ZDSWD<>null() & ZD_NAG.ZDSWD().OPIS<>''}
   {LINE}
   {<{lmt+1}
      }{FONT: exec('font','param_wydr','tr_tr')}{exec('tr','tlumaczenia','6000112')
      }{FONT: exec('font','param_wydr','tr_war')}{' '}{$ZD_NAG.ZDSWD().OPIS}
{FI}
{IF: ZD_NAG.UWAGI<>''}
   {<{lmt+1}
      }{FONT: exec('font','param_wydr','tr_tr')}{exec('tr','tlumaczenia','6000111')+' '+ZD_NAG.UWAGI}
{FI}
{LINE}
{COMMENT} Dane dodatkowe wynikajace z informacji dodatkowych zawartych do zamowienia {COMMENT-}
{
   'pobieram dane'; exec('pobgdnag','fakso','D',ZD_NAG.ref);
   VAR_DEL.delete('oo','OPIK')
;~~}
{FOR: S_GD}
{PREFIX: 'G'}
{DO}
   {FIRST}
      {LINE}
   {FIRST-}
   {SUBSTITUTE: 'inf_dod'}
{OD}
{  prn1:='PRN'; ~~}
{FONT: exec('font','param_wydr','tabhead_poz')}
{SUBSTITUTE: 'TABHEAD'}{ vp:=1; ~~}
{COMMENT}   HEADER                                                   {COMMENT-}
{HEADER}
   {IF: ~ns}
   {SUBSTITUTE: 'HEADNUCO'}
   {IF: zakoncz}
      {FONT: exec('font','param_wydr','tabhead_poz')}{SPACE: exec('space','param_wydr')}
      {SUBSTITUTE: 'TABHEAD'}
   {FI}
   {FI}
{HEADER-}
{COMMENT}   FOOTER                                                   {COMMENT-}
{IF: _a:=exec('get_par', '#parametr', 34); _a='Z' | _a='A'}
   {FOOTER}
   {SUBSTITUTE: 'FOOT_LIC'}
   {~~}
   {~~}
   {~~}
   {FOOTER-}
{ELSE}
   {FOOTER}{FOOTER-}
{FI}
{COMMENT}   pozycje wydruku                                          {COMMENT-}
{FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
{  rsep:=PAR_WYDR.RSEP; w[1]:=w[2]:=w[3]:=w[4]:=w[5]:=w[6]:=0;w[7]:='';s[1]:=s[2]:=s[3]:=s[4]:=0; ~~}
{COMMENT} PeKa - MOD NUCO - kolejnosc sortowania wg indeksu {COMMENT-}
{FOR:'ZD_POZ'}{INDEX: sortuj}{PREFIX: ZD_NAG.ref}
{DO}
   {
      rsep:=PAR_WYDR.RSEP;
      w[1]+=1;ok:=w[1];

      w[3]:='';
      {? PARAM_W.INDEKS='T' || w[3] += ZD_POZ.M().KTM+' ' ?};
      {? PARAM_W.JEZYK<>null
      || _tlumacz:=exec('trans_m','tlumaczenia',ZD_POZ.M,PARAM_W.JEZYK)
      || _tlumacz:=''
      ?};
      {? PARAM_W.NAZWA='T'  || w[3] += {? w[3]<>'' || ' - ' || '' ?}+ZD_POZ.M().N+{? +_tlumacz || ' / '+_tlumacz || '' ?} ?};
      {? PARAM_W.UWAGI='T'  & ZD_POZ.UWAGI<>'' || w[3] += {? w[3]<>'' || ' - ' || '' ?}+ZD_POZ.UWAGI ?};
      {? PARAM_W.KODOBCY='T' & ZD_POZ.M<>null  & ZD_NAG.KH<>null
      || _kod_obcy:=exec('kod_obcy','kody_kresk',ZD_POZ.M,ZD_NAG.KH);
         {? _kod_obcy<>'' || w[3] += {? w[3]<>''||' - ' || '' ?}+_kod_obcy ?}
      ?};
      {? PARAM_W.DK_C='T' & ZD_POZ.DK_C<>null
      || _dk_c:=form(exec('sym_dk_c','mat_atr',ZD_POZ.DK_C));
         {? _dk_c<>''
         || w[3]+={? w[3]<>''||' - ' || '' ?}+_dk_c
         ?}
      ?};

      s[1]+=w[4]:=ZD_POZ.IL;
      w[5]:={? walh=1 || ZD_POZ.CENA || ZD_POZ.CWAL ?};
      w[7]:=ZD_POZ.JM().KOD;
      s[2]+=w[6]:={? walh=1 || ZD_POZ.WAR || ZD_POZ.WARW ?};
   ~~}
   {
      _f:=prn1+'.ini_line()'; _v:=($(_f))();
      _f:=prn1+'.length()'; il_lin:=($(_f))() + 2;
   ~~}
   {IF: lineleft <= il_lin}
      {SUBSTITUTE: 'LINIAF'}{PAGE}
   {FI}
   {SUBSTITUTE: 'LINIA0'}
{COMMENT}   informacje dodatkowe dla pozycji dokumentu               {COMMENT-}
   {FOR: FAKSO}{INDEX: 'ZD_POZ'}{PREFIX: ZD_POZ.ref}
   {DO}
      { {! _i..7 |! w[_i]:='' !};
        {? FAKSO.O<>'' || w[3]:={? FAKSO.PRN='T' || FAKSO.O |? FAKSO.PRN='A' || FAKSO.T+' '+FAKSO.O || '' ?} ?};
        rsep:=0; ~~}
      {SUBSTITUTE: 'LINIA0'}
      {  w[1]:=ok; ~~}
   {OD}
{OD}
{COMMENT}   podsumowanie                                             {COMMENT-}
{  rsep:=1; ~~}
{IF: __PARAM_W.ILOSC='N'}
   {IF: lineleft<3}
      {SUBSTITUTE: 'LINIAF'}
      {PAGE}
   {FI}
   {SUBSTITUTE: 'LINIA02'}
   {  prn1:='PRNS'; ~~}
{FI}
{SUBSTITUTE: 'LINIAF'}
{ zakoncz:=0; ~~}
{LINE: 1}
{COMMENT} PeKa - MOD NUCO - drukowanie informacji dodatkowych {COMMENT-}
{IF: __PARAM_W.INFDOD='T'}
{COMMENT}   informacje dodatkowe dla naglowka dokumentu              {COMMENT-}
   {FONT: exec('font','param_wydr','head')}{SPACE: exec('space','param_wydr')}
   {  rsep:=PAR_WYDR.RSEP; ~~}
   {FOR: S_GD}
   {PREFIX: 'D'}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {SUBSTITUTE: 'inf_dod'}
   {OD}
{FI}
{LINE: 1}
{IF: __PARAM_W.DODUWAGI='T'}
   {IF: PAGELANG=0}
   {FONT: exec('font','param_wydr','head')}{SPACE: exec('space','param_wydr')}
   {Text:='Zasady realizacji dostaw do NUCO:'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
   {<{lmt+1}(charleft())*'─'}
   { Text:='1. Prosimy o informację zwrotną o przyjęciu zamówienia do realizacji oraz o potwierdzenie daty dostawy/gotowości do odbioru w możliwie najkrótszym terminie.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='2. Potwierdzony termin dostawy/gotowości do odbioru powinien być przestrzegany, prosimy o informowanie NUCO z wyprzedzeniem o każdej jego zmianie.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='3. Prosimy o umieszczanie numeru KTM, nazwy towaru oraz numeru zamówienia na każdym opakowaniu zbiorczym dla dostawy.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='4. Prosimy o umieszczanie numeru KTM, nazwy towaru oraz numeru zamówienia na wszystkich dokumentach dołączanych do dostawy.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='5. Nadwyżki w dostawach nie będą akceptowane. Prosimy o dostarczanie dokładnych ilości z zamówienia.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='6. Ewentualne nadwyżki będą zwracane na koszt dostawcy.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {LINE}
   {FONT: exec('font','param_wydr','head')}{SPACE: exec('space','param_wydr')}
   {<{lmt+1} 'Prosimy o przestrzeganie powyższych zasad.'}
   {FI}
   {IF: PAGELANG=1}
   {FONT: exec('font','param_wydr','head')}{SPACE: exec('space','param_wydr')}
   {Text:='Conditions for deliveries to NUCO:'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
   {<{lmt+1}(charleft())*'─'}
   {Text:='1. Every single order have to be confirmed in shortest possible time (Delivery must be confirmed on a concrete day).'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='2. Confirmed delivery date should be respected.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='3. In case of any delays or faster delivery, We have to be informed in advance.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {FONT: exec('font','param_wydr','head')}{SPACE: exec('space','param_wydr')}
   {Text:='4. Please send an invoice by email or fax in the same time it is issue.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
   {Text:='5. Please put Our KTM number (first 12 numbers at positions in order), name of product and order number from Our order on every single box in delivery.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='6. KTM number has to be on documents with delivery.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='7. Surplus supplies will not be accepted. Please deliver the exact quantity from Our order.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {Text:='8. Any surplus quantity will be send back on supplier cost.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {LINE}
   {FONT: exec('font','param_wydr','head')}{SPACE: exec('space','param_wydr')}
   {Text:='Please respect Our procedures.'; Line:=0; ~~}
   {SUBSTITUTE: 'Text'}
   {FI}
   {CENTER}
{FI}
{COMMENT}   podpisy                                                  {COMMENT-}
{FONT: exec('font','param_wydr','podpisy')}{SPACE: exec('space','param_wydr')}
{LINE: 1}
{IF: ZD_NAG.US<>null}
   {
   VAR_DEL.delete('PRN');
   prn1:='PRN';
   PRN:=obj_new(@.CLASS.PRINT,2); PRN.n_frame();
   PRN.add("",charleft-50-3,'');
   PRN.add("",50,ZD_NAG.US().DANE);
   _f:=prn1+'.ini_head()'; ($(_f))();
   _f:=prn1+'.h_next()'; ($(_f))()
   ;~~}
   {REP: _f:=prn1+'.h_fmline(lmt)'; ($(_f))()}
{FI}
{
_szer:=20;
PRN.HEAD[1]:='';
PRN.HEAD[2]:=30*'─';
_f:=prn1+'.ini_head()'; ($(_f))();
_f:=prn1+'.h_next()'; ($(_f))()
;~~}
{REP: _f:=prn1+'.h_fmline(lmt)'; ($(_f))()}
{
_szer:=20;
PRN.HEAD[1]:='';
PRN.HEAD[2]:=exec('tr','tlumaczenia','6000108');
_f:=prn1+'.ini_head()'; ($(_f))();
_f:=prn1+'.h_next()'; ($(_f))()
;~~}
{REP: _f:=prn1+'.h_fmline(lmt)'; ($(_f))()}