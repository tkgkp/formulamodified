{TITLE:J. Skr¢cone zestawienia zam¢wie§ dostaw}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','v'),,,,,'Q','C',,,,,,1,
   PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1}
{BEGIN:
  WYDRUKIL.win_edit('ZKL_005');
  VAR_DEL.delete('cWhere1', 'cWhere', 'PRN', 'ZAMSQL', 'ZAMNDX' );
  cWhere1 := cWhere := '';
  VAR_DEL.delete('color','prn1','prn2', 'lm', 'll' , 'vp', 'lmt', 'rsep', 'prn1');
  color:=prn1:=prn2:='';
  lm:=ll:=vp:=lmt:=rsep:=0;
  PRN := obj_new(@.CLASS.PRINT, 20);
  prn1 := 'PRN';
  PRN.s_frame();
  PAR_WYDR.TITLE := 'SKR£CONE ZESTAWIENIE ZAM£WIE• DOSTAW'
}
{END:
  VAR_DEL.delete('cWhere1', 'cWhere', 'PRN', 'ZAMSQL', 'ZAMNDX' );
  VAR_DEL.delete('color','prn1','prn2', 'lm', 'll' , 'vp', 'lmt', 'rsep', 'prn1')
}
{EXIT: ~WYDRUKIL.edit("{? WYDRUKIL.DO_DATY>=WYDRUKIL.OD_DATY || '' || FUN.info('Bíëdny zakres dat.');'DO_DATY' ?}")}
{ {? 0 & ZAMOW.TYP <> null()
  || cWhere1 += ' and ZD_NAG.T=\'' + $ZAMOW.TYP + '\''
  ?};
  {? WYDRUKIL.KH_OD <> null()
  || cWhere1 += ' and ZD_NAG.KH=\'' + $WYDRUKIL.KH_OD + '\''
  ?};
  {? 0 & ZAMOW.OPER <> null()
  || cWhere1 += ' and ZD_NAG.US=\'' + $ZAMOW.OPER + '\''
  ?};
  {? 0 & ZAMOW.WAL <> null()
  || cWhere1 += ' and ZD_NAG.WAL=\'' + $ZAMOW.WAL + '\''
  ?};
  {? WYDRUKIL.STANZAM = 'REA'
  || cWhere1 += ' and ZD_NAG.STAN=\'N\''
  |? WYDRUKIL.STANZAM = 'A'
  || cWhere1 += ' and ZD_NAG.STAN=\'A\''
  |? WYDRUKIL.STANZAM = 'REA-ZRE'
  || cWhere1 += ' and ZD_NAG.STAN=\'C\''
  |? WYDRUKIL.STANZAM = 'ZAM'
  || cWhere1 += ' and ZD_NAG.STAN=\'M\''
  |? WYDRUKIL.STANZAM = 'ZRE'
  || cWhere1 += ' and ZD_NAG.STAN=\'Z\''
  ?};
  {? WYDRUKIL.RADIOB_1 = 1
  || cWhere1 += 'and ZD_NAG.REFERENCE like \'zdnagw__%\''
  |? WYDRUKIL.RADIOB_1 = 2
  || cWhere1 += 'and ZD_NAG.REFERENCE like \'zdnagw%\' and ZD_NAG.REFERENCE not like \'zdnagw__%\' '
  ?};
  {? WYDRUKIL.OD_DATY <> date( 0, 0, 0) & WYDRUKIL.DO_DATY <> date( 0, 0, 0)
  ||
     cWhere1 += 'and ZD_NAG.DATA between to_date(\'' + $WYDRUKIL.OD_DATY + '\') and to_date(\'' + $WYDRUKIL.DO_DATY + '\') '
  ?};
  cWhere := {? cWhere1 <> '' || ' where ' + (4- cWhere1) || '' ?};
  ZAMSQL := sql('select distinct
       TYPYZAM.T as ZAM,
       ZD_NAG.NR,
       ZD_NAG.SYM,
       ZD_NAG.ZAM_DST,
       ZD_NAG.DATA,
       KH.KOD KH,
       MG.SYM as MAG,
       case when ZD_NAG.US is not null then USERS.KOD else space(10) end as \"USER\",
       SLOWAL.KOD as KWAL,
       ZD_NAG.STAN,
       sum(ZD_POZ.WAR) as WAR
from @ZD_POZ
join @ZD_NAG using(ZD_POZ.ZD_NAG,ZD_NAG.REFERENCE)
join TYPYZAM using(ZD_NAG.T, TYPYZAM.REFERENCE)
join KH  using(ZD_NAG.KH,KH.REFERENCE)
join MG using(ZD_NAG.MG,MG.REFERENCE)
left join USERS using(ZD_NAG.US,USERS.REFERENCE)
join SLO as SLOWAL using(ZD_NAG.WAL,SLOWAL.REFERENCE)
:_a
group by TYPYZAM.T, ZD_NAG.NR, ZD_NAG.SYM, ZD_NAG.ZAM_DST, ZD_NAG.DATA, KH.KOD, MG.SYM,
         case when ZD_NAG.US is not null then USERS.KOD else space(10) end, SLOWAL.KOD, ZD_NAG.STAN
order by ZAM, NR', cWhere);
  ZAMNDX := ZAMSQL.index('?');
  PRN.add("ZAMSQL.ZAM", 10,'Rodzaj zam¢wienia');
  PRN.add("ZAMSQL.NR", 5, 'Numer zam.');
  PRN.add("ZAMSQL.SYM", 20, 'Symbol zam¢wienia');
  PRN.add("ZAMSQL.ZAM_DST", 20, 'Symbol dostawcy');
  PRN.add("form(ZAMSQL.DATA)", 12, 'Data wystawienia');
  PRN.add("ZAMSQL.KH", 10, 'Kod kontrah.');
  PRN.add("ZAMSQL.MAG", 10, 'Magazyn');
  PRN.add("ZAMSQL.USER", 10, 'Ußytkownik');
  PRN.add("ZAMSQL.KWAL", 10, 'Waluta');
  PRN.add("ZAMSQL.STAN", 4, 'Stan');
  PRN.add("form(ZAMSQL.WAR,15,2,' ,')", 15, 'Wartoûç',1)
;~~}
{INCLUDE: wsp_pw.rpi}
{vp := 1; rsep:=PAR_WYDR.RSEP; lmt:=int((charleft()-PRN.width())/2);~~}
{HEADER}
{SUBSTITUTE: 'HEAD'}
{LINE}
{FONT: 'T8G'}{SPACE: 'C'}
{LINE}
{FONT: 'T8GB'}{SPACE: 'C'}
{SUBSTITUTE: 'TABHEAD'}{FONT: 'T8G'}{vp:=1;~~}
{HEADER-}
{FOOTER: 0}
{SUBSTITUTE: 'LINIAF'}
{LINE}
{FOOTER-}
{FOR: ZAMSQL}
{INDEX: ZAMNDX}
{DO}
{SUBSTITUTE: 'LINIA0'}
{OD}