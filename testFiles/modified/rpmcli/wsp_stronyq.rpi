:!UTF-8
{MACRO: 'qstronyf'}
{COMMENT}   ustalenie maksymalnych szerokosci strony dla fontow      {COMMENT-}
{
exec('czytaj','#stalesys',__STRDAT,XINFO,INFO); KSTE.get;
strony:="
   VAR_DEL.delete('zero_na','szer','print5','na');
   VAR_DEL.delete('op_1','op_2','op_3','op_4');
   VAR_DEL.delete('oddzial','qrcodelf')
   ";
strony()
;~~}
{FONT: 'T8G'}{max_T8G:=charleft;~~}
{FONT: 'TQ'}  {max_TQ:=charleft-6;~~}
{FONT: 'T10B'}{max_T10B:=charleft;~~}
{
zero_na:="{! _i:=1..obj_len(na)|! na[_i]:='' !}";
szer:=obj_new(4);
na:=obj_new(15);
op_1:=op_2:=op_3:=op_4:='';

print5:="
   prn1:='PRN5';
   op_1:=op_2:=op_3:=op_4:='';
   {? _=2 || _c:=_a; _d:=_b ?};
   VAR_DEL.delete('PRN5');
   PRN5:=obj_new(@.CLASS.PRINT,4);
   PRN5.n_frame();
   PRN5.add($('form(op_1,)'),_a,'',1);
   PRN5.add($('form(op_2,)'),_b,'');
   PRN5.add($('form(op_3,)'),_c,'',1);
   PRN5.add($('form(op_4,)'),_d,'')
";

exec('print5_set1','faktury_wydruk');
~~}
{COMMENT}   SPRZEDAWCA                                               {COMMENT-}
{
vp:=0;
lmt:=0;
zero_na();
KSTE.index('KST'); KSTE.prefix();
{? KSTE.first() & +KSTE.NAZ || oddzial:=1 || oddzial:=0 ?};
{? oddzial
|| na[1]:=KSTE.NAZ;
   na[2]:=exec('kpocz','faktury_wydruk',KSTE.KOD_P,KSTE.POCZ,KSTE.MIA);
   na[3]:=KSTE.UL+' '+KSTE.NR_D+{? +KSTE.NR_L || '/'+KSTE.NR_L || '' ?};
   na[4]:={? +KSTE.TEL || exec('tr','tlumaczenia','1000106')+' '+KSTE.TEL || '' ?}
|| na[1]:=XINFO.NAZ;
   na[2]:=exec('kpocz','faktury_wydruk',XINFO.KOD_P,XINFO.POCZ,XINFO.MIA);
   na[3]:=XINFO.UL+' '+XINFO.NR_D+{? +XINFO.NR_L || '/'+XINFO.NR_L || '' ?};
   na[4]:={? +XINFO.TEL || exec('tr','tlumaczenia','1000106')+' '+XINFO.TEL || '' ?}
?};
{? __STRTAB='ND'
||
   {? ND.TYP().P='N' | ND.TYP().DN='K'
   ||
      exec('print5_set1','faktury_wydruk'); op_1:=exec('tr','tlumaczenia','1000107')
   ||
      exec('print5_set1','faktury_wydruk'); op_1:=exec('tr','tlumaczenia','1000120')
   ?}
||
   exec('print5_set1','faktury_wydruk');
   op_1:=
      {? __STRTAB='ZD_NAG'
      || 'Zamawiający:'
      |? __STRTAB='OPAK_N'
      || {? OPAK_N.PLUS='T'
         || 'Przyjmujący:'
         || 'Wydający:'
         ?}
      || {? __STRTAB='FAKS' & FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
         || exec('tr','tlumaczenia','1000107')
         || exec('tr','tlumaczenia','1000120')
         ?}
      ?}
?}
;~~}
{FONT: 'T10B'}{SPACE: 'C'}
{SUBSTITUTE: 'LINIA0'}
{ exec('print5_set2','faktury_wydruk');~~}
{FONT: 'T10B'}
{SUBSTITUTE: 'LINIA0'}
{FONT: 'T10'}
{IF: +na[2]}
   {op_1:=''; op_2:=na[2]; op_3:=''; op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: +na[3]}
   {op_1:=''; op_2:=na[3]; op_3:=''; op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: +na[4]}
   {op_1:=''; op_2:=na[4]; op_3:=''; op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{
op_1:='';
op_2:=
   {? __STRTAB='FAKS' & {? exec('get','#params',100221,2)='T' || FAKS.T().UE='T' || FAKS.NIP_UE<>'' ?}
      | __STRTAB='ND' & {? exec('get','#params',100221,2)='T' || ND.TYP().UE='T' || ND.NIP_UE<>'' ?}
      | __STRTAB='ZK_N' & {? exec('get','#params',100221,2)='T' || 0 || ZK_N.NIP_UE<>'' ?}
   || NIPY.index('SNIP_F');NIPY.prefix(REF.S_FIRMA);
      exec('tr','tlumaczenia','1000113')+' '+
         {? NIPY.find_key('PL')|| form(NIPY.KRAJ().KOD+' '+NIPY.NIP) || form(XINFO.NIP) ?}
   || exec('tr','tlumaczenia','1000108')+' '+form(XINFO.NIP)
   ?};
op_3:=''; op_4:=''
;~~}
{SUBSTITUTE: 'LINIA0'}
{IF: __STRTAB='FAKS' & FAKS.SZ='S'}
   {FONT: 'T10'}{SPACE: 'C'}
   {
   exec('print5_set3','faktury_wydruk');
   op_1:=op_2:=op_3:='';
   op_4:=exec('tr','tlumaczenia','1000110')+' '+form(FAKS.DW)
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {IF: FAKS.WHERE<>'K'}
      {
         _txt_ds:=
            {? PAR_SKID.get(308)='T' & FAKS.DW>=date(2014,1,1)
            || {? FAKS.DO_NA_DR<>date(0,0,0)
               || exec('kod_aktualny','tlumaczenia','1000112')
               |? FAKS.T().KOR='T' & exec('FindAndGet','#table',FAKS,FAKS.FKSQL,"D")<date(2014,1,1)
               || '1000112'
               || ''
               ?}
            || exec('kod_aktualny','tlumaczenia','1000112')
            ?};
      op_1:='';
      op_2:={? +FAKS.NB || exec('tr','tlumaczenia','1000109') || '' ?};
      op_3:='';
      op_4:={? FAKS.WHERE='L'
            || exec('tr','tlumaczenia','1000111')+' '
            |? FAKS.T().HIS='T'
            || exec('tr','tlumaczenia','1000112')+' '
            || exec('tr','tlumaczenia',_txt_ds)+' ' ?}+
         {? FAKS.WHERE<>'L' & FAKS.T().HIS<>'T' & PAR_SKID.get(308)='T' & FAKS.DW>=date(2014,1,1)
         || {? FAKS.DO_NA_DR<>date(0,0,0)
            || {? PARAM_W.MC='T'
               || {?  PARAM_W.JEZYK=null || form(FAKS.DO_NA_DR,,8) || 7+form(FAKS.DO_NA_DR,,1) ?}
               || form(FAKS.DO_NA_DR,,1)
               ?}
            |? FAKS.T().KOR='T' & exec('FindAndGet','#table',FAKS,FAKS.FKSQL,"D")<date(2014,1,1)
            || {? PARAM_W.MC='T'
               || {?  PARAM_W.JEZYK=null || form(FAKS.D,,8) || 7+form(FAKS.D,,1) ?}
               || form(FAKS.D,,1)
               ?}
            || ''
            ?}
         || {? PARAM_W.MC='T'
            || {?  PARAM_W.JEZYK=null || form(FAKS.D,,8) || 7+form(FAKS.D,,1) ?}
            || form(FAKS.D,,1)
            ?}
         ?}
      ;~~}
      {SUBSTITUTE: 'LINIA0'}
      {
      op_1:='';
      op_2:=FAKS.NB;
      op_3:='';
      op_4:=
         {? FAKS.T().KOR='N' | FAKS.WHERE='L'
            | FAKS.T().KOR='T' & FAKS.DZ=date(0,0,0) & exec('czy_zwrot','faktury_nag',FAKS.ref())='N'
         || ''
         || exec('tr','tlumaczenia','1000153')+' '+form(FAKS.DZ)
         ?}
      ;~~}
      {SUBSTITUTE: 'LINIA0'}
      {
      exec('print5_set2','faktury_wydruk');
      op_1:='';
      op_2:=
         {? {? exec('get','#params',100221,2)='T' || FAKS.T().UE='T' || FAKS.NIP_UE<>'' ?}
            | 1+(-exec('iban','zamsiw_wydruk','FAKS',FAKS.ref()))='t'
         || FAKS.SKID_RBK().BANK().KODISO().KODISO+' '
         || ''
         ?}+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO);
      op_3:=op4:=''
      ;~~}
      {SUBSTITUTE: 'LINIA0'}
      {
      op_1:='';
      op_2:=FAKS.SKID_RBK().BANK().SWIFT;
      op_2:={? (FAKS.T().EXPORT='T' | FAKS.T().UE='T') & +op_2 || exec('tr','tlumaczenia','1000114')+' '+op_2 || '' ?};
      op_3:=op4:=''
      ;~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{FI}
{IF: __STRTAB='ZK_N' & proforma=1}
   {FONT: 'T10'}{SPACE: 'C'}
   {
   exec('print5_set1','faktury_wydruk');
   op_1:='';
   op_2:={? +bank1 || exec('tr','tlumaczenia','1000109') || '' ?};
   op_3:='';
   op_4:=exec('tr','tlumaczenia','1000110')+' '+form(ZK_N.DP)
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   exec('print5_set2','faktury_wydruk');
   op_1:='';
   op_2:=bank1;
   op_3:='';
   op_4:=''
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   { op_1:=''; op_2:=bank2; op_3:=op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {IF: +bank3}
      { op_1:=''; op_2:=bank3; op_3:=op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{FI}
{<{lmt}(charleft-lmt)*{? __STRTAB='FAKS' | __STRTAB='FAKS' & proforma=1 || {? graf || '─' || '-' ?} || '─' ?}}
{COMMENT}   NABYWCA, PLATNIK                                         {COMMENT-}
{
zero_na();
{? __STRODB<>'' & ($__STRODB)()<>null
||
   ($(__STRODB+'()'))();
   na[6]:=KH_ODB.KOD;
   na[7]:=KH_ODB.NAZ;
   na[8]:=exec('kpocz','faktury_wydruk',KH_ODB.KPOCZ,KH_ODB.POCZ,KH_ODB.MIASTO);
   na[9]:=KH_ODB.UL;
   na[10]:={? +KH_ODB.NIP || exec('tr','tlumaczenia','1000108')+' '+KH_ODB.NIP || '' ?}
?};
{? __STRTAB='FAKS' & +FAKS.NAZ
||
   na[1]:=FAKS.KH().KOD;
   na[2]:=FAKS.NAZ;
   na[3]:=FAKS.POCZ+{? ~((-FAKS.POCZ)*(-FAKS.MIASTO)) || {? +FAKS.POCZ>6 || ', ' || ' ' ?}+FAKS.MIASTO || '' ?};
   na[4]:=FAKS.UL
||
   ($(__STRTAB+'.KH()'))();
   na[1]:=KH.KOD;
   na[2]:=KH.NAZ_P;
   na[3]:=exec('kpocz','faktury_wydruk',KH.KPOCZ,KH.POCZ,KH.MIASTO);
   na[4]:=KH.UL
?};
{? __STRTAB='FAKS' & (WYDRUKIL.WYDRUK='zak_rr' | WYDRUKIL.WYDRUK='kor_rr')
||
   na[11]:='PESEL: '+KH.PESEL;
   na[12]:=exec('tr','tlumaczenia','1000154')+' '+KH.NDT().TR; "--Nazwa dowodu tożsamości:--";
   na[13]:=exec('tr','tlumaczenia','1000155')+' '+KH.SN_DT;    "--Seria i numer DT:--";
   na[14]:=exec('tr','tlumaczenia','1000156')+' '+KH.WP().TR;  "--Wydany przez:--";
   na[15]:=exec('tr','tlumaczenia','1000157')+' '+$KH.DATA_WDT;"--Data wydania:--"
?};
FAKS.cntx_psh();
{? __STRTAB='ND' & ND.FAKS || FAKS.use(ref_name(ND.FAKS)) ?};
{? (KH.TYP='I' | KH.TYP='R') & KH.PESEL<>'' & WYDRUKIL.WYDRUK<>'zak_rr' & WYDRUKIL.WYDRUK<>'kor_rr'
|| na[5]:='PESEL: '+KH.PESEL
|? __STRTAB='FAKS'
 & {? exec('get','#params',100221,2)='T'
   || FAKS.T().UE='T' | FAKS.NDVAT='O' & FAKS.NIP_UE<>''
   || FAKS.NIP_UE<>''
   ?}
|| na[5]:=exec('tr','tlumaczenia','1000113')+' '+FAKS.NIP_UE
|? __STRTAB='ND'
 & {? exec('get','#params',100221,2)='T'
   || ND.TYP().UE ='T' | ND.FAKS_REF<>'' & ND.FAKS().NDVAT='O' & ND.NIP_UE<>''
   || ND.NIP_UE<>''
   ?}
|| na[5]:=exec('tr','tlumaczenia','1000113')+' '+ND.NIP_UE
|? __STRTAB='ZK_N' & ZK_N.NIP_UE<>''
|| na[5]:=exec('tr','tlumaczenia','1000113')+' '+ZK_N.NIP_UE; "--NIP UE--"
|| _nipfld:={? __STRTAB='FAKS' || '.NIP' || '.KH().NIP' ?};
   na[5]:={? +($(__STRTAB+_nipfld))() || exec('tr','tlumaczenia','1000108')+' '+($(__STRTAB+_nipfld))() || '' ?}
?};
FAKS.cntx_pop();
qrcodelf:=0;
{? exec('get','#params',100222,2)='T' & (__STRODB='' | ($__STRODB)()=null)
||
   ($(__STRTAB+'.KH()'))();
   OS_ADRES.cntx_psh();
   OS_ADRES.index('RODZAJ1'); OS_ADRES.prefix(KH.ref(),'H');
   SKID.AD_KOR:={? OS_ADRES.find_le(date()) & (OS_ADRES.DO=date(0,0,0) | OS_ADRES.DO>=date()) || OS_ADRES.ref() || null() ?};
   OS_ADRES.cntx_pop();
   {? SKID.AD_KOR().KOD<>'' & SKID.AD_KOR().MIASTO<>'' & SKID.AD_KOR().ULICA<>''
   ||
      na[6]:=exec('tr','tlumaczenia','1000159'); "--Adres korespondencyjny--";
      na[7]:=na[2];
      na[8]:=exec('kpocz','faktury_wydruk',SKID.AD_KOR().KOD,SKID.AD_KOR().POCZTA,SKID.AD_KOR().MIASTO);
      na[9]:=SKID.AD_KOR().ULICA+' '+SKID.AD_KOR().DOM+{? SKID.AD_KOR().LOKAL='' || '' || '/'+SKID.AD_KOR().LOKAL ?};
      na[10]:=''
   ?}
?};
{? __STRTAB='FAKS' & FAKS.SZ='S' & __wydrfa.uproszcz
||
   na[2]:=na[3]:=na[4]:=''
?};
~~}
{IF: +na[6]}
   {FONT: 'T10B'}
   {
   exec('print5_set1','faktury_wydruk');
   op_1:=
      {? __STRTAB='ND' & (ND.TYP().P='N' | ND.TYP().DN='K') | __STRTAB='ZK_N'  | __STRTAB='OFE'
         | __STRTAB='FAKS' & FAKS.SZ='S'
      || exec('tr','tlumaczenia','1000120')
      || exec('tr','tlumaczenia','1000107')
      ?};
   op_3:=
      {? na[6]=exec('tr','tlumaczenia','1000159')
      || na[6]:='';
         op_4:=exec('tr','tlumaczenia','1000159');
         ''
      || op_4:='';
         exec('tr','tlumaczenia','1000119')
      ?}
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {IF: exec('get','#params',300250,2)<>''
      & (__STRTAB='ND' & ND.TYP().Z='T' | __STRTAB='FAKS' | __STRTAB='ZK_N' | __STRTAB='OFE')}
      {
      qrcodlf:=lineleft;
      ~~}
      {<2}{IMAGE: barcode('QRCode',exec('get','#params',300250,2));;8}
   {FI}
   {FONT: 'T10'}
   { op_1:=''; op_2:=na[1]; op_3:=''; op_4:=na[6];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10B'}
   { op_1:=''; op_2:=na[2]; op_3:=''; op_4:=na[7]; ~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {IF: +na[3] | +na[8]}
      {op_1:='';op_2:=na[3];op_3:='';op_4:=na[8];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[4] | +na[9]}
      {op_1:='';op_2:=na[4];op_3:='';op_4:=na[9];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[5]}
      {op_1:='';op_2:=na[5];op_3:='';op_4:=na[10];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{ELSE}
   {FONT: 'T10B'}
   {
   {? __STRTAB='ND'
   ||
      {? ND.TYP().P='N' | ND.TYP().DN='K'
      || op_1:=exec('tr','tlumaczenia','1000120'); op_2:=''
      || op_1:=exec('tr','tlumaczenia','1000107'); op_2:=''
      ?}
   ||
      exec('print5_set1','faktury_wydruk');
      op_1:=
         {? __STRTAB='ZD_NAG'
         || 'Dostawca:'
         |? __STRTAB='OPAK_N'
         || 'Kontrahent:'
         || {? __STRTAB='FAKS' & FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
            || exec('tr','tlumaczenia','1000120')
            || exec('tr','tlumaczenia','1000107')
            ?}
         ?}
   ?}
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {IF: exec('get','#params',300250,2)<>''
      & (__STRTAB='ND' & ND.TYP().Z='T' | __STRTAB='FAKS' | __STRTAB='ZK_N' & __STRTAB='OFE')}
      {
      qrcodelf:=lineleft;
      ~~}
      {<2}{IMAGE: barcode('QRCode',exec('get','#params',300250,2));;8}
   {FI}
   { exec('print5_set2','faktury_wydruk'); op_1:=''; op_2:=na[1];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10B'}
   {op_2:=na[2];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {IF: +na[3]}
      {op_1:='';op_2:=na[3];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[4]}
      {op_1:='';op_2:=na[4];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[5]}
      {op_1:='';op_2:=na[5];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{FI}
{IF: +na[11]}
   {op_1:='';op_2:=na[11];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[12];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[13];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[14];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[15];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: __STRTAB='FAKS' & FAKS.SZ='Z'}
   {FONT: 'T10'}{SPACE: 'C'}
   {
   exec('print5_set1','faktury_wydruk');
   op_1:='';
   op_2:={? +FAKS.NB || exec('tr','tlumaczenia','1000109') || '' ?};
   op_3:='';
   op_4:=exec('tr','tlumaczenia','1000110')+' '+form(FAKS.DW)
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   _txt_ds:={? FAKS.WHERE='L' || '1000111' || exec('kod_aktualny','tlumaczenia','1000112') ?};
   op_1:='';
   op_2:=FAKS.NB;
   op_3:='';
   op_4:=exec('tr','tlumaczenia',_txt_ds)+' '+
      {? PARAM_W.MC='T'
      || {?  PARAM_W.JEZYK=null || form(FAKS.D,,8) || 7+form(FAKS.D,,1) ?}
      || form(FAKS.D,,1)
      ?}
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   op_1:='';
   op_2:=
      {? {? exec('get','#params',100221,2)='T' || FAKS.T().UE='T' || FAKS.NIP_UE<>'' ?}
         | 1+(-exec('iban','zamsiw_wydruk','FAKS',FAKS.ref()))='t'
      || FAKS.SKID_RBK().BANK().KODISO().KODISO+' '
      || ''
      ?}+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO); op_3:=op_4:='';
   ~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: qrcodelf & (qrcodelf-lineleft<8)}
   {LINE: 8-(qrcodelf-lineleft)}
{ELSE}
   {LINE: 2}
{FI}
{ exec('czytaj','#stalesys',,XINFO,INFO); KSTE.get; strony(); VAR_DEL.delete('strony');~~}
{MACRO-}
{MACRO: 'qstrony2'}
{COMMENT}   ustalenie maksymalnych szerokosci strony dla fontow      {COMMENT-}
{
strony:="
   VAR_DEL.delete('zero_na','szer','print5','na');
   VAR_DEL.delete('op_1','op_2','op_3','op_4');
   VAR_DEL.delete('oddzial')
   ";
strony()
;~~}
{FONT: 'T8G'}  {max_T8G:=charleft-6;~~}
{FONT: 'T10B'} {max_T10B:=charleft-13;~~}
{
zero_na:="{! _i:=1..obj_len(na)|! na[_i]:='' !}";
szer:=obj_new(2);
na:=obj_new(15);
op_1:=op_2:=op_3:=op_4:='';

print5:="
   prn1:='PRN5';
   op_1:=op_2:=op_3:=op_4:='';
   {? _=2 || _c:=_a; _d:=_b ?};
   VAR_DEL.delete('PRN5');
   PRN5:=obj_new(@.CLASS.PRINT,4);
   PRN5.n_frame();
   PRN5.add($('form(op_1,)'),_a,'',1);
   PRN5.add($('form(op_2,)'),_b,'');
   PRN5.add($('form(op_3,)'),_c,'',1);
   PRN5.add($('form(op_4,)'),_d,'')
";

szer[1]:={? __STRTAB='ZD_NAG' || 12 || 11 ?};   "--Sprzedawca,Nabywca,Platnik T8B'--";
szer[2]:=(max_T10B-(2*szer[1]))/2$0;            "--druga kolumna T8B pusta--"
;~~}
{COMMENT}   SPRZEDAWCA                                               {COMMENT-}
{
vp:=0;
lmt:=0;
zero_na();
KSTE.index('KST'); KSTE.prefix();
{? KSTE.first() & +KSTE.NAZ || oddzial:=1 || oddzial:=0 ?};
{? oddzial
|| na[1]:=KSTE.NAZ;
   na[2]:=KSTE.KOD_P+' '+KSTE.POCZ;
   na[3]:=KSTE.UL+' '+KSTE.NR_D+{? +KSTE.NR_L || '/'+KSTE.NR_L || '' ?};
   na[4]:={? +KSTE.TEL || exec('tr','tlumaczenia','1000106')+' '+KSTE.TEL || '' ?}
|| na[1]:=XINFO.NAZ;
   na[2]:=XINFO.KOD_P+' '+XINFO.POCZ;
   na[3]:=XINFO.UL+' '+XINFO.NR_D+{? +XINFO.NR_L || '/'+XINFO.NR_L || '' ?};
   na[4]:={? +XINFO.TEL || exec('tr','tlumaczenia','1000106')+' '+XINFO.TEL || '' ?}
?};
{? __STRTAB='ND'
||
   {? ND.TYP().P='N' | ND.TYP().DN='K'
   ||
      print5(szer[1],szer[2]); op_1:=exec('tr','tlumaczenia','1000107');op_1:=exec('tr','qlsp','1000107')
   ||
      print5(szer[1],szer[2]); op_1:=exec('tr','tlumaczenia','1000120');op_1:=exec('tr','qlsp','1000120')
   ?}
||
   print5(szer[1],szer[2]);
   op_1:=
      {? __STRTAB='ZD_NAG'
      || 'Buyer:'
      || {? FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
         || exec('tr','tlumaczenia','1000107');op_1:=exec('tr','qlsp','1000107')
         || exec('tr','tlumaczenia','1000120');op_1:=exec('tr','qlsp','1000120')
         ?}
      ?}
?}
;~~}
{FONT: 'T10B'}{SPACE: 'C'}
{SUBSTITUTE: 'LINIA0'}
{print5(szer[1],max_T10B-szer[1]-15,1,1); op_2:=na[1];~~}
{FONT: 'T10B'}
{SUBSTITUTE: 'LINIA0'}
{IF: +na[2]}
   {op_1:=''; op_2:=na[2]; op_3:=''; op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: +na[3]}
   {op_1:=''; op_2:=na[3]; op_3:=''; op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: +na[4]}
   {op_1:=''; op_2:=na[4]; op_3:=''; op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{
op_1:='';
op_2:=
   {? __STRTAB='FAKS' & FAKS.T().UE='T'
      | __STRTAB='ND' & ND.TYP().UE='T'
   || NIPY.index('SNIP');NIPY.prefix(null);
      exec('tr','tlumaczenia','1000113')+' '+
         {? NIPY.find_key('PL')|| form(NIPY.KRAJ().KOD+' '+NIPY.NIP) || form(XINFO.NIP) ?}
   || exec('tr','tlumaczenia','1000108')+' '+form(XINFO.NIP)
   ?};
op_3:=''; op_4:=''
;~~}
{SUBSTITUTE: 'LINIA0'}
{IF: __STRTAB='FAKS' & FAKS.SZ='S'}
   {FONT: 'T10'}{SPACE: 'C'}
   {
   print5(szer[1],szer[2]);
   op_1:='';
   op_2:={? +FAKS.NB || exec('tr','tlumaczenia','1000109') || '' ?};
   op_3:='';
   op_4:=exec('tr','tlumaczenia','1000110')+' '+form(FAKS.DW)
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   op_1:='';
   op_2:=FAKS.NB;
   op_3:='';
   op_4:={? FAKS.WHERE='L' || exec('tr','tlumaczenia','1000111')+' ' || {? FAKS.DW>=date(2013,1,1) || exec('tr','tlumaczenia','2013112') || exec('tr','tlumaczenia','1000112') ?}+' ' ?}+
      form(FAKS.D,,{? PARAM_W.MC='N' || 1 || 8 ?})
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   print5(szer[1],max_T10B-szer[1]-15,1,1);
   op_1:='';
   op_2:={? FAKS.T().UE='T' || FAKS.SKID_RBK().BANK().KODISO().KODISO || '' ?}+FAKS.RBK;
   op_3:=op_4:=''
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: __STRTAB='ZK_N' & proforma=1}
   {FONT: 'T10'}{SPACE: 'C'}
   {
   print5(szer[1],szer[2]);
   op_1:='';
   op_2:={? +bank1 || exec('tr','tlumaczenia','1000109') || '' ?};
   op_3:='';
   op_4:=exec('tr','tlumaczenia','1000110')+' '+form(ZK_N.DP)
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   print5(szer[1],max_T10B-szer[1]-15,1,1);
   op_1:='';
   op_2:=bank1;
   op_3:='';
   op_4:=''
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   { op_1:=''; op_2:=bank2; op_3:=op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{<{lmt+1}(charleft-2)*{? __STRTAB='FAKS' | __STRTAB='FAKS' & proforma=1 || {? graf || '─' || '-' ?} || '─' ?}}
{COMMENT}   NABYWCA, PLATNIK                                         {COMMENT-}
{
zero_na();
{? __STRTAB='FAKS' & FAKS.KH_ODB<>null & FAKS.KH = KSTE.KHD
||
   "--odbiorca jednorazowy--";
   na[1]:=FAKS.KH_ODB().KOD;
   na[2]:=FAKS.KH_ODB().NAZ;
   na[3]:=FAKS.KH_ODB().POCZ+' '+FAKS.KH_ODB().MIASTO;
   na[4]:=FAKS.KH_ODB().UL;
   {? FAKS.T().UE ='T' | FAKS.NDVAT='O' & FAKS.NIP_UE<>''
   || na[5]:=exec('tr','tlumaczenia','1000113')+' '+FAKS.NIP_UE
   || na[5]:=exec('tr','tlumaczenia','1000114')+' '+FAKS.KH_ODB().NIP
   ?}
||
   {? __STRODB<>'' & ($__STRODB)()<>null
   ||
     {? __STRTAB='FAKS' & FAKS.KH_ODB().REF_KH<>0
     ||
        KH.cntx_psh();
        KH.prefix();
        {? KH.seek(FAKS.KH_ODB().REF_KH, KH.name())
        ||
           na[6]:=KH.KOD;
           na[7]:=KH.NAZ_P;
           na[8]:=KH.POCZ+' '+{? ~((-KH.POCZ)*(-KH.MIASTO)) || KH.MIASTO || '' ?};
           na[9]:=KH.UL;
           na[10]:=exec('tr','tlumaczenia','1000108')+' '+KH.NIP
        ?};
        KH.cntx_pop()
     ||
        ($(__STRODB+'()'))();
        na[6]:=KH_ODB.KOD;
        na[7]:=KH_ODB.NAZ;
        na[8]:=KH_ODB.POCZ+' '+KH_ODB.MIASTO;
        na[9]:=KH_ODB.UL
     ?}
   ?};
   {? __STRTAB='FAKS' & +FAKS.NAZ & -PARAM_W.DR_DUPL='t'
   ||
      na[1]:=FAKS.KH().KOD;
      na[2]:=FAKS.NAZ;
      na[3]:=FAKS.POCZ+' '+{? ~((-FAKS.POCZ)*(-FAKS.MIASTO)) || FAKS.MIASTO || '' ?};
      na[4]:=FAKS.UL
   ||
      ($(__STRTAB+'.KH()'))();
      na[1]:=KH.KOD;
      na[2]:=KH.NAZ_P;
      na[3]:=KH.POCZ+' '+{? ~((-KH.POCZ)*(-KH.MIASTO)) || KH.MIASTO || '' ?};
      na[4]:=KH.UL
   ?};
   {? __STRTAB='FAKS' & WYDRUKIL.WYDRUK='zak_rr'
   ||
      na[11]:='PESEL: '+KH.PESEL;
      na[12]:='Nazwa dowodu tożsamości: '+KH.NDT().TR;
      na[13]:='Seria i numer DT: '+KH.SN_DT;
      na[14]:='Wydany przez: '+KH.WP().TR;
      na[15]:='Data wydania: '+$KH.DATA_WDT
   ?};
   {? __STRTAB='FAKS' & (FAKS.T().UE='T' | FAKS.NDVAT='O' & FAKS.NIP_UE<>'')
   || na[5]:=exec('tr','tlumaczenia','1000113')+' '+FAKS.NIP_UE
   |? __STRTAB='ND' & ND.TYP().UE ='T'
   || na[5]:=exec('tr','tlumaczenia','1000113')+' '+ND.NIP_UE
   || na[5]:=exec('tr','tlumaczenia','1000108')+' '+($(__STRTAB+'.KH().NIP'))()
   ?}
?}
;~~}
{IF: +na[6]}
   {FONT: 'T10B'}
   {
   print5(szer[1],szer[2]);
   op_1:=
      {? FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
      || exec('tr','tlumaczenia','1000120')
      || exec('tr','tlumaczenia','1000107')
      ?};
   op_3:=exec('tr','tlumaczenia','1000119')
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {print5(szer[1],szer[2]); op_2:=na[1]; op_4:=na[6];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10B'}
   {print5(szer[1],szer[2]); op_2:=na[2]; op_4:=na[7]; ~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {IF: +na[3] | +na[8]}
      {op_1:='';op_2:=na[3];op_3:='';op_4:=na[8];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[4] | +na[9]}
      {op_1:='';op_2:=na[4];op_3:='';op_4:=na[9];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[5]}
      {op_1:='';op_2:=na[5];op_3:='';op_4:=na[10];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{ELSE}
   {FONT: 'T10B'}
   {
   {? __STRTAB='ND'
   ||
      {? ND.TYP().P='N' | ND.TYP().DN='K'
      || op_1:=exec('tr','tlumaczenia','1000120'); op_2:=''
      || op_1:=exec('tr','tlumaczenia','1000107'); op_2:=''
      ?}
   ||
      print5(szer[1],szer[2]);
      op_1:=
         {? __STRTAB='ZD_NAG'
         || 'Seller:'
         || {? FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
            || exec('tr','tlumaczenia','1000120')
            || exec('tr','tlumaczenia','1000107')
            ?}
         ?}
   ?}
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {print5(szer[1],max_T10B-szer[1]-15,1,1); op_1:=''; op_2:=na[1];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10B'}
   {op_2:=na[2];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {IF: +na[3]}
      {op_1:='';op_2:=na[3];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[4]}
      {op_1:='';op_2:=na[4];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[5]}
      {op_1:='';op_2:=na[5];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{FI}
{IF: +na[11]}
   {op_1:='';op_2:=na[11];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[12];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[13];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[14];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[15];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: __STRTAB='FAKS' & FAKS.SZ='Z'}
   {FONT: 'T10'}{SPACE: 'C'}
   {
   print5(szer[1],szer[2]);
   op_1:='';
   op_2:={? +FAKS.NB || exec('tr','tlumaczenia','1000109') || '' ?};
   op_3:='';
   op_4:=exec('tr','tlumaczenia','1000110')+' '+form(FAKS.DW)
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   op_1:='';
   op_2:=FAKS.NB;
   op_3:='';
   op_4:={? FAKS.DW>=date(2013,1,1) || exec('tr','tlumaczenia','2013112') || exec('tr','tlumaczenia','1000112') ?}+' '+
       form(FAKS.D,,{? PARAM_W.MC='N' || 1 || 8 ?})
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   { op_1:=''; op_2:={? FAKS.T().UE='T' || FAKS.SKID_RBK().BANK().KODISO().KODISO || '' ?}+FAKS.RBK; op_3:=op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{LINE: 2}
{ strony(); VAR_DEL.delete('strony');~~}
{MACRO-}
{MACRO: 'qstronyn'}
{COMMENT}   ustalenie maksymalnych szerokosci strony dla fontow      {COMMENT-}
{
strony:="
   VAR_DEL.delete('zero_na','szer','print5','na');
   VAR_DEL.delete('op_1','op_2','op_3','op_4');
   VAR_DEL.delete('oddzial')
   ";
strony()
;~~}
{FONT: 'T8G'}  {max_T8G:=charleft-6;~~}
{FONT: 'T10B'} {max_T10B:=charleft-13;~~}
{
zero_na:="{! _i:=1..obj_len(na)|! na[_i]:='' !}";
szer:=obj_new(2);
na:=obj_new(15);
op_1:=op_2:=op_3:=op_4:='';

print5:="
   prn1:='PRN5';
   op_1:=op_2:=op_3:=op_4:='';
   {? _=2 || _c:=_a; _d:=_b ?};
   VAR_DEL.delete('PRN5');
   PRN5:=obj_new(@.CLASS.PRINT,4);
   PRN5.n_frame();
   PRN5.add($('form(op_1,)'),_a,'',1);
   PRN5.add($('form(op_2,)'),_b,'');
   PRN5.add($('form(op_3,)'),_c,'',1);
   PRN5.add($('form(op_4,)'),_d,'')
";

szer[1]:={? __STRTAB='ZD_NAG' || 12 || 11 ?};   "--Sprzedawca,Nabywca,Platnik T8B'--";
szer[2]:=(max_T10B-(2*szer[1]))/2$0;            "--druga kolumna T8B pusta--"
;~~}
{COMMENT}   NABYWCA, PLATNIK                                         {COMMENT-}
{FONT:'T10'}{SPACE:'C'}
{
zero_na();
{? __STRTAB='FAKS' & FAKS.KH_ODB<>null & FAKS.KH = KSTE.KHD
||
   "--odbiorca jednorazowy--";
   na[1]:=FAKS.KH_ODB().KOD;
   na[2]:=FAKS.KH_ODB().NAZ;
   na[3]:=FAKS.KH_ODB().POCZ+' '+FAKS.KH_ODB().MIASTO;
   na[4]:=FAKS.KH_ODB().UL;
   {? FAKS.T().UE ='T' | FAKS.NDVAT='O' & FAKS.NIP_UE<>''
   || na[5]:=exec('tr','tlumaczenia','1000113')+' '+FAKS.NIP_UE
   || na[5]:=exec('tr','tlumaczenia','1000114')+' '+FAKS.KH_ODB().NIP
   ?}
||
   {? __STRODB<>'' & ($__STRODB)()<>null
   ||
     {? __STRTAB='FAKS' & FAKS.KH_ODB().REF_KH<>0
     ||
        KH.cntx_psh();
        KH.prefix();
        {? KH.seek(FAKS.KH_ODB().REF_KH, KH.name())
        ||
           na[6]:=KH.KOD;
           na[7]:=KH.NAZ_P;
           na[8]:=KH.POCZ+' '+{? ~((-KH.POCZ)*(-KH.MIASTO)) || KH.MIASTO || '' ?};
           na[9]:=KH.UL;
           na[10]:=exec('tr','tlumaczenia','1000108')+' '+KH.NIP
        ?};
        KH.cntx_pop()
     ||
        ($(__STRODB+'()'))();
        na[6]:=KH_ODB.KOD;
        na[7]:=KH_ODB.NAZ;
        na[8]:=KH_ODB.POCZ+' '+KH_ODB.MIASTO;
        na[9]:=KH_ODB.UL
     ?}
   ?};
   {? __STRTAB='FAKS' & +FAKS.NAZ & -PARAM_W.DR_DUPL='t'
   ||
      na[1]:=FAKS.KH().KOD;
      na[2]:=FAKS.NAZ;
      na[3]:=FAKS.POCZ+' '+{? ~((-FAKS.POCZ)*(-FAKS.MIASTO)) || FAKS.MIASTO || '' ?};
      na[4]:=FAKS.UL
   ||
      ($(__STRTAB+'.KH()'))();
      na[1]:=KH.KOD;
      na[2]:=KH.NAZ_P;
      na[3]:=KH.POCZ+' '+{? ~((-KH.POCZ)*(-KH.MIASTO)) || KH.MIASTO || '' ?};
      na[4]:=KH.UL
   ?};
   {? __STRTAB='FAKS' & (WYDRUKIL.WYDRUK='zak_rr' | WYDRUKIL.WYDRUK='kor_rr')
   ||
      na[11]:='PESEL: '+KH.PESEL;
      na[12]:='Nazwa dowodu to§samožci: '+KH.NDT().TR;
      na[13]:='Seria i numer DT: '+KH.SN_DT;
      na[14]:='Wydany przez: '+KH.WP().TR;
      na[15]:='Data wydania: '+$KH.DATA_WDT
   ?};
   {? __STRTAB='FAKS' & (FAKS.T().UE='T' | FAKS.NDVAT='O' & FAKS.NIP_UE<>'')
   || na[5]:=exec('tr','tlumaczenia','1000113')+' '+FAKS.NIP_UE
   |? __STRTAB='ND' & ND.TYP().UE ='T'
   || na[5]:=exec('tr','tlumaczenia','1000113')+' '+ND.NIP_UE
   || na[5]:=exec('tr','tlumaczenia','1000108')+' '+($(__STRTAB+'.KH().NIP'))()
   ?}
?}
;~~}
{IF: +na[6]}
   {FONT: 'T10B'}{SPACE:'C'}
   {
   print5(szer[1],szer[2]);
   op_1:=
      {? FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'  | __STRTAB='ND'
      || exec('tr','tlumaczenia','1000120')
      || exec('tr','tlumaczenia','1000107')
      ?};
   op_3:=exec('tr','tlumaczenia','1000119')
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {print5(szer[1],szer[2]); op_2:=na[1]; op_4:=na[6];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10B'}
   {print5(szer[1],szer[2]); op_2:=na[2]; op_4:=na[7]; ~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {IF: +na[3] | +na[8]}
      {op_1:='';op_2:=na[3];op_3:='';op_4:=na[8];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[4] | +na[9]}
      {op_1:='';op_2:=na[4];op_3:='';op_4:=na[9];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[5]}
      {op_1:='';op_2:=na[5];op_3:='';op_4:=na[10];~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{ELSE}
   {FONT: 'T10B'}{SPACE:'C'}
   {
   {? __STRTAB='ND'
   ||
      {? ND.TYP().P='N' | ND.TYP().DN='K'
      || op_1:=exec('tr','tlumaczenia','1000120'); op_2:=''
      || op_1:=exec('tr','tlumaczenia','1000107'); op_2:=''
      ?}
   ||
      print5(szer[1],szer[2]);
      op_1:=
         {? __STRTAB='ZD_NAG'
         || 'Dostawca:'
         || {? FAKS.SZ='S' | __STRTAB='ZK_N'  | __STRTAB='OFE'
            || exec('tr','tlumaczenia','1000120')
            || exec('tr','tlumaczenia','1000107')
            ?}
         ?}
   ?}
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {print5(szer[1],max_T10B-szer[1]-15,1,1); op_1:=''; op_2:=na[1];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10B'}
   {op_2:=na[2];~~}
   {SUBSTITUTE: 'LINIA0'}
   {FONT: 'T10'}
   {IF: +na[3]}
      {op_1:='';op_2:=na[3];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[4]}
      {op_1:='';op_2:=na[4];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
   {IF: +na[5]}
      {op_1:='';op_2:=na[5];op_3:='';op_4:='';~~}
      {SUBSTITUTE: 'LINIA0'}
   {FI}
{FI}
{IF: +na[11]}
   {op_1:='';op_2:=na[11];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[12];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[13];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[14];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
   {op_1:='';op_2:=na[15];op_3:='';op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{IF: __STRTAB='FAKS' & FAKS.SZ='Z'}
   {FONT: 'T10'}{SPACE: 'C'}
   {
   print5(szer[1],szer[2]);
   op_1:='';
   op_2:={? +FAKS.NB || exec('tr','tlumaczenia','1000109') || '' ?};
   op_3:='';
   op_4:=exec('tr','tlumaczenia','1000110')+' '+form(FAKS.DW)
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   {
   op_1:='';
   op_2:=FAKS.NB;
   op_3:='';
   op_4:=exec('tr','tlumaczenia','1000112')+' '+
       form(FAKS.D,,{? PARAM_W.MC='N' || 1 || 8 ?})
   ;~~}
   {SUBSTITUTE: 'LINIA0'}
   { op_1:=''; op_2:={? FAKS.T().UE='T' || FAKS.SKID_RBK().BANK().KODISO().KODISO || '' ?}+FAKS.RBK; op_3:=op_4:='';~~}
   {SUBSTITUTE: 'LINIA0'}
{FI}
{LINE: 2}
{ strony(); VAR_DEL.delete('strony');~~}
{MACRO-}