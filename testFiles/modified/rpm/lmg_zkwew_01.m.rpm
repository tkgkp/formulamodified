:!UTF-8
{TITLE:A. Wydruk zamówienia}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','v'),,,,,'Q','C',,,,,,1,
   PAR_WYDR.MBOT,PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,0,1}
{BEGIN:
   {? exec('czy_grp_dr','faktury_wydruk')
   || __GRP_DR.WZ:='lmg_zkwew_01'
   ?};
   POLA.NAZ_WYDR:='Zamówienie wewnętrzne '+exec('str_to_pth','#string',ZK_N.SYM)+'.pdf';
   zkzam_01:="
      VAR_DEL.delete('PRN','ww','kk','pp','na','szer');
      VAR_DEL.delete('ddokl','doklw');
      VAR_DEL.delete('color','prn1','prn2');
      VAR_DEL.delete('lm','ll','vp','lmt','rsep');
      VAR_DEL.delete('il_lin','dokl','lp');
      VAR_DEL.delete('zakoncz','proforma');
      VAR_DEL.delete('oddzial');
      VAR_DEL.delete('byl','wsk');
      VAR_DEL.delete('M_GD','S_GD');
      VAR_DEL.delete('zero_na','print5','op_1','op_2','op_3','op_4');
      VAR_DEL.delete('max_T8','max_T8G','max_T10B')
      ";
   VAR_DEL.delete('__tab_sel','ns','NOMAXP');
   zkzam_01();

   exec('czytaj','#stalesys',,XINFO); KSTE.get();
   _ilk:=7;
   PRN:=obj_new(@.CLASS.PRINT,_ilk); PRN.s_frame();
   ww:=obj_new(_ilk); {! _ii.._ilk |! ww[_ii]:=0  !};"--wartosci kolumn--";
   kk:=obj_new(_ilk); {! _ii.._ilk |! kk[_ii]:=0  !}; "--szerokosc kolumn--";
   pp:=obj_new(_ilk); {! _ii.._ilk |! pp[_ii]:='' !}; "--tymczasowa do szacowania szerokosci kolumn--";
   ddokl:=0; "--najwieksza drukowana dokladnosc ilosci--";

   color:=prn1:=prn2:='';
   lm:=ll:=vp:=lmt:=rsep:=0;
   il_lin:=0;
   zakoncz:=1;
   oddzial:=KSTE.NAZ<>'';
   byl:=wsk:=0;
   proforma:=0;
   ns:=0;
   ZL.cntx_psh
;~~}
{END:
   ZL.cntx_pop;
   zkzam_01(); VAR_DEL.delete('zkzam_01'); VAR_DEL.delete('__tab_sel','ns','NOMAXP')
;~~}
{IF: ZK_N.T().T='ZWM' & (ZK_N.STAT_REJ='N' | ZK_N.STAT_REJ='Z')}
{ FUN.emsg('Zamówienie wewnętrzne dla potrzeb produkcji nie jest zaakceptowane,\
            nie można drukować tego zamówienia')
;~~}{EXIT}
{FI}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: lmg_zkwew_02.rpi}
{IF:ZK_N.sel_size()>0 & __GRP_DR.PDF=0}
   {
        ZK_N.cntx_psh();
        ZK_P.cntx_psh();
        NOMAXP:=1;
      __tab_sel:=ZK_N.sel_aget()
   ;~~}
{FOR: __tab_sel}
   {DO}
      {IF: ZK_N.seek(__tab_sel.REF,)}
      {
         zkzam_01();

         exec('czytaj','#stalesys',,XINFO); KSTE.get();
         _ilk:=7;
         PRN:=obj_new(@.CLASS.PRINT,_ilk); PRN.s_frame();
         ww:=obj_new(_ilk); {! _ii.._ilk |! ww[_ii]:=0  !};"--wartosci kolumn--";
         kk:=obj_new(_ilk); {! _ii.._ilk |! kk[_ii]:=0  !}; "--szerokosc kolumn--";
         pp:=obj_new(_ilk); {! _ii.._ilk |! pp[_ii]:='' !}; "--tymczasowa do szacowania szerokosci kolumn--";
         ddokl:=0; "--najwieksza drukowana dokladnosc ilosci--";

         color:=prn1:=prn2:='';
         lm:=ll:=vp:=lmt:=rsep:=0;
         il_lin:=0;
         zakoncz:=1;
         oddzial:=KSTE.NAZ<>'';
         byl:=wsk:=0;
         proforma:=0;
         ~~}
         {INCLUDE: lmg_zkwew_01.rpi}
         {IF: lineleft()>0}{PAGE}{ns:=1;page(1);~~}{FI}
      {FI}
   {OD}
   {
      ZK_N.cntx_pop();
      ZK_P.cntx_pop()
   ;~~}
{ELSE}
   {ZK_N.cntx_psh();
   ZK_P.cntx_psh();~~}
   {INCLUDE: lmg_zkwew_01.m.rpi}
   {ZK_N.cntx_pop();
   ZK_P.cntx_pop();~~}
{FI}