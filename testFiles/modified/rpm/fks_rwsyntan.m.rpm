:!UTF-8
{TITLE:A. Zestawienie rozrachunków}
{PRINTER: FINFO.SZ_PRN,,,,,'Q','C',,,,,,1,
   PAR_WYDR.MLEFT,PAR_WYDR.MTOP,PAR_WYDR.MRIGHT,PAR_WYDR.MBOT,0,1,,'enable'}
{BEGIN:
   PRN11:=obj_new(@.CLASS.PRINT,15+{? rep_export() || 1 ?}); PRN11.sl_frame(); w:=obj_new(18);
   PRN12:=obj_new(@.CLASS.PRINT,1); PRN12.sl_frame();
   PRN13:=obj_new(@.CLASS.PRINT,10); PRN13.sl_frame();
   PRN21:=obj_new(@.CLASS.PRINT,1); PRN21.sl_frame();
   PRN22:=obj_new(@.CLASS.PRINT,18+{? rep_export() || 1 ?}); PRN22.sl_frame();
   PRN23:=obj_new(@.CLASS.PRINT,7); PRN23.sl_frame();
   PRN1F:=obj_new(@.CLASS.PRINT,10); PRN1F.sl_frame(); wf:=obj_new(10);
   PRN2F:=obj_new(@.CLASS.PRINT,7); PRN2F.sl_frame();
   gzwal:={? PAR_SKID.get(39)='T' || 1 |? PAR_SKID.get(39)='N' || 0 || 2 ?};
   OKRO_F.index('ROK'); OKRO_F.prefix(SSTALE.AO().ROK);
   {? OKRO_F.NR=0 || OKRO_F.next(); gdzap:=OKRO_F.POCZ
   |? (OKRO_F.KON=date(0,0,0)) & (OKRO_F.NR<>0)
   || OKRO_F.prev(); gdzap:=OKRO_F.KON
   || gdzap:=OKRO_F.KON
   ?};
   data_kon:=~~;
   ROK_F.cntx_psh(); ROK_F.index('ROKPOCZ'); ROK_F.prefix(REF.FIRMA); SSTALE.AR();
   {? ~exec('first_rok_obsz','zam_okr_rok','FKS',ROK_F.ref()) & ROK_F.prev()
   || OKRO_F.cntx_psh(); OKRO_F.index('ROK'); OKRO_F.prefix(ROK_F.ref());
      {? OKRO_F.last()
      || {! |? OKRO_F.prev() & OKRO_F.KON=date(0,0,0) !};
         {? OKRO_F.KON<>date(0,0,0) || data_kon:=OKRO_F.KON ?}
      ?};
      OKRO_F.cntx_pop()
   ?};
   ROK_F.cntx_pop();
   WAL.prefix(); gtwals:=WAL.size(); twal:=obj_new(gtwals);
   KH.win_sel('WER_SLO');
   KH.actions('WER_SLO','W');
   {! _i:=1..gtwals |! twal[_i]:=obj_new(3) !};
   {! _i:=1..gtwals |! twal[_i,1]:=''; {! _j:=2..3 |! twal[_i,_j]:=0 !} !};
   ind1:=gkontr:=gsym:=gzsym:=godd:=gzodd:=gan:=gzan:=gks:=gwal:=rozl:='';
   i:=gv:=gsbud:=gcks:=gckontr:=gg2:=gg3:=grprn:=gnrzap:=gnrroz:=0;
   pkwn:=pkma:=pkwwn:=pkwma:=pswn:=psma:=pswwn:=pswma:=vpkwn:=vpkma:=vpkwwn:=vpkwma:=0;
   rkwn:=rkma:=rkwwn:=rkwma:=rswn:=rsma:=rswwn:=rswma:=0;
   swng2:=smag2:=swwng2:=swmag2:=swng3:=smag3:=swwng3:=swmag3:=0;
   s_sign:=color:=prn1:=prn2:=''; lm:=ll:=vp:=lmt:=rsep:=wl:=0; ext_spr:=0;
   s:=prn:=0; fun:=""; prefroz:=1; tuser:=tm_form(TMPVAT.tm_stamp)
}
{END:
   obj_del(w); obj_del(wf); obj_del(PRN11); obj_del(PRN12); obj_del(PRN13); obj_del(PRN21);
   obj_del(PRN22); obj_del(PRN23); obj_del(PRN1F); obj_del(PRN2F);
   &PRN11; &PRN12; &PRN13; &PRN21; &PRN22; &PRN23; &PRN1F; &PRN2F; &w;
   {? var_pres('TAB_SQL')>0 || obj_del(TAB_SQL); &TAB_SQL |? var_pres('TAB_SQL')=0 || &TAB_SQL ?};
   &gzwal; &gdzap;
   &gtwals; obj_del(twal); &twal;
   &ind1; &gkontr; &gsym; &gzsym; &godd; &gzodd; &gan; &gzan; &gks; &gwal;
   &i; &gv; &gsbud; &gcks; &gckontr; &gg2; &gg3; &grprn; &gnrzap; &gnrroz;
   &pkwn; &pkma; &pkwwn; &pkwma; &vpkwn; &vpkma; &vpkwwn; &vpkwma; &rkwn; &rkma; &rkwwn; &rkwma;
   &pswn; &psma; &pswwn; &pswma; &rswn; &rsma; &rswwn; &rswma; &ext_spr;
   &swng2; &smag2; &swwng2; &swmag2; &swng3; &smag3; &swwng3; &swmag3;
   &color; &prn1; &prn2; &lm; &ll; &vp; &prn; &lmt; &rsep; &wl; &rozl; &s_sign; &wf;
   &s; &fun; &prefroz; &data_kon; &tuser;
   KH.actions('WER_SLO')
}
{COMMENT}
(c) Macrologic S.A. Wszelkie prawa zastrzezone
===================================================================================================
Nazwa pliku: rwsyntan.rpm
Utworzony:   2004-12-30 [AMA]
===================================================================================================
Zawartosc: Zestawienie rozrachunkow.
Zmienne:
gzwal - zestawienie walutowe (kolumny z walutami)
gdzap - data zapisow (stan na dzien)
ind1 - indeks odpowiednik unikalnego indeksu OP
gkontr - kod kontrahenta
gsym - symbol rozrachunku
gzsym - symbol rozrachunku na poziomie zapisow
godd - jednostka ksiegowa rozrachunku
gzodd - jednostka ksiegowa rozrachunku na poziomie zapisow
gan - konto analityczne rozrachunku
gzan - konto analityczne rozrachunku na poziomie zapisow
gks - konto syntetyczne rozrachunku
gwal - waluta rozrachunku
gsbud - liczba poziomow analityki konta
gcks - znacznik zmiany konta syntetycznego
gckontr - znacznik zmiany kontrahenta
twal - zmienna dla podsumowan walut
gg2 - znacznik zakonczenia grupy 2 (rozrachunki) (do drukowania wiersza Razem)
gg3 - znacznik zakonczenia grupy 3 (zapisy) (do drukowania wiersza Suma)
grprn - znacznik drukowania rekordu
gnrzap - liczba wydrukowanych zapisow rozrachunku
gnrroz - liczba wydrukowanych dla konta analitycznego (kontrahenta) rozrachunkow
pkwn, pkma, pkwwn, pkwma - sumy kwot dla strony, odpowiednio wn i ma oraz wn i ma w walucie
vpkwn, vpkma, vpkwwn, vpkwma - pomocnicze dla sumy stron (wiersz moze nie zmiescic sie na stronie)
rkwn, rkma, rkwwn, rkwma - sumy kwot dla wydruku, odpowiednio wn i ma oraz wn i ma w walucie
swng2, smag2, swwng2, swmag2 - sumy zapisow dla konta (kontrahenta) wn i ma oraz wn i ma w walucie
swng3, smag3, swwng3, swmag3 - sumy zapisow dla rozrachunku wn i ma oraz wn i ma w walucie
i - licznik
gv - znacznik
{COMMENT-}
{  ROZNE.ZAKR_ROZ:=2;
   KONTO.K1:=KONTO.K2:=KONTO.K3:=KONTO.K4:=KONTO.K1_AE:=KONTO.K2_AE:=KONTO.K3_AE:=KONTO.K4_AE:=''; KONTO.K1_RODZ:=2; KONTO.K2_RODZ:=KONTO.K3_RODZ:=KONTO.K4_RODZ:=3;
   KONTO.K1_SYNT:=KONTO.K2_SYNT:=KONTO.K3_SYNT:=KONTO.K4_SYNT:=KONTO.K1_WYM:=KONTO.K2_WYM:=KONTO.K3_WYM:=KONTO.K4_WYM:=0;
   KONTO.K1_BE:='{? UNPAR.P1=1 || 1 || 0 ?}';  KONTO.K2_BE:='{? UNPAR.P1=2 || 1 || 0 ?}';
   KONTO.K3_BE:=KONTO.K4_BE:='{? UNPAR.P1=3 || 1 || 0 ?}';
   UNPAR.P1:=UNPAR.P2:=UNPAR.P8:=UNPAR.P9:=1; UNPAR.P3:=2; UNPAR.P4:=gdzap;
   UNPAR.P5:=UNPAR.P6:=UNPAR.P13:=UNPAR.P14:=date(0,0,0); UNPAR.P7:=1;UNPAR.P15:=0;
   UNPAR.P1_BE:=UNPAR.P2_BE:=UNPAR.P3_BE:=UNPAR.P8_BE:=UNPAR.P9_BE:=
   UNPAR.P4_AE:=UNPAR.P5_AE:=UNPAR.P6_AE:=UNPAR.P7_AE:=UNPAR.P15_BE:=UNPAR.P13_AE:=UNPAR.P14_AE:='';
   UNPAR.P1_AE:='exec(\'p1_ae\',\'!fks_roz_zazr\')';
   UNPAR.P2_AE:='exec(\'p2_ae\',\'!fks_roz_zazr\')';
   UNPAR.P4_BE:='{? UNPAR.P2=1 || 1 || 0 ?}'; UNPAR.P5_BE:=UNPAR.P6_BE:='{? UNPAR.P2=2 || 1 || 0 ?}';
   UNPAR.P3_AE:='{? UNPAR.P3<>1 & UNPAR.P3<>4 || UNPAR.P2:=1; UNPAR.P5:=UNPAR.P6:=date(0,0,0); '
      +'{? UNPAR.P4=date(0,0,0) || UNPAR.P4:=gdzap ?}; 1 || 1 ?}';
   UNPAR.P7_BE:='{? UNPAR.P8=1 || {? UNPAR.P9=1 || 1 || 0 ?} || 0 ?}';
   UNPAR.P8_AE:='{? UNPAR.P8=2 || UNPAR.P7:=1 ?}; 1';
   UNPAR.P9_AE:='{? UNPAR.P9=2 || UNPAR.P7:=1 ?}; 1';
   UNPAR.P15_AE:='exec(\'p15_ae\',\'!fks_roz_zazr\')';
   UNPAR.P13_BE:=UNPAR.P14_BE:='UNPAR.P15';
   {? gzwal=2
   || {? ROZRACH.KONTR=null
      || PAR_WYDR.win_edit('RWSYNANW'); ROZNE.KH_WYB:=null; PAR_WYDR.PAR3:=1
      || PAR_WYDR.win_edit('RWSYNA2W'); PAR_WYDR.PAR3:=2; ROZNE.KH_WYB:=ROZRACH.KONTR
      ?};
      PAR_WYDR.WSK_WAL:='T'
   || {? ROZRACH.KONTR=null
      || PAR_WYDR.win_edit('RWSYNTAN'); ROZNE.KH_WYB:=null; PAR_WYDR.PAR3:=1
      || PAR_WYDR.win_edit('RWSYNA2N'); PAR_WYDR.PAR3:=2; ROZNE.KH_WYB:=ROZRACH.KONTR
      ?}
   ?};
   PAR_WYDR.PAR5:=0; PAR_WYDR.T_ROZ:=PAR_WYDR.MASKA:=''; PAR_WYDR.OMASKA:=2;
   PAR_WYDR.SP:='W';
   WYDRUKIN.DLKON:=35;
   UNPAR.PSLO:=null;
   UNPAR.PSLO_BE:='{? XINFO.SLU_PROJ<>null || SLO.win_dict(\'ONE_SEL\'); SLO.win_sel(\'ONE_SEL\'); XINFO.SLU_PROJ(); 1 ?}';
   UNPAR.PSLO_BV:=UNPAR.PSLO_AE:='';
   UNPAR.P34:=0; UNPAR.P34_BV:='';
   UNPAR.P34_AE:='UNPAR.P42:={? UNPAR.P34=1 & data_kon<>~~ || data_kon || date(0,0,0) ?};1';
   UNPAR.P34_BE:='';
   UNPAR.P42:=date(0,0,0);
   UNPAR.P42_BV:=''; UNPAR.P42_BE:='UNPAR.P34=1'; UNPAR.P42_AE:='{? UNPAR.P42<>date(0,0,0) || data_kon:=UNPAR.P42 ?};1';
   exec('p1_enable','!fks_roz_zazr');
   exec('p2_enable','!fks_roz_zazr');
   exec('p15_enable','!fks_roz_zazr');
   ~~}
{EXIT: ~PAR_WYDR.edit("exec('rwsyntan','!fks_roz_zazr')")}
{  {? PAR_WYDR.WSK_WAL='V'
   || gzwal:=3
   |? gzwal=2
   || gzwal:={? PAR_WYDR.WSK_WAL='T' || 1 || 0 ?}
   ?};
   {? UNPAR.P8=1 || w1:=0 || w1:=1 ?};
   PAR_WYDR.MASKA:=KONTO.K1;
   {? PAR_WYDR.MASKA=''
   || WYDRUKI.MASKA:=35*'?'
   || WYDRUKI.MASKA:=PAR_WYDR.MASKA;
      {? +WYDRUKI.MASKA<WYDRUKIN.DLKON || WYDRUKI.MASKA+=(WYDRUKIN.DLKON-+WYDRUKI.MASKA)*'?' ?}
   ?};
   {? UNPAR.P3=1 || rozl:='rozliczone'@
   |? UNPAR.P3=2 || rozl:='nierozliczone'@
   |? UNPAR.P3=3 || rozl:='przeterminowane'@
   |? UNPAR.P3=4 || rozl:='wszystkie'@
   ?};
   gdzap:={? UNPAR.P2=1 || UNPAR.P4 || UNPAR.P6 ?}; ~~}
{INCLUDE: wsp_pw.rpi}
{IF: UNPAR.P8=1}
   {INCLUDE: fks_rwsynta2.rpi}
{ELSE}
   {INCLUDE: fks_rwsynta1.rpi}
{FI}
{IF: rep_export()}{TABLE-}{FI}