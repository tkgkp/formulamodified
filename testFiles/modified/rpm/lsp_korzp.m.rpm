:!UTF-8
{TITLE:A. Korekta zbiorcza faktur}
{PRINTER: exec('set_parw','param_wydr');exec('prt','param_wydr','v'),exec('nopanel','param_wydr','S'),,,,'Q','C',,,,,,1,
   10,10,10,10,0,exec('get','#params',2121,2,OPERATOR.USER)<>'T'}
{BEGIN:
   POLA.NAZ_WYDR:='Korekta zbiorcza faktur '+exec('str_to_pth','#string',FAKS.SYM)+'.pdf';
   done:="";
   {? exec('upr_cs','ceny')
   || {? exec('czy_grp_dr','faktury_wydruk_new')
      || exec('begin_kz','faktury_wydruk_new','korzb',__GRP_DR.FIRST)
      || exec('begin_kz','faktury_wydruk_new','korzb')
   ?}
   ?};
   stron1:=0
}
{END: done(); VAR_DEL.delete('done','stron1')}
{IF: wyjscie=1}{EXIT}{FI}
{INCLUDE: wsp_pw.rpi}
{INCLUDE: wsp_strony_new.rpi}
{INCLUDE: lsp_korzb.m.rpi}
{IF: exec('upr_cs','ceny')=0}{ FUN.info('Brak uprawnień do wartości sprzedaży.'@);~~}{EXIT}{FI}

{IF: ~exec('czy_grp_dr','faktury_wydruk') | __GRP_DR.PDF}
   {SUBSTITUTE: 'druk'}
{ELSE}
   {
   FAKS.cntx_psh();
   __loop:=__GRP_DR.SEL.first();
   ~~}
   {WHILE: __loop}
   {DO}
      {IF: FAKS.seek(__GRP_DR.SEL.REF,)}
         {
         exec('begin_kz','faktury_wydruk',0);
         _v:=$int((100-PAR_WYDR.SHAD)*2.55);
         color:=_v+':'+_v+':'+_v;
         pages:=page-1; stron:=stron1;
         ~~}
         {IF: wyjscie=0}{SUBSTITUTE: 'druk'}{FI}
         { stron1:=stron;~~}
      {FI}
      { __loop:=__GRP_DR.SEL.next();~~}
   {OD}
   {
   FAKS.cntx_pop();
   VAR_DEL.delete('__loop');
   ~~}
{FI}