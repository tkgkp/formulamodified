:!UTF-8
{COMMENT}   MACRO - foot_tab                                         {COMMENT-}
{COMMENT}   Makro uzywane do drukowania stopki tabeli z pozycjami    {COMMENT-}
{DEFINEFONT: 'TM=Inter,75,Q,,0,0'}
{DEFINEFONT: 'TMB=Inter,75,R,,0,0'}
{DEFINEFONT: 'TF=Inter,75,F,,0,0'}
{DEFINEFONT: 'IE=Inter,150,E,,0,0'}
{DEFINEFONT: 'IF=Inter,150,F,,0,0'}
{MACRO: 'POZYCJA'}
{ llin:=lineleft(); lpoz:=0; lmax:=0; lmax_ft:=0;
  logr:={? __walh<>__walp & PARAM_W.WALH='T' || 4 || 3 ?};
  params_set(params_get());
  _f:='params_set(params_get()); '+prn1+'.ini_line()'; _v:=($(_f))();
  _f:=prn1+'.length()'; lmax:=($(_f))(); headfoot:={? lmax>(llin-logr-1) || 2 || 0 ?};
  prnDoPrze:=0;
  lmax_ft:=lmax;
~~}
{WHILE: lmax>0}
{DO}
   {IF: llin<=(logr+1) | ((lmax_ft+logr+1>llin) & lmax_ft<>0) }
      {bpage:=page(); ~~}
      {lmax_ft:=0;~~}
      {SUBSTITUTE: 'foot_tab'}
      {IF: bpage=page}{PAGE}{FI}
{COMMENT} Odrysowanie lini podziału {COMMENT-}
      { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
      { _f:=prn1+'.framecol('+color_frame+')'; ($(_f))(); ~~}
      {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
      { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
      { llin:=lineleft(); ~~}
      { {? headfoot=2 || headfoot:=1 ?}; ~~}
   {ELSE}
      { lpoz:=0; ~~}
      {IF: headfoot<>1}
{COMMENT} Odrysowanie lini podziału {COMMENT-}
         {IF: vp}
            { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
            {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
            { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
         {ELSE}
            {IF: PAR_WYDR.RSEP & rsep}
               {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
            {ELIF: rsep}
               {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
            {FI}
         {FI}
      {FI}
{COMMENT} Odrysowanie treści pozycji {COMMENT-}
      {WHILE: _f:=prn1+'.next()'; ($(_f))() & (llin-lpoz>(logr+1) | lpoz=0)}
      {DO}
         { lpoz+=1; lmax-=1; ~~}
         {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
         { {? prnDoPrze=0 || prnDoPrze:=1; {? PARAM_W.WALH='H' || do_przeh() || do_przep() ?} ?}; ~~}
      {OD}
      { llin:=lineleft(); ~~}
   {FI}
{OD}
{ VAR_DEL.delete('prnDoPrze','lmax_ft'); ~~}
{MACRO-}
{MACRO: 'foot_tab'}
{
vp:=0;
prn1_tmp:=prn1;
prn2_tmp:=prn2;
prn1:='PRN1';
prn2:='PRN3';
prz[1]:=exec('tr','tlumaczenia','1000130');
prz[2]:=do_p[1];
prz[3]:='';
prz[4]:=do_p[2];
prz[5]:=do_p[3];
prz[6]:=__walp;
rrsep:=rsep;
rsep:=1;
walutowa:=0
;~~}
{IF: PARAM_W.WALH<>'H'}{SUBSTITUTE: 'LINIA02'}{FI}
{IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
   {
   {? PARAM_W.WALH<>'H' || rsep:=0 ?};
   walutowa:=1;
   {? PARAM_W.WALH<>'H' || prz[1]:='' ?};
   prz[2]:=do_p[4];
   prz[4]:=do_p[5];
   prz[5]:=do_p[6];
   prz[6]:=__walh
   ;~~}
   {SUBSTITUTE: 'LINIA02'}
{FI}
{prn1:='PRN3'; vp:=0; rsep:=rrsep; VAR_DEL.delete('rrsep');~~}
{SUBSTITUTE: 'LINIAF'}
{prn1:=prn1_tmp; prn2:=prn2_tmp; VAR_DEL.delete('prn1_tmp','prn2_tmp'); vp:=1;~~}
{MACRO-}
{COMMENT}   MACRO - druk                                             {COMMENT-}
{MACRO: 'druk'}
{WHILE: ilkop<=PARAM_W.KOPIA}
{DO}
{COMMENT}   FOOTER                                                   {COMMENT-}
   {FONT: exec('font','param_wydr','footer')}{SPACE: exec('space','param_wydr')}
   {IF: exec('czy_grp_dr','faktury_wydruk') | PARAM_W.KOPIA }
      {strona:=1;~~}
      {FOOTER}
      {<1}{charleft_foot:=charleft();~~}{>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
      {<1}{IF: exec('get_footer','img_blob')}{IMAGE: exec('get_footer','img_blob');;1}{FI}{>{charleft_foot-3}$strona}{' '}{COLOR: color_oo}{'  '}{COLOR: color_bw}{strona+=1;~~}
      {>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
      {FOOTER-}
   {ELSE}
      {FOOTER}
      {<1}{charleft_foot:=charleft();~~}{>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
      {<1}{IF: exec('get_footer','img_blob')}{IMAGE: exec('get_footer','img_blob');;1}{FI}{MAXPAGE: >{charleft_foot-3};$page+' / '; 3L;' '}{' '}{COLOR: color_oo}{'  '}{COLOR: color_bw}
      {>{charleft_foot-1}}{COLOR: color_oo}{'  '}{COLOR: color_bw}
      {FOOTER-}
   {FI}
   {
   PAR_WYDR.TITLE:=exec('trans_typysp','tlumaczenia',TYPYSP.ref(),PARAM_W.JEZYK);
   PAR_WYDR.SYM:=FAKS.SYM;
   TYPYSP.cntx_psh();
   PAR_WYDR.TYPE:=FAKS.T().T;
   TYPYSP.cntx_pop();
   prn1:='PRN1';
   prn2:='PRN2';
   rsep:=0
   ;~~}
{COMMENT}   REPORT - HEADER                                          {COMMENT-}
   { head:=PAR_WYDR.HEAD;PAR_WYDR.HEAD:=0;~~}
   { __STRTAB:='FAKS'; __STRODB:='FAKS.KH_ODB'; __STRLIN:=''; __STRDAT:=FAKS.DW;~~}
{COMMENT}   duplikat               {COMMENT-}
   {{? -PARAM_W.DR_DUPL='t'
    ||
      dup_head:=exec('tr','tlumaczenia','1000105');
      dup_val:=gsub(form(PARAM_W.DUPLIKAT,,3),'/','-');
      dup_sym:=1
    ?};
   ~~}
{COMMENT}   HEDER obowiazujacy przed wydrukiem pozycji               {COMMENT-}
   {HEADER}
   {SUBSTITUTE: 'HEADF'}
   {HEADER-}
{COMMENT}   oryginal / kopia, tryb probny                            {COMMENT-}
   {FONT: exec('font','param_wydr','ory_kop')}{SPACE: exec('space','param_wydr')}
   {IF: (';NZA'*FAKS.STAT_REJ)>1}{<1}{>{charleft}exec('tr','tlumaczenia','100021'+{? FAKS.STAT_REJ='A' || '5' || '0' ?})}{FI}
   {<1}{>{charleft}{? ~skladanka
      || {? ilkop=0 || exec('tr','tlumaczenia','1000103') || exec('tr','tlumaczenia','1000104') ?}
      || '' ?}}
{ ilkop+=1;~~}
{COMMENT}   DANE NAGLOWKOWE                                          {COMMENT-}
{COMMENT}   strony transakcji                                        {COMMENT-}
{SUBSTITUTE: 'stronyf'}
{ VAR_DEL.delete('__STRTAB','__STRODB','__STRLIN','__STRDAT');~~}
   {FONT: exec('font','param_wydr','strony_po')}
   {<1}{
   _sz1:=max_T8G/2$0;_sz2:=1;
   print4(_sz1,_sz2);
   _sz2+=charleft-PRN4.width();
   print4(_sz1,_sz2);
   ~~}
   {inf_head:=inf_head_beg;
   inf_val:=inf_val_beg;
   ~~}
{COMMENT}   kurs dla waluty                                          {COMMENT-}
   {wal_h:={? PARAM_W.WALH='H' & exec('get','#params',100232,2)='N' || 0 || 1 ?};~~}
   {IF: walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H') & wal_h}
      {
      inf_head+=exec('tr','tlumaczenia','1000126')+' '+__walh+';';
      inf_val+=form(FAKS.KRS,,4)+';';
      inf_head+=exec('tr','tlumaczenia','1000126')+' '+exec('tr','tlumaczenia','1000127')+';';
      inf_val+=(gsub(form(FAKS.DTK,,3),'/','-')+';');
      B.cntx_psh();
      B.index('BANKOD');
      B.prefix(FAKS.BTK,);
      {? FAKS.SWAL=1 & B.first
      || inf_head+=exec('tr','tlumaczenia','1000128')+';';
         inf_val+=B.NB+';'
      ?};
      B.cntx_pop();
      ~~}
   {FI}
{COMMENT}informacje dodatkowe: zamowienia, dokumenty magazynowe  {COMMENT-}
   {ENTIRE}
   {SUBSTITUTE: 'panel_informacji'}
   {ENTIRE-}
{COMMENT}   informacje dodatkowe dla naglowka                        {COMMENT-}
   {
   "--pobranie danych--"; exec('pobgdnag','fakso','F',FAKS.ref);
   VAR_DEL.delete('oo','OPIK')
   ;~~}
   {FOR: S_GD}
   {PREFIX: 'G'}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {SUBSTITUTE: 'inf_dod'}
   {OD}
{COMMENT}   wyliczenie szerokosci kolumn                             {COMMENT-}
   {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
   {<1}{
   prn1:='PRN1';prn2:='PRN2';
   {? ilkop=1
   ||
      {! _i:=1..obj_len(fak) |! fak[_i]:=0 !};
      _czy_rab:=FAKS.RAB;
      _war9:=_war11:=_war12:=0;
      {? FAKS.DSP_WPOZ='T' || fak[16]:=10 ?};
      FAP.index('FAP');
      FAP.prefix(FAKS.ref());
      {? FAP.first()
      || {!
         |? fak[1]:={? (+form(FAP.POZ,,0))>fak[1] || +form(FAP.POZ,,0) || fak[1] ?};
            _uwagi:={? FAP.memo_lin('UWAGI')<>'\n' || gsub(FAP.memo_lin('UWAGI'),'\n',' ') || '' ?};
            fak[2]:={? (+(FAP.M().KTM+' - '+M.N+' '+_uwagi))>fak[2] || +(M.KTM+' - '+M.N+' '+_uwagi) || fak[2] ?};
            _pkwiudl:=+exec('pkwiu','material',FAKS.DW,FAP.M,1,FAP.PKWIU_CN);
            fak[3]:={? _pkwiudl>fak[3] || _pkwiudl || fak[3] ?};
            fak[4]:={? (+form(FAP.IL,,ddokl))>fak[4] || +form(FAP.IL,,ddokl) || fak[4] ?};
            _tlumacz:=exec('trans_jm','tlumaczenia',FAP.JM,PARAM_W.JEZYK);
            _tlumacz:={? PARAM_W.JEZYK<>null & _tlumacz<>'' || _tlumacz || FAP.JM().KOD ?};
            fak[5]:={? (+_tlumacz)>fak[5] || +_tlumacz || fak[5] ?};
            {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || fak[6]:={? +form(FAP.CPR,,cprdokl)>fak[6] || +form(FAP.CPR,,cprdokl) || fak[6] ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || fak[6]:={? +form(FAP.CWAL,,cprdokl)>fak[6] || +form(FAP.CWAL,,cprdokl) || fak[6] ?}
            ?};
            {? exec('czyrabp','ceny',FAKS.RAB_TYP)
            || _rabat:=exec('rab_proc','ceny',FAP.RAB,FAKS.RAB,FAKS.RAB_TYP);
               fak[7]:={? (+form(_rabat,,rdokl))>fak[7] || +form(_rabat,,rdokl) || fak[7] ?}
            || {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
               || _cb_cn:={? odbrutto=1 || FAP.CB || FAP.CN ?};
                  fak[7]:={? (+form(FAP.CPR-_cb_cn,,rdokl))>fak[7] || +form(FAP.CPR-_cb_cn,,rdokl) || fak[7] ?}
               ?};
               {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
               || fak[7]:=
                     {? (+form(FAP.RABK+(FAKS.RAB*FAP.CWAL/100)$rdokl,,rdokl))>fak[7]
                     || +form(FAP.RABK+(FAKS.RAB*FAP.CWAL/100)$rdokl,,rdokl)
                     || fak[7]
                     ?}
               ?}
            ?};
            _czy_rab+=FAP.RAB+FAP.RABK;
            {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || _cb_cn:={? odbrutto=1 || FAP.CB || FAP.CN ?};
               fak[8]:={? +form(_cb_cn,,cdokl)>fak[8] || +form(_cb_cn,,cdokl) || fak[8] ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || {? exec('czyrabp','ceny',FAKS.RAB_TYP)
               || _rabat:=1-exec('rab_proc','ceny',FAP.RAB,FAKS.RAB,FAKS.RAB_TYP)/100;
                  fak[8]:={? +form(FAP.CWAL*_rabat,,cdokl)>fak[8] || +form(FAP.CWAL*_rabat,,cdokl) || fak[8] ?}
               || _cpor:=FAP.CWAL-FAP.RABK-(FAKS.RAB*FAP.CWAL/100)$2;
                  fak[8]:={? +form(_cpor,,cdokl)>fak[8] || +form(_cpor,,cdokl) || fak[8] ?}
               ?}
            ?};
            fak[9]+=FAP.WWAL_P; _war9+=FAP.WWAL;
            fak[10]:=5;
            fak[11]+=FAP.VWAL_P; _war11+=FAP.VWAL;
            fak[12]+=FAP.BWAL_P; _war12+=FAP.BWAL;
            _war:=(FAP.IL*FAP.CPR)$2;
            _warw:=(FAP.IL*FAP.CWAL)$2;
            {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || fak[14]:={? fak[14]<+form(_war,,2) || +form(_war,,2) || fak[14] ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || fak[14]:={? fak[14]<+form(_warw,,2) || +form(_warw,,2) || fak[14] ?}
            ?};
            _kw_rab:=_war-{? odbrutto=1 || FAP.BWAL_P || FAP.WWAL_P ?};
            _kw_rabw:=_warw-{? odbrutto=1 || FAP.BWAL || FAP.WWAL ?};
            {? walutowa=0 | walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='N')
            || fak[15]:={? fak[15]<+form(_kw_rab,,2) || +form(_kw_rab,,2) || fak[15] ?}
            ?};
            {? walutowa=1 & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            || fak[15]:={? fak[15]<+form(_kw_rabw,,2) || +form(_kw_rabw,,2) || fak[15] ?}
            ?};
            {? FAP.SV().KOD=' -o' || __oo:=1 ?};
            FAP.next()
         !}
      ?};
      {? walutowa=0 | PARAM_W.WALH='N' || _war9:=_war11:=_war12:=0 ?};
      fak[9]:={? +form(fak[9],,2)>+form(_war9,,2) || +form(fak[9],,2) || +form(_war9,,2) ?};
      fak[11]:={? +form(fak[11],,2)>+form(_war11,,2) || +form(fak[11],,2) || +form(_war11,,2) ?};
      fak[12]:={? +form(fak[12],,2)>+form(_war12,,2) || +form(fak[12],,2) || +form(_war12,,2) ?};
      "--obliczanie szerokosci kolumn NETTO, VAT, BRUTTO dla faktury zaliczkowej i rozliczajacej--";
      {? ~('TO'*ndvat)
      ||
         _war9:=_war11:=_war12:=0;
         {? FAKS.WHERE='L'
         ||
            FAKSV.index('FF_SV');
            FAKSV.prefix('',faks);
            {? FAKSV.first
            ||
               {!
               |?
                  _war9+=FAKSV.WN_Z;
                  _war11+=FAKSV.WV_Z;
                  _war12+=FAKSV.WB_Z;
                  FAKSV.next
               !}
            ?};
            fak[9]:={? fak[9]>+form(_war9,,2) || fak[9] || +form(_war9,,2) ?};
            fak[11]:={? fak[11]>+form(_war11,,2) || fak[11] || +form(_war11,,2) ?};
            fak[12]:={? fak[12]>+form(_war12,,2) || fak[12] || +form(_war12,,2) ?}
         |? exec('czy_end','faktury_zalicz')
         ||
            FAKSV.index('FF_SV');
            FAKSV.prefix('',faks);
            {? FAKSV.first
            ||
               {!
               |? _war:=FAKSV.WN_R; _war9+=_war;
                  fak[9]:={? fak[9]>+form(_war,,2) || fak[9] || +form(_war,,2) ?};
                  _war:=FAKSV.WV_R; _war11+=_war;
                  fak[11]:={? fak[11]>+form(_war,,2) || fak[11] || +form(_war,,2) ?};
                  _war:=FAKSV.WB_R; _war12+=_war;
                  fak[12]:={? fak[12]>+form(_war,,2) || fak[12] || +form(_war,,2) ?};
                  FAKSV.next
               !};
               fak[9]:={? fak[9]>+form(_war9,,2) || fak[9] || +form(_war9,,2) ?};
               fak[11]:={? fak[11]>+form(_war11,,2) || fak[11] || +form(_war11,,2) ?};
               fak[12]:={? fak[12]>+form(_war12,,2) || fak[12] || +form(_war12,,2) ?}
            ?};
            {? walutowa
            || _war9:=_war11:=_war12:=0;
               FAKSV.index('FF_SV');
               FAKSV.prefix('',faks);
               {? FAKSV.first
               ||
                  {!
                  |?
                     _war:=FAKSV.WW-FAKSV.WW_Z; _war12+=_war;
                     fak[12]:={? fak[12]>+form(_war,,2) || fak[12] || +form(_war,,2) ?};
                     _sv:=(#((FAKSV.SV().KOD*'%')+FAKSV.SV().KOD-1))*0.01;
"--                     _wwn:=(FAKSV.WW/(1+_sv))$2--";
"--                     _wwn_z:=(FAKSV.WW_Z/(1+_sv))$2--";
                     _wwn:=exec('wwn','faktury_vat',FAKS.ref(),FAKSV.SV);
                     _wwn_z:=exec('wwn_z','faktury_vat',FAKSV.FAKS,FAKSV.SV().KOD,_sv,2);
                     _war:=_wwn-_wwn_z; _war9+=_war;
                     fak[9]:={? fak[9]>+form(_war,,2) || fak[9] || +form(_war,,2) ?};
                     _wwv:=FAKSV.WW-_wwn;
                     _wwv_z:=FAKSV.WW_Z-_wwn_z;
                     _war:=(_wwv-_wwv_z)$2; _war11:=_war;
                     fak[11]:={? fak[11]>+form(_war,,2) || fak[11] || +form(_war,,2) ?};
                     FAKSV.next
                  !};
                  fak[9]:={? fak[9]>+form(_war9,,2) || fak[9] || +form(_war9,,2) ?};
                  fak[11]:={? fak[11]>+form(_war11,,2) || fak[11] || +form(_war11,,2) ?};
                  fak[12]:={? fak[12]>+form(_war12,,2) || fak[12] || +form(_war12,,2) ?}
               ?}
            ?}
         ?}
      ?};
      fak[13]:={? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H') || 6 || 0 ?};
      {? _czy_rab=0 & (PARAM_W.DR_RAB<>'N' | FAKS.SPOBLRAB<>'C') | FAKS.SPOBLRAB='W' || fak[7]:=fak[8]:=0 ?};
      {? _czy_rab=0 | FAKS.SPOBLRAB='C' || fak[14]:=fak[15]:=0 ?};
      {? PARAM_W.DR_RAB='N' & FAKS.SPOBLRAB='C' || fak[6]:=fak[7]:=fak[14]:=fak[15]:=0 ?};
      {? k1[1]<fak[9]  || k1[1]:=fak[9] ?};
      {? k1[2]<fak[11] || k1[2]:=fak[11] ?};
      {? k1[3]<fak[12] || k1[3]:=fak[12] ?};
      {? ~('TO'*ndvat) & vatzpoz=0 & odbrutto=1 || fak[9]:=fak[11]:=0
      |? ~('TO'*ndvat) & vatzpoz=0              || fak[11]:=fak[12]:=0
      |? ('TO'*ndvat)                           || fak[10]:=fak[11]:=fak[12]:=0
      ?};
      {? __wydrfa.uproszcz
      ||
         fak[4]:=0;
         fak[5]:=0;
         fak[6]:=0;
         fak[7]:=0;
         fak[8]:=0;
         fak[9]:=0;
         fak[10]:=0;
         fak[11]:=0;
         fak[12]:=0;
         fak[13]:=0
      ?};
      {? fak[1]>2 || k[1]+=FAKS.SP_WYM='T' ?};
      {? fak[1]<3 || k[1]:=3 ?};
      fak[1]:=k[1];
      {! _i:=1..obj_len(k) |! {? fak[_i]=0 || k[_i]:=0 ?} !};
      {! _i:=3..obj_len(k)
      |!
         {? fak[_i]>k[_i] || k[_i]:=fak[_i] ?}
      !};
      k[2]:=1; print1();
      k[2]+=charleft-PRN1.width();
      print1(); print2(); print3()
   || print2()
   ?}
   ;~~}
{COMMENT}   odrysowanie po raz pierwszy naglowka tabeli pozycji      {COMMENT-}
   {FONT: exec('font','param_wydr','tabhead_poz')}
   {
   prn1:='PRN1'; prn2:='PRN2';
   {! _ii:=1..6 |! s[_ii]:=0 !};
   sp[1]:=sp[2]:=sp[3]:=0;
   sw[1]:=sw[2]:=sw[3]:=0;
   il_lin:=0;
   FAP.index('FAP'); FAP.prefix(FAKS.ref()); {? FAP.first() || pozycja() ?};
   logr:=9+{? PARAM_W.WALH='T' || 1 || 0 ?}+{? exec('czy_rab','faktury_wspolne') || 2 || 0 ?};
   ~~}
   {IF: lineleft()>0 & lineleft()<logr}{PAGE}{FI}
   {SUBSTITUTE: 'TABHEAD'}{ vp:=1;~~}
{COMMENT}   HEADER obowiazujacy przy drukowaniu pozycji faktury      {COMMENT-}
   {HEADER}
      {SUBSTITUTE: 'HEADF'}
      {FONT: exec('font','param_wydr','header')}{SPACE: exec('space','param_wydr')}
      {IF: fabs(do_p[1])+fabs(do_p[2])+fabs(do_p[3])+fabs(do_p[4])+fabs(do_p[5])+fabs(do_p[6])}
         {
         vp_tmp:=vp; vp:=0;
         rsep_tmp:=rsep; rsep:=0;
         prn1:='PRN3';
         prz[1]:=exec('tr','tlumaczenia','1000129');
         prz[2]:=do_p[1];
         prz[3]:='';
         prz[4]:=do_p[2];
         prz[5]:=do_p[3];
         prz[6]:=__walp
         ;~~}
         {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
         {IF: PARAM_W.WALH<>'H'}
            {
            ll:=lineleft();
            _f:=prn1+'.ini_line()'; _v:=($(_f))();
            _f:=prn1+'.length()'; _v:=($(_f))();
            ll<(rsep+_v) & ll<>0
            ;~~}
            {WHILE: _f:=prn1+'.next()'; ($(_f))()}
            {DO}
               {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
            {OD}
         {FI}
         {IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
            {
            {? PARAM_W.WALH<>'H' || prz[1]:='' ?};
            prz[2]:=do_p[4];
            prz[4]:=do_p[5];
            prz[5]:=do_p[6];
            prz[6]:=__walh
            ;~~}
            {
            ll:=lineleft();
            _f:=prn1+'.ini_line()'; _v:=($(_f))();
            _f:=prn1+'.length()'; _v:=($(_f))();
            ll<(rsep+_v) & ll<>0
            ;~~}
            {WHILE: _f:=prn1+'.next()'; ($(_f))()}
            {DO}
               {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
            {OD}
         {FI}
         {SUBSTITUTE: 'LINIAF'}
         { prn1:='PRN1'; vp:=vp_tmp; rsep:=rsep_tmp; VAR_DEL.delete('vp_tmp','rsep_tmp');~~}
      {FI}
      {FONT: exec('font','param_wydr','tabhead_poz')}{SPACE: exec('space','param_wydr')}
      {SUBSTITUTE: 'TABHEAD'}
   {HEADER-}
{COMMENT}   drukowanie pozycji faktury                               {COMMENT-}
   {FONT: exec('font','param_wydr','poz')}{SPACE: exec('space','param_wydr')}
   {
   rsep:=PAR_WYDR.RSEP;
   prn1:='PRN1'; prn2:='PRN2';
   {! _ii:=1..6 |! s[_ii]:=0 !};
   sp[1]:=sp[2]:=sp[3]:=0;
   sw[1]:=sw[2]:=sw[3]:=0;
   {! _ii:=1..6 |! do_p[_ii]:=0 !}
   ;~~}
   {FOR: FAP}{INDEX: 'FAP'}{PREFIX: FAKS.ref}
   {DO}
      {
      il_lin:=0; walutowa:=PARAM_W.WALH='H'; pozycja();
      {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H') || il_lin+=2 ?};
      ~~}
      {SUBSTITUTE: 'POZYCJA'}
      {IF: __walh<>__walp & PARAM_W.WALH='T'}
         { {? PARAM_W.WALH='T' || rsep:=0 ?}; walutowa:=1; pozycja(); logr:=4; ~~}
         {IF: lineleft()<=(logr+1)}
            {bpage:=page(); ~~}
            {SUBSTITUTE: 'foot_tab'}
            {IF: bpage=page}{PAGE}{FI}
            { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
            {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
            { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); ~~}{ vp:=0; ~~}
         {FI}
         {SUBSTITUTE: 'LINIA0'}
         { rsep:=PAR_WYDR.RSEP; do_przeh(); ~~}
      {FI}
{COMMENT}   informacje dodatkowe dla pozycji                         {COMMENT-}
{COMMENT}   MOD: SITEK nie drukujemy jesli wylaczone drukowanie UWAG dla pozycji                         {COMMENT-}
      {FOR: FAKSO}{INDEX: 'FAP'}{PREFIX: FAP.ref}
      {DO}
         {FIRST}
            {
            VAR_DEL.delete('w_tmp');
            w_tmp:=obj_new(obj_len(k));
            {! _i..obj_len(k) |! w_tmp[_i]:=w[_i] !}
            ;~~}
         {FIRST-}
         { {! _i..obj_len(k) |! w[_i]:='' !};
           w[2]:={? ((FAKSO.PRN='T') & (PARAM_W.UWAGI='T')) || FAKSO.O |? FAKSO.PRN='A' || FAKSO.T+' '+FAKSO.O || '' ?};
           PRN1.ini_line();~~}
         {WHILE: _f:=prn1+'.next()'; ($(_f))()}
         {DO}
            {IF: lineleft()>0 & lineleft()<5}
               { bpage:=page(); {! _i..obj_len(k) |! w[_i]:=w_tmp[_i] !};~~}
               {SUBSTITUTE: 'foot_tab'}
               {IF: bpage=page}{PAGE}{FI}
               { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
               {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
               { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); vp:=0;~~}
            {FI}
            {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
         {OD}
         {TOTAL}
            { VAR_DEL.delete('w_tmp');~~}
      {OD}
{COMMENT}   posesja dla pozycji  {COMMENT-}
      {IF: FAKS.FPACZKA().PWP=1}
         {FOR: ZLP}{INDEX: 'FAP'}{PREFIX: FAP.ref}
         {DO}
            {FIRST}
               {
               VAR_DEL.delete('w_tmp');
               w_tmp:=obj_new(obj_len(k));
               {! _i..obj_len(k) |! w_tmp[_i]:=w[_i] !};
               VAR_DEL.delete('TAB_POS');
               TAB_POS:=tab_tmp(1,'POS','STRING[50]','POS');
               TAB_POS.index(TAB_POS.ndx_tmp(,,'POS',,))
               ;~~}
            {FIRST-}
            { {! _i..obj_len(k) |! w[_i]:='' !};
              w[2]:=ZLP.ZLE().POS().MIA().NAZ +' ul. '+ ZLP.ZLE().POS().UL().UL +' '+ ZLP.ZLE().POS().NR;
              TAB_POS.prefix(w[2]);
              {? ~TAB_POS.first()||PRN1.ini_line(); TAB_POS.POS:=w[2]; TAB_POS.add() ?}
              ;~~}
            {WHILE: _f:=prn1+'.next()'; ($(_f))()}
            {DO}
               {IF: lineleft()>0 & lineleft()<5}
                  { bpage:=page(); {! _i..obj_len(k) |! w[_i]:=w_tmp[_i] !};~~}
                  {SUBSTITUTE: 'foot_tab'}
                  {IF: bpage=page}{PAGE}{FI}
                  { _f:=prn1+'.setcolor(color)'; ($(_f))(); ~~}
                  {REP: _f:=prn1+'.fbar(lmt)'; ($(_f))()}
                  { _f:=prn1+'.setcolor(''255:255:255'')'; ($(_f))(); vp:=0;~~}
               {FI}
               {REP: _f:=prn1+'.fline(lmt)'; ($(_f))()}
            {OD}
            {TOTAL}
               { VAR_DEL.delete('w_tmp');~~}
         {OD}
      {FI}
   {OD}
   {REP: _f:=prn1+'.flbar(lmt)'; ($(_f))()}
{COMMENT}   heder po wydrukowaniu pozyji                             {COMMENT-}
   {HEADER}
   {SUBSTITUTE: 'HEADF'}
   {HEADER-}
   {
   exec('jakislsv','ustawienia',2);
   prn1:='PRN2';tmp:=k[1];
   faksxx:=faks;
   FAKS.cntx_psh();
   {? exec('rozl_na_par','faktury_zalicz',FAKS.SYMF)=1 & FAKS.seek(BB.sqlint(FAKS.SYMF),)
   || faks:=BB.refsql(FAKS.ref())
   ?};
   ~~}
   {IF: ~('TO'*ndvat) }
{COMMENT}   tabela podsumowujaca z pozycji faktury                   {COMMENT-}
      {IF: FAKS.WHERE<>'L'}
         { VAR_DEL.delete('il_stvat'); il_stvat:=exec('ilStVat','faktury_wydruk',FAKS.ref(),SLU.ref());~~}
         {FOR:'SLO'}{INDEX:'SL'}{PREFIX: SLU.ref}
         {DO}
            {FIRST}
               {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
               {<1}{
               licznik:=0;
               _ret:=__odsskr; {! _ii:=1..16 |! _ret+=({? k[_ii]<>0 & (_ii<5 | _ii>13) || k[_ii]+__odsram || 0 ?}) !}; _ret-=__odsram-__odsskr;
               tmp:=k[1];
               k[1]:=0;
               il_lin:=il_stvat+{? walutowa=1 || 5 || 3 ?};
               print2(1,1);
               lmt:=
                  {? __wydrfa.uproszcz
                  || charleft()-PRN2.width()
                  || _ret-{? vatzpoz=0 & odbrutto=1 || k1[1]+__odsram+k1[2]+__odsram |? vatzpoz=0 & ~('TO'*ndvat)|| k1[2]+__odsram+k1[3]+__odsram ?}-1
                  ?};
               ~~}
               {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
               {Text_dl:=PRN2.width();~~}
               {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
               {IF: vatzpoz=1 & __wydrfa.uproszcz=0}
                  { rsep:=0; vp:=0;~~}
               {ELSE}
                  {FONT: exec('font','param_wydr','tabhead_vat')}{SPACE: exec('space','param_wydr')}
                  {SUBSTITUTE: 'TABHEAD'}
                  { rsep:=0; vp:=1;~~}
                  {FONT: exec('font','param_wydr','vat')}
               {FI}
            {FIRST-}
            { exec('w_tym','faktury_wydruk',FAKS.ref,SLO.ref,vat,2);~~}
            {IF:vat[1]<>0 & wal_h}
               {
               licznik+=1;
               w[6]:={? k[8]=0 & licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
               w[8]:={? licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
               w[9] :=vat[1];
               w[10]:=SLO.KOD;
               w[11]:=vat[2];
               w[12]:=vat[3];
               w[13]:=(SLO.cntx_psh(); _wl:=FAP.WAL_P().KOD; SLO.cntx_pop(); _wl);
               ~~}
               {SUBSTITUTE: 'LINIA0'}
               { rsep:=0; vp:=0;~~}
            {FI}
            {TOTAL}
               {IF: licznik>0 & walutowa=1 & vatzpoz=1 & wal_h}
                  { w[6]:={? k[8]=0 || exec('tr','tlumaczenia','1000115') || '' ?};
                    w[8]:=exec('tr','tlumaczenia','1000115');
                    w[9]:={? (PARAM_W.WALH='H') || sw[1] || sp[1] ?};
                    w[10]:='';
                    w[11]:={? (PARAM_W.WALH='H') || sw[2] || sp[2] ?};
                    w[12]:={? (PARAM_W.WALH='H') || sw[3] || sp[3] ?};
                    w[13]:=(SLO.cntx_psh(); _wl:=FAP.WAL_P().KOD; SLO.cntx_pop(); _wl);
                    ~~}
                  {FONT: exec('font','param_wydr','razem')}
                  {PRN2.setcolor(color_g);~~}
                  { rsep:=1; vp:=0;~~}
                  {SUBSTITUTE: 'LINIAFSI'}
                  {FONT: exec('font','param_wydr','vat')}
                  {PRN2.setcolor(color_w);~~}
                  { rsep:=0; vp:=0;~~}
               {FI}
               {IF: licznik>0}{SUBSTITUTE: 'LINIAF'}{FI}
               { k[1]:=tmp;~~}
         {OD}
         { VAR_DEL.delete('il_stvat','Text','Text_dl');~~}
      {FI}
   {FI}
   {COMMENT}   podsumowanie pozycji                                     {COMMENT-}
   {IF: (k[9] | k[10] | k[11] | k[12])}
   {
   _ret:=__odsskr; {! _ii:=1..16 |! _ret+=({? k[_ii]<>0 & (_ii<5 | _ii>13) || k[_ii]+__odsram || 0 ?}) !}; _ret-=__odsram-__odsskr;
   print2(1,1);
   lmt:={? __wydrfa.uproszcz
   || charleft()-PRN2.width()
   || _ret-{? vatzpoz=0 & odbrutto=1 || k1[1]+__odsram+k1[2]+__odsram |? vatzpoz=0 & ~('TO'*ndvat) || k1[2]+__odsram+k1[3]+__odsram ?}-1
   ?};
   w[1]:={? PARAM_W.WALH='T' || exec('tr','tlumaczenia','1000115') || '' ?};
   w[6]:={? k[8]=0 || exec('tr','tlumaczenia','1000115') || '' ?};
   w[8]:=exec('tr','tlumaczenia','1000115');
   w[9]:=s[1];
   w[10]:='';
   w[11]:=s[2];
   w[12]:=s[3];
   w[13]:=__walp;
   vp:=0;
   rsep:=1;
   ~~}
   {FONT: exec('font','param_wydr','razem')}
   {PRN2.setcolor(color_g);~~}
   {IF: __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')}
      {IF: PARAM_W.WALH<>'H' & ~(licznik>0 & walutowa=1 & vatzpoz=1 & wal_h)}{SUBSTITUTE: 'LINIA02I'}{FI}
      {
      {? PARAM_W.WALH<>'H' || w[1]:='' ?};
      w[9]:=s[4];
      w[10]:='';
      w[11]:=s[5];
      w[12]:=s[6];
      w[13]:=__walh;
      {? PARAM_W.WALH<>'H' || vp:=0; rsep:=0; prn1:='PRN2' ?};
      ~~}
      {IF: PARAM_W.WALH<>'H'}{SUBSTITUTE: 'LINIA0'}{ELSE}{SUBSTITUTE: 'LINIA02I'}{FI}
      { {? PARAM_W.WALH='H' || vp:=0; rsep:=0; prn1:='PRN2' ?};~~}
      {SUBSTITUTE: 'LINIAF'}
   {ELSE}
      {SUBSTITUTE: 'LINIAFSI'}
   {FI}
   { rsep:=PAR_WYDR.RSEP;~~}
   {ELSE}
      {SUBSTITUTE: 'LINIAF'}
   {FI}
   {PRN2.setcolor(color_w); ~~}
   {IF: ~('TO'*ndvat) }
      {IF: FAKS.WHERE='L'}
{COMMENT}   tabela podusmowujaca dla faktury zaliczkowej             {COMMENT-}
         {FOR: FAKSV}
         {INDEX: 'FF_SV'}
         {PREFIX: '',faks}
         {DO}
            {FIRST}
               {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
               {<1}{
               licznik:=0;
               spz[1]:=spz[2]:=spz[3]:=0;
               _ret:=__odsskr; {! _ii:=1..16 |! _ret+=({? k[_ii]<>0 & (_ii<5 | _ii>13) || k[_ii]+__odsram || 0 ?}) !}; _ret-=__odsram-__odsskr;
               tmp:=k[1];
               k[1]:=0;
               il_lin:=FAKSV.size()+5;
               print2(1,1);
               lmt:=
                  {? __wydrfa.uproszcz
                  || charleft()-PRN2.width()
                  || _ret-{? vatzpoz=0 & odbrutto=1 || k1[1]+__odsram+k1[2]+__odsram |? vatzpoz=0 & ~('TO'*ndvat) || k1[2]+__odsram+k1[3]+__odsram ?}-1
                  ?};
               ~~}
               {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
               {<1}{>{charleft()-__odsskr}exec('tr','tlumaczenia','1000134')}
               {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
               {IF: __wydrfa.uproszcz=0}
               {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
               { rsep:=0; vp:=0;~~}
               {ELSE}
                  {FONT: exec('font','param_wydr','tabhead_vat')}{SPACE: exec('space','param_wydr')}
                  {SUBSTITUTE: 'TABHEAD'}
                  { rsep:=0; vp:=1;~~}
                  {FONT: exec('font','param_wydr','vat')}
               {FI}
            {FIRST-}
            {
            licznik+=1;
            w[6]:='';
            w[7]:='';
            w[8]:='';
            spz[1]+=w[9] :=FAKSV.WN_Z;
            spz[2]+=w[11]:=FAKSV.WV_Z;
            w[10]:=FAKSV.SV().KOD;
            spz[3]+=w[12]:=FAKSV.WB_Z;
            w[13]:=FAP.WAL_P().KOD;
            ~~}
            { rsep:=0; vp:=0;~~}
            {SUBSTITUTE: 'LINIA0'}
            { vp:=0;~~}
            {TOTAL}
               {IF: licznik>0}
                  {SUBSTITUTE: 'LINIAF'}
                  { w[6]:={? k[8]=0 || exec('tr','tlumaczenia','1000115') || '' ?};
                    w[8]:=exec('tr','tlumaczenia','1000115');
                    w[9]:=spz[1];
                    w[10]:='';
                    w[11]:=spz[2];
                    w[12]:=spz[3];
                    w[13]:=FAP.WAL_P().KOD;~~}
                  {FONT: exec('font','param_wydr','razem')}
                  {PRN2.setcolor(color_g);~~}
                  { rsep:=1; vp:=0;~~}
                  {SUBSTITUTE: 'LINIAFSI'}
                  {FONT: exec('font','param_wydr','vat')}
                  {PRN2.setcolor(color_w);~~}
                  { rsep:=0; vp:=0;~~}
               {FI}
               {SUBSTITUTE: 'LINIAF'}
         {OD}
      {FI}
      {IF: exec('czy_end','faktury_zalicz')}
{COMMENT}   tabela podsumowujaca dla faktury rozliczajacej zaliczke  {COMMENT-}
         {VAR_DEL.delete('txt');~~}
         {FOR: FAKSV}
         {INDEX: 'FF_SV'}
         {PREFIX: '',faks}
         {DO}
            {FIRST}
               {FONT: exec('font','param_wydr','vat')}{SPACE: exec('space','param_wydr')}
               {<1}{
               licznik:=0;
               sp[1]:=sp[9]:=sp[11]:=sp[12]:=0;
               il_lin:=FAKSV.size()+{? walutowa=1 || 5 || 3 ?};
               txt:=exec('tr','tlumaczenia','1000135');
               delta:=+txt+lmt+1-charleft(); {? delta<0 || delta:=0 ?};
               ~~}
               {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
               {<{lmt+1-delta}}{txt}
               {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
            {FIRST-}
            {
            licznik+=1;
            w[1]:='';
            w[6]:={? k[8]=0 & licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
            w[8]:={? licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
            vp:=0;
            w[12]:=FAKSV.WB_R;
            w[9] :=FAKSV.WN_R;
            w[10]:=FAKSV.SV().KOD;
            w[11]:=FAKSV.WV_R;
            sp[1]+=1;
            sp[9]+=w[9];
            sp[11]+=w[11];
            sp[12]+=w[12];
            w[13]:=KSTE.WAL().KOD;
            ~~}
            { rsep:=0; vp:=0;~~}
            {SUBSTITUTE: 'LINIA0'}
         {OD}
         {IF: licznik>0}{SUBSTITUTE: 'LINIAF'}{FI}
         {IF: sp[1]>0}
            {
               w[6]:={? k[8]=0 || exec('tr','tlumaczenia','1000115') || '' ?};
               w[8]:=exec('tr','tlumaczenia','1000115');
               w[9]:=sp[9];
               w[10]:='';
               w[11]:=sp[11];
               w[12]:=sp[12];
               w[13]:=KSTE.WAL().KOD;
            ~~}
            {FONT: exec('font','param_wydr','razem')}
            {PRN2.setcolor(color_g);~~}
            { rsep:=1; vp:=0;~~}
            {SUBSTITUTE: 'LINIAFSI'}
            {FONT: exec('font','param_wydr','vat')}
            {PRN2.setcolor(color_w);~~}
            { rsep:=0; vp:=0;~~}
            {SUBSTITUTE: 'LINIAF'}
         {FI}
         {IF: walutowa}
            {FOR: FAKSV}
            {INDEX: 'FF_SV'}
            {PREFIX: '',faks}
            {DO}
               {FIRST}
                  {licznik:=0;sp[1]:=sp[9]:=sp[11]:=sp[12]:=0;~~}
                  {IF: var_press('txt')<=0}
                     {<1}{
                     il_lin:=FAKSV.size()+{? walutowa=1 || 5 || 3 ?};
                     txt:=exec('tr','tlumaczenia','1000135');
                     delta:=+txt+lmt+1-charleft(); {? delta<0 || delta:=0 ?};
                     ~~}
                     {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
                     {<{lmt+1-delta}}{txt}
                     {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
                  {FI}
               {FIRST-}
               {
               licznik+=1;
               w[1]:='';
               w[6]:={? k[8]=0 & licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
               w[8]:={? licznik=1 || exec('tr','tlumaczenia','1000132') || '' ?};
               vp:=0;
               w[12]:=FAKSV.WW-FAKSV.WW_Z;
               _sv:=(#((FAKSV.SV().KOD*'%')+FAKSV.SV().KOD-1))*0.01;
               {? 0
               ||
"--todo: przełączyć po uzupełnieniu wartości pól w transferze i obsłudze w algorytmach wyliczania--";
                  _wwn:=FAKSV.WWN;
                  _wwn_z:=FAKSV.WWN_Z
               ||
"--                  _wwn:=(FAKSV.WW/(1+_sv))$2--";
"--                  _wwn_z:=(FAKSV.WW_Z/(1+_sv))$2--";
                  _wwn:=exec('wwn','faktury_vat',FAKS.ref(),FAKSV.SV);
                  _wwn_z:=exec('wwn_z','faktury_vat',FAKSV.FAKS,FAKSV.SV().KOD,_sv,2)
               ?};
               w[9] :=_wwn-_wwn_z;
               w[10]:=FAKSV.SV().KOD;
               _wwv:=FAKSV.WW-_wwn;
               _wwv_z:=FAKSV.WW_Z-_wwn_z;
               w[11]:=(_wwv-_wwv_z)$2;
               sp[1]+=1;
               sp[9]+=w[9];
               sp[11]+=w[11];
               sp[12]+=w[12];
               w[13]:=FAKSV.WAL().KOD;
               ~~}
               {SUBSTITUTE: 'LINIA0'}
            {OD}
            {IF: licznik>0}{SUBSTITUTE: 'LINIAF'}{FI}
            {IF: sp[1]>0}
               {
                  w[6]:={? k[8]=0 || exec('tr','tlumaczenia','1000115') || '' ?};
                  w[8]:=exec('tr','tlumaczenia','1000115');
                  w[9]:=sp[9];
                  w[10]:='';
                  w[11]:=sp[11];
                  w[12]:=sp[12];
                  w[13]:=FAKSV.WAL().KOD;
               ~~}
               {FONT: exec('font','param_wydr','razem')}
               {PRN2.setcolor(color_g);~~}
               { rsep:=1; vp:=0;~~}
               {SUBSTITUTE: 'LINIAFSI'}
               {FONT: exec('font','param_wydr','vat')}
               {PRN2.setcolor(color_w);~~}
               { rsep:=0; vp:=0;~~}
               {SUBSTITUTE: 'LINIAF'}
            {FI}
         {FI}
         {VAR_DEL.delete('txt');~~}
      {FI}
   {FI}
   {
   k[1]==tmp; VAR_DEL.delete('tmp')
   ;~~}
{COMMENT}   kwota do zapłaty wstepnie                                {COMMENT-}
   {
   fk_roz:=0;
   kw_vat:=0;
   {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
   ||
      {? ('TO'*ndvat)
      || kw_fak:=s[4]
      || kw_fak:=s[6]
      ?};
      {? exec('sp_active','faktury_wspolne',FAKS.DW) & FAKS.SP_WYM='T'
      ||
         FAPOW.cntx_psh();
         FAPOW.index('END_K');
         FAPOW.prefix($FAKS.ref(),'N');
         _roz:=FAPOW.first();
         FAPOW.cntx_pop();
         kw_fak:=0;
         _obj:=exec('obj_fv_sp','dok_fks_aut_dok');
         _obj.create($FAKS.ref());
         _Faksv:=_obj.tab;
         _loop:=_Faksv.first();
         {!
         |? _loop
         |!
            kw_fak+={? FAKS.WHERE='L' || _Faksv.WWN_Z |? _roz || _Faksv.WWN_R || _Faksv.WWN ?};
            kw_vat+={? FAKS.WHERE='L' || _Faksv.WV_Z |? _roz || _Faksv.WV_R || _Faksv.WV ?};
            _loop:=_Faksv.next()
         !}
      ?}
   ||
      {? FAKS.WHERE='L'
      ||
         {? ~('TO'*ndvat)
         || kw_fak:=spz[3]
         || FAKSV.index('FF_SV');
            FAKSV.prefix('',faks);
            {? FAKSV.first
            ||
              kw_fak:=0;
              {!
               |? kw_fak+=FAKSV.WB_Z;
                  FAKSV.next
               !}
            ?}
         ?}
      |? exec('czy_end','faktury_zalicz')
      ||
         {? ~('TO'*ndvat)
         || kw_fak:=sp[12]
         || FAKSV.index('FF_SV');
            FAKSV.prefix('',faks);
            {? FAKSV.first
            ||
              kw_fak:=0;
              {!
               |? kw_fak+=FAKSV.WB_R;
                  FAKSV.next
               !}
            ?}
         ?}
      ||
         {? ('TO'*ndvat)
         || kw_fak:=sp[1]
         || kw_fak:=sp[3]
         ?}
      ?}
   ?};
   zal:=0;
   lmt:=lmt_org;
   ~~}
{COMMENT}   powiazane zaliczki                                       {COMMENT-}
   {IF: FAKS.WHERE='L'}
      {
      FAPOW.index('FAKS_K');
      FAPOW.prefix(faks,'N');
      {? FAPOW.first()
      ||
         "szuka powiazanych";
         {? var_pres('X_FAPOW')>=100 || obj_del(X_FAPOW) ?};
         _qq:="
            select distinct
               FAPOW.FAKS_SYM as FAKS_SYM,
               to_string(FAPOW.DW) as DW,
               FAPOW.KW_PO_K as KW,
               FAPOW.WAL as WAL,
               FAPOW.FAKS as REF,
               'N' as CANCEL
            from
               FAPOW
            where
               FAPOW.F=':_a'
               and FAPOW.FAKS_SYM<>':_b'
               and FAPOW.KH=:_c
               and FAPOW.WAL=':_d'
               and FAPOW.KOREKTA='N'
               and FAPOW.AKC='T'
               and FAPOW.POZ<:_e
         ";
         X_FAPOW:=sql($_qq,FAPOW.F,FAPOW.FAKS_SYM,FAPOW.KH,FAPOW.WAL,FAPOW.POZ)
      ?}
      ;~~}
      {FOR: X_FAPOW}
      {DO}
         {FIRST}
            {<{lmt+1}}{FONT: exec('font','param_wydr','powzal_nag')}{exec('tr','tlumaczenia','1000136')+' '}
         {FIRST-}
         { {? exec('FindAndGet','#table',FAKS,X_FAPOW.REF,,"STAT_REJ",'N')='A'
           || X_FAPOW.CANCEL='T';
              X_FAPOW.put(1)
           ?};
         ~~}
         {<{lmt+5}
            }{FONT: exec('font','param_wydr','powzal_1')}{form(X_FAPOW.FAKS_SYM)
            }{FONT: exec('font','param_wydr','powzal_2')}{' '}{exec('tr','tlumaczenia','1000127')
            }{FONT: exec('font','param_wydr','powzal_3')}{' '}{form($X_FAPOW.DW)
            }{FONT: exec('font','param_wydr','powzal_4')}{', '}{exec('tr','tlumaczenia','1000137')
            }{FONT: exec('font','param_wydr','powzal_5')}{' '}{form(X_FAPOW.KW,,2,'.,')
            }{FONT: exec('font','param_wydr','powzal_6')}{' '}{X_FAPOW.WAL
             +{? X_FAPOW.CANCEL='T' || ' - '+exec('tr','tlumaczenia','1000215') || '' ?}}
      {OD}
      {<{lmt+1}
         }{FONT: exec('font','param_wydr','kwzal_tr')}{exec('tr','tlumaczenia','1000137')
         }{FONT: exec('font','param_wydr','kwzal_war')}{' '}{form(FAKS.KW_ZAL,,2,'.,')
         }{FONT: exec('font','param_wydr','kwzal_wal')}{' '}{__walh}
      { {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H') & (exec('sp_active','faktury_wspolne',FAKS.DW)=0 | FAKS.SP_WYM<>'T') || kw_fak:=FAKS.KW_ZAL ?};~~}
   {FI}
{COMMENT}   rozliczone zaliczki                                      {COMMENT-}
   { FAKSV.cntx_psh;~~}
   {FOR: FAPOW}
   {INDEX: 'END_K'}
   {PREFIX: faks,'N'}
   {DO}
      {FIRST}
         { fk_roz:=1; ~~}
         {<{lmt+1}}{FONT: exec('font','param_wydr','rozzal_nag')}{exec('tr','tlumaczenia','1000138')+' '}
      {FIRST-}
      {<{lmt+5}
         }{FONT: exec('font','param_wydr','rozzal_1')}{form(FAPOW.FAKS_SYM)
         }{FONT: exec('font','param_wydr','rozzal_2')}{' '}{exec('tr','tlumaczenia','1000127')
         }{FONT: exec('font','param_wydr','rozzal_3')}{' '}{form($FAPOW.DW)
         }{FONT: exec('font','param_wydr','rozzal_4')}{', '}{exec('tr','tlumaczenia','1000137')
         }{FONT: exec('font','param_wydr','rozzal_5')}{' '}{form(FAPOW.KW_ROZ,,2,'.,')
         }{FONT: exec('font','param_wydr','rozzal_6')}{' '}{FAPOW.WAL
          +{? exec('FindAndGet','#table',FAKS,FAPOW.FAKS,,"STAT_REJ",'N')='A' || ' - '+exec('tr','tlumaczenia','1000215') || '' ?}}
      {IF: __walh<>__walp & ~('TO'*ndvat)}
         { FAKSV.use('faksv'+(8+FAPOW.FAKS+3));~~}
         {FOR: FAKSV}
         {INDEX: 'FAPOW_SV'}
         {PREFIX: $FAPOW.ref}
         {DO}
            {FONT: exec('font','param_wydr','rozzal_narod')}
            {FIRST}
               {print2(1,1,1);~~}
               { il_lin:=FAKSV.size()+3;~~}
               {IF: lineleft()>0 & lineleft()<il_lin}{PAGE}{FI}
               {<{lmt+5}exec('tr','tlumaczenia','1000132')+' '+FAKS.NWAL().KOD+' '+exec('tr','tlumaczenia','1000158')+' '+form(FAKSV.KRS_ZAL,,4)}
               {lmt:=5; rsep:=vp:=0;~~}
               {REP: _f:=prn1+'.fhbar(lmt)'; ($(_f))()}
            {FIRST-}
            {
            w[9]:=FAKSV.WN_Z;
            w[10]:=FAKSV.SV().KOD;
            w[11]:=FAKSV.WV_Z;
            w[12]:=FAKSV.WB_Z;
            w[13]:=FAKS.NWAL().KOD
            ;~~}
            {<1}{SUBSTITUTE: 'LINIA0'}
            {TOTAL}
               {SUBSTITUTE: 'LINIAF'}
         {OD}
      {FI}
      { {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H') & (exec('sp_active','faktury_wspolne',FAKS.DW)=0 | FAKS.SP_WYM<>'T') || kw_fak-=FAPOW.KW_ROZ ?};~~}
   {OD}
   { FAKSV.cntx_pop;~~}
{COMMENT}   platnosci                                                {COMMENT-}
   {  fp_tr:=fp_war:=tp_tr:=tp_war:=wp_tr:=wp_war:=wp_wal:=slownie:='';
      FAKSPL.cntx_psh();
      FAKSPL.use((5+FAKSPL.name())+(ref_name(FAKS.ref())+3));
      FAKSPL.index('FAKS');
      FAKSPL.prefix(FAKS.ref());
      pl_size:=(FAKSPL.size()<>1);
      FAKSPL.cntx_pop();
      ~~
   }
   {FOR: FAKSPL}
   {INDEX: 'FAKS'}
   {PREFIX: FAKS.ref}
   {DO}
      {FIRST}
      {LINE}
      {
      dr_termplat:=
         FAKS.PLISTA='T'
         | exec('do_zaplaty','faktury_plat',FAKS.ref(),__walh,__walp,PARAM_W.WALH,ndvat)<>exec('war_got','faktury_plat');
      ~~
      }
      {FIRST-}
      {IF: FAKSPL.WAR}
         {<{5}}{
         _tlumacz:={? PARAM_W.JEZYK=null || '' || exec('trans_slo','tlumaczenia',FAKSPL.PL,PARAM_W.JEZYK) ?};
         fp_tr:=exec('tr','tlumaczenia','1000121')+' ';
         fp_war:=
            {? PARAM_W.JEZYK<>null & _tlumacz<>''
            || _tlumacz
            || FAKSPL.PL().TR
            ?};
         {? dr_termplat
         || tp_tr:=exec('tr','tlumaczenia','1000124');
            tp_war:=' '+gsub(form(FAKSPL.TERMPLAT,,3),'/','-');
            wp_tr:='';
            wp_war:='';
            wp_wal:='';

            ZR_SLO.cntx_psh();
            ZR_SLO.index('SLO_NR');
            ZR_SLO.prefix();
            {? ZR_SLO.find_key(FAKSPL.PL,7)
            || {? ZR_SLO.WAR ='N'|| tp_tr:=tp_war:='' ?}
            ?};
            ZR_SLO.cntx_pop();

            {? exec('sp_active','faktury_wspolne',FAKS.DW) & FAKS.SP_WYM='T'
            ||
               ~~

            |? FAKS.NWAL=INFO.NAROD
                  |
               FAKS.WAL=FAKS.NWAL
            ||
               wp_tr:={? tp_war<>'' || ', '|| '' ?} +exec('tr','tlumaczenia','1000125');
               wp_war:=' '+form(FAKSPL.WAR,,2,'.,');
               wp_wal:=' '+__walh
            ?}
         || tp_tr:=tp_war:=wp_tr:=wp_war:=wp_wal:=''
         ?};
         odstep:=charleft()-(+fp_tr)-(+fp_war)-(+tp_tr)-(+tp_war)-(+wp_tr)-(+wp_war)-(+wp_wal);
         odstep:={? odstep>0 || ' '*odstep || ' ' ?};
         ~~}
         {IF: pl_size}
         {<{5}
            }{FONT: exec('font','param_wydr','fp_tr')}{fp_tr
            }{FONT: exec('font','param_wydr','fp_war')}{fp_war
            }{FONT: exec('font','param_wydr','fp_ods')}{odstep
            }{FONT: exec('font','param_wydr','tp_tr')}{tp_tr
            }{FONT: exec('font','param_wydr','tp_war')}{tp_war
            }{FONT: exec('font','param_wydr','wp_tr')}{wp_tr
            }{FONT: exec('font','param_wydr','wp_war')}{wp_war
            }{FONT: exec('font','param_wydr','wp_wal')}{wp_wal}
         {FI}
{COMMENT}   Wtyczka dla paczek                                               {COMMENT-}
            {IF: FAKS.FPACZKA().TN<>''}
               {FONT: exec('font','param_wydr','fp_tr')}
               {<{lmt+1}FAKS.FPACZKA().TN+' w okresie od '+$FAKS.FPACZKA().OD+' do '+$FAKS.FPACZKA().DO}
            {FI}
      {FI}
      {TOTAL}
      { VAR_DEL.delete('dr_termplat'); ~~}
   {OD}
{COMMENT}   do zapłaty                                               {COMMENT-}
   {
   lmt:=lmt_org;
   char2cut:=0;
   __walprn:=__walp;
   {? PARAM_W.WALH='T' | PARAM_W.WALH='H'
   ||
      {? __walh<>__walp & (PARAM_W.WALH='T' | PARAM_W.WALH='H')
            |
         __walh<>INFO.NAROD().KOD
      ||
         __walprn:=__walh
      ?}
   ?};
   ~~}
   {IF: FAKS.WHERE<>'L' & FAKS.KW_ZAL}
      {
      {? __walh<>__walp & PARAM_W.WALH='N'
      ||
         _walj:=exec('FindInSet','#table','WAL','WAL_SYM',FAKS.WAL().KOD,,"WAL.J",,,1);
         kw_fak-=((FAKS.KW_ZAL*FAKS.KRS/_walj)$2)
      ||
         kw_fak-=FAKS.KW_ZAL
      ?};
      ~~}
      {IF: FAKS.DA_ZAL<>date(0,0,0)}
         {<{lmt+1}
            }{FONT: exec('font','param_wydr','kwzal1_tr')}{exec('tr','tlumaczenia','1000137')+' '
            }{FONT: exec('font','param_wydr','kwzal1_war')}{form(FAKS.KW_ZAL,,2,'.,')
            }{FONT: exec('font','param_wydr','kwzal1_wal')}{' '+__walprn+' '
            }{FONT: exec('font','param_wydr','kwzal1_da_tr')}{exec('tr','tlumaczenia','1000127')+' '
            }{FONT: exec('font','param_wydr','kwzal1_da_war')}{form(FAKS.DA_ZAL)}
      {ELSE}
         {<{lmt+1}
            }{FONT: exec('font','param_wydr','kwzal1_tr')}{exec('tr','tlumaczenia','1000137')+' '
            }{FONT: exec('font','param_wydr','kwzal1_war')}{form(FAKS.KW_ZAL,,2,'.,')
            }{FONT: exec('font','param_wydr','kwzal1_wal')}{' '+__walprn}
      {FI}
   {FI}
   {IF: kw_vat=0}
      {
         wp_tr:=exec('tr','tlumaczenia',{? (FAKS.T().ZAL='T' | (FAKS.PLISTA='N' & kw_fak=exec('war_got','faktury_plat') & kw_fak<>0)) & FAKS.DW=FAKS.TZ || '1000214' || '1000139' ?});
         wp_war:=form(kw_fak,,2,'.,');
         wp_wal:=' '+__walprn;
         ~~
      }
   {ELSE}
      {
         wp_tr:=exec('tr','tlumaczenia',{? (FAKS.T().ZAL='T' | (FAKS.PLISTA='N' & kw_fak=exec('war_got','faktury_plat') & kw_fak<>0)) & FAKS.DW=FAKS.TZ || '1000214' || '1000139' ?});
         wp_war:=form(kw_fak,,2,'.,');
         wp_war+=' '+__walprn;
         wp_war+=' '+exec('tr','tlumaczenia','1000217')+' '+form(kw_vat,,2,'.,');
         wp_war+=' '+__walp;
         ~~
      }
   {FI}
   {
      {? FAKS.SKID_RBK<>null() & ~exec('rbkvat_drukuj','faktury_wydruk')
      ||
            SKID_RBK.cntx_psh();
            B.cntx_psh();
            bank_tr:=exec('tr','tlumaczenia','1000220');
            bank_war:=FAKS.SKID_RBK().BANK().NB;
            STR.split(bank_war);
            rach_tr:=exec('tr','tlumaczenia','1000221');
            exec('RB','object');
            rach_war:=exec('rb_prefix','faktury_wydruk')+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO);
            swift_tr:=exec('tr','tlumaczenia','1000114');
            swift_war:=FAKS.SKID_RBK().BANK().SWIFT;
            SKID_RBK.cntx_pop();
            B.cntx_pop()
      || bank_tr:=bank_war:=rach_tr:=rach_war:=swift_tr:=swift_war:='';STR.split('')
      ?};
      grey_line:=+fp_tr;
      {? +grey_line<+fp_war||grey_line:=+fp_war?};
      {? +grey_line<+tp_tr||grey_line:=+tp_tr?};
      {? +grey_line<+tp_war||grey_line:=+tp_war?};
      grey_line+=12;
   ~~}
   {IF: PARAM_W.SLOWNIE='T'}
      {
         slownie:=exec('slownie','tlumaczenia',kw_fak,__walprn);
         {? slownie=''
         || slownie:=
               {? __walprn=INFO.NAROD().KOD
               || STR.kwota_sł(kw_fak)
               || STR.słownie(kw_fak)+{? frac(kw_fak) ||' '+$(#(form(kw_fak,,2)+2))+'/100'||''?}+' '+__walprn
               ?}+
               {? kw_vat=0
               || ''
               || ' '+exec('tr','tlumaczenia','1000217')+' '+
                  {? __walp=INFO.NAROD().KOD
                  || STR.kwota_sł(kw_vat)
                  || STR.słownie(kw_vat)+{? frac(kw_vat) ||' '+$(#(form(kw_vat,,2)+2))+'/100'||''?}+' '+__walp
                  ?}
               ?}
         ?};
         slownie:=(~(1+slownie))+(1-slownie);
         ~~
      }
   {FI}
   {
   VAR_DEL.delete('char2cut','__walprn');
   FAKS.cntx_pop();
   faks:=faksxx;
   VAR_DEL.delete('faksxx','kw_vat');
   ~~}
{COMMENT}   czyszczenie etykiet jeśli nie mają wartości {COMMENT-}
   { {? pl_size      || fp_war:=''; tp_war:='' ?};
     {? fp_war=''    || fp_tr:=''   ?};
     {? tp_war=''    || tp_tr:=''   ?};
     {? bank_war=''  || bank_tr:='' ?};
     {? rach_war=''  || rach_tr:='' ?};
     {? swift_war='' || swift_tr:=''?};

     line_sign:='│';
     {? fp_war='' & tp_war=''
     || line_sign:='';
        grey_line:=0
     ?};
   ~~}
{COMMENT}   rysowanie paska z danymi {COMMENT-}
   {SUBSTITUTE: 'panel_platnosci'}
{COMMENT}   mechanizm podzielonej płatności                          {COMMENT-}
   {FONT: exec('font','param_wydr','mpp')}{SPACE: exec('space','param_wydr')}
   {  SLU.cntx_psh(); SLO.cntx_psh(); ~~}
   {IF: exec('sp_active','faktury_wspolne',FAKS.DW) & FAKS.SP_WYM='T'}
      {
      Text1:='';
      Text2:='';
      {? FAKS.WHERE<>'L' & fk_roz=0
            &
         FAKS.SP_WAR
            &
         FAKS.SP_WAR<>FAKS.BRUTTO
            &
         FAKS.T().VATZPOZ='T'
      ||
         {? 0& FAKS.WAL<>FAKS.NWAL
         ||
            FAPOW.cntx_psh();
            FAPOW.index('END_K');
            FAPOW.prefix($FAKS.ref(),'N');
            _roz:=FAPOW.first();
            FAPOW.cntx_pop();
            FAKS.cntx_psh();
            FAKS.SP_NET:=0;
            FAKS.SP_VAT:=0;
            FAKS.SP_WAR:=0;
            _obj:=exec('obj_fv_sp','dok_fks_aut_dok');
            _obj.create($FAKS.ref());
            _Faksv:=_obj.tab;
            _loop:=_Faksv.first();
            {!
            |? _loop
            |!
               {? _Faksv.SP_WYM='T'
               ||
                  FAKS.SP_NET+={? FAKS.WHERE='L' || _Faksv.WWN_Z |? _roz || _Faksv.WWN_R || _Faksv.WWN ?};
                  FAKS.SP_VAT+={? FAKS.WHERE='L' || _Faksv.WWV_Z |? _roz || _Faksv.WWV_R || _Faksv.WWV ?};
                  FAKS.SP_WAR+={? FAKS.WHERE='L' || _Faksv.WW_Z || _Faksv.WW-_Faksv.WW_Z ?}
               ?};
               _loop:=_Faksv.next()
            !};
            SLO.cntx_psh();
            _waln:=FAKS.NWAL().KOD;
            SLO.cntx_pop();
            Text1:=
               ' ('+
               exec('tr','tlumaczenia','1000189')+': '+form(FAKS.SP_NET,,2,'.,')+' '+_waln+'; '+
               exec('tr','tlumaczenia','1000191')+': '+form(FAKS.SP_VAT,,2,'.,')+' '+_waln+'; '+
               exec('tr','tlumaczenia','1000192')+': '+form(FAKS.SP_WAR,,2,'.,')+' '+_waln+
               ')';
            FAKS.cntx_pop()
         ?};
         SLO.cntx_psh();
         _wal:=FAKS.NWAL().KOD;
         SLO.cntx_pop();
         Text2:=
            '('+
            exec('tr','tlumaczenia','1000189')+': '+form(FAKS.SP_NET,,2,'.,')+' '+_wal+'; '+
            exec('tr','tlumaczenia','1000191')+': '+form(FAKS.SP_VAT,,2,'.,')+' '+_wal+'; '+
            exec('tr','tlumaczenia','1000192')+': '+form(FAKS.SP_WAR,,2,'.,')+' '+_wal+
            ')'
      ?};
      ~~}
      {<1}{LINE}
      {<1}{<{lmt}}{'* - '+exec('tr','tlumaczenia','1000170')}{FONT: exec('font','param_wydr','T8G')}{' '+Text2}
      {IF: Text1<>''}
         {<1}{<{lmt}}{FONT: exec('font','param_wydr','T8G')}{Text1}
      {FI}
   {FI}
   { VAR_DEL.delete('fk_roz'); ~~}
{COMMENT}   rachunki bankowe - tylko jeśli podany FAKS.VSKIDRBK   {COMMENT-}
   {IF: exec('rbkvat_drukuj','faktury_wydruk')}
      {IF: +FAKS.VNB}
         {<1}{LINE}
         {IF: +FAKS.NB}
            {ENTIRE}
            {<1}{<{lmt}}{FONT: exec('font','param_wydr','T8G')}{(exec('tr','tlumaczenia','1000109')-1)+' '+__walh+':'}
            {<1}{<{lmt}}{FAKS.NB}
            {<1}{<{lmt}}{FONT: exec('font','param_wydr','T10B')}{
               exec('rb_prefix','faktury_wydruk')+RB.get_rbtx(3,FAKS.RBK,FAKS.SKID_RBK().KRAJ().KODISO)}
            {IF: (FAKS.T().EXPORT='T' | FAKS.T().UE='T') & +FAKS.SKID_RBK().BANK().SWIFT}
               {<1}{<{lmt}}{FONT: exec('font','param_wydr','T8GB')}{exec('tr','tlumaczenia','1000114')+' '+FAKS.SKID_RBK().BANK().SWIFT}
            {FI}
            {ENTIRE-}
         {FI}
         {ENTIRE}
         {<1}{<{lmt}}{FONT: exec('font','param_wydr','T8G')}{(exec('tr','tlumaczenia','1000109')-1)+' '+__walp+':'}
         {<1}{<{lmt}}{FAKS.VNB}
         {<1}{<{lmt}}{FONT: exec('font','param_wydr','T10B')}{
            exec('rb_prefix','faktury_wydruk','vskid_rbk')+RB.get_rbtx(3,FAKS.VRBK,FAKS.VSKIDRBK().KRAJ().KODISO)}
         {IF: (FAKS.T().EXPORT='T' | FAKS.T().UE='T') & +FAKS.VSKIDRBK().BANK().SWIFT}
            {<1}{<{lmt}}{FONT: exec('font','param_wydr','T8GB')}{exec('tr','tlumaczenia','1000114')+' '+FAKS.VSKIDRBK().BANK().SWIFT}
         {FI}
         {ENTIRE-}
      {FI}
   {FI}
   {  SLU.cntx_pop(); SLO.cntx_pop(); ~~}
{COMMENT}   informacje dodatkowe pod dokumentem                        {COMMENT-}
   {SPACE: exec('space','param_wydr')}
   {FONT: exec('font','param_wydr','inf_dod')}
   {FOR: S_GD}
   {PREFIX: 'D'}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {SUBSTITUTE: 'inf_dod'}
   {OD}
{COMMENT}   podmioty                                                 {COMMENT-}
   {SUBSTITUTE: 'podmioty'}
   {ENTIRE}
{COMMENT}   opis stawki odwrotne obciążenie                          {COMMENT-}
   {SPACE: exec('space','param_wydr')}
   {FONT: exec('font','param_wydr','inf_dod')}
   {  SLU.cntx_psh(); SLO.cntx_psh(); ~~}
   {IF:
      ndvat<>'O' & __oo
      &  (
            SLU.index('NAZ');
            SLO.index('SL');
            SLU.prefix();
            SLU.find_key('~STAWKI VAT '+KSTE.KRAJ().KOD);
            SLO.prefix(SLU.ref,' -o');
            SLO.first()
         )
   }
      {<1}{<{lmt}}{SLO.KOD+' - '+exec('tr','tlumaczenia','1000168')}
   {FI}
   {  SLU.cntx_pop(); SLO.cntx_pop(); ~~}
{COMMENT}   tekst dla faktury uproszczonej                           {COMMENT-}
   {FONT: exec('font','param_wydr','fakupr_txt')}
   {IF: (FAKS.T().UE='T' & FAKS.DO_UE='T') | ndvat='O' }
      {LINE}
      {<{lmt+1}}{
      {? FAKS.T().UE='T' & FAKS.DO_UE='T'
      || Text:=exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000142'))+' ';
         Text+=exec('tr','tlumaczenia','1000143')
      |? ndvat='O'
      || Text:=exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000144'))
      || Text:=''
      ?};
      max_T8:=charleft()-1;
      STR.split(Text)
      ;~~}
      {WHILE: +(Text:=STR.line(max_T8))}
      {DO}
         {IF: +Text>=max_T8*0.8}
            {<{lmt+1}}{JUSTIFY}{<{lmt}>{max_T8}Text}
         {ELSE}
            {<{lmt+1}Text}
         {FI}
      {OD}
   {FI}
{COMMENT}   podstawa zwolnienia z podatku                               {COMMENT-}
   {FONT: exec('font','param_wydr','zw_pod')}
   {<{lmt+1}}{
   Text:='';
   {? FAKS.SZ='S'
   || FAKSPOLA.index('UNIK');
      FAKSPOLA.prefix(FAKS.ref());
      {? FAKSPOLA.first()
      || _sep:='';
         {? +FAKSPOLA.PZW_PRZE || Text+=FAKSPOLA.PZW_PRZE; _sep:='\n' ?};
         {? +FAKSPOLA.PZW_DUE || Text+=_sep+FAKSPOLA.PZW_DUE; _sep:='\n' ?};
         {? +FAKSPOLA.PZW_INNA || Text+=_sep+FAKSPOLA.PZW_INNA; _sep:='\n' ?};
         {?  FAKSPOLA.SAMFAK='T' || Text+=_sep+exec('tr','tlumaczenia','1000161'); _sep:='\n' ?};
         {?  FAKSPOLA.MK='T'     || Text+=_sep+exec('tr','tlumaczenia','1000231'); _sep:='\n' ?};
         {?  FAKSPOLA.USL_TUR='T'|| Text+=_sep+exec('tr','tlumaczenia','1000232'); _sep:='\n' ?};
         {?  FAKSPOLA.UDS='T'    || Text+=_sep+FAKSPOLA.UDS_OPIS; _sep:='\n' ?}
      ?}
   ?};
   max_T8:=charleft;
   STR.split(Text);
   ~~}
   {IF: +Text}{LINE}{FI}
   {WHILE: +(Text:=STR.line(max_T8-4-2))}
   {DO}
      {IF: +Text>=(max_T8-4-8)}
         {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-5}Text}
      {ELSE}
         {<{lmt+1}}{Text}
      {FI}
   {OD}
{COMMENT}   opis do faktury wg tlumaczen systemu                        {COMMENT-}
   {FONT: exec('font','param_wydr','opis_wg_tlu')}
   {ok:=0;~~}
   {WHILE: ok+=1;ok<=9}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {<{lmt+1}}{
      Text:=exec('tr','tlumaczenia','100020'+$ok,'N');
      max_T8:=charleft;
      STR.split(Text)
      ;~~}
      {WHILE: +(Text:=STR.line(max_T8-4-2))}
      {DO}
         {IF: +Text>=(max_T8-4-8)}
            {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-5}Text}
         {ELSE}
            {<{lmt+1}}{Text}
         {FI}
      {OD}
   {OD}
{COMMENT}   uwagi                                                    {COMMENT-}
   {FONT: exec('font','param_wydr','uwagi')}
   { __memo:=FAKS.memo_get('r','UWAGI'); text:='';~~}
   {IF: __memo.is_open}
      {WHILE: text:=fread(__memo); text<>'\n'}
      {DO}
         {FIRST}
         {COLOR: color_gw}
         {<1}{exec('tr','tlumaczenia','6000111')}
         {<1}{charleft()*'─'}
         {COLOR: color_bw}
         {FIRST-}
         {<{lmt+1}}{
         max_T8:=charleft-(lmt+8);
         STR.split(text);
         Text:='';
         sep:=0
         ;~~}
         {WHILE: STR.next()}
         {DO}
            { word:=STR.get_word(); sep+=1;~~}
            {IF: +Text+(+word)>=(max_T8-4-8)}
               {<{lmt+1}}{JUSTIFY}{<{lmt+1}>{max_T8-8}Text}
               { Text:=word; sep:=1;~~}
            {ELSE}
               { Text+={? sep>1 || ' ' || '' ?}+word;~~}
            {FI}
         {OD}
         {IF: +Text}
            {<{lmt+1}}{Text}
         {FI}
      {OD}
      {CENTER}
   {FI}
   { VAR_DEL.delete('__memo','text','Text');~~}
   {Text:=Plugin.run('FAKS_INFO_001'); Line:=0;~~}
   {IF: +Text}{SUBSTITUTE: 'Text_podpis'}{FI}
{COMMENT}   podpisujacy                                              {COMMENT-}
   {FONT: exec('font','param_wydr','podpisy')}
   {<1}{
   _p100223:=exec('get','#params',100223,2);
   {? var_pres('STR1')>=100 || obj_del(STR1) ?};
   STR1:=obj_new(@.CLASS.STRING);
   Text:={? _p100223='O' | _p100223='N' || exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000145')) || '' ?};
   Text1:={? _p100223='O' | _p100223='S' || exec('tr','tlumaczenia',exec('kod_aktualny','tlumaczenia','1000146')) || '' ?};
   STR.split(Text);
   STR1.split(Text1)
   ;~~}
   {WHILE: _a:=+(Text:=STR.line(((max_T8-4)/2)$0-30)); _b:=+(Text1:=STR1.line(((max_T8-4)/2)$0-30)); _a | _b}
   {DO}
      {FIRST}
         {LINE}
      {FIRST-}
      {IF: +Text | +Text1}
         {IF: +Text}{<{lmt+1}Text}{FI}{IF: +Text1}{<{((max_T8-4)/2)$0+20}Text1}{FI}
      {FI}
   {OD}
{COMMENT}   upowaznienie                                             {COMMENT-}
   {FONT: exec('font','param_wydr','upowaznienie')}
   {
   USERS.index('USR_KKOD');
   _p100223:=exec('get','#params',100223,2);
   _os:=form(exec('kh_osob_default','kontrahent',FAKS.KH));
   USERS.cntx_psh;
   USERS.index('USR_KKOD');
   USERS.prefix;
   Text:={? _p100223='O' | _p100223='N' || {? +_os || _os || 20*'.' ?} || '' ?};
   Text1:={? _p100223='O' | _p100223='S' || {? USERS.find_key(FAKS.USER,FAKS.USER) & +USERS.DANE || USERS.DANE || 20*'.' ?} || '' ?};
   USERS.cntx_pop;
   STR.split(Text);
   STR1.split(Text1)
   ;~~}
   {IF: +Text | +Text1}{LINE}{FI}
   {WHILE: _a:=+(Text:=STR.line(((max_T8-4)/2)$0-30)); _b:=+(Text1:=STR1.line(((max_T8-4)/2)$0-20)); _a | _b}
   {DO}
      {IF: +Text | +Text1}
         {IF: +Text}{<{lmt+1}Text}{FI}{IF: +Text1}{<{((max_T8-4)/2)$0+20}Text1}{FI}
      {FI}
   {OD}
   {ENTIRE-}
   {CENTER}
   { PAR_WYDR.HEAD:=head;~~}
   {HEADER}{HEADER-}
   { duplex:=page%*2=1;~~}
   {IF: lineleft()>0}{PAGE}{FI}
   {IF: BEER.SZ='S' & exec('get','#params',2124,2,OPERATOR.USER)='T' & duplex=1}
      {duplex:=2;~~}
      {PAGE}
      {duplex:=0;~~}
   {FI}
{OD}
{MACRO-}
