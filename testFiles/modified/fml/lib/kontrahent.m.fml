:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: kh.fml
:: Utworzony: 16.02.2015
:: Autor: AWI
::======================================================================================================================
:: Zawartość: Obsługa kontrahenta
::======================================================================================================================


\rozrach_kontr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [RL] [7.62]
:: OPIS: Akcja Rozrachunki w okienku WER tabeli WIND_KH
::  OLD: \windp_op/windyk.fml
::       \rozrach_kontr/!fks_roz_zark.fml
::----------------------------------------------------------------------------------------------------------------------
_par:=exec('get_w','#params',9991,type_of(''),OPERATOR.USER);
{? _par='N' | _par=' '
|| _l_kh:=exec('get_w','#params',999005,type_of(''));
   {? _l_kh*(KH.KOD+',')>0
   || FUN.info('Brak uprawnień');
      return(1)
   ?}
?};
{? SSTALE.WAL=null
|| SLO.cntx_psh(); SLO.index('SL'); SLO.prefix(XINFO.SLWAL,'PLN');
   {? SLO.first()
   || SSTALE.WAL:=SLO.ref()
   || FUN.info('Nie znaleziono waluty narodowej PLN w słowniku walut.'@)
   ?};
   SLO.cntx_pop()
?};
{? SSTALE.WAL
|| OP.cntx_psh(); ZAP_OP.cntx_psh(); ROZNE.cntx_psh(); POMOC.cntx_psh();
    _fp:={? OP.f_active=1 || OP.f_clear();1 || 0 ?};
   exec('psh_cntx','powdok');
   exec('set_rbop','rozrach_przel');
   POMOC.STAN:='';
   KONTO.K1:=ROZRACH.ZN:='';
   ROZRACH.KONTR:=_kh_ref:=KH.ref();
   exec('initree1','rozrach');
   exec('nier_op','rozrach');
   exec('sel_rozr','rozrach');
   exec('okn_grup','rozrach');
   _kod:=ROZRACH.KONTR().KOD; _ref:=null;
   {? ROZRACH.KONTR<>null & _kh_ref<>ROZRACH.KONTR
   || KH.cntx_psh(); KH.index('KOD'); KH.prefix(2,_kod);
      {? KH.first() || _ref:=KH.ref() ?};
      KH.cntx_pop();
      {? _ref<>null || KH.seek(_ref) ?}
   ?};
   {? var_pres('tabr')<=0 | ~tabr || exec('deltree1','rozrach') ?};
   OP.cntx_pop(); ZAP_OP.cntx_pop(); ROZNE.cntx_pop(); POMOC.cntx_pop();
   exec('pop_cntx','powdok');
   {? var_press('zakladka')>0 & zakladka=2 || OP.hdr_sel() ?};
   {? _fp || exec('op_przeglad1','rozrach') ?};
   VAR_DEL.delete('synt','an','se_p','kol')
?};
1


