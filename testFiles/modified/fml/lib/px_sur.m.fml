:!UTF-8
::(c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: px_sur.fml [12.30]
:: Utworzony: 2012/11/19
:: Autor: TS
::======================================================================================================================
:: Zawartość: Obsługa surowców do przepisow planistycznych - plan strategiczny - dane do bufora planu zamówień dostaw
::======================================================================================================================


\add
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [12.30]
:: OPIS: Dodanie zapisow PX_SUR do konkretnego PX_POZ
::       Kontekst pracy: rekord PX_POZ
::   WE: _a - wspolczynnik przeliczania normy na faktyczna ilosc
::----------------------------------------------------------------------------------------------------------------------
_coef:=_a;

PX_SUR.clear();
PX_MAT.index('UNIQALL');
PX_MAT.prefix(PX_POZ.PX_STAGE);
:: NUCO - stały magazyn dla surowców na planie strategicznym
_sur:=exec('get','#params',500004,2);
_mg:=exec('FindInSet','#table','MG','MAGAZYNY',_sur,_sur,,1);
:: Koniec
{? PX_MAT.first()
|| {!
   |?
      PX_SUR.blank(1);
      PX_SUR.PX_VER:=PX_POZ.PX_VER;
      PX_SUR.PX_POZ:=$PX_POZ.ref();
      PX_SUR.PX_GRP:=$PX_POZ.PX_GRP;
      PX_SUR.M:=PX_MAT.M;
      _il:=PX_MAT.IL*_coef;
      _dokl:=PX_MAT.M().DOKL;
      PX_SUR.IL:={? _dokl=0 || ceil(_il) || _il$_dokl ?};
      PX_SUR.ODDZ:=ST.ODDZ;
:: NUCO - stały magazyn dla surowców na planie strategicznym
::    PX_SUR.MG:=exec('ustmag','zl_common',,PX_MAT.M);
      PX_SUR.MG:=_mg;
:: Koniec
      PX_SUR.STARTD:=PX_POZ.PX_CUP().STARTD().DATA;
      PX_SUR.STARTT:=PX_CUP.STARTT;
      PX_SUR.ZL:=PX_MAT.ZL;
      PX_SUR.ZLIM:=PX_MAT.ZLIM;
      PX_SUR.add();

      PX_MAT.next()
   !}
?};
~~


