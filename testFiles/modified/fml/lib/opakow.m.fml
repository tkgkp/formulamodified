:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: opakow.fml [2008]
:: Utworzony: 2007-03-28
:: Autor: MZ
::======================================================================================================================
:: Zawartosc: Formuły do obsługi opakowań zwrotnych
::======================================================================================================================

\f3_mg_op
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MZ [2008]
:: OPIS: lista już istniejących magazynów opakowań
::   WE: [_a] czy funkcja Dołącz - edycja magazynów
::----------------------------------------------------------------------------------------------------------------------
VAR_DEL.delete('__mg_opak','__win_sel');
{? _>=1 || {? type_of(_a)<>1 || _a:=1 ?} || _a:=1 ?};
_oddz:=ST.ODDZ;
{? _a=1 || _oddz:=MG.ODDZ ?};
_wyn:={? 1+menu_pth()='D' || MG.MG_OPAK || '' ?};
_q_mg:=$"
select distinct
   MG.ODDZ as Oddz,
   MG.MG_OPAK as Symbol,
   'X' as X
from
   MG
where
   MG.MG_OPAK<>''
   and MG.ODDZ=':_a'
";
__mg_opak:=sql(_q_mg,_oddz);
_win_sel:=__mg_opak.mk_sel('Magazyny opakowań'@,'P',,'haotxmolphfsdss',,,,,'U');
__mg_opak.win_fld(_win_sel,,'ODDZ',,,7,,1,'Oddział'@);
__mg_opak.win_fld(_win_sel,,'SYMBOL',,,30,,,'Symbol'@);
__mg_opak.win_act(_win_sel,0,'Formuła','&Wybierz'@@,,,,"sel_exit",1,,,,'W');
{? _a=1
||
   _rek_przed:="
      {? __mg_opak.X='X'
      || __mg_opak.actions(__mg_opak.win_sel('?'),'up',,1)
      || __mg_opak.actions(__mg_opak.win_sel('?'),'',,1)
      ?};
      {? __mg_opak.ODDZ='' || __mg_opak.ODDZ:=MG.ODDZ; __mg_opak.put() ?}
   ";
   __mg_opak.win_act(_win_sel,0,'Dołącz');
   __mg_opak.win_act(_win_sel,1,'Dołącz',,,,,,1);
   __mg_opak.win_act(_win_sel,0,'Popraw');
   __mg_opak.win_act(_win_sel,0,'Usuń');
   __mg_opak.win_act(_win_sel,0,'Rekord',,,,_rek_przed,"__CHK.record(__mg_opak,,'SYMBOL')");
   __mg_opak.win_act(_win_sel,1,'Rekord',,,,,"__CHK.record(__mg_opak,,'SYMBOL')")
?};
_sel:=1;
__mg_opak.win_sel(_win_sel);
{? _a=0 & __mg_opak.first() & __mg_opak.size()=1
||
   _sel:=0;
   _wyn:=__mg_opak.SYMBOL
?};
:WW:NUCO dodano warunek kontrolujący liczbę magazynów opakowań ( nie wyświetla się okienko wertowania gdy liczba magazynów opakowań jest pusta )
{? __mg_opak.size()>0
||
   {? _sel & __mg_opak.select()
   ||
      _wyn:=__mg_opak.SYMBOL
   ?}
?};
VAR_DEL.delete('__mg_opak','__win_sel');
_wyn
