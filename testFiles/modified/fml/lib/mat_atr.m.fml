:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: mat_atr.fml [12.10]
:: Utworzony: 2011-02-24
:: Autor: Mario
::======================================================================================================================
:: Zawartość: Formuły do obsługi atrybutów dostaw oraz materiałów
::======================================================================================================================


\atr_set_partia
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [12.30]
:: OPIS: Ustawia wartosc zmiennej ATR.WARx jako symbol przekazanej partii
::   WE: _a - M_ATR.ref() - wzorzec atrybutow
::       _b - STRING - symbol partii
::   WY: 0 - porazka
::       1 - sukces
::  OLD: \atr_set_partia/zparn.fml
:: DOST: PUBLIC
::----------------------------------------------------------------------------------------------------------------------
_matr:=_a;
_part_sym:=_b;

:: NUCO - PeKa - odszukuje z rekordu partii uzupełnionego pola PD i przypisuje w tworzonym DK_C jeśli to mozliwe
_pd:=sql('select DK_C.WAR02 as PD from ZPARN join DK_C using (ZPARN.DK_C,DK_C.REFERENCE) where ZPARN.SYM=\':_a\'',_part_sym).PD;

M_ATR.cntx_psh(); M_ATR.clear();
{? M_ATR.seek(_matr)
||
   _max:=exec('il_atr','mat_atr');
   _result:=0;
:: NUCO -  dodatkowa weryfikacja do uzupelnienia PD z tabeli ZPARN (szukana nazwa atrybutu BATCH_CODE)
   {! _it:=1.._max
   |? _result=0
   |! _rule_chk:=$('M_ATR.SL_'+form(_it,-2)+'().NA');
      _rule_set:=$('ATR.WAR'+form(_it,-2)+':=_a');
      {? _rule_chk()='BATCH_CODE'
      || _rule_set(_pd);
         _result:=1
      ?}
   !};
   _result:=0;
   {! _it:=1.._max
   |? _result=0
   |! _rule_chk:=$('M_ATR.SL_'+form(_it,-2)+'().TYP');
      _rule_set:=$('ATR.WAR'+form(_it,-2)+':=_a');
      {? _rule_chk()='P'
      || _rule_set(_part_sym);
         _result:=1
      ?}
   !}
?};
M_ATR.cntx_pop();
_result


