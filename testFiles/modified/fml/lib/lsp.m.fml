:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: lsp.fml
:: Utworzony: 12.01.2015
:: Autor: mario
::======================================================================================================================
:: Zawartość: Formuły oraz wywoływacze obszaru LSP
::======================================================================================================================


\ofe_sel
::----------------------------------------------------------------------------------------------------------------------
::  UTW: Mario [2005]
:: OPIS: wyŁwietlenie ofert
::   WE: [_a] - zakres ofert - ZAKR.T
::  OLD: \ofe_sel/oferty.fml
::----------------------------------------------------------------------------------------------------------------------
{? _>=1 || {? type_of(_a)<>2 || _a:='A' ?} || _a:='A' ?};

VAR_DEL.delete('__typofe','__typz_o','__zakr_o');

_kh:=ZAKR.KH;
_han:=ZAKR.H;
ZAKR.T:=ZAKR.AKT:=_a;
ZAKR.WG:='O';
::MOD: SITEK
::ZAKR.US:=OPERATOR.USER;
ZAKR.US:=null;
ZAKR.KH:=null;
ZAKR.HAN:=null;

BEER.MW:='O';
BEER.SZ:='S';
::exec('ustaw_ww','eurusd','O');
DISP.SN_OFE:=0;
DISP.SZ_OFE:=0;

:: dostΩpne typy ofert
_p3007:=exec('get','#params',3007,2,OPERATOR.USER);

_sql:="
   select
    T, NAZ, REFERENCE REF, ' ' INF, MOB, ZAP
   from TYPYZAM
    where TYPYZAM.R='O'
    and TYPYZAM.PROJ='N'";
_sql+={? _p3007=''
      || ""
      || " and ':_a' like '% '||TYPYZAM.T||' %' "
      ?};
_sql+=" order by T, T ";
{? _p3007<>'' || _p3007:=' '+_p3007+' ' ?};
__typofe:=sql(_sql,_p3007);
:: okienko typ≤w zam≤wie±
__typz_o:=__typofe.mk_sel('Typy ofert'@,'P',0,'__typofe_win',,,,,'U','T');
__typofe.win_fld(__typz_o,,'T',,,10,,0,'Typ'@);
__typofe.win_fld(__typz_o,,'NAZ',,,32,,0,'Nazwa'@);
__typofe.win_act(__typz_o,0,'Szukaj');
__typofe.win_act(__typz_o,0,'Kolejność');

OFE.win_fml('WER',,'SYM',,'ICON_BEFORE',exec('ofe_sym_ib','lsp'));
_grp:=OFE.grp_make('GRP',,'#ofe_grpokn',,,"exec('exit','zws',_a)");

_win_grp:=OFE.grp_make('',"params_exec('oferty_be','lsp')",'oferty_grp',,,"exec('exit','zws',_a)");
OFE.grp_sel(_win_grp,__typofe,__typz_o,'Oferty'@,"exec('oferty_typ_ar','lsp')"
    ,,,10,"params_exec('oferty_typ_be','lsp')",,,,'maximized');
__typofe.win_sopt(__typz_o,'select_record_checkbox=0');
OFE.tab_splt(_win_grp,,'vertical','ofe','0, 20%');
OFE.grp_sel(_win_grp,,'WER',,,,,,,,,,'maximized','WER',1);
_before:="OFP.cntx_psh();
         {? OFE.SYM<>'' || OFP.find_key(OFE.SYM) ?}";
_after:="OFP.OFE();
         OFP.cntx_pop()";
OFE.grp_sel(_win_grp,OFP,'WER_ALL','Pozycje ofert'@,,,,,_before,_after,,,'maximized');

OFE.win_sel(_win_grp);
OFE.win_edit('RED');
exec('zakr_all','lsp');

AreaTitle.setTabWin(OFE,~~);
AreaTitle.setTitle();
OFE.select();
ZAKR.KH:=_kh;
ZAKR.HAN:=_han;
VAR_DEL.delete('__typofe','__typz_o','__zakr_o');
''


