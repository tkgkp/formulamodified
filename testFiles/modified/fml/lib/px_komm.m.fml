:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: px_komm.fml [12.30]
:: Utworzony: 2012-01-12
:: Autor: TS
::======================================================================================================================
:: Zawartosc: Obsługa komunikatów do planu
::======================================================================================================================


\add_komm
::----------------------------------------------------------------------------------------------------------------------
::  UTW: TS [12.30]
:: OPIS: Dodaje komunikat
::   WE: [_a] - _args  - argumenty funkcji wynik dzialania exec('add_komm_a','px_komm')
::   WY: 0 - komunikatu nie udalo sie dodac
::       1 - komunikat dodany
::----------------------------------------------------------------------------------------------------------------------
_args:={? _=1 || _a || exec('add_komm_a','px_komm') ?};

{? ~exec('add_komm_c','px_komm',_args) || return() ?};

:: NUCO - ograniczenie ilości komunikatów do - jednego dotyczącego danego obiektu planowanego
{? _args.TYP<>'BŁĄD' & exec('czy_add_komm','qtpp', _args) || return() ?};

_can_continue:=0;
_result:=0;

PX_KOMM.clear();
PX_KOMM.TYP:=_args.TYP;
PX_KOMM.SRC_KIND:=_args.SRC_KIND;
PX_KOMM.MESSAGE:=_args.MESSAGE;
PX_KOMM.PX_CUP:=_args.PX_CUP;
PX_KOMM.PX_GRP:=_args.PX_GRP;
PX_KOMM.PX_OBJ:=_args.PX_OBJ;
PX_KOMM.PX_VER:=_args.PX_VER;
PX_KOMM.PX_POZ:=_args.PX_POZ;
PX_KOMM.FORMULA:=_args.FORMULA;
PX_KOMM.DATE:=date();
PX_KOMM.TIME:=time();
_can_continue:=PX_KOMM.add();

{? _can_continue>0
|| _can_continue:=exec('update_src','px_komm')
?};

{? _can_continue>0
|| _result:=1
?};
_result


