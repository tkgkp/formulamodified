:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !tte_pzl_eakc.fml
:: Utworzony: 29.06.2015
:: Autor: TS
::======================================================================================================================
:: Zawartość: Formuły czynności TTE_PZL_EAKC - Akceptacja zlecenia
::======================================================================================================================




\action_accept
::----------------------------------------------------------------------------------------------------------------------
::  UTW: WH [17.00]
:: OPIS: Akcja akceptacji zlecenia z przycisku, menu
::   WY: STRING
::  TAG: <PRYWATNA>
::----------------------------------------------------------------------------------------------------------------------
_args:=exec('mp_run_a','#b__box');
_args.ACT_UID:='TTE_PZL_EAKC';
_args.UIDREF:=ZL.uidref();
_args.AKCJA:='AKCEPTUJ';
:: NUCO - uwzględnienie auto-akcept w procesie dla zleceń warsztatowych
{? ZL.sel_size()>0 | ZL.TYP().WP='W'
|| _args.GRUPA:='T';
   _args.PORTS_IN:=exec('portsIn','#b__box',_args.ACT_UID);
   exec('portsInSet','#b__box',_args.PORTS_IN,_args.ACT_UID,'ZL',ZL.ref());
   exec('mp_run','#b__box',_args)
:: NUCO - weryfikacja czy istniene nowsza (inna domyślna karta na wyrób)
|| _can_continue:=1;
   _can_continue:={? exec('is_default_tech','tech_common', ZL.KTL, ZL.KTM)
                  || 1
                  || FUN.ask('Karta technologiczna zlecenia nie jest domyślną kartą dla indeksu: %1\nCzy kontynuować akceptację zlecenia?'@[ZL.KTM().KTM])
                  ?};
 {? ZL.KTL=null()
 ||  FUN.info('Karta źródłowa zlecenia została zarchiwizowana, popraw kartę technologiczną w nagłówku zlecenia przed akceptacją.');
     _can_continue:=0
 ?};
  _ktl:=ZL.TKTL;
  {? _ktl=null()
  || _ktl:=ZL.KTL
  ?};
  {? _can_continue & (_ktl=null | ~exec('czy_fantom','qtpp',_ktl))
  || FUN.error('Karta technologiczna zawiera fantomy lub nie można jej odnaleźć, akceptacja nie jest możliwa');
     _can_continue:=0
  ?};
  {? _can_continue
  || _args.PORTS_IN:=exec('portsIn','#b__box',_args.ACT_UID);
     exec('portsInSet','#b__box',_args.PORTS_IN,_args.ACT_UID,'ZL',ZL.ref());
     exec('mp_run','#b__box',_args)
  ?}
?};
'key:Esc'



