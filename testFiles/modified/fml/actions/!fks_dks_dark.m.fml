:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !fks_dks_dark.fml
:: Utworzony: 10.03.2015
:: Autor: AMK
::======================================================================================================================
:: Zawartość: Formuły czynności FKD_DKS_DARK - Rejestracja dokumentów księgowych
::======================================================================================================================


\del_dok
::----------------------------------------------------------------------------------------------------------------------
::  UTW: AMK [17.00]
:: OPIS: Usuwanie dokumentów księgowych
::----------------------------------------------------------------------------------------------------------------------

:: NUCO - wzbudzenie procesu dekretacji z obiegu jeśli dokument pochodzi z obiegu dokumentów
_edokum:='';
{? DOK.EDOKUM<>''
|| _edokum:=DOK.EDOKUM;
   _dok:=$DOK.ref()
?};
:: KONIEC

_params:=exec('mp_run_a','#b__box');
_params.ACT_UID:='FKS_DKS_DARK';
_params.UIDREF:=DOK.uidref();
_params.AKCJA:='Usuń';
_params.PORTS_IN:=exec('portsIn','#b__box',_params.ACT_UID);
exec('portsInSet','#b__box',_params.PORTS_IN,_params.ACT_UID,'DOK',DOK.ref());
_result:=exec('mp_run','#b__box',_params);

:: NUCO weryfikacja czy dokument napewno został usunięty
{? _edokum<>''
|| {? exec('FindAndGet','#table',DOK,_dok,,"0",1)
   || _par:=obj_new(1);
      _par[1]:=obj_new('PARAMETR','VALUE');
      _par[1].PARAMETR:='EDOKUM';
      _par[1].VALUE:=exec('FindAndGet','#table',EDOKUM,DOK.EDOKUM,,"ref()",null());
      exec('force_signal','#b__box','NUCO_FIN_OBG_DEK',,_par)
   ?}
?};

_result
:: KONIEC



