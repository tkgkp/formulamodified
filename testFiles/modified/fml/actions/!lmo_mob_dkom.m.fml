:!UTF-8
:: (c) Macrologic S.A. Wszelkie prawa zastrzeżone
::======================================================================================================================
:: Nazwa pliku: !lmo_mob_dkom.fml
:: Utworzony: 19.04.2016
:: Autor: [rr]
::======================================================================================================================
:: Zawartość: Czynność LMO_MOB_DKOM - Realizacja kompletacji na podstawie operacji mobilnej
::======================================================================================================================


\autoOper
::----------------------------------------------------------------------------------------------------------------------
::  UTW: [rr] [17.00]
:: OPIS: Automatycznie realizuje operacje
::----------------------------------------------------------------------------------------------------------------------
_mp:=params_get().mp;
:: NUCO - dodanie obsługi pojedynczego EANN
_in:=params_get().in;

_il_srv:=0;

:: NUCO - obsługa pojedynczego EANN
{? (var_pres('EANN',_in)=type_of(null()) & _in.EANN)
|| _eann:=sql('select EANN.REFERENCE REF,
                      EANN.DATA DATA
                 from @EANN
                where EANN.REFERENCE = \':_a\'
                      and EANN.AKT=\'T\'
                      and EANN.TYP=\'Z\'
                      and EANN.STAN=\'Z\'
             ',$_in.EANN)
|| _eann:=sql('select '+
           '  EANN.REFERENCE REF, '+
           '  EANN.DATA DATA '+
           'from @EANN '+
           ' where EANN.REFERENCE like '+'''eann_\\_\\_%'' escape ''\\'''+
           '   and EANN.AKT=''T'''+
           '   and EANN.TYP=''Z'''+
           '   and EANN.STAN=''Z''')
?};

_eann.clear();
{? _eann.first()
|| {!
   |? _oddz:=1+(4-_eann.REF);
      _rok:=form((_eann.DATA~1)-2000,-2,0,'99');
      exec('open','open_tab',_oddz,_rok);
      {? (EANN.clear(); EANN.seek(_eann.REF)) & (_wyp:=exec('ctrlEANN','magazyn_mob','Z',1))>0
      || _il_srv+=params_exec('autooper','magazyn_mob',EANN.ref(),_wyp)
      ?};
      _eann.next()
   !};
   {? _il_srv=1
   || _internal:=_mp.load('INT');
      {? var_pres('ND',_internal)=type_of(null()) & _internal.ND
      || _mp.save(exec('kind_out','#b_port'),'ND',_internal.ND)
      ?}
   ?}
?};
obj_del(_eann);

_mp.save('OUT','IL_SRV',_il_srv);
_mp.done();
~~


