:!UTF-8
\kon_rw
{? 3+DK.N().MAG().SYM='POL' | 3+DK.N().MAG().SYM='WYR'
||'580'
|? (DK.N().MAG().SYM='WOB2' | DK.N().MAG().SYM='WOB3' | DK.N().MAG().SYM='WOB4')
|| {? (2+DK.M().KTM='02' | 2+DK.M().KTM='01' | 2+DK.M().KTM='06')
   || '580'
   |? 2+DK.M().KTM='04'
   || '501/01/03/0102'
   || ''
   ?}
|| DK.N().KK().SYM
?}

\kon_rwb
{? DK.N().KK().SYM <> ''
|| DK.N().KK().SYM
|| '550/04/0908'
?}


\km
:: do 07.2021
: utlenie knta magazynowego w zale┐noŁci od _a
:: dodanie przypadku zmiany symbolu magazynu
{? 1+_a='X'|| _a:=1-_a ?};
{? 1+_b='X'|| _b:=1-_b ?};
{? _a='MAP1' || '310/01/03'
|? _a='MAP2' || '310/02/03'
|? _a='MAT1' || '310/01/02'
|? _a='MAT2' || '310/02/02'
|? _a='MAT3' || '320/02'
|? _a='POL1' || '610/01/02'
|? _a='POL2' || '610/01/01'
|? _a='POL3' | _a='MASY_W' || '610/02/01'
|? _a='POL4' || '610/02/02'
|? _a='SUR1' || '310/01/01'
|? _a='SUR2' || '310/02/01'
|? _a='SUR3' || '320/01'
|? _a='SUR4' || '310/01/01'
|? _a='WOB1' || '606/01'
|? _a='WOB2' || {? _b='WYR1' || '606/02' |? (_b='MAT1' | DK.M().R='M' | DK.M().R='O') || '320/02' || '606/02'?}
|? _a='WOB3' || {? _b='WYR1' || '606/03' |? (_b='MAT1' | DK.M().R='M' | DK.M().R='O') || '320/02' || '606/03'?}
|? _a='WOB4' || {? _b='WYR1' || '606/04' |? (_b='MAT1' | DK.M().R='M' | DK.M().R='O') || '320/02' || '606/04'?}
|? _a='TOW1' || '330/01'
|? _a='TOW2' || '330/02'
|? _a='WYR1' || '600/01'
|? _a='WYR2' || '600/02'
|? _a='ZPP1' || '320'
|? _a='ZWP1' || '319/02'
|? 3+_a='ZAO' || ''
             || msg('UWAGA !!! \n\n BRAK KONTA DLA ARGUMENTU \n\n'+_a);''
?}


\sp_k
::----------------------------------------------------------------------------------------------------------------------
::  UTW:
:: OPIS:
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_mag:=_konto:='';
{? FAP.FAKS().T().KOR='N';1
||
   DK.cntx_psh();
   DK.index('FAP');
   DK.prefix($FAP.ref,$FAP.ref);
   {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
   DK.cntx_pop()
||
    DK.cntx_psh();
    DK.index('KOR');
    DK.prefix($FAP.ref);
    {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
    DK.cntx_pop()
?};

{? _mag='POL1' | _mag='POL4' | _mag='POL2' | _mag='POL3' | _mag='XWYR1' |  _mag='XWYR2'  | _mag='POL' | _mag='WYR'
|| _konto:='700/02/SK/23'
|? _mag='XTOW1' | _mag='XTOW2'  | _mag='TOW'
|| _konto:='730/02/SK/23'
|? _mag='XMAT1' | _mag='XMAT2' | _mag='XSUR1' | _mag='SUR2' | _mag='XSUR4' | _mag='XMAP1' | _mag='XMAP2'| _mag='MAT' | _mag='SUR' | _mag='MAP'
|| _konto:='740/02/SK/23'
|| _konto:=''
?};
{? FAKS.NDVAT='O' & _konto='' || _konto:='764/06' ?};

:: PSojda 2017-11-23 - ustalono z p. A.Switek ze dekret musi przechodzic
{? _konto='' || _konto:='???' ?};
:: Koniec
_konto


\sp_p
::----------------------------------------------------------------------------------------------------------------------
::  UTW:
:: OPIS:
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_mag:=_konto:='';
{? FAP.FAKS().T().KOR='N';1
||
   DK.cntx_psh();
   DK.index('FAP');
   DK.prefix($FAP.ref,$FAP.ref);
   {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
   DK.cntx_pop()
||
    DK.cntx_psh();
    DK.index('KOR');
    DK.prefix($FAP.ref);
   {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
   DK.cntx_pop()
?};
{? _mag='POL1' | _mag='POL4' | _mag='POL2' | _mag='POL3' | _mag='XWYR1' | _mag='XWYR2' | _mag='POL' | _mag='WYR'
|| _konto:='700/02/SK/23'
|? _mag='XTOW1' | _mag='XTOW2' | _mag='TOW'
|| _konto:='730/02/SK/23'
|? _mag='XMAT1' | _mag='XMAT2' | _mag='XSUR1' | _mag='SUR2' | _mag='XSUR4' | _mag='XMAP1' | _mag='XMAP2' | _mag='MAT' | _mag='SUR' | _mag='MAP'
|| _konto:='740/02/SK/23'
?};
{? WAR.ZN='Z' || _konto:='842' ?};

:: PSojda 2017-11-23 - ustalono z p. A.Switek ze dekret musi przechodzic
{? _konto='' || _konto:='???' ?};
:: Koniec

_konto


\sp_ue
::----------------------------------------------------------------------------------------------------------------------
::  UTW:
:: OPIS:
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_mag:=_konto:='';
{? FAP.FAKS().T().KOR='N';1
||
   DK.cntx_psh();
   DK.index('FAP');
   DK.prefix($FAP.ref,$FAP.ref);
   {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
   DK.cntx_pop()
||
   DK.cntx_psh();
   DK.index('KOR');
   DK.prefix($FAP.ref);
   {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
   DK.cntx_pop()
?};
{? _mag='POL1' | _mag='POL4' | _mag='POL2' | _mag='POL3' | _mag='XWYR1' | _mag='XWYR2' | _mag='POL' | _mag='WYR'
|| _konto:='700/02/SU/00'
|? _mag='XTOW1' | _mag='XTOW2' | _mag='TOW'
|| _konto:='730/02/SU/00'
|? _mag='XMAT1' | _mag='XMAT2' | _mag='XSUR1' | _mag='SUR2' | _mag='XSUR4' | _mag='XMAP1' | _mag='XMAP2' | _mag='MAT' | _mag='SUR' | _mag='MAP'
|| _konto:='740/02/SU/00'
?};
{? FAP.FAKS().NDVAT='T' || _konto:='704/02/SU/NV' ?};
{? WAR.ZN='Z' || _konto:='842' ?};

:: PSojda 2017-11-23 - ustalono z p. A.Switek ze dekret musi przechodzic
{? _konto='' || _konto:='???' ?};
:: Koniec

_konto

\sp_ex
::----------------------------------------------------------------------------------------------------------------------
::  UTW:
:: OPIS:
::   WE:
::   WY:
::----------------------------------------------------------------------------------------------------------------------
_mag:=_konto:='';
{? FAP.FAKS().T().KOR='N';1
||
   DK.cntx_psh();
   DK.index('FAP');
   DK.prefix($FAP.ref,$FAP.ref);
   {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
   DK.cntx_pop()
||
   DK.cntx_psh();
   DK.index('KOR');
   DK.prefix($FAP.ref);
   {? DK.first || _mag:=DK.N().MAG().SYM || _mag:='' ?};
   DK.cntx_pop()
?};
{? _mag='POL1' | _mag='POL4' | _mag='POL2' | _mag='POL3' | _mag='XWYR1' | _mag='XWYR2' | _mag='POL' | _mag='WYR'
|| _konto:='700/02/SE/00'
|? _mag='XTOW1' | _mag='XTOW2' | _mag='TOW'
|| _konto:='730/02/SE/00'
|? (_mag='XMAT1' | _mag='XMAT2' | _mag='XSUR1' | _mag='XSUR2' | _mag='XSUR4' | _mag='XMAP1' | _mag='XMAP2' | _mag='MAT' | _mag='SUR' | _mag='MAP')&2+FAP.M().KTM<>'05'
|| _konto:='740/02/SE/00'

?};
{? WAR.ZN='Z' || _konto:='842' ?};

:: PSojda 2017-11-23 - ustalono z p. A.Switek ze dekret musi przechodzic
{? _konto='' || _konto:='???' ?};
:: Koniec

_konto

\sp_zal
'842'

::: KSIEGOWANIA WZ

\konto_wz
typf:=exec('powiaz','qjoko_ksg',DK.N);
{? typf='FAKSPWP-' || exec('wzsp_k','qjoko_ksg')
|? typf='FAKSPWZ-' || exec('wzsp_p','qjoko_ksg')
|? typf='FAKTSPWL' || exec('wzsp_ex','qjoko_ksg')
|? (typf='WDT-'  | typf='WDTS' )   || exec('wzsp_ue','qjoko_ksg')
|| DK.N().KK().SYM
?}


\wzsp_k
konto:='';
mag:=DK.N().MAG().SYM;
{? mag='POL1' | mag='POL4' | mag='POL2' | mag='POL3' |mag='WYR1' |  mag='WYR2' || konto:='701/02/SK'
|? mag='TOW1' | mag='TOW2' ||   konto:='731/02/SK'
|? mag='MAT1' | mag='MAT2' | mag='SUR1' | mag='SUR2' |mag='SUR4' | mag='MAP1' | mag='MAP2' ||  konto:='741/02/SK' ?};
konto


\wzsp_p
konto:='';
mag:=DK.N().MAG().SYM;
{? mag='POL1' | mag='POL4' | mag='POL2' | mag='POL3' | mag='WYR1' |  mag='WYR2' || konto:='701/02/SK'
|? mag='TOW1' | mag='TOW2' ||   konto:='731/02/SK'
|? mag='MAT1' | mag='MAT2' | mag='SUR1' | mag='SUR2' | mag='SUR4' | mag='MAP1' | mag='MAP2' ||  konto:='741/02/SK' ?};
konto


\wzsp_ue
konto:='';
mag:=DK.N().MAG().SYM;
{? mag='POL1' | mag='POL4' | mag='POL2' | mag='POL3' | mag='WYR1' |  mag='WYR2' || konto:='701/02/SU'
|? mag='TOW1' | mag='TOW2' ||   konto:='731/02/SU'
|? mag='MAT1' | mag='MAT2' | mag='SUR1' | mag='SUR2' | mag='SUR4' | mag='MAP1' | mag='MAP2' ||  konto:='741/02/SU' ?};
konto


\wzsp_ex
konto:='';
mag:=DK.N().MAG().SYM;
{? mag='POL1' | mag='POL4' | mag='POL2' | mag='POL3' | mag='WYR1' |  mag='WYR2' || konto:='701/02/SE'
|? mag='TOW1' | mag='TOW2' ||   konto:='731/02/SE'
|? mag='MAT1' | mag='MAT2' | mag='SUR1' | mag='SUR2' | mag='SUR4' | mag='MAP1' | mag='MAP2' ||  konto:='741/02/SE' ?};
konto

\powiaz
ND.cntx_psh();
ND.clear();
{? ND.seek(_a)
|| _typf:=ND.FAKS().T().T
?};
ND.cntx_pop();
_typf


\wdo
{? FAKS.NDVAT='O' | FAKS.NDVAT='T' || 'WDU' || 'WDO' ?}

\wdu
{? FAKS.NDVAT='O' | FAKS.NDVAT='T'|| 'KWU' || 'KWD' ?}


\spr
{? FAKS.NDVAT='O' | FAKS.NDVAT='T' || 'SprPKWSU' || 'Sprzedaż' ?}

\wyr_5xp

_wyr:='';
_mag:=ND.MAG().SYM;

{? _mag='MAT1' || _wyr:='001'
|? _mag='MAT2' || _wyr:='002'
|? _mag='MAT3' || _wyr:='003'
|? _mag='SUR1' || _wyr:='004'
|? _mag='SUR2' || _wyr:='005'
|? _mag='SUR3' || _wyr:='006'
|? _mag='POL1' || _wyr:='007'
|? _mag='POL2' || _wyr:='008'
|? _mag='POL3' || _wyr:='009'
|? _mag='POL4' || _wyr:='010'
|? _mag='WYR1' || _wyr:='011'
|? _mag='WYR2' || _wyr:='012'

|? _mag='WOB2' || _wyr:='013'
|? _mag='WOB3' || _wyr:='014'

|? _mag='WOB4' || _wyr:='015'
|? _mag='TOW1' || _wyr:='016'
|? _mag='TOW2' || _wyr:='017'

|? _mag='ZWP1' || _wyr:='018'
|? _mag='SUR4' || _wyr:='019'
?};
_wyr


\wyr_5

_wyr:='';
_mag:=ND.MAG().SYM;

{? _mag='MAT'  || _wyr:='001'
|? _mag='SUR'  || _wyr:='004'
|? _mag='SUR2' || _wyr:='005'
|? _mag='POL1' || _wyr:='007'
|? _mag='POL2' || _wyr:='008'
|? _mag='POL3' || _wyr:='009'
|? _mag='POL4' || _wyr:='010'
|? _mag='WYR'  || _wyr:='011'
|? _mag='WOB'  || _wyr:='013'
|? _mag='TOW'  || _wyr:='016'
|? _mag='ZWP'  || _wyr:='018'
|? _mag='SUR4' || _wyr:='019'
|? _mag='MASW' || _wyr:='020'
|? _mag='MAP' || _wyr:='021'
?};
_wyr


\spr_gtu
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp [12.51]
:: OPIS: formula kontrolna gtu
::----------------------------------------------------------------------------------------------------------------------
_wyn:=1;
{? form(DOK.DOKZRODL)<>''
|| {? 1+DOK.DOKZRODL='D'
   || FAKS.cntx_psh(); FAP.cntx_psh(); FAKSPL.cntx_psh;
      FAKS.use('faktu'+(3+(1-DOK.DOKZRODL)));
      FAP.use('fakpo'+(3+(1-DOK.DOKZRODL)));
      FAKSPL.use('fakpl'+(3+(1-DOK.DOKZRODL)));
      FAKS.prefix();
      _reffak:=#(4-DOK.DOKZRODL);
      {? FAKS.seek(_reffak,FAKS.name)
      || FAP.index('FAP'); FAP.prefix(FAKS.ref());
         {? FAP.first()
         || {!|?
                 {? -FAP.M().N*'samochód'>0 & (FAP.JPK_GTU=null | FAP.JPK_GTU().KOD<>'GTU_07' | DOK.JPK_GTU*'GTU_07'=0) || _wyn:=0 ?};
                 FAP.next()
            !}
         ?}
      ?};
      FAKS.cntx_pop(); FAP.cntx_pop(); FAKSPL.cntx_pop
   ?}
?};
{? _wyn=0 || FUN.emsg('Sprzedaż samochodu - proszę sprawdzić poprawność oznaczenia grup') ?};
_wyn


\k_mag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS: konto magazynowe od 08.2021
::----------------------------------------------------------------------------------------------------------------------
{? 1+_a='X'|| _a:=1-_a ?};
::{? 1+_b='X'|| _b:=1-_b ?};
{? _a='MAP'   || 'MAP'
|? _a='MAT'   || '310/01/02'
|? _a='POL1'  || '610/01/02'
|? _a='POL2'  || '610/01/01'
|? _a='POL3' | _a='MASW' || '610/02/01'
|? _a='POL4'  || '610/02/02'
|? _a='SUR'   || '310/01/01'
|? _a='SUR2'  || '310/02/01'
|? _a='SUR4'  || '310/01/01'
|? _a='WOB'   || '606/01'
|? _a='TOW'   || '330/01'
|? _a='WYR'   || '600/01'
|? _a='ZWP'   || '319/02'
|? 3+_a='ZAO' || ''
|| '???'
?}


\k_wz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS: konto dla dok. WZ,WDT,EXP od 08.2021
::----------------------------------------------------------------------------------------------------------------------
_typ_dok:=DK.N().TYP().T;
_konto:='';
_mag:=DK.N().MAG().SYM;
:: ustalenie kierunku sprzedaży
_kierunek:='';
{? DK.N().TYP().UE='T'
|| _kierunek:='U'
|? _typ_dok*'EXP'>0
|| _kierunek:='E'
|? _typ_dok*'WZ'>0 | _typ_dok*'ZZ'>0
|| _kierunek:='K'
|| _kierunek:='?'
?};
:: ustalenie konta na podstawie magazynu
{? _mag='TOW'
|| _konto:='731/02/S'+_kierunek
|? _mag*'MAT'>0 | _mag*'SUR'>0
|| _konto:='741/02/S'+_kierunek
|? _mag*'POL'>0 | _mag*'WYR'>0
|| _konto:='701/02/S'+_kierunek
|| _konto:='???'
?};
_konto


\mw_typd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS: typ dokumetu księgowego MW/RW w zależnosci od przesunięcia między magazynami
::----------------------------------------------------------------------------------------------------------------------
_typ:='';
_mg:=ND.MAG().SYM;
_mgd:=ND.MD().SYM;
_mg_wydz:=ND.MAG().W;
_mgd_wydz:=ND.MD().W;
{? _mg_wydz='N' & _mgd_wydz='N'
|| _typ:='MW - magazyn wydał'
|| _typ:='RW - rozchód wewnętrzny'
?};
_typ


\mw_kkosz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS: konto kosztowe dla MW - w przypadku przesunięcia z mag. głównego na mag.wydziałowy
::----------------------------------------------------------------------------------------------------------------------
_konto:='???';
_sym_md:=DK.N().MD().SYM;
_sym_mg:=DK.N().MAG().SYM;
{? _sym_mg='SUR' | _sym_mg='SUR4' | _sym_mg='SUR2'
|| {?_sym_md='MSU' | _sym_md='KSU'
   || _konto:='501/01/01/0101'
   |? _sym_md='KMO' | _sym_md='MMO'
   || _konto:='501/02/01/0101'
   ?}
|? _sym_mg='MAT'
|| {? _sym_md='KSU'
   || _konto:='501/01/03/0102'
   |? _sym_md='FSU'
   || _konto:='501/01/02/0102'
   |? _sym_md='KMO'
   || {? 7+DK.M().KTM='04-0025' | 7+DK.M().KTM='04-0027' | 7+DK.M().KTM='04-0026'
      || _konto:='501/02/02/0102'
      || _konto:='501/02/03/0102'
      ?}
   ?}
|? _sym_mg='WYR'
|| _konto:='580'
|? 3+_sym_mg='POL'
|| _konto:='580'
|? _sym_mg='MASW'
|| _konto:='580'
|| _konto:='XXX'
?};
_konto


\mw_k6
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS: konto kosztowe dla MW - w przypadku przesunięcia z mag. wydziałowy na mag.wydziałowy
::----------------------------------------------------------------------------------------------------------------------
_konto:='';
_sym_md:=DK.N().MD().SYM;
_sym_mg:=DK.N().MAG().SYM;
{? 2+DK.M().KTM='01'
|| {? DK.N().MAG().SYM='MSU' || _konto:='610/01/01'
   |? DK.N().MAG().SYM='KSU' || _konto:='610/01/02'
   |? DK.N().MAG().SYM='FSU' & -DK.JM().KOD='kg'  || _konto:='610/01/01'
   |? DK.N().MAG().SYM='FSU' & -DK.JM().KOD<>'kg' || _konto:='610/01/02'
   |? DK.N().MAG().SYM='KMO' & -DK.JM().KOD='kg'  || _konto:='610/02/01'
   |? DK.N().MAG().SYM='MMO' & -DK.JM().KOD='kg'  || _konto:='610/02/01'
   |? DK.N().MAG().SYM='KMO' & -DK.JM().KOD<>'kg' || _konto:='610/02/02'
   |? DK.N().MAG().SYM='MMO' & -DK.JM().KOD<>'kg' || _konto:='610/02/02'
   ?}
?};
_konto


\mp_typd
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS: typ dokumetu księgowego MP jako ZW lub PW i statusu dostaw w zależnosci od przesunięcia między magazynami
::----------------------------------------------------------------------------------------------------------------------
_typ:='';
_czy_pw:='N';
_opis:=ND.O;
_mg:=ND.MAG().SYM;
_mg_wydz:=ND.MAG().W;
_mgd_wydz:='N';
{? ND.NDSQL<>''
|| _rn_nd:=ND.NDSQL;
   ND.cntx_psh();MG.cntx_psh();DK.cntx_psh();
   ND.clear();
   {? ND.seek(BB.sqlint(ND.NDSQL),form(8+ND.NDSQL))
   || _mgd:=ND.MAG().SYM;
      _mgd_wydz:=ND.MAG().W;
      {? _mg='WYR' | 3+_mg='POL' | _mg='MASW'
      ||
         DK.use('dokma'+((8+_rn_nd)+3));
         DK.index('DOKMAG');
         DK.prefix(ND.ref());
         {? DK.first()
         || {!|?
                {? DK.PRDK=DK.SRDK
                || _czy_pw:='T'
                ?};
                DK.next()
           !}
         ?}
      ?}
   ?};
   ND.cntx_pop();MG.cntx_pop();DK.cntx_pop()
?};

{? _mg_wydz='N' & _mgd_wydz='N' | _mg_wydz='T' & _mgd_wydz='N' | _mg_wydz='T' & _mgd_wydz='T'
|| _typ:='MP - magazyn przyjął'
|? _mg_wydz='N' & _czy_pw='T'
|| _typ:='PW - przychód wewnętrzny'
|| _typ:='ZW - zwrot wewnętrzny'
?};
_typ


\mp_kkosz
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS: konto kosztowe dla MP - w przypadku przesunięcia z mag. wydziałowego na mag.główny
::----------------------------------------------------------------------------------------------------------------------
_konto:='???';
_sym_md:='XXX';
{? DK.N().NDSQL<>''
|| ND.cntx_psh();MG.cntx_psh();
   ND.clear();
   {? ND.seek(BB.sqlint(ND.NDSQL),form(8+ND.NDSQL))
   || _sym_md:=ND.MAG().SYM
   ?};
   ND.cntx_pop();MG.cntx_pop()
?};

_sym_mg:=DK.N().MAG().SYM;
{? _sym_mg='SUR' | _sym_mg='SUR4' | _sym_mg='SUR2'
|| {?_sym_md='MSU' | _sym_md='KSU'
   || _konto:='501/01/01/0101'
   |? _sym_md='KMO' | _sym_md='MMO'
   || _konto:='501/02/01/0101'
   ?}
|? _sym_mg='MAT'
|| {? _sym_md='KSU'
   || _konto:='501/01/03/0102'
   |? _sym_md='FSU'
   || _konto:='501/01/02/0102'
   |? _sym_md='KMO'
   || {? 7+DK.M().KTM='04-0025' | 7+DK.M().KTM='04-0027' | 7+DK.M().KTM='04-0026'
      || _konto:='501/02/02/0102'
      || _konto:='501/02/03/0102'
      ?}
   ?}
|? _sym_mg='WYR'   || _konto:='580'
|? 3+_sym_mg='POL' || _konto:='580'
|? _sym_mg='MASW'  || _konto:='580'
?};
_konto


\opsymm
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS:symbol dokumentu powiązanego dla MP/MW
::----------------------------------------------------------------------------------------------------------------------
_sym:='';
{? ND.TYP().T='MP'
|| {? ND.NDSQL<>''
   || ND.cntx_psh();
      ND.clear();
      {? ND.seek(BB.sqlint(ND.NDSQL),form(8+ND.NDSQL))
      || _sym:=ND.SYM
      ?};
      ND.cntx_pop()
   ?}
|? ND.TYP().T='MW'
|| _smg:=$ND.ref();
   ND.cntx_psh();
   ND.index('MM');
   ND.prefix(_smg,_smg);
   {? ND.first()
   || _sym:=ND.SYM
   ?};
   ND.cntx_pop()
?};
ND.SYM+{? _sym<>''||' - '+_sym||''?}


\k_rwp
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS:konto kosztowe dla RWP
::----------------------------------------------------------------------------------------------------------------------
_konto:='???';
{? 2+DK.M().KTM='07'
|| {? DK.N().MAG().SYM='MSU' || _konto:='501/01/01/0101'
   |? DK.N().MAG().SYM='KSU' || _konto:='501/01/01/0101'
   |? DK.N().MAG().SYM='FSU' || _konto:='501/01/01/0101'
   |? DK.N().MAG().SYM='MMO' || _konto:='501/02/01/0101'
   |? DK.N().MAG().SYM='KMO' || _konto:='501/02/01/0101'
   ?}
|? 2+DK.M().KTM='04'
|| {? DK.N().MAG().SYM='MSU' || _konto:='501/01/03/0102'
   |? DK.N().MAG().SYM='KSU' || _konto:='501/01/03/0102'
   |? DK.N().MAG().SYM='FSU' || _konto:='501/01/03/0102'
   |? DK.N().MAG().SYM='MMO' || _konto:='501/02/03/0102'
   |? DK.N().MAG().SYM='KMO' || _konto:='501/02/03/0102'
   ?}
|? (2+DK.M().KTM='01' | 2+DK.M().KTM='02') & DK.PRDK=DK.SRDK
|| _konto:=exec('rwp_mag','qjoko_ksg')
|? (2+DK.M().KTM='01' | 2+DK.M().KTM='02') & DK.PRDK<>DK.SRDK
|| _konto:='580'
?};
_konto


\rwp_mag
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS:konto magazynowe dla RWP, jesli
::----------------------------------------------------------------------------------------------------------------------
_konto:='???';
{?  2+DK.M().KTM='02' || _konto:='600/01'
|| {? DK.N().MAG().SYM='MSU' || _konto:='610/01/01'
   |? DK.N().MAG().SYM='KSU' || _konto:='610/01/02'
   |? DK.N().MAG().SYM='FSU' || _konto:='610/01/02'
   |? DK.N().MAG().SYM='KMO'  & -DK.JM().KOD='kg' || _konto:='610/02/01'
   |? DK.N().MAG().SYM='MMO'  & -DK.JM().KOD='kg' || _konto:='610/02/01'
   |? DK.N().MAG().SYM='KMO'  & -DK.JM().KOD<>'kg'|| _konto:='610/02/02'
   |? DK.N().MAG().SYM='MMO'  & -DK.JM().KOD<>'kg'|| _konto:='610/02/02'
  ?}
?};
_konto


\r_wyr_5
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS:wyznaczanie wyróżnika dla 5 dla dok. wystawionych w mag wydziałowych
::----------------------------------------------------------------------------------------------------------------------
_wyr:='XXX';
{? 2+DK.M().KTM='07'
|| {? DK.N().MAG().SYM='MSU' || _wyr:='004'
   |? DK.N().MAG().SYM='KSU' || _wyr:='004'
   |? DK.N().MAG().SYM='FSU' || _wyt:='004'
   |? DK.N().MAG().SYM='MMO' || _wyr:='005'
   |? DK.N().MAG().SYM='KMO' || _wyr:='005'
   ?}
|? 2+DK.M().KTM='04'
|| _wyr:='001'
|? 2+DK.M().KTM='02'
|| _wyr:='011'
|? 2+DK.M().KTM='01'
|| {? DK.N().MAG().SYM='MSU' || _wyr:='008'
   |? DK.N().MAG().SYM='KSU' || _wyr:='007'
   |? DK.N().MAG().SYM='FSU' || _wyr:='007'
   |? DK.N().MAG().SYM='KMO'  & -DK.JM().KOD='kg'|| _wyr:='009'
   |? DK.N().MAG().SYM='MMO'  & -DK.JM().KOD='kg'|| _wyr:='009'
   |? DK.N().MAG().SYM='KMO'  & -DK.JM().KOD<>'kg'|| _wyr:='010'
   |? DK.N().MAG().SYM='MMO'  & -DK.JM().KOD<>'kg'|| _wyr:='010'
   ?}
?};
_wyr


\mrn_sad
::----------------------------------------------------------------------------------------------------------------------
::  UTW: jp
:: OPIS:numer MRN wpisany w informacji dodatkowej dla FSAD
::----------------------------------------------------------------------------------------------------------------------
_mrn:='???';
FAKSO.cntx_psh();
FAKSO.use('fakto' + (FAKS.name() + 3));
FAKSO.index('FAKS');
FAKSO.prefix(FAKS.ref());
{? FAKSO.first()
|| {!|? {?FAKSO.T='MRN'|| _mrn:=FAKSO.O?};
        FAKSO.next()
   !}
?};
FAKSO.cntx_pop();
_mrn


\wyr_zaokr
::----------------------------------------------------------------------------------------------------------------------
::  UTW: MK
:: OPIS: wyznaczenie wyróżników na potrzeby księgowania dok. zaokrągleń wystawionych w magazynach.
:: _a - grupa materiałowa
:: _b - jednostka miary
::-------------------------------------------------------------------------------------------------------------
_wyr:='XXX';
_mag:=DK.N().MAG().SYM;
{? _a='07'
|| {? _mag='MSU' || _wyr:='004'
   |? _mag='KSU' || _wyr:='004'
   |? _mag='FSU' || _wyr:='004'
   |? _mag='MMO' || _wyr:='005'
   |? _mag='KMO' || _wyr:='005'
   |? _mag='SUR' || _wyr:='004'
   |? _mag='SUR2' || _wyr:='005'
   |? _mag='SUR4' || _wyr:='019'
   ?}
|? _a='04'
|| _wyr:='001'
|? _a='02'
|| _wyr:='011'
|? _a='01'
|| {? _mag='MSU' & _b='kg'|| _wyr:='008'
   |? _mag='MSU' & _b<>'kg'|| _wyr:='007'
   |? _mag='FSU' & _b='kg'|| _wyr:='008'
   |? _mag='FSU' & _b<>'kg'|| _wyr:='007'
   |? _mag='KSU' & _b='kg'|| _wyr:='008'
   |? _mag='KSU' & _b<>'kg'|| _wyr:='007'
   |? _mag='KMO'  & _b='kg'|| _wyr:='009'
   |? _mag='MMO'  & _b='kg'|| _wyr:='009'
   |? _mag='KMO'  & _b<>'kg'|| _wyr:='010'
   |? _mag='MMO'  & _b<>'kg'|| _wyr:='010'
   ?};

   {? _mag='MAT'  || _wyr:='001'
   |? _mag='POL1' || _wyr:='007'
   |? _mag='POL2' || _wyr:='008'
   |? _mag='POL3' || _wyr:='009'
   |? _mag='POL4' || _wyr:='010'
   |? _mag='WYR'  || _wyr:='011'
   |? _mag='WOB'  || _wyr:='013'
   |? _mag='TOW'  || _wyr:='016'
   |? _mag='ZWP'  || _wyr:='018'
   |? _mag='MASW' || _wyr:='020'
   |? _mag='MAP' || _wyr:='021'
   ?}
   ?};
_wyr
